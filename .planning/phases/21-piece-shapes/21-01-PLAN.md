---
phase: 21-piece-shapes
plan: 01
type: execute
---

<objective>
Update timing constants and add PieceType enum values for all 54 new pieces.

Purpose: Establish the data foundation for the new piece system before implementing the pieces themselves.
Output: Updated constants with new timing values, expanded PieceType enum with all 54 piece types.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-piece-shapes/21-RESEARCH.md

**Key files:**
@src/constants.ts
@src/types.ts
@src/core/GameEngine.ts

**Prior decisions from STATE.md:**
- INITIAL_TIME_MS: 60000 → 75000 (75 sec game)
- INITIAL_SPEED: 800 → 780 (slightly slower base fall)
- SOFT_DROP_FACTOR: 6 → 8 (snappier fast drop)
- 54 pieces total: 10 tetra (5+5), 22 penta (11+11), 22 hexa (11+11)
- Exclusive spawning: only one size at a time based on pressure zone
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update timing constants</name>
  <files>src/constants.ts, src/core/GameEngine.ts</files>
  <action>
Update these constants:

**In constants.ts:**
- Change `INITIAL_TIME_MS` from 60000 to 75000

**In GameEngine.ts (around line 27-29):**
- Change `INITIAL_SPEED` from 800 to 780
- Change `SOFT_DROP_FACTOR` from 6 to 8

These changes extend the game to 75 seconds with 3 zones of 25 seconds each, with snappier fast-drop feel.
  </action>
  <verify>Grep for the old values (60000, 800 for INITIAL_SPEED, 6 for SOFT_DROP_FACTOR) returns no matches. Grep for new values shows them in correct locations.</verify>
  <done>INITIAL_TIME_MS=75000, INITIAL_SPEED=780, SOFT_DROP_FACTOR=8</done>
</task>

<task type="auto">
  <name>Task 2: Add PieceType enum values</name>
  <files>src/types.ts</files>
  <action>
Expand the PieceType enum to include all 54 piece types. The current enum has: I, J, L, O, S, T, Z (7 values).

Add these new values in organized groups:

```typescript
export enum PieceType {
  // Original tetrominoes (keep for backwards compatibility)
  I = 'I', J = 'J', L = 'L', O = 'O', S = 'S', T = 'T', Z = 'Z',

  // Tetra Normal (5 pieces) - these replace the originals during gameplay
  T_I = 'T_I',     // Vertical bar (4 cells)
  T_L = 'T_L',     // L-shape
  T_T = 'T_T',     // T-shape (with diagonal floater)
  T_S = 'T_S',     // S-shape
  T_O = 'T_O',     // 2x2 square

  // Tetra Corrupted (5 pieces)
  T_I_C = 'T_I_C', // Corrupted I (actually Z-like split)
  T_L_C = 'T_L_C', // Corrupted L
  T_T_C = 'T_T_C', // Corrupted T
  T_S_C = 'T_S_C', // Corrupted S
  T_O_C = 'T_O_C', // Corrupted O

  // Penta Normal (11 pieces)
  P_I = 'P_I',     // 5-cell vertical bar
  P_L = 'P_L',     // L with extra cell
  P_X = 'P_X',     // Plus/cross shape
  P_U = 'P_U',     // U-shape
  P_L2 = 'P_L2',   // Alternate L
  P_Y = 'P_Y',     // Y-shape
  P_T = 'P_T',     // T5 shape
  P_S = 'P_S',     // S5 shape
  P_P = 'P_P',     // P-shape
  P_Z = 'P_Z',     // Z5 shape
  P_W = 'P_W',     // W-shape (stairs)

  // Penta Corrupted (11 pieces)
  P_I_C = 'P_I_C',
  P_L_C = 'P_L_C',
  P_X_C = 'P_X_C',
  P_U_C = 'P_U_C',
  P_L2_C = 'P_L2_C',
  P_Y_C = 'P_Y_C',
  P_T_C = 'P_T_C',
  P_S_C = 'P_S_C',
  P_P_C = 'P_P_C',
  P_Z_C = 'P_Z_C',
  P_W_C = 'P_W_C',

  // Hexa Normal (11 pieces)
  H_I = 'H_I',     // 6-cell shapes
  H_L = 'H_L',
  H_X = 'H_X',
  H_U = 'H_U',
  H_L2 = 'H_L2',
  H_Y = 'H_Y',
  H_T = 'H_T',
  H_S = 'H_S',
  H_P = 'H_P',
  H_Z = 'H_Z',
  H_W = 'H_W',

  // Hexa Corrupted (11 pieces)
  H_I_C = 'H_I_C',
  H_L_C = 'H_L_C',
  H_X_C = 'H_X_C',
  H_U_C = 'H_U_C',
  H_L2_C = 'H_L2_C',
  H_Y_C = 'H_Y_C',
  H_T_C = 'H_T_C',
  H_S_C = 'H_S_C',
  H_P_C = 'H_P_C',
  H_Z_C = 'H_Z_C',
  H_W_C = 'H_W_C',
}
```

Note: Keep the original 7 tetromino values for backwards compatibility with existing save data.
  </action>
  <verify>`npm run test:run` passes. TypeScript compiles without errors.</verify>
  <done>PieceType enum has 61 total values (7 original + 54 new)</done>
</task>

<task type="auto">
  <name>Task 3: Add piece size constants</name>
  <files>src/constants.ts</files>
  <action>
Add constants for pressure-based zone thresholds near the timing constants:

```typescript
// Piece size zone thresholds (based on pressure row)
// Pressure rises from bottom (row 0) toward top as time elapses
export const TETRA_ZONE_END_ROW = 13;   // Tetra zone: pressure below row 13
export const PENTA_ZONE_END_ROW = 8;    // Penta zone: pressure between row 13 and row 8
// Hexa zone: pressure above row 8 (row 8 to top)

// Corruption chance for spawning corrupted variants
export const CORRUPTION_CHANCE = 0.15;  // 15% chance

// Mirror chance for asymmetric pieces
export const MIRROR_CHANCE = 0.5;       // 50% chance
```

These will be used by the spawn logic in Plan 03.
  </action>
  <verify>Grep for TETRA_ZONE_END_ROW, PENTA_ZONE_END_ROW, CORRUPTION_CHANCE, MIRROR_CHANCE shows them in constants.ts.</verify>
  <done>Zone threshold constants and spawn chances defined</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes
- [ ] `npm run build` succeeds
- [ ] INITIAL_TIME_MS = 75000 in constants.ts
- [ ] INITIAL_SPEED = 780 in GameEngine.ts
- [ ] SOFT_DROP_FACTOR = 8 in GameEngine.ts
- [ ] PieceType enum has 61 values (7 + 54)
- [ ] Zone constants defined in constants.ts
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Tests pass
- Ready for Plan 02 (piece definitions)
</success_criteria>

<output>
After completion, create `.planning/phases/21-piece-shapes/21-01-SUMMARY.md`
</output>
