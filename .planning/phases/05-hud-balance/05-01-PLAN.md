---
phase: 05-hud-balance
plan: 01
type: execute
---

<objective>
Add meter state fields and build HUD meter UI components for the periscope view.

Purpose: Establish the visual feedback system that shows players their complication buildup before triggers occur.
Output: Two vertical meter bars (left=capacitor, right=heat) visible in periscope mode, wired to state values.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/DESIGN_VISION.md
@types.ts
@components/GameBoard.tsx
@Game.tsx

**Key Design Decisions:**
- Laser Capacitor Meter: Left side of periscope, drains as player pops (blue→yellow→red gradient for drain)
- Controls Heat Meter: Right side of periscope, builds while rotating (green→yellow→red gradient for heat)
- No meter for LIGHTS (intentionally unpredictable)
- Meters should be visible during PERISCOPE phase only

**Established Patterns:**
- State lives in GameState (types.ts)
- GameEngine initializes/resets state in constructor and startRun()
- GameBoard.tsx renders periscope visuals
- Game.tsx passes state props to GameBoard
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add meter state fields to types and GameEngine</name>
  <files>types.ts, core/GameEngine.ts</files>
  <action>
Add two new fields to GameState interface in types.ts:
- `laserCapacitor: number` — value 0-100 (100 = full, 0 = empty/triggers complication)
- `controlsHeat: number` — value 0-100 (0 = cool, 100 = overheated/triggers complication)

In GameEngine.ts constructor and startRun():
- Initialize `laserCapacitor: 100` (starts full)
- Initialize `controlsHeat: 0` (starts cool)

Do NOT change any trigger logic yet — that's Plan 02 and 03.
  </action>
  <verify>`npm run test:run` passes (no breaking changes to existing tests)</verify>
  <done>GameState has laserCapacitor and controlsHeat fields, initialized to 100 and 0 respectively</done>
</task>

<task type="auto">
  <name>Task 2: Create HUD meter components</name>
  <files>components/HudMeter.tsx</files>
  <action>
Create a new component `HudMeter.tsx` that renders a vertical meter bar.

Props:
- `value: number` — current fill level (0-100)
- `maxValue: number` — max value (always 100)
- `side: 'left' | 'right'` — which side of screen
- `colorMode: 'drain' | 'heat'` — determines color gradient direction
  - 'drain': blue (high) → yellow (mid) → red (low) — for capacitor
  - 'heat': green (low) → yellow (mid) → red (high) — for heat

Render as SVG elements that can overlay on the periscope view:
- Outer border rectangle (dark gray)
- Inner filled rectangle based on value
- Position: absolute, on left or right edge of periscope viewport
- Height: ~80% of periscope height
- Width: ~15-20px

Follow existing component patterns:
- Use React.FC with typed props interface
- camelCase for props
- PascalCase for component name
  </action>
  <verify>Component file exists and exports HudMeter, TypeScript compiles without errors</verify>
  <done>HudMeter component created with value, maxValue, side, colorMode props</done>
</task>

<task type="auto">
  <name>Task 3: Wire meters into GameBoard periscope view</name>
  <files>components/GameBoard.tsx, Game.tsx</files>
  <action>
In Game.tsx:
- Pass `laserCapacitor` and `controlsHeat` from state to GameBoard

In GameBoard.tsx:
- Add `laserCapacitor?: number` and `controlsHeat?: number` props
- Import HudMeter component
- Render two HudMeter instances inside the periscope SVG (or as overlay):
  - Left meter: value={laserCapacitor}, colorMode="drain", side="left"
  - Right meter: value={controlsHeat}, colorMode="heat", side="right"
- Only render meters when phase is PERISCOPE (not CONSOLE, not GAME_OVER)

Position meters at edges of the game viewport but inside the periscope frame.
  </action>
  <verify>`npm run dev -- --host`, open in browser, start a game — see two meter bars (left full blue, right empty green)</verify>
  <done>Meters visible in periscope view, left shows 100% blue, right shows 0% green</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] `npm run dev -- --host` starts without errors
- [ ] In periscope view: left meter visible, shows full (blue)
- [ ] In periscope view: right meter visible, shows empty (green)
- [ ] Meters NOT visible in console view
</verification>

<success_criteria>
- All tasks completed
- GameState has laserCapacitor and controlsHeat fields
- HudMeter component exists and renders correctly
- Meters visible in periscope mode
- No TypeScript errors
- All existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-hud-balance/05-01-SUMMARY.md`
</output>
