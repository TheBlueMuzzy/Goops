---
phase: 14-data-architecture
plan: 02
type: execute
---

<objective>
Update complication unlock ranks and color schedule to match v1.2 progression design.

Purpose: V1.2 changes when complications unlock and when new colors appear. This affects early game pacing significantly.
Output: Updated complicationConfig.ts, constants.ts, gameLogic.ts, and related tests.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Key files:**
@complicationConfig.ts (COMPLICATION_CONFIG with unlockRank values)
@constants.ts (COLORS object)
@utils/gameLogic.ts (getPaletteForRank function)
@tests/gameLogic.test.ts (color palette tests)

**V1.2 complication unlock changes:**
| Complication | Old Rank | New Rank |
|--------------|----------|----------|
| LIGHTS | 2 | 2 (unchanged) |
| LASER | 1 | 4 |
| CONTROLS | 3 | 6 |

**V1.2 color schedule changes:**
| Color | Old Rank | New Rank |
|-------|----------|----------|
| Base 4 (R/B/G/Y) | 0 | 0 (unchanged) |
| Teal | 2 | REMOVED |
| White | 5 | 30 |
| Orange | 8 | 10 |
| Purple | N/A | 20 (NEW) |

So the new color schedule is:
- Ranks 0-9: 4 colors (Red, Blue, Green, Yellow)
- Ranks 10-19: 5 colors (+Orange)
- Ranks 20-29: 6 colors (+Purple)
- Ranks 30-39: 7 colors (+White)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update complication unlock ranks</name>
  <files>complicationConfig.ts</files>
  <action>
In complicationConfig.ts, update the COMPLICATION_CONFIG object unlock ranks:

Current (around lines 10-31):
```typescript
export const COMPLICATION_CONFIG = {
  [ComplicationType.LASER]: {
    unlockRank: 1,  // CHANGE TO 4
    ...
  },
  [ComplicationType.LIGHTS]: {
    unlockRank: 2,  // KEEP AS 2
    ...
  },
  [ComplicationType.CONTROLS]: {
    unlockRank: 3,  // CHANGE TO 6
    ...
  },
}
```

Change LASER unlockRank from 1 to 4.
Change CONTROLS unlockRank from 3 to 6.
Keep LIGHTS unlockRank at 2.

No other changes to this file.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>COMPLICATION_CONFIG has: LIGHTS@2, LASER@4, CONTROLS@6</done>
</task>

<task type="auto">
  <name>Task 2: Add PURPLE to COLORS and update color schedule</name>
  <files>constants.ts, utils/gameLogic.ts</files>
  <action>
**In constants.ts**, add PURPLE to the COLORS object (around line 188-199):

```typescript
export const COLORS = {
  RED: '#ef4444',
  BLUE: '#3b82f6',
  GREEN: '#22c55e',
  YELLOW: '#eab308',
  ORANGE: '#f97316',
  PURPLE: '#a855f7',  // NEW - Tailwind purple-500
  WHITE: '#f8fafc',
  // TEAL removed from active use but keep for backwards compatibility if needed
  TEAL: '#14b8a6',

  GRID_BG: '#020617',
  GRID_EMPTY: '#1e293b',
};
```

**In utils/gameLogic.ts**, update getPaletteForRank function (around lines 19-24):

Current:
```typescript
export const getPaletteForRank = (rank: number): string[] => {
  const palette = [COLORS.RED, COLORS.BLUE, COLORS.GREEN, COLORS.YELLOW];
  if (rank >= 2) palette.push(COLORS.TEAL);
  if (rank >= 5) palette.push(COLORS.WHITE);
  if (rank >= 8) palette.push(COLORS.ORANGE);
  return palette;
};
```

Change to:
```typescript
export const getPaletteForRank = (rank: number): string[] => {
  const palette = [COLORS.RED, COLORS.BLUE, COLORS.GREEN, COLORS.YELLOW];
  if (rank >= 10) palette.push(COLORS.ORANGE);
  if (rank >= 20) palette.push(COLORS.PURPLE);
  if (rank >= 30) palette.push(COLORS.WHITE);
  return palette;
};
```

This removes TEAL entirely from the active palette and reorders the color unlocks.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>
- COLORS object includes PURPLE
- getPaletteForRank returns: 4 colors at rank 0-9, +Orange at 10, +Purple at 20, +White at 30
  </done>
</task>

<task type="auto">
  <name>Task 3: Update color palette tests</name>
  <files>tests/gameLogic.test.ts</files>
  <action>
Update the getPaletteForRank tests (around lines 91-118) to match the new color schedule.

Current tests check:
- Rank 1: 4 colors
- Rank 2: 5 colors (+TEAL)
- Rank 5: 6 colors (+WHITE)
- Rank 8: 7 colors (+ORANGE)

Update to:
```typescript
describe('getPaletteForRank', () => {
  it('returns 4 colors for rank 0-9', () => {
    const palette = getPaletteForRank(1);
    expect(palette).toHaveLength(4);
    expect(palette).toContain(COLORS.RED);
    expect(palette).toContain(COLORS.BLUE);
    expect(palette).toContain(COLORS.GREEN);
    expect(palette).toContain(COLORS.YELLOW);
  });

  it('still returns 4 colors at rank 9', () => {
    const palette = getPaletteForRank(9);
    expect(palette).toHaveLength(4);
  });

  it('adds ORANGE at rank 10', () => {
    const palette = getPaletteForRank(10);
    expect(palette).toHaveLength(5);
    expect(palette).toContain(COLORS.ORANGE);
  });

  it('adds PURPLE at rank 20', () => {
    const palette = getPaletteForRank(20);
    expect(palette).toHaveLength(6);
    expect(palette).toContain(COLORS.PURPLE);
  });

  it('adds WHITE at rank 30', () => {
    const palette = getPaletteForRank(30);
    expect(palette).toHaveLength(7);
    expect(palette).toContain(COLORS.WHITE);
  });

  it('has all 7 colors at rank 39', () => {
    const palette = getPaletteForRank(39);
    expect(palette).toHaveLength(7);
    expect(palette).toContain(COLORS.RED);
    expect(palette).toContain(COLORS.BLUE);
    expect(palette).toContain(COLORS.GREEN);
    expect(palette).toContain(COLORS.YELLOW);
    expect(palette).toContain(COLORS.ORANGE);
    expect(palette).toContain(COLORS.PURPLE);
    expect(palette).toContain(COLORS.WHITE);
  });
});
```

This replaces the old 4 tests with 6 new tests that verify the v1.2 color schedule.
  </action>
  <verify>Tests pass: `npm run test:run`</verify>
  <done>
- All old color tests removed
- 6 new tests verify: rank 1 (4 colors), rank 9 (still 4), rank 10 (+Orange), rank 20 (+Purple), rank 30 (+White), rank 39 (all 7)
- All tests pass
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run test:run` passes
- [ ] COMPLICATION_CONFIG has correct unlock ranks (LIGHTS@2, LASER@4, CONTROLS@6)
- [ ] getPaletteForRank returns correct colors at ranks 1, 10, 20, 30
</verification>

<success_criteria>
- Complication unlock ranks updated to v1.2 values
- Color schedule updated: Orange@10, Purple@20, White@30
- PURPLE color added to COLORS constant
- All tests pass including updated color tests
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-data-architecture/14-02-SUMMARY.md`

After both plans complete, Phase 14 is done.
</output>
