---
phase: 15-onboarding-band
plan: 03
type: execute
---

<objective>
Implement PRESSURE_CONTROL (extends game time), FOCUS_MODE (slows time in minigames), and DENSE_GOOP (increases fall speed) upgrade effects.

Purpose: Add three new passive gameplay modifiers that affect core mechanics.
Output: Three new upgrades have functional gameplay effects.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-onboarding-band/15-02-SUMMARY.md (will exist after plan 02)

**Upgrade Effects from constants.ts:**
| Upgrade | Rank | effectPerLevel | maxLevel | Total Effect |
|---------|------|----------------|----------|--------------|
| PRESSURE_CONTROL | 9 | 5 (seconds) | 8 | +40 seconds |
| FOCUS_MODE | 7 | 0.10 (-10%) | 4 | -40% time speed |
| DENSE_GOOP | 8 | 0.125 (+12.5%) | 4 | +50% fall speed |

**Implementation locations:**
- PRESSURE_CONTROL: GameEngine constructor where `maxTime = INITIAL_TIME_MS`
- FOCUS_MODE: GameEngine.tick() time decrement when in minigame phase
- DENSE_GOOP: GameEngine fall speed / drop interval calculation

**Key insight from STATE.md:**
> PRESSURE_CONTROL: +5 seconds per level (8 levels = +40s max)

**Current game time:** INITIAL_TIME_MS = 60,000 (60 seconds base)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement PRESSURE_CONTROL (extended game time)</name>
  <files>core/GameEngine.ts</files>
  <action>
In GameEngine constructor or applyUpgrades(), apply PRESSURE_CONTROL bonus:

```typescript
private applyUpgrades() {
  // Base time
  let baseTime = INITIAL_TIME_MS;

  // PRESSURE_CONTROL: +5 seconds per level
  const pressureLevel = this.powerUps['PRESSURE_CONTROL'] || 0;
  if (pressureLevel > 0) {
    const bonusMs = pressureLevel * 5 * 1000; // 5 seconds per level
    baseTime += bonusMs;
  }

  this.maxTime = baseTime;
  // ... rest of method
}
```

Import UPGRADES from constants.ts if needed for dynamic effectPerLevel lookup, OR use hardcoded 5000ms per level (simpler, matches design doc).
  </action>
  <verify>npm run test:run — all tests pass</verify>
  <done>PRESSURE_CONTROL adds game time: level 1 = 65s, level 4 = 80s, level 8 = 100s</done>
</task>

<task type="auto">
  <name>Task 2: Implement FOCUS_MODE (time slow during minigames)</name>
  <files>core/GameEngine.ts</files>
  <action>
In GameEngine.tick(), apply time slowdown when in COMPLICATION_MINIGAME phase:

Find the timer decrement code (likely in tickTimer or main tick):
```typescript
// Before: time decrements at full speed
this.state.timeRemaining -= dt;

// After: time decrements slower during minigames if FOCUS_MODE active
const focusLevel = this.powerUps['FOCUS_MODE'] || 0;
const isInMinigame = this.state.phase === GamePhase.COMPLICATION_MINIGAME;
const timeMultiplier = (isInMinigame && focusLevel > 0)
  ? (1 - focusLevel * 0.10)  // -10% per level
  : 1;
this.state.timeRemaining -= dt * timeMultiplier;
```

At max level 4: 1 - (4 × 0.10) = 0.60 (time passes at 60% speed during minigames)

Import GamePhase from types.ts if not already imported.
  </action>
  <verify>npm run test:run — all tests pass</verify>
  <done>FOCUS_MODE slows time during minigames: level 4 = 40% slower timer</done>
</task>

<task type="auto">
  <name>Task 3: Implement DENSE_GOOP (faster fall speed)</name>
  <files>core/GameEngine.ts</files>
  <action>
Find the fall speed / drop interval calculation. The piece falls at intervals determined by a timer.

Look for `dropInterval`, `fallSpeed`, `AUTO_DROP_MS`, or similar. Likely in:
- Constructor (initial drop speed)
- tickFallingBlocks or similar (auto-drop timer)

Apply DENSE_GOOP multiplier:
```typescript
// Find base drop interval (e.g., 1000ms for 1 drop per second)
const baseDropInterval = 1000; // or whatever the current value is

// DENSE_GOOP: +12.5% fall speed per level = shorter interval
const denseLevel = this.powerUps['DENSE_GOOP'] || 0;
const speedMultiplier = 1 + (denseLevel * 0.125); // 1.0, 1.125, 1.25, 1.375, 1.5
const adjustedInterval = baseDropInterval / speedMultiplier;
```

At max level 4: interval / 1.5 = 667ms between drops (50% faster)

Note: This upgrade can be negative for some players (faster = harder to place). That's intentional per the design doc — players can respec to remove points.
  </action>
  <verify>npm run test:run — all tests pass, manual test: observe faster falling at level 2+</verify>
  <done>DENSE_GOOP increases fall speed: level 4 = 50% faster drops</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] `npm run build` succeeds
- [ ] Manual test PRESSURE_CONTROL: Set level, verify timer starts higher
- [ ] Manual test FOCUS_MODE: Set level, enter minigame, observe timer slows
- [ ] Manual test DENSE_GOOP: Set level, observe pieces fall faster
</verification>

<success_criteria>
- PRESSURE_CONTROL adds +5s per level to starting time
- FOCUS_MODE slows timer by 10% per level during minigames only
- DENSE_GOOP increases fall speed by 12.5% per level
- All effects scale correctly with upgrade levels
</success_criteria>

<output>
After completion, create `.planning/phases/15-onboarding-band/15-03-SUMMARY.md`
</output>
