---
phase: 15-onboarding-band
plan: 02
type: execute
---

<objective>
Wire the three complication-related upgrade effects using the new v1.2 effectPerLevel values.

Purpose: Make CIRCUIT_STABILIZER, CAPACITOR_EFFICIENCY, and GEAR_LUBRICATION actually affect gameplay.
Output: Upgrade levels scale their respective complication meters correctly.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-onboarding-band/15-01-SUMMARY.md (will exist after plan 01)

**Upgrade Effects from constants.ts:**
| Upgrade | effectPerLevel | Formula |
|---------|----------------|---------|
| CIRCUIT_STABILIZER | 0.075 | Base 50% trigger - (7.5% × level) |
| CAPACITOR_EFFICIENCY | 0.0625 | Base drain × (1 - 6.25% × level) |
| GEAR_LUBRICATION | 0.125 | Base dissipation × (1 + 12.5% × level) |

**Current hardcoded values in complicationConfig.ts:**
- LIGHTS.triggerUpgradeEffect: 0.06 (old)
- LASER.drainUpgradeEffect: 0.05 (old)
- CONTROLS.dissipationUpgradeEffect: 0.10 (old)

**Files to update:**
- `complicationConfig.ts` — Update effect values OR remove them (use UPGRADES directly)
- `core/ComplicationManager.ts` — Uses triggerUpgradeEffect
- `core/commands/actions.ts` — Uses drainUpgradeEffect
- `core/GameEngine.ts` — Uses dissipationUpgradeEffect
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update complicationConfig with v1.2 effect values</name>
  <files>complicationConfig.ts</files>
  <action>
Update the effect values in COMPLICATION_CONFIG to match v1.2 UPGRADES:

```typescript
[ComplicationType.LASER]: {
  // ...existing fields...
  drainUpgradeEffect: 0.0625, // Was 0.05, now matches CAPACITOR_EFFICIENCY.effectPerLevel
},
[ComplicationType.LIGHTS]: {
  // ...existing fields...
  triggerUpgradeEffect: 0.075, // Was 0.06, now matches CIRCUIT_STABILIZER.effectPerLevel
},
[ComplicationType.CONTROLS]: {
  // ...existing fields...
  dissipationUpgradeEffect: 0.125, // Was 0.10, now matches GEAR_LUBRICATION.effectPerLevel
},
```

Add a comment above each noting which upgrade it corresponds to:
```typescript
drainUpgradeEffect: 0.0625, // CAPACITOR_EFFICIENCY.effectPerLevel
triggerUpgradeEffect: 0.075, // CIRCUIT_STABILIZER.effectPerLevel
dissipationUpgradeEffect: 0.125, // GEAR_LUBRICATION.effectPerLevel
```
  </action>
  <verify>npm run test:run — all tests pass</verify>
  <done>complicationConfig uses v1.2 effect values matching UPGRADES constants</done>
</task>

<task type="auto">
  <name>Task 2: Verify effect application in game logic</name>
  <files>core/ComplicationManager.ts, core/commands/actions.ts, core/GameEngine.ts</files>
  <action>
Verify each effect is calculated correctly (these should already be correct from 15-01, but verify formulas):

1. **CIRCUIT_STABILIZER** in ComplicationManager.ts (~line 171-172):
```typescript
const lightsLevel = powerUps['CIRCUIT_STABILIZER'] || 0;
const triggerChance = lightsConfig.triggerChanceBase - (lightsConfig.triggerUpgradeEffect * lightsLevel);
```
At max level 4: 0.50 - (0.075 × 4) = 0.50 - 0.30 = 0.20 (20% trigger chance) ✓

2. **CAPACITOR_EFFICIENCY** in actions.ts (~line 255-258):
```typescript
const laserLevel = engine.powerUps['CAPACITOR_EFFICIENCY'] || 0;
const drainMultiplier = 1 - (laserConfig.drainUpgradeEffect * laserLevel);
const drainAmount = group.length * laserConfig.drainPerUnit * drainMultiplier;
```
At max level 4: 1 - (0.0625 × 4) = 1 - 0.25 = 0.75 (25% less drain) ✓

3. **GEAR_LUBRICATION** in GameEngine.ts (~line 435-437):
```typescript
const controlsLevel = this.powerUps['GEAR_LUBRICATION'] || 0;
const drainRate = ctrlConfig.dissipationBase * (1 + ctrlConfig.dissipationUpgradeEffect * controlsLevel);
```
At max level 4: 50 × (1 + 0.125 × 4) = 50 × 1.5 = 75 heat/sec dissipation ✓

No code changes needed if formulas are already correct. If any formula differs, update to match the pattern above.
  </action>
  <verify>npm run test:run — all tests pass, manually test: upgrade to level 1, observe effect change</verify>
  <done>All three complication upgrade effects apply correctly using v1.2 effectPerLevel values</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] `npm run build` succeeds
- [ ] Manual test: Set CIRCUIT_STABILIZER to level 2, observe fewer LIGHTS triggers
- [ ] Manual test: Set CAPACITOR_EFFICIENCY to level 2, observe slower capacitor drain
- [ ] Manual test: Set GEAR_LUBRICATION to level 2, observe faster heat dissipation
</verification>

<success_criteria>
- complicationConfig.ts uses v1.2 effect values
- All three complication upgrades affect gameplay at correct magnitudes
- Effect formulas match documented behavior in UPGRADES
</success_criteria>

<output>
After completion, create `.planning/phases/15-onboarding-band/15-02-SUMMARY.md`
</output>
