---
phase: 23-code-rename
plan: 05
type: execute
---

<objective>
Rename Progression system variables, timing constants, AND update persistence layer.

Purpose: Establish official progression terminology (operatorRank, sessionXP, scraps).
Output: All scoring and progression variables use glossary terms. Save format updated.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/GLOSSARY.md
@.planning/phases/23-code-rename/23-04-SUMMARY.md

**Key files to modify:**
@App.tsx - State management
@core/GameEngine.ts - Score/time tracking
@utils/progression.ts - Rank calculations
@utils/storage.ts - Persistence layer (CRITICAL)
@types.ts - SaveData interface (CRITICAL)
@components/ConsoleView.tsx - Display
@components/UpgradePanel.tsx - Upgrade UI
@constants.ts - Timing constants

**Migration targets:**
- rank -> operatorRank (176 refs - scattered, context-dependent)
- totalScore -> operatorXP (28 refs)
- score -> sessionXP (76 refs)
- powerUpPoints -> scraps (21 refs)
- combo -> popStreak (22 refs)
- timeLeft -> sessionTime (29 refs)
- INITIAL_TIME_MS -> SESSION_DURATION (5 refs)
- INITIAL_SPEED -> ACTIVE_GOOP_SPEED (3 refs)

**CRITICAL - SAVE RESET:**
This plan changes serialized property names in SaveData. The storage key will be
updated from 'gooptris_save_v1' to 'gooptris_save_v2'. This means:
- Old saves will be IGNORED (not loaded)
- Players start fresh with default values
- This is intentional and accepted
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update SaveData interface and storage key (PERSISTENCE CHANGE)</name>
  <files>types.ts, utils/storage.ts</files>
  <action>
    **THIS TASK TRIGGERS SAVE RESET - intentional and accepted.**

    1. In types.ts, update the SaveData interface (around line 316-331):
       - `rank: number` -> `operatorRank: number`
       - `totalScore: number` -> `operatorXP: number`
       - `powerUpPoints: number` -> `scraps: number`

    2. In utils/storage.ts:
       - Change STORAGE_KEY from 'gooptris_save_v1' to 'gooptris_save_v2'
       - Update the defaultSaveData object to use new property names:
         - `rank: 1` -> `operatorRank: 1`
         - `totalScore: 0` -> `operatorXP: 0`
         - `powerUpPoints: 0` -> `scraps: 0`
       - Update any property references in loadSaveData() and saveGameData()

    After this task, the app will NOT load old saves (new storage key).
  </action>
  <verify>grep -rE "gooptris_save_v1" --include="*.ts" . | grep -v node_modules returns no matches</verify>
  <done>SaveData uses new property names. Storage key is v2. Old saves ignored.</done>
</task>

<task type="auto">
  <name>Task 2: Rename scoring variables throughout codebase</name>
  <files>core/GameEngine.ts, App.tsx, components/*.tsx, utils/progression.ts</files>
  <action>
    1. Rename score -> sessionXP (76 refs):
       - State field in GameEngine (18 refs)
       - Display in components
       - Test files
       - BE CAREFUL: "score" is a common word. Only rename game-score context.

    2. Rename totalScore -> operatorXP (28 refs):
       - App.tsx state management
       - progression.ts calculations
       - Component displays

    3. Rename powerUpPoints -> scraps (21 refs):
       - App.tsx (6 refs)
       - ConsoleView.tsx (5 refs)
       - UpgradePanel.tsx (4 refs)

    4. Rename combo -> popStreak (22 refs):
       - GameEngine state
       - Audio system (3 refs)
       - Controls/HUD display

    These must match the SaveData property names from Task 1.
  </action>
  <verify>grep -rE "\.score[^A-Za-z]|totalScore|powerUpPoints|\.combo[^A-Za-z]" --include="*.ts" --include="*.tsx" . | grep -v node_modules returns only false positives</verify>
  <done>score -> sessionXP, totalScore -> operatorXP, powerUpPoints -> scraps, combo -> popStreak complete.</done>
</task>

<task type="auto">
  <name>Task 3: Rename rank to operatorRank and timing constants</name>
  <files>App.tsx, utils/progression.ts, constants.ts, core/GameEngine.ts, core/gameLogic.ts, components/*.tsx</files>
  <action>
    1. Rename rank -> operatorRank (176 refs):
       - This is SCATTERED across many files
       - State field in App.tsx (saveData.rank -> saveData.operatorRank)
       - Function params in progression.ts
       - Display logic in components
       - BE CAREFUL: "rank" alone is common. Focus on game-context usages.

    2. In constants.ts:
       - INITIAL_TIME_MS -> SESSION_DURATION (5 refs)
       - INITIAL_SPEED -> ACTIVE_GOOP_SPEED (3 refs)

    3. Rename timeLeft -> sessionTime (29 refs):
       - GameEngine.ts (8 refs)
       - gameLogic.ts (4 refs)
       - GoalManager.ts (4 refs)
       - Display components

    Note: rank is heavily used. May need multiple passes to catch all.
  </action>
  <verify>grep -rE "saveData\.rank[^A-Za-z]|INITIAL_TIME_MS|INITIAL_SPEED|\.timeLeft[^A-Za-z]" --include="*.ts" --include="*.tsx" . | grep -v node_modules returns no matches</verify>
  <done>rank -> operatorRank, timing constants renamed.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] `npm run test:run` passes all tests
- [ ] grep "gooptris_save_v1" returns no matches (storage key updated)
- [ ] grep "powerUpPoints" returns no matches
- [ ] grep "totalScore" returns no matches (in SaveData context)
- [ ] grep "INITIAL_TIME_MS|INITIAL_SPEED" returns no matches
- [ ] App loads with fresh/default save data (old saves ignored)
- [ ] Score displays correctly in UI
- [ ] Rank progression works correctly
- [ ] Upgrades can be purchased with scraps
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Zero references to old terms (in game context)
- Tests pass
- TypeScript compiles clean
- Storage key is 'gooptris_save_v2'
- SaveData interface uses new property names
</success_criteria>

<output>
After completion, create `.planning/phases/23-code-rename/23-05-SUMMARY.md`

Note in summary: This plan triggered a SAVE RESET. Players with existing saves
will start fresh due to storage key change from v1 to v2.
</output>
