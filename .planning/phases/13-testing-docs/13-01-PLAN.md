---
phase: 13-testing-docs
plan: 01
type: execute
---

<objective>
Expand test coverage to cover coordinate transform edge cases and minigame state logic.

Purpose: Ensure refactored coordinate system and extracted minigame hooks have test coverage to prevent regressions.
Output: New test file(s) with 15-20 additional tests covering edge cases and state transitions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Codebase context
@.planning/codebase/TESTING.md
@.planning/codebase/CONVENTIONS.md

# Prior phase context (coordinate transform utilities)
@.planning/phases/08-quick-wins/08-01-SUMMARY.md

# Existing test files (follow patterns)
@tests/coordinateTransform.test.ts
@tests/gameLogic.test.ts

# Source files to test
@types/minigames.ts
@utils/coordinateTransform.ts

**Tech stack available:** Vitest 4.0.17, TypeScript strict mode
**Established patterns:** describe/it blocks, factory helpers, no beforeEach
**Current test count:** 81 tests (must maintain passing)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add coordinate transform edge case tests</name>
  <files>tests/coordinateTransform.test.ts</files>
  <action>Add tests for edge cases not currently covered:

  1. **Boundary wrapping tests:**
     - visualToGrid with offset exactly at TOTAL_WIDTH boundary
     - visualToGrid with large negative offsets (-30, -60)
     - visualToGrid with large positive offsets (60, 90)

  2. **clientToSvg function tests:** (currently untested)
     - Test with mock CTM matrix
     - Test identity transform case

  3. **svgToVisual edge cases:**
     - Test at exact VIEWBOX boundaries (x at VIEWBOX.x, x at VIEWBOX.x + VIEWBOX.w)
     - Test y values at top and bottom bounds

  4. **Precision tests:**
     - Verify roundtrip conversions maintain precision within 0.001
     - Test fractional column values

  Follow existing test patterns:
  - describe() blocks grouped by function
  - it() with descriptive names explaining scenario
  - expect() with appropriate matchers

  Do NOT test clientToSvg with actual DOM (it uses getScreenCTM) - focus on testable pure functions.</action>
  <verify>npm run test:run passes, new tests show in output</verify>
  <done>8-10 new coordinate transform edge case tests added, all pass</done>
</task>

<task type="auto">
  <name>Task 2: Add minigame state logic tests</name>
  <files>tests/minigameLogic.test.ts</files>
  <action>Create new test file for minigame state logic. Test the PURE LOGIC portions that can be tested without React hooks:

  1. **LIGHTS_BUTTON_COLORS constant:**
     - Verify all 3 buttons have distinct colors
     - Verify colors are valid hex strings

  2. **CORNER_ANGLES constant:**
     - Verify 4 corners defined
     - Verify angles are in expected positions (45, 135, 225, 315)

  3. **DIAL_SNAP_POSITIONS constant:**
     - Verify matches CORNER_ANGLES
     - Verify sorted order

  4. **Type validation tests (compile-time guarantees):**
     - SliderPosition accepts only -1, 0, 1
     - LightsButtonIndex accepts only 0, 1, 2
     - CornerIndex accepts only 0, 1, 2, 3
     - LightsPhase has expected values

  5. **Minigame state shape tests:**
     - LaserComplicationState has required fields
     - LightsComplicationState has required fields
     - ControlsComplicationState has required fields

  Import from '../types/minigames' - test the exported constants and type shapes.

  Note: Do NOT test React hooks directly (useLaserMinigame, etc.) - those require React Testing Library which is not in the current stack. Focus on pure type/constant validation.</action>
  <verify>npm run test:run passes with new test file</verify>
  <done>New minigameLogic.test.ts with 8-10 tests for constants and type shapes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` shows all tests passing
- [ ] Test count increased from 81 to ~97-101
- [ ] No TypeScript errors in new test files
- [ ] New tests follow existing conventions (describe/it structure)
</verification>

<success_criteria>

- 15-20 new tests added across both task files
- All 81 existing tests still pass
- New tests cover documented edge cases
- Test patterns match existing conventions
</success_criteria>

<output>
After completion, create `.planning/phases/13-testing-docs/13-01-SUMMARY.md`:

# Plan 13-01 Summary: Test Coverage Expansion

**[One-liner about what tests were added]**

## Accomplishments

- [New test counts per file]
- [Edge cases now covered]

## Files Created/Modified

- `tests/coordinateTransform.test.ts` - Added X edge case tests
- `tests/minigameLogic.test.ts` - New file with Y tests

## Decisions Made

[Any test approach decisions]

## Issues Encountered

[Any issues or "None"]

## Next Step

Ready for 13-02-PLAN.md (Documentation Updates)
</output>
