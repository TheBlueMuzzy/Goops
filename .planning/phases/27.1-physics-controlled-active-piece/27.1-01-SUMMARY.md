---
phase: 27.1-physics-controlled-active-piece
plan: 01
subsystem: physics
tags: [verlet, soft-body, falling, collision-detection]

# Dependency graph
requires:
  - phase: 27-active-piece-physics
    provides: Blob creation for active pieces with active-{timestamp} ID convention
provides:
  - SoftBlob.isColliding property for lock timer signaling
  - stepActivePieceFalling function for physics-owned falling motion
  - gridCells copy in blob factory (physics can mutate)
affects: [27.1-02, useSoftBodyPhysics, GameEngine]

# Tech tracking
tech-stack:
  added: []
  patterns: [visualOffsetY falling pattern from Proto-9]

key-files:
  created: []
  modified:
    - core/softBody/types.ts
    - core/softBody/blobFactory.ts
    - core/softBody/physics.ts

key-decisions:
  - "Used isColliding instead of canFallMore - clearer name for consumers"
  - "gridCells copied in factory so physics can mutate without affecting input"
  - "stepActivePieceFalling not wired up yet - Plan 02 handles integration"

patterns-established:
  - "visualOffsetY pattern: accumulate sub-cell offset, wrap at CELL_SIZE"
  - "Physics signals GameEngine via blob properties (isColliding), not callbacks"

issues-created: []

# Metrics
duration: 5min
completed: 2026-02-05
---

# Phase 27.1-01: Port Proto-9 Falling Pattern Summary

**Physics system extended with stepActivePieceFalling function and isColliding property for smooth falling with grid collision detection**

## Performance

- **Duration:** 5 min
- **Started:** 2026-02-05T15:00:00Z
- **Completed:** 2026-02-05T15:05:00Z
- **Tasks:** 3
- **Files modified:** 3

## Accomplishments
- Extended SoftBlob interface with isColliding property for lock timer signaling
- Updated blob factory to copy gridCells and initialize isColliding
- Implemented stepActivePieceFalling with Proto-9's visualOffsetY pattern

## Task Commits

Each task was committed atomically:

1. **Task 1: Extend SoftBlob type with falling properties** - `b6cdd66` (feat)
2. **Task 2: Update blob creation to initialize falling properties** - `1655ea8` (feat)
3. **Task 3: Implement stepActivePieceFalling in physics** - `da47d81` (feat)

## Files Created/Modified
- `core/softBody/types.ts` - Added isColliding property to SoftBlob interface
- `core/softBody/blobFactory.ts` - Initialize isColliding:false, copy gridCells array
- `core/softBody/physics.ts` - Added stepActivePieceFalling function (79 lines)

## Decisions Made
- Used `isColliding` instead of `canFallMore` - clearer name for GameEngine consumers
- gridCells is now copied in factory so physics can mutate during falling without affecting input
- Function not wired up to stepPhysics - Plan 02 will handle integration with GameEngine

## Deviations from Plan

None - plan executed exactly as written

## Issues Encountered
None

## Next Phase Readiness
- stepActivePieceFalling function ready for integration
- GameEngine can read blob.isColliding to trigger lock timer
- Plan 02 will wire up the falling physics to useSoftBodyPhysics hook

---
*Phase: 27.1-physics-controlled-active-piece*
*Completed: 2026-02-05*
