# Plan 02-02: Reset Lights Logic

## Goal

Implement the Lights Out puzzle for Reset Lights minigame: 3 buttons toggle 3 lights, then slider validation.

## Prerequisites

- Plan 02-01 complete (shake animation defined)

## Implementation Steps

### Step 1: Add complication state structure

```tsx
interface LightsComplication {
    active: boolean;
    solved: boolean;
    lights: [boolean, boolean, boolean]; // L1, L2, L3 on/off state
    buttonPhaseComplete: boolean; // all lights on?
    sliderTarget: 1 | -1; // random top or bottom
}

const [lightsComplication, setLightsComplication] = useState<LightsComplication>({
    active: false,
    solved: false,
    lights: [false, false, false],
    buttonPhaseComplete: false,
    sliderTarget: 1
});
```

### Step 2: Implement button toggle logic

Toggle pattern (from user clarification):
- B1 → toggles L1 and L2
- B2 → toggles L2 and L3
- B3 → toggles L1 and L3

```tsx
const handleLightButton = (buttonIndex: 0 | 1 | 2) => {
    if (!lightsComplication.active || lightsComplication.solved) return;

    setLightsComplication(prev => {
        const newLights = [...prev.lights] as [boolean, boolean, boolean];

        if (buttonIndex === 0) { // B1
            newLights[0] = !newLights[0];
            newLights[1] = !newLights[1];
        } else if (buttonIndex === 1) { // B2
            newLights[1] = !newLights[1];
            newLights[2] = !newLights[2];
        } else { // B3
            newLights[0] = !newLights[0];
            newLights[2] = !newLights[2];
        }

        const allOn = newLights.every(l => l);
        return {
            ...prev,
            lights: newLights,
            buttonPhaseComplete: allOn
        };
    });
};
```

### Step 3: Control indicator lights

3 lights in Reset Lights section:
- Complication inactive: all black
- Complication active: orange if on, black if off (based on lights state)

When buttonPhaseComplete becomes true:
- One slider indicator light turns on (the sliderTarget position: top or bottom)

### Step 4: Handle slider validation

When light slider position changes:
- If not buttonPhaseComplete → ignore/no effect
- If buttonPhaseComplete:
  - If slider matches sliderTarget → solved!
  - If slider doesn't match → shake the slider handle

### Step 5: Random activation state

Activation should:
1. Randomize starting lights (ensuring solvable - any state is solvable in Lights Out)
2. Randomize sliderTarget (1 or -1)

```tsx
const activateLightsComplication = () => {
    setLightsComplication({
        active: true,
        solved: false,
        lights: [
            Math.random() > 0.5,
            Math.random() > 0.5,
            Math.random() > 0.5
        ],
        buttonPhaseComplete: false,
        sliderTarget: Math.random() > 0.5 ? 1 : -1
    });
};
```

### Step 6: Text color

Reset Lights label text color:
- TEAL when `!active`
- RED when `active && !solved`
- GREEN when `active && solved`

## SVG Element Details

**Reset Lights button indicator lights** (Art.tsx lines 577-611):
- Light below Blue button: x=546.19, y≈1547, currently `fill="#d8672b"` (on)
- Light below Green button: x=554.61, y≈1616, currently `fill="#231f20"` (off)
- Light below Purple button: x=565.12, y≈1689, currently `fill="#d8672b"` (on)

**Reset Lights slider indicator lights** (Art.tsx lines 557-566):
- Bottom light: x=382.12, y≈1706, currently `fill="#231f20"` (off)
- Top light: x=382.12, y≈1489, currently `fill="#d8672b"` (on)

**Color values**:
- Orange on: `fill="#d8672b"`
- Black off: `fill="#231f20"`

**Button toggle behavior**: Arcade buttons have press animation but currently no toggle state. Need to add visual toggle (body color change or additional indicator).

## Testing

- Activate → random lights on, some buttons solve it, some make it worse
- Press B1 → L1 and L2 toggle
- All lights on → slider indicator lights up
- Move slider to match → solved (green)
- Move slider wrong → shake

## Files to Modify

- `components/Art.tsx` — complication state, button handlers, light control, slider validation
