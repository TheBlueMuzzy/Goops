# Plan 02-01: Reset Laser Logic

## Goal

Implement puzzle logic for the Reset Laser minigame: 4 sliders that must match 4 indicator light positions.

## Prerequisites

- Phase 1 complete (dial rotation working)
- Slider UI already functional (snaps to -1, 0, 1)

## Implementation Steps

### Step 1: Add missing @keyframes shake

The `shake-anim` class references `@keyframes shake` but it's never defined. Add to GameBoard.tsx styled block:

```css
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
    20%, 40%, 60%, 80% { transform: translateX(2px); }
}
```

### Step 2: Add complication state structure

In Art.tsx, add state for Reset Laser complication:

```tsx
interface LaserComplication {
    active: boolean;
    solved: boolean;
    targets: (1 | 0 | -1)[]; // 4 target positions for indicators
}

const [laserComplication, setLaserComplication] = useState<LaserComplication>({
    active: false,
    solved: false,
    targets: [0, 0, 0, 0]
});
```

### Step 3: Control indicator lights

Find the 4 Reset Laser indicator light elements in SVG. Set their fill color based on:
- Complication inactive: black (off)
- Complication active: orange for target positions that match slider, black otherwise

Wait - re-reading PRD: "4 indicator lights randomize (on/off)" means each light is either on or off, not matching slider positions. The light indicates where the slider SHOULD be.

Revised logic:
- Each indicator light is on (orange) or off (black)
- Slider position must match: light on = slider at 1 (top), light off = slider at -1 (bottom)? Or middle?

Need to check PRD for exact mapping.

### Step 4: Check if solved

On each slider change, check if all 4 sliders match their target indicator:
- If indicator is on → slider should be at 1 (top)
- If indicator is off → slider should be at -1 (bottom)
- When all match → set `solved: true`

### Step 5: Shake on wrong position

When slider position changes, if it doesn't match indicator, add shake animation to that slider handle.

### Step 6: Text color

Reset Laser label text color:
- TEAL (#14b8a6) when `!active`
- RED (#ef4444) when `active && !solved`
- GREEN (#22c55e) when `active && solved`

### Step 7: Test function for activation

Add temporary test function to activate complication with random targets:

```tsx
const activateLaserComplication = () => {
    setLaserComplication({
        active: true,
        solved: false,
        targets: Array.from({ length: 4 }, () => Math.random() > 0.5 ? 1 : -1)
    });
};
```

## SVG Element Details

**Reset Laser indicator lights** (Art.tsx lines 499-526):
- 4 groups of paired lights, one per slider pair
- Each group has 2 path elements - inner fill determines on/off
- Orange on: `fill="#d8672b"`
- Black off: `fill="#231f20"`

Current hardcoded positions at y=207.9 and y=298.78 rows:
- Lights at x≈63.6 and x≈280.92 (left slider pair)
- Lights at x≈336.96 and x≈554.28 (right slider pair)

**Mapping to slider positions**: Need to determine from PRD whether light=on means slider should be at top (1) or if there's a different mapping.

## Testing

- Activate complication → indicators light up with random pattern
- Move sliders → shake if wrong, no shake if correct
- All sliders correct → text turns green, complication solved
- Deactivate → all lights off, text teal

## Files to Modify

- `components/GameBoard.tsx` — add @keyframes shake
- `components/Art.tsx` — complication state, indicator control, shake logic
