---
phase: 16-junk-band
plan: 01
type: execute
---

<objective>
Implement JUNK_UNIFORMER upgrade effect and verify Orange color integration at rank 10.

Purpose: Starting junk becomes more uniform (same color bias) with upgrade, and Orange color is available at rank 10+.
Output: Modified `createInitialGrid()` with upgrade-aware color selection, verified Orange in palette.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-onboarding-band/15-04-SUMMARY.md

**Key files:**
@utils/gameLogic.ts (createInitialGrid, getPaletteForRank)
@constants.ts (UPGRADES.JUNK_UNIFORMER)

**From STATE.md:**
- JUNK_UNIFORMER: +10% same-color chance per level (4 levels = 40% max bias)
- Orange unlocks at rank 10 (already in getPaletteForRank)

**Existing junk logic (gameLogic.ts:45-84):**
- Spawns 5-11 single-block junk at bottom row based on rank
- Each junk block gets random color from palette
- JUNK_UNIFORMER should bias toward picking same color repeatedly

**Implementation approach:**
- Add powerUps parameter to createInitialGrid
- First junk block picks random color as "anchor"
- Subsequent blocks: (uniformerLevel * 10)% chance to match anchor, else random
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add JUNK_UNIFORMER effect to createInitialGrid</name>
  <files>utils/gameLogic.ts</files>
  <action>
Modify createInitialGrid(rank, powerUps?) to accept optional powerUps parameter:

1. Extract JUNK_UNIFORMER level: `const uniformerLevel = powerUps?.['JUNK_UNIFORMER'] || 0;`

2. Calculate bias chance: `const biasChance = uniformerLevel * 0.10;` (0%, 10%, 20%, 30%, 40%)

3. In junk spawning loop:
   - First block: pick random color as `anchorColor`
   - Subsequent blocks:
     ```
     const useAnchor = Math.random() < biasChance;
     const color = useAnchor ? anchorColor : palette[Math.floor(Math.random() * palette.length)];
     ```

4. Update call sites in GameEngine.ts (constructor and startRun) to pass powerUps
  </action>
  <verify>Run `npm run test:run` - all 110+ tests pass. Manual: At rank 10+ with JUNK_UNIFORMER level 4, junk should be mostly same color.</verify>
  <done>createInitialGrid accepts powerUps, JUNK_UNIFORMER level 4 produces ~40% same-color bias in starting junk</done>
</task>

<task type="auto">
  <name>Task 2: Verify Orange color integration at rank 10</name>
  <files>utils/gameLogic.ts, constants.ts</files>
  <action>
Verify existing implementation works correctly:

1. Check getPaletteForRank already includes Orange at rank 10+ (line 21: `if (rank >= 10) palette.push(COLORS.ORANGE);`)

2. Check COLORS.ORANGE is defined (constants.ts:350: `ORANGE: '#f97316'`)

3. Add a simple test or console.log verification that getPaletteForRank(10) returns 5 colors including orange

4. Ensure starting junk at rank 10+ can spawn orange blocks (it should work automatically since createInitialGrid uses getPaletteForRank)

No code changes needed if everything is already correct - just verification.
  </action>
  <verify>Run `npm run test:run`. Add temporary console.log in createInitialGrid to verify palette.length === 5 at rank 10.</verify>
  <done>Orange color confirmed working at rank 10+, palette includes all 5 colors, junk can be orange</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] createInitialGrid signature updated with optional powerUps
- [ ] JUNK_UNIFORMER effect produces visible color bias in junk
- [ ] Orange color appears in palette at rank 10
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- JUNK_UNIFORMER upgrade has tangible effect on starting junk colors
</success_criteria>

<output>
After completion, create `.planning/phases/16-junk-band/16-01-SUMMARY.md`
</output>
