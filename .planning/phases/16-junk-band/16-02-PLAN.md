---
phase: 16-junk-band
plan: 02
type: execute
---

<objective>
Implement GOOP_SWAP upgrade effect to reduce swap timing from 1.5s base to 0.5s at max level.

Purpose: Players with GOOP_SWAP upgrade can swap falling goop with stored goop faster.
Output: Hold-to-swap duration respects upgrade level, base time adjusted to 1.5s per PRD.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

**Key files:**
@hooks/useInputHandlers.ts (HOLD_DURATION constant, hold-to-swap logic)
@constants.ts (UPGRADES.GOOP_SWAP)
@Game.tsx (passes powerUps to components)

**Current state:**
- HOLD_DURATION = 1000ms (1.0s fixed)
- HOLD_DELAY = 250ms (0.25s delay before hold starts)

**PRD spec for GOOP_SWAP:**
- Base: 1.5s swap time
- Per level: -0.25s (1.5, 1.25, 1.0, 0.75, 0.5)
- Max level (4): 0.5s swap time

**Implementation approach:**
- Change HOLD_DURATION from constant to function of powerUps
- Pass powerUps from Game.tsx through to useInputHandlers
- Calculate: `1500 - (level * 250)` ms
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update useInputHandlers to accept powerUps and calculate swap duration</name>
  <files>hooks/useInputHandlers.ts, types/input.ts</files>
  <action>
1. Add powerUps to UseInputHandlersParams interface:
   ```typescript
   interface UseInputHandlersParams {
       callbacks: InputCallbacks;
       boardOffset: number;
       grid: (GridCell | null)[][];
       pressureRatio: number;
       powerUps?: Record<string, number>; // NEW
   }
   ```

2. Update useInputHandlers function signature to destructure powerUps

3. Calculate dynamic HOLD_DURATION:
   ```typescript
   const BASE_HOLD_DURATION = 1500; // 1.5s base (PRD spec)
   const goopSwapLevel = powerUps?.['GOOP_SWAP'] || 0;
   const holdDuration = BASE_HOLD_DURATION - (goopSwapLevel * 250); // Min 500ms at level 4
   ```

4. Replace hardcoded HOLD_DURATION (1000) in setInterval progress calculation with dynamic holdDuration:
   - Line 165: `const progress = Math.min(100, (effectiveElapsed / holdDuration) * 100);`

Note: HOLD_DELAY (250ms) stays constant - that's the initial delay before hold indicator starts filling.
  </action>
  <verify>Run `npm run test:run`. Manual test: hold-to-swap should take 1.5s with no upgrade, 0.5s at level 4.</verify>
  <done>useInputHandlers accepts powerUps, swap duration scales from 1.5s to 0.5s based on GOOP_SWAP level</done>
</task>

<task type="auto">
  <name>Task 2: Pass powerUps from Game.tsx to useInputHandlers</name>
  <files>Game.tsx, components/GameBoard.tsx</files>
  <action>
1. In Game.tsx, find where useInputHandlers is called (likely in GameBoard.tsx)

2. Thread powerUps prop through:
   - Game.tsx already has powerUps prop
   - Pass powerUps to GameBoard as prop
   - GameBoard passes to useInputHandlers

3. Update GameBoard props interface if needed to accept powerUps

4. Verify the data flow: App.tsx -> Game.tsx -> GameBoard.tsx -> useInputHandlers

This ensures the upgrade level is available where the hold timer runs.
  </action>
  <verify>Run `npm run test:run`. Check that GameBoard receives powerUps prop and passes to useInputHandlers.</verify>
  <done>powerUps flows from Game.tsx through GameBoard to useInputHandlers, GOOP_SWAP effect active</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] No TypeScript errors
- [ ] Default swap time is 1.5s (with no upgrade)
- [ ] Level 4 GOOP_SWAP reduces swap time to 0.5s
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- GOOP_SWAP upgrade has tangible effect on hold-to-swap duration
- Base swap time matches PRD (1.5s, not 1.0s)
</success_criteria>

<output>
After completion, create `.planning/phases/16-junk-band/16-02-SUMMARY.md`
</output>
