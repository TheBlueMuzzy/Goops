---
phase: 33-rank-0-training-sequence
plan: 04
type: execute
---

<objective>
Build the training HUD (scenario title, objective, progress indicator) and wire TutorialOverlay's highlight system, then verify the full training flow end-to-end.

Purpose: The training scenarios need visual context — the player should see what scenario they're on, what the objective is, and their progress through training. The highlight system (built but commented out in Phase 31) needs activation so the overlay can draw attention to specific UI elements during training.

Output: Training HUD component, wired highlight system, verified end-to-end training flow
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/31-tutorial-infrastructure/31-03-SUMMARY.md
@.planning/phases/33-rank-0-training-sequence/33-01-SUMMARY.md
@.planning/phases/33-rank-0-training-sequence/33-02-SUMMARY.md
@.planning/phases/33-rank-0-training-sequence/33-03-SUMMARY.md

# Relevant source files:
@src/components/TutorialOverlay.tsx
@src/components/Game.tsx
@src/hooks/useTrainingFlow.ts
@src/data/trainingScenarios.ts
@src/types/training.ts

**Established patterns:**
- TutorialOverlay at z-90, non-blocking, fade transitions
- Phase 31 built highlight area infrastructure (commented out clip-path cutout)
- Typography: t-body (18px), t-heading (24px), t-title (28px)
- Mobile-optimized: 48px touch targets, isMobile conditional rendering

**Constraining decisions:**
- Phase 32: 18px minimum body text, CSS !important classes
- Phase 31: Overlay is non-blocking (player can still interact with game underneath)
- Phase 33-01: TrainingScenario has name, objective, order fields
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build training HUD overlay</name>
  <files>src/components/TrainingHUD.tsx, src/components/Game.tsx</files>
  <action>
Create a new `TrainingHUD` component that displays during training scenarios:

1. **Layout**: Fixed position overlay at top of screen (below intercom messages, above game). Not blocking gameplay — translucent background strip.

2. **Content**:
   - Scenario name: "Training 1/6: Tank Rotation" (from currentScenario.order and currentScenario.name)
   - Objective text: "Seal 2 cracks by rotating the tank" (from currentScenario.objective)
   - Progress dots: 6 dots showing completed (filled) vs upcoming (outline) scenarios

3. **Styling**:
   - Use t-meta (14px) for scenario label
   - Use t-body (18px) for objective text
   - Progress dots: 8px circles, filled = completed, outline = upcoming, current = pulsing
   - Background: semi-transparent dark strip (rgba(0,0,0,0.6))
   - Position: top of screen, full width, ~60px tall
   - z-index: 85 (below TutorialOverlay at 90, above game)

4. **Props**: `scenario: TrainingScenario`, `completedCount: number`, `totalCount: number`

5. **Wire into Game.tsx**: Show TrainingHUD only when `isInTraining` is true. Pass currentScenario from useTrainingFlow.

Keep it simple — no animations except the pulsing current dot (CSS animation). This is a subtle persistent HUD, not a flashy overlay.
  </action>
  <verify>Run `npm run test:run` — all tests pass, no TS errors</verify>
  <done>TrainingHUD component renders scenario name, objective, and progress dots. Visible during training only. Styled with project typography system.</done>
</task>

<task type="auto">
  <name>Task 2: Wire TutorialOverlay highlight system</name>
  <files>src/components/TutorialOverlay.tsx, src/hooks/useTutorial.ts</files>
  <action>
Enable the highlight area infrastructure that Phase 31 built (currently commented out):

1. **Uncomment the clip-path system** in TutorialOverlay.tsx. The highlight area creates a "cutout" in the overlay to draw attention to a specific UI element.

2. **Add highlight definitions** for training scenarios. Map tutorial step IDs to highlight regions:
   - ROTATE_INTRO: highlight the tank/game area (encourage swiping)
   - DROP_INTRO: highlight the piece preview area (show upcoming pieces)
   - No highlight for other steps (the intercom message is sufficient)

3. **Highlight regions** should be defined as `{ x: number, y: number, width: number, height: number }` in viewport-relative coordinates (percentages or pixels). The clip-path creates a rectangular cutout so the highlighted area is fully visible while the rest has a dark overlay.

4. **Behavior**: When a tutorial step has a highlight region defined, the overlay dims everything EXCEPT the highlighted area. When no highlight is defined, the overlay is transparent (non-blocking, as currently implemented).

Keep the highlight system simple — rectangular cutouts only, no complex shapes. If the Phase 31 infrastructure uses a different approach (e.g., CSS clip-path with inset), follow that pattern rather than creating a new one.

If the commented-out code is minimal/incomplete, implement the simplest version: a CSS clip-path polygon that creates a rectangular hole in a full-screen semi-transparent overlay.
  </action>
  <verify>Run `npm run test:run` — all tests pass, no TS errors</verify>
  <done>Highlight system active, ROTATE_INTRO and DROP_INTRO steps show highlighted regions, other steps render without highlight</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete rank 0 training sequence: 6 constrained scenarios with intercom messages, training HUD, highlight system, journal unlocks, and progression to rank 1</what-built>
  <how-to-verify>
    1. Clear localStorage (or use fresh browser profile) to start at rank 0
    2. Start the game — should enter Training 0TA (Tank Rotation)
    3. Verify: Training HUD shows "Training 1/6: Tank Rotation" with objective text
    4. Verify: Intercom message plays with garbled text and clear keywords
    5. Verify: Only mono pieces spawn, only 1 color, no time limit shown
    6. Rotate the tank, find and seal 2 cracks — scenario should complete
    7. Verify: Completion intercom plays, advances to 0TB
    8. Play through 0TB-0TE, checking constraints change per scenario
    9. Verify: 0TF has full 75s timer and 4-color palette
    10. After 0TF, verify player reaches rank 1 (or normal gameplay resumes)
    11. Open journal (? button) — verify pages unlocked as training progressed
    12. Verify: Training HUD progress dots filled in correctly throughout
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all existing tests
- [ ] No TypeScript errors
- [ ] TrainingHUD renders correctly during training
- [ ] Highlight system works for applicable steps
- [ ] Full training flow verified by human (checkpoint)
</verification>

<success_criteria>

- Training HUD visible and informative during all 6 scenarios
- Highlight system draws attention to relevant UI elements
- Full training sequence plays through end-to-end
- Journal pages unlock as scenarios complete
- Player graduates to normal gameplay after training
- Phase 33 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/33-rank-0-training-sequence/33-04-SUMMARY.md`
</output>
