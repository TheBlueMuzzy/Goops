---
phase: 09-art-decomposition
plan: 02
type: execute
---

<objective>
Extract useControlsMinigame hook and create minigame SVG rendering components.

Purpose: Complete hook extraction and create focused rendering components for each minigame panel's SVG elements.
Output: useControlsMinigame hook plus three SVG rendering components (LaserPanel, LightsPanel, ControlsPanel).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-art-decomposition/09-01-SUMMARY.md

**Key files:**
@components/Art.tsx (source file)
@types/minigames.ts (created in 09-01)
@hooks/useLaserMinigame.ts (created in 09-01)
@hooks/useLightsMinigame.ts (created in 09-01)

**Art.tsx SVG sections to extract:**
- Lines 994-1092: Reset Laser panel (top housing with sliders and lights)
- Lines 1094-1240: Reset Lights panel (right panel with buttons and slider)
- Lines 1241-1296: Reset Controls panel (dial area with corner lights)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract useControlsMinigame hook</name>
  <files>hooks/useControlsMinigame.ts</files>
  <action>
Create hook that encapsulates CONTROLS minigame state machine:

1. State:
   - controlsComplication: ControlsComplication (active, solved, targetCorner, completedCorners)
   - localDialRotation: number
   - isDialDragging: boolean
   - dialShaking: boolean
   - dialPressed: boolean

2. Extract functions from Art.tsx:
   - Initialization logic (lines 300-310): pick random corner when complication activates
   - Reset logic (lines 258-261): reset when complication removed
   - CORNER_ANGLES constant (line 228): [45, 315, 225, 135]
   - DIAL_SNAP_POSITIONS constant (line 414): [45, 135, 225, 315]
   - Dial coordinate constants (lines 314-323): DIAL_CENTER_X/Y, DIAL_RADIUS, etc.
   - screenToSvg (lines 348-369): convert screen to SVG coordinates
   - handleDialStart/Move/End (lines 371-474): drag handling with snapping
   - isDialAligned (lines 824-831): check if dial aligned with target
   - handleDialPress (lines 842-885): handle dial click/tap for alignment check
   - triggerDialShake (lines 836-840): shake feedback
   - getControlsCornerLightColor (lines 812-823): get corner indicator colors
   - getControlsTextState (lines 887-899): get "RESET CONTROLS" / "FIXED" text state

3. Parameters:
   - complications: Complication[]
   - isControlsMaxed: boolean
   - onResolveComplication: (id: string) => void

4. Return:
   - localDialRotation, isDialDragging, dialShaking, dialPressed
   - handleDialStart, handleDialMove, handleDialEnd, handleDialPress
   - getControlsCornerLightColor, getControlsTextState
   - CORNER_ANGLES (for rendering)

Import types from types/minigames.ts.
  </action>
  <verify>npm run test:run passes, hook file compiles, exports correct interface</verify>
  <done>hooks/useControlsMinigame.ts exists with complete CONTROLS state machine, all tests pass</done>
</task>

<task type="auto">
  <name>Task 2: Create LaserPanel component</name>
  <files>components/MiniGames/LaserPanel.tsx</files>
  <action>
Create SVG rendering component for Reset Laser panel:

1. Props interface:
   - laserSliders: (-1|0|1)[]
   - shakingSlider: number | null
   - onSliderChange: (index: number, value: -1|0|1) => void
   - getLaserLightColors: (index: number) => { left: string; right: string }
   - textState: { text: string; color: string }

2. Extract from Art.tsx lines 994-1092:
   - Background geometry (path elements)
   - Zig-zag texture patterns
   - ConsoleSlider components (4 sliders at positions)
   - Indicator light circles (8 lights, 2 per slider)
   - "RESET LASER" text

3. Import ConsoleSlider from existing location

4. Use shake-anim class for shaking slider feedback

Component renders inside a `<g transform="translate(17.28, 1057.14)">` wrapper (same as original).
  </action>
  <verify>npm run test:run passes, component compiles, no TypeScript errors</verify>
  <done>components/MiniGames/LaserPanel.tsx exists with complete SVG rendering, all tests pass</done>
</task>

<task type="auto">
  <name>Task 3: Create LightsPanel and ControlsPanel components</name>
  <files>components/MiniGames/LightsPanel.tsx, components/MiniGames/ControlsPanel.tsx</files>
  <action>
**LightsPanel.tsx** - Extract from Art.tsx lines 1094-1240:

1. Props interface:
   - lightsComplication phase, slider value
   - onSliderChange, onButtonPress/Release
   - getLightsButtonLightColor, getLightsSliderLightColors
   - textState: { text: string; color: string }
   - pressedBtn: string | null

2. Render:
   - Purple base polygon
   - Text state display
   - Slider with clip path
   - Three ArcadeButton components (blue, green, purple)
   - Button indicator lights
   - Slider indicator lights

**ControlsPanel.tsx** - Extract from Art.tsx lines 1241-1296:

1. Props interface:
   - localDialRotation: number
   - isDialDragging: boolean
   - dialShaking: boolean
   - dialPressed: boolean
   - onDialStart/Move/End, onDialPress
   - getControlsCornerLightColor: (index: 0|1|2|3) => string
   - textState: { text: string; color: string }

2. Render:
   - Dial with rotation transform
   - Corner light circles (4)
   - "RESET CONTROLS" text
   - Touch/mouse event handlers on dial group

Move ArcadeButton component to a shared location (components/MiniGames/ArcadeButton.tsx) since it's used by LightsPanel.
  </action>
  <verify>npm run test:run passes, both components compile, no TypeScript errors</verify>
  <done>LightsPanel.tsx and ControlsPanel.tsx exist with complete SVG rendering, all tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all 81 tests
- [ ] TypeScript compiles without errors
- [ ] hooks/useControlsMinigame.ts exports complete API
- [ ] components/MiniGames/LaserPanel.tsx renders correctly
- [ ] components/MiniGames/LightsPanel.tsx renders correctly
- [ ] components/MiniGames/ControlsPanel.tsx renders correctly
- [ ] components/MiniGames/ArcadeButton.tsx moved from Art.tsx
- [ ] Art.tsx unchanged (components not integrated yet)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Components are self-contained, ready for integration
</success_criteria>

<output>
After completion, create `.planning/phases/09-art-decomposition/09-02-SUMMARY.md`
</output>
