---
phase: 32-journal-system
plan: 02
type: execute
---

<objective>
Wire OperatorJournal into the app, replacing HowToPlay entirely. Connect journal unlock state to SaveData and tutorial progression.

Purpose: Make the journal the actual ? button destination throughout the app, with live unlock state from SaveData.
Output: Journal fully integrated — ? button opens journal from both MainMenu and ConsoleView, unlocked pages reflect actual tutorial progress.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-journal-system/32-01-SUMMARY.md

@App.tsx
@components/MainMenu.tsx
@components/ConsoleView.tsx
@components/HowToPlay.tsx
@components/OperatorJournal.tsx
@types.ts
@hooks/useTutorial.ts

**Tech stack available:** React, TypeScript, Tailwind
**Established patterns:** ViewState union type in App.tsx, onOpenHelp/onHowToPlay prop callbacks
**Constraining decisions:**
- Phase 31: SaveData.tutorialProgress.completedSteps is the source of truth
- Phase 32-01: OperatorJournal accepts `completedSteps: string[]` prop
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace HowToPlay with OperatorJournal in App.tsx</name>
  <files>App.tsx</files>
  <action>
In App.tsx:
1. Replace the `import { HowToPlay }` with `import { OperatorJournal }` from the new component.
2. In the conditional render block where `view === 'HOW_TO_PLAY'`, replace `<HowToPlay onBack={...} />` with `<OperatorJournal completedSteps={saveData.tutorialProgress.completedSteps} onBack={() => setView('GAME')} />`.
3. Keep the ViewState type as-is ('HOW_TO_PLAY' value is fine — it's internal state, renaming is unnecessary churn).
4. Do NOT delete HowToPlay.tsx yet — keep it as reference until Phase 38 cleanup. Just remove its import from App.tsx.

That's it. The existing `onHowToPlay` callbacks in MainMenu and `onOpenHelp` in ConsoleView already set the view state correctly — no changes needed in those files.
  </action>
  <verify>`npx tsc --noEmit` passes. Dev server renders OperatorJournal when ? button clicked from main menu.</verify>
  <done>? button from MainMenu opens OperatorJournal instead of HowToPlay. ? button from ConsoleView opens OperatorJournal. Back button returns to previous screen.</done>
</task>

<task type="auto">
  <name>Task 2: Add journal entry on tutorial step completion</name>
  <files>hooks/useTutorial.ts</files>
  <action>
The journal already reads from `saveData.tutorialProgress.completedSteps` which is written by useTutorial's `completeStep()` function. Verify this chain works end-to-end:

1. Read useTutorial.ts and confirm that `completeStep()` persists to SaveData via `setSaveData()`.
2. Confirm the SaveData state flows through App.tsx → OperatorJournal as `completedSteps` prop.
3. If the chain is already complete (it should be based on Phase 31 work), no code changes needed — just verify.
4. If there's a gap (e.g., SaveData not flowing to OperatorJournal), wire it up.

The key insight: journal pages unlock reactively. When a tutorial step is completed during gameplay, the next time the player opens the journal, the newly unlocked page will be visible. No "new page!" notification is needed in this phase (that's future polish in Phase 38).
  </action>
  <verify>Manually test: complete WELCOME step (auto-advances after 4s at rank 0), then open journal — verify no new pages unlock (WELCOME doesn't gate any page). This confirms the data flow works even if the visual result is unchanged for this particular step.</verify>
  <done>Data flow confirmed: tutorial step completion → SaveData persistence → journal unlock state. No gaps in the chain.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full journal integration — ? button opens OperatorJournal from both MainMenu and ConsoleView, with live unlock state from SaveData.</what-built>
  <how-to-verify>
    1. Run: `npm run dev -- --host`
    2. From Main Menu: Click ? button → should open OperatorJournal (NOT old HowToPlay)
    3. Verify: BASICS page shows, other pages are locked
    4. Click Back → returns to Main Menu
    5. Start a game at rank 0 → WELCOME intercom should fire
    6. Press W/Space to return to console → click ? in console → should open OperatorJournal
    7. Verify: Same unlock state visible from both entry points
    8. Mobile check: Open on phone or narrow viewport, verify layout works
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 32, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run test:run` passes (no regressions)
- [ ] ? button opens OperatorJournal from MainMenu
- [ ] ? button opens OperatorJournal from ConsoleView
- [ ] Journal shows correct unlock state based on SaveData
- [ ] HowToPlay.tsx still exists but is no longer imported
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors or test regressions
- Journal is the sole ? button destination
- Unlock state reflects actual tutorial progress
- Phase 32 complete
</success_criteria>

<output>
After completion, create `.planning/phases/32-journal-system/32-02-SUMMARY.md`
</output>
