---
phase: 10-gameboard-decomposition
plan: 03
type: execute
---

<objective>
Simplify GameBoard.tsx by extracting CSS animations and organizing remaining code.

Purpose: Final cleanup to achieve target line count and clear organization.
Output: GameBoard.tsx under 600 lines with clean structure.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summaries:
@.planning/phases/10-gameboard-decomposition/10-01-SUMMARY.md
@.planning/phases/10-gameboard-decomposition/10-02-SUMMARY.md

# Key source files:
@components/GameBoard.tsx

**Constraints:**
- All 81 tests must pass
- No gameplay changes
- Mobile optimizations must be preserved
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract CSS animations to separate file</name>
  <files>components/GameBoard.css, components/GameBoard.tsx</files>
  <action>
Create `components/GameBoard.css` with the CSS currently in the `style` useMemo (lines 338-388):

```css
/* Goop glow animations (desktop only) */
.glow-stroke { ... }
.super-glowing-stroke { ... }
@keyframes pulseGlow { ... }
@keyframes superGlowStroke { ... }

/* UI animations */
@keyframes shake { ... }
.shake-anim, .shake { ... }
@keyframes malfunctionPulse { ... }
.malfunction-pulse { ... }
@keyframes lightsDimIn { ... }
.lights-dimmed { ... }
```

Note: The current implementation uses JS to conditionally include desktop-only animations.
For the CSS file, use CSS media queries instead:
- Wrap desktop-only animations in `@media (min-width: 768px) { ... }`
- Or use a `.desktop-only` class approach

Then in GameBoard.tsx:
- Import './GameBoard.css' at the top
- Remove the `style` useMemo entirely
- Remove the `<style>{style}</style>` element from JSX
- The isMobile conditional for animations is handled by CSS media queries now

This removes ~50 lines from GameBoard.tsx.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>CSS extracted to separate file, no inline styles for animations</done>
</task>

<task type="auto">
  <name>Task 2: Final cleanup and organization</name>
  <files>components/GameBoard.tsx</files>
  <action>
Review and clean up GameBoard.tsx:

1. Verify imports are organized (React, types, constants, utils, components, CSS)
2. Ensure no unused imports after extractions
3. Add brief section comments for clarity:
   - // --- Props & State ---
   - // --- Derived Values ---
   - // --- Rendering ---

4. Verify the component structure is clear:
   - Props destructuring
   - Hook calls (useInputHandlers, useMemo for groups)
   - Derived calculations (pressure, water level)
   - JSX return

5. Count final lines - target is under 600 (from original 1,031)

Expected final structure (~550-600 lines):
- Imports: ~15 lines
- Interface: ~20 lines
- Component: ~550 lines
  - State/hooks: ~50 lines
  - Derived values: ~50 lines
  - Mask definitions: ~20 lines (mobile conditional)
  - JSX: ~400 lines (SVG with layers)
  </action>
  <verify>
1. `npm run test:run` — all 81 tests pass
2. `npx tsc --noEmit` — no TypeScript errors
3. Line count: `wc -l components/GameBoard.tsx` shows under 650 lines
  </verify>
  <done>GameBoard.tsx organized and under 600 lines</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Decomposed GameBoard.tsx from 1,031 to ~550-600 lines with extracted hooks and utilities</what-built>
  <how-to-verify>
    1. Run: `npm run dev -- --host`
    2. Open on phone or desktop browser
    3. Test tap to pop goop (works, shake feedback for invalid)
    4. Test drag left/right to rotate cylinder
    5. Test drag down for soft drop
    6. Test swipe up to open console
    7. Test hold-to-swap (circle fills, swap triggers)
    8. Verify HUD meters appear (left = laser, right = heat)
    9. Trigger a complication and verify malfunction alert pulses
    10. Verify goop animations work (fill, glow on desktop)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all 81 tests
- [ ] `npx tsc --noEmit` has no TypeScript errors
- [ ] GameBoard.tsx under 600 lines (target: 400 line reduction)
- [ ] Human verified all input and rendering works
</verification>

<success_criteria>

- CSS animations in separate file
- GameBoard.tsx under 600 lines (from 1,031)
- All 81 tests pass
- Human verified gameplay works
- Phase 10 complete
</success_criteria>

<output>
After completion, create `.planning/phases/10-gameboard-decomposition/10-03-SUMMARY.md` with:
- Line count before/after for GameBoard.tsx
- List of extracted files
- Summary of Phase 10 decomposition
</output>
