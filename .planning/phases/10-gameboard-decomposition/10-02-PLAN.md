---
phase: 10-gameboard-decomposition
plan: 02
type: execute
---

<objective>
Extract goop rendering utilities from GameBoard.tsx into dedicated modules.

Purpose: Isolate SVG path generation and group preparation logic into reusable, testable utilities.
Output: `utils/goopRenderer.ts` with path helpers and group building logic.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary:
@.planning/phases/10-gameboard-decomposition/10-01-SUMMARY.md

# Key source files:
@components/GameBoard.tsx
@utils/coordinateTransform.ts

**Constraints:**
- All 81 tests must pass throughout refactor
- No gameplay changes
- Follow existing utils pattern (pure functions)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract path generation utilities</name>
  <files>utils/goopRenderer.ts</files>
  <action>
Create `utils/goopRenderer.ts` with pure functions:

1. `getBlobPath(x, y, w, h, neighbors, radius = 8)` → string
   - Generates SVG path for a blob shape with rounded corners
   - neighbors: { t: boolean, r: boolean, b: boolean, l: boolean }
   - Connected edges get sharp corners, exposed edges get rounded
   - Copy existing implementation from GameBoard.tsx lines 392-408

2. `getContourPath(x, y, w, h, neighbors, radius = 8)` → string
   - Generates SVG path for group outline (exposed edges only)
   - Copy existing implementation from GameBoard.tsx lines 410-438

3. `RenderableCell` interface (move from GameBoard.tsx)
   - visX, y, screenX, screenY, width, cell, color, neighbors, isFalling

4. Export CORNER_RADIUS constant (currently RADIUS = 8 in GameBoard)

These are pure functions with no React dependencies - just math and string building.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Path utilities extracted, pure functions with clear interfaces</done>
</task>

<task type="auto">
  <name>Task 2: Extract group building logic</name>
  <files>utils/goopRenderer.ts, components/GameBoard.tsx</files>
  <action>
Add to `utils/goopRenderer.ts`:

1. `buildRenderableGroups(grid, boardOffset, fallingBlocks)` → Map<string, RenderableCell[]>
   - Extracts the `groups` useMemo logic from GameBoard.tsx lines 441-513
   - Builds map of groupId → RenderableCell[] for both static grid and falling blocks
   - Uses visXToScreenX from coordinateTransform.ts
   - Pure function, no React hooks

Parameters needed:
- grid: GridCell[][] (from GameState)
- boardOffset: number
- fallingBlocks: FallingBlock[]

Import BLOCK_SIZE, visXToScreenX from coordinateTransform.ts
Import VISIBLE_WIDTH, VISIBLE_HEIGHT, TOTAL_WIDTH, TOTAL_HEIGHT, BUFFER_HEIGHT from constants
Import normalizeX from utils/gameLogic

Then update GameBoard.tsx:
- Import buildRenderableGroups, getBlobPath, getContourPath from utils/goopRenderer
- Replace inline `groups` useMemo with call to buildRenderableGroups
- Remove getBlobPath and getContourPath function definitions
- Remove RADIUS constant (now CORNER_RADIUS in goopRenderer)
- Remove RenderableCell interface (now in goopRenderer)

This should remove ~120 lines from GameBoard.tsx.
  </action>
  <verify>
1. `npm run test:run` — all 81 tests pass
2. TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Group building extracted, GameBoard reduced by ~120 lines, all tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all 81 tests
- [ ] `npx tsc --noEmit` has no TypeScript errors
- [ ] GameBoard.tsx reduced by ~120 lines from Plan 1 result
- [ ] Goop rendering visually identical
</verification>

<success_criteria>

- goopRenderer.ts created with pure utility functions
- getBlobPath, getContourPath, buildRenderableGroups exported
- GameBoard.tsx reduced from ~830 to ~710 lines
- All 81 tests pass
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-gameboard-decomposition/10-02-SUMMARY.md`
</output>
