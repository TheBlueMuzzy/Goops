---
phase: 10-gameboard-decomposition
plan: 10-03-FIX
type: fix
---

<objective>
Fix 3 UAT issues from plan 10-03 (input handling bugs after CSS extraction).

Source: 10-03-ISSUES.md
Priority: 0 critical, 3 major, 0 minor

Root cause: Release after hold/drag incorrectly triggers tap/click.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/10-gameboard-decomposition/10-03-ISSUES.md

**Original plan for reference:**
@.planning/phases/10-gameboard-decomposition/10-03-PLAN.md

**Key source files:**
@hooks/useInputHandlers.ts
@hooks/useControlsMinigame.ts
@components/MiniGames/ControlsPanel.tsx
@components/GameBoard.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify fixes already applied</name>
  <files>hooks/useInputHandlers.ts, hooks/useControlsMinigame.ts, components/MiniGames/ControlsPanel.tsx, components/GameBoard.css</files>
  <action>
The fixes for all 3 bugs have already been implemented in the working tree (from the previous session):

1. **UAT-002 (useInputHandlers.ts)**: Line 276-277 added `if (dt >= HOLD_DELAY) return;`
2. **UAT-003 (useControlsMinigame.ts)**: Lines 96, 244-250, 368 added `justFinishedDraggingRef` logic
3. **UAT-003 (ControlsPanel.tsx)**: Removed broken local fix, now calls `onDialPress` directly
4. **UAT-001 (GameBoard.css)**: Shake animation uses `translate(x, y)` instead of `translateX(x)`

Verify these changes are present by reading the files. If any fix is missing, apply it.
  </action>
  <verify>
1. `git diff hooks/useInputHandlers.ts` shows HOLD_DELAY check
2. `git diff hooks/useControlsMinigame.ts` shows justFinishedDraggingRef
3. `git diff components/MiniGames/ControlsPanel.tsx` shows reverted to simple onDialPress
4. `npm run test:run` passes all 81 tests
  </verify>
  <done>All fixes verified present in working tree, tests pass</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed 3 input handling bugs:
- UAT-002: Early swap release no longer triggers rotate
- UAT-003: Controls dial click no longer fires after drag
- UAT-001: Shake animation improved (may still need investigation)
  </what-built>
  <how-to-verify>
    1. Run: `npm run dev -- --host`
    2. Open on phone or desktop browser

    **Test UAT-002 (Early swap release):**
    3. Touch empty area of game board
    4. Hold for ~500ms (watch progress circle start)
    5. Release (before 1s completes)
    6. Verify: Cylinder does NOT rotate
    7. Tap quickly on empty area
    8. Verify: Cylinder DOES rotate (quick taps still work)

    **Test UAT-003 (Controls dial click):**
    9. Play until CONTROLS complication triggers (heat meter reaches 100)
    10. Drag the dial to rotate it toward lit corner
    11. Release drag
    12. Verify: No immediate click fires (dial doesn't shake unless already aligned)
    13. Tap dial when aligned with lit corner
    14. Verify: Alignment is accepted, advances to next corner

    **Test UAT-001 (Shake animation):**
    15. Tap a goop block that is above the pressure line (near top)
    16. Verify: Block group should shake (may or may not work on SVG elements)

    **General regression check:**
    17. Verify tap-to-pop on valid blocks works
    18. Verify hold-to-swap (full 1s hold) works
    19. Verify horizontal drag rotates cylinder
    20. Verify all 3 minigames are playable
  </how-to-verify>
  <resume-signal>Type "approved" to commit fixes, or describe any remaining issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Commit bug fixes</name>
  <files>hooks/useInputHandlers.ts, hooks/useControlsMinigame.ts, components/MiniGames/ControlsPanel.tsx, components/GameBoard.css</files>
  <action>
Commit the bug fixes with a descriptive message.

Stage only the 4 modified files:
- hooks/useInputHandlers.ts
- hooks/useControlsMinigame.ts
- components/MiniGames/ControlsPanel.tsx
- components/GameBoard.css

Commit message format:
```
fix(10-03): resolve UAT input handling bugs

- UAT-002: Prevent rotate on early swap release (HOLD_DELAY check)
- UAT-003: Block click after dial drag (justFinishedDraggingRef)
- UAT-001: Improve shake animation CSS (translate vs translateX)
```
  </action>
  <verify>`git log -1` shows the commit</verify>
  <done>Bug fixes committed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 3 major issues verified fixed by human tester
- [ ] All 81 tests pass
- [ ] Changes committed to git
</verification>

<success_criteria>
- All UAT issues from 10-03-ISSUES.md addressed
- Tests pass
- Ready for Plan 10-03 completion (SUMMARY can be created)
</success_criteria>

<output>
After completion, create `.planning/phases/10-gameboard-decomposition/10-03-FIX-SUMMARY.md`
</output>
