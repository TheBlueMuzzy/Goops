# Plan 07-03: Upgrade UI Panel

## Objective

Create a new interactive upgrade panel on the console SVG where players can spend powerUpPoints on system upgrades.

Purpose: Let players actually purchase and see their upgrades.
Output: Functional upgrade UI integrated into the console.

## Execution Context

~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md

## Context

@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-system-upgrades/07-01-SUMMARY.md
@.planning/phases/07-system-upgrades/07-02-SUMMARY.md
@components/Art.tsx
@App.tsx
@types.ts

**Decision:** New dedicated panel on console (not the existing UPGRADES button/screen).

**Design Requirements:**
- Show all 3 system upgrades (LASER, LIGHTS, CONTROLS)
- Display current level (0-5) with visual indicator
- Show cost (1 point each)
- Show available points
- Purchase button (disabled if insufficient points or max level)
- Indicate max-level bonus when fully upgraded

**Console Layout:**
The console SVG has existing panels for minigames. The upgrade panel should fit the industrial aesthetic.

## Tasks

<task type="auto">
  <name>Task 1: Add upgrade state and handlers to App.tsx</name>
  <files>App.tsx</files>
  <action>
Add a purchase handler that:
1. Checks if player has sufficient powerUpPoints
2. Checks if upgrade is below max level
3. Deducts points and increments upgrade level
4. Saves to localStorage via setSaveData

```typescript
const handlePurchaseUpgrade = useCallback((upgradeId: string) => {
  setSaveData(prev => {
    const currentLevel = prev.powerUps[upgradeId] || 0;
    const maxLevel = 5;
    const cost = 1;

    if (prev.powerUpPoints < cost || currentLevel >= maxLevel) {
      return prev; // Can't purchase
    }

    return {
      ...prev,
      powerUpPoints: prev.powerUpPoints - cost,
      powerUps: {
        ...prev.powerUps,
        [upgradeId]: currentLevel + 1
      }
    };
  });
}, []);
```

Pass this handler and the powerUps state down to Game component.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>Purchase handler wired from App.tsx to Game</done>
</task>

<task type="auto">
  <name>Task 2: Create UpgradePanel component</name>
  <files>components/UpgradePanel.tsx</files>
  <action>
Create a new component that displays the 3 system upgrades:

```typescript
interface UpgradePanelProps {
  powerUpPoints: number;
  upgrades: Record<string, number>; // Current levels
  onPurchase: (upgradeId: string) => void;
}
```

Layout for each upgrade:
- Icon (wrench/gear for visual, or colored indicator matching system)
- Name (from SYSTEM_UPGRADE_CONFIG)
- Level indicator (5 pips, filled based on level)
- Cost display ("1 PWR")
- Purchase button (+ or "UPGRADE")

Style to match console aesthetic:
- Dark background with glow effects
- Industrial/retro typography
- Color-coded per system (LASER=red, LIGHTS=yellow, CONTROLS=blue)

This is a React component, not SVG. It can be rendered as an overlay on the console.
  </action>
  <verify>Component renders without errors</verify>
  <done>UpgradePanel component created with 3 upgrade displays</done>
</task>

<task type="auto">
  <name>Task 3: Integrate UpgradePanel into console UI</name>
  <files>Game.tsx, components/Art.tsx</files>
  <action>
Add a trigger to show the upgrade panel:
1. Add "SYSTEMS" button to console (can reuse existing button style or add new area)
2. When clicked, show UpgradePanel as a modal/overlay
3. Panel should have a close/back button

The panel appears when player is in Console phase (not during gameplay).

Position: Center of screen as modal, or slide-in panel from side.

Ensure panel shows:
- Available points at top
- All 3 upgrades with current levels
- Purchase buttons
- Close button
  </action>
  <verify>Panel opens from console, can purchase upgrades, points deduct correctly</verify>
  <done>Upgrade panel accessible from console, purchases work</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>System upgrade panel on console</what-built>
  <how-to-verify>
    1. Run: npm run dev -- --host
    2. Open game in browser
    3. On console screen, find and click the upgrade panel trigger
    4. Verify: Panel shows 3 upgrades (LASER, LIGHTS, CONTROLS)
    5. Verify: Current levels displayed (should be 0 initially)
    6. Verify: Available points shown at top
    7. If you have points (use dev rank selector to get some), try purchasing
    8. Verify: Points deduct, level increases
    9. Verify: Can close panel and return to console
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

## Verification

Before declaring plan complete:
- [ ] `npm run test:run` passes
- [ ] Upgrade panel accessible from console
- [ ] All 3 upgrades displayed correctly
- [ ] Purchase flow works (points deduct, level increments)
- [ ] Max level prevents further purchases

## Success Criteria

- All tasks completed
- All verification checks pass
- Human verified upgrade panel works

## Output

After completion, create `.planning/phases/07-system-upgrades/07-03-SUMMARY.md`
