---
phase: 01-dial-rotation
plan: 01
type: execute
---

<objective>
Make the Reset Controls dial spin when dragged near its edge.

Purpose: Complete the dial UI element so it's interactive like the sliders, ready for minigame logic in Phase 2.
Output: Dial responds to drag gestures near its edge, rotates smoothly, feels natural on mobile.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@components/Art.tsx
@components/ConsoleView.tsx

**Dial specs (from Art.tsx lines 454-472):**
- Center: (194.32, 1586.66) in SVG coordinates
- Radius: 86.84
- Current: onClick={onDialClick}, dialRotation prop hardcoded to 0
- Has curved arrow indicator at edge (serves as drag zone hint)

**Patterns to follow:**
- Periscope drag: ConsoleView.tsx lines 32-99 (isDragging, startY, handleStart/Move/End)
- Slider state: Art.tsx lines 130-131 (local state for UI elements)

**Decisions from roadmap:**
- Edge-only drag (outer ~30% of radius) — natural arc feel
- No click-to-rotate — requires active dragging
- Existing curved arrow serves as visual indicator
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dial rotation state and drag handlers</name>
  <files>components/Art.tsx</files>
  <action>
Add local state for dial rotation following slider pattern:
```
const [dialRotation, setDialRotation] = useState(0);
const [isDialDragging, setIsDialDragging] = useState(false);
const dialStartAngle = useRef(0);
const dialStartRotation = useRef(0);
```

Add helper function to calculate angle from pointer position to dial center:
- Dial center in SVG coords: (194.32, 1586.66)
- Use Math.atan2(dy, dx) to get angle in radians, convert to degrees
- Need to account for SVG coordinate transform (the dial is inside a translated group at y=1057.14 for the console top)

Add drag handlers similar to periscope pattern:
- handleDialStart(clientX, clientY): Set dragging true, store starting angle and current rotation
- handleDialMove(clientX, clientY): Calculate new angle, compute delta, update rotation
- handleDialEnd(): Set dragging false

Apply handlers to the dial group (lines 455-472):
- onMouseDown, onTouchStart → handleDialStart
- Need global mousemove/touchmove/mouseup/touchend listeners (add useEffect like periscope)

Remove the onClick={onDialClick} — we're replacing click with drag.
Remove dialRotation prop usage — use local state instead.

IMPORTANT: The SVG viewBox is "0 827.84 648 1152" and the dial center is at (194.32, 1586.66) in SVG coordinates. Must convert client coordinates to SVG coordinates before calculating angle. Use getBoundingClientRect() on the SVG element and scale appropriately.
  </action>
  <verify>npm run test:run passes, dial renders without errors, dragging anywhere on dial causes rotation (edge detection comes in Task 2)</verify>
  <done>Dial rotates when dragged, state is local to Art.tsx, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Implement edge-only drag zone</name>
  <files>components/Art.tsx</files>
  <action>
In handleDialStart, add edge-zone check before allowing drag to begin:
- Calculate distance from pointer to dial center
- Dial radius: 86.84
- Edge zone: outer 30% = distance must be >= 86.84 * 0.7 (about 60.8) AND <= 86.84
- If pointer is too close to center (< 60.8 from center), don't start drag (return early)
- If pointer is outside dial (> 86.84 from center), don't start drag

This ensures:
- Dragging near center does nothing (avoids the "fast rotation" feel the user was concerned about)
- Dragging on the curved arrow area (edge) works as expected
- Natural arc-following gesture

Also add cursor feedback:
- When hovering in edge zone: cursor should indicate draggable (cursor: 'grab')
- When dragging: cursor: 'grabbing'
- When hovering center: cursor: 'default' (or keep pointer)

AVOID: Adding new visual elements — the curved arrow already indicates the drag zone.
  </action>
  <verify>npm run test:run passes, dragging center of dial does nothing, dragging edge of dial rotates it</verify>
  <done>Edge-only drag works — center ignored, edge responds, cursor changes appropriately</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dial rotation with edge-only drag zone</what-built>
  <how-to-verify>
    1. Run: npm run dev -- --host
    2. Open on phone (or use browser devtools mobile emulation)
    3. Navigate to console view (should be default view)
    4. Find the Reset Controls dial (orange dial with curved arrow and triangle pointer)
    5. Test edge drag:
       - Touch/click near the curved arrow (edge of dial)
       - Drag in a circular motion
       - Dial should rotate following your finger
    6. Test center rejection:
       - Touch/click near the center of the dial
       - Try to drag — dial should NOT respond
    7. Test rotation feel:
       - Does rotation feel natural? (1:1 with finger movement)
       - Is there any lag or jitter?
       - Does it work smoothly on mobile?
    8. Test release:
       - Let go mid-rotation
       - Dial should stay at current angle (no snap-back)
  </how-to-verify>
  <resume-signal>Type "approved" if rotation feels good, or describe issues (e.g., "rotation is inverted", "too sensitive", "edge zone too small")</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run test:run` passes (36 tests)
- [ ] `npm run dev` starts without errors
- [ ] Dial rotates when dragged at edge
- [ ] Dial ignores drags near center
- [ ] Works on mobile (touch events)
- [ ] No input lag or jitter
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- User confirms dial rotation feels natural on mobile
- No TypeScript errors or console warnings
- Phase 1 complete
</success_criteria>

<output>
After completion, create `.planning/phases/01-dial-rotation/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Dial Rotation Summary

**[One-liner describing what was built]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- `components/Art.tsx` - Added dial rotation state and drag handlers

## Decisions Made

- [Any decisions made during implementation]

## Issues Encountered

- [Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 1 complete. Ready for Phase 2: Minigame Logic.
</output>
