---
phase: 03-complications
plan: 03
type: execute
---

<objective>
Add center-screen alerts, update console panel behavior, and wire completion flow.

Purpose: Make complications impossible to miss with prominent alerts, and ensure the console → minigame → resolution flow works correctly.
Output: Pulsing red alerts, console panels that only light up when needed, clean completion flow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-complications/03-CONTEXT.md
@.planning/phases/03-complications/03-01-SUMMARY.md
@.planning/phases/03-complications/03-02-SUMMARY.md

**Key files:**
@components/GameBoard.tsx — game rendering during PERISCOPE phase
@components/Art.tsx — console panel rendering, minigame state machines

**From CONTEXT.md - Alert system:**
- "[X] Malfunction" in title font, two lines, RED
- Fast pulsing transparency (100-0-100-0)
- "Fix at Console" subtitle in regular font
- Alert disappears when minigame completed

**From CONTEXT.md - Console panel changes:**
- Minigame lights only ON when complication active
- Remove "click to test" mechanism
- Text: "RESET X" (red, active) → "X FIXED" (green, completed)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create center-screen malfunction alert component</name>
  <files>components/GameBoard.tsx</files>
  <action>
1. Create alert overlay that renders during PERISCOPE phase when complications exist:
   - Position: center of screen
   - For each active complication, show:
     - "[Type]" on first line (e.g., "Lights", "Controls", "Laser")
     - "Malfunction" on second line
     - Both in title font, RED color
     - Pulsing opacity animation: 100% → 0% → 100% → 0% (fast, ~0.5s cycle)
   - Below the main text: "Fix at Console" in smaller/regular font
   - Same pulsing animation

2. CSS for pulsing effect:
   - Use @keyframes animation for opacity pulse
   - animation: pulse 0.5s ease-in-out infinite alternate
   - @keyframes pulse { from { opacity: 1; } to { opacity: 0; } }

3. Alert should be:
   - Centered horizontally and vertically on screen
   - High z-index to appear above game content
   - Semi-transparent background behind text for readability (optional)

4. Multiple complications = multiple alerts stacked vertically
  </action>
  <verify>
Manual test:
- Trigger complication → alert appears with pulsing red text
- Multiple complications → multiple alerts stack
- Fix complication → that alert disappears
Run: `npm run test:run`
  </verify>
  <done>Pulsing red "[X] Malfunction / Fix at Console" alert appears for each active complication</done>
</task>

<task type="auto">
  <name>Task 2: Update console panel indicator behavior</name>
  <files>components/Art.tsx</files>
  <action>
1. Remove the "click on RESET X text to test" mechanism:
   - Remove onClick handlers from minigame title text
   - Remove toggleLaserComplication, toggleLightsComplication, toggleControlsComplication functions
   - Minigames should only activate when real complication exists

2. Update minigame indicator lights logic:
   - Lights should only turn ON when there's an active complication for that panel
   - Pass complications array from GameState to Art component
   - Check: complications.some(c => c.type === ComplicationType.LIGHTS) → lights panel lights on
   - Same for CONTROLS and LASER panels

3. Update panel text states:
   - When complication active for that panel:
     - Text: "RESET [X]" in RED
     - Panel lights: ON
   - When no complication active but was recently fixed:
     - Text: "[X] FIXED" in GREEN (replaces old "solved" state)
     - Maybe show for 2-3 seconds then revert
   - When no complication (idle):
     - Text: "RESET [X]" in default color (teal)
     - Panel lights: OFF

4. The existing minigame state machines (LaserComplication, LightsComplication, ControlsComplication in Art.tsx)
   should only be active when corresponding real complication exists
  </action>
  <verify>
Manual test:
- Console with no complications → all panels dim, teal text
- Trigger LIGHTS complication → Lights panel lights up, "RESET LIGHTS" in RED
- Fix it → "LIGHTS FIXED" in GREEN briefly, then returns to dim/teal
- Can't click to test anymore (removed)
Run: `npm run test:run`
  </verify>
  <done>Panel lights only on when complication active, text changes to red/green based on state</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full complication flow: triggers → effects → alerts → console → minigame → resolution</what-built>
  <how-to-verify>
1. Run: `npm run dev -- --host`
2. Start a game and play until a complication triggers (place ~20 pieces, rotate ~30 times, pop ~15 groups)
3. Verify:
   - Center-screen alert appears with pulsing red "[X] Malfunction / Fix at Console"
   - Gameplay effect kicks in (dim/flip/+1tap depending on type)
   - Swipe up to console
   - Correct panel is lit up with "RESET [X]" in red
   - Complete the minigame
   - Text changes to "[X] FIXED" in green
   - Alert disappears
   - Gameplay effect clears
   - Return to periscope and continue playing
4. Test multiple complications if possible (may need to lower thresholds temporarily)
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all tests
- [ ] Alert appears with pulsing red text during PERISCOPE
- [ ] Alert stacks for multiple complications
- [ ] Console panels only light up when complication active
- [ ] "RESET X" (red) → "[X] FIXED" (green) text flow works
- [ ] Click-to-test mechanism removed
- [ ] Full flow tested manually (trigger → fix → clear)
</verification>

<success_criteria>

- Center-screen alerts implemented with pulsing effect
- Console panels respond to real complications (not test clicks)
- Text states work: idle (teal) → active (red) → fixed (green)
- Full complication flow works end-to-end
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-complications/03-03-SUMMARY.md`:

# Phase 3 Plan 3: UI & Console Updates Summary

**[one-liner about what shipped]**

## Accomplishments
- Center-screen malfunction alerts with pulsing red text
- Console panel indicators tied to real complications
- Text state flow: RESET X (teal/idle) → RESET X (red/active) → X FIXED (green/resolved)
- Click-to-test mechanism removed
- Full complication flow working

## Files Created/Modified
- `components/GameBoard.tsx` — Alert overlay component
- `components/Art.tsx` — Panel indicator logic, removed test toggles

## Next Phase Readiness
- Phase 3 complete
- Ready for Phase 4: Minigame-Complication Integration
</output>
