---
phase: 04-minigame-complication-integration
plan: 01
type: execute
---

<objective>
Final cleanup and bug fixes for the complications system.

Purpose: Ensure complications don't carry over between game sessions and remove dead code.
Output: Clean complications implementation ready for merge to master.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-complications/03-03-SUMMARY.md

# Key files
@core/GameEngine.ts — finalizeGame() needs to clear complications
@Game.tsx — has dead BlownFuse overlay code referencing non-existent ComplicationType.BLOWN_FUSE
@components/MiniGames/BlownFuse.tsx — unused component, can be deleted

# Context from Phase 3
- Minigames fully integrated: solve callbacks wired via onResolveComplication
- Complications trigger via thresholds, effects work, UI shows active state
- startRun() already clears complications correctly
- Bug: finalizeGame() does NOT clear complications, so they persist visually after game over
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clear complications on game end</name>
  <files>core/GameEngine.ts</files>
  <action>In finalizeGame() method (around line 312), add two lines after setting gameOver = true and before the phase change:
    this.state.complications = [];
    this.state.activeComplicationId = null;
  This ensures no complications carry over to the end-game screen or next session.</action>
  <verify>Review the code to confirm complications are cleared before phase change to CONSOLE</verify>
  <done>finalizeGame() clears complications array and activeComplicationId</done>
</task>

<task type="auto">
  <name>Task 2: Remove dead BlownFuse code</name>
  <files>Game.tsx, components/MiniGames/BlownFuse.tsx</files>
  <action>
  1. In Game.tsx: Remove the LAYER 5 MINI-GAMES OVERLAY section (lines ~291-301) that references ComplicationType.BLOWN_FUSE. This type no longer exists.
  2. In Game.tsx: Remove the BlownFuse import (line 7).
  3. Delete components/MiniGames/BlownFuse.tsx entirely.

  This code was from an earlier design and is now unused — the actual minigames live in Art.tsx.</action>
  <verify>npm run test:run passes; grep for "BlownFuse" and "BLOWN_FUSE" returns no results</verify>
  <done>No references to BlownFuse or BLOWN_FUSE remain in codebase</done>
</task>

<task type="auto">
  <name>Task 3: Update planning docs</name>
  <files>.planning/ROADMAP.md, .planning/STATE.md</files>
  <action>
  1. In ROADMAP.md: Mark Phase 3 as complete (change "2/3" to "3/3", status to "Complete"), mark Phase 4 as complete ("1/1", "Complete", add date)
  2. In STATE.md: Update "Current Position" to show milestone complete, update "What's Next" to indicate ready for merge to master
  </action>
  <verify>ROADMAP.md shows all 4 phases complete</verify>
  <done>Planning docs reflect milestone completion</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run test:run` passes all 36 tests
- [ ] No references to BlownFuse or BLOWN_FUSE in codebase
- [ ] finalizeGame() clears complications array
- [ ] ROADMAP.md shows all phases complete
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Complications system is complete and clean
</success_criteria>

<output>
After completion, create `.planning/phases/04-minigame-complication-integration/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Final Cleanup Summary

**[One-liner describing what was done]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Verification Checklist

- [ ] Tests pass
- [ ] Dead code removed
- [ ] Docs updated

## Commits

1. `fix(complications): clear complications on game end`
2. `chore: remove unused BlownFuse component`
3. `docs(04-01): update planning docs for milestone completion`

## Next Step

Phase 4 complete. Milestone ready for merge to master.

---

*Plan: 04-01*
*Phase: 04-minigame-complication-integration*
</output>
