var bp=Object.defineProperty;var Mp=(e,t,n)=>t in e?bp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ze=(e,t,n)=>(Mp(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function Tp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yf={exports:{}},Di={},Hf={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cr=Symbol.for("react.element"),Ep=Symbol.for("react.portal"),Ap=Symbol.for("react.fragment"),_p=Symbol.for("react.strict_mode"),Ip=Symbol.for("react.profiler"),Lp=Symbol.for("react.provider"),Op=Symbol.for("react.context"),Np=Symbol.for("react.forward_ref"),Dp=Symbol.for("react.suspense"),$p=Symbol.for("react.memo"),Fp=Symbol.for("react.lazy"),Ya=Symbol.iterator;function Bp(e){return e===null||typeof e!="object"?null:(e=Ya&&e[Ya]||e["@@iterator"],typeof e=="function"?e:null)}var Wf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Uf=Object.assign,Xf={};function ho(e,t,n){this.props=e,this.context=t,this.refs=Xf,this.updater=n||Wf}ho.prototype.isReactComponent={};ho.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ho.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Vf(){}Vf.prototype=ho.prototype;function Uc(e,t,n){this.props=e,this.context=t,this.refs=Xf,this.updater=n||Wf}var Xc=Uc.prototype=new Vf;Xc.constructor=Uc;Uf(Xc,ho.prototype);Xc.isPureReactComponent=!0;var Ha=Array.isArray,qf=Object.prototype.hasOwnProperty,Vc={current:null},Zf={key:!0,ref:!0,__self:!0,__source:!0};function Kf(e,t,n){var s,r={},o=null,l=null;if(t!=null)for(s in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)qf.call(t,s)&&!Zf.hasOwnProperty(s)&&(r[s]=t[s]);var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){for(var a=Array(c),u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}if(e&&e.defaultProps)for(s in c=e.defaultProps,c)r[s]===void 0&&(r[s]=c[s]);return{$$typeof:cr,type:e,key:o,ref:l,props:r,_owner:Vc.current}}function zp(e,t){return{$$typeof:cr,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function qc(e){return typeof e=="object"&&e!==null&&e.$$typeof===cr}function Gp(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Wa=/\/+/g;function tl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Gp(""+e.key):t.toString(36)}function Yr(e,t,n,s,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case cr:case Ep:l=!0}}if(l)return l=e,r=r(l),e=s===""?"."+tl(l,0):s,Ha(r)?(n="",e!=null&&(n=e.replace(Wa,"$&/")+"/"),Yr(r,t,n,"",function(u){return u})):r!=null&&(qc(r)&&(r=zp(r,n+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(Wa,"$&/")+"/")+e)),t.push(r)),1;if(l=0,s=s===""?".":s+":",Ha(e))for(var c=0;c<e.length;c++){o=e[c];var a=s+tl(o,c);l+=Yr(o,t,n,a,r)}else if(a=Bp(e),typeof a=="function")for(e=a.call(e),c=0;!(o=e.next()).done;)o=o.value,a=s+tl(o,c++),l+=Yr(o,t,n,a,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function pr(e,t,n){if(e==null)return e;var s=[],r=0;return Yr(e,s,"","",function(o){return t.call(n,o,r++)}),s}function Yp(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Nt={current:null},Hr={transition:null},Hp={ReactCurrentDispatcher:Nt,ReactCurrentBatchConfig:Hr,ReactCurrentOwner:Vc};function Qf(){throw Error("act(...) is not supported in production builds of React.")}Ye.Children={map:pr,forEach:function(e,t,n){pr(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return pr(e,function(){t++}),t},toArray:function(e){return pr(e,function(t){return t})||[]},only:function(e){if(!qc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ye.Component=ho;Ye.Fragment=Ap;Ye.Profiler=Ip;Ye.PureComponent=Uc;Ye.StrictMode=_p;Ye.Suspense=Dp;Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hp;Ye.act=Qf;Ye.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Uf({},e.props),r=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=Vc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(a in t)qf.call(t,a)&&!Zf.hasOwnProperty(a)&&(s[a]=t[a]===void 0&&c!==void 0?c[a]:t[a])}var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){c=Array(a);for(var u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}return{$$typeof:cr,type:e.type,key:r,ref:o,props:s,_owner:l}};Ye.createContext=function(e){return e={$$typeof:Op,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Lp,_context:e},e.Consumer=e};Ye.createElement=Kf;Ye.createFactory=function(e){var t=Kf.bind(null,e);return t.type=e,t};Ye.createRef=function(){return{current:null}};Ye.forwardRef=function(e){return{$$typeof:Np,render:e}};Ye.isValidElement=qc;Ye.lazy=function(e){return{$$typeof:Fp,_payload:{_status:-1,_result:e},_init:Yp}};Ye.memo=function(e,t){return{$$typeof:$p,type:e,compare:t===void 0?null:t}};Ye.startTransition=function(e){var t=Hr.transition;Hr.transition={};try{e()}finally{Hr.transition=t}};Ye.unstable_act=Qf;Ye.useCallback=function(e,t){return Nt.current.useCallback(e,t)};Ye.useContext=function(e){return Nt.current.useContext(e)};Ye.useDebugValue=function(){};Ye.useDeferredValue=function(e){return Nt.current.useDeferredValue(e)};Ye.useEffect=function(e,t){return Nt.current.useEffect(e,t)};Ye.useId=function(){return Nt.current.useId()};Ye.useImperativeHandle=function(e,t,n){return Nt.current.useImperativeHandle(e,t,n)};Ye.useInsertionEffect=function(e,t){return Nt.current.useInsertionEffect(e,t)};Ye.useLayoutEffect=function(e,t){return Nt.current.useLayoutEffect(e,t)};Ye.useMemo=function(e,t){return Nt.current.useMemo(e,t)};Ye.useReducer=function(e,t,n){return Nt.current.useReducer(e,t,n)};Ye.useRef=function(e){return Nt.current.useRef(e)};Ye.useState=function(e){return Nt.current.useState(e)};Ye.useSyncExternalStore=function(e,t,n){return Nt.current.useSyncExternalStore(e,t,n)};Ye.useTransition=function(){return Nt.current.useTransition()};Ye.version="18.3.1";Hf.exports=Ye;var v=Hf.exports;const Wp=Tp(v);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Up=v,Xp=Symbol.for("react.element"),Vp=Symbol.for("react.fragment"),qp=Object.prototype.hasOwnProperty,Zp=Up.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kp={key:!0,ref:!0,__self:!0,__source:!0};function Jf(e,t,n){var s,r={},o=null,l=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(s in t)qp.call(t,s)&&!Kp.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:Xp,type:e,key:o,ref:l,props:r,_owner:Zp.current}}Di.Fragment=Vp;Di.jsx=Jf;Di.jsxs=Jf;Yf.exports=Di;var i=Yf.exports,ql={},ed={exports:{}},Zt={},td={exports:{}},nd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Y,K){var $=Y.length;Y.push(K);e:for(;0<$;){var U=$-1>>>1,J=Y[U];if(0<r(J,K))Y[U]=K,Y[$]=J,$=U;else break e}}function n(Y){return Y.length===0?null:Y[0]}function s(Y){if(Y.length===0)return null;var K=Y[0],$=Y.pop();if($!==K){Y[0]=$;e:for(var U=0,J=Y.length,G=J>>>1;U<G;){var pe=2*(U+1)-1,we=Y[pe],O=pe+1,H=Y[O];if(0>r(we,$))O<J&&0>r(H,we)?(Y[U]=H,Y[O]=$,U=O):(Y[U]=we,Y[pe]=$,U=pe);else if(O<J&&0>r(H,$))Y[U]=H,Y[O]=$,U=O;else break e}}return K}function r(Y,K){var $=Y.sortIndex-K.sortIndex;return $!==0?$:Y.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var a=[],u=[],f=1,d=null,p=3,y=!1,S=!1,P=!1,C=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(Y){for(var K=n(u);K!==null;){if(K.callback===null)s(u);else if(K.startTime<=Y)s(u),K.sortIndex=K.expirationTime,t(a,K);else break;K=n(u)}}function m(Y){if(P=!1,x(Y),!S)if(n(a)!==null)S=!0,Z(j);else{var K=n(u);K!==null&&ce(m,K.startTime-Y)}}function j(Y,K){S=!1,P&&(P=!1,g(w),w=-1),y=!0;var $=p;try{for(x(K),d=n(a);d!==null&&(!(d.expirationTime>K)||Y&&!L());){var U=d.callback;if(typeof U=="function"){d.callback=null,p=d.priorityLevel;var J=U(d.expirationTime<=K);K=e.unstable_now(),typeof J=="function"?d.callback=J:d===n(a)&&s(a),x(K)}else s(a);d=n(a)}if(d!==null)var G=!0;else{var pe=n(u);pe!==null&&ce(m,pe.startTime-K),G=!1}return G}finally{d=null,p=$,y=!1}}var R=!1,k=null,w=-1,T=5,_=-1;function L(){return!(e.unstable_now()-_<T)}function V(){if(k!==null){var Y=e.unstable_now();_=Y;var K=!0;try{K=k(!0,Y)}finally{K?q():(R=!1,k=null)}}else R=!1}var q;if(typeof h=="function")q=function(){h(V)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,A=Q.port2;Q.port1.onmessage=V,q=function(){A.postMessage(null)}}else q=function(){C(V,0)};function Z(Y){k=Y,R||(R=!0,q())}function ce(Y,K){w=C(function(){Y(e.unstable_now())},K)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Y){Y.callback=null},e.unstable_continueExecution=function(){S||y||(S=!0,Z(j))},e.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<Y?Math.floor(1e3/Y):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(Y){switch(p){case 1:case 2:case 3:var K=3;break;default:K=p}var $=p;p=K;try{return Y()}finally{p=$}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Y,K){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var $=p;p=Y;try{return K()}finally{p=$}},e.unstable_scheduleCallback=function(Y,K,$){var U=e.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?U+$:U):$=U,Y){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=$+J,Y={id:f++,callback:K,priorityLevel:Y,startTime:$,expirationTime:J,sortIndex:-1},$>U?(Y.sortIndex=$,t(u,Y),n(a)===null&&Y===n(u)&&(P?(g(w),w=-1):P=!0,ce(m,$-U))):(Y.sortIndex=J,t(a,Y),S||y||(S=!0,Z(j))),Y},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(Y){var K=p;return function(){var $=p;p=K;try{return Y.apply(this,arguments)}finally{p=$}}}})(nd);td.exports=nd;var Qp=td.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jp=v,qt=Qp;function fe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var sd=new Set,Wo={};function Ms(e,t){oo(e,t),oo(e+"Capture",t)}function oo(e,t){for(Wo[e]=t,e=0;e<t.length;e++)sd.add(t[e])}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zl=Object.prototype.hasOwnProperty,eh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ua={},Xa={};function th(e){return Zl.call(Xa,e)?!0:Zl.call(Ua,e)?!1:eh.test(e)?Xa[e]=!0:(Ua[e]=!0,!1)}function nh(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function sh(e,t,n,s){if(t===null||typeof t>"u"||nh(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Dt(e,t,n,s,r,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Tt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Tt[e]=new Dt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Tt[t]=new Dt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Tt[e]=new Dt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Tt[e]=new Dt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Tt[e]=new Dt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Tt[e]=new Dt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Tt[e]=new Dt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Tt[e]=new Dt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Tt[e]=new Dt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Zc=/[\-:]([a-z])/g;function Kc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Zc,Kc);Tt[t]=new Dt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Zc,Kc);Tt[t]=new Dt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Zc,Kc);Tt[t]=new Dt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Tt[e]=new Dt(e,1,!1,e.toLowerCase(),null,!1,!1)});Tt.xlinkHref=new Dt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Tt[e]=new Dt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Qc(e,t,n,s){var r=Tt.hasOwnProperty(t)?Tt[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(sh(t,n,r,s)&&(n=null),s||r===null?th(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Hn=Jp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hr=Symbol.for("react.element"),Fs=Symbol.for("react.portal"),Bs=Symbol.for("react.fragment"),Jc=Symbol.for("react.strict_mode"),Kl=Symbol.for("react.profiler"),od=Symbol.for("react.provider"),rd=Symbol.for("react.context"),ea=Symbol.for("react.forward_ref"),Ql=Symbol.for("react.suspense"),Jl=Symbol.for("react.suspense_list"),ta=Symbol.for("react.memo"),Vn=Symbol.for("react.lazy"),id=Symbol.for("react.offscreen"),Va=Symbol.iterator;function go(e){return e===null||typeof e!="object"?null:(e=Va&&e[Va]||e["@@iterator"],typeof e=="function"?e:null)}var dt=Object.assign,nl;function Eo(e){if(nl===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);nl=t&&t[1]||""}return`
`+nl+e}var sl=!1;function ol(e,t){if(!e||sl)return"";sl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),l=r.length-1,c=o.length-1;1<=l&&0<=c&&r[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(r[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||r[l]!==o[c]){var a=`
`+r[l].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=l&&0<=c);break}}}finally{sl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Eo(e):""}function oh(e){switch(e.tag){case 5:return Eo(e.type);case 16:return Eo("Lazy");case 13:return Eo("Suspense");case 19:return Eo("SuspenseList");case 0:case 2:case 15:return e=ol(e.type,!1),e;case 11:return e=ol(e.type.render,!1),e;case 1:return e=ol(e.type,!0),e;default:return""}}function ec(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Bs:return"Fragment";case Fs:return"Portal";case Kl:return"Profiler";case Jc:return"StrictMode";case Ql:return"Suspense";case Jl:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case rd:return(e.displayName||"Context")+".Consumer";case od:return(e._context.displayName||"Context")+".Provider";case ea:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ta:return t=e.displayName||null,t!==null?t:ec(e.type)||"Memo";case Vn:t=e._payload,e=e._init;try{return ec(e(t))}catch{}}return null}function rh(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ec(t);case 8:return t===Jc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function as(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function ld(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ih(e){var t=ld(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(l){s=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(l){s=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function xr(e){e._valueTracker||(e._valueTracker=ih(e))}function cd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=ld(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function ii(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function tc(e,t){var n=t.checked;return dt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function qa(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=as(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function ad(e,t){t=t.checked,t!=null&&Qc(e,"checked",t,!1)}function nc(e,t){ad(e,t);var n=as(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?sc(e,t.type,n):t.hasOwnProperty("defaultValue")&&sc(e,t.type,as(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Za(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function sc(e,t,n){(t!=="number"||ii(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ao=Array.isArray;function Qs(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+as(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function oc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(fe(91));return dt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Ka(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(fe(92));if(Ao(n)){if(1<n.length)throw Error(fe(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:as(n)}}function ud(e,t){var n=as(t.value),s=as(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function Qa(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function fd(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?fd(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var yr,dd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(yr=yr||document.createElement("div"),yr.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=yr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Uo(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var No={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lh=["Webkit","ms","Moz","O"];Object.keys(No).forEach(function(e){lh.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),No[t]=No[e]})});function pd(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||No.hasOwnProperty(e)&&No[e]?(""+t).trim():t+"px"}function hd(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=pd(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var ch=dt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ic(e,t){if(t){if(ch[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(fe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(fe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(fe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(fe(62))}}function lc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cc=null;function na(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ac=null,Js=null,eo=null;function Ja(e){if(e=fr(e)){if(typeof ac!="function")throw Error(fe(280));var t=e.stateNode;t&&(t=Gi(t),ac(e.stateNode,e.type,t))}}function xd(e){Js?eo?eo.push(e):eo=[e]:Js=e}function yd(){if(Js){var e=Js,t=eo;if(eo=Js=null,Ja(e),t)for(e=0;e<t.length;e++)Ja(t[e])}}function gd(e,t){return e(t)}function md(){}var rl=!1;function vd(e,t,n){if(rl)return e(t,n);rl=!0;try{return gd(e,t,n)}finally{rl=!1,(Js!==null||eo!==null)&&(md(),yd())}}function Xo(e,t){var n=e.stateNode;if(n===null)return null;var s=Gi(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(fe(231,t,typeof n));return n}var uc=!1;if(Bn)try{var mo={};Object.defineProperty(mo,"passive",{get:function(){uc=!0}}),window.addEventListener("test",mo,mo),window.removeEventListener("test",mo,mo)}catch{uc=!1}function ah(e,t,n,s,r,o,l,c,a){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(f){this.onError(f)}}var Do=!1,li=null,ci=!1,fc=null,uh={onError:function(e){Do=!0,li=e}};function fh(e,t,n,s,r,o,l,c,a){Do=!1,li=null,ah.apply(uh,arguments)}function dh(e,t,n,s,r,o,l,c,a){if(fh.apply(this,arguments),Do){if(Do){var u=li;Do=!1,li=null}else throw Error(fe(198));ci||(ci=!0,fc=u)}}function Ts(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Sd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function eu(e){if(Ts(e)!==e)throw Error(fe(188))}function ph(e){var t=e.alternate;if(!t){if(t=Ts(e),t===null)throw Error(fe(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return eu(r),e;if(o===s)return eu(r),t;o=o.sibling}throw Error(fe(188))}if(n.return!==s.return)n=r,s=o;else{for(var l=!1,c=r.child;c;){if(c===n){l=!0,n=r,s=o;break}if(c===s){l=!0,s=r,n=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===n){l=!0,n=o,s=r;break}if(c===s){l=!0,s=o,n=r;break}c=c.sibling}if(!l)throw Error(fe(189))}}if(n.alternate!==s)throw Error(fe(190))}if(n.tag!==3)throw Error(fe(188));return n.stateNode.current===n?e:t}function Cd(e){return e=ph(e),e!==null?kd(e):null}function kd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=kd(e);if(t!==null)return t;e=e.sibling}return null}var wd=qt.unstable_scheduleCallback,tu=qt.unstable_cancelCallback,hh=qt.unstable_shouldYield,xh=qt.unstable_requestPaint,yt=qt.unstable_now,yh=qt.unstable_getCurrentPriorityLevel,sa=qt.unstable_ImmediatePriority,jd=qt.unstable_UserBlockingPriority,ai=qt.unstable_NormalPriority,gh=qt.unstable_LowPriority,Pd=qt.unstable_IdlePriority,$i=null,Mn=null;function mh(e){if(Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot($i,e,void 0,(e.current.flags&128)===128)}catch{}}var vn=Math.clz32?Math.clz32:Ch,vh=Math.log,Sh=Math.LN2;function Ch(e){return e>>>=0,e===0?32:31-(vh(e)/Sh|0)|0}var gr=64,mr=4194304;function _o(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ui(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes,l=n&268435455;if(l!==0){var c=l&~r;c!==0?s=_o(c):(o&=l,o!==0&&(s=_o(o)))}else l=n&~r,l!==0?s=_o(l):o!==0&&(s=_o(o));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-vn(t),r=1<<n,s|=e[n],t&=~r;return s}function kh(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wh(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-vn(o),c=1<<l,a=r[l];a===-1?(!(c&n)||c&s)&&(r[l]=kh(c,t)):a<=t&&(e.expiredLanes|=c),o&=~c}}function dc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Rd(){var e=gr;return gr<<=1,!(gr&4194240)&&(gr=64),e}function il(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ar(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-vn(t),e[t]=n}function jh(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-vn(n),o=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~o}}function oa(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-vn(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var Ke=0;function bd(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Md,ra,Td,Ed,Ad,pc=!1,vr=[],es=null,ts=null,ns=null,Vo=new Map,qo=new Map,Zn=[],Ph="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function nu(e,t){switch(e){case"focusin":case"focusout":es=null;break;case"dragenter":case"dragleave":ts=null;break;case"mouseover":case"mouseout":ns=null;break;case"pointerover":case"pointerout":Vo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":qo.delete(t.pointerId)}}function vo(e,t,n,s,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},t!==null&&(t=fr(t),t!==null&&ra(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function Rh(e,t,n,s,r){switch(t){case"focusin":return es=vo(es,e,t,n,s,r),!0;case"dragenter":return ts=vo(ts,e,t,n,s,r),!0;case"mouseover":return ns=vo(ns,e,t,n,s,r),!0;case"pointerover":var o=r.pointerId;return Vo.set(o,vo(Vo.get(o)||null,e,t,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,qo.set(o,vo(qo.get(o)||null,e,t,n,s,r)),!0}return!1}function _d(e){var t=ms(e.target);if(t!==null){var n=Ts(t);if(n!==null){if(t=n.tag,t===13){if(t=Sd(n),t!==null){e.blockedOn=t,Ad(e.priority,function(){Td(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Wr(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=hc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);cc=s,n.target.dispatchEvent(s),cc=null}else return t=fr(n),t!==null&&ra(t),e.blockedOn=n,!1;t.shift()}return!0}function su(e,t,n){Wr(e)&&n.delete(t)}function bh(){pc=!1,es!==null&&Wr(es)&&(es=null),ts!==null&&Wr(ts)&&(ts=null),ns!==null&&Wr(ns)&&(ns=null),Vo.forEach(su),qo.forEach(su)}function So(e,t){e.blockedOn===t&&(e.blockedOn=null,pc||(pc=!0,qt.unstable_scheduleCallback(qt.unstable_NormalPriority,bh)))}function Zo(e){function t(r){return So(r,e)}if(0<vr.length){So(vr[0],e);for(var n=1;n<vr.length;n++){var s=vr[n];s.blockedOn===e&&(s.blockedOn=null)}}for(es!==null&&So(es,e),ts!==null&&So(ts,e),ns!==null&&So(ns,e),Vo.forEach(t),qo.forEach(t),n=0;n<Zn.length;n++)s=Zn[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<Zn.length&&(n=Zn[0],n.blockedOn===null);)_d(n),n.blockedOn===null&&Zn.shift()}var to=Hn.ReactCurrentBatchConfig,fi=!0;function Mh(e,t,n,s){var r=Ke,o=to.transition;to.transition=null;try{Ke=1,ia(e,t,n,s)}finally{Ke=r,to.transition=o}}function Th(e,t,n,s){var r=Ke,o=to.transition;to.transition=null;try{Ke=4,ia(e,t,n,s)}finally{Ke=r,to.transition=o}}function ia(e,t,n,s){if(fi){var r=hc(e,t,n,s);if(r===null)yl(e,t,s,di,n),nu(e,s);else if(Rh(r,e,t,n,s))s.stopPropagation();else if(nu(e,s),t&4&&-1<Ph.indexOf(e)){for(;r!==null;){var o=fr(r);if(o!==null&&Md(o),o=hc(e,t,n,s),o===null&&yl(e,t,s,di,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else yl(e,t,s,null,n)}}var di=null;function hc(e,t,n,s){if(di=null,e=na(s),e=ms(e),e!==null)if(t=Ts(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Sd(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return di=e,null}function Id(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yh()){case sa:return 1;case jd:return 4;case ai:case gh:return 16;case Pd:return 536870912;default:return 16}default:return 16}}var Qn=null,la=null,Ur=null;function Ld(){if(Ur)return Ur;var e,t=la,n=t.length,s,r="value"in Qn?Qn.value:Qn.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var l=n-e;for(s=1;s<=l&&t[n-s]===r[o-s];s++);return Ur=r.slice(e,1<s?1-s:void 0)}function Xr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Sr(){return!0}function ou(){return!1}function Kt(e){function t(n,s,r,o,l){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Sr:ou,this.isPropagationStopped=ou,this}return dt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Sr)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Sr)},persist:function(){},isPersistent:Sr}),t}var xo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ca=Kt(xo),ur=dt({},xo,{view:0,detail:0}),Eh=Kt(ur),ll,cl,Co,Fi=dt({},ur,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:aa,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Co&&(Co&&e.type==="mousemove"?(ll=e.screenX-Co.screenX,cl=e.screenY-Co.screenY):cl=ll=0,Co=e),ll)},movementY:function(e){return"movementY"in e?e.movementY:cl}}),ru=Kt(Fi),Ah=dt({},Fi,{dataTransfer:0}),_h=Kt(Ah),Ih=dt({},ur,{relatedTarget:0}),al=Kt(Ih),Lh=dt({},xo,{animationName:0,elapsedTime:0,pseudoElement:0}),Oh=Kt(Lh),Nh=dt({},xo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Dh=Kt(Nh),$h=dt({},xo,{data:0}),iu=Kt($h),Fh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zh[e])?!!t[e]:!1}function aa(){return Gh}var Yh=dt({},ur,{key:function(e){if(e.key){var t=Fh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Xr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Bh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:aa,charCode:function(e){return e.type==="keypress"?Xr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Xr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Hh=Kt(Yh),Wh=dt({},Fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lu=Kt(Wh),Uh=dt({},ur,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:aa}),Xh=Kt(Uh),Vh=dt({},xo,{propertyName:0,elapsedTime:0,pseudoElement:0}),qh=Kt(Vh),Zh=dt({},Fi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Kh=Kt(Zh),Qh=[9,13,27,32],ua=Bn&&"CompositionEvent"in window,$o=null;Bn&&"documentMode"in document&&($o=document.documentMode);var Jh=Bn&&"TextEvent"in window&&!$o,Od=Bn&&(!ua||$o&&8<$o&&11>=$o),cu=String.fromCharCode(32),au=!1;function Nd(e,t){switch(e){case"keyup":return Qh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var zs=!1;function e1(e,t){switch(e){case"compositionend":return Dd(t);case"keypress":return t.which!==32?null:(au=!0,cu);case"textInput":return e=t.data,e===cu&&au?null:e;default:return null}}function t1(e,t){if(zs)return e==="compositionend"||!ua&&Nd(e,t)?(e=Ld(),Ur=la=Qn=null,zs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Od&&t.locale!=="ko"?null:t.data;default:return null}}var n1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!n1[e.type]:t==="textarea"}function $d(e,t,n,s){xd(s),t=pi(t,"onChange"),0<t.length&&(n=new ca("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Fo=null,Ko=null;function s1(e){qd(e,0)}function Bi(e){var t=Hs(e);if(cd(t))return e}function o1(e,t){if(e==="change")return t}var Fd=!1;if(Bn){var ul;if(Bn){var fl="oninput"in document;if(!fl){var fu=document.createElement("div");fu.setAttribute("oninput","return;"),fl=typeof fu.oninput=="function"}ul=fl}else ul=!1;Fd=ul&&(!document.documentMode||9<document.documentMode)}function du(){Fo&&(Fo.detachEvent("onpropertychange",Bd),Ko=Fo=null)}function Bd(e){if(e.propertyName==="value"&&Bi(Ko)){var t=[];$d(t,Ko,e,na(e)),vd(s1,t)}}function r1(e,t,n){e==="focusin"?(du(),Fo=t,Ko=n,Fo.attachEvent("onpropertychange",Bd)):e==="focusout"&&du()}function i1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Bi(Ko)}function l1(e,t){if(e==="click")return Bi(t)}function c1(e,t){if(e==="input"||e==="change")return Bi(t)}function a1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Cn=typeof Object.is=="function"?Object.is:a1;function Qo(e,t){if(Cn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Zl.call(t,r)||!Cn(e[r],t[r]))return!1}return!0}function pu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hu(e,t){var n=pu(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=pu(n)}}function zd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?zd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Gd(){for(var e=window,t=ii();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=ii(e.document)}return t}function fa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function u1(e){var t=Gd(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&zd(n.ownerDocument.documentElement,n)){if(s!==null&&fa(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!e.extend&&o>s&&(r=s,s=o,o=r),r=hu(n,o);var l=hu(n,s);r&&l&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>s?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var f1=Bn&&"documentMode"in document&&11>=document.documentMode,Gs=null,xc=null,Bo=null,yc=!1;function xu(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;yc||Gs==null||Gs!==ii(s)||(s=Gs,"selectionStart"in s&&fa(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Bo&&Qo(Bo,s)||(Bo=s,s=pi(xc,"onSelect"),0<s.length&&(t=new ca("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Gs)))}function Cr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ys={animationend:Cr("Animation","AnimationEnd"),animationiteration:Cr("Animation","AnimationIteration"),animationstart:Cr("Animation","AnimationStart"),transitionend:Cr("Transition","TransitionEnd")},dl={},Yd={};Bn&&(Yd=document.createElement("div").style,"AnimationEvent"in window||(delete Ys.animationend.animation,delete Ys.animationiteration.animation,delete Ys.animationstart.animation),"TransitionEvent"in window||delete Ys.transitionend.transition);function zi(e){if(dl[e])return dl[e];if(!Ys[e])return e;var t=Ys[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Yd)return dl[e]=t[n];return e}var Hd=zi("animationend"),Wd=zi("animationiteration"),Ud=zi("animationstart"),Xd=zi("transitionend"),Vd=new Map,yu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ps(e,t){Vd.set(e,t),Ms(t,[e])}for(var pl=0;pl<yu.length;pl++){var hl=yu[pl],d1=hl.toLowerCase(),p1=hl[0].toUpperCase()+hl.slice(1);ps(d1,"on"+p1)}ps(Hd,"onAnimationEnd");ps(Wd,"onAnimationIteration");ps(Ud,"onAnimationStart");ps("dblclick","onDoubleClick");ps("focusin","onFocus");ps("focusout","onBlur");ps(Xd,"onTransitionEnd");oo("onMouseEnter",["mouseout","mouseover"]);oo("onMouseLeave",["mouseout","mouseover"]);oo("onPointerEnter",["pointerout","pointerover"]);oo("onPointerLeave",["pointerout","pointerover"]);Ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ms("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Io="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Io));function gu(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,dh(s,t,void 0,e),e.currentTarget=null}function qd(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var l=s.length-1;0<=l;l--){var c=s[l],a=c.instance,u=c.currentTarget;if(c=c.listener,a!==o&&r.isPropagationStopped())break e;gu(r,c,u),o=a}else for(l=0;l<s.length;l++){if(c=s[l],a=c.instance,u=c.currentTarget,c=c.listener,a!==o&&r.isPropagationStopped())break e;gu(r,c,u),o=a}}}if(ci)throw e=fc,ci=!1,fc=null,e}function tt(e,t){var n=t[Cc];n===void 0&&(n=t[Cc]=new Set);var s=e+"__bubble";n.has(s)||(Zd(t,e,2,!1),n.add(s))}function xl(e,t,n){var s=0;t&&(s|=4),Zd(n,e,s,t)}var kr="_reactListening"+Math.random().toString(36).slice(2);function Jo(e){if(!e[kr]){e[kr]=!0,sd.forEach(function(n){n!=="selectionchange"&&(h1.has(n)||xl(n,!1,e),xl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[kr]||(t[kr]=!0,xl("selectionchange",!1,t))}}function Zd(e,t,n,s){switch(Id(t)){case 1:var r=Mh;break;case 4:r=Th;break;default:r=ia}n=r.bind(null,t,n,e),r=void 0,!uc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function yl(e,t,n,s,r){var o=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var l=s.tag;if(l===3||l===4){var c=s.stateNode.containerInfo;if(c===r||c.nodeType===8&&c.parentNode===r)break;if(l===4)for(l=s.return;l!==null;){var a=l.tag;if((a===3||a===4)&&(a=l.stateNode.containerInfo,a===r||a.nodeType===8&&a.parentNode===r))return;l=l.return}for(;c!==null;){if(l=ms(c),l===null)return;if(a=l.tag,a===5||a===6){s=o=l;continue e}c=c.parentNode}}s=s.return}vd(function(){var u=o,f=na(n),d=[];e:{var p=Vd.get(e);if(p!==void 0){var y=ca,S=e;switch(e){case"keypress":if(Xr(n)===0)break e;case"keydown":case"keyup":y=Hh;break;case"focusin":S="focus",y=al;break;case"focusout":S="blur",y=al;break;case"beforeblur":case"afterblur":y=al;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=ru;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=_h;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Xh;break;case Hd:case Wd:case Ud:y=Oh;break;case Xd:y=qh;break;case"scroll":y=Eh;break;case"wheel":y=Kh;break;case"copy":case"cut":case"paste":y=Dh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=lu}var P=(t&4)!==0,C=!P&&e==="scroll",g=P?p!==null?p+"Capture":null:p;P=[];for(var h=u,x;h!==null;){x=h;var m=x.stateNode;if(x.tag===5&&m!==null&&(x=m,g!==null&&(m=Xo(h,g),m!=null&&P.push(er(h,m,x)))),C)break;h=h.return}0<P.length&&(p=new y(p,S,null,n,f),d.push({event:p,listeners:P}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",p&&n!==cc&&(S=n.relatedTarget||n.fromElement)&&(ms(S)||S[zn]))break e;if((y||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,y?(S=n.relatedTarget||n.toElement,y=u,S=S?ms(S):null,S!==null&&(C=Ts(S),S!==C||S.tag!==5&&S.tag!==6)&&(S=null)):(y=null,S=u),y!==S)){if(P=ru,m="onMouseLeave",g="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(P=lu,m="onPointerLeave",g="onPointerEnter",h="pointer"),C=y==null?p:Hs(y),x=S==null?p:Hs(S),p=new P(m,h+"leave",y,n,f),p.target=C,p.relatedTarget=x,m=null,ms(f)===u&&(P=new P(g,h+"enter",S,n,f),P.target=x,P.relatedTarget=C,m=P),C=m,y&&S)t:{for(P=y,g=S,h=0,x=P;x;x=As(x))h++;for(x=0,m=g;m;m=As(m))x++;for(;0<h-x;)P=As(P),h--;for(;0<x-h;)g=As(g),x--;for(;h--;){if(P===g||g!==null&&P===g.alternate)break t;P=As(P),g=As(g)}P=null}else P=null;y!==null&&mu(d,p,y,P,!1),S!==null&&C!==null&&mu(d,C,S,P,!0)}}e:{if(p=u?Hs(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var j=o1;else if(uu(p))if(Fd)j=c1;else{j=i1;var R=r1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(j=l1);if(j&&(j=j(e,u))){$d(d,j,n,f);break e}R&&R(e,p,u),e==="focusout"&&(R=p._wrapperState)&&R.controlled&&p.type==="number"&&sc(p,"number",p.value)}switch(R=u?Hs(u):window,e){case"focusin":(uu(R)||R.contentEditable==="true")&&(Gs=R,xc=u,Bo=null);break;case"focusout":Bo=xc=Gs=null;break;case"mousedown":yc=!0;break;case"contextmenu":case"mouseup":case"dragend":yc=!1,xu(d,n,f);break;case"selectionchange":if(f1)break;case"keydown":case"keyup":xu(d,n,f)}var k;if(ua)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else zs?Nd(e,n)&&(w="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&(Od&&n.locale!=="ko"&&(zs||w!=="onCompositionStart"?w==="onCompositionEnd"&&zs&&(k=Ld()):(Qn=f,la="value"in Qn?Qn.value:Qn.textContent,zs=!0)),R=pi(u,w),0<R.length&&(w=new iu(w,e,null,n,f),d.push({event:w,listeners:R}),k?w.data=k:(k=Dd(n),k!==null&&(w.data=k)))),(k=Jh?e1(e,n):t1(e,n))&&(u=pi(u,"onBeforeInput"),0<u.length&&(f=new iu("onBeforeInput","beforeinput",null,n,f),d.push({event:f,listeners:u}),f.data=k))}qd(d,t)})}function er(e,t,n){return{instance:e,listener:t,currentTarget:n}}function pi(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=Xo(e,n),o!=null&&s.unshift(er(e,o,r)),o=Xo(e,t),o!=null&&s.push(er(e,o,r))),e=e.return}return s}function As(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function mu(e,t,n,s,r){for(var o=t._reactName,l=[];n!==null&&n!==s;){var c=n,a=c.alternate,u=c.stateNode;if(a!==null&&a===s)break;c.tag===5&&u!==null&&(c=u,r?(a=Xo(n,o),a!=null&&l.unshift(er(n,a,c))):r||(a=Xo(n,o),a!=null&&l.push(er(n,a,c)))),n=n.return}l.length!==0&&e.push({event:t,listeners:l})}var x1=/\r\n?/g,y1=/\u0000|\uFFFD/g;function vu(e){return(typeof e=="string"?e:""+e).replace(x1,`
`).replace(y1,"")}function wr(e,t,n){if(t=vu(t),vu(e)!==t&&n)throw Error(fe(425))}function hi(){}var gc=null,mc=null;function vc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sc=typeof setTimeout=="function"?setTimeout:void 0,g1=typeof clearTimeout=="function"?clearTimeout:void 0,Su=typeof Promise=="function"?Promise:void 0,m1=typeof queueMicrotask=="function"?queueMicrotask:typeof Su<"u"?function(e){return Su.resolve(null).then(e).catch(v1)}:Sc;function v1(e){setTimeout(function(){throw e})}function gl(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),Zo(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Zo(t)}function ss(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Cu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var yo=Math.random().toString(36).slice(2),Rn="__reactFiber$"+yo,tr="__reactProps$"+yo,zn="__reactContainer$"+yo,Cc="__reactEvents$"+yo,S1="__reactListeners$"+yo,C1="__reactHandles$"+yo;function ms(e){var t=e[Rn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[zn]||n[Rn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Cu(e);e!==null;){if(n=e[Rn])return n;e=Cu(e)}return t}e=n,n=e.parentNode}return null}function fr(e){return e=e[Rn]||e[zn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Hs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(fe(33))}function Gi(e){return e[tr]||null}var kc=[],Ws=-1;function hs(e){return{current:e}}function nt(e){0>Ws||(e.current=kc[Ws],kc[Ws]=null,Ws--)}function et(e,t){Ws++,kc[Ws]=e.current,e.current=t}var us={},It=hs(us),zt=hs(!1),ws=us;function ro(e,t){var n=e.type.contextTypes;if(!n)return us;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Gt(e){return e=e.childContextTypes,e!=null}function xi(){nt(zt),nt(It)}function ku(e,t,n){if(It.current!==us)throw Error(fe(168));et(It,t),et(zt,n)}function Kd(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(fe(108,rh(e)||"Unknown",r));return dt({},n,s)}function yi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||us,ws=It.current,et(It,e),et(zt,zt.current),!0}function wu(e,t,n){var s=e.stateNode;if(!s)throw Error(fe(169));n?(e=Kd(e,t,ws),s.__reactInternalMemoizedMergedChildContext=e,nt(zt),nt(It),et(It,e)):nt(zt),et(zt,n)}var In=null,Yi=!1,ml=!1;function Qd(e){In===null?In=[e]:In.push(e)}function k1(e){Yi=!0,Qd(e)}function xs(){if(!ml&&In!==null){ml=!0;var e=0,t=Ke;try{var n=In;for(Ke=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}In=null,Yi=!1}catch(r){throw In!==null&&(In=In.slice(e+1)),wd(sa,xs),r}finally{Ke=t,ml=!1}}return null}var Us=[],Xs=0,gi=null,mi=0,en=[],tn=0,js=null,On=1,Nn="";function ys(e,t){Us[Xs++]=mi,Us[Xs++]=gi,gi=e,mi=t}function Jd(e,t,n){en[tn++]=On,en[tn++]=Nn,en[tn++]=js,js=e;var s=On;e=Nn;var r=32-vn(s)-1;s&=~(1<<r),n+=1;var o=32-vn(t)+r;if(30<o){var l=r-r%5;o=(s&(1<<l)-1).toString(32),s>>=l,r-=l,On=1<<32-vn(t)+r|n<<r|s,Nn=o+e}else On=1<<o|n<<r|s,Nn=e}function da(e){e.return!==null&&(ys(e,1),Jd(e,1,0))}function pa(e){for(;e===gi;)gi=Us[--Xs],Us[Xs]=null,mi=Us[--Xs],Us[Xs]=null;for(;e===js;)js=en[--tn],en[tn]=null,Nn=en[--tn],en[tn]=null,On=en[--tn],en[tn]=null}var Vt=null,Xt=null,st=!1,pn=null;function e0(e,t){var n=sn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function ju(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Vt=e,Xt=ss(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Vt=e,Xt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=js!==null?{id:On,overflow:Nn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=sn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Vt=e,Xt=null,!0):!1;default:return!1}}function wc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jc(e){if(st){var t=Xt;if(t){var n=t;if(!ju(e,t)){if(wc(e))throw Error(fe(418));t=ss(n.nextSibling);var s=Vt;t&&ju(e,t)?e0(s,n):(e.flags=e.flags&-4097|2,st=!1,Vt=e)}}else{if(wc(e))throw Error(fe(418));e.flags=e.flags&-4097|2,st=!1,Vt=e}}}function Pu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Vt=e}function jr(e){if(e!==Vt)return!1;if(!st)return Pu(e),st=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!vc(e.type,e.memoizedProps)),t&&(t=Xt)){if(wc(e))throw t0(),Error(fe(418));for(;t;)e0(e,t),t=ss(t.nextSibling)}if(Pu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(fe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Xt=ss(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Xt=null}}else Xt=Vt?ss(e.stateNode.nextSibling):null;return!0}function t0(){for(var e=Xt;e;)e=ss(e.nextSibling)}function io(){Xt=Vt=null,st=!1}function ha(e){pn===null?pn=[e]:pn.push(e)}var w1=Hn.ReactCurrentBatchConfig;function ko(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(fe(309));var s=n.stateNode}if(!s)throw Error(fe(147,e));var r=s,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=r.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(fe(284));if(!n._owner)throw Error(fe(290,e))}return e}function Pr(e,t){throw e=Object.prototype.toString.call(t),Error(fe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ru(e){var t=e._init;return t(e._payload)}function n0(e){function t(g,h){if(e){var x=g.deletions;x===null?(g.deletions=[h],g.flags|=16):x.push(h)}}function n(g,h){if(!e)return null;for(;h!==null;)t(g,h),h=h.sibling;return null}function s(g,h){for(g=new Map;h!==null;)h.key!==null?g.set(h.key,h):g.set(h.index,h),h=h.sibling;return g}function r(g,h){return g=ls(g,h),g.index=0,g.sibling=null,g}function o(g,h,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<h?(g.flags|=2,h):x):(g.flags|=2,h)):(g.flags|=1048576,h)}function l(g){return e&&g.alternate===null&&(g.flags|=2),g}function c(g,h,x,m){return h===null||h.tag!==6?(h=Pl(x,g.mode,m),h.return=g,h):(h=r(h,x),h.return=g,h)}function a(g,h,x,m){var j=x.type;return j===Bs?f(g,h,x.props.children,m,x.key):h!==null&&(h.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Vn&&Ru(j)===h.type)?(m=r(h,x.props),m.ref=ko(g,h,x),m.return=g,m):(m=ei(x.type,x.key,x.props,null,g.mode,m),m.ref=ko(g,h,x),m.return=g,m)}function u(g,h,x,m){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=Rl(x,g.mode,m),h.return=g,h):(h=r(h,x.children||[]),h.return=g,h)}function f(g,h,x,m,j){return h===null||h.tag!==7?(h=ks(x,g.mode,m,j),h.return=g,h):(h=r(h,x),h.return=g,h)}function d(g,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Pl(""+h,g.mode,x),h.return=g,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case hr:return x=ei(h.type,h.key,h.props,null,g.mode,x),x.ref=ko(g,null,h),x.return=g,x;case Fs:return h=Rl(h,g.mode,x),h.return=g,h;case Vn:var m=h._init;return d(g,m(h._payload),x)}if(Ao(h)||go(h))return h=ks(h,g.mode,x,null),h.return=g,h;Pr(g,h)}return null}function p(g,h,x,m){var j=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return j!==null?null:c(g,h,""+x,m);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case hr:return x.key===j?a(g,h,x,m):null;case Fs:return x.key===j?u(g,h,x,m):null;case Vn:return j=x._init,p(g,h,j(x._payload),m)}if(Ao(x)||go(x))return j!==null?null:f(g,h,x,m,null);Pr(g,x)}return null}function y(g,h,x,m,j){if(typeof m=="string"&&m!==""||typeof m=="number")return g=g.get(x)||null,c(h,g,""+m,j);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case hr:return g=g.get(m.key===null?x:m.key)||null,a(h,g,m,j);case Fs:return g=g.get(m.key===null?x:m.key)||null,u(h,g,m,j);case Vn:var R=m._init;return y(g,h,x,R(m._payload),j)}if(Ao(m)||go(m))return g=g.get(x)||null,f(h,g,m,j,null);Pr(h,m)}return null}function S(g,h,x,m){for(var j=null,R=null,k=h,w=h=0,T=null;k!==null&&w<x.length;w++){k.index>w?(T=k,k=null):T=k.sibling;var _=p(g,k,x[w],m);if(_===null){k===null&&(k=T);break}e&&k&&_.alternate===null&&t(g,k),h=o(_,h,w),R===null?j=_:R.sibling=_,R=_,k=T}if(w===x.length)return n(g,k),st&&ys(g,w),j;if(k===null){for(;w<x.length;w++)k=d(g,x[w],m),k!==null&&(h=o(k,h,w),R===null?j=k:R.sibling=k,R=k);return st&&ys(g,w),j}for(k=s(g,k);w<x.length;w++)T=y(k,g,w,x[w],m),T!==null&&(e&&T.alternate!==null&&k.delete(T.key===null?w:T.key),h=o(T,h,w),R===null?j=T:R.sibling=T,R=T);return e&&k.forEach(function(L){return t(g,L)}),st&&ys(g,w),j}function P(g,h,x,m){var j=go(x);if(typeof j!="function")throw Error(fe(150));if(x=j.call(x),x==null)throw Error(fe(151));for(var R=j=null,k=h,w=h=0,T=null,_=x.next();k!==null&&!_.done;w++,_=x.next()){k.index>w?(T=k,k=null):T=k.sibling;var L=p(g,k,_.value,m);if(L===null){k===null&&(k=T);break}e&&k&&L.alternate===null&&t(g,k),h=o(L,h,w),R===null?j=L:R.sibling=L,R=L,k=T}if(_.done)return n(g,k),st&&ys(g,w),j;if(k===null){for(;!_.done;w++,_=x.next())_=d(g,_.value,m),_!==null&&(h=o(_,h,w),R===null?j=_:R.sibling=_,R=_);return st&&ys(g,w),j}for(k=s(g,k);!_.done;w++,_=x.next())_=y(k,g,w,_.value,m),_!==null&&(e&&_.alternate!==null&&k.delete(_.key===null?w:_.key),h=o(_,h,w),R===null?j=_:R.sibling=_,R=_);return e&&k.forEach(function(V){return t(g,V)}),st&&ys(g,w),j}function C(g,h,x,m){if(typeof x=="object"&&x!==null&&x.type===Bs&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case hr:e:{for(var j=x.key,R=h;R!==null;){if(R.key===j){if(j=x.type,j===Bs){if(R.tag===7){n(g,R.sibling),h=r(R,x.props.children),h.return=g,g=h;break e}}else if(R.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Vn&&Ru(j)===R.type){n(g,R.sibling),h=r(R,x.props),h.ref=ko(g,R,x),h.return=g,g=h;break e}n(g,R);break}else t(g,R);R=R.sibling}x.type===Bs?(h=ks(x.props.children,g.mode,m,x.key),h.return=g,g=h):(m=ei(x.type,x.key,x.props,null,g.mode,m),m.ref=ko(g,h,x),m.return=g,g=m)}return l(g);case Fs:e:{for(R=x.key;h!==null;){if(h.key===R)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(g,h.sibling),h=r(h,x.children||[]),h.return=g,g=h;break e}else{n(g,h);break}else t(g,h);h=h.sibling}h=Rl(x,g.mode,m),h.return=g,g=h}return l(g);case Vn:return R=x._init,C(g,h,R(x._payload),m)}if(Ao(x))return S(g,h,x,m);if(go(x))return P(g,h,x,m);Pr(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(g,h.sibling),h=r(h,x),h.return=g,g=h):(n(g,h),h=Pl(x,g.mode,m),h.return=g,g=h),l(g)):n(g,h)}return C}var lo=n0(!0),s0=n0(!1),vi=hs(null),Si=null,Vs=null,xa=null;function ya(){xa=Vs=Si=null}function ga(e){var t=vi.current;nt(vi),e._currentValue=t}function Pc(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function no(e,t){Si=e,xa=Vs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Bt=!0),e.firstContext=null)}function ln(e){var t=e._currentValue;if(xa!==e)if(e={context:e,memoizedValue:t,next:null},Vs===null){if(Si===null)throw Error(fe(308));Vs=e,Si.dependencies={lanes:0,firstContext:e}}else Vs=Vs.next=e;return t}var vs=null;function ma(e){vs===null?vs=[e]:vs.push(e)}function o0(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,ma(t)):(n.next=r.next,r.next=n),t.interleaved=n,Gn(e,s)}function Gn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var qn=!1;function va(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function r0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function os(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,qe&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Gn(e,n)}return r=s.interleaved,r===null?(t.next=t,ma(s)):(t.next=r.next,r.next=t),s.interleaved=t,Gn(e,n)}function Vr(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,oa(e,n)}}function bu(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=l:o=o.next=l,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ci(e,t,n,s){var r=e.updateQueue;qn=!1;var o=r.firstBaseUpdate,l=r.lastBaseUpdate,c=r.shared.pending;if(c!==null){r.shared.pending=null;var a=c,u=a.next;a.next=null,l===null?o=u:l.next=u,l=a;var f=e.alternate;f!==null&&(f=f.updateQueue,c=f.lastBaseUpdate,c!==l&&(c===null?f.firstBaseUpdate=u:c.next=u,f.lastBaseUpdate=a))}if(o!==null){var d=r.baseState;l=0,f=u=a=null,c=o;do{var p=c.lane,y=c.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var S=e,P=c;switch(p=t,y=n,P.tag){case 1:if(S=P.payload,typeof S=="function"){d=S.call(y,d,p);break e}d=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=P.payload,p=typeof S=="function"?S.call(y,d,p):S,p==null)break e;d=dt({},d,p);break e;case 2:qn=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,p=r.effects,p===null?r.effects=[c]:p.push(c))}else y={eventTime:y,lane:p,tag:c.tag,payload:c.payload,callback:c.callback,next:null},f===null?(u=f=y,a=d):f=f.next=y,l|=p;if(c=c.next,c===null){if(c=r.shared.pending,c===null)break;p=c,c=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(f===null&&(a=d),r.baseState=a,r.firstBaseUpdate=u,r.lastBaseUpdate=f,t=r.shared.interleaved,t!==null){r=t;do l|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Rs|=l,e.lanes=l,e.memoizedState=d}}function Mu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(fe(191,r));r.call(s)}}}var dr={},Tn=hs(dr),nr=hs(dr),sr=hs(dr);function Ss(e){if(e===dr)throw Error(fe(174));return e}function Sa(e,t){switch(et(sr,t),et(nr,e),et(Tn,dr),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:rc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=rc(t,e)}nt(Tn),et(Tn,t)}function co(){nt(Tn),nt(nr),nt(sr)}function i0(e){Ss(sr.current);var t=Ss(Tn.current),n=rc(t,e.type);t!==n&&(et(nr,e),et(Tn,n))}function Ca(e){nr.current===e&&(nt(Tn),nt(nr))}var ut=hs(0);function ki(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var vl=[];function ka(){for(var e=0;e<vl.length;e++)vl[e]._workInProgressVersionPrimary=null;vl.length=0}var qr=Hn.ReactCurrentDispatcher,Sl=Hn.ReactCurrentBatchConfig,Ps=0,ft=null,St=null,jt=null,wi=!1,zo=!1,or=0,j1=0;function Et(){throw Error(fe(321))}function wa(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Cn(e[n],t[n]))return!1;return!0}function ja(e,t,n,s,r,o){if(Ps=o,ft=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,qr.current=e===null||e.memoizedState===null?M1:T1,e=n(s,r),zo){o=0;do{if(zo=!1,or=0,25<=o)throw Error(fe(301));o+=1,jt=St=null,t.updateQueue=null,qr.current=E1,e=n(s,r)}while(zo)}if(qr.current=ji,t=St!==null&&St.next!==null,Ps=0,jt=St=ft=null,wi=!1,t)throw Error(fe(300));return e}function Pa(){var e=or!==0;return or=0,e}function wn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jt===null?ft.memoizedState=jt=e:jt=jt.next=e,jt}function cn(){if(St===null){var e=ft.alternate;e=e!==null?e.memoizedState:null}else e=St.next;var t=jt===null?ft.memoizedState:jt.next;if(t!==null)jt=t,St=e;else{if(e===null)throw Error(fe(310));St=e,e={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},jt===null?ft.memoizedState=jt=e:jt=jt.next=e}return jt}function rr(e,t){return typeof t=="function"?t(e):t}function Cl(e){var t=cn(),n=t.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=e;var s=St,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var l=r.next;r.next=o.next,o.next=l}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var c=l=null,a=null,u=o;do{var f=u.lane;if((Ps&f)===f)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var d={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(c=a=d,l=s):a=a.next=d,ft.lanes|=f,Rs|=f}u=u.next}while(u!==null&&u!==o);a===null?l=s:a.next=c,Cn(s,t.memoizedState)||(Bt=!0),t.memoizedState=s,t.baseState=l,t.baseQueue=a,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do o=r.lane,ft.lanes|=o,Rs|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function kl(e){var t=cn(),n=t.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var l=r=r.next;do o=e(o,l.action),l=l.next;while(l!==r);Cn(o,t.memoizedState)||(Bt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function l0(){}function c0(e,t){var n=ft,s=cn(),r=t(),o=!Cn(s.memoizedState,r);if(o&&(s.memoizedState=r,Bt=!0),s=s.queue,Ra(f0.bind(null,n,s,e),[e]),s.getSnapshot!==t||o||jt!==null&&jt.memoizedState.tag&1){if(n.flags|=2048,ir(9,u0.bind(null,n,s,r,t),void 0,null),Rt===null)throw Error(fe(349));Ps&30||a0(n,t,r)}return r}function a0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ft.updateQueue,t===null?(t={lastEffect:null,stores:null},ft.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function u0(e,t,n,s){t.value=n,t.getSnapshot=s,d0(t)&&p0(e)}function f0(e,t,n){return n(function(){d0(t)&&p0(e)})}function d0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!Cn(e,n)}catch{return!0}}function p0(e){var t=Gn(e,1);t!==null&&Sn(t,e,1,-1)}function Tu(e){var t=wn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:rr,lastRenderedState:e},t.queue=e,e=e.dispatch=b1.bind(null,ft,e),[t.memoizedState,e]}function ir(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=ft.updateQueue,t===null?(t={lastEffect:null,stores:null},ft.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function h0(){return cn().memoizedState}function Zr(e,t,n,s){var r=wn();ft.flags|=e,r.memoizedState=ir(1|t,n,void 0,s===void 0?null:s)}function Hi(e,t,n,s){var r=cn();s=s===void 0?null:s;var o=void 0;if(St!==null){var l=St.memoizedState;if(o=l.destroy,s!==null&&wa(s,l.deps)){r.memoizedState=ir(t,n,o,s);return}}ft.flags|=e,r.memoizedState=ir(1|t,n,o,s)}function Eu(e,t){return Zr(8390656,8,e,t)}function Ra(e,t){return Hi(2048,8,e,t)}function x0(e,t){return Hi(4,2,e,t)}function y0(e,t){return Hi(4,4,e,t)}function g0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function m0(e,t,n){return n=n!=null?n.concat([e]):null,Hi(4,4,g0.bind(null,t,e),n)}function ba(){}function v0(e,t){var n=cn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wa(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function S0(e,t){var n=cn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wa(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function C0(e,t,n){return Ps&21?(Cn(n,t)||(n=Rd(),ft.lanes|=n,Rs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Bt=!0),e.memoizedState=n)}function P1(e,t){var n=Ke;Ke=n!==0&&4>n?n:4,e(!0);var s=Sl.transition;Sl.transition={};try{e(!1),t()}finally{Ke=n,Sl.transition=s}}function k0(){return cn().memoizedState}function R1(e,t,n){var s=is(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},w0(e))j0(t,n);else if(n=o0(e,t,n,s),n!==null){var r=Ot();Sn(n,e,s,r),P0(n,t,s)}}function b1(e,t,n){var s=is(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(w0(e))j0(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,n);if(r.hasEagerState=!0,r.eagerState=c,Cn(c,l)){var a=t.interleaved;a===null?(r.next=r,ma(t)):(r.next=a.next,a.next=r),t.interleaved=r;return}}catch{}finally{}n=o0(e,t,r,s),n!==null&&(r=Ot(),Sn(n,e,s,r),P0(n,t,s))}}function w0(e){var t=e.alternate;return e===ft||t!==null&&t===ft}function j0(e,t){zo=wi=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function P0(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,oa(e,n)}}var ji={readContext:ln,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useInsertionEffect:Et,useLayoutEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useMutableSource:Et,useSyncExternalStore:Et,useId:Et,unstable_isNewReconciler:!1},M1={readContext:ln,useCallback:function(e,t){return wn().memoizedState=[e,t===void 0?null:t],e},useContext:ln,useEffect:Eu,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Zr(4194308,4,g0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Zr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Zr(4,2,e,t)},useMemo:function(e,t){var n=wn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=wn();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=R1.bind(null,ft,e),[s.memoizedState,e]},useRef:function(e){var t=wn();return e={current:e},t.memoizedState=e},useState:Tu,useDebugValue:ba,useDeferredValue:function(e){return wn().memoizedState=e},useTransition:function(){var e=Tu(!1),t=e[0];return e=P1.bind(null,e[1]),wn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=ft,r=wn();if(st){if(n===void 0)throw Error(fe(407));n=n()}else{if(n=t(),Rt===null)throw Error(fe(349));Ps&30||a0(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Eu(f0.bind(null,s,o,e),[e]),s.flags|=2048,ir(9,u0.bind(null,s,o,n,t),void 0,null),n},useId:function(){var e=wn(),t=Rt.identifierPrefix;if(st){var n=Nn,s=On;n=(s&~(1<<32-vn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=or++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=j1++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},T1={readContext:ln,useCallback:v0,useContext:ln,useEffect:Ra,useImperativeHandle:m0,useInsertionEffect:x0,useLayoutEffect:y0,useMemo:S0,useReducer:Cl,useRef:h0,useState:function(){return Cl(rr)},useDebugValue:ba,useDeferredValue:function(e){var t=cn();return C0(t,St.memoizedState,e)},useTransition:function(){var e=Cl(rr)[0],t=cn().memoizedState;return[e,t]},useMutableSource:l0,useSyncExternalStore:c0,useId:k0,unstable_isNewReconciler:!1},E1={readContext:ln,useCallback:v0,useContext:ln,useEffect:Ra,useImperativeHandle:m0,useInsertionEffect:x0,useLayoutEffect:y0,useMemo:S0,useReducer:kl,useRef:h0,useState:function(){return kl(rr)},useDebugValue:ba,useDeferredValue:function(e){var t=cn();return St===null?t.memoizedState=e:C0(t,St.memoizedState,e)},useTransition:function(){var e=kl(rr)[0],t=cn().memoizedState;return[e,t]},useMutableSource:l0,useSyncExternalStore:c0,useId:k0,unstable_isNewReconciler:!1};function un(e,t){if(e&&e.defaultProps){t=dt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Rc(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:dt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Wi={isMounted:function(e){return(e=e._reactInternals)?Ts(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Ot(),r=is(e),o=Fn(s,r);o.payload=t,n!=null&&(o.callback=n),t=os(e,o,r),t!==null&&(Sn(t,e,r,s),Vr(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Ot(),r=is(e),o=Fn(s,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=os(e,o,r),t!==null&&(Sn(t,e,r,s),Vr(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ot(),s=is(e),r=Fn(n,s);r.tag=2,t!=null&&(r.callback=t),t=os(e,r,s),t!==null&&(Sn(t,e,s,n),Vr(t,e,s))}};function Au(e,t,n,s,r,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,o,l):t.prototype&&t.prototype.isPureReactComponent?!Qo(n,s)||!Qo(r,o):!0}function R0(e,t,n){var s=!1,r=us,o=t.contextType;return typeof o=="object"&&o!==null?o=ln(o):(r=Gt(t)?ws:It.current,s=t.contextTypes,o=(s=s!=null)?ro(e,r):us),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Wi,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function _u(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Wi.enqueueReplaceState(t,t.state,null)}function bc(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},va(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=ln(o):(o=Gt(t)?ws:It.current,r.context=ro(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Rc(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Wi.enqueueReplaceState(r,r.state,null),Ci(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function ao(e,t){try{var n="",s=t;do n+=oh(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function wl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Mc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var A1=typeof WeakMap=="function"?WeakMap:Map;function b0(e,t,n){n=Fn(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Ri||(Ri=!0,$c=s),Mc(e,t)},n}function M0(e,t,n){n=Fn(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Mc(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Mc(e,t),typeof s!="function"&&(rs===null?rs=new Set([this]):rs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),n}function Iu(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new A1;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=W1.bind(null,e,t,n),t.then(e,e))}function Lu(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ou(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Fn(-1,1),t.tag=2,os(n,t,1))),n.lanes|=1),e)}var _1=Hn.ReactCurrentOwner,Bt=!1;function Lt(e,t,n,s){t.child=e===null?s0(t,null,n,s):lo(t,e.child,n,s)}function Nu(e,t,n,s,r){n=n.render;var o=t.ref;return no(t,r),s=ja(e,t,n,s,o,r),n=Pa(),e!==null&&!Bt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Yn(e,t,r)):(st&&n&&da(t),t.flags|=1,Lt(e,t,s,r),t.child)}function Du(e,t,n,s,r){if(e===null){var o=n.type;return typeof o=="function"&&!Oa(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,T0(e,t,o,s,r)):(e=ei(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var l=o.memoizedProps;if(n=n.compare,n=n!==null?n:Qo,n(l,s)&&e.ref===t.ref)return Yn(e,t,r)}return t.flags|=1,e=ls(o,s),e.ref=t.ref,e.return=t,t.child=e}function T0(e,t,n,s,r){if(e!==null){var o=e.memoizedProps;if(Qo(o,s)&&e.ref===t.ref)if(Bt=!1,t.pendingProps=s=o,(e.lanes&r)!==0)e.flags&131072&&(Bt=!0);else return t.lanes=e.lanes,Yn(e,t,r)}return Tc(e,t,n,s,r)}function E0(e,t,n){var s=t.pendingProps,r=s.children,o=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Zs,Ut),Ut|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,et(Zs,Ut),Ut|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,et(Zs,Ut),Ut|=s}else o!==null?(s=o.baseLanes|n,t.memoizedState=null):s=n,et(Zs,Ut),Ut|=s;return Lt(e,t,r,n),t.child}function A0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Tc(e,t,n,s,r){var o=Gt(n)?ws:It.current;return o=ro(t,o),no(t,r),n=ja(e,t,n,s,o,r),s=Pa(),e!==null&&!Bt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Yn(e,t,r)):(st&&s&&da(t),t.flags|=1,Lt(e,t,n,r),t.child)}function $u(e,t,n,s,r){if(Gt(n)){var o=!0;yi(t)}else o=!1;if(no(t,r),t.stateNode===null)Kr(e,t),R0(t,n,s),bc(t,n,s,r),s=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var a=l.context,u=n.contextType;typeof u=="object"&&u!==null?u=ln(u):(u=Gt(n)?ws:It.current,u=ro(t,u));var f=n.getDerivedStateFromProps,d=typeof f=="function"||typeof l.getSnapshotBeforeUpdate=="function";d||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==s||a!==u)&&_u(t,l,s,u),qn=!1;var p=t.memoizedState;l.state=p,Ci(t,s,l,r),a=t.memoizedState,c!==s||p!==a||zt.current||qn?(typeof f=="function"&&(Rc(t,n,f,s),a=t.memoizedState),(c=qn||Au(t,n,c,s,p,a,u))?(d||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=a),l.props=s,l.state=a,l.context=u,s=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{l=t.stateNode,r0(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:un(t.type,c),l.props=u,d=t.pendingProps,p=l.context,a=n.contextType,typeof a=="object"&&a!==null?a=ln(a):(a=Gt(n)?ws:It.current,a=ro(t,a));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==d||p!==a)&&_u(t,l,s,a),qn=!1,p=t.memoizedState,l.state=p,Ci(t,s,l,r);var S=t.memoizedState;c!==d||p!==S||zt.current||qn?(typeof y=="function"&&(Rc(t,n,y,s),S=t.memoizedState),(u=qn||Au(t,n,u,s,p,S,a)||!1)?(f||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(s,S,a),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(s,S,a)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=S),l.props=s,l.state=S,l.context=a,s=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return Ec(e,t,n,s,o,r)}function Ec(e,t,n,s,r,o){A0(e,t);var l=(t.flags&128)!==0;if(!s&&!l)return r&&wu(t,n,!1),Yn(e,t,o);s=t.stateNode,_1.current=t;var c=l&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&l?(t.child=lo(t,e.child,null,o),t.child=lo(t,null,c,o)):Lt(e,t,c,o),t.memoizedState=s.state,r&&wu(t,n,!0),t.child}function _0(e){var t=e.stateNode;t.pendingContext?ku(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ku(e,t.context,!1),Sa(e,t.containerInfo)}function Fu(e,t,n,s,r){return io(),ha(r),t.flags|=256,Lt(e,t,n,s),t.child}var Ac={dehydrated:null,treeContext:null,retryLane:0};function _c(e){return{baseLanes:e,cachePool:null,transitions:null}}function I0(e,t,n){var s=t.pendingProps,r=ut.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(r&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),et(ut,r&1),e===null)return jc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=Vi(l,s,0,null),e=ks(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=_c(n),t.memoizedState=Ac,e):Ma(t,l));if(r=e.memoizedState,r!==null&&(c=r.dehydrated,c!==null))return I1(e,t,l,s,c,r,n);if(o){o=s.fallback,l=t.mode,r=e.child,c=r.sibling;var a={mode:"hidden",children:s.children};return!(l&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=a,t.deletions=null):(s=ls(r,a),s.subtreeFlags=r.subtreeFlags&14680064),c!==null?o=ls(c,o):(o=ks(o,l,n,null),o.flags|=2),o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=e.child.memoizedState,l=l===null?_c(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Ac,s}return o=e.child,e=o.sibling,s=ls(o,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Ma(e,t){return t=Vi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Rr(e,t,n,s){return s!==null&&ha(s),lo(t,e.child,null,n),e=Ma(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function I1(e,t,n,s,r,o,l){if(n)return t.flags&256?(t.flags&=-257,s=wl(Error(fe(422))),Rr(e,t,l,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=s.fallback,r=t.mode,s=Vi({mode:"visible",children:s.children},r,0,null),o=ks(o,r,l,null),o.flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,t.mode&1&&lo(t,e.child,null,l),t.child.memoizedState=_c(l),t.memoizedState=Ac,o);if(!(t.mode&1))return Rr(e,t,l,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var c=s.dgst;return s=c,o=Error(fe(419)),s=wl(o,s,void 0),Rr(e,t,l,s)}if(c=(l&e.childLanes)!==0,Bt||c){if(s=Rt,s!==null){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|l)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Gn(e,r),Sn(s,e,r,-1))}return La(),s=wl(Error(fe(421))),Rr(e,t,l,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=U1.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,Xt=ss(r.nextSibling),Vt=t,st=!0,pn=null,e!==null&&(en[tn++]=On,en[tn++]=Nn,en[tn++]=js,On=e.id,Nn=e.overflow,js=t),t=Ma(t,s.children),t.flags|=4096,t)}function Bu(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Pc(e.return,t,n)}function jl(e,t,n,s,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function L0(e,t,n){var s=t.pendingProps,r=s.revealOrder,o=s.tail;if(Lt(e,t,s.children,n),s=ut.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Bu(e,n,t);else if(e.tag===19)Bu(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(et(ut,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&ki(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),jl(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&ki(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}jl(t,!0,n,null,o);break;case"together":jl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Kr(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Yn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Rs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(fe(153));if(t.child!==null){for(e=t.child,n=ls(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ls(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function L1(e,t,n){switch(t.tag){case 3:_0(t),io();break;case 5:i0(t);break;case 1:Gt(t.type)&&yi(t);break;case 4:Sa(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;et(vi,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(et(ut,ut.current&1),t.flags|=128,null):n&t.child.childLanes?I0(e,t,n):(et(ut,ut.current&1),e=Yn(e,t,n),e!==null?e.sibling:null);et(ut,ut.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return L0(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),et(ut,ut.current),s)break;return null;case 22:case 23:return t.lanes=0,E0(e,t,n)}return Yn(e,t,n)}var O0,Ic,N0,D0;O0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ic=function(){};N0=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Ss(Tn.current);var o=null;switch(n){case"input":r=tc(e,r),s=tc(e,s),o=[];break;case"select":r=dt({},r,{value:void 0}),s=dt({},s,{value:void 0}),o=[];break;case"textarea":r=oc(e,r),s=oc(e,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=hi)}ic(n,s);var l;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var c=r[u];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Wo.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var a=s[u];if(c=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&a!==c&&(a!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||a&&a.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in a)a.hasOwnProperty(l)&&c[l]!==a[l]&&(n||(n={}),n[l]=a[l])}else n||(o||(o=[]),o.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,c=c?c.__html:void 0,a!=null&&c!==a&&(o=o||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Wo.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&tt("scroll",e),o||c===a||(o=[])):(o=o||[]).push(u,a))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};D0=function(e,t,n,s){n!==s&&(t.flags|=4)};function wo(e,t){if(!st)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function At(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function O1(e,t,n){var s=t.pendingProps;switch(pa(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return At(t),null;case 1:return Gt(t.type)&&xi(),At(t),null;case 3:return s=t.stateNode,co(),nt(zt),nt(It),ka(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(jr(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pn!==null&&(zc(pn),pn=null))),Ic(e,t),At(t),null;case 5:Ca(t);var r=Ss(sr.current);if(n=t.type,e!==null&&t.stateNode!=null)N0(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(fe(166));return At(t),null}if(e=Ss(Tn.current),jr(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[Rn]=t,s[tr]=o,e=(t.mode&1)!==0,n){case"dialog":tt("cancel",s),tt("close",s);break;case"iframe":case"object":case"embed":tt("load",s);break;case"video":case"audio":for(r=0;r<Io.length;r++)tt(Io[r],s);break;case"source":tt("error",s);break;case"img":case"image":case"link":tt("error",s),tt("load",s);break;case"details":tt("toggle",s);break;case"input":qa(s,o),tt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},tt("invalid",s);break;case"textarea":Ka(s,o),tt("invalid",s)}ic(n,o),r=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?s.textContent!==c&&(o.suppressHydrationWarning!==!0&&wr(s.textContent,c,e),r=["children",c]):typeof c=="number"&&s.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&wr(s.textContent,c,e),r=["children",""+c]):Wo.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&tt("scroll",s)}switch(n){case"input":xr(s),Za(s,o,!0);break;case"textarea":xr(s),Qa(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=hi)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{l=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=fd(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=l.createElement(n,{is:s.is}):(e=l.createElement(n),n==="select"&&(l=e,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):e=l.createElementNS(e,n),e[Rn]=t,e[tr]=s,O0(e,t,!1,!1),t.stateNode=e;e:{switch(l=lc(n,s),n){case"dialog":tt("cancel",e),tt("close",e),r=s;break;case"iframe":case"object":case"embed":tt("load",e),r=s;break;case"video":case"audio":for(r=0;r<Io.length;r++)tt(Io[r],e);r=s;break;case"source":tt("error",e),r=s;break;case"img":case"image":case"link":tt("error",e),tt("load",e),r=s;break;case"details":tt("toggle",e),r=s;break;case"input":qa(e,s),r=tc(e,s),tt("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=dt({},s,{value:void 0}),tt("invalid",e);break;case"textarea":Ka(e,s),r=oc(e,s),tt("invalid",e);break;default:r=s}ic(n,r),c=r;for(o in c)if(c.hasOwnProperty(o)){var a=c[o];o==="style"?hd(e,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&dd(e,a)):o==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&Uo(e,a):typeof a=="number"&&Uo(e,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Wo.hasOwnProperty(o)?a!=null&&o==="onScroll"&&tt("scroll",e):a!=null&&Qc(e,o,a,l))}switch(n){case"input":xr(e),Za(e,s,!1);break;case"textarea":xr(e),Qa(e);break;case"option":s.value!=null&&e.setAttribute("value",""+as(s.value));break;case"select":e.multiple=!!s.multiple,o=s.value,o!=null?Qs(e,!!s.multiple,o,!1):s.defaultValue!=null&&Qs(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=hi)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return At(t),null;case 6:if(e&&t.stateNode!=null)D0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(fe(166));if(n=Ss(sr.current),Ss(Tn.current),jr(t)){if(s=t.stateNode,n=t.memoizedProps,s[Rn]=t,(o=s.nodeValue!==n)&&(e=Vt,e!==null))switch(e.tag){case 3:wr(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&wr(s.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Rn]=t,t.stateNode=s}return At(t),null;case 13:if(nt(ut),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(st&&Xt!==null&&t.mode&1&&!(t.flags&128))t0(),io(),t.flags|=98560,o=!1;else if(o=jr(t),s!==null&&s.dehydrated!==null){if(e===null){if(!o)throw Error(fe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(fe(317));o[Rn]=t}else io(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;At(t),o=!1}else pn!==null&&(zc(pn),pn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||ut.current&1?Ct===0&&(Ct=3):La())),t.updateQueue!==null&&(t.flags|=4),At(t),null);case 4:return co(),Ic(e,t),e===null&&Jo(t.stateNode.containerInfo),At(t),null;case 10:return ga(t.type._context),At(t),null;case 17:return Gt(t.type)&&xi(),At(t),null;case 19:if(nt(ut),o=t.memoizedState,o===null)return At(t),null;if(s=(t.flags&128)!==0,l=o.rendering,l===null)if(s)wo(o,!1);else{if(Ct!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=ki(e),l!==null){for(t.flags|=128,wo(o,!1),s=l.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)o=n,e=s,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return et(ut,ut.current&1|2),t.child}e=e.sibling}o.tail!==null&&yt()>uo&&(t.flags|=128,s=!0,wo(o,!1),t.lanes=4194304)}else{if(!s)if(e=ki(l),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),wo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!st)return At(t),null}else 2*yt()-o.renderingStartTime>uo&&n!==1073741824&&(t.flags|=128,s=!0,wo(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(n=o.last,n!==null?n.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=yt(),t.sibling=null,n=ut.current,et(ut,s?n&1|2:n&1),t):(At(t),null);case 22:case 23:return Ia(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Ut&1073741824&&(At(t),t.subtreeFlags&6&&(t.flags|=8192)):At(t),null;case 24:return null;case 25:return null}throw Error(fe(156,t.tag))}function N1(e,t){switch(pa(t),t.tag){case 1:return Gt(t.type)&&xi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return co(),nt(zt),nt(It),ka(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ca(t),null;case 13:if(nt(ut),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(fe(340));io()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return nt(ut),null;case 4:return co(),null;case 10:return ga(t.type._context),null;case 22:case 23:return Ia(),null;case 24:return null;default:return null}}var br=!1,_t=!1,D1=typeof WeakSet=="function"?WeakSet:Set,Re=null;function qs(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){ht(e,t,s)}else n.current=null}function Lc(e,t,n){try{n()}catch(s){ht(e,t,s)}}var zu=!1;function $1(e,t){if(gc=fi,e=Gd(),fa(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var l=0,c=-1,a=-1,u=0,f=0,d=e,p=null;t:for(;;){for(var y;d!==n||r!==0&&d.nodeType!==3||(c=l+r),d!==o||s!==0&&d.nodeType!==3||(a=l+s),d.nodeType===3&&(l+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===e)break t;if(p===n&&++u===r&&(c=l),p===o&&++f===s&&(a=l),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}n=c===-1||a===-1?null:{start:c,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(mc={focusedElem:e,selectionRange:n},fi=!1,Re=t;Re!==null;)if(t=Re,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Re=e;else for(;Re!==null;){t=Re;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var P=S.memoizedProps,C=S.memoizedState,g=t.stateNode,h=g.getSnapshotBeforeUpdate(t.elementType===t.type?P:un(t.type,P),C);g.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(m){ht(t,t.return,m)}if(e=t.sibling,e!==null){e.return=t.return,Re=e;break}Re=t.return}return S=zu,zu=!1,S}function Go(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Lc(t,n,o)}r=r.next}while(r!==s)}}function Ui(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Oc(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function $0(e){var t=e.alternate;t!==null&&(e.alternate=null,$0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Rn],delete t[tr],delete t[Cc],delete t[S1],delete t[C1])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function F0(e){return e.tag===5||e.tag===3||e.tag===4}function Gu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||F0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Nc(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=hi));else if(s!==4&&(e=e.child,e!==null))for(Nc(e,t,n),e=e.sibling;e!==null;)Nc(e,t,n),e=e.sibling}function Dc(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(Dc(e,t,n),e=e.sibling;e!==null;)Dc(e,t,n),e=e.sibling}var bt=null,fn=!1;function Un(e,t,n){for(n=n.child;n!==null;)B0(e,t,n),n=n.sibling}function B0(e,t,n){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount($i,n)}catch{}switch(n.tag){case 5:_t||qs(n,t);case 6:var s=bt,r=fn;bt=null,Un(e,t,n),bt=s,fn=r,bt!==null&&(fn?(e=bt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):bt.removeChild(n.stateNode));break;case 18:bt!==null&&(fn?(e=bt,n=n.stateNode,e.nodeType===8?gl(e.parentNode,n):e.nodeType===1&&gl(e,n),Zo(e)):gl(bt,n.stateNode));break;case 4:s=bt,r=fn,bt=n.stateNode.containerInfo,fn=!0,Un(e,t,n),bt=s,fn=r;break;case 0:case 11:case 14:case 15:if(!_t&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&Lc(n,t,l),r=r.next}while(r!==s)}Un(e,t,n);break;case 1:if(!_t&&(qs(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(c){ht(n,t,c)}Un(e,t,n);break;case 21:Un(e,t,n);break;case 22:n.mode&1?(_t=(s=_t)||n.memoizedState!==null,Un(e,t,n),_t=s):Un(e,t,n);break;default:Un(e,t,n)}}function Yu(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new D1),t.forEach(function(s){var r=X1.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function an(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:bt=c.stateNode,fn=!1;break e;case 3:bt=c.stateNode.containerInfo,fn=!0;break e;case 4:bt=c.stateNode.containerInfo,fn=!0;break e}c=c.return}if(bt===null)throw Error(fe(160));B0(o,l,r),bt=null,fn=!1;var a=r.alternate;a!==null&&(a.return=null),r.return=null}catch(u){ht(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)z0(t,e),t=t.sibling}function z0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(an(t,e),kn(e),s&4){try{Go(3,e,e.return),Ui(3,e)}catch(P){ht(e,e.return,P)}try{Go(5,e,e.return)}catch(P){ht(e,e.return,P)}}break;case 1:an(t,e),kn(e),s&512&&n!==null&&qs(n,n.return);break;case 5:if(an(t,e),kn(e),s&512&&n!==null&&qs(n,n.return),e.flags&32){var r=e.stateNode;try{Uo(r,"")}catch(P){ht(e,e.return,P)}}if(s&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,l=n!==null?n.memoizedProps:o,c=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&ad(r,o),lc(c,l);var u=lc(c,o);for(l=0;l<a.length;l+=2){var f=a[l],d=a[l+1];f==="style"?hd(r,d):f==="dangerouslySetInnerHTML"?dd(r,d):f==="children"?Uo(r,d):Qc(r,f,d,u)}switch(c){case"input":nc(r,o);break;case"textarea":ud(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?Qs(r,!!o.multiple,y,!1):p!==!!o.multiple&&(o.defaultValue!=null?Qs(r,!!o.multiple,o.defaultValue,!0):Qs(r,!!o.multiple,o.multiple?[]:"",!1))}r[tr]=o}catch(P){ht(e,e.return,P)}}break;case 6:if(an(t,e),kn(e),s&4){if(e.stateNode===null)throw Error(fe(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(P){ht(e,e.return,P)}}break;case 3:if(an(t,e),kn(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Zo(t.containerInfo)}catch(P){ht(e,e.return,P)}break;case 4:an(t,e),kn(e);break;case 13:an(t,e),kn(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Aa=yt())),s&4&&Yu(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(_t=(u=_t)||f,an(t,e),_t=u):an(t,e),kn(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!f&&e.mode&1)for(Re=e,f=e.child;f!==null;){for(d=Re=f;Re!==null;){switch(p=Re,y=p.child,p.tag){case 0:case 11:case 14:case 15:Go(4,p,p.return);break;case 1:qs(p,p.return);var S=p.stateNode;if(typeof S.componentWillUnmount=="function"){s=p,n=p.return;try{t=s,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(P){ht(s,n,P)}}break;case 5:qs(p,p.return);break;case 22:if(p.memoizedState!==null){Wu(d);continue}}y!==null?(y.return=p,Re=y):Wu(d)}f=f.sibling}e:for(f=null,d=e;;){if(d.tag===5){if(f===null){f=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=d.stateNode,a=d.memoizedProps.style,l=a!=null&&a.hasOwnProperty("display")?a.display:null,c.style.display=pd("display",l))}catch(P){ht(e,e.return,P)}}}else if(d.tag===6){if(f===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(P){ht(e,e.return,P)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:an(t,e),kn(e),s&4&&Yu(e);break;case 21:break;default:an(t,e),kn(e)}}function kn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(F0(n)){var s=n;break e}n=n.return}throw Error(fe(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Uo(r,""),s.flags&=-33);var o=Gu(e);Dc(e,o,r);break;case 3:case 4:var l=s.stateNode.containerInfo,c=Gu(e);Nc(e,c,l);break;default:throw Error(fe(161))}}catch(a){ht(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function F1(e,t,n){Re=e,G0(e)}function G0(e,t,n){for(var s=(e.mode&1)!==0;Re!==null;){var r=Re,o=r.child;if(r.tag===22&&s){var l=r.memoizedState!==null||br;if(!l){var c=r.alternate,a=c!==null&&c.memoizedState!==null||_t;c=br;var u=_t;if(br=l,(_t=a)&&!u)for(Re=r;Re!==null;)l=Re,a=l.child,l.tag===22&&l.memoizedState!==null?Uu(r):a!==null?(a.return=l,Re=a):Uu(r);for(;o!==null;)Re=o,G0(o),o=o.sibling;Re=r,br=c,_t=u}Hu(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Re=o):Hu(e)}}function Hu(e){for(;Re!==null;){var t=Re;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:_t||Ui(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!_t)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:un(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Mu(t,o,s);break;case 3:var l=t.updateQueue;if(l!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Mu(t,l,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var d=f.dehydrated;d!==null&&Zo(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}_t||t.flags&512&&Oc(t)}catch(p){ht(t,t.return,p)}}if(t===e){Re=null;break}if(n=t.sibling,n!==null){n.return=t.return,Re=n;break}Re=t.return}}function Wu(e){for(;Re!==null;){var t=Re;if(t===e){Re=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Re=n;break}Re=t.return}}function Uu(e){for(;Re!==null;){var t=Re;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Ui(4,t)}catch(a){ht(t,n,a)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(a){ht(t,r,a)}}var o=t.return;try{Oc(t)}catch(a){ht(t,o,a)}break;case 5:var l=t.return;try{Oc(t)}catch(a){ht(t,l,a)}}}catch(a){ht(t,t.return,a)}if(t===e){Re=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Re=c;break}Re=t.return}}var B1=Math.ceil,Pi=Hn.ReactCurrentDispatcher,Ta=Hn.ReactCurrentOwner,on=Hn.ReactCurrentBatchConfig,qe=0,Rt=null,mt=null,Mt=0,Ut=0,Zs=hs(0),Ct=0,lr=null,Rs=0,Xi=0,Ea=0,Yo=null,Ft=null,Aa=0,uo=1/0,_n=null,Ri=!1,$c=null,rs=null,Mr=!1,Jn=null,bi=0,Ho=0,Fc=null,Qr=-1,Jr=0;function Ot(){return qe&6?yt():Qr!==-1?Qr:Qr=yt()}function is(e){return e.mode&1?qe&2&&Mt!==0?Mt&-Mt:w1.transition!==null?(Jr===0&&(Jr=Rd()),Jr):(e=Ke,e!==0||(e=window.event,e=e===void 0?16:Id(e.type)),e):1}function Sn(e,t,n,s){if(50<Ho)throw Ho=0,Fc=null,Error(fe(185));ar(e,n,s),(!(qe&2)||e!==Rt)&&(e===Rt&&(!(qe&2)&&(Xi|=n),Ct===4&&Kn(e,Mt)),Yt(e,s),n===1&&qe===0&&!(t.mode&1)&&(uo=yt()+500,Yi&&xs()))}function Yt(e,t){var n=e.callbackNode;wh(e,t);var s=ui(e,e===Rt?Mt:0);if(s===0)n!==null&&tu(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&tu(n),t===1)e.tag===0?k1(Xu.bind(null,e)):Qd(Xu.bind(null,e)),m1(function(){!(qe&6)&&xs()}),n=null;else{switch(bd(s)){case 1:n=sa;break;case 4:n=jd;break;case 16:n=ai;break;case 536870912:n=Pd;break;default:n=ai}n=Z0(n,Y0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Y0(e,t){if(Qr=-1,Jr=0,qe&6)throw Error(fe(327));var n=e.callbackNode;if(so()&&e.callbackNode!==n)return null;var s=ui(e,e===Rt?Mt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=Mi(e,s);else{t=s;var r=qe;qe|=2;var o=W0();(Rt!==e||Mt!==t)&&(_n=null,uo=yt()+500,Cs(e,t));do try{Y1();break}catch(c){H0(e,c)}while(1);ya(),Pi.current=o,qe=r,mt!==null?t=0:(Rt=null,Mt=0,t=Ct)}if(t!==0){if(t===2&&(r=dc(e),r!==0&&(s=r,t=Bc(e,r))),t===1)throw n=lr,Cs(e,0),Kn(e,s),Yt(e,yt()),n;if(t===6)Kn(e,s);else{if(r=e.current.alternate,!(s&30)&&!z1(r)&&(t=Mi(e,s),t===2&&(o=dc(e),o!==0&&(s=o,t=Bc(e,o))),t===1))throw n=lr,Cs(e,0),Kn(e,s),Yt(e,yt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(fe(345));case 2:gs(e,Ft,_n);break;case 3:if(Kn(e,s),(s&130023424)===s&&(t=Aa+500-yt(),10<t)){if(ui(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Ot(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Sc(gs.bind(null,e,Ft,_n),t);break}gs(e,Ft,_n);break;case 4:if(Kn(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var l=31-vn(s);o=1<<l,l=t[l],l>r&&(r=l),s&=~o}if(s=r,s=yt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*B1(s/1960))-s,10<s){e.timeoutHandle=Sc(gs.bind(null,e,Ft,_n),s);break}gs(e,Ft,_n);break;case 5:gs(e,Ft,_n);break;default:throw Error(fe(329))}}}return Yt(e,yt()),e.callbackNode===n?Y0.bind(null,e):null}function Bc(e,t){var n=Yo;return e.current.memoizedState.isDehydrated&&(Cs(e,t).flags|=256),e=Mi(e,t),e!==2&&(t=Ft,Ft=n,t!==null&&zc(t)),e}function zc(e){Ft===null?Ft=e:Ft.push.apply(Ft,e)}function z1(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!Cn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kn(e,t){for(t&=~Ea,t&=~Xi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-vn(t),s=1<<n;e[n]=-1,t&=~s}}function Xu(e){if(qe&6)throw Error(fe(327));so();var t=ui(e,0);if(!(t&1))return Yt(e,yt()),null;var n=Mi(e,t);if(e.tag!==0&&n===2){var s=dc(e);s!==0&&(t=s,n=Bc(e,s))}if(n===1)throw n=lr,Cs(e,0),Kn(e,t),Yt(e,yt()),n;if(n===6)throw Error(fe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,gs(e,Ft,_n),Yt(e,yt()),null}function _a(e,t){var n=qe;qe|=1;try{return e(t)}finally{qe=n,qe===0&&(uo=yt()+500,Yi&&xs())}}function bs(e){Jn!==null&&Jn.tag===0&&!(qe&6)&&so();var t=qe;qe|=1;var n=on.transition,s=Ke;try{if(on.transition=null,Ke=1,e)return e()}finally{Ke=s,on.transition=n,qe=t,!(qe&6)&&xs()}}function Ia(){Ut=Zs.current,nt(Zs)}function Cs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,g1(n)),mt!==null)for(n=mt.return;n!==null;){var s=n;switch(pa(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&xi();break;case 3:co(),nt(zt),nt(It),ka();break;case 5:Ca(s);break;case 4:co();break;case 13:nt(ut);break;case 19:nt(ut);break;case 10:ga(s.type._context);break;case 22:case 23:Ia()}n=n.return}if(Rt=e,mt=e=ls(e.current,null),Mt=Ut=t,Ct=0,lr=null,Ea=Xi=Rs=0,Ft=Yo=null,vs!==null){for(t=0;t<vs.length;t++)if(n=vs[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var l=o.next;o.next=r,s.next=l}n.pending=s}vs=null}return e}function H0(e,t){do{var n=mt;try{if(ya(),qr.current=ji,wi){for(var s=ft.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}wi=!1}if(Ps=0,jt=St=ft=null,zo=!1,or=0,Ta.current=null,n===null||n.return===null){Ct=1,lr=t,mt=null;break}e:{var o=e,l=n.return,c=n,a=t;if(t=Mt,c.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,f=c,d=f.tag;if(!(f.mode&1)&&(d===0||d===11||d===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=Lu(l);if(y!==null){y.flags&=-257,Ou(y,l,c,o,t),y.mode&1&&Iu(o,u,t),t=y,a=u;var S=t.updateQueue;if(S===null){var P=new Set;P.add(a),t.updateQueue=P}else S.add(a);break e}else{if(!(t&1)){Iu(o,u,t),La();break e}a=Error(fe(426))}}else if(st&&c.mode&1){var C=Lu(l);if(C!==null){!(C.flags&65536)&&(C.flags|=256),Ou(C,l,c,o,t),ha(ao(a,c));break e}}o=a=ao(a,c),Ct!==4&&(Ct=2),Yo===null?Yo=[o]:Yo.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var g=b0(o,a,t);bu(o,g);break e;case 1:c=a;var h=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(rs===null||!rs.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var m=M0(o,c,t);bu(o,m);break e}}o=o.return}while(o!==null)}X0(n)}catch(j){t=j,mt===n&&n!==null&&(mt=n=n.return);continue}break}while(1)}function W0(){var e=Pi.current;return Pi.current=ji,e===null?ji:e}function La(){(Ct===0||Ct===3||Ct===2)&&(Ct=4),Rt===null||!(Rs&268435455)&&!(Xi&268435455)||Kn(Rt,Mt)}function Mi(e,t){var n=qe;qe|=2;var s=W0();(Rt!==e||Mt!==t)&&(_n=null,Cs(e,t));do try{G1();break}catch(r){H0(e,r)}while(1);if(ya(),qe=n,Pi.current=s,mt!==null)throw Error(fe(261));return Rt=null,Mt=0,Ct}function G1(){for(;mt!==null;)U0(mt)}function Y1(){for(;mt!==null&&!hh();)U0(mt)}function U0(e){var t=q0(e.alternate,e,Ut);e.memoizedProps=e.pendingProps,t===null?X0(e):mt=t,Ta.current=null}function X0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=N1(n,t),n!==null){n.flags&=32767,mt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ct=6,mt=null;return}}else if(n=O1(n,t,Ut),n!==null){mt=n;return}if(t=t.sibling,t!==null){mt=t;return}mt=t=e}while(t!==null);Ct===0&&(Ct=5)}function gs(e,t,n){var s=Ke,r=on.transition;try{on.transition=null,Ke=1,H1(e,t,n,s)}finally{on.transition=r,Ke=s}return null}function H1(e,t,n,s){do so();while(Jn!==null);if(qe&6)throw Error(fe(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(fe(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(jh(e,o),e===Rt&&(mt=Rt=null,Mt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Mr||(Mr=!0,Z0(ai,function(){return so(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=on.transition,on.transition=null;var l=Ke;Ke=1;var c=qe;qe|=4,Ta.current=null,$1(e,n),z0(n,e),u1(mc),fi=!!gc,mc=gc=null,e.current=n,F1(n),xh(),qe=c,Ke=l,on.transition=o}else e.current=n;if(Mr&&(Mr=!1,Jn=e,bi=r),o=e.pendingLanes,o===0&&(rs=null),mh(n.stateNode),Yt(e,yt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Ri)throw Ri=!1,e=$c,$c=null,e;return bi&1&&e.tag!==0&&so(),o=e.pendingLanes,o&1?e===Fc?Ho++:(Ho=0,Fc=e):Ho=0,xs(),null}function so(){if(Jn!==null){var e=bd(bi),t=on.transition,n=Ke;try{if(on.transition=null,Ke=16>e?16:e,Jn===null)var s=!1;else{if(e=Jn,Jn=null,bi=0,qe&6)throw Error(fe(331));var r=qe;for(qe|=4,Re=e.current;Re!==null;){var o=Re,l=o.child;if(Re.flags&16){var c=o.deletions;if(c!==null){for(var a=0;a<c.length;a++){var u=c[a];for(Re=u;Re!==null;){var f=Re;switch(f.tag){case 0:case 11:case 15:Go(8,f,o)}var d=f.child;if(d!==null)d.return=f,Re=d;else for(;Re!==null;){f=Re;var p=f.sibling,y=f.return;if($0(f),f===u){Re=null;break}if(p!==null){p.return=y,Re=p;break}Re=y}}}var S=o.alternate;if(S!==null){var P=S.child;if(P!==null){S.child=null;do{var C=P.sibling;P.sibling=null,P=C}while(P!==null)}}Re=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Re=l;else e:for(;Re!==null;){if(o=Re,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Go(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,Re=g;break e}Re=o.return}}var h=e.current;for(Re=h;Re!==null;){l=Re;var x=l.child;if(l.subtreeFlags&2064&&x!==null)x.return=l,Re=x;else e:for(l=h;Re!==null;){if(c=Re,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Ui(9,c)}}catch(j){ht(c,c.return,j)}if(c===l){Re=null;break e}var m=c.sibling;if(m!==null){m.return=c.return,Re=m;break e}Re=c.return}}if(qe=r,xs(),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot($i,e)}catch{}s=!0}return s}finally{Ke=n,on.transition=t}}return!1}function Vu(e,t,n){t=ao(n,t),t=b0(e,t,1),e=os(e,t,1),t=Ot(),e!==null&&(ar(e,1,t),Yt(e,t))}function ht(e,t,n){if(e.tag===3)Vu(e,e,n);else for(;t!==null;){if(t.tag===3){Vu(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(rs===null||!rs.has(s))){e=ao(n,e),e=M0(t,e,1),t=os(t,e,1),e=Ot(),t!==null&&(ar(t,1,e),Yt(t,e));break}}t=t.return}}function W1(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Ot(),e.pingedLanes|=e.suspendedLanes&n,Rt===e&&(Mt&n)===n&&(Ct===4||Ct===3&&(Mt&130023424)===Mt&&500>yt()-Aa?Cs(e,0):Ea|=n),Yt(e,t)}function V0(e,t){t===0&&(e.mode&1?(t=mr,mr<<=1,!(mr&130023424)&&(mr=4194304)):t=1);var n=Ot();e=Gn(e,t),e!==null&&(ar(e,t,n),Yt(e,n))}function U1(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),V0(e,n)}function X1(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(fe(314))}s!==null&&s.delete(t),V0(e,n)}var q0;q0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||zt.current)Bt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Bt=!1,L1(e,t,n);Bt=!!(e.flags&131072)}else Bt=!1,st&&t.flags&1048576&&Jd(t,mi,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Kr(e,t),e=t.pendingProps;var r=ro(t,It.current);no(t,n),r=ja(null,t,s,e,r,n);var o=Pa();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gt(s)?(o=!0,yi(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,va(t),r.updater=Wi,t.stateNode=r,r._reactInternals=t,bc(t,s,e,n),t=Ec(null,t,s,!0,o,n)):(t.tag=0,st&&o&&da(t),Lt(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Kr(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=q1(s),e=un(s,e),r){case 0:t=Tc(null,t,s,e,n);break e;case 1:t=$u(null,t,s,e,n);break e;case 11:t=Nu(null,t,s,e,n);break e;case 14:t=Du(null,t,s,un(s.type,e),n);break e}throw Error(fe(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:un(s,r),Tc(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:un(s,r),$u(e,t,s,r,n);case 3:e:{if(_0(t),e===null)throw Error(fe(387));s=t.pendingProps,o=t.memoizedState,r=o.element,r0(e,t),Ci(t,s,null,n);var l=t.memoizedState;if(s=l.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=ao(Error(fe(423)),t),t=Fu(e,t,s,n,r);break e}else if(s!==r){r=ao(Error(fe(424)),t),t=Fu(e,t,s,n,r);break e}else for(Xt=ss(t.stateNode.containerInfo.firstChild),Vt=t,st=!0,pn=null,n=s0(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(io(),s===r){t=Yn(e,t,n);break e}Lt(e,t,s,n)}t=t.child}return t;case 5:return i0(t),e===null&&jc(t),s=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,l=r.children,vc(s,r)?l=null:o!==null&&vc(s,o)&&(t.flags|=32),A0(e,t),Lt(e,t,l,n),t.child;case 6:return e===null&&jc(t),null;case 13:return I0(e,t,n);case 4:return Sa(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=lo(t,null,s,n):Lt(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:un(s,r),Nu(e,t,s,r,n);case 7:return Lt(e,t,t.pendingProps,n),t.child;case 8:return Lt(e,t,t.pendingProps.children,n),t.child;case 12:return Lt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,o=t.memoizedProps,l=r.value,et(vi,s._currentValue),s._currentValue=l,o!==null)if(Cn(o.value,l)){if(o.children===r.children&&!zt.current){t=Yn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var a=c.firstContext;a!==null;){if(a.context===s){if(o.tag===1){a=Fn(-1,n&-n),a.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?a.next=a:(a.next=f.next,f.next=a),u.pending=a}}o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Pc(o.return,n,t),c.lanes|=n;break}a=a.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(fe(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),Pc(l,n,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}Lt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,no(t,n),r=ln(r),s=s(r),t.flags|=1,Lt(e,t,s,n),t.child;case 14:return s=t.type,r=un(s,t.pendingProps),r=un(s.type,r),Du(e,t,s,r,n);case 15:return T0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:un(s,r),Kr(e,t),t.tag=1,Gt(s)?(e=!0,yi(t)):e=!1,no(t,n),R0(t,s,r),bc(t,s,r,n),Ec(null,t,s,!0,e,n);case 19:return L0(e,t,n);case 22:return E0(e,t,n)}throw Error(fe(156,t.tag))};function Z0(e,t){return wd(e,t)}function V1(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sn(e,t,n,s){return new V1(e,t,n,s)}function Oa(e){return e=e.prototype,!(!e||!e.isReactComponent)}function q1(e){if(typeof e=="function")return Oa(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ea)return 11;if(e===ta)return 14}return 2}function ls(e,t){var n=e.alternate;return n===null?(n=sn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ei(e,t,n,s,r,o){var l=2;if(s=e,typeof e=="function")Oa(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Bs:return ks(n.children,r,o,t);case Jc:l=8,r|=8;break;case Kl:return e=sn(12,n,t,r|2),e.elementType=Kl,e.lanes=o,e;case Ql:return e=sn(13,n,t,r),e.elementType=Ql,e.lanes=o,e;case Jl:return e=sn(19,n,t,r),e.elementType=Jl,e.lanes=o,e;case id:return Vi(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case od:l=10;break e;case rd:l=9;break e;case ea:l=11;break e;case ta:l=14;break e;case Vn:l=16,s=null;break e}throw Error(fe(130,e==null?e:typeof e,""))}return t=sn(l,n,t,r),t.elementType=e,t.type=s,t.lanes=o,t}function ks(e,t,n,s){return e=sn(7,e,s,t),e.lanes=n,e}function Vi(e,t,n,s){return e=sn(22,e,s,t),e.elementType=id,e.lanes=n,e.stateNode={isHidden:!1},e}function Pl(e,t,n){return e=sn(6,e,null,t),e.lanes=n,e}function Rl(e,t,n){return t=sn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Z1(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=il(0),this.expirationTimes=il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=il(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Na(e,t,n,s,r,o,l,c,a){return e=new Z1(e,t,n,c,a),t===1?(t=1,o===!0&&(t|=8)):t=0,o=sn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},va(o),e}function K1(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fs,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function K0(e){if(!e)return us;e=e._reactInternals;e:{if(Ts(e)!==e||e.tag!==1)throw Error(fe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(fe(171))}if(e.tag===1){var n=e.type;if(Gt(n))return Kd(e,n,t)}return t}function Q0(e,t,n,s,r,o,l,c,a){return e=Na(n,s,!0,e,r,o,l,c,a),e.context=K0(null),n=e.current,s=Ot(),r=is(n),o=Fn(s,r),o.callback=t??null,os(n,o,r),e.current.lanes=r,ar(e,r,s),Yt(e,s),e}function qi(e,t,n,s){var r=t.current,o=Ot(),l=is(r);return n=K0(n),t.context===null?t.context=n:t.pendingContext=n,t=Fn(o,l),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=os(r,t,l),e!==null&&(Sn(e,r,l,o),Vr(e,r,l)),l}function Ti(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function qu(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Da(e,t){qu(e,t),(e=e.alternate)&&qu(e,t)}function Q1(){return null}var J0=typeof reportError=="function"?reportError:function(e){console.error(e)};function $a(e){this._internalRoot=e}Zi.prototype.render=$a.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(fe(409));qi(e,t,null,null)};Zi.prototype.unmount=$a.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;bs(function(){qi(null,e,null,null)}),t[zn]=null}};function Zi(e){this._internalRoot=e}Zi.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ed();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Zn.length&&t!==0&&t<Zn[n].priority;n++);Zn.splice(n,0,e),n===0&&_d(e)}};function Fa(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ki(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Zu(){}function J1(e,t,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Ti(l);o.call(u)}}var l=Q0(t,s,e,0,null,!1,!1,"",Zu);return e._reactRootContainer=l,e[zn]=l.current,Jo(e.nodeType===8?e.parentNode:e),bs(),l}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var c=s;s=function(){var u=Ti(a);c.call(u)}}var a=Na(e,0,!1,null,null,!1,!1,"",Zu);return e._reactRootContainer=a,e[zn]=a.current,Jo(e.nodeType===8?e.parentNode:e),bs(function(){qi(t,a,n,s)}),a}function Qi(e,t,n,s,r){var o=n._reactRootContainer;if(o){var l=o;if(typeof r=="function"){var c=r;r=function(){var a=Ti(l);c.call(a)}}qi(t,l,e,r)}else l=J1(n,t,e,r,s);return Ti(l)}Md=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=_o(t.pendingLanes);n!==0&&(oa(t,n|1),Yt(t,yt()),!(qe&6)&&(uo=yt()+500,xs()))}break;case 13:bs(function(){var s=Gn(e,1);if(s!==null){var r=Ot();Sn(s,e,1,r)}}),Da(e,1)}};ra=function(e){if(e.tag===13){var t=Gn(e,134217728);if(t!==null){var n=Ot();Sn(t,e,134217728,n)}Da(e,134217728)}};Td=function(e){if(e.tag===13){var t=is(e),n=Gn(e,t);if(n!==null){var s=Ot();Sn(n,e,t,s)}Da(e,t)}};Ed=function(){return Ke};Ad=function(e,t){var n=Ke;try{return Ke=e,t()}finally{Ke=n}};ac=function(e,t,n){switch(t){case"input":if(nc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=Gi(s);if(!r)throw Error(fe(90));cd(s),nc(s,r)}}}break;case"textarea":ud(e,n);break;case"select":t=n.value,t!=null&&Qs(e,!!n.multiple,t,!1)}};gd=_a;md=bs;var ex={usingClientEntryPoint:!1,Events:[fr,Hs,Gi,xd,yd,_a]},jo={findFiberByHostInstance:ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tx={bundleType:jo.bundleType,version:jo.version,rendererPackageName:jo.rendererPackageName,rendererConfig:jo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Cd(e),e===null?null:e.stateNode},findFiberByHostInstance:jo.findFiberByHostInstance||Q1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tr.isDisabled&&Tr.supportsFiber)try{$i=Tr.inject(tx),Mn=Tr}catch{}}Zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ex;Zt.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fa(t))throw Error(fe(200));return K1(e,t,null,n)};Zt.createRoot=function(e,t){if(!Fa(e))throw Error(fe(299));var n=!1,s="",r=J0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Na(e,1,!1,null,null,n,!1,s,r),e[zn]=t.current,Jo(e.nodeType===8?e.parentNode:e),new $a(t)};Zt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(fe(188)):(e=Object.keys(e).join(","),Error(fe(268,e)));return e=Cd(t),e=e===null?null:e.stateNode,e};Zt.flushSync=function(e){return bs(e)};Zt.hydrate=function(e,t,n){if(!Ki(t))throw Error(fe(200));return Qi(null,e,t,!0,n)};Zt.hydrateRoot=function(e,t,n){if(!Fa(e))throw Error(fe(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",l=J0;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),t=Q0(t,null,e,1,n??null,r,!1,o,l),e[zn]=t.current,Jo(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Zi(t)};Zt.render=function(e,t,n){if(!Ki(t))throw Error(fe(200));return Qi(null,e,t,!1,n)};Zt.unmountComponentAtNode=function(e){if(!Ki(e))throw Error(fe(40));return e._reactRootContainer?(bs(function(){Qi(null,null,e,!1,function(){e._reactRootContainer=null,e[zn]=null})}),!0):!1};Zt.unstable_batchedUpdates=_a;Zt.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Ki(n))throw Error(fe(200));if(e==null||e._reactInternals===void 0)throw Error(fe(38));return Qi(e,t,n,!1,s)};Zt.version="18.3.1-next-f1338f8080-20240426";function ep(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ep)}catch(e){console.error(e)}}ep(),ed.exports=Zt;var nx=ed.exports,Ku=nx;ql.createRoot=Ku.createRoot,ql.hydrateRoot=Ku.hydrateRoot;var be=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e.T_I="T_I",e.T_L="T_L",e.T_T="T_T",e.T_S="T_S",e.T_O="T_O",e.T_I_C="T_I_C",e.T_L_C="T_L_C",e.T_T_C="T_T_C",e.T_S_C="T_S_C",e.T_O_C="T_O_C",e.P_I="P_I",e.P_L="P_L",e.P_X="P_X",e.P_U="P_U",e.P_L2="P_L2",e.P_Y="P_Y",e.P_T="P_T",e.P_S="P_S",e.P_P="P_P",e.P_Z="P_Z",e.P_W="P_W",e.P_I_C="P_I_C",e.P_L_C="P_L_C",e.P_X_C="P_X_C",e.P_U_C="P_U_C",e.P_L2_C="P_L2_C",e.P_Y_C="P_Y_C",e.P_T_C="P_T_C",e.P_S_C="P_S_C",e.P_P_C="P_P_C",e.P_Z_C="P_Z_C",e.P_W_C="P_W_C",e.H_I="H_I",e.H_L="H_L",e.H_X="H_X",e.H_U="H_U",e.H_L2="H_L2",e.H_Y="H_Y",e.H_T="H_T",e.H_S="H_S",e.H_P="H_P",e.H_Z="H_Z",e.H_W="H_W",e.H_I_C="H_I_C",e.H_L_C="H_L_C",e.H_X_C="H_X_C",e.H_U_C="H_U_C",e.H_L2_C="H_L2_C",e.H_Y_C="H_Y_C",e.H_T_C="H_T_C",e.H_S_C="H_S_C",e.H_P_C="H_P_C",e.H_Z_C="H_Z_C",e.H_W_C="H_W_C",e))(be||{}),Ln=(e=>(e.SPAWNED="SPAWNED",e.FALLING="FALLING",e.LOCKED="LOCKED",e))(Ln||{}),Ze=(e=>(e.ConsoleScreen="CONSOLE",e.TankScreen="PERISCOPE",e.COMPLICATION_MINIGAME="COMPLICATION_MINIGAME",e.EndGameScreen="GAME_OVER",e))(Ze||{}),_e=(e=>(e.LIGHTS="LIGHTS",e.CONTROLS="CONTROLS",e.LASER="LASER",e))(_e||{});const ct=12,ke=30,rn=16,Ge=19,Qe=Ge-rn,fo=375,bl=75*1e3,Ml=.15,sx=.5,ox=30,rx=0,ix=100,Qu=15,lx=10,cx=250,En={CIRCUIT_STABILIZER:{id:"CIRCUIT_STABILIZER",name:"Circuit Stabilizer",desc:"Extends grace period before lights start dimming.",type:"passive",category:"complication",unlockRank:2,costPerLevel:1,maxLevel:4,effectPerLevel:.75,formatEffect:e=>`+${(e*.75).toFixed(2)}s Grace Period`,maxLevelBonus:"Easier Fixing Sequence"},AUTO_POPPER:{id:"AUTO_POPPER",name:"Auto-Popper",desc:"At end of game, remaining goop has a chance to auto-pop before penalty.",type:"passive",unlockRank:3,costPerLevel:1,maxLevel:4,effectPerLevel:.04,formatEffect:e=>`-${20-e*4}% decay per unit`,maxLevelBonus:void 0},CAPACITOR_EFFICIENCY:{id:"CAPACITOR_EFFICIENCY",name:"Capacitor Efficiency",desc:"Reduces laser capacitor drain rate when popping goop.",type:"passive",category:"complication",unlockRank:4,costPerLevel:1,maxLevel:4,effectPerLevel:.0625,formatEffect:e=>`-${(e*6.25).toFixed(2)}% Drain Rate`,maxLevelBonus:"Easier Fixing Sequence"},COOLDOWN_BOOSTER:{id:"COOLDOWN_BOOSTER",name:"Cooldown Booster",desc:"When activated, extends all active malfunction cooldowns.",type:"active",unlockRank:5,costPerLevel:1,maxLevel:3,chargeCost:8,effectPerLevel:0,formatEffect:e=>`+${[25,35,50][e-1]||25}% Cooldown Extension`,maxLevelBonus:"+50% Cooldown Extension"},GEAR_LUBRICATION:{id:"GEAR_LUBRICATION",name:"Gear Lubrication",desc:"Increases heat dissipation rate when idle.",type:"passive",category:"complication",unlockRank:6,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Heat Dissipation`,maxLevelBonus:"Easier Fixing Sequence"},FOCUS_MODE:{id:"FOCUS_MODE",name:"Focus Mode",desc:"Time slows while at the console viewing minigames.",type:"passive",unlockRank:7,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`-${e*10}% Time Speed`,maxLevelBonus:void 0},DENSE_GOOP:{id:"DENSE_GOOP",name:"Dense Goop",desc:"Goop falls faster. Can add or remove scraps via respec.",type:"passive",unlockRank:8,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Fall Speed`,maxLevelBonus:void 0},PRESSURE_CONTROL:{id:"PRESSURE_CONTROL",name:"Pressure Control",desc:"Extends time before pressure reaches 100%.",type:"passive",unlockRank:9,costPerLevel:1,maxLevel:8,effectPerLevel:5,formatEffect:e=>`+${e*5}s Game Time`,maxLevelBonus:void 0},JUNK_UNIFORMER:{id:"JUNK_UNIFORMER",name:"Junk Uniformer",desc:"Starting junk is more likely to be the same color.",type:"passive",unlockRank:10,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`+${e*10}% Same Color`,maxLevelBonus:void 0},GOOP_SWAP:{id:"GOOP_SWAP",name:"Goop Swap",desc:"Swap falling goop with stored goop faster.",type:"passive",unlockRank:12,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${(1.5-e*.25).toFixed(2)}s Swap Time`,maxLevelBonus:void 0},GOOP_DUMP:{id:"GOOP_DUMP",name:"Goop Dump",desc:"When activated, rains same-color junk from the sky. Higher levels add more waves.",type:"active",unlockRank:15,costPerLevel:1,maxLevel:3,chargeCost:12,effectPerLevel:1,formatEffect:e=>`${e} wave${e>1?"s":""} of junk`,maxLevelBonus:"3 waves of matching junk"},SEALING_BONUS:{id:"SEALING_BONUS",name:"Sealing Bonus",desc:"Sealing cracks reduces active cooldowns more.",type:"passive",unlockRank:18,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`${10+e*5}% Cooldown per Seal`,maxLevelBonus:void 0},ACTIVE_EXPANSION_SLOT:{id:"ACTIVE_EXPANSION_SLOT",name:"Active Expansion Slot",desc:"Allows equipping a second active ability simultaneously.",type:"feature",unlockRank:20,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"2 Active Slots",maxLevelBonus:void 0},GOOP_HOLD_VIEWER:{id:"GOOP_HOLD_VIEWER",name:"Goop Hold Viewer",desc:"Shows the goop currently held.",type:"feature",unlockRank:22,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"View Held Goop",maxLevelBonus:void 0},GOOP_COLORIZER:{id:"GOOP_COLORIZER",name:"Goop Colorizer",desc:"When activated, upcoming goop matches your current color.",type:"active",unlockRank:25,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:1,formatEffect:e=>`Next ${5+e} goop match`,maxLevelBonus:"Next 8 goop match"},GOOP_WINDOW:{id:"GOOP_WINDOW",name:"Goop Window",desc:"Shows you the next goop piece.",type:"feature",unlockRank:28,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"Preview Next Goop",maxLevelBonus:void 0},SLOW_CRACKS:{id:"SLOW_CRACKS",name:"Slow Cracks",desc:"Cracks grow slower over time.",type:"passive",unlockRank:30,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`-${e*5}% Growth Chance`,maxLevelBonus:void 0},CRACK_MATCHER:{id:"CRACK_MATCHER",name:"Crack Matcher",desc:"Falling goop color biased toward the lowest crack.",type:"passive",unlockRank:32,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${e*25}% Match Chance`,maxLevelBonus:void 0},CRACK_DOWN:{id:"CRACK_DOWN",name:"Crack Down",desc:"When activated, next cracks form in the bottom 4 rows.",type:"active",unlockRank:35,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:2,formatEffect:e=>`Next ${1+e*2} cracks spawn low`,maxLevelBonus:"Next 7 cracks spawn low"},ACTIVE_EXPANSION_SLOT_2:{id:"ACTIVE_EXPANSION_SLOT_2",name:"Active Expansion Slot",desc:"Allows equipping a third active ability simultaneously.",type:"feature",unlockRank:38,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"3 Active Slots",maxLevelBonus:void 0}},dn={RED:"#ef4444",BLUE:"#3b82f6",GREEN:"#22c55e",YELLOW:"#eab308",PURPLE:"#a855f7",WHITE:"#f8fafc",BLACK:"#1a1a2e",WILD:"wild",ORANGE:"#f97316",TEAL:"#14b8a6",GRID_BG:"#020617",GRID_EMPTY:"#1e293b"},Te=(e,t)=>({type:e,color:dn.RED,cells:t.map(([n,s])=>({x:n,y:s}))}),Ju=[Te(be.I,[[-1,0],[0,0],[1,0],[2,0]]),Te(be.J,[[-1,-1],[-1,0],[0,0],[1,0]]),Te(be.L,[[1,-1],[-1,0],[0,0],[1,0]]),Te(be.O,[[0,0],[1,0],[0,1],[1,1]]),Te(be.S,[[0,0],[1,0],[0,1],[-1,1]]),Te(be.T,[[0,-1],[-1,0],[0,0],[1,1]]),Te(be.Z,[[-1,0],[0,0],[0,1],[1,1]])],ax=Te(be.T_I,[[0,-1],[0,0],[0,1],[0,2]]),ux=Te(be.T_L,[[0,0],[0,1],[0,2],[1,0]]),fx=Te(be.T_T,[[0,0],[0,1],[0,2],[1,1]]),dx=Te(be.T_S,[[0,0],[0,1],[1,1],[1,2]]),px=Te(be.T_O,[[0,0],[0,1],[1,0],[1,1]]),hx=Te(be.T_I_C,[[0,2],[0,3],[1,0],[1,1]]),xx=Te(be.T_L_C,[[0,0],[0,1],[1,0],[1,2]]),yx=Te(be.T_T_C,[[0,0],[0,2],[1,1],[2,1]]),gx=Te(be.T_S_C,[[0,2],[1,0],[1,1],[2,1]]),mx=Te(be.T_O_C,[[0,0],[0,2],[1,1],[1,2]]),ti=[ax,ux,fx,dx,px],ni=[hx,xx,yx,gx,mx];[...ti,...ni];const vx=Te(be.P_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2]]),Sx=Te(be.P_L,[[0,0],[0,1],[1,1],[1,2],[2,1]]),Cx=Te(be.P_X,[[0,1],[1,0],[1,1],[1,2],[2,1]]),kx=Te(be.P_U,[[0,0],[1,0],[1,1],[1,2],[2,0]]),wx=Te(be.P_L2,[[0,0],[0,1],[1,0],[1,1],[1,2]]),jx=Te(be.P_Y,[[0,0],[0,1],[1,1],[1,2],[2,2]]),Px=Te(be.P_T,[[0,0],[0,1],[0,2],[0,3],[1,1]]),Rx=Te(be.P_S,[[0,0],[0,1],[0,2],[0,3],[1,3]]),bx=Te(be.P_P,[[0,0],[0,1],[0,3],[1,0],[1,2]]),Mx=Te(be.P_Z,[[0,0],[0,1],[0,2],[0,3],[1,1]]),Tx=Te(be.P_W,[[0,0],[0,2],[1,1],[1,2],[2,2]]),Ex=Te(be.P_I_C,[[0,0],[0,2],[0,4],[1,1],[1,3]]),Ax=Te(be.P_L_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),_x=Te(be.P_X_C,[[0,0],[1,1],[1,2],[2,0],[2,2]]),Ix=Te(be.P_U_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),Lx=Te(be.P_L2_C,[[0,0],[0,2],[1,1],[1,2],[2,2]]),Ox=Te(be.P_Y_C,[[0,0],[0,1],[1,1],[2,0],[2,2]]),Nx=Te(be.P_T_C,[[0,0],[0,1],[0,3],[1,2],[1,3]]),Dx=Te(be.P_S_C,[[0,0],[0,1],[1,0],[1,2],[2,1]]),$x=Te(be.P_P_C,[[0,0],[0,2],[1,0],[1,1],[1,3]]),Fx=Te(be.P_Z_C,[[0,0],[0,2],[1,1],[1,3],[2,0]]),Bx=Te(be.P_W_C,[[0,0],[0,2],[1,1],[2,0],[2,2]]),tp=[vx,Sx,Cx,kx,wx,jx,Px,Rx,bx,Mx,Tx],np=[Ex,Ax,_x,Ix,Lx,Ox,Nx,Dx,$x,Fx,Bx];[...tp,...np];const zx=Te(be.H_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2],[0,3]]),Gx=Te(be.H_L,[[0,0],[0,1],[0,2],[0,3],[1,1],[2,1]]),Yx=Te(be.H_X,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,3]]),Hx=Te(be.H_U,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,0]]),Wx=Te(be.H_L2,[[0,0],[0,1],[1,0],[1,1],[1,2],[1,3]]),Ux=Te(be.H_Y,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2]]),Xx=Te(be.H_T,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,2]]),Vx=Te(be.H_S,[[0,0],[0,1],[1,0],[1,1],[2,1],[2,2]]),qx=Te(be.H_P,[[0,0],[0,1],[0,2],[0,3],[1,2],[1,3]]),Zx=Te(be.H_Z,[[0,0],[0,1],[0,2],[0,3],[1,0],[1,3]]),Kx=Te(be.H_W,[[0,0],[0,3],[1,1],[1,2],[1,3],[2,3]]),Qx=Te(be.H_I_C,[[0,0],[0,3],[0,5],[1,1],[1,2],[1,4]]),Jx=Te(be.H_L_C,[[0,0],[0,2],[1,1],[1,2],[1,3],[2,0]]),ey=Te(be.H_X_C,[[0,0],[0,2],[0,3],[1,1],[1,3],[2,0]]),ty=Te(be.H_U_C,[[0,0],[0,3],[1,1],[1,2],[1,4],[2,0]]),ny=Te(be.H_L2_C,[[0,0],[0,1],[1,1],[1,2],[1,3],[2,0]]),sy=Te(be.H_Y_C,[[0,0],[0,2],[1,0],[1,2],[1,3],[2,1]]),oy=Te(be.H_T_C,[[0,0],[0,1],[0,3],[1,1],[1,2],[1,4]]),ry=Te(be.H_S_C,[[0,0],[0,2],[1,1],[1,3],[2,0],[2,2]]),iy=Te(be.H_P_C,[[0,0],[0,2],[0,4],[1,1],[1,2],[1,3]]),ly=Te(be.H_Z_C,[[0,0],[0,1],[0,3],[1,0],[1,2],[2,3]]),cy=Te(be.H_W_C,[[0,0],[0,3],[1,1],[1,2],[2,0],[2,3]]),sp=[zx,Gx,Yx,Hx,Wx,Ux,Xx,Vx,qx,Zx,Kx],op=[Qx,Jx,ey,ty,ny,sy,oy,ry,iy,ly,cy];[...sp,...op];const We=e=>(e%ke+ke)%ke,Gc=(e,t)=>We(Math.round(e)+t),ay=(e,t)=>{let n=e-t;for(;n>ke/2;)n-=ke;for(;n<=-ke/2;)n+=ke;return n},uy=(e,t,n)=>{const s=n?n.x:Math.round(e.reduce((o,l)=>o+l.x,0)/e.length),r=n?n.y:Math.round(e.reduce((o,l)=>o+l.y,0)/e.length);return e.map(({x:o,y:l})=>{const c=o-s,a=l-r;return t?{x:-a+s,y:c+r}:{x:a+s,y:-c+r}})},bn=e=>{const t=[dn.RED,dn.BLUE,dn.GREEN,dn.YELLOW];return e>=10&&t.push(dn.PURPLE),e>=30&&t.push(dn.WHITE),e>=50&&t.push(dn.BLACK),t},fy=(e,t=1)=>{const n=e||Ju[Math.floor(Math.random()*Ju.length)],s=bn(t),o=(e==null?void 0:e.color)&&s.includes(e.color)?e.color:s[Math.floor(Math.random()*s.length)],l=Math.round(n.cells.reduce((a,u)=>a+u.x,0)/n.cells.length),c=Math.round(n.cells.reduce((a,u)=>a+u.y,0)/n.cells.length);return{definition:{...n,color:o},x:0,y:0,screenX:0,rotation:0,cells:[...n.cells],rotationCenter:{x:l,y:c},spawnTimestamp:Date.now(),startSpawnY:0,state:Ln.SPAWNED}},ef=(e,t)=>{const n=Array(Ge).fill(null).map(()=>Array(ke).fill(null));let s=0;if(e>=9?s=11:e>=6?s=8:e>=3&&(s=5),s>0){const r=bn(e),o=Array.from({length:ke},(d,p)=>p);for(let d=o.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[o[d],o[p]]=[o[p],o[d]]}const l=o.slice(0,s),c=Ge-1,u=((t==null?void 0:t.JUNK_UNIFORMER)||0)*.1;let f=null;l.forEach(d=>{let p;f===null?(p=r[Math.floor(Math.random()*r.length)],f=p):p=Math.random()<u?f:r[Math.floor(Math.random()*r.length)];const y=Math.random().toString(36).substr(2,9);n[c][d]={id:Math.random().toString(36).substr(2,9),goopGroupId:y,timestamp:Date.now(),color:p,groupMinY:c,groupMaxY:c,groupSize:1}})}return n},fs=(e,t,n)=>{for(const s of t.cells){const r=We(t.x+s.x),o=t.y+s.y;if(o+1>Ge)return!0;const l=Math.floor(o),c=Math.floor(o+1-1e-4);for(let a=l;a<=c;a++)if(a>=0&&a<Ge&&e[a][r]!==null)return!0}return!1},rp=(e,t,n)=>{let s=Math.floor(t.y);for(;s>-5&&fs(e,{...t,y:s});)s-=1;let r=s;for(;r<Ge&&!fs(e,{...t,y:r+1});)r+=1;return Math.max(s,r)},dy=(e,t,n)=>{const s=e[n][t];if(!s)return[];const r=[],o=new Set,l=[{x:t,y:n}],c=s.goopGroupId;for(;l.length>0;){const{x:a,y:u}=l.shift(),f=`${a},${u}`;if(o.has(f))continue;o.add(f),r.push({x:a,y:u});const d=[{x:We(a+1),y:u},{x:We(a-1),y:u},{x:a,y:u+1},{x:a,y:u-1}];for(const p of d)if(p.y>=0&&p.y<Ge){const y=e[p.y][p.x];y&&y.goopGroupId===c&&(o.has(`${p.x},${p.y}`)||l.push(p))}}return r},Ei=e=>{const t=e.map(r=>[...r]),n=new Set,s=(r,o,l,c)=>{const a=[],u=[{x:r,y:o}],f=new Set;for(;u.length>0;){const d=u.shift(),p=`${d.x},${d.y}`;if(f.has(p))continue;f.add(p),a.push(d);const y=[{x:We(d.x+1),y:d.y},{x:We(d.x-1),y:d.y},{x:d.x,y:d.y+1},{x:d.x,y:d.y-1}];for(const S of y)if(S.y>=0&&S.y<Ge){const P=t[S.y][S.x];if(!P||f.has(`${S.x},${S.y}`))continue;(c?P.isWild:P.color===l&&!P.isWild)&&u.push(S)}}return a};for(let r=0;r<Ge;r++)for(let o=0;o<ke;o++){const l=t[r][o];if(l&&!n.has(`${o},${r}`)){const c=s(o,r,l.color,!!l.isWild);let a=Ge,u=-1;c.forEach(C=>{C.y<a&&(a=C.y),C.y>u&&(u=C.y)});const f=c.length;let d=!0;const p=l.goopGroupId,y=l.groupSize;if(y!==f)d=!1;else for(const C of c){const g=t[C.y][C.x];if(!g||g.goopGroupId!==p||g.groupSize!==y){d=!1;break}}const S=d?p:Math.random().toString(36).substr(2,9),P=d?l.timestamp:Date.now();c.forEach(C=>{n.add(`${C.x},${C.y}`);const g=t[C.y][C.x];t[C.y][C.x]={...g,goopGroupId:S,timestamp:P,groupMinY:a,groupMaxY:u,groupSize:f}})}}return t},py=(e,t,n)=>{const s=e.map(p=>[...p]),r=Math.random().toString(36).substr(2,9),o=Date.now();let l=Ge,c=-1;const a=[],u=[];t.cells.forEach(p=>{const y=Math.floor(t.y+p.y);y<l&&(l=y),y>c&&(c=y)});const f=t.cells.length,d=t.definition.isWild;return t.cells.forEach((p,y)=>{var g;const S=We(t.x+p.x),P=Math.floor(t.y+p.y),C=((g=t.definition.cellColors)==null?void 0:g[y])??t.definition.color;if(P>=0&&P<Ge){const h=n.find(m=>m.x===S&&m.y===P);let x=!1;h&&(h.color===C||d)&&(a.push(h.id),x=!0),s[P][S]={id:Math.random().toString(36).substr(2,9),goopGroupId:r,timestamp:o,color:C,groupMinY:l,groupMaxY:c,groupSize:f,isSealingGoop:x,isWild:d}}}),{grid:Ei(s),consumedGoals:a,destroyedGoals:u}},hy=(e,t)=>{const n=e.map(c=>[...c]),s=t.definition.isWild,r=t.definition.color,o=[];t.cells.forEach(c=>{const a=We(t.x+c.x),u=Math.floor(t.y+c.y);u>=0&&u<Ge&&o.push({x:a,y:u})});const l=new Set;if(o.forEach(({x:c,y:a})=>{[{x:We(c+1),y:a},{x:We(c-1),y:a},{x:c,y:a+1},{x:c,y:a-1}].forEach(f=>{if(f.y>=0&&f.y<Ge){const d=n[f.y][f.x];if(!d||o.some(y=>y.x===f.x&&y.y===f.y))return;s?d.isWild||l.add(d.goopGroupId):d.isWild&&l.add(d.goopGroupId)}})}),l.size>0)for(let c=0;c<Ge;c++)for(let a=0;a<ke;a++){const u=n[c][a];u&&l.has(u.goopGroupId)&&(s?n[c][a]={...u,isWild:!0}:n[c][a]={...u,color:r,isWild:!1})}return Ei(n)},ip=(e,t)=>{const n=e.map(a=>[...a]),s=[],r=new Map;for(let a=0;a<Ge;a++)for(let u=0;u<ke;u++){const f=n[a][u];f&&(r.has(f.goopGroupId)||r.set(f.goopGroupId,[]),r.get(f.goopGroupId).push({x:u,y:a}))}let o;if(t&&t.length>0){const a=new Map;for(const u of t){const f=a.get(u.x);(f===void 0||u.y<f)&&a.set(u.x,u.y)}o=new Set;for(const[u,f]of r)for(const d of f){const p=a.get(d.x);if(p!==void 0&&d.y<p){o.add(u);break}}}else o=new Set(r.keys());const l=new Set;for(const[a,u]of r)for(const f of u)if(f.y===Ge-1){l.add(a);break}let c=!0;for(;c;){c=!1;for(const[a,u]of r)if(!l.has(a))for(const f of u){const d=f.y+1;if(d<Ge){const p=n[d][f.x];if(p&&p.goopGroupId!==a&&l.has(p.goopGroupId)){l.add(a),c=!0;break}}}}for(const a of o)if(!l.has(a)){const u=r.get(a);for(const f of u)s.push({data:n[f.y][f.x],x:f.x,y:f.y,velocity:0}),n[f.y][f.x]=null}return{grid:n,looseGoop:s}},xy=(e,t,n,s)=>{const r=[],o=[],l=.012*n,c=[...e].sort((a,u)=>u.y-a.y);for(const a of c){const u=a.y+l;if(u>=Ge-1){o.push({...a,y:Ge-1});continue}const f=Math.floor(u+1),d=a.x;t[f]&&t[f][d]?o.push({...a,y:Math.floor(u)}):r.push({...a,y:u})}return{active:r,landed:o}},yy=e=>Math.max(0,(Ge-e)*10),gy=(e,t)=>{const n=We(t+ct/2);let s=Math.abs(e-n);return s>ke/2&&(s=ke-s),s>ct/2?50:0},my=e=>1+e*.1,vy=(e,t)=>{let n=0;const s=new Set(t.map(r=>`${r.x},${r.y}`));return t.forEach(({x:r,y:o})=>{[{x:We(r+1),y:o},{x:We(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}].forEach(c=>{c.y>=0&&c.y<Ge&&e[c.y][c.x]&&!s.has(`${c.x},${c.y}`)&&n++})}),n*5},tf=(e,t,n,s,r,o=!1)=>{const l=bn(n),c=new Set(t.map(d=>d.color)),a=l.filter(d=>!c.has(d));if(a.length===0)return null;const u=a[Math.floor(Math.random()*a.length)];let f;if(o){const d=Ge-4,p=Ge-1;f=d+Math.floor(Math.random()*(p-d+1))}else{const p=1+Math.max(0,1-s/r)*(rn-1),y=Math.floor(Ge-p);f=Math.max(Qe,Math.min(Ge-1,y))}for(let d=0;d<20;d++){const p=Math.floor(Math.random()*ke),y=f;if(!e[y][p]&&!t.some(S=>S.x===p&&S.y===y))return{id:Math.random().toString(36).substr(2,9),x:p,y,color:u,spawnTime:Date.now()}}return null},Sy=(e,t,n,s,r)=>{const o=bn(n),l=[],c=[...t],u=1+Math.max(0,1-s/r)*(rn-1),f=Math.floor(Ge-u);let d=Qe,p=Math.max(Qe,f-1);for(const y of o)for(let S=0;S<20;S++){const P=Math.floor(Math.random()*ke),C=Math.floor(d+Math.random()*(p-d+1));if(C<Qe||C>=Ge)continue;const g=e[C][P]!==null,h=c.some(m=>m.x===P&&m.y===C),x=l.some(m=>m.x===P&&m.y===C);if(!g&&!h&&!x){const m={id:Math.random().toString(36).substr(2,9),x:P,y:C,color:y,spawnTime:Date.now()};l.push(m);break}}return l},pt=typeof navigator<"u"&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Cy=(e,t)=>{const n=Math.max(0,Math.min(100,e))/100;if(t==="drain")if(n>.5){const s=(n-.5)*2,r=Math.round(234+(59-234)*s),o=Math.round(179+(130-179)*s),l=Math.round(8+(246-8)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=n*2,r=Math.round(220+(234-220)*s),o=Math.round(38+(179-38)*s),l=Math.round(38+(8-38)*s);return`rgb(${r}, ${o}, ${l})`}else if(n<.5){const s=n*2,r=Math.round(34+(234-34)*s),o=Math.round(197+(179-197)*s),l=Math.round(94+(8-94)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=(n-.5)*2,r=Math.round(234+(220-234)*s),o=Math.round(179+(38-179)*s),l=Math.round(8+(38-8)*s);return`rgb(${r}, ${o}, ${l})`}},nf=({value:e,maxValue:t=100,colorMode:n,x:s,y:r,height:o=200,width:l=16})=>{const a=Math.max(0,Math.min(t,e))/t*(o-4),u=Cy(e,n),f="#1f2937",d="#111827";return i.jsxs("g",{transform:`translate(${s}, ${r})`,children:[i.jsx("rect",{x:0,y:0,width:l,height:o,rx:3,ry:3,fill:d,stroke:f,strokeWidth:1}),i.jsx("rect",{x:2,y:o-2-a,width:l-4,height:a,rx:2,ry:2,fill:u}),[.25,.5,.75].map(p=>i.jsx("line",{x1:0,y1:o-p*(o-4)-2,x2:4,y2:o-p*(o-4)-2,stroke:f,strokeWidth:1,opacity:.5},p))]})},Le=30,Ns={x:-(ct/2)*Le,y:0,w:ct*Le,h:rn*Le};function lt(e){return(e-ct/2)*Le}function ky(e){return e/Le+ct/2}class wy{constructor(){ze(this,"handlers",new Map)}on(t,n){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(n),()=>this.off(t,n)}off(t,n){var s;(s=this.handlers.get(t))==null||s.delete(n)}emit(t,n){var s;(s=this.handlers.get(t))==null||s.forEach(r=>r(n))}}const ve=new wy;var ge=(e=>(e.PIECE_MOVED="PIECE_MOVED",e.PIECE_ROTATED="PIECE_ROTATED",e.PIECE_DROPPED="PIECE_DROPPED",e.GOOP_POPPED="GOOP_POPPED",e.ACTION_REJECTED="ACTION_REJECTED",e.GAME_OVER="GAME_OVER",e.GOAL_CAPTURED="GOAL_CAPTURED",e.COMPLICATION_SPAWNED="COMPLICATION_SPAWNED",e.COMPLICATION_RESOLVED="COMPLICATION_RESOLVED",e.LIGHTS_FLICKER="LIGHTS_FLICKER",e.ABILITY_ACTIVATED="ABILITY_ACTIVATED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.GAME_START="GAME_START",e.GAME_PAUSED="GAME_PAUSED",e.GAME_RESUMED="GAME_RESUMED",e.GAME_EXITED="GAME_EXITED",e.MUSIC_START="MUSIC_START",e.MUSIC_STOP="MUSIC_STOP",e.INPUT_ROTATE="INPUT_ROTATE",e.INPUT_DRAG="INPUT_DRAG",e.INPUT_SWIPE_UP="INPUT_SWIPE_UP",e.INPUT_FAST_DROP="INPUT_FAST_DROP",e.INPUT_SWAP="INPUT_SWAP",e.INPUT_BLOCK_TAP="INPUT_BLOCK_TAP",e.INPUT_SWAP_HOLD="INPUT_SWAP_HOLD",e))(ge||{});const jy=1500,_s=250,Er=10,Po=20;function Py({callbacks:e,tankRotation:t,grid:n,tankPressure:s,powerUps:r}){const{onBlockTap:o,onRotate:l,onDragInput:c,onSwipeUp:a,onFastDrop:u,onSwap:f}=e,d=(r==null?void 0:r.GOOP_SWAP)||0,p=jy-d*250,[y,S]=v.useState(null),[P,C]=v.useState(null),[g,h]=v.useState(0),[x,m]=v.useState(null),j=v.useRef(null),R=v.useRef(null),k=v.useRef(null),w=v.useRef(null),{x:T,y:_,w:L,h:V}=Ns,q=v.useCallback((G,pe,we)=>{const O=we,H=O.getBoundingClientRect(),me=O.clientLeft||0,ue=O.clientTop||0,Se=G-H.left-me,oe=pe-H.top-ue,Ce=O.clientWidth,ee=O.clientHeight,je=Ce/L,xe=ee/V,Me=Math.min(je,xe),Oe=L*Me,Ne=(Ce-Oe)/2,Fe=T+(Se-Ne)/Me,$e=_+oe/Me,W=ky(Fe),M=$e/Le+Qe;return{vx:W,vy:M,svgX:Fe,svgY:$e,relX:Se,contentW:Ce,relY:oe}},[T,_,L,V]),Q=v.useCallback((G,pe)=>{if(G>=0&&G<ct){const we=Math.floor(G),O=We(we+t),H=Math.floor(pe);if(H>=0&&H<Ge){const me=n[H][O];if(me)return{type:"BLOCK",x:O,y:H,cell:me}}}return{type:"EMPTY"}},[t,n]),A=v.useCallback(()=>{R.current&&(clearInterval(R.current),R.current=null),h(0),m(null)},[]);v.useEffect(()=>()=>{R.current&&clearInterval(R.current)},[]);const Z=v.useCallback(G=>{if(j.current)return;G.currentTarget.setPointerCapture(G.pointerId);const{relX:pe,relY:we,vx:O,vy:H}=q(G.clientX,G.clientY,G.currentTarget);j.current={startX:G.clientX,startY:G.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:G.pointerId,actionConsumed:!1},m({x:pe,y:we}),h(0);const me=Date.now();R.current=window.setInterval(()=>{const oe=Date.now()-me;if(oe<_s)return;const Ce=oe-_s,ee=Math.min(100,Ce/p*100);h(ee),ee>=100&&(j.current&&(j.current.actionConsumed=!0),ve.emit(ge.INPUT_SWAP),f==null||f(),A(),navigator.vibrate&&navigator.vibrate(50))},16);const ue=Q(O,H);if(ue.type==="BLOCK"&&ue.cell){const Se=ue.cell.groupSize*fo,oe=Date.now()-ue.cell.timestamp,Ce=Ge-1-s*(rn-1);ue.cell.groupMinY<Ce?(C(ue.cell.goopGroupId),ve.emit(ge.ACTION_REJECTED),setTimeout(()=>C(ee=>ee===ue.cell.goopGroupId?null:ee),300)):oe<Se?(C(ue.cell.goopGroupId),ve.emit(ge.ACTION_REJECTED),setTimeout(()=>C(ee=>ee===ue.cell.goopGroupId?null:ee),300)):S(ue.cell.goopGroupId)}},[q,Q,s,A,p]),ce=v.useCallback(G=>{if(!j.current||j.current.activePointerId!==G.pointerId)return;const{startX:pe,startY:we,isDragLocked:O}=j.current,H=G.clientX-pe,me=G.clientY-we,ue=Math.abs(H),Se=Math.abs(me);if(O||(ue>Er||Se>Er)&&(A(),j.current.isDragLocked=!0,S(null),ue>Se?j.current.lockedAxis="H":(j.current.lockedAxis="V",me>0&&(ve.emit(ge.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)))),j.current.isDragLocked){const oe=j.current.lockedAxis;if(oe==="H")H<-Po?(ve.emit(ge.INPUT_DRAG,{direction:1}),c==null||c(1)):H>Po?(ve.emit(ge.INPUT_DRAG,{direction:-1}),c==null||c(-1)):(ve.emit(ge.INPUT_DRAG,{direction:0}),c==null||c(0));else if(oe==="V"){const Ce=me>0;ve.emit(ge.INPUT_FAST_DROP,{active:Ce}),u==null||u(Ce)}}},[A]),Y=v.useCallback(G=>{if(!j.current||j.current.activePointerId!==G.pointerId)return;const{startTime:pe,isDragLocked:we,actionConsumed:O,startX:H,startY:me}=j.current,ue=Date.now()-pe,Se=G.clientX-H,oe=G.clientY-me;if(A(),ve.emit(ge.INPUT_FAST_DROP,{active:!1}),u==null||u(!1),ve.emit(ge.INPUT_DRAG,{direction:0}),c==null||c(0),S(null),j.current=null,G.currentTarget.releasePointerCapture(G.pointerId),!O&&!(ue>=_s))if(we)ue<300&&Math.abs(oe)>Math.abs(Se)&&Math.abs(oe)>50&&(oe<0?(ve.emit(ge.INPUT_SWIPE_UP),a==null||a()):(ve.emit(ge.INPUT_FAST_DROP,{active:!0}),u==null||u(!0),setTimeout(()=>{ve.emit(ge.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)},150)));else{const{vx:Ce,vy:ee,relX:je,contentW:xe}=q(G.clientX,G.clientY,G.currentTarget),Me=Q(Ce,ee);Me.type==="BLOCK"&&Me.cell?(ve.emit(ge.INPUT_BLOCK_TAP,{x:Me.x,y:Me.y}),o==null||o(Me.x,Me.y)):je<xe/2?(ve.emit(ge.INPUT_ROTATE,{clockwise:!1}),l==null||l(-1)):(ve.emit(ge.INPUT_ROTATE,{clockwise:!0}),l==null||l(1))}},[A,q,Q]),K=v.useCallback(()=>{w.current&&(window.removeEventListener("touchmove",w.current.move),window.removeEventListener("touchend",w.current.end),window.removeEventListener("touchcancel",w.current.end),w.current=null)},[]),$=v.useCallback(G=>{if(G.touches.length!==1||j.current)return;G.preventDefault();const pe=G.touches[0],we=G.currentTarget;k.current=we;const{relX:O,relY:H,vx:me,vy:ue}=q(pe.clientX,pe.clientY,we);j.current={startX:pe.clientX,startY:pe.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:pe.identifier,actionConsumed:!1},m({x:O,y:H}),h(0);const Se=Date.now();R.current=window.setInterval(()=>{const xe=Date.now()-Se;if(xe<_s)return;const Me=xe-_s,Oe=Math.min(100,Me/p*100);h(Oe),Oe>=100&&(j.current&&(j.current.actionConsumed=!0),ve.emit(ge.INPUT_SWAP),f==null||f(),A(),navigator.vibrate&&navigator.vibrate(50))},16);const oe=Q(me,ue);if(oe.type==="BLOCK"&&oe.cell){const je=oe.cell.groupSize*fo,xe=Date.now()-oe.cell.timestamp,Me=Ge-1-s*(rn-1);oe.cell.groupMinY<Me?(C(oe.cell.goopGroupId),ve.emit(ge.ACTION_REJECTED),setTimeout(()=>C(Oe=>Oe===oe.cell.goopGroupId?null:Oe),300)):xe<je?(C(oe.cell.goopGroupId),ve.emit(ge.ACTION_REJECTED),setTimeout(()=>C(Oe=>Oe===oe.cell.goopGroupId?null:Oe),300)):S(oe.cell.goopGroupId)}const Ce=je=>{if(!j.current||je.touches.length!==1)return;je.preventDefault();const xe=je.touches[0];if(xe.identifier!==j.current.activePointerId)return;const{startX:Me,startY:Oe,isDragLocked:Ne}=j.current,Fe=xe.clientX-Me,$e=xe.clientY-Oe,W=Math.abs(Fe),M=Math.abs($e);if(Ne||(W>Er||M>Er)&&(A(),j.current.isDragLocked=!0,S(null),W>M?j.current.lockedAxis="H":(j.current.lockedAxis="V",$e>0&&(ve.emit(ge.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)))),j.current.isDragLocked){const B=j.current.lockedAxis;B==="H"?Fe<-Po?(ve.emit(ge.INPUT_DRAG,{direction:1}),c==null||c(1)):Fe>Po?(ve.emit(ge.INPUT_DRAG,{direction:-1}),c==null||c(-1)):(ve.emit(ge.INPUT_DRAG,{direction:0}),c==null||c(0)):B==="V"&&($e>Po?(ve.emit(ge.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)):(ve.emit(ge.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)))}},ee=je=>{const xe=je.changedTouches[0];if(!j.current||!xe||xe.identifier!==j.current.activePointerId)return;const{startTime:Me,isDragLocked:Oe,actionConsumed:Ne,startX:Fe,startY:$e}=j.current,W=Date.now()-Me,M=xe.clientX-Fe,B=xe.clientY-$e;A(),ve.emit(ge.INPUT_FAST_DROP,{active:!1}),u==null||u(!1),ve.emit(ge.INPUT_DRAG,{direction:0}),c==null||c(0),S(null);const de=k.current;if(j.current=null,k.current=null,K(),!Ne&&!(W>=_s))if(!Oe&&de){const{vx:I,vy:F,relX:D,contentW:X}=q(xe.clientX,xe.clientY,de),ne=Q(I,F);ne.type==="BLOCK"&&ne.cell?(ve.emit(ge.INPUT_BLOCK_TAP,{x:ne.x,y:ne.y}),o==null||o(ne.x,ne.y)):D<X/2?(ve.emit(ge.INPUT_ROTATE,{clockwise:!1}),l==null||l(-1)):(ve.emit(ge.INPUT_ROTATE,{clockwise:!0}),l==null||l(1))}else Oe&&W<300&&Math.abs(B)>Math.abs(M)&&Math.abs(B)>50&&(B<0?(ve.emit(ge.INPUT_SWIPE_UP),a==null||a()):(ve.emit(ge.INPUT_FAST_DROP,{active:!0}),u==null||u(!0),setTimeout(()=>{ve.emit(ge.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)},150)))};w.current={move:Ce,end:ee},window.addEventListener("touchmove",Ce,{passive:!1}),window.addEventListener("touchend",ee),window.addEventListener("touchcancel",ee)},[q,Q,s,A,p,f,u,c,o,l,a,K]);v.useEffect(()=>()=>K(),[K]);const U=v.useCallback(G=>{G.preventDefault()},[]),J=v.useCallback(G=>{G.preventDefault()},[]);return{handlers:{onPointerDown:Z,onPointerMove:ce,onPointerUp:Y,onTouchStart:$,onTouchMove:U,onTouchEnd:J,onTouchCancel:J},holdState:{progress:g,position:x},highlightedGroupId:y,shakingGroupId:P,setHighlightedGroupId:S,setShakingGroupId:C}}const lp=8;function Ry(e,t,n,s,r,o=lp){let l="";return!r.t&&!r.l?l+=`M ${e} ${t+o} Q ${e} ${t} ${e+o} ${t} `:l+=`M ${e} ${t} `,!r.t&&!r.r?l+=`L ${e+n-o} ${t} Q ${e+n} ${t} ${e+n} ${t+o} `:l+=`L ${e+n} ${t} `,!r.b&&!r.r?l+=`L ${e+n} ${t+s-o} Q ${e+n} ${t+s} ${e+n-o} ${t+s} `:l+=`L ${e+n} ${t+s} `,!r.b&&!r.l?l+=`L ${e+o} ${t+s} Q ${e} ${t+s} ${e} ${t+s-o} `:l+=`L ${e} ${t+s} `,l+="Z",l}function Ar(e,t,n,s,r,o=lp){const l=o;let c="";if(!r.t){const a=r.l?e:e+l,u=r.r?e+n:e+n-l;c+=`M ${a} ${t} L ${u} ${t} `}if(!r.r){const a=r.t?t:t+l,u=r.b?t+s:t+s-l;c+=`M ${e+n} ${a} L ${e+n} ${u} `}if(!r.b){const a=r.l?e:e+l,u=r.r?e+n:e+n-l;c+=`M ${u} ${t+s} L ${a} ${t+s} `}if(!r.l){const a=r.t?t:t+l,u=r.b?t+s:t+s-l;c+=`M ${e} ${u} L ${e} ${a} `}return!r.t&&!r.l&&(c+=`M ${e} ${t+l} Q ${e} ${t} ${e+l} ${t} `),!r.t&&!r.r&&(c+=`M ${e+n-l} ${t} Q ${e+n} ${t} ${e+n} ${t+l} `),!r.b&&!r.r&&(c+=`M ${e+n} ${t+s-l} Q ${e+n} ${t+s} ${e+n-l} ${t+s} `),!r.b&&!r.l&&(c+=`M ${e+l} ${t+s} Q ${e} ${t+s} ${e} ${t+s-l} `),c}function by(e,t,n){var o,l,c,a;const s=new Map;for(let u=Qe;u<Qe+rn;u++)for(let f=0;f<ct;f++){const d=We(f+t),p=e[u][d];if(!p)continue;const y=lt(f),P=lt(f+1)-y;if(P<=0)continue;const C=(u-Qe)*Le,g={t:u>0&&((o=e[u-1][d])==null?void 0:o.goopGroupId)===p.goopGroupId,b:u<Ge-1&&((l=e[u+1][d])==null?void 0:l.goopGroupId)===p.goopGroupId,l:((c=e[u][We(d-1)])==null?void 0:c.goopGroupId)===p.goopGroupId,r:((a=e[u][We(d+1)])==null?void 0:a.goopGroupId)===p.goopGroupId};s.has(p.goopGroupId)||s.set(p.goopGroupId,[]),s.get(p.goopGroupId).push({visX:f,y:u,screenX:y,screenY:C,width:P,cell:p,color:p.color,neighbors:g})}const r=new Map;return n.forEach(u=>{r.has(u.data.goopGroupId)||r.set(u.data.goopGroupId,[]),r.get(u.data.goopGroupId).push(u)}),r.forEach((u,f)=>{const d=new Set;u.forEach(p=>d.add(`${Math.round(p.x)},${Math.round(p.y)}`)),u.forEach(p=>{if(p.y<Qe-1)return;let y=p.x-t;if(y>ke/2&&(y-=ke),y<-ke/2&&(y+=ke),y>=0&&y<ct){const S=lt(y),C=lt(y+1)-S,g=(p.y-Qe)*Le,h=Math.round(p.x),x=Math.round(p.y),m={t:d.has(`${h},${x-1}`),r:d.has(`${We(h+1)},${x}`),b:d.has(`${h},${x+1}`),l:d.has(`${We(h-1)},${x}`)};s.has(f)||s.set(f,[]),s.get(f).push({visX:y,y:p.y,screenX:S,screenY:g,width:C,cell:p.data,color:p.data.color,neighbors:m,isFalling:!0})}})}),s}const My=e=>{switch(e){case"COOLDOWN_BOOSTER":return"CB";case"GOOP_DUMP":return"GD";case"GOOP_COLORIZER":return"GC";case"CRACK_DOWN":return"CD";default:return e.charAt(0)}},Ty=e=>{switch(e){case"COOLDOWN_BOOSTER":return"#5bbc70";case"GOOP_DUMP":return"#f97316";case"GOOP_COLORIZER":return"#a855f7";case"CRACK_DOWN":return"#ef4444";default:return"#6acbda"}},Ey=({upgradeId:e,name:t,charge:n,isReady:s,x:r,y:o,size:l,onClick:c})=>{const[a,u]=v.useState(!1),f=v.useCallback(x=>{x.stopPropagation(),x.preventDefault(),s?c==null||c():(u(!0),setTimeout(()=>u(!1),300))},[s,c]),d=Ty(e),p=My(e),y=l/2,S=2,P=n/100,C=y*2,g=P*C,h=y-g;return i.jsx("g",{transform:`translate(${r}, ${o})`,children:i.jsxs("g",{className:a?"shake-anim":"",style:{cursor:"pointer"},onPointerDown:f,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:`clip-${e}`,children:i.jsx("circle",{cx:0,cy:0,r:y-S})})}),i.jsx("circle",{cx:0,cy:0,r:y-S,fill:d,fillOpacity:.25}),!s&&i.jsx("rect",{x:-(y-S),y:h,width:(y-S)*2,height:g,fill:d,fillOpacity:.75,clipPath:`url(#clip-${e})`}),s&&i.jsx("circle",{cx:0,cy:0,r:y-S,fill:d,fillOpacity:.85}),i.jsx("circle",{cx:0,cy:0,r:y-S,fill:"none",stroke:d,strokeWidth:S}),s&&i.jsx("circle",{cx:0,cy:0,r:y,fill:"none",stroke:d,strokeWidth:2,opacity:.5,className:"animate-pulse"}),i.jsx("text",{x:0,y:0,textAnchor:"middle",dominantBaseline:"central",fill:s?"white":"#e2e8f0",fontSize:l*.3,fontWeight:"bold",fontFamily:"monospace",children:p})]})})},Is=48,Ls=12,sf=({piece:e,label:t,visible:n,rank:s=0})=>{const[r,o]=v.useState(Date.now());if(v.useEffect(()=>{if(!(e!=null&&e.isWild))return;const a=setInterval(()=>o(Date.now()),50);return()=>clearInterval(a)},[e==null?void 0:e.isWild]),!n)return null;const l=a=>{const u=bn(s),f=400,d=.15,p=r%(u.length*f)/f,y=a*d,S=(p+y)%u.length,P=Math.floor(S),C=(P+1)%u.length,g=S-P,h=u[P],x=u[C],m=parseInt(h.slice(1,3),16),j=parseInt(h.slice(3,5),16),R=parseInt(h.slice(5,7),16),k=parseInt(x.slice(1,3),16),w=parseInt(x.slice(3,5),16),T=parseInt(x.slice(5,7),16),_=Math.round(m+(k-m)*g),L=Math.round(j+(w-j)*g),V=Math.round(R+(T-R)*g);return`rgb(${_}, ${L}, ${V})`};let c=null;if(e){const a=e.isWild,u=Math.min(...e.cells.map(g=>g.x)),f=Math.max(...e.cells.map(g=>g.x)),d=Math.min(...e.cells.map(g=>g.y)),p=Math.max(...e.cells.map(g=>g.y)),y=f-u+1,S=p-d+1,P=(Is-y*Ls)/2,C=(Is-S*Ls)/2;c=e.cells.map((g,h)=>{var m;const x=P+(g.x-u)*Ls;return i.jsx("rect",{x,y:C+(g.y-d)*Ls,width:Ls-1,height:Ls-1,fill:a?l(x):((m=e.cellColors)==null?void 0:m[h])??e.color,rx:2},h)})}return i.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",border:"2px solid #475569",borderRadius:"6px",padding:"4px 6px",display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsx("div",{style:{fontSize:"9px",color:"#94a3b8",textAlign:"center",marginBottom:"2px",fontFamily:"monospace",letterSpacing:"1px"},children:t}),i.jsxs("svg",{width:Is,height:Is,style:{display:"block"},children:[i.jsx("rect",{x:0,y:0,width:Is,height:Is,fill:"rgba(30, 41, 59, 0.5)",rx:4}),c]})]})};function Ay(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function cp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=Ay(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function _y(e){return cp(e.map(t=>t.pos))}function of(e){return _y(e.vertices)}function Iy(e){let t=1/0,n=-1/0,s=1/0,r=-1/0;for(const o of e)o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y);return{minX:t,maxX:n,minY:s,maxY:r}}function Ly(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?100:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<1e-4||S<1e-4){r.push({...c});continue}const P=-f/y,C=u/y,g=-p/S,h=d/S;let x=P+g,m=C+h;const j=Math.sqrt(x*x+m*m);j<1e-4?(x=P,m=C):(x/=j,m/=j);const R=P*x+C*m,k=R>.1?1/R:1,w=s[o]*.4,T=Math.min(t,w)*Math.min(k,2);r.push({x:c.x+x*T,y:c.y+m*T})}return r}function rf(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function lf(e,t){const n=t*Math.PI/180,s=Math.cos(n),r=Math.sin(n);return{x:e.x*s-e.y*r,y:e.x*r+e.y*s}}const Ai={damping:.98,stiffness:15,pressure:20,iterations:3,homeStiffness:.35,innerHomeStiffness:.64,returnSpeed:.8,viscosity:.7,gravity:10,fallingHomeStiffness:.35,fallingReturnSpeed:.8,fallingViscosity:.7,fallingGravity:10,attractionRadius:30,attractionRestLength:1,attractionStiffness:.037,goopiness:36,tendrilEndRadius:1,tendrilSkinniness:.2,wallThickness:8,fallingGoopiness:36,fallingTendrilEndRadius:1,fallingTendrilSkinniness:.2,dropletCount:30,dropletSpeed:60,dropletLifetime:3,dropletSize:9,dropletGravity:180},Pt=30,mn={x:-(ct/2)*Pt,y:0},Lo=ke*Pt;function Oy(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function Ny(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push({x:c.x,y:c.y});const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(C=>!r.has(C));if(y.length===0)break;let S=y[0],P=-1/0;for(const C of y){const g=n(C,u),h=s(a,g);h>P&&(P=h,S=C)}l=S,c=u}return o}function Dy(e){return e.map(t=>({x:mn.x+t.x*Pt,y:mn.y+t.y*Pt}))}function cf(e){let t=0,n=0;for(const s of e){const r=mn.x+(s.x+.5)*Pt,o=mn.y+(s.y+.5)*Pt;t+=r,n+=o}return{x:t/e.length,y:n/e.length}}function $y(e){if(e.length<3)return e;let t=0;for(let n=0;n<e.length;n++){const s=(n+1)%e.length;t+=e[n].x*e[s].y,t-=e[s].x*e[n].y}return t/=2,t>0?e:[...e].reverse()}function Fy(e,t,n,s,r=0){const o=Oy(e),l=Ny(o),c=Dy(l);let a=$y(c);if(a.length<3){const m=cf(e),j=Pt*.4;a=[{x:m.x-j,y:m.y-j},{x:m.x+j,y:m.y-j},{x:m.x+j,y:m.y+j},{x:m.x-j,y:m.y+j}]}const u=cf(e),f=u.x,d=u.y,p=a.map(m=>({pos:{x:m.x,y:m.y},oldPos:{x:m.x,y:m.y},homeOffset:{x:m.x-f,y:m.y-d},mass:1,attractionRadius:.8+Math.random()*.4})),y=p.length,S=[];for(let m=0;m<y;m++){const j=(m+1)%y;S.push({a:m,b:j,restLength:rf(p[m].pos,p[j].pos)})}const P=[],C=Pt*1.5,g=new Set;for(let m=0;m<y;m++)for(let j=m+2;j<y;j++){if(j===y-1&&m===0)continue;const R=rf(p[m].pos,p[j].pos);if(R<C){const k=`${Math.min(m,j)}-${Math.max(m,j)}`;g.has(k)||(g.add(k),P.push({a:m,b:j,restLength:R}))}}let h=0;for(let m=0;m<a.length;m++){const j=(m+1)%a.length;h+=a[m].x*a[j].y-a[j].x*a[m].y}return h=Math.abs(h)/2,{id:n,color:t,vertices:p,innerVertices:[{pos:{x:f,y:d},oldPos:{x:f,y:d},homeOffset:{x:0,y:0},mass:1,attractionRadius:1}],ringsprings:S,crossSprings:P,restArea:h,gridCells:e.map(m=>({x:m.x,y:m.y})),isColliding:!1,isLocked:s,isFalling:!s,isLoose:!1,fillAmount:s?0:1,wasFullLastFrame:!s,rotation:0,targetX:f,targetY:d,visualOffsetY:0,createdAtRotation:r}}function af(e){if(e.vertices.length<3)return[0];const t=e.vertices.map(a=>a.pos.x),n=Math.min(...t),s=Math.max(...t),r=-180,o=180,l=[],c=Lo;for(const a of[0,c,-c]){const u=n+a;s+a>=r&&u<=o&&l.push(a)}return l.length>1&&console.log(`Blob ${e.id} straddles seam, rendering at offsets:`,l,`(X range: ${n.toFixed(0)} to ${s.toFixed(0)})`),l.length>0?l:[0]}const By=({state:e,rank:t,maxTime:n,lightsBrightness:s=100,laserCharge:r=100,controlsHeat:o=0,complicationCooldowns:l,equippedActives:c=[],activeCharges:a={},onActivateAbility:u,powerUps:f,storedGoop:d,nextGoop:p,softBodyPhysics:y,normalGoopOpacity:S=1,showVertexDebug:P=!1,gooStdDev:C=8,gooAlphaMul:g=24,gooAlphaOff:h=-13,fallingGooStdDev:x,fallingGooAlphaMul:m,fallingGooAlphaOff:j})=>{const{grid:R,tankRotation:k,activeGoop:w,looseGoop:T,floatingTexts:_,shiftTime:L,goalMarks:V,crackCells:q,dumpPieces:Q}=e,A=v.useMemo(()=>bn(t),[t]),Z=v.useMemo(()=>L<=0?1:Math.max(0,1-L/n),[L,n]),Y=`hsla(${Math.max(0,120*(1-Z))}, 100%, 50%, 0.15)`,K=1+Z*(rn-1),{x:$,y:U,w:J,h:G}=Ns,pe=K*Le,we=G-pe,O=v.useCallback((I,F)=>{let D=I-k;D>ke/2&&(D-=ke),D<-ke/2&&(D+=ke);const X=lt(D),ne=(F-Qe)*Le+Le/2,se=(X-$)/J*100,ye=(ne-U)/G*100;return{x:se,y:ye}},[k]),{handlers:H,holdState:me,highlightedGroupId:ue,shakingGroupId:Se}=Py({callbacks:{},tankRotation:k,grid:R,tankPressure:Z,powerUps:f}),[oe,Ce]=v.useState(-1),[ee,je]=v.useState(0);v.useEffect(()=>ve.on(ge.INPUT_SWAP_HOLD,F=>{Ce((F==null?void 0:F.progress)??-1)}),[]),v.useEffect(()=>{var ye,b;if(!y||pt)return;const I=new Set;for(let N=Qe;N<Ge;N++)for(let E=0;E<ke;E++){const z=(ye=R[N])==null?void 0:ye[E];z!=null&&z.goopGroupId&&I.add(z.goopGroupId)}const F=new Map;for(let N=0;N<rn;N++){const E=N+Qe;for(let z=0;z<ct;z++){const re=(k+z)%ke,te=(b=R[E])==null?void 0:b[re];if(te!=null&&te.goopGroupId){const ie=te.goopGroupId;F.has(ie)||F.set(ie,{cells:[],color:te.color}),F.get(ie).cells.push({x:z,y:N})}}}const D=new Set(y.blobs.map(N=>N.id));let X=!1;for(const[N,E]of F)D.has(N)||(y.createBlob(E.cells,E.color,N,!0,k),X=!0);y.shiftBlobsForRotation(k);const ne=new Map;for(const N of T){const E=N.data.goopGroupId;ne.has(E)||ne.set(E,{avgY:0,cells:[]}),ne.get(E).cells.push({x:N.x,y:N.y})}for(const[N,E]of ne){const z=E.cells.reduce((re,te)=>re+te.y,0)/E.cells.length;E.avgY=z}for(const N of y.blobs){const E=ne.get(N.id);if(E){N.isLoose=!0,N.isLocked=!1;const z=(E.avgY-Qe)*Pt;N.targetY=z}else N.isLoose&&(N.isLoose=!1,N.isLocked=!0,N.fillAmount=0)}const se=new Set(T.map(N=>N.data.goopGroupId));for(const N of y.blobs)N.id.startsWith("active-")||!I.has(N.id)&&!se.has(N.id)&&(e.poppedGoopGroupIds.has(N.id)&&(y.createDropletsForPop(N),e.poppedGoopGroupIds.delete(N.id)),y.removeBlob(N.id),X=!0);X&&je(N=>N+1)},[R,k,y]);const xe=v.useRef(null);v.useEffect(()=>{var D;if(!y||pt||!w||w.state!==Ln.FALLING)return;const I=`active-${w.spawnTimestamp}`;if(!y.getBlob(I)&&w.y<=5){const X=w.cells.map(b=>({x:b.x,y:b.y}));let ne=w.x-k;ne>ke/2&&(ne-=ke),ne<-ke/2&&(ne+=ke);const se=X.map(b=>({x:ne+b.x,y:w.y+b.y-Qe})),ye=((D=w.definition.cellColors)==null?void 0:D[0])??w.definition.color;y.createBlob(se,ye,I,!1,k),je(b=>b+1)}},[w==null?void 0:w.spawnTimestamp,y,k]);const Me=v.useRef(null),Oe=v.useRef(0);v.useEffect(()=>{if(!y||pt||!w||w.state!==Ln.FALLING)return;const I=`active-${w.spawnTimestamp}`,F=y.getBlob(I);if(!F)return;let D=w.x-k;D>ke/2&&(D-=ke),D<-ke/2&&(D+=ke);const X=w.rotation,ne=Me.current!==null&&Me.current!==X,se=Oe.current!==k;if(ne){let ye=F.gridCells.length>0?F.gridCells[0].y:0;for(const E of F.gridCells)E.y<ye&&(ye=E.y);let b=w.cells.length>0?w.cells[0].y:0;for(const E of w.cells)E.y<b&&(b=E.y);const N=w.cells.map(E=>({x:D+E.x,y:ye+(E.y-b)}));F.gridCells=N,F.rotation=X*90}if(se||ne){for(let E=0;E<F.gridCells.length&&E<w.cells.length;E++)F.gridCells[E].x=D+w.cells[E].x;let ye=0;for(const E of F.gridCells)ye+=E.x;const b=ye/F.gridCells.length,N=mn.x+(b+.5)*Pt;if(se){const E=N-F.targetX;for(const z of F.vertices)z.pos.x+=E,z.oldPos.x+=E;for(const z of F.innerVertices)z.pos.x+=E,z.oldPos.x+=E}F.targetX=N}Me.current=X,Oe.current=k},[w==null?void 0:w.x,w==null?void 0:w.rotation,w==null?void 0:w.state,y,k,pt]),v.useEffect(()=>{if(!y||pt)return;const I=xe.current,F=w;if(I&&I.state===Ln.FALLING&&(!F||F.spawnTimestamp!==I.spawnTimestamp)){const D=`active-${I.spawnTimestamp}`;y.removeBlob(D),je(X=>X+1)}xe.current=F},[w,y]);const Ne=Date.now(),Fe=v.useMemo(()=>by(R,k,T),[R,k,T]),$e=v.useCallback(I=>{if(A.length===0)return"#a855f7";const F=400,D=.02,X=Ne%(A.length*F)/F,ne=Math.abs(I)*D;let se=(X+ne)%A.length;se<0&&(se+=A.length);const ye=Math.floor(se),b=(ye+1)%A.length,N=se-ye,E=A[ye],z=A[b];if(!E||!z)return"#a855f7";const re=parseInt(E.slice(1,3),16),te=parseInt(E.slice(3,5),16),ie=parseInt(E.slice(5,7),16),ae=parseInt(z.slice(1,3),16),he=parseInt(z.slice(3,5),16),Ae=parseInt(z.slice(5,7),16),Ee=Math.round(re+(ae-re)*N),Ie=Math.round(te+(he-te)*N),De=Math.round(ie+(Ae-ie)*N);return`rgb(${Ee}, ${Ie}, ${De})`},[Ne,A]),W=v.useMemo(()=>pt?null:i.jsx("defs",{children:Array.from(Fe.entries()).map(([I,F])=>i.jsx("mask",{id:`mask-${I}`,children:F.map((D,X)=>i.jsx("path",{d:Ry(D.screenX,D.screenY,D.width,Le,D.neighbors),fill:"white",stroke:"white",strokeWidth:"1.5"},D.cell.id+"-"+X))},`mask-${I}`))}),[Fe]);v.useMemo(()=>new Set(V.map(I=>I.color)),[V]);const M=V.filter(I=>Ne-I.spawnTime<500),B=((f==null?void 0:f.GOOP_HOLD_VIEWER)||0)>=1,de=((f==null?void 0:f.GOOP_WINDOW)||0)>=1;return i.jsxs("div",{className:"w-full h-full bg-slate-950 relative shadow-2xl border-x-4 border-slate-900 overflow-hidden select-none touch-none",style:{touchAction:"manipulation",contain:"strict"},onPointerDown:H.onPointerDown,onPointerMove:H.onPointerMove,onPointerUp:H.onPointerUp,onPointerLeave:H.onPointerUp,onTouchStart:H.onTouchStart,onTouchMove:H.onTouchMove,onTouchEnd:H.onTouchEnd,onTouchCancel:H.onTouchCancel,children:[!pt&&i.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] hidden md:block",style:{backgroundSize:"100% 2px, 3px 100%"}}),i.jsxs("svg",{width:"100%",height:"100%",viewBox:`${$} ${U} ${J} ${G}`,preserveAspectRatio:"xMidYMin meet",className:"touch-none",style:{pointerEvents:"none",willChange:"transform",filter:s<100?`brightness(${s/100}) grayscale(${Math.max(0,(50-s)/50)})`:s>100?`brightness(${s/100})`:void 0,transition:"filter 0.05s linear"},children:[W,i.jsxs("defs",{children:[i.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:C,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${g} ${h}`,result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),i.jsxs("filter",{id:"goo-filter-falling",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:x??C,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${m??g} ${j??h}`,result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),i.jsx("clipPath",{id:"tank-viewport-clip",children:i.jsx("rect",{x:Ns.x,y:Ns.y,width:Ns.w,height:Ns.h})})]}),i.jsx("rect",{x:$,y:we,width:J,height:pe,fill:Y}),i.jsx("line",{x1:$,y1:we,x2:$+J,y2:we,stroke:Y.replace("0.15","0.6"),strokeWidth:"2",strokeDasharray:"4 4"}),!pt&&Array.from({length:rn}).map((I,F)=>{const D=F*Le;return Array.from({length:ct}).map((X,ne)=>{const se=lt(ne),ye=lt(ne+1)-se;return i.jsxs("g",{children:[i.jsx("line",{x1:se,y1:D,x2:se+ye,y2:D,stroke:dn.GRID_EMPTY,strokeWidth:"1",opacity:.2}),i.jsx("line",{x1:se,y1:D,x2:se,y2:D+Le,stroke:dn.GRID_EMPTY,strokeWidth:"1",opacity:.2})]},`bg-${F}-${ne}`)})}),q&&q.filter(I=>Ne-I.spawnTime>=500).map(I=>I.branchCrackIds.map(F=>{const D=q.find(ie=>ie.id===F);if(!D||Ne-D.spawnTime<500)return null;let X=I.x-k;X>ke/2&&(X-=ke),X<-ke/2&&(X+=ke);let ne=D.x-k;if(ne>ke/2&&(ne-=ke),ne<-ke/2&&(ne+=ke),X<-1||X>ct||ne<-1||ne>ct)return null;const se=lt(X),ye=lt(X+1)-se,b=se+ye/2,N=(I.y-Qe)*Le+Le/2,E=lt(ne),z=lt(ne+1)-E,re=E+z/2,te=(D.y-Qe)*Le+Le/2;return i.jsx("line",{x1:b,y1:N,x2:re,y2:te,stroke:I.color,strokeWidth:"2",strokeOpacity:.7},`crack-line-${I.id}-${F}`)})),q&&q.filter(I=>Ne-I.spawnTime>=500).map(I=>{let F=I.x-k;if(F>ke/2&&(F-=ke),F<-ke/2&&(F+=ke),F>=0&&F<ct){const D=lt(F),X=lt(F+1)-D,ne=(I.y-Qe)*Le,se=D+X/2,ye=ne+Le/2;return i.jsx("circle",{cx:se,cy:ye,r:Le/4,fill:I.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`crack-${I.id}`)}return null}),V.filter(I=>Ne-I.spawnTime>=500).map(I=>{let F=I.x-k;if(F>ke/2&&(F-=ke),F<-ke/2&&(F+=ke),F>=0&&F<ct){const D=lt(F),X=lt(F+1)-D,ne=(I.y-Qe)*Le,se=D+X/2,ye=ne+Le/2;return i.jsx("circle",{cx:se,cy:ye,r:Le/4,fill:I.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`goal-${I.id}`)}return null}),V.map(I=>{const F=We(k+ct/2);let D=I.x-F;if(D>ke/2&&(D-=ke),D<-ke/2&&(D+=ke),Math.abs(D)>ct/2){const X=D>0,ne=(I.y-Qe)*Le+Le/2,se=X?$+J-5:$+5;return i.jsx("g",{opacity:.7,children:i.jsx("path",{d:X?`M ${se} ${ne-10} L ${se+10} ${ne} L ${se} ${ne+10} Z`:`M ${se} ${ne-10} L ${se-10} ${ne} L ${se} ${ne+10} Z`,fill:I.color,stroke:"white",strokeWidth:"1"})},`off-${I.id}`)}return null}),i.jsx("g",{opacity:S,children:Array.from(Fe.entries()).map(([I,F])=>{if(F.length===0)return null;const X=F[0].color,ne=I===ue,se=I===Se||e.prePoppedGoopGroups.has(I),ye=F.some(ae=>ae.cell.isSealingGoop),b=e.prePoppedGoopGroups.has(I),N=F.some(ae=>ae.cell.isWild);let E=1/0,z=1/0,re=-1/0,te=-1/0;F.forEach(ae=>{E=Math.min(E,ae.screenX),z=Math.min(z,ae.screenY),re=Math.max(re,ae.screenX+ae.width),te=Math.max(te,ae.screenY+Le)});const ie=N?$e(E):X;if(pt){const ae=F[0].cell.groupSize*fo,he=Ne-F[0].cell.timestamp,Ae=Math.min(1,he/ae),Ee=Ae>=1,Ie=te-z,De=te-Ae*Ie;return i.jsxs("g",{className:se?"shake-anim":"",children:[F.map(Pe=>i.jsx("rect",{x:Pe.screenX-.5,y:Pe.screenY,width:Pe.width+1,height:Le,fill:Pe.cell.isWild?$e(Pe.screenX):X,fillOpacity:.25},`bg-${Pe.cell.id}`)),!Ee&&F.map(Pe=>{const He=Pe.screenY+Le,Ue=Pe.screenY;if(He<=De)return null;const le=Math.max(Ue,De),Be=He-le;return i.jsx("rect",{x:Pe.screenX-.5,y:le,width:Pe.width+1,height:Be,fill:Pe.cell.isWild?$e(Pe.screenX):X,fillOpacity:.75},`fill-${Pe.cell.id}`)}),Ee&&F.map(Pe=>i.jsx("rect",{x:Pe.screenX-.5,y:Pe.screenY,width:Pe.width+1,height:Le,fill:Pe.cell.isWild?$e(Pe.screenX):X,fillOpacity:.85},`full-${Pe.cell.id}`)),F.map(Pe=>i.jsx("path",{d:Ar(Pe.screenX,Pe.screenY,Pe.width,Le,Pe.neighbors),fill:"none",stroke:b?"#ff6b6b":ye?"white":Pe.cell.isWild?$e(Pe.screenX):X,strokeWidth:b||ye?3:2,strokeDasharray:b?"4 2":void 0,className:Pe.cell.isWild&&!b&&!ye?"wild-stroke":void 0},`cnt-${Pe.cell.id}`)),ne&&i.jsx("rect",{x:E,y:z,width:re-E,height:te-z,fill:"white",fillOpacity:.3})]},`group-${I}`)}return i.jsxs("g",{className:se?"shake-anim":"",children:[i.jsx("rect",{x:E,y:z,width:re-E,height:te-z,fill:ie,fillOpacity:.2,mask:`url(#mask-${I})`}),i.jsx("g",{opacity:.9,mask:`url(#mask-${I})`,children:F.map((ae,he)=>{const Ae=ae.cell.isWild?$e(ae.screenX):X;if(!ae.cell||ae.isFalling)return i.jsx("rect",{x:ae.screenX-.5,y:ae.screenY,width:ae.width+1,height:Le,fill:Ae},`liq-${ae.cell.id}`);const Ee=ae.cell.groupSize*fo,Ie=ae.cell.groupMaxY-ae.cell.groupMinY+1,De=Ee/Math.max(1,Ie),He=(ae.cell.groupMaxY-ae.y)*De,Ue=Ne-ae.cell.timestamp-He;let le=Ue>=De?Le:Ue>0?Ue/De*Le:0;return i.jsx("rect",{x:ae.screenX-.5,y:ae.screenY+(Le-le),width:ae.width+1,height:le,fill:Ae},`liq-${ae.cell.id}`)})}),ne&&i.jsx("rect",{x:E,y:z,width:re-E,height:te-z,fill:"white",fillOpacity:.3,mask:`url(#mask-${I})`}),F.map((ae,he)=>i.jsx("path",{d:Ar(ae.screenX,ae.screenY,ae.width,Le,ae.neighbors),fill:"none",stroke:b?"#ff6b6b":ye?"white":ae.cell.isWild?$e(ae.screenX):X,strokeWidth:b||ye?"3":"2",strokeDasharray:b?"4 2":void 0,className:!pt&&!b?ae.cell.isWild?"wild-stroke":ye?"super-glowing-stroke":"glow-stroke":void 0,style:!pt&&!b&&!ae.cell.isWild?{color:ye?"white":X}:void 0},`cnt-${ae.cell.id}`))]},`group-${I}`)})}),!pt&&y&&y.blobs.length>0&&(()=>{const I=new Map;for(const X of y.blobs){if(X.isFalling)continue;const ne=I.get(X.color)||[];ne.push(X),I.set(X.color,ne)}const F=y.attractionSprings,D=y.params;return i.jsx(i.Fragment,{children:Array.from(I.entries()).map(([X,ne])=>i.jsxs("g",{filter:"url(#goo-filter)",clipPath:"url(#tank-viewport-clip)",children:[F.map((se,ye)=>{const b=y.blobs[se.blobA],N=y.blobs[se.blobB];if(!b||!N||b.color!==X)return null;const E=b.vertices[se.vertexA],z=N.vertices[se.vertexB];if(!E||!z)return null;const re=z.pos.x-E.pos.x,te=z.pos.y-E.pos.y,ie=Math.sqrt(re*re+te*te),ae=Math.min(1,ie/D.goopiness),he=D.tendrilEndRadius;if(he<1)return null;const Ae=1-D.tendrilSkinniness,Ee=1-D.tendrilSkinniness*.3,Ie=Ee-(Ee-Ae)*ae,De=he*Ie,Pe=he*1.4,He=Math.max(2,Math.ceil(ie/Pe)),Ue=[];for(let le=0;le<=He;le++){const Be=le/He,Xe=Math.sin(Be*Math.PI),kt=he-(he-De)*Xe;Ue.push({cx:E.pos.x+re*Be,cy:E.pos.y+te*Be,r:Math.max(2,kt)})}return i.jsx("g",{children:Ue.map((le,Be)=>i.jsx("circle",{cx:le.cx,cy:le.cy,r:le.r,fill:b.color},Be))},`tendril-${ye}`)}),ne.map(se=>{const ye=of(se),b=se.vertices.map(re=>re.pos),E=af(se).map(re=>re===0?"":`translate(${re}, 0)`);if(se.isLocked&&se.fillAmount<1){const re=D.wallThickness,te=Ly(b,re),ie=cp(te),ae=Iy(te),he=ae.maxY-ae.minY,Ae=ae.maxY-he*se.fillAmount,Ee=`fill-clip-${se.id}`,Ie=50;return i.jsx("g",{children:E.map((De,Pe)=>i.jsxs("g",{transform:De,children:[i.jsx("path",{d:ye,fill:se.color}),i.jsx("defs",{children:i.jsx("clipPath",{id:`${Ee}-${Pe}`,children:i.jsx("rect",{x:ae.minX-Ie,y:ae.minY-Ie,width:ae.maxX-ae.minX+Ie*2,height:Ae-ae.minY+Ie})})}),i.jsx("path",{d:ie,fill:"#1e293b",clipPath:`url(#${Ee}-${Pe})`})]},`soft-${se.id}-${Pe}`))},`soft-${se.id}`)}return i.jsx("g",{children:E.map((re,te)=>i.jsx("path",{d:ye,fill:se.color,transform:re},`soft-${se.id}-${te}`))},`soft-${se.id}`)})]},`color-group-${X}`))})})(),!pt&&y&&(()=>{const I=y.blobs.filter(X=>X.isFalling&&!X.isLocked);if(I.length===0)return null;const F=y.attractionSprings,D=y.params;return i.jsxs("g",{filter:"url(#goo-filter-falling)",clipPath:"url(#tank-viewport-clip)",children:[F.map((X,ne)=>{const se=y.blobs[X.blobA],ye=y.blobs[X.blobB];if(!se||!ye||!se.isFalling&&!ye.isFalling)return null;const b=se.vertices[X.vertexA],N=ye.vertices[X.vertexB];if(!b||!N)return null;const E=N.pos.x-b.pos.x,z=N.pos.y-b.pos.y,re=Math.sqrt(E*E+z*z),te=Math.min(1,re/D.fallingGoopiness),ie=D.fallingTendrilEndRadius;if(ie<1)return null;const ae=1-D.fallingTendrilSkinniness,he=1-D.fallingTendrilSkinniness*.3,Ae=he-(he-ae)*te,Ee=ie*Ae,Ie=ie*1.4,De=Math.max(2,Math.ceil(re/Ie)),Pe=[];for(let He=0;He<=De;He++){const Ue=He/De,le=Math.sin(Ue*Math.PI),Be=ie-(ie-Ee)*le;Pe.push({cx:b.pos.x+E*Ue,cy:b.pos.y+z*Ue,r:Math.max(2,Be)})}return i.jsx("g",{children:Pe.map((He,Ue)=>i.jsx("circle",{cx:He.cx,cy:He.cy,r:He.r,fill:se.color},Ue))},`falling-tendril-${ne}`)}),I.map(X=>af(X).map((se,ye)=>{const b=of(X);if(!b)return null;const N=se===0?void 0:`translate(${se}, 0)`,E=w==null?void 0:w.definition.isWild,z=E?$e(X.targetX):X.color;return i.jsx("path",{d:b,fill:z,fillOpacity:.8,transform:N,className:E?"wild-stroke wild-fill":void 0},`falling-${X.id}-${ye}`)}))]})})(),!pt&&y&&y.droplets.length>0&&i.jsx("g",{children:y.droplets.map(I=>i.jsx("circle",{cx:I.pos.x,cy:I.pos.y,r:I.radius,fill:I.color,opacity:I.opacity},I.id))}),P&&!pt&&y&&y.blobs.length>0&&i.jsx("g",{children:y.blobs.map(I=>i.jsxs("g",{children:[i.jsx("circle",{cx:I.targetX,cy:I.targetY,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),I.vertices.map((F,D)=>{const X=I.vertices[(D+1)%I.vertices.length];return i.jsx("line",{x1:F.pos.x,y1:F.pos.y,x2:X.pos.x,y2:X.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${I.id}-${D}`)}),I.vertices.map((F,D)=>i.jsxs("g",{children:[i.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:F.pos.x+6,y:F.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:D})]},`v-${I.id}-${D}`)),I.innerVertices.map((F,D)=>i.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:3,fill:"gray",stroke:"white",strokeWidth:1},`iv-${I.id}-${D}`)),i.jsx("text",{x:I.targetX,y:I.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:I.isLocked?`${Math.round(I.fillAmount*100)}%`:"falling"})]},`debug-${I.id}`))}),w&&w.state===Ln.FALLING&&(()=>{const I=rp(R,w),F=w.definition.isWild;return w.cells.map((D,X)=>{var N;const ne=((N=w.definition.cellColors)==null?void 0:N[X])??w.definition.color,se=We(w.x+D.x),ye=I+D.y;if(ye<Qe)return null;let b=se-k;if(b>ke/2&&(b-=ke),b<-ke/2&&(b+=ke),b>=-2&&b<ct+2){const E=lt(b),z=lt(b+1)-E,re=(ye-Qe)*Le,te={t:w.cells.some(ie=>ie.x===D.x&&ie.y===D.y-1),r:w.cells.some(ie=>ie.x===D.x+1&&ie.y===D.y),b:w.cells.some(ie=>ie.x===D.x&&ie.y===D.y+1),l:w.cells.some(ie=>ie.x===D.x-1&&ie.y===D.y)};return i.jsxs("g",{children:[i.jsx("rect",{x:E,y:re,width:z,height:Le,fill:F?$e(E):ne,fillOpacity:.2,rx:4,ry:4}),i.jsx("path",{d:Ar(E,re,z,Le,te),fill:"none",stroke:F?$e(E):ne,strokeWidth:"1",strokeDasharray:"4 2",opacity:"0.75",className:F?"wild-stroke":void 0})]},`ghost-${X}`)}return null})})(),Q&&Q.map(I=>{let F=I.x-k;if(F>ke/2&&(F-=ke),F<-ke/2&&(F+=ke),F<-1||F>ct)return null;const D=lt(F),X=lt(F+1)-D,ne=(I.y-Qe)*Le;return ne<-Le?null:i.jsxs("g",{children:[i.jsx("rect",{x:D,y:ne,width:X,height:Le,fill:I.color,fillOpacity:.3,rx:4,ry:4}),i.jsx("rect",{x:D,y:ne,width:X,height:Le,fill:"none",stroke:I.color,strokeWidth:"2",strokeDasharray:"4 2",rx:4,ry:4})]},`dump-${I.id}`)}),pt&&w&&w.state===Ln.FALLING&&(()=>{const I=w.definition.isWild,F=w.cells.map((D,X)=>{var N;const ne=((N=w.definition.cellColors)==null?void 0:N[X])??w.definition.color,se=We(w.x+D.x),ye=w.y+D.y;let b=se-k;if(b>ke/2&&(b-=ke),b<-ke/2&&(b+=ke),b>=-2&&b<ct+2){const E=lt(b),z=lt(b+1)-E,re=(ye-Qe)*Le,te={t:w.cells.some(ie=>ie.x===D.x&&ie.y===D.y-1),r:w.cells.some(ie=>ie.x===D.x+1&&ie.y===D.y),b:w.cells.some(ie=>ie.x===D.x&&ie.y===D.y+1),l:w.cells.some(ie=>ie.x===D.x-1&&ie.y===D.y)};return{screenX:E,screenY:re,width:z,neighbors:te,color:ne}}return null}).filter(Boolean);return F.length===0?null:i.jsxs("g",{children:[i.jsx("g",{opacity:.8,children:F.map((D,X)=>i.jsx("rect",{x:D.screenX,y:D.screenY,width:D.width,height:Le,fill:I?$e(D.screenX):D.color,rx:4,ry:4},X))}),F.map((D,X)=>i.jsx("path",{d:Ar(D.screenX,D.screenY,D.width,Le,D.neighbors),fill:"none",stroke:"white",strokeWidth:"2",className:I?"wild-stroke":void 0},`outline-${X}`))]})})(),_.map(I=>{let F=I.x-k;if(F>ke/2&&(F-=ke),F<-ke/2&&(F+=ke),F>=-2&&F<ct+2){const D=lt(F),X=lt(F+1)-D,ne=(I.y-Qe)*Le;return i.jsx("text",{x:D+X/2,y:ne+Le/2,fill:I.color,textAnchor:"middle",className:"floating-score",fontSize:"24",children:I.text},I.id)}return null}),e.phase===Ze.TankScreen&&i.jsxs(i.Fragment,{children:[t>=1&&i.jsxs("g",{children:[l&&l[_e.LASER]>Date.now()&&i.jsxs("text",{x:$+8+6,y:G*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[_e.LASER]-Date.now())/1e3),"s"]}),i.jsx(nf,{value:r,colorMode:"drain",x:$+8,y:G*.04,height:G*.2,width:12})]}),t>=3&&i.jsxs("g",{children:[l&&l[_e.CONTROLS]>Date.now()&&i.jsxs("text",{x:$+J-20+6,y:G*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[_e.CONTROLS]-Date.now())/1e3),"s"]}),i.jsx(nf,{value:o,colorMode:"heat",x:$+J-20,y:G*.04,height:G*.2,width:12})]}),c.length>0&&c.map((I,F)=>{const D=En[I];if(!D)return null;const X=a[I]||0,ne=X>=100,se=36,ye=$+J-26,b=G*.3+F*(se+8);return i.jsx(Ey,{upgradeId:I,name:D.name,charge:X,isReady:ne,x:ye,y:b,size:se,onClick:()=>ne&&(u==null?void 0:u(I))},I)})]})]}),me.position&&me.progress>0&&i.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:me.position.x,top:me.position.y,transform:"translate(-50%, -50%)"},children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${me.progress/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),oe>=0&&i.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:"50%",bottom:"15%",transform:"translate(-50%, 0)"},children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${oe/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),e.complications.length>0&&i.jsx("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none",style:{gap:"1.5rem"},children:[...e.complications].sort((I,F)=>I.startTime-F.startTime).map(I=>{const D={[_e.LIGHTS]:"Lights",[_e.CONTROLS]:"Controls",[_e.LASER]:"Laser"}[I.type]||I.type;return i.jsxs("div",{className:"malfunction-pulse text-center",style:{textShadow:"0 0 20px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.5)"},children:[i.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:D}),i.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:"Malfunction"}),i.jsx("div",{className:"text-red-400 mt-2",style:{fontFamily:"'Amazon Ember', sans-serif",fontSize:"clamp(0.875rem, 3vw, 1.25rem)"},children:"Fix at Console"})]},I.id)})}),M.map(I=>{const F=Ne-I.spawnTime,D=Math.min(1,F/500),X=1-(1-D)*(1-D),se=50+(A.indexOf(I.color)-(A.length-1)/2)*8,ye=6,b=O(I.x,I.y),N=se+(b.x-se)*X,E=ye+(b.y-ye)*X;return i.jsx("div",{className:"absolute w-4 h-4 rounded-full shadow-lg border border-white/50 z-30",style:{backgroundColor:I.color,left:`${N}%`,top:`${E}%`,transform:"translate(-50%, -50%)",boxShadow:pt?`0 0 4px ${I.color}`:`0 0 10px ${I.color}`}},`fly-${I.id}`)}),e.phase===Ze.TankScreen&&(B||de)&&i.jsxs("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:10,display:"flex",gap:"8px"},children:[i.jsx(sf,{piece:d??null,label:"STORED",visible:B,rank:t}),i.jsx(sf,{piece:p??null,label:"NEXT",visible:de,rank:t})]})]})};var zy={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Gy=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Yy=(e,t)=>{const n=v.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:l,children:c,...a},u)=>v.createElement("svg",{ref:u,...zy,width:r,height:r,stroke:s,strokeWidth:l?Number(o)*24/Number(r):o,className:`lucide lucide-${Gy(e)}`,...a},[...t.map(([f,d])=>v.createElement(f,d)),...(Array.isArray(c)?c:[c])||[]]));return n.displayName=`${e}`,n};var $t=Yy;const Hy=$t("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Wy=$t("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Ji=$t("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Uy=$t("Combine",[["rect",{width:"8",height:"8",x:"2",y:"2",rx:"2",key:"z1hh3n"}],["path",{d:"M14 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"83orz6"}],["path",{d:"M20 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"k86dmt"}],["path",{d:"M10 18H5c-1.7 0-3-1.3-3-3v-1",key:"6vokjl"}],["polyline",{points:"7 21 10 18 7 15",key:"1k02g0"}],["rect",{width:"8",height:"8",x:"14",y:"14",rx:"2",key:"1fa9i4"}]]),Xy=$t("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Vy=$t("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),qy=$t("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Zy=$t("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),Ky=$t("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Qy=$t("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Jy=$t("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),eg=$t("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["line",{x1:"12",x2:"12.01",y1:"6",y2:"6",key:"16cbga"}]]),tg=$t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),ng=$t("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),sg=$t("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),og=({state:e,maxTime:t})=>{const{shiftScore:n,gameOver:s,popStreak:r,shiftTime:o}=e,l=Math.max(0,Math.min(1,1-o/t)),c=l>.8,a=l>.9;return i.jsxs(i.Fragment,{children:[a&&!s&&i.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_40%,rgba(100,0,0,0.4)_100%)] animate-pulse"}),i.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 px-1 pt-4 pointer-events-none z-50 flex justify-between items-start",style:{width:"min(100%, 100dvh * 0.75)"},children:[i.jsxs("div",{className:"flex flex-col items-start drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[i.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-0.5 text-slate-400/90",children:"Pressure"}),i.jsxs("div",{className:`flex items-baseline gap-1 ${c?"text-red-500 animate-pulse":"text-slate-200"}`,children:[i.jsx(Hy,{className:"w-5 h-5 opacity-90"}),i.jsxs("span",{className:"text-4xl font-mono font-black leading-none tracking-tighter",children:[(l*100).toFixed(0),"%"]})]})]}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-16 flex flex-col items-center",children:r>1&&i.jsxs("div",{className:"text-2xl text-yellow-400 animate-bounce font-black tracking-wider whitespace-nowrap drop-shadow-[0_4px_4px_rgba(0,0,0,0.9)] stroke-black",children:["x",r," SURGE"]})}),i.jsxs("div",{className:"flex flex-col items-end drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[i.jsx("span",{className:"text-[10px] text-green-500/90 uppercase font-bold tracking-widest mb-0.5",children:"Shift Score"}),i.jsx("span",{className:"text-4xl font-mono text-green-400 font-black leading-none tracking-tighter shadow-green-500/10",children:n.toLocaleString()})]})]}),i.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center text-slate-500 text-xs pointer-events-none hidden md:block opacity-30 z-50 font-mono",children:"ARROWS / WASD to Rotate Cylinder  SPACE to Drop  CLICK Masses to Purge"})]})},cs=50,nn=e=>e<=0?0:e*(3375+125*e),rg=e=>{if(e<=0)return 0;if(e>=cs)return nn(cs);const t=nn(e),n=nn(e+1);return Math.floor(t+(n-t)*.5)},ig=()=>{const e=[];for(let t=10;t<=cs;t+=10)e.push(t);return e},lg=(e,t)=>{if(t<=e)return[];const n=[],s=ig();for(const r of s)r>e&&r<=t&&n.push(r);return n},xt=e=>{if(e<nn(1))return{rank:0,progress:Math.max(0,e),toNextRank:3500,careerScore:Math.max(0,e),isMaxRank:!1};let t=1;for(;t<cs&&e>=nn(t+1);)t++;const n=nn(t),s=nn(t+1),r=e-n,o=s-n;return{rank:t,progress:r,toNextRank:o,careerScore:e,isMaxRank:t>=cs}},ap=(e,t,n)=>{const s=xt(e).rank,r=s+2,o=e+t,l=xt(o),c=l.rank-s;let a,u;return n?c===0?(a=s+1,u=nn(a)+100):c===1?(a=s+2,u=nn(a)+100):(a=r,u=nn(a)+100):c<=2?(u=o,a=l.rank):(a=r,u=nn(a)+100),a>cs&&(a=cs,u=nn(cs)),{newCareerScore:u,ranksGained:a-s}},ds={[_e.LASER]:{unlockRank:4,capacitorMax:100,drainPerUnit:4,drainUpgradeEffect:En.CAPACITOR_EFFICIENCY.effectPerLevel},[_e.LIGHTS]:{unlockRank:2,graceBaseSec:5,gracePerLevel:.75,dimDurationSec:5,recoverRate:400,overflarePeak:110,overflareUpMs:50,overflareDownMs:100,dimThreshold:10,failedBrightness:5,snapToFailMs:100,flickerDipBrightness:70,flickerDipMs:80,flickerRecoverMs:120},[_e.CONTROLS]:{unlockRank:6,heatMax:100,heatPerRotation:5,dissipationBase:50,dissipationUpgradeEffect:En.GEAR_LUBRICATION.effectPerLevel,idleThresholdMs:200}},uf={minSeconds:8,maxSeconds:20};function cg(e,t){const n=ds[e].unlockRank;return Math.max(uf.minSeconds,uf.maxSeconds-(t-n))*1e3}function po(e,t){return t>=ds[e].unlockRank}class ag{constructor(){ze(this,"ctx",null);ze(this,"masterGain",null);ze(this,"musicGain",null);ze(this,"sfxGain",null);ze(this,"droneOsc",null);ze(this,"droneLfo",null);ze(this,"settings",{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1});ze(this,"isInitialized",!1)}init(t){if(this.isInitialized){this.updateSettings(t);return}this.settings=t;try{const n=window.AudioContext||window.webkitAudioContext;this.ctx=new n,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.updateVolumes(),this.isInitialized=!0}catch(n){console.error("Audio init failed",n)}}updateSettings(t){this.settings=t,this.updateVolumes()}updateVolumes(){if(!this.masterGain||!this.musicGain||!this.sfxGain||!this.ctx)return;const t=this.ctx.currentTime,n=this.settings.masterVolume/100*.5,s=this.settings.musicVolume/100,r=this.settings.sfxVolume/100;this.masterGain.gain.setTargetAtTime(n,t,.1),this.musicGain.gain.setTargetAtTime(s,t,.1),this.sfxGain.gain.setTargetAtTime(r,t,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}startMusic(){this.stopMusic()}stopMusic(){if(this.droneOsc){try{this.droneOsc.stop()}catch{}this.droneOsc=null}if(this.droneLfo){try{this.droneLfo.stop()}catch{}this.droneLfo=null}}setPressure(t){}playPop(t){if(!this.ctx||!this.sfxGain)return;const n=this.ctx.currentTime,s=this.ctx.createOscillator(),r=this.ctx.createGain();s.connect(r),r.connect(this.sfxGain);const o=400+t*50;s.frequency.setValueAtTime(o,n),s.frequency.exponentialRampToValueAtTime(o*2,n+.1),r.gain.setValueAtTime(.5,n),r.gain.exponentialRampToValueAtTime(.01,n+.15),s.start(n),s.stop(n+.15)}playReject(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(150,t),n.frequency.linearRampToValueAtTime(100,t+.15),s.gain.setValueAtTime(.3,t),s.gain.linearRampToValueAtTime(0,t+.15),n.start(t),n.stop(t+.15)}playMove(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="triangle";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(800,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),n.start(t),n.stop(t+.05)}playRotate(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="square";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(600,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),n.start(t),n.stop(t+.08)}playDrop(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sine",n.frequency.setValueAtTime(350,t),n.frequency.exponentialRampToValueAtTime(60,t+.15);const s=this.ctx.createGain();s.gain.setValueAtTime(.4,t),s.gain.exponentialRampToValueAtTime(.01,t+.15),n.connect(s),s.connect(this.sfxGain),n.start(t),n.stop(t+.15);const r=this.ctx.sampleRate*.2,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),l=o.getChannelData(0);for(let f=0;f<r;f++)l[f]=Math.random()*2-1;const c=this.ctx.createBufferSource();c.buffer=o;const a=this.ctx.createBiquadFilter();a.type="lowpass",a.Q.value=8,a.frequency.setValueAtTime(800,t),a.frequency.exponentialRampToValueAtTime(200,t+.15);const u=this.ctx.createGain();u.gain.setValueAtTime(.3,t),u.gain.exponentialRampToValueAtTime(.01,t+.15),c.connect(a),a.connect(u),u.connect(this.sfxGain),c.start(t)}playGameOver(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(400,t),n.frequency.linearRampToValueAtTime(50,t+1.5),s.gain.setValueAtTime(.5,t),s.gain.linearRampToValueAtTime(0,t+1.5),n.start(t),n.stop(t+1.5)}}const vt=new ag,ug=1e3;class fg{checkComplications(t,n,s){const r=Date.now();if(r-s<ug)return{spawned:null,newLastCheckTime:s};const o=f=>t.complications.some(d=>d.type===f),l=f=>r<t.complicationCooldowns[f],c=xt(n).rank,a=ds[_e.CONTROLS];let u=null;return!o(_e.LASER)&&!l(_e.LASER)&&po(_e.LASER,c)&&t.laserCharge<=0?u=_e.LASER:!o(_e.CONTROLS)&&!l(_e.CONTROLS)&&po(_e.CONTROLS,c)&&t.controlsHeat>=a.heatMax&&(u=_e.CONTROLS),{spawned:u,newLastCheckTime:r}}spawnComplication(t,n){const r={id:Math.random().toString(36).substr(2,9),type:n,startTime:Date.now(),severity:1};return t.complications=[...t.complications,r],ve.emit(ge.COMPLICATION_SPAWNED,{type:n}),r}resolveComplication(t,n,s,r){const o=t.complications.find(l=>l.id===n);if(o){switch(o.type){case _e.LASER:t.laserCharge=ds[_e.LASER].capacitorMax,t.prePoppedGoopGroups.clear();break;case _e.CONTROLS:t.controlsHeat=0,t.rotationTimestamps=[];break;case _e.LIGHTS:t.lightsBrightness=100,t.lightsGraceStart=Date.now(),t.lightsFlickered=!1;break}const l=xt(s+t.shiftScore).rank,c=cg(o.type,l);t.complicationCooldowns[o.type]=Date.now()+c}t.complications=t.complications.filter(l=>l.id!==n),t.activeComplicationId=null,ve.emit(ge.COMPLICATION_RESOLVED),vt.playPop(5)}extendAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(_e)){const o=t.complicationCooldowns[r];if(o>s){const c=(o-s)*n;t.complicationCooldowns[r]=o+c}}}reduceAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(_e)){const o=t.complicationCooldowns[r];if(o>s){const c=(o-s)*n;t.complicationCooldowns[r]=Math.max(s,o-c)}}}}const Ds=new fg;class _r{constructor(t){ze(this,"type","SPIN_TANK");this.dir=t}execute(t){if(t.state.gameOver||t.state.isPaused)return;const n=We(t.state.tankRotation+this.dir);let s=t.state.activeGoop;if(t.state.activeGoop){const a=Gc(t.state.activeGoop.screenX,n);s={...t.state.activeGoop,x:a};const u=Math.round(s.y),f={...s,y:u};if(fs(t.state.grid,f)){ve.emit(ge.ACTION_REJECTED);return}fs(t.state.grid,s)&&(s=f)}t.state.tankRotation=n,s&&(t.state.activeGoop=s),t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++);const r=Date.now();t.state.rotationTimestamps.push(r),t.state.rotationTimestamps.length>ox&&t.state.rotationTimestamps.shift();const o=xt(t.initialTotalScore).rank,l=ds[_e.CONTROLS],c=Date.now()<t.state.complicationCooldowns[_e.CONTROLS];po(_e.CONTROLS,o)&&!c&&(t.state.controlsHeat=Math.min(l.heatMax,t.state.controlsHeat+l.heatPerRotation)),ve.emit(ge.PIECE_MOVED),t.emitChange()}}class Ro{constructor(t){ze(this,"type","ROTATE_GOOP");this.clockwise=t}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=(n.rotation+(this.clockwise?1:-1)+4)%4;if(n.definition.type===be.O||n.definition.type===be.T_O){const c=n.definition.cellColors,a=c&&c.length===4?this.clockwise?[c[2],c[0],c[3],c[1]]:[c[1],c[3],c[0],c[2]]:c;ve.emit(ge.PIECE_ROTATED),t.state.activeGoop={...n,rotation:s,definition:{...n.definition,cellColors:a}},t.emitChange();return}const r=uy(n.cells,this.clockwise,n.rotationCenter),o={...n,cells:r,rotation:s},l=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:0,y:-2},{x:1,y:-2},{x:-1,y:-2},{x:2,y:0},{x:-2,y:0}];for(const c of l){const a=We(o.x+c.x),u=ay(a,t.state.tankRotation),f={...o,x:a,y:o.y+c.y,screenX:u};if(!fs(t.state.grid,f,t.state.tankRotation)){ve.emit(ge.PIECE_ROTATED),t.state.activeGoop=f,t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++),t.emitChange();return}}}}class Tl{constructor(t){ze(this,"type","SET_FAST_DROP");this.active=t}execute(t){t.isFastDropping=this.active}}class dg{constructor(){ze(this,"type","SWAP_PIECE")}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=n.definition,r=t.state.storedGoop;if(r){const o=Math.round(r.cells.reduce((a,u)=>a+u.x,0)/r.cells.length),l=Math.round(r.cells.reduce((a,u)=>a+u.y,0)/r.cells.length),c={definition:r,cells:[...r.cells],rotation:0,rotationCenter:{x:o,y:l},spawnTimestamp:Date.now(),startSpawnY:n.y,screenX:n.screenX,x:n.x,y:n.y,state:Ln.FALLING};if(fs(t.state.grid,c,t.state.tankRotation)){ve.emit(ge.ACTION_REJECTED);return}ve.emit(ge.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.state.activeGoop=c}else ve.emit(ge.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.spawnNewPiece();t.emitChange()}}class pg{constructor(t,n){ze(this,"type","POP_GOOP");this.x=t,this.y=n}execute(t){if(t.state.gameOver||t.state.isPaused)return;const n=t.state.grid[this.y][this.x];if(!n)return;const s=Math.max(0,1-t.state.shiftTime/t.maxTime),r=Ge-1-s*(rn-1);if(n.groupMinY<r){ve.emit(ge.ACTION_REJECTED);return}const o=Date.now(),l=n.groupSize*fo;if(o-(n.timestamp||0)<l){ve.emit(ge.ACTION_REJECTED);return}const a=dy(t.state.grid,this.x,this.y);if(a.length>0){if(t.state.complications.find(A=>A.type===_e.LASER)){const A=n.goopGroupId;if(!t.state.prePoppedGoopGroups.has(A)){t.state.prePoppedGoopGroups.add(A);const Z=Date.now();a.forEach(ce=>{const Y=t.state.grid[ce.y][ce.x];Y&&(Y.timestamp=Z)}),ve.emit(ge.ACTION_REJECTED),t.emitChange();return}t.state.prePoppedGoopGroups.delete(A)}ve.emit(ge.GOOP_POPPED,{popStreak:t.state.popStreak,count:a.length}),t.state.cellsCleared++,t.state.totalUnitsPopped+=a.length;const f=xt(t.initialTotalScore).rank,d=ds[_e.LASER];if(po(_e.LASER,f)){const A=t.powerUps.CAPACITOR_EFFICIENCY||0,Z=1-d.drainUpgradeEffect*A,ce=a.length*d.drainPerUnit*Z;t.state.laserCharge=Math.max(0,t.state.laserCharge-ce)}const p=a.length;t.state.gameStats.maxGroupSize=Math.max(t.state.gameStats.maxGroupSize,p);const y=rx,S=p*ix;let P=0;p>=Qu&&(P=(Math.floor((p-Qu)/lx)+1)*cx);let C=0;a.forEach(A=>{var Z;(Z=t.state.grid[A.y][A.x])!=null&&Z.isSealingGoop&&C++});const g=C*3e3;if(C>0){t.state.goalsCleared+=C,ve.emit(ge.GOAL_CAPTURED,{count:C}),t.chargeActiveAbilities(C*25);const A=t.powerUps.SEALING_BONUS||0;if(A>0){const Y=.1+A*.05;for(let K=0;K<C;K++)Ds.reduceAllCooldowns(t.state,Y)}}const h=y+S+P+g;t.state.shiftTime=Math.min(t.maxTime,t.state.shiftTime+h),t.state.gameStats.totalBonusTime+=h;let x=0,m=t.state.popStreak+1,j={base:0,height:0,offscreen:0,adjacency:0,speed:0};const R=vy(t.state.grid,a);x+=R,j.adjacency+=R,a.forEach(A=>{let Z=10,ce=yy(A.y),Y=gy(A.x,t.state.tankRotation);const K=my(m),$=(Z+ce+Y)*K;x+=$,j.base+=Z*K,j.height+=ce*K,j.offscreen+=Y*K});const k=Math.floor(x);t.updateScoreAndStats(k,j),t.state.popStreak=m;const w=Math.random().toString(36).substr(2,9),T=[{id:w,text:`+${k}`,x:this.x,y:this.y,life:1,color:"#fbbf24"},{id:w+"_time",text:"Vented",x:this.x,y:this.y-1,life:1,color:"#4ade80"}];C>0&&T.push({id:w+"_bonus",text:"SEALED!",x:this.x,y:this.y-2,life:1.5,color:"#fff"}),t.state.floatingTexts.push(...T),setTimeout(()=>{t.state.floatingTexts=t.state.floatingTexts.filter(A=>!A.id.startsWith(w)),t.emitChange()},1e3);const _=n.goopGroupId;_&&t.state.poppedGoopGroupIds.add(_);let L=t.state.grid.map(A=>[...A]);const V=[];a.forEach(A=>{L[A.y][A.x]=null,V.push({x:A.x,y:A.y})});const{grid:q,looseGoop:Q}=ip(L,V);if(C>0&&t.state.goalsCleared>=t.state.goalsTarget){const A=Math.max(0,1-t.state.shiftTime/t.maxTime),Z=xt(t.initialTotalScore+t.state.shiftScore).rank;if(A<.9){const ce=Sy(q,t.state.goalMarks,Z,t.state.shiftTime,t.maxTime);t.state.goalMarks.push(...ce),ve.emit(ge.GOAL_CAPTURED,{count:1})}else t.state.goalMarks=[]}t.state.grid=q,t.state.looseGoop.push(...Q),t.emitChange()}}}class hg{constructor(){ze(this,"type","START_RUN")}execute(t){t.startRun()}}class $s{constructor(t){ze(this,"type","SET_PHASE");this.phase=t}execute(t){this.phase===Ze.TankScreen?t.enterPeriscope():this.phase===Ze.ConsoleScreen?t.enterConsole():(t.state.phase=this.phase,t.emitChange())}}class xg{constructor(t){ze(this,"type","RESOLVE_COMPLICATION");this.id=t}execute(t){t.resolveComplication(this.id)}}class yg{constructor(t){ze(this,"type","ACTIVATE_ABILITY");this.upgradeId=t}execute(t){t.state.gameOver||t.state.isPaused||(t.state.activeCharges[this.upgradeId]||0)<100||(t.state.activeCharges[this.upgradeId]=0,t.activateAbility(this.upgradeId),ve.emit(ge.ABILITY_ACTIVATED,{upgradeId:this.upgradeId}),t.emitChange())}}const gg=(e,t,n,s,r,o,l)=>{if(!e)return"FAILURE";const c=n>0?Math.min(100,t/n*100):100,a=Math.max(0,100-s*2),u=Math.max(0,100-s*3),f=o>0?Math.min(100,r/o*100):50,d=Math.min(100,l/100),p=(c+a+u+f+d)/5;return p>=80?"A":p>=60?"B":p>=40?"C":"FAILURE"},mg=({shiftScore:e,rank:t,xpCurrent:n,xpNext:s,cracksFilled:r,cracksTarget:o,pressureVented:l,maxTime:c,massPurged:a,leftoverPenalty:u,unspentPower:f,isWin:d})=>{const y=Math.min(1,Math.max(0,n/s))*366.31,S=gg(d,r,o,u,l,c,e),P=S==="A"?"#5bbc70":S==="B"?"#6acbda":S==="C"?"#ffd92b":"#d82727",C=c>0?Math.round(l/c*100):0;return i.jsxs("g",{id:"End_Game_Monitor_Group",children:[i.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),i.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'From Where You Are'",fontSize:"42",transform:"translate(291.5 122.96)",textAnchor:"middle",children:"SHIFT OVER"}),i.jsxs("text",{fill:P,fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"24",letterSpacing:"0.1em",transform:"translate(291.5 155)",textAnchor:"middle",children:["GRADE: ",S]}),i.jsx("path",{fill:"#5bbc70",d:"M525.21,243.36H58.95c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM58.95,223.59c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H58.95Z"}),i.jsx("path",{fill:"#5bbc70",d:`M57.75,223.09h${y}v19.77H57.75c-4.79,0-8.68-3.89-8.68-8.68v-2.4c0-4.79,3.89-8.68,8.68-8.68Z`}),i.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(530 237)",children:[Math.floor(n).toLocaleString()," / ",Math.floor(s).toLocaleString()]}),i.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(530 213)",children:"PROMOTION THRESHOLD"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(49.87 209.32)",children:i.jsx("tspan",{x:"0",y:"0",children:"OPERATOR RANK"})}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(230 210.8)",textAnchor:"start",children:t}),i.jsx("path",{fill:"#fff",d:"M268.4,808.13v-1.02l.33-1.02c6.23-8.15,13.08-15.87,19.51-23.87,1.65-2.11,4.36-2.41,6.29-.46l20.02,23c.62.7,1,1.44,1.2,2.36-.03.33.04.7,0,1.02-.21,1.7-1.77,3.25-3.47,3.42h-40.15c-1.85-.05-3.51-1.61-3.74-3.42ZM271.73,793.93c1.56-1.89,3.12-3.76,4.65-5.6,2.57-3.07,5.23-6.25,7.76-9.4,1.83-2.35,4.56-3.73,7.45-3.73,2.47,0,4.83,1.01,6.66,2.85l.12.12,13.75,15.8h.16c1.7-.17,3.26-1.72,3.47-3.42.04-.32-.03-.69,0-1.02-.2-.92-.58-1.66-1.21-2.36l-20.02-23c-1.94-1.95-4.65-1.65-6.29.46-6.44,8.01-13.29,15.72-19.51,23.87l-.33,1.02v1.02c.21,1.67,1.66,3.12,3.33,3.37Z"}),i.jsx("text",{fill:"#d82727",fontFamily:"'From Where You Are'",fontSize:"24",transform:"translate(291.5 860.65)",textAnchor:"middle",children:"DRAG UP TO END SHIFT"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(165.69 321.1)",textAnchor:"middle",children:"SHIFT SCORE"}),i.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(165.69 390.05)",textAnchor:"middle",children:e.toLocaleString()}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M261.87,585.41H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 503.38)",textAnchor:"middle",children:"CRACKS FILLED"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 557.36)",textAnchor:"middle",children:[r," / ",o]})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M514.25,585.41h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 503.38)",textAnchor:"middle",children:"PRESSURE VENTED"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 557.36)",textAnchor:"middle",children:[C,"%"]})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M261.87,731.68H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 649.64)",textAnchor:"middle",children:"MAX POP"}),i.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 703.63)",textAnchor:"middle",children:a})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M514.25,731.68h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 649.64)",textAnchor:"middle",children:"RESIDUAL GOOP"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 703.63)",textAnchor:"middle",children:["-",u]})]}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(418.08 321.1)",textAnchor:"middle",children:"SCRAPS"}),i.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(418.08 390.05)",textAnchor:"middle",children:f})]})},vg="#14b8a6",Sg="#ffffff",Cg="#22c55e",Ir="#231f20",Lr="#d8672b";function kg({complications:e,isLaserMaxed:t,onResolveComplication:n}){const[s,r]=v.useState({active:!1,solved:!1,targets:[0,0,0,0]}),[o,l]=v.useState([0,0,0,0]),[c,a]=v.useState(null),[u,f]=v.useState(!1),d=v.useRef([]),p=v.useRef(null),y=v.useRef(null),S=v.useCallback(()=>e.some(h=>h.type===_e.LASER),[e]);v.useEffect(()=>{const h=d.current.some(m=>m.type===_e.LASER),x=S();h&&!x&&(f(!0),y.current=setTimeout(()=>{f(!1)},2500)),d.current=e},[e,S]),v.useEffect(()=>{if(!S()&&(s.active||s.solved)&&(r({active:!1,solved:!1,targets:[0,0,0,0]}),l([0,0,0,0])),S()&&!s.active&&!s.solved){const h=t?[-1,1]:[-1,0,1],x=[0,1,2,3].map(()=>h[Math.floor(Math.random()*h.length)]),m=x.map(j=>{const R=h.filter(k=>k!==j);return R[Math.floor(Math.random()*R.length)]});l(m),r({active:!0,solved:!1,targets:x})}},[e,s.active,s.solved,t,S]),v.useEffect(()=>()=>{p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]);const P=v.useCallback((h,x)=>{l(j=>{const R=[...j];return R[h]=x,e.find(w=>w.type===_e.LASER),R});const m=e.find(j=>j.type===_e.LASER);if(m&&!s.solved){const j=s.targets[h];if(x!==j)a(h),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>a(null),300);else{const R=[...o];R[h]=x,R.every((w,T)=>w===s.targets[T])&&(r(w=>({...w,solved:!0})),l([0,0,0,0]),n&&n(m.id))}}},[e,s.solved,s.targets,o,n]),C=v.useCallback(h=>{if(!S())return{left:Ir,right:Ir};const x=s.targets[h];return x===-1?{left:Lr,right:Ir}:x===1?{left:Ir,right:Lr}:{left:Lr,right:Lr}},[S,s.targets]),g=v.useCallback(()=>S()?{text:"REPAIR LASER",color:Sg}:u?{text:"LASER FIXED",color:Cg}:{text:"REPAIR LASER",color:vg},[S,u]);return{laserSliders:o,updateLaserSlider:P,shakingSlider:c,getLaserLightColors:C,getLaserTextState:g,recentlyFixed:u,isComplicationActive:S()}}const ff={0:"#96d7dd",1:"#f6f081",2:"#cb8abc"},wg=[45,315,225,135],df=[45,135,225,315],jg="#14b8a6",Pg="#ffffff",Rg="#22c55e",Wt="#231f20",Or="#d8672b";function bg({complications:e,isLightsMaxed:t,pressedBtn:n,onResolveComplication:s}){const[r,o]=v.useState({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),[l,c]=v.useState(0),[a,u]=v.useState(!1),[f,d]=v.useState(!1),p=v.useRef([]),y=v.useRef(null),S=v.useRef(null),P=v.useRef([]),C=v.useCallback(()=>e.some(w=>w.type===_e.LIGHTS),[e]),g=v.useCallback(()=>{const w=[],T=[0,0,0],_=t?3:4;for(let L=0;L<_;L++){const V=[];T[0]<2&&V.push(0),T[1]<2&&V.push(1),T[2]<2&&V.push(2);const q=V[Math.floor(Math.random()*V.length)];w.push(q),T[q]++}return w},[t]),h=v.useCallback(w=>{P.current.forEach(Q=>clearTimeout(Q)),P.current=[];let V=300;w.forEach(Q=>{const A=setTimeout(()=>{o(ce=>({...ce,showingIndex:Q}))},V);P.current.push(A);const Z=setTimeout(()=>{o(ce=>({...ce,showingIndex:-1}))},V+200);P.current.push(Z),V+=200+100});const q=setTimeout(()=>{o(Q=>({...Q,phase:"input",showingIndex:-1,inputIndex:0}))},V+100);P.current.push(q)},[]);v.useEffect(()=>{const w=p.current.some(_=>_.type===_e.LIGHTS),T=C();w&&!T&&(d(!0),S.current=setTimeout(()=>{d(!1)},2500)),p.current=e},[e,C]),v.useEffect(()=>{if(!C()&&r.phase!=="inactive"&&(o({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),c(0)),C()&&r.phase==="inactive"){const w=g();o({phase:"slider1",slider1Target:Math.random()>.5?1:-1,sequence:w,inputIndex:0,showingIndex:-1}),c(0)}},[e,r.phase,C,g]),v.useEffect(()=>()=>{y.current&&clearTimeout(y.current),S.current&&clearTimeout(S.current),P.current.forEach(w=>clearTimeout(w))},[]);const x=v.useCallback(w=>{if(r.phase!=="input")return;const T=r.sequence[r.inputIndex];if(w===T){const _=r.inputIndex+1;_>=r.sequence.length?o(L=>({...L,phase:"slider2",inputIndex:0})):o(L=>({...L,inputIndex:_}))}else{o(L=>({...L,phase:"showing",inputIndex:0,showingIndex:-1}));const _=setTimeout(()=>{h(r.sequence)},300);P.current.push(_)}},[r.phase,r.sequence,r.inputIndex,h]),m=v.useCallback(w=>{const{phase:T,slider1Target:_,sequence:L}=r;if(T==="slider1")w===_?(c(w),o(V=>({...V,phase:"showing"})),h(L)):w!==0?(u(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),c(0)},400)):c(w);else if(T==="slider2"){const V=_===1?-1:1;if(c(w),w===V){o(Q=>({...Q,phase:"solved"})),c(0);const q=e.find(Q=>Q.type===_e.LIGHTS);q&&s&&s(q.id)}}else c(w)},[e,r,s,h]),j=v.useCallback(w=>!C()||r.phase==="inactive"?Wt:r.phase==="showing"&&r.showingIndex===w||r.phase==="input"&&n===["blue","green","purple"][w]?ff[w]:Wt,[C,r.phase,r.showingIndex,n]),R=v.useCallback(()=>{const{phase:w,slider1Target:T}=r;return C()?w==="inactive"?{top:Wt,bottom:Wt}:w==="slider1"?T===1?{top:Wt,bottom:Or}:{top:Or,bottom:Wt}:w==="slider2"?T===1?{top:Or,bottom:Wt}:{top:Wt,bottom:Or}:{top:Wt,bottom:Wt}:{top:Wt,bottom:Wt}},[C,r]),k=v.useCallback(()=>C()?{text:"REPAIR LIGHTS",color:Pg}:f?{text:"LIGHTS FIXED",color:Rg}:{text:"REPAIR LIGHTS",color:jg},[C,f]);return{lightsComplication:r,lightSlider:l,handleLightsButton:x,handleLightsSliderChange:m,lightsSliderShaking:a,getLightsButtonLightColor:j,getLightsSliderLightColors:R,getLightsTextState:k,recentlyFixed:f,isComplicationActive:C()}}const Mg="#14b8a6",Tg="#ffffff",Eg="#22c55e",El="#231f20",Ag="#d8672b",pf=194.32,hf=1586.66,_g=86.84,Ig=_g*1.3;function Lg({complications:e,isControlsMaxed:t,onResolveComplication:n}){const[s,r]=v.useState({active:!1,solved:!1,targetCorner:null,completedCorners:0}),[o,l]=v.useState(0),[c,a]=v.useState(!1),[u,f]=v.useState(!1),[d,p]=v.useState(!1),[y,S]=v.useState(!1),P=v.useRef([]),C=v.useRef(null),g=v.useRef(null),h=v.useRef(null),x=v.useRef(null),m=v.useRef(!1),j=v.useRef(0),R=v.useRef(0),k=v.useRef(0),w=v.useRef(!1),T=v.useRef(!1),_=v.useCallback(()=>e.some($=>$.type===_e.CONTROLS),[e]),L=v.useCallback(($,U)=>{try{const J=document.getElementById("coord-reference");if(!J)return null;const G=J.ownerSVGElement;if(!G)return null;const pe=G.createSVGPoint();pe.x=$,pe.y=U;const we=J.getScreenCTM();if(!we)return null;const O=pe.matrixTransform(we.inverse());return{x:O.x,y:O.y}}catch{return null}},[]);v.useEffect(()=>{const $=P.current.some(J=>J.type===_e.CONTROLS),U=_();$&&!U&&(S(!0),g.current=setTimeout(()=>{S(!1)},2500)),P.current=e},[e,_]),v.useEffect(()=>{if(!_()&&(s.active||s.solved)&&r({active:!1,solved:!1,targetCorner:null,completedCorners:0}),_()&&!s.active&&!s.solved){const $=Math.floor(Math.random()*4);r({active:!0,solved:!1,targetCorner:$,completedCorners:0})}},[e,s.active,s.solved,_]),v.useEffect(()=>()=>{C.current&&clearTimeout(C.current),g.current&&clearTimeout(g.current),h.current&&clearTimeout(h.current),x.current&&clearTimeout(x.current)},[]);const V=v.useCallback(($,U)=>{const J=L($,U);if(!J)return;const G=J.x-pf,pe=J.y-hf;Math.sqrt(G*G+pe*pe)>Ig||(j.current=Math.atan2(pe,G)*(180/Math.PI),R.current=o,m.current=!0,w.current=!1,a(!0))},[o,L]),q=v.useCallback(($,U)=>{if(!m.current)return;const J=L($,U);if(!J)return;const G=J.x-pf,pe=J.y-hf,O=Math.atan2(pe,G)*(180/Math.PI)-j.current+R.current;k.current=O,w.current=!0,l(O)},[L]),Q=v.useCallback(()=>{if(!m.current||(m.current=!1,a(!1),w.current&&(T.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{T.current=!1},100)),!w.current))return;const $=k.current;let U=$%360;U<0&&(U+=360);let J=df[0],G=1/0;for(const me of df){const ue=Math.min(Math.abs(U-me),Math.abs(U-me+360),Math.abs(U-me-360));ue<G&&(G=ue,J=me)}const pe=Math.floor($/360)*360,we=[pe+J-360,pe+J,pe+J+360];let O=we[0],H=Math.abs($-we[0]);for(const me of we){const ue=Math.abs($-me);ue<H&&(H=ue,O=me)}k.current=O,l(O)},[]);v.useEffect(()=>{if(!c)return;const $=pe=>{q(pe.clientX,pe.clientY)},U=()=>{Q()},J=pe=>{pe.touches.length>0&&q(pe.touches[0].clientX,pe.touches[0].clientY)},G=()=>{Q()};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",U),window.addEventListener("touchmove",J),window.addEventListener("touchend",G),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",U),window.removeEventListener("touchmove",J),window.removeEventListener("touchend",G)}},[c,q,Q]);const A=v.useCallback(()=>{if(s.targetCorner===null)return!1;const $=wg[s.targetCorner],U=(o%360+360)%360,J=Math.abs(U-$);return Math.min(J,360-J)<15},[s.targetCorner,o]),Z=v.useCallback(()=>{f(!0),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>f(!1),300)},[]),ce=v.useCallback(()=>{if(!(!_()||s.solved)&&!c&&!T.current)if(p(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>p(!1),150),A()){const $=s.completedCorners+1;if($>=(t?3:4)){r(G=>({...G,solved:!0,targetCorner:null,completedCorners:4}));const J=e.find(G=>G.type===_e.CONTROLS);J&&n&&n(J.id)}else{const J=[0,1,2,3].filter(pe=>pe!==s.targetCorner),G=J[Math.floor(Math.random()*J.length)];r(pe=>({...pe,targetCorner:G,completedCorners:$}))}}else Z()},[_,s.solved,s.completedCorners,s.targetCorner,c,A,t,e,n,Z]),Y=v.useCallback($=>!_()||s.solved?El:s.targetCorner===$?Ag:El,[_,s.solved,s.targetCorner]),K=v.useCallback(()=>_()?{text:"REPAIR CONTROLS",color:Tg}:y?{text:"CONTROLS FIXED",color:Eg}:{text:"REPAIR CONTROLS",color:Mg},[_,y]);return{localDialRotation:o,isDialDragging:c,dialShaking:u,dialPressed:d,handleDialStart:V,handleDialMove:q,handleDialEnd:Q,handleDialPress:ce,getControlsCornerLightColor:Y,getControlsTextState:K,recentlyFixed:y,isDialAligned:A,isComplicationActive:_()&&!s.solved}}const Oo=({x:e,y:t,rotation:n=0,length:s=176,width:r=50,handleSize:o=50,value:l=0,onChange:c,trackColor:a="#eebfc5",handleColor:u="#d36b28",arrowColor:f="#ffffff",className:d=""})=>{const[p,y]=v.useState(!1),[S,P]=v.useState(0),C=v.useRef(null),g=v.useRef(0),h=(s-o)/2,x={"-1":-h,0:0,1:h},m=p?S:x[`${l}`]||0,j=w=>{w.stopPropagation(),w.currentTarget.setPointerCapture(w.pointerId),C.current={x:w.clientX,y:w.clientY},g.current=m,P(m),y(!0)},R=w=>{if(!p||!C.current)return;w.stopPropagation();const T=w.clientX-C.current.x,_=w.clientY-C.current.y,L=n*Math.PI/180,V=T*Math.cos(L)+_*Math.sin(L),q=g.current+V,Q=Math.max(-h,Math.min(h,q));P(Q)},k=w=>{if(!p)return;w.stopPropagation(),w.currentTarget.releasePointerCapture(w.pointerId),y(!1);const T=Math.abs(S-x[-1]),_=Math.abs(S-x[0]),L=Math.abs(S-x[1]);let V=0;T<_&&T<L?V=-1:L<_&&L<T?V=1:V=0,c&&V!==l&&c(V)};return i.jsx("g",{transform:`translate(${e}, ${t}) rotate(${n})`,children:i.jsxs("g",{className:d,children:[i.jsx("rect",{x:-s/2,y:-r/2,width:s,height:r,rx:6.92,ry:6.92,fill:a}),i.jsx("g",{transform:`translate(${m}, 0)`,style:{transition:p?"none":"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:i.jsx("rect",{x:-o/2,y:-o/2,width:o,height:o,rx:3.69,ry:3.69,fill:u})}),i.jsx("rect",{x:-s/2-20,y:-r/2-20,width:s+40,height:r+40,fill:"transparent",style:{cursor:"grab",touchAction:"none"},onPointerDown:j,onPointerMove:R,onPointerUp:k,onPointerLeave:k})]})})},Og=({laserSliders:e,shakingSlider:t,onSliderChange:n,getLaserLightColors:s,textState:r,isComplicationActive:o=!1})=>i.jsxs("g",{id:"Reset_Laser_Top",children:[i.jsxs("g",{pointerEvents:"none",children:[i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M157.91,233.16h-4.24l-18.69-18.69c-3.62-3.62-3.62-9.52,0-13.14l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0-8.89l20.81,20.81ZM111.51,212.35c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-1.75,1.75-2.72,4.09-2.72,6.57s.97,4.81,2.72,6.57l18.69,18.69h4.24l-20.81-20.81ZM107.64,182.65h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM235.4,214.47c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,233.16h4.24l18.69-18.69c1.75-1.75,2.72-4.09,2.72-6.57s-.97-4.81-2.72-6.57l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM260.08,214.47c.17-.17.33-.36.49-.54v-12.05c-.16-.19-.32-.37-.49-.54l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"}),i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M132.32,324.04h-4.24l-18.69-18.69c-1.75-1.75-2.72-4.09-2.72-6.57s.97-4.81,2.72-6.57l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0,8.89l20.81,20.81ZM137.1,303.23c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-3.62,3.62-3.62-9.52,0,13.14l18.69,18.69h4.24l-20.81-20.81ZM107.64,273.53h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM260.08,305.35c.18-.18.34-.36.49-.55v-12.04c-.16-.19-.32-.37-.49-.55l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,324.04h4.24l18.69-18.69c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c1.19,1.19,1.84,2.77,1.84,4.45s-.65,3.26-1.84,4.45l-20.81,20.81ZM235.4,305.35c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"})]}),i.jsx(Oo,{x:172.65,y:207.9,value:e[0],onChange:l=>n(0,l),className:t===0?"shake-anim":""}),i.jsx(Oo,{x:172.65,y:298.78,value:e[1],onChange:l=>n(1,l),className:t===1?"shake-anim":""}),i.jsx(Oo,{x:445.24,y:207.9,value:e[2],onChange:l=>n(2,l),className:t===2?"shake-anim":""}),i.jsx(Oo,{x:445.24,y:298.78,value:e[3],onChange:l=>n(3,l),className:t===3?"shake-anim":""}),i.jsxs("g",{children:[i.jsx("path",{fill:s(0).right,fillRule:"evenodd",d:"M280.92,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(0).left,fillRule:"evenodd",d:"M63.6,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(1).right,fillRule:"evenodd",d:"M280.92,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(1).left,fillRule:"evenodd",d:"M63.6,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(2).left,fillRule:"evenodd",d:"M336.96,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(2).right,fillRule:"evenodd",d:"M554.28,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(3).left,fillRule:"evenodd",d:"M336.96,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(3).right,fillRule:"evenodd",d:"M554.28,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsx("text",{fill:r.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(245.29 261.57)",children:r.text})]}),Al=({x:e,y:t,colorBody:n,colorTop:s,isPressed:r,onPress:o,onRelease:l})=>{const c="M42.31,73.62C18.58,73.62,0,59.79,0,42.13S18.58,10.65,42.31,10.65s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",a="M74.5,41.03c0,11.84-14.45,21.44-32.27,21.44S9.97,52.87,9.97,41.03c0-8.74.25-20.68.25-20.68h64.43s-.15,13.21-.15,20.68Z",f="M42.31,62.97C18.58,62.97,0,49.14,0,31.48S18.58,0,42.31,0s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",d="M74.5,30.38c0,11.84-14.45,21.44-32.27,21.44S9.97,42.22,9.97,30.38c0-8.74.25-8.47.25-8.47h64.43s-.15.99-.15,8.47Z";return i.jsx("g",{transform:`translate(${e}, ${t})`,style:{cursor:"pointer"},onMouseDown:S=>{S.stopPropagation(),o()},onMouseUp:S=>{S.stopPropagation(),l()},onMouseLeave:()=>{r&&l()},onTouchStart:S=>{S.stopPropagation(),o()},onTouchEnd:S=>{S.stopPropagation(),l()},children:r?i.jsxs("g",{transform:`translate(0, ${10.65})`,children:[i.jsx("path",{fill:"#0d1a19",d:f}),i.jsx("path",{fill:n,fillRule:"evenodd",d}),i.jsx("ellipse",{fill:s,cx:"42.31",cy:23.01,rx:"32.27",ry:"21.44"})]}):i.jsxs("g",{children:[i.jsx("path",{fill:"#0d1a19",d:c}),i.jsx("path",{fill:n,fillRule:"evenodd",d:a}),i.jsx("ellipse",{fill:s,cx:"42.31",cy:21.44,rx:"32.27",ry:"21.44"})]})})},Ng=({lightsComplication:e,lightSlider:t,onSliderChange:n,onButtonPress:s,onButtonRelease:r,getLightsButtonLightColor:o,getLightsSliderLightColors:l,textState:c,pressedBtn:a,sliderShaking:u,onBlueClick:f,onGreenClick:d,onPurpleClick:p,isComplicationActive:y=!1,recentlyFixed:S=!1})=>{const P=l(),C=e.phase==="slider1"||e.phase==="showing";return i.jsxs("g",{id:"Reset_Lights",children:[i.jsx("polygon",{fill:"#45486c",points:"608.7 1720.12 341.17 1720.12 341.17 1452.22 564.14 1452.22 608.7 1720.12",className:y?"minigame-active-pulse":S?"minigame-solved-fade":""}),i.jsx("text",{fill:c.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(414.68 1480.38)",children:c.text}),i.jsx("g",{clipPath:"url(#reset-lights-slider-clip)",children:i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M417.83,1530.35l-30.21-30.21c-3.04-3.04-7.97-3.04-11.02,0l-30.21,30.21M346.4,1555.03l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M346.4,1580.62l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M417.83,1643.18l-30.21,30.21c-3.04,3.04-7.97,3.04-11.02,0l-30.21-30.21M346.4,1618.5l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21M346.4,1592.91l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21"})}),i.jsx(Oo,{x:382.11,y:1587.01,rotation:90,value:t,onChange:n,className:u?"shake":""}),i.jsxs("g",{children:[i.jsx("path",{fill:P.bottom,d:"M382.12,1706.83c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M382.12,1685.25c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1682.25c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:P.top,d:"M382.12,1489.51c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M382.12,1467.94c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1464.94c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsx(Al,{x:431.19,y:1495,colorBody:"#3d8380",colorTop:"#96d7dd",isPressed:a==="blue"||C,onPress:()=>s("blue"),onRelease:()=>r("blue",f)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(0),d:"M546.19,1547c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M546.19,1525.42c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M546.19,1522.42c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsx(Al,{x:437.5,y:1565,colorBody:"#4c833c",colorTop:"#f6f081",isPressed:a==="green"||C,onPress:()=>s("green"),onRelease:()=>r("green",d)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(1),d:"M554.61,1616.4c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M554.61,1594.82c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M554.61,1591.82c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsx(Al,{x:444.51,y:1635,colorBody:"#803d83",colorTop:"#cb8abc",isPressed:a==="purple"||C,onPress:()=>s("purple"),onRelease:()=>r("purple",p)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(2),d:"M565.12,1689.3c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M565.12,1667.73c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.04h0M565.12,1664.73c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]})]})},xf=194.32,yf=1586.66,Dg=({localDialRotation:e,isDialDragging:t,dialShaking:n,dialPressed:s,onDialStart:r,onDialPress:o,getControlsCornerLightColor:l,textState:c,isDialAligned:a,isComplicationActive:u,recentlyFixed:f=!1})=>i.jsxs("g",{id:"Reset_Controls",children:[i.jsx("path",{fill:"#45486c",d:"M290.21,1663.73c10.78-17.3,17.01-37.73,17.01-59.61,0-23.97-7.48-46.2-20.22-64.48,7.77-.06,15.53-3.05,21.46-8.98,11.98-11.98,11.98-31.4,0-43.37-1.9-1.9-3.99-3.5-6.21-4.8-.5-17.51-14.85-31.56-32.48-31.56H121.34c-17.78,0-32.22,14.28-32.49,32-1.95,1.22-3.81,2.66-5.5,4.36-11.98,11.98-11.98,31.4,0,43.37,5.16,5.16,11.69,8.09,18.42,8.8-12.82,18.31-20.34,40.6-20.34,64.65,0,22.08,6.34,42.67,17.3,60.07-5.63,1.18-11,3.95-15.38,8.32-11.98,11.98-11.98,31.4,0,43.37,11.98,11.98,31.4,11.98,43.37,0,4.44-4.44,7.23-9.91,8.38-15.64,17.22,10.63,37.5,16.77,59.22,16.77,22.93,0,44.26-6.84,62.07-18.59.88,6.39,3.78,12.55,8.69,17.46,11.98,11.98,31.4,11.98,43.37,0,11.98-11.98,11.98-31.4,0-43.37-5.11-5.11-11.58-8.03-18.24-8.78Z",className:u?"minigame-active-pulse":f?"minigame-solved-fade":""}),i.jsx("circle",{fill:"#0d1a19",cx:"194.32",cy:"1604.12",r:"97.6",opacity:"0.3"}),i.jsxs("g",{children:[i.jsx("path",{fill:l(1),d:"M103.94,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M103.94,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(0),d:"M288.3,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M288.3,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(2),d:"M103.94,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M103.94,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(3),d:"M288.3,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.53,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M288.3,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsx("text",{fill:c.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(108.17 1480.38)",children:c.text}),i.jsx("g",{transform:`translate(0 ${s?4:0}) rotate(${Math.round(e)} ${xf} ${yf})`,style:{cursor:t?"grabbing":"grab"},onMouseDown:d=>r(d.clientX,d.clientY),onTouchStart:d=>{d.touches.length>0&&r(d.touches[0].clientX,d.touches[0].clientY)},onClick:o,children:i.jsxs("g",{className:n?"shake":"",children:[i.jsx("circle",{fill:"#d36b28",cx:"194.32",cy:"1586.66",r:"86.84"}),i.jsx("path",{fill:"none",stroke:"#fff",strokeWidth:"6",strokeMiterlimit:"10",d:"M238.98,1629.6c-11.27,11.72-27.11,19.01-44.65,19.01s-32.11-6.72-43.27-17.62"}),i.jsx("g",{transform:"translate(170.65 1623.1) rotate(135) scale(1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),i.jsx("g",{transform:"translate(219.09 1623.1) rotate(45) scale(1.74 -1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),i.jsx("path",{fill:"#fff",d:"M169.51,1524.47l20.43-20.43c1.99-1.99,5.23-1.99,7.22,0l20.43,20.43c3.22,3.22.94,8.72-3.61,8.72h-40.86c-4.55,0-6.83-5.5-3.61-8.72Z"})]})}),u&&a&&i.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"24",fontWeight:"bold",textAnchor:"middle",x:xf,y:yf+8,style:{pointerEvents:"none"},children:"PRESS"})]}),$g=194.32,Fg=1586.66,Bg=({dialRotation:e,monitorOffset:t,periscopeY:n,dragHandlers:s,monitorDragHandlers:r,isMonitorDragging:o,isPeriscopeDragging:l=!1,isSnapping:c=!1,onDialClick:a,onBlueClick:u,onGreenClick:f,onPurpleClick:d,onUpgradesClick:p,onSettingsClick:y,onHelpClick:S,onSetRank:P,onAbortClick:C,upgradeCount:g,screenContent:h,isGameOver:x=!1,isSessionActive:m=!1,rank:j,currentXP:R,nextRankXP:k,shiftScore:w=0,gameStats:T={startTime:0,totalBonusTime:0,maxGroupSize:0,penalty:0},goalsCleared:_=0,goalsTarget:L=0,unspentPower:V=0,maxTime:q=75e3,complications:Q=[],onResolveComplication:A,upgradeLevels:Z={}})=>{const ce=(Z.CAPACITOR_EFFICIENCY||0)>=En.CAPACITOR_EFFICIENCY.maxLevel,Y=(Z.CIRCUIT_STABILIZER||0)>=En.CIRCUIT_STABILIZER.maxLevel,K=(Z.GEAR_LUBRICATION||0)>=En.GEAR_LUBRICATION.maxLevel,[$,U]=v.useState(null),[J,G]=v.useState(!1),[pe,we]=v.useState(!1),{laserSliders:O,updateLaserSlider:H,shakingSlider:me,getLaserLightColors:ue,getLaserTextState:Se,recentlyFixed:oe,isComplicationActive:Ce}=kg({complications:Q,isLaserMaxed:ce,onResolveComplication:A}),{lightsComplication:ee,lightSlider:je,handleLightsButton:xe,handleLightsSliderChange:Me,lightsSliderShaking:Oe,getLightsButtonLightColor:Ne,getLightsSliderLightColors:Fe,getLightsTextState:$e,recentlyFixed:W,isComplicationActive:M}=bg({complications:Q,isLightsMaxed:Y,pressedBtn:$,onResolveComplication:A}),{localDialRotation:B,isDialDragging:de,dialShaking:I,dialPressed:F,handleDialStart:D,handleDialMove:X,handleDialEnd:ne,handleDialPress:se,getControlsCornerLightColor:ye,getControlsTextState:b,recentlyFixed:N,isDialAligned:E,isComplicationActive:z}=Lg({complications:Q,isControlsMaxed:K,onResolveComplication:A});v.useEffect(()=>{if(!de)return;const Be=Ht=>{X(Ht.clientX,Ht.clientY)},Xe=()=>{ne()},kt=Ht=>{Ht.touches.length>0&&X(Ht.touches[0].clientX,Ht.touches[0].clientY)},Wn=()=>{ne()};return window.addEventListener("mousemove",Be),window.addEventListener("mouseup",Xe),window.addEventListener("touchmove",kt),window.addEventListener("touchend",Wn),()=>{window.removeEventListener("mousemove",Be),window.removeEventListener("mouseup",Xe),window.removeEventListener("touchmove",kt),window.removeEventListener("touchend",Wn)}},[de]),v.useEffect(()=>{m||we(!1)},[m]);const re=Be=>{U(Be)},te=(Be,Xe)=>{$===Be?(U(null),Be==="blue"?xe(0):Be==="green"?xe(1):Be==="purple"&&xe(2),Xe&&Xe()):U(null)},ie=Be=>{Be.stopPropagation(),G(Xe=>!Xe)},ae=Be=>{P&&P(Be),G(!1)},he=Be=>{Be.stopPropagation(),pe?(C&&C(),we(!1)):(we(!0),setTimeout(()=>we(!1),3e3))},Ae={transition:o?"none":"transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},Ee={transition:o?"none":"opacity 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},De=363.9*Math.min(1,Math.max(0,R/k)),Pe=Math.min(1,Math.max(0,(t+400)/920)),He=Math.min(1,Math.max(0,n/300)),Ue=Math.max(Pe,He)*.85,le="translate(31.92, 399.44)";return i.jsxs("svg",{viewBox:"0 827.84 648 1152",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{overflow:"hidden"},onClick:()=>{J&&G(!1)},children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:"console-gradient",x1:"324",y1:"1979.84",x2:"324",y2:"827.84",gradientUnits:"userSpaceOnUse",children:[i.jsx("stop",{offset:"0",stopColor:"#363b5e"}),i.jsx("stop",{offset:"1",stopColor:"#0b1c3f"})]}),i.jsx("clipPath",{id:"reset-lights-slider-clip",children:i.jsx("rect",{x:"356.86",y:"1499.08",width:"50.51",height:"175.86",rx:"6.92",ry:"6.92"})})]}),i.jsxs("g",{id:"Console_Base",children:[i.jsx("polygon",{fill:"#0f1829",points:"42.37 1807.1 54.73 1865.36 592.78 1865.36 605.14 1807.1 42.37 1807.1"}),i.jsx("path",{fill:"#616a79",d:"M615.77,1807.1l14.87-84.85c.65-3.69-2.19-7.08-5.94-7.08H22.81c-3.75,0-6.59,3.38-5.94,7.08l14.87,84.85h584.04Z"}),i.jsx("path",{fill:"#59acae",d:"M583.65,1441.46H63.86l-47.08,283.09c-.6,3.61,2,6.92,5.44,6.92h603.07c3.44,0,6.04-3.31,5.44-6.92l-47.08-283.09Z"}),i.jsxs("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",transform:"translate(55 1855.15)",children:[i.jsx("tspan",{letterSpacing:"-0.04em",children:"V"}),i.jsxs("tspan",{x:"9.49",children:["ersion 1.1.13.",216]})]}),i.jsx("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",textAnchor:"end",transform:"translate(592.5 1855.15)",children:"MuzzyMade @ 2026"}),i.jsx("g",{id:"RankSelector",className:x?"pointer-events-none":"cursor-pointer hover:brightness-125 active:brightness-90 transition-all origin-center",onClick:x?void 0:ie,children:i.jsx("text",{fill:J?"#5bbc70":"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:J?"bold":"normal",textAnchor:"middle",transform:"translate(323.75 1855.99)",children:"RANK SELECT"})})]}),i.jsxs("g",{transform:"translate(17.28, 1057.14)",children:[i.jsx("path",{fill:"#616a79",fillRule:"evenodd",d:"M597.13,32.56H15.82C6.56,32.56-.51,40.11.03,49.42l18.54,321.98c.39,6.78,5.81,12.28,12.11,12.28h551.59c6.3,0,11.72-5.5,12.11-12.28l18.54-321.98c.54-9.31-6.53-16.86-15.79-16.86Z"}),i.jsx("path",{fill:"#aad9d9",fillRule:"evenodd",d:"M604.74,37.21H8.21c-3.37,0-5.34-4.05-3.17-6.52L23.09,10.16C28.83,3.68,37.14,0,46.03,0h520.89c8.89,0,17.2,3.68,22.94,10.16l18.06,20.52c2.17,2.47.19,6.52-3.17,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M536.44,362.92H76.51c-21.64,0-40.25-18.8-41.48-41.9l-11.76-220.89c-.6-11.35,3.24-22,10.81-29.99,7.45-7.85,17.63-12.18,28.67-12.18h487.46c11.04,0,21.22,4.33,28.67,12.18,7.58,7.99,11.41,18.64,10.81,29.99l-11.76,220.89c-1.23,23.1-19.84,41.9-41.48,41.9ZM62.75,62.96c-9.65,0-18.55,3.77-25.04,10.62-6.62,6.98-9.98,16.32-9.45,26.28l11.76,220.89c1.09,20.49,17.46,37.17,36.49,37.17h459.93c19.03,0,35.4-16.67,36.49-37.17l11.76-220.89c.53-9.96-2.82-19.3-9.45-26.28-6.49-6.85-15.39-10.62-25.04-10.62H62.75Z"}),i.jsx("path",{fill:"#35385b",fillRule:"evenodd",d:"M550.2,60.46H62.75c-21.59,0-38.15,17.7-36.98,39.53l11.76,220.89c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.76-220.89c1.16-21.83-15.4-39.53-36.98-39.53Z"}),i.jsx("path",{fill:"#474871",fillRule:"evenodd",d:"M549.56,74.42H63.39c-21.53,0-38.04,17.7-36.88,39.53l11.02,206.94c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.02-206.94c1.16-21.83-15.35-39.53-36.88-39.53Z",className:Ce?"minigame-active-pulse-laser":oe?"minigame-solved-fade-laser":""}),i.jsxs("g",{id:"Operator_Rank_-_meter",children:[i.jsx("path",{fill:"#5bbc70",d:"M540.77,147.84H74.51c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM74.51,128.07c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H74.51Z"}),i.jsx("path",{fill:"#5bbc70",d:`M74.51,127.57h${De}c.66,0,1.2.54,1.2,1.2v17.36c0,.66-.54,1.2-1.2,1.2H74.51c-5.45,0-9.88-4.43-9.88-9.88h0c0-5.45,4.43-9.88,9.88-9.88Z`}),i.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(545 142)",children:[Math.floor(R).toLocaleString()," / ",Math.floor(k).toLocaleString()]}),i.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(545 118)",children:"PROMOTION THRESHOLD"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(239.35 115.28)",children:j}),i.jsxs("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(65.42 113.79)",children:[i.jsx("tspan",{x:"0",y:"0",children:"OPE"}),i.jsx("tspan",{letterSpacing:".02em",x:"40.54",y:"0",children:"R"}),i.jsx("tspan",{letterSpacing:"-.05em",x:"53.68",y:"0",children:"A"}),i.jsx("tspan",{letterSpacing:"-.03em",x:"66.07",y:"0",children:"T"}),i.jsx("tspan",{x:"77.45",y:"0",children:"OR "}),i.jsx("tspan",{letterSpacing:".02em",x:"112.01",y:"0",children:"R"}),i.jsx("tspan",{x:"125.16",y:"0",children:"ANK"})]})]}),i.jsx(Og,{laserSliders:O,shakingSlider:me,onSliderChange:H,getLaserLightColors:ue,textState:Se(),isComplicationActive:Ce,recentlyFixed:oe})]}),i.jsx(Ng,{lightsComplication:ee,lightSlider:je,onSliderChange:Me,onButtonPress:re,onButtonRelease:te,getLightsButtonLightColor:Ne,getLightsSliderLightColors:Fe,textState:$e(),pressedBtn:$,sliderShaking:Oe,onBlueClick:u,onGreenClick:f,onPurpleClick:d,isComplicationActive:M,recentlyFixed:W}),i.jsx(Dg,{localDialRotation:B,isDialDragging:de,dialShaking:I,dialPressed:F,onDialStart:D,onDialPress:se,getControlsCornerLightColor:ye,textState:b(),isDialAligned:E(),isComplicationActive:z,recentlyFixed:N}),i.jsx("circle",{id:"coord-reference",cx:$g,cy:Fg,r:"1",fill:"transparent",style:{pointerEvents:"none"}}),(m||j>0)&&i.jsx("g",{id:"System_Upgrades",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:m?he:p,children:m?i.jsxs(i.Fragment,{children:[i.jsx("rect",{fill:"#ef4444",x:"123.18",y:"1748.67",width:"342.8",height:"44.19",rx:"12.37",ry:"12.37"}),i.jsx("rect",{fill:"none",stroke:"#ef4444",strokeMiterlimit:"10",x:"123.45",y:"1748.67",width:"420.29",height:"44.19",rx:"9.43",ry:"9.43"}),i.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"294.58",y:"1778.17",children:pe?"ARE YOU SURE?":"END SHIFT EARLY"}),i.jsx("text",{fill:"#ef4444",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",transform:"translate(492.79 1783.33)",children:"X"})]}):i.jsxs(i.Fragment,{children:[i.jsx("rect",{fill:"#ffd92b",x:"205",y:"1748.67",width:"160",height:"44.19",rx:"12.37",ry:"12.37"}),i.jsx("rect",{fill:"none",stroke:"#ffd92b",strokeMiterlimit:"10",x:"205",y:"1748.67",width:"238",height:"44.19",rx:"9.43",ry:"9.43"}),i.jsx("text",{fill:"#45486c",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"285",y:"1778.17",children:"UPGRADES"}),i.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",textAnchor:"middle",x:"404",y:"1783.33",children:g})]})}),i.jsxs("text",{fill:"#5bbc70",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(210.86 1947.47)",children:[i.jsx("tspan",{letterSpacing:".01em",children:"G"}),i.jsx("tspan",{x:"50.77",children:"O"}),i.jsx("tspan",{letterSpacing:".01em",x:"94.43",children:"O"}),i.jsx("tspan",{letterSpacing:".03em",x:"138.94",children:"P"}),i.jsx("tspan",{x:"182.79",children:"S"})]}),i.jsxs("g",{id:"How_to_Play",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:S,children:[i.jsx("circle",{fill:"#5bbc70",cx:"60.02",cy:"1920.16",r:"42.65"}),i.jsx("text",{fill:"#0f1528",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(43.23 1951.29)",children:"?"})]}),i.jsxs("g",{id:"Settings",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:y,children:[i.jsx("circle",{fill:"#5bbc70",cx:"586.51",cy:"1921.29",r:"42.65"}),i.jsx("path",{fill:"#0f1528",d:"M575.34,1888.9c1.31-.22,2.74.1,3.77.94.53.43.76,1.11,1.28,1.57,3.07,2.69,6.81,3.17,10.41,1.27,2.93-1.54,3.23-4.63,7.35-3.65,2.47.59,8.3,3.99,10.15,5.79,3.3,3.22.52,5.23.71,8.67.17,3.07,2.34,6.18,5.12,7.42,2.12.95,4.78.73,5.84,3.27s.95,10.11.24,12.77c-1.23,4.62-4.11,3.02-7.31,4.93-2.36,1.42-4.2,4.72-4.2,7.5s1.94,4.09.64,6.88c-1.06,2.28-8.15,6.41-10.64,7.02-3.9.96-4.47-2.07-6.97-3.74-2.65-1.77-6.22-1.75-9.02-.28-3.07,1.61-3.15,5.19-7.61,4.38-2.27-.42-8.91-4.29-10.53-5.98-2.69-2.79-.66-4.28-.3-6.87.55-3.94-1.21-8.15-4.99-9.77-2.48-1.06-5.42-.37-6.52-3.73-.83-2.52-.68-11.58.66-13.88,1.2-2.06,3.02-1.68,4.85-2.27,4.19-1.36,6.81-5.14,6.29-9.6-.29-2.49-1.96-4.37.32-6.86,1.42-1.56,8.41-5.43,10.46-5.77ZM586.19,1909.97c-14.67.42-14.14,22.83.44,22.69,14.84-.14,14.53-23.12-.44-22.69Z"})]}),i.jsx("rect",{x:"0",y:"827.84",width:"648",height:"1152",fill:"#000",style:{opacity:Ue,...Ee,pointerEvents:"none"}}),i.jsxs("g",{id:"Periscope",transform:`translate(0, ${n})`,style:{transition:l||c?"none":"transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"grab"},...s,children:[i.jsx("rect",{fill:"#087962",x:"22.36",y:"978.45",width:"603.66",height:"51.13",rx:"11.03",ry:"11.03"}),i.jsx("path",{fill:"#087962",d:"M 390.17 -1000 V 1111.98 c 0 13.74 -11.16 24.9 -24.9 24.9 h -88.54 c -13.74 0 -24.9 -11.16 -24.9 -24.9 V -1000 H 390.17 Z"}),i.jsxs("g",{children:[i.jsx("path",{fill:"#5bbc70",fillRule:"evenodd",d:"M252.54,1089.77c-23.25,0-45.07-9.09-61.45-25.59-16.38-16.5-25.3-38.39-25.13-61.64.35-47.38,39.59-85.92,87.47-85.92h138.58c23.99,0,46.29,9.59,62.81,26.99,16.51,17.4,24.9,40.21,23.64,64.23-2.4,45.72-40.19,81.7-86.02,81.93h-.44c-24.04,0-47.19-10.12-63.53-27.77-2.19-2.36-4.86-2.71-6.27-2.71s-3.96.34-6.05,2.61c-16.35,17.72-39.54,27.87-63.63,27.87Z"}),i.jsx("path",{fill:"#0b1c3f",fillRule:"evenodd",d:"M392.01,931.91h-138.58c-39.31,0-71.89,31.44-72.18,70.75-.29,39.62,31.74,71.83,71.29,71.83,20.72,0,39.37-8.84,52.39-22.95,9.32-10.1,25.43-10,34.77.09,13.09,14.14,31.85,22.97,52.67,22.87,37.55-.18,68.86-29.95,70.83-67.44,2.16-41.12-30.54-75.13-71.19-75.13Z"}),i.jsx("path",{fill:"#373a60",fillRule:"evenodd",d:"M392.02,1054.51c-14.46,0-27.83-5.85-37.66-16.46-8.25-8.91-19.96-14.02-32.14-14.02s-23.79,5.09-31.97,13.96c-9.83,10.66-23.23,16.53-37.71,16.53s-26.71-5.39-36.42-15.17c-9.71-9.78-15-22.76-14.89-36.54.21-28.08,23.63-50.92,52.21-50.92h138.58c14.22,0,27.44,5.68,37.23,16,9.78,10.31,14.76,23.84,14.01,38.11-1.42,27.07-23.82,48.38-50.98,48.52h-.26Z"})]}),i.jsx("g",{transform:"translate(303.67 1091.18) scale(1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})})]}),i.jsx("g",{transform:`translate(0, ${t})`,style:{...Ae,cursor:x?"grab":"default",pointerEvents:x?"auto":"none",touchAction:x?"none":"auto"},...x&&o!==void 0?r:{},children:x?i.jsx("g",{transform:le,children:i.jsx(mg,{shiftScore:w,rank:j,xpCurrent:R,xpNext:k,cracksFilled:_,cracksTarget:L,pressureVented:T.totalBonusTime||0,maxTime:q,massPurged:T.maxGroupSize||0,leftoverPenalty:T.penalty||0,unspentPower:V,isWin:_>=L})}):i.jsxs(i.Fragment,{children:[i.jsx("path",{fill:"#f2a743",d:"M48.78,432h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H44.2c-6.78,0-12.28-5.5-12.28-12.28V448.86c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M606.65,436.65H40.86c-3.39,0-5.14-4.05-2.82-6.52l19.25-20.52c6.08-6.49,14.58-10.16,23.47-10.16h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"none",stroke:"#1d1d3a",strokeWidth:"5",strokeMiterlimit:"10",d:"M592.34,1246.25c0,21.83-17.7,39.53-39.53,39.53H94.71c-21.83,0-39.53-17.7-39.53-39.53V499.44c0-21.83,17.7-39.53,39.53-39.53h458.1c21.83,0,39.53,17.7,39.53,39.53v746.81Z"}),i.jsx("rect",{fill:"#1f1f38",x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("foreignObject",{x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53",children:i.jsx("div",{className:"w-full h-full overflow-hidden rounded-[39px]",children:h})}),i.jsx("g",{pointerEvents:"none",children:i.jsx("path",{fill:"none",stroke:"#5bbc70",strokeWidth:"1",strokeOpacity:"0.2",d:"M94.71,474.42h458.1c21.82,0,39.53,17.71,39.53,39.53v732.85c0,21.82-17.71,39.53-39.53,39.53H94.71c-21.82,0-39.53-17.71-39.53-39.53V513.95c0-21.82,17.71-39.53,39.53-39.53Z"})})]})}),J&&!x&&i.jsx("foreignObject",{x:"200",y:"1550",width:"250",height:"300",children:i.jsxs("div",{onClick:Be=>Be.stopPropagation(),style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1d1d3a 0%, #0f1829 100%)",border:"2px solid #5bbc70",borderRadius:"8px",overflow:"hidden"},children:[i.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #5bbc70",color:"#5bbc70",fontFamily:"Amazon Ember, sans-serif",fontWeight:"bold",fontSize:"14px",textAlign:"center"},children:"SELECT RANK"}),i.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px"},children:Array.from({length:51},(Be,Xe)=>i.jsx("div",{onClick:()=>ae(Xe),style:{padding:"8px 12px",color:Xe===0?"#f87171":Xe===j?"#5bbc70":"#aad9d9",fontFamily:"Amazon Ember, sans-serif",fontSize:"14px",cursor:"pointer",borderRadius:"4px",background:Xe===j?"rgba(91, 188, 112, 0.2)":"transparent",fontWeight:Xe===j?"bold":"normal",transition:"background 0.15s"},onMouseEnter:kt=>{Xe!==j&&(kt.currentTarget.style.background="rgba(170, 217, 217, 0.1)")},onMouseLeave:kt=>{Xe!==j&&(kt.currentTarget.style.background="transparent")},children:Xe===0?"0 - WIPE DATA":`Rank ${Xe}`},Xe))})]})})]})},zg=[{id:"actives",label:"TOOLS",unlockRank:5,color:"#fbbf24"},{id:"features",label:"FEATURES",unlockRank:20,color:"#a78bfa"},{id:"complications",label:"SYSTEMS",unlockRank:2,color:"#f97316"},{id:"passives",label:"UTILITY",unlockRank:3,color:"#5bbc70"}],Gg=(e,t)=>t==="active"?{accent:"#b45309",text:"#fbbf24"}:t==="feature"?{accent:"#7c3aed",text:"#a78bfa"}:e==="CAPACITOR_EFFICIENCY"?{accent:"#d82727",text:"#ff6b6b"}:e==="CIRCUIT_STABILIZER"?{accent:"#d36b28",text:"#ffa94d"}:e==="GEAR_LUBRICATION"?{accent:"#2d5a87",text:"#74c0fc"}:{accent:"#2d7a4d",text:"#5bbc70"},Yg=({scraps:e,upgrades:t,rank:n,onPurchase:s,onRefund:r,onClose:o,equippedActives:l=[],onToggleEquip:c,maxActiveSlots:a=1})=>{var w;const u=zg.filter(T=>T.unlockRank<=n),[f,d]=v.useState(((w=u[0])==null?void 0:w.id)||"complications"),[p,y]=v.useState(!1),S=v.useRef(0),P=v.useRef(0),C=50,g=(T,_)=>{y(!0),S.current=T,P.current=_},h=(T,_)=>{if(!p)return;y(!1);const L=T-S.current,V=_-P.current;if(Math.abs(L)>Math.abs(V)&&Math.abs(L)>C){const q=u.findIndex(Q=>Q.id===f);L>0&&q<u.length-1?d(u[q+1].id):L<0&&q>0&&d(u[q-1].id)}};v.useEffect(()=>{const T=L=>{p&&h(L.clientX,L.clientY)},_=L=>{p&&L.changedTouches[0]&&h(L.changedTouches[0].clientX,L.changedTouches[0].clientY)};return p&&(window.addEventListener("mouseup",T),window.addEventListener("touchend",_)),()=>{window.removeEventListener("mouseup",T),window.removeEventListener("touchend",_)}},[p,f,u]);const m=(()=>{const T=Object.values(En).filter(_=>_.unlockRank<=n);switch(f){case"actives":return T.filter(_=>_.type==="active").sort((_,L)=>_.unlockRank-L.unlockRank);case"features":return T.filter(_=>_.type==="feature").sort((_,L)=>_.unlockRank-L.unlockRank);case"complications":return T.filter(_=>_.category==="complication").sort((_,L)=>_.unlockRank-L.unlockRank);case"passives":return T.filter(_=>_.type==="passive"&&_.category!=="complication").sort((_,L)=>_.unlockRank-L.unlockRank);default:return[]}})(),j=u.length>0,R=T=>{const _=t[T.id]||0,L=_>=T.maxLevel,q=e>=T.costPerLevel&&!L,Q=_>0,A=Gg(T.id,T.type),Z=T.type==="active",ce=l.includes(T.id);return i.jsxs("div",{className:"rounded-xl p-4 border",style:{backgroundColor:"#0c0f19",borderColor:Z&&ce?"#5bbc70":"#ffffff40"},children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold tracking-wide",style:{color:A.text,fontSize:"18px"},children:T.name}),i.jsx("p",{style:{color:"#59acae",fontSize:"13px"},className:"mt-1",children:T.desc})]}),Z&&_>0&&c&&i.jsx("button",{onClick:()=>c(T.id),disabled:!ce&&l.length>=a,className:"ml-2 px-3 py-1 rounded-lg font-bold text-sm border-2 transition-all",style:{borderColor:ce?"#5bbc70":"#59acae60",color:ce?"#5bbc70":"#59acae",backgroundColor:ce?"#5bbc7020":"transparent",cursor:!ce&&l.length>=a?"not-allowed":"pointer",opacity:!ce&&l.length>=a?.5:1},children:ce?"ON":"OFF"})]}),i.jsxs("div",{className:"flex items-center gap-3 my-3",children:[i.jsx("button",{onClick:()=>Q&&(r==null?void 0:r(T.id)),disabled:!Q,className:"w-8 h-8 rounded-lg font-bold text-xl border-2 transition-all flex items-center justify-center",style:{borderColor:Q?A.accent:"#59acae30",color:Q?A.text:"#59acae40",backgroundColor:Q?A.accent+"20":"transparent",cursor:Q?"pointer":"not-allowed"},children:""}),i.jsx("div",{className:"flex gap-1 flex-1 justify-center",children:Array.from({length:T.maxLevel}).map((Y,K)=>i.jsx("div",{className:"h-4 rounded-sm border flex-1 max-w-8",style:{borderColor:K<_?A.accent:"#59acae40",backgroundColor:K<_?A.accent:"transparent"}},K))}),i.jsx("button",{onClick:()=>q&&s(T.id),disabled:!q,className:"w-8 h-8 rounded-lg font-bold text-xl border-2 transition-all flex items-center justify-center",style:{borderColor:q?A.accent:"#59acae30",color:q?A.text:"#59acae40",backgroundColor:q?A.accent+"20":"transparent",cursor:q?"pointer":"not-allowed"},children:"+"}),i.jsxs("span",{className:"font-bold w-12 text-right",style:{color:A.text,fontSize:"16px"},children:[_,"/",T.maxLevel]})]}),i.jsxs("div",{className:"flex justify-between items-start",style:{fontSize:"14px"},children:[i.jsx("div",{style:{color:"#ffffff"},children:Z?i.jsxs(i.Fragment,{children:["Effect: ",T.formatEffect(1)]}):_>0?i.jsxs(i.Fragment,{children:["Current: ",T.formatEffect(_)]}):i.jsx("span",{style:{color:"#59acae"},children:"Current: Spend points to upgrade"})}),L&&T.maxLevelBonus&&i.jsxs("div",{className:"italic text-right ml-2",style:{color:"#5bbc70"},children:["Max: ",T.maxLevelBonus]})]})]},T.id)},k=()=>u.length===0?null:i.jsx("div",{className:"flex w-full mb-3",style:{height:"36px"},children:u.map(T=>{const _=f===T.id;return i.jsx("button",{onClick:()=>d(T.id),className:"font-bold text-center transition-all",style:{width:"25%",backgroundColor:_?T.color+"30":"transparent",color:_?T.color:"#59acae",borderBottom:_?`3px solid ${T.color}`:"3px solid transparent",fontSize:"11px",padding:"8px 4px",fontFamily:"'From Where You Are', sans-serif",letterSpacing:"0.05em"},children:T.label},T.id)})});return i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:i.jsxs("div",{className:"relative",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:[i.jsxs("svg",{viewBox:"0 0 583.67 910",className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[i.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),i.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("text",{fill:"#f2a743",fontFamily:"'From Where You Are'",fontSize:"28",transform:"translate(50 105)",children:"UPGRADES"}),i.jsxs("text",{fill:"#5bbc70",fontFamily:"'Amazon Ember'",transform:"translate(530 105)",textAnchor:"end",children:[i.jsx("tspan",{fontSize:"16",fontWeight:"600",children:"SCRAPS: "}),i.jsx("tspan",{fontSize:"32",fontWeight:"800",children:e})]}),i.jsxs("foreignObject",{x:"40",y:"125",width:"503",height:"720",children:[i.jsx("style",{children:".upgrade-scroll::-webkit-scrollbar { display: none; }"}),i.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"upgrade-scroll w-full h-full overflow-y-auto",style:{fontFamily:"'Amazon Ember', sans-serif",scrollbarWidth:"none",msOverflowStyle:"none"},onMouseDown:T=>g(T.clientX,T.clientY),onTouchStart:T=>g(T.touches[0].clientX,T.touches[0].clientY),children:j?i.jsxs("div",{className:"pb-20",children:[i.jsx("div",{className:"text-lg mb-3 text-center",style:{color:"#fbbf24",fontFamily:"'Amazon Ember', sans-serif"},children:"Earn Scraps by Increasing your Operator Rank"}),k(),i.jsx("div",{className:"space-y-3",children:m.length>0?m.map(R):i.jsx("div",{className:"text-center py-8",style:{color:"#59acae"},children:"No upgrades available in this category yet."})})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[i.jsx("p",{className:"text-2xl tracking-wide mb-3",style:{color:"#6acbda",fontFamily:"'From Where You Are', sans-serif"},children:"NO UPGRADES AVAILABLE"}),i.jsx("p",{style:{color:"#59acae",fontSize:"16px"},children:"Reach Rank 2 to unlock your first upgrade"})]})})]})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:o,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})})]})})},Hg=({engine:e,state:t,careerScore:n,scraps:s,powerUps:r={},onOpenSettings:o,onOpenHelp:l,onOpenUpgrades:c,onSetRank:a,onPurchaseUpgrade:u,onRefundUpgrade:f,onDismissGameOver:d,equippedActives:p=[],onToggleEquip:y})=>{const S=t.shiftScore>0||t.gameOver;let P;if(S){const oe=t.goalsCleared>=t.goalsTarget,{newCareerScore:Ce}=ap(e.initialTotalScore,t.shiftScore,oe);P=xt(Ce)}else P=xt(n);const[C,g]=v.useState(!1),h=v.useRef(null),[x,m]=v.useState(0),[j,R]=v.useState(!1),[k,w]=v.useState(!1),T=v.useRef(0),_=200,L=300,[V,q]=v.useState(0),[Q,A]=v.useState(!1),Z=v.useRef(0),ce=150,[Y,K]=v.useState(0);v.useEffect(()=>{if(!t.gameOver){const oe=setInterval(()=>{K(Ce=>(Ce+1)%2)},2e3);return()=>clearInterval(oe)}},[t.gameOver]),v.useEffect(()=>{t.phase===Ze.ConsoleScreen&&!t.gameOver&&(m(L),w(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{w(!1),m(0)})}))},[t.phase,t.gameOver]);const $=oe=>{t.gameOver||(R(!0),T.current=oe-x)},U=oe=>{if(!j)return;const Ce=oe-T.current,ee=Math.max(0,Math.min(L,Ce));m(ee)},J=()=>{j&&(R(!1),x>_?(e.execute(new $s(Ze.TankScreen)),setTimeout(()=>m(0),1e3)):m(0))},G=oe=>{t.gameOver&&(A(!0),Z.current=oe-V)},pe=oe=>{if(!Q)return;const Ce=oe-Z.current,ee=Math.min(0,Ce);q(ee)},we=()=>{Q&&(A(!1),V<-ce&&d&&d(),q(0))};v.useEffect(()=>{const oe=xe=>{j&&U(xe.clientY),Q&&pe(xe.clientY)},Ce=()=>{j&&J(),Q&&we()},ee=xe=>{j&&U(xe.touches[0].clientY),Q&&pe(xe.touches[0].clientY)},je=()=>{j&&J(),Q&&we()};return(j||Q)&&(window.addEventListener("mousemove",oe),window.addEventListener("mouseup",Ce),window.addEventListener("touchmove",ee),window.addEventListener("touchend",je)),()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",Ce),window.removeEventListener("touchmove",ee),window.removeEventListener("touchend",je)}},[j,x,Q,V]);const O=()=>{e.abortRun()},H=e.isSessionActive&&!t.gameOver,ue=(t.gameOver?520:-400)+V,Se=()=>i.jsx("div",{className:"w-full h-full flex flex-col items-center pt-24 font-mono overflow-hidden text-center select-none",children:i.jsx("div",{className:"mt-auto mb-4 flex flex-col items-center",children:H?Y===0?i.jsx("div",{className:"text-[#5bbc70] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse",children:"CLEANING..."}):i.jsxs("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are']",children:[Math.floor((1-t.shiftTime/e.maxTime)*100),"% PSI"]}):Y===0?i.jsx("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"TO START SHIFT"}):i.jsx("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"PULL DOWN PERISCOPE"})})});return i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{ref:h,className:"relative z-10 select-none flex items-center justify-center",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsx("div",{className:"w-full h-full shadow-2xl relative",children:i.jsx(Bg,{dialRotation:0,monitorOffset:ue,periscopeY:x,dragHandlers:{onMouseDown:oe=>$(oe.clientY),onTouchStart:oe=>$(oe.touches[0].clientY)},monitorDragHandlers:{onMouseDown:oe=>G(oe.clientY),onTouchStart:oe=>G(oe.touches[0].clientY)},isMonitorDragging:Q,isPeriscopeDragging:j,isSnapping:k,onSettingsClick:o,onHelpClick:l,onUpgradesClick:()=>g(!0),onSetRank:a,onAbortClick:O,upgradeCount:s,screenContent:t.gameOver?null:i.jsx(Se,{}),isGameOver:t.gameOver,isSessionActive:e.isSessionActive,rank:P.rank,currentXP:P.progress,nextRankXP:P.toNextRank,shiftScore:t.shiftScore,gameStats:t.gameStats,goalsCleared:t.goalsCleared,goalsTarget:t.goalsTarget,unspentPower:s,maxTime:e.maxTime,complications:t.complications,onResolveComplication:oe=>e.execute(new xg(oe)),upgradeLevels:r})})}),C&&i.jsx(Yg,{scraps:s,upgrades:r,rank:P.rank,onPurchase:oe=>u==null?void 0:u(oe),onRefund:oe=>f==null?void 0:f(oe),onClose:()=>g(!1),equippedActives:p,onToggleEquip:y,maxActiveSlots:1+(r.ACTIVE_EXPANSION_SLOT||0)+(r.ACTIVE_EXPANSION_SLOT_2||0)})]})};function _l(e){return`${e.x},${e.y}`}function gf(e){if(e.length<=1)return!0;const t=new Set(e.map(_l)),n=new Set,s=[e[0]];for(;s.length>0;){const r=s.shift(),o=_l(r);if(n.has(o))continue;n.add(o);const l=[{x:r.x,y:r.y+1},{x:r.x,y:r.y-1},{x:r.x+1,y:r.y},{x:r.x-1,y:r.y}];for(const c of l){const a=_l(c);t.has(a)&&!n.has(a)&&s.push(c)}}return n.size===e.length}function Wg(e){const t=e.length;if(t<2)return null;let n=null,s=1/0;for(let r=1;r<(1<<t)-1;r++){const o=[],l=[];for(let f=0;f<t;f++)r&1<<f?o.push(f):l.push(f);const c=o.map(f=>e[f]),a=l.map(f=>e[f]);if(!gf(c)||!gf(a))continue;const u=Math.abs(o.length-l.length);if(u<s&&(s=u,n=[o,l],u===0))break}return n}function mf(e,t,n){const s=Wg(e.cells);if(!s)return{...e,color:t};const[r]=s,o=new Set(r),l=e.cells.map((c,a)=>o.has(a)?t:n);return{...e,color:t,cellColors:l}}const vf=5e3;class Ug{trySpawnGoal(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{goal:null,newLastSpawnTime:l};const c=Date.now();if(c-l<=vf)return{goal:null,newLastSpawnTime:l};const a=xt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=tf(n,t.goalMarks,a,r,o,u);return f?(u&&t.crackDownRemaining--,vt.playPop(1),{goal:f,newLastSpawnTime:c}):{goal:null,newLastSpawnTime:c}}trySpawnCrack(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{crack:null,newLastSpawnTime:l};const c=Date.now();if(c-l<=vf)return{crack:null,newLastSpawnTime:l};const a=xt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=t.crackCells.map(p=>({id:p.id,x:p.x,y:p.y,color:p.color,spawnTime:p.spawnTime})),d=tf(n,f,a,r,o,u);if(d){const p={id:d.id,x:d.x,y:d.y,color:d.color,originCrackId:[],branchCrackIds:[],lastGrowthCheck:c,crackBranchInterval:7e3+Math.random()*5e3,spawnTime:d.spawnTime};return u&&t.crackDownRemaining--,vt.playPop(1),{crack:p,newLastSpawnTime:c}}return{crack:null,newLastSpawnTime:c}}handleGoals(t,n,s,r,o){t.goalMarks=t.goalMarks.filter(c=>!n.includes(c.id));const l=new Set(n);n.forEach(c=>{const a=t.crackCells.find(u=>u.id===c);a&&(a.originCrackId.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.branchCrackIds=f.branchCrackIds.filter(d=>d!==c))}),a.branchCrackIds.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.originCrackId=f.originCrackId.filter(d=>d!==c))}))}),t.crackCells=t.crackCells.filter(c=>!l.has(c.id)),n.forEach(c=>{const a=We(r.x),u=Math.floor(r.y),f=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:f,text:"Laser to Seal",x:a,y:u,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(d=>d.id!==f),o()},1e3),ve.emit(ge.GOAL_CAPTURED,{count:1})})}handleCrackConsumption(t,n,s,r){if(n.length===0)return;const o=new Set(n);if(n.forEach(l=>{const c=t.crackCells.find(a=>a.id===l);c&&(c.originCrackId.forEach(a=>{const u=t.crackCells.find(f=>f.id===a);u&&(u.branchCrackIds=u.branchCrackIds.filter(f=>f!==l))}),c.branchCrackIds.forEach(a=>{const u=t.crackCells.find(f=>f.id===a);u&&(u.originCrackId=u.originCrackId.filter(f=>f!==l))}))}),t.crackCells=t.crackCells.filter(l=>!o.has(l.id)),t.goalMarks=t.goalMarks.filter(l=>!o.has(l.id)),n.length>0){const l=We(s.x),c=Math.floor(s.y),a=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:a,text:n.length>1?`Sealed ${n.length}`:"Sealed",x:l,y:c,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(u=>u.id!==a),r()},1e3),ve.emit(ge.GOAL_CAPTURED,{count:n.length})}}countCracks(t){if(t.length===0)return 0;const n=new Set;let s=0;for(const r of t){if(n.has(r.id))continue;const o=[r.id];for(;o.length>0;){const l=o.shift();if(n.has(l))continue;n.add(l);const c=t.find(a=>a.id===l);c&&(c.originCrackId.forEach(a=>{n.has(a)||o.push(a)}),c.branchCrackIds.forEach(a=>{n.has(a)||o.push(a)}))}s++}return s}getConnectedComponent(t,n){const s=new Set,r=[],o=[t];for(;o.length>0;){const l=o.shift();if(s.has(l))continue;s.add(l);const c=n.find(a=>a.id===l);c&&(r.push(c),c.originCrackId.forEach(a=>{s.has(a)||o.push(a)}),c.branchCrackIds.forEach(a=>{s.has(a)||o.push(a)}))}return r}isLeafCell(t,n){const s=n.find(r=>r.id===t);return s?s.branchCrackIds.length===0:!0}}const Yc=new Ug,Xg=8;class Vg{tickGrowth(t,n,s,r){var c;if(xt(n).rank<30||t.phase===Ze.ConsoleScreen||t.phase===Ze.COMPLICATION_MINIGAME)return;const l=Date.now();for(const a of t.crackCells){if((c=t.grid[a.y])!=null&&c[a.x]||l-a.lastGrowthCheck<a.crackBranchInterval)continue;a.lastGrowthCheck=l,a.crackBranchInterval=5e3+Math.random()*5e3;const u=Math.max(0,1-t.shiftTime/r),f=Math.min(1,.1+u),p=(s.SLOW_CRACKS||0)*.05;let y=Math.max(0,f-p);a.branchCrackIds.length===0&&(y*=.5);const P=this.getDistanceFromRoot(a,t.crackCells),C=Math.max(.1,1-P*.25);if(y*=C,Math.random()>y)continue;const g=[{x:We(a.x+1),y:a.y},{x:We(a.x-1),y:a.y},{x:a.x,y:a.y+1},{x:a.x,y:a.y-1},{x:We(a.x+1),y:a.y-1},{x:We(a.x-1),y:a.y-1},{x:We(a.x+1),y:a.y+1},{x:We(a.x-1),y:a.y+1}],h=[];for(const m of g){if(m.y<Qe||m.y>=Ge)continue;const j=t.crackCells.find(k=>k.x===m.x&&k.y===m.y&&k.color===a.color);if(j){!a.branchCrackIds.includes(j.id)&&!a.originCrackId.includes(j.id)&&h.push({...m,existingCrack:j});continue}t.crackCells.find(k=>k.x===m.x&&k.y===m.y)||t.grid[m.y][m.x]||h.push(m)}if(h.length===0)continue;const x=h[Math.floor(Math.random()*h.length)];if(x.existingCrack)x.existingCrack.originCrackId.push(a.id),a.branchCrackIds.push(x.existingCrack.id);else{if(Yc.countCracks(t.crackCells)>=Xg)continue;const j={id:Math.random().toString(36).substr(2,9),x:x.x,y:x.y,color:a.color,originCrackId:[a.id],branchCrackIds:[],lastGrowthCheck:l,crackBranchInterval:5e3+Math.random()*5e3,spawnTime:l};a.branchCrackIds.push(j.id),t.crackCells.push(j),t.goalMarks.push({id:j.id,x:j.x,y:j.y,color:j.color,spawnTime:j.spawnTime})}}}getDistanceFromRoot(t,n){if(t.originCrackId.length===0)return 0;let s=0,r=t.id;const o=new Set;for(;!o.has(r);){o.add(r);const l=n.find(c=>c.id===r);if(!l||l.originCrackId.length===0||(s++,r=l.originCrackId[0],s>20))break}return s}}const Sf=780,Cf=8,kf=500,qg=80,Zg=.03;class Kg{constructor(t,n={},s=[]){ze(this,"state");ze(this,"listeners",new Set);ze(this,"maxTime",bl);ze(this,"lockStartTime",null);ze(this,"lockResetCount",0);ze(this,"usePhysicsForFalling",!1);ze(this,"freezeTimer",!1);ze(this,"freezeFalling",!1);ze(this,"lastGoalSpawnTime",0);ze(this,"lastComplicationCheckTime",0);ze(this,"isFastDropping",!1);ze(this,"wasFastDropping",!1);ze(this,"lightsOverflarePhase","none");ze(this,"lightsOverflareTime",0);ze(this,"lightsFlickerTime",0);ze(this,"lightsFlickerActive",!1);ze(this,"lightsGracePausedAt",null);ze(this,"initialTotalScore",0);ze(this,"powerUps",{});ze(this,"isSessionActive",!1);ze(this,"equippedActives",[]);ze(this,"crackManager");ze(this,"pendingTotalScore",null);this.initialTotalScore=t,this.powerUps=n,this.equippedActives=s;const r=xt(t).rank,l=bn(r).length+r;this.state={grid:ef(r,n),tankRotation:0,activeGoop:null,storedGoop:null,nextGoop:null,shiftScore:0,gameOver:!1,isPaused:!1,canSwap:!0,level:1,cellsCleared:0,popStreak:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:bl,scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},gameStats:{startTime:0,totalBonusTime:0,maxGroupSize:0},floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:l,phase:Ze.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[_e.LIGHTS]:0,[_e.CONTROLS]:0,[_e.LASER]:0},activeCharges:{},crackGoopPopped:0,colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.applyUpgrades(),this.crackManager=new Vg}randomThreshold(){return Math.floor(Math.random()*13)+12}hasAdjacentWild(t,n){for(const s of n.cells){const r=We(n.x+s.x),o=Math.floor(n.y+s.y);if(o<0||o>=Ge)continue;const l=[{x:We(r+1),y:o},{x:We(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}];for(const c of l)if(c.y>=0&&c.y<Ge){const a=t[c.y][c.x];if(a!=null&&a.isWild)return!0}}return!1}execute(t){t.execute(this)}applyUpgrades(){let t=bl;const n=this.powerUps.PRESSURE_CONTROL||0;if(n>0){const s=n*5*1e3;t+=s}this.maxTime=t,this.state.gameStats.startTime===0&&(this.state.shiftTime=this.maxTime)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emitChange(){this.listeners.forEach(t=>t())}syncTotalScore(t){this.state.gameOver?this.pendingTotalScore=t:(this.initialTotalScore=t,this.pendingTotalScore=null)}startRun(){const t=xt(this.initialTotalScore).rank,n=bn(t),s=n.length+t,r=n[Math.floor(Math.random()*n.length)],o=Math.random()<Ml,l=o?ni:ti,c=Math.floor(Math.random()*l.length),a=this.maybeApplyMirror({...l[c]}),u=!o&&t>=20&&Math.random()<.25;let f;if(u){const C=n.filter(x=>x!==r),g=C[Math.floor(Math.random()*C.length)],h={...a,color:r};f=mf(h,r,g)}else f={...a,color:r,isCorrupted:o||void 0};const d=Math.random()<Ml,p=d?ni:ti,y=Math.floor(Math.random()*p.length),S=this.maybeApplyMirror({...p[y]});this.state={...this.state,grid:ef(t,this.powerUps),tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...S,color:n[Math.floor(Math.random()*n.length)],isCorrupted:d||void 0},nextGoop:f,canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:this.maxTime,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:s,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:Ze.TankScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[_e.LIGHTS]:0,[_e.CONTROLS]:0,[_e.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0;const P={};this.equippedActives.forEach(C=>{P[C]=0}),this.state.activeCharges=P,this.spawnNewPiece(),ve.emit(ge.GAME_START),ve.emit(ge.MUSIC_START),this.emitChange()}resetSession(){this.state.gameOver=!1,this.isSessionActive=!1,this.state.phase=Ze.ConsoleScreen,this.state.shiftScore=0,this.state.activeGoop=null,this.pendingTotalScore!==null&&(this.initialTotalScore=this.pendingTotalScore,this.pendingTotalScore=null),this.emitChange()}abortRun(){!this.isSessionActive||this.state.gameOver||(this.state.shiftScore=0,this.state.goalsCleared=0,this.finalizeGame())}enterConsole(){this.state.phase=Ze.ConsoleScreen,this.emitChange()}enterPeriscope(){this.state.gameOver?this.startRun():(this.state.phase=Ze.TankScreen,this.isSessionActive||this.startRun()),this.emitChange()}resolveComplication(t){this.state.gameOver||(Ds.resolveComplication(this.state,t,this.initialTotalScore,this.powerUps),this.state.phase=Ze.ConsoleScreen,this.emitChange())}activateAbility(t){var s,r;if(this.state.gameOver)return;const n=En[t];if(!(!n||n.type!=="active"))switch(t){case"COOLDOWN_BOOSTER":{const o=this.powerUps[t]||1,c=[.25,.35,.5][Math.min(o,3)-1];Ds.extendAllCooldowns(this.state,c),console.log(`COOLDOWN_BOOSTER activated: +${c*100}% cooldown extension`);break}case"GOOP_DUMP":{const o=bn(xt(this.initialTotalScore).rank),l=((s=this.state.activeGoop)==null?void 0:s.definition.color)||o[Math.floor(Math.random()*o.length)],c=this.powerUps[t]||1,a=Math.min(c,3),u=18,f=600,d=[];for(let p=0;p<a;p++)for(let y=0;y<u;y++)d.push({id:Math.random().toString(36).substr(2,9),color:l,x:Math.floor(Math.random()*ke),y:-1,spawnDelay:p*f+y*qg});this.state.dumpQueue.push(...d),console.log(`GOOP_DUMP activated: ${a} wave(s), ${d.length} total ${l} pieces`);break}case"GOOP_COLORIZER":{const o=(r=this.state.activeGoop)==null?void 0:r.definition.color;if(!o){console.log("GOOP_COLORIZER: No active piece to match color");break}const l=this.powerUps[t]||1,a=[6,7,8][Math.min(l,3)-1];this.state.colorizerColor=o,this.state.colorizerRemaining=a,console.log(`GOOP_COLORIZER activated: next ${a} pieces will be ${o}`);break}case"CRACK_DOWN":{const l=1+(this.powerUps[t]||1)*2;this.state.crackDownRemaining=l;break}}}chargeActiveAbilities(t){Object.keys(this.state.activeCharges).forEach(n=>{const s=this.state.activeCharges[n]||0;this.state.activeCharges[n]=Math.min(100,s+t)})}checkComplications(t){const{spawned:n,newLastCheckTime:s}=Ds.checkComplications(this.state,this.initialTotalScore,this.lastComplicationCheckTime);this.lastComplicationCheckTime=s,n&&(Ds.spawnComplication(this.state,n),this.emitChange())}finalizeGame(){if(this.state.gameOver)return;this.state.gameOver=!0,this.isSessionActive=!1,this.state.phase=Ze.ConsoleScreen;let t=0;for(let l=0;l<Ge;l++)for(let c=0;c<ke;c++)this.state.grid[l][c]&&t++;const n=this.powerUps.AUTO_POPPER||0;if(n>0){const l=t,c=.2-n*.04;let a=0;for(let u=0;u<l;u++)Math.random()>c&&a++;t-=a,console.log(`AUTO_POPPER: ${a} of ${l} goop auto-popped (${t} remaining)`)}const s=t*50;this.state.gameStats.penalty=s,this.state.shiftScore=Math.max(0,this.state.shiftScore-s);const o=100*xt(this.initialTotalScore).rank;this.state.shiftScore=Math.max(o,this.state.shiftScore),this.state.complications=[],this.state.activeComplicationId=null,this.state.prePoppedGoopGroups.clear(),ve.emit(ge.GAME_OVER),this.emitChange()}getPiecePoolByZone(t){const s=(this.maxTime-this.state.shiftTime)/1e3,r=this.maxTime/3/1e3,o=!t&&Math.random()<Ml;return s<r?{pool:o?ni:ti,isCorrupted:o}:s<r*2?{pool:o?np:tp,isCorrupted:o}:{pool:o?op:sp,isCorrupted:o}}maybeApplyMirror(t){return Math.random()>=sx||t.cells.every(s=>t.cells.some(r=>r.x===-s.x&&r.y===s.y))?t:{...t,cells:t.cells.map(s=>({x:-s.x,y:s.y}))}}spawnNewPiece(t,n,s){const r=n||this.state.grid,o=s!==void 0?s:this.state.tankRotation,l=this.initialTotalScore+this.state.shiftScore,c=xt(l).rank,a=bn(c);let u=t;if(!u&&this.state.nextGoop){u=this.state.nextGoop;let y=a[Math.floor(Math.random()*a.length)];const S=this.powerUps.CRACK_MATCHER||0,P=this.state.crackCells.length>0?this.state.crackCells:this.state.goalMarks;if(S>0&&P.length>0){const R=P.reduce((w,T)=>T.y>w.y?T:w),k=S*.25;Math.random()<k&&(y=R.color)}const{pool:C,isCorrupted:g}=this.getPiecePoolByZone(),h=Math.floor(Math.random()*C.length),x=this.maybeApplyMirror({...C[h]}),m=!g&&c>=20&&Math.random()<.25;let j;if(m){const R=a.filter(T=>T!==y),k=R[Math.floor(Math.random()*R.length)],w={...x,color:y};j=mf(w,y,k)}else j={...x,color:y,isCorrupted:g||void 0};if(!g&&c>=40&&Math.random()<.15){const{pool:R}=this.getPiecePoolByZone(!0),k=Math.floor(Math.random()*R.length);j={...this.maybeApplyMirror({...R[k]}),color:dn.WILD,isWild:!0},console.log("Wild piece queued for next spawn")}this.state.nextGoop=j}const f=fy(u,c);this.state.colorizerRemaining>0&&this.state.colorizerColor&&(f.definition={...f.definition,color:this.state.colorizerColor,cellColors:void 0},this.state.colorizerRemaining--,this.state.nextGoop&&this.state.colorizerRemaining>0&&(this.state.nextGoop={...this.state.nextGoop,color:this.state.colorizerColor,cellColors:void 0}),console.log(`GOOP_COLORIZER: Spawned ${this.state.colorizerColor} piece (${this.state.colorizerRemaining} remaining)`),this.state.colorizerRemaining===0&&(this.state.colorizerColor=null));const d=Math.floor((ct-1)/2),p=0;if(f.screenX=d,f.x=Gc(d,o),f.y=p,f.startSpawnY=p,f.state=Ln.FALLING,this.lockStartTime=null,this.lockResetCount=0,fs(r,f)){this.finalizeGame();return}this.state.activeGoop=f,this.state.canSwap=!0,this.emitChange()}updateScoreAndStats(t,n){this.state.shiftScore+=t,n&&(this.state.scoreBreakdown.base+=n.base||0,this.state.scoreBreakdown.height+=n.height||0,this.state.scoreBreakdown.offscreen+=n.offscreen||0,this.state.scoreBreakdown.adjacency+=n.adjacency||0,this.state.scoreBreakdown.speed+=n.speed||0)}handleGoals(t,n,s){Yc.handleGoals(this.state,t,n,s,()=>this.emitChange())}tickTimer(t){const n=this.powerUps.FOCUS_MODE||0,r=this.state.phase===Ze.COMPLICATION_MINIGAME&&n>0?1-n*.1:1;return!this.freezeTimer&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*r),this.state.shiftTime<=0)?(this.finalizeGame(),!1):!0}tickGoals(){const{crack:t,newLastSpawnTime:n}=Yc.trySpawnCrack(this.state,this.state.grid,this.initialTotalScore,this.state.shiftTime,this.maxTime,this.lastGoalSpawnTime);this.lastGoalSpawnTime=n,t&&(this.state.crackCells.push(t),this.state.goalMarks.push({id:t.id,x:t.x,y:t.y,color:t.color,spawnTime:t.spawnTime}))}tickHeat(t){const n=xt(this.initialTotalScore).rank,s=ds[_e.CONTROLS];if(po(_e.CONTROLS,n)&&this.state.controlsHeat>0){const r=Date.now(),o=this.state.rotationTimestamps.length>0?this.state.rotationTimestamps[this.state.rotationTimestamps.length-1]:0;if(r-o>s.idleThresholdMs){const c=this.powerUps.GEAR_LUBRICATION||0,a=s.dissipationBase*(1+s.dissipationUpgradeEffect*c);this.state.controlsHeat=Math.max(0,this.state.controlsHeat-a*t/1e3)}}}tickLightsBrightness(t){const n=xt(this.initialTotalScore).rank,s=ds[_e.LIGHTS];if(!po(_e.LIGHTS,n))return;if(this.state.phase!==Ze.TankScreen){this.state.lightsGraceStart!==null&&this.lightsGracePausedAt===null&&(this.lightsGracePausedAt=Date.now());return}if(this.lightsGracePausedAt!==null&&this.state.lightsGraceStart!==null){const a=Date.now()-this.lightsGracePausedAt;this.state.lightsGraceStart+=a,this.lightsGracePausedAt=null}if(this.state.complications.some(a=>a.type===_e.LIGHTS)){this.state.lightsBrightness=s.failedBrightness;return}const o=Date.now();this.isFastDropping&&!this.wasFastDropping&&(this.state.lightsGraceStart=null,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),!this.isFastDropping&&this.wasFastDropping&&(this.state.lightsGraceStart=o,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),this.wasFastDropping=this.isFastDropping;const l=this.powerUps.CIRCUIT_STABILIZER||0,c=(s.graceBaseSec+s.gracePerLevel*l)*1e3;if(this.isFastDropping){if(this.state.lightsBrightness<100){const a=s.recoverRate*t/1e3;this.state.lightsBrightness=Math.min(100,this.state.lightsBrightness+a),this.state.lightsBrightness>=100&&(this.lightsOverflarePhase="rising",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="rising"){this.lightsOverflareTime+=t;const a=Math.min(1,this.lightsOverflareTime/s.overflareUpMs);this.state.lightsBrightness=100+(s.overflarePeak-100)*a,a>=1&&(this.lightsOverflarePhase="falling",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="falling"){this.lightsOverflareTime+=t;const a=Math.min(1,this.lightsOverflareTime/s.overflareDownMs);this.state.lightsBrightness=s.overflarePeak-(s.overflarePeak-100)*a,a>=1&&(this.lightsOverflarePhase="none",this.state.lightsBrightness=100)}}else{this.state.lightsGraceStart===null&&(this.state.lightsGraceStart=o);const a=o-this.state.lightsGraceStart;if(a<c){if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1,this.state.lightsBrightness=100}}else if(a>=c&&!this.state.lightsFlickered)this.state.lightsFlickered=!0,this.lightsFlickerActive=!0,this.lightsFlickerTime=0,ve.emit(ge.LIGHTS_FLICKER,{});else if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1}else{const u=a-c,f=s.dimDurationSec*1e3,d=Math.min(1,u/f);this.state.lightsBrightness=100-(100-s.dimThreshold)*d,this.state.lightsBrightness<=s.dimThreshold&&(this.state.lightsBrightness=s.failedBrightness,Ds.spawnComplication(this.state,_e.LIGHTS))}}}tickLooseGoop(t){if(this.state.looseGoop.length===0)return;const{active:n,landed:s}=xy(this.state.looseGoop,this.state.grid,t);if(s.length>0){ve.emit(ge.PIECE_DROPPED);const r=this.state.grid.map(c=>[...c]);let o=!1;const l=[];if(s.forEach(c=>{if(c.y>=0&&c.y<Ge){const a=Math.floor(c.y),u=this.state.goalMarks.find(d=>d.x===c.x&&d.y===a);let f=!1;u&&u.color===c.data.color&&(l.push(u.id),f=!0),r[a][c.x]={...c.data,timestamp:Date.now(),isSealingGoop:f},o=!0}}),o&&(this.state.grid=Ei(r)),l.length>0){const c=new Set(l);l.forEach(a=>{const u=this.state.crackCells.find(f=>f.id===a);u&&(u.originCrackId.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.branchCrackIds=d.branchCrackIds.filter(p=>p!==a))}),u.branchCrackIds.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.originCrackId=d.originCrackId.filter(p=>p!==a))}))}),this.state.crackCells=this.state.crackCells.filter(a=>!c.has(a.id)),this.state.goalMarks=this.state.goalMarks.filter(a=>!c.has(a.id)),ve.emit(ge.GOAL_CAPTURED,{count:l.length})}this.state.looseGoop=n}else this.state.looseGoop=n}tickDumpPieces(t){var l;const n=[];for(const c of this.state.dumpQueue)c.spawnDelay-=t,c.spawnDelay<=0?this.state.dumpPieces.push(c):n.push(c);if(this.state.dumpQueue=n,this.state.dumpPieces.length===0)return;const s=[],r=this.state.grid.map(c=>[...c]);let o=!1;for(const c of this.state.dumpPieces){c.y+=Zg*t;const a=Math.floor(c.y),u=c.x;let f=!1;(a>=Ge-1||a>=0&&((l=r[a+1])!=null&&l[u]))&&(f=!0),f&&a>=0&&a<Ge?(r[a][u]={id:c.id,goopGroupId:Math.random().toString(36).substr(2,9),timestamp:Date.now(),color:c.color,groupMinY:a,groupMaxY:a,groupSize:1},o=!0):f||s.push(c)}this.state.dumpPieces=s,o&&(this.state.grid=Ei(r))}tickActivePiece(t){if(!this.state.activeGoop||this.usePhysicsForFalling)return;const s=1+(this.powerUps.DENSE_GOOP||0)*.125,r=Sf/s,o=this.isFastDropping?r/Cf:r,l=t/o,c=this.state.activeGoop.y+l,a=Gc(this.state.activeGoop.screenX,this.state.tankRotation),u={...this.state.activeGoop,y:c,x:a};if(fs(this.state.grid,u,this.state.tankRotation)){this.lockStartTime===null&&(this.lockStartTime=Date.now());const f=Date.now()-this.lockStartTime,d=this.isFastDropping?50:kf;(f>d||this.lockResetCount>=10)&&this.lockActivePiece()}else this.state.activeGoop=u,this.lockStartTime=null}lockActivePiece(){if(!this.state.activeGoop||this.state.gameOver)return;const t=rp(this.state.grid,this.state.activeGoop,this.state.tankRotation),n={...this.state.activeGoop,y:t};let{grid:s,consumedGoals:r,destroyedGoals:o}=py(this.state.grid,n,this.state.goalMarks);(n.definition.isWild||this.hasAdjacentWild(s,n))&&(s=hy(s,n)),(r.length>0||o.length>0)&&this.handleGoals(r,o,n),this.state.complications.some(u=>u.type===_e.LASER)||(this.state.laserCharge=Math.min(100,this.state.laserCharge+10)),ve.emit(ge.PIECE_DROPPED);const{grid:c,looseGoop:a}=ip(s);a.length>0&&this.state.looseGoop.push(...a),this.state.grid=c,this.spawnNewPiece(void 0,c),this.state.popStreak=0,this.isFastDropping=!1}tickActiveCharges(t){Object.keys(this.state.activeCharges).length===0&&this.equippedActives.length>0&&this.equippedActives.forEach(s=>{this.state.activeCharges[s]=this.state.activeCharges[s]??0});const n={COOLDOWN_BOOSTER:100/20,GOOP_DUMP:100/15,GOOP_COLORIZER:100/25,CRACK_DOWN:100/30};Object.keys(this.state.activeCharges).forEach(s=>{const r=this.state.activeCharges[s]||0;if(r<100){const o=n[s]||3,l=t/1e3*o,c=Math.min(100,r+l);this.state.activeCharges[s]=c}})}getFallSpeed(){const n=1+(this.powerUps.DENSE_GOOP||0)*.125,s=30/Sf*1e3*n;return this.isFastDropping?s*Cf:s}syncActivePieceFromPhysics(t,n){if(!(!this.state.activeGoop||this.state.gameOver))if(this.state.activeGoop.y=n,t){this.lockStartTime===null&&(this.lockStartTime=Date.now());const s=Date.now()-this.lockStartTime,r=this.isFastDropping?50:kf;(s>r||this.lockResetCount>=10)&&this.lockActivePiece()}else this.lockStartTime=null}tick(t){!this.isSessionActive||this.state.gameOver||this.state.isPaused||this.tickTimer(t)&&(this.tickGoals(),this.crackManager.tickGrowth(this.state,this.initialTotalScore,this.powerUps,this.maxTime),this.checkComplications(t),this.tickHeat(t),this.tickLightsBrightness(t),this.tickLooseGoop(t),this.tickDumpPieces(t),this.tickActivePiece(t),this.tickActiveCharges(t),this.emitChange())}}const wf=pt?25:16,Qg=(e,t,n,s=[],r)=>{const o=v.useRef(null);o.current||(o.current=new Kg(e,t,s));const l=o.current;if(l.equippedActives.length!==s.length||!l.equippedActives.every((p,y)=>p===s[y])){l.equippedActives=s;const p=l.state.activeCharges||{},y={};s.forEach(S=>{y[S]=p[S]??0}),l.state.activeCharges=y}const[,a]=v.useReducer(p=>p+1,0),u=v.useRef(0),f=v.useRef(0),d=v.useRef(0);return v.useEffect(()=>{l.syncTotalScore(e)},[e,l]),v.useEffect(()=>l.subscribe(()=>{if(l.state.gameOver){a();return}const y=performance.now();y-f.current>=wf&&(f.current=y,a())}),[l]),v.useEffect(()=>{const p=y=>{u.current||(u.current=y);const S=y-u.current;if(pt&&S<wf){d.current=requestAnimationFrame(p);return}u.current=y,l.tick(S),r&&r(S/1e3,l),d.current=requestAnimationFrame(p)};return d.current=requestAnimationFrame(p),()=>cancelAnimationFrame(d.current)},[l]),{engine:l,gameState:l.state}};function _i(e,t){let n=t-e;return n>Lo/2&&(n-=Lo),n<-Lo/2&&(n+=Lo),n}function Jg(e,t,n){const s=Math.min(t,.033);for(const r of e){const o=n.damping,l=r.isLocked?n.gravity:n.fallingGravity;for(const c of r.vertices){const a=(c.pos.x-c.oldPos.x)*o,u=(c.pos.y-c.oldPos.y)*o;c.oldPos.x=c.pos.x,c.oldPos.y=c.pos.y,c.pos.x+=a,c.pos.y+=u+l*s*s}for(const c of r.innerVertices){const a=(c.pos.x-c.oldPos.x)*o,u=(c.pos.y-c.oldPos.y)*o;c.oldPos.x=c.pos.x,c.oldPos.y=c.pos.y,c.pos.x+=a,c.pos.y+=u+l*s*s}}}function em(e,t){for(const n of e){const s=n.isLocked?t.returnSpeed:t.fallingReturnSpeed,r=s*s,o=n.isLocked?t.viscosity:t.fallingViscosity,l=Math.max(0,1-o),c=o>0?.03/Math.max(1,o):0,a=n.isLocked?t.homeStiffness:t.fallingHomeStiffness;for(const u of n.vertices){const f=lf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,S=p-u.pos.y,P=y*a*r,C=S*a*r;u.pos.x+=P*l,u.pos.y+=C*l,o>0&&(u.oldPos.x-=P*c,u.oldPos.y-=C*c)}for(const u of n.innerVertices){const f=lf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,S=p-u.pos.y,P=y*t.innerHomeStiffness*r,C=S*t.innerHomeStiffness*r;u.pos.x+=P*l,u.pos.y+=C*l,o>0&&(u.oldPos.x-=P*c,u.oldPos.y-=C*c)}}}function jf(e,t,n){const s=e[t.a],r=e[t.b],o=_i(s.pos.x,r.pos.x),l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)return;const u=(c-t.restLength)/c*n*.5;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}function tm(e,t){for(let n=0;n<t.iterations;n++)for(const s of e){for(const r of s.ringsprings)jf(s.vertices,r,t.stiffness*.01);for(const r of s.crossSprings)jf(s.vertices,r,t.stiffness*.005)}}function nm(e,t){for(const n of e){if(!n.isLocked)continue;const s=n.targetX,r=n.targetY,o=t.pressure*.002;for(const l of n.vertices){const c=l.pos.x-s,a=l.pos.y-r,u=Math.sqrt(c*c+a*a),f=Math.sqrt(l.homeOffset.x*l.homeOffset.x+l.homeOffset.y*l.homeOffset.y);if(u>1e-4&&f>1e-4){const p=(f-u)*o;l.pos.x+=c/u*p,l.pos.y+=a/u*p}}}}function sm(e,t){for(const r of e){for(const o of r.vertices){if(o.pos.y<t.minY+2){o.pos.y=t.minY+2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}if(o.pos.y>t.maxY-2){o.pos.y=t.maxY-2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}}for(const o of r.innerVertices)o.pos.y<t.minY+2&&(o.pos.y=t.minY+2),o.pos.y>t.maxY-2&&(o.pos.y=t.maxY-2)}}function om(e,t,n,s){Jg(e,t,n),em(e,n),tm(e,n),nm(e,n),sm(e,s)}function rm(e,t){const n=e.vertices,s=n.length;for(let r=0;r<s;r++){const o=n[(r-1+s)%s],l=n[r],c=n[(r+1)%s],a=l.pos.x-o.pos.x,u=l.pos.y-o.pos.y,f=c.pos.x-l.pos.x,d=c.pos.y-l.pos.y,p=Math.sqrt(a*a+u*u),y=Math.sqrt(f*f+d*d);if(p<1e-4||y<1e-4)continue;const S=u/p,P=-a/p,C=d/y,g=-f/y;let h=S+C,x=P+g;const m=Math.sqrt(h*h+x*x);m<1e-4||(h/=m,x/=m,n[r].oldPos.x-=h*t,n[r].oldPos.y-=x*t)}}function im(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertexA],u=c.vertices[o.vertexB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertexA}-${o.blobB}-${o.vertexB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=_i(a.targetX,c.targetX),f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++){const y=c.vertices[p],S=n.attractionRadius*y.attractionRadius;for(let P=0;P<a.vertices.length;P++){const C=a.vertices[P],g=n.attractionRadius*C.attractionRadius,h=(S+g)/2,x=_i(y.pos.x,C.pos.x),m=C.pos.y-y.pos.y,j=Math.sqrt(x*x+m*m),R=`${o}-${p}-${l}-${P}`;r.has(R)||j>h||(s.push({blobA:o,blobB:l,vertexA:p,vertexB:P,restLength:n.attractionRestLength}),r.add(R))}}}return s}function lm(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertexA],u=c.vertices[o.vertexB];if(!a||!u)continue;const f=_i(a.pos.x,u.pos.x),d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=Math.max(0,Math.min(1,1-p/n.goopiness)),S=s+y*(r-s),C=(p-o.restLength)*S,g=f/p*C,h=d/p*C;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function cm(e,t=30){for(let o=0;o<3;o++)for(let l=0;l<e.length;l++)for(let c=l+1;c<e.length;c++){const a=e[l],u=e[c];if(a.color===u.color)continue;const f=a.isFalling||a.isLoose,d=u.isFalling||u.isLoose;if(!f&&!d)continue;const p=a.targetX-u.targetX,y=a.targetY-u.targetY;if(!(Math.sqrt(p*p+y*y)>t*4))for(const P of a.vertices)for(const C of u.vertices){const g=C.pos.x-P.pos.x,h=C.pos.y-P.pos.y,x=Math.sqrt(g*g+h*h);if(x<2.5&&x>.01){const m=2.5-x,j=g/x,R=h/x,k=m*.8;P.pos.x-=j*k*.5,P.pos.y-=R*k*.5,C.pos.x+=j*k*.5,C.pos.y+=R*k*.5,P.oldPos.x-=j*k*.3,P.oldPos.y-=R*k*.3,C.oldPos.x+=j*k*.3,C.oldPos.y+=R*k*.3}}}}function am(e,t,n,s,r,o=0){var d;if(e.isLocked||e.isLoose)return;let l=!0;for(const p of e.gridCells){const y=p.y+1;if(y>=r){l=!1;break}const S=Math.floor(y)+Qe;let P=Math.floor(p.x)+o;for(;P<0;)P+=ke;for(;P>=ke;)P-=ke;const C=(d=s[S])==null?void 0:d[P];if(C&&C.goopGroupId!==void 0){l=!1;break}}if(e.isColliding=!l,l){const p=n*t;for(e.visualOffsetY+=p;e.visualOffsetY>=Pt;){for(const y of e.gridCells)y.y+=1;e.visualOffsetY-=Pt}}let c=0,a=0;for(const p of e.gridCells)c+=p.x,a+=p.y;const u=c/e.gridCells.length,f=a/e.gridCells.length;e.targetX=mn.x+(u+.5)*Pt,e.targetY=mn.y+(f+.5)*Pt+e.visualOffsetY}const um=2.4;function fm(){return{minX:mn.x,maxX:mn.x+12*Pt,minY:mn.y,maxY:mn.y+16*Pt}}function dm(e){const{enabled:t,params:n,bounds:s}=e,r=v.useRef([]),o=v.useRef([]),l=v.useRef([]),c=v.useRef(0),a=v.useRef({...Ai,...n}),u=v.useRef(s??fm());v.useEffect(()=>{n&&(a.current={...Ai,...n})},[n==null?void 0:n.damping,n==null?void 0:n.stiffness,n==null?void 0:n.pressure,n==null?void 0:n.iterations,n==null?void 0:n.homeStiffness,n==null?void 0:n.innerHomeStiffness,n==null?void 0:n.returnSpeed,n==null?void 0:n.viscosity,n==null?void 0:n.gravity,n==null?void 0:n.fallingHomeStiffness,n==null?void 0:n.fallingReturnSpeed,n==null?void 0:n.fallingViscosity,n==null?void 0:n.fallingGravity,n==null?void 0:n.attractionRadius,n==null?void 0:n.attractionRestLength,n==null?void 0:n.attractionStiffness,n==null?void 0:n.goopiness,n==null?void 0:n.tendrilEndRadius,n==null?void 0:n.tendrilSkinniness,n==null?void 0:n.wallThickness,n==null?void 0:n.fallingGoopiness,n==null?void 0:n.fallingTendrilEndRadius,n==null?void 0:n.fallingTendrilSkinniness,n==null?void 0:n.dropletCount,n==null?void 0:n.dropletSpeed,n==null?void 0:n.dropletLifetime,n==null?void 0:n.dropletSize,n==null?void 0:n.dropletGravity]),v.useEffect(()=>{s&&(u.current=s)},[s]);const f=v.useCallback((m,j,R,k,w=0)=>{const T=Fy(m,j,R,k,w);return r.current=[...r.current,T],T},[]),d=v.useCallback(m=>{r.current=r.current.filter(j=>j.id!==m)},[]),p=v.useCallback((m,j,R)=>{const k=r.current.find(w=>w.id===m);k&&(k.targetX=j,k.targetY=R)},[]),y=v.useCallback(m=>{const j=r.current.find(R=>R.id===m);j&&(j.isLocked=!0,j.isFalling=!1,j.isLoose=!1,j.fillAmount=0)},[]),S=v.useCallback((m,j)=>{if(!t)return;const R=r.current,k=a.current,w=R.length>0;if(j&&w)for(const L of R)L.isFalling&&!L.isLocked&&am(L,m,j.fallSpeed,j.grid,rn,j.tankRotation);if(w){om(R,m,k,u.current);for(const L of R)if(L.isLocked&&L.fillAmount<1){const q=1/(L.gridCells.length*fo/1e3);L.fillAmount=Math.min(1,L.fillAmount+q*m);const Q=L.fillAmount>=1;Q&&!L.wasFullLastFrame&&rm(L,um),L.wasFullLastFrame=Q}o.current=im(R,o.current,k),lm(R,o.current,k),cm(R,Pt)}const T=k.dropletGravity,_=u.current;for(const L of l.current)L.vel.y+=T*m,L.pos.x+=L.vel.x*m,L.pos.y+=L.vel.y*m,(L.pos.x+L.radius<_.minX||L.pos.x-L.radius>_.maxX)&&(L.lifetime=0),L.pos.y+L.radius<_.minY&&(L.lifetime=0),L.pos.y+L.radius>_.maxY&&(L.pos.y=_.maxY-L.radius,L.vel.y*=-.3),L.lifetime-=m,L.opacity=Math.max(0,L.lifetime/L.maxLifetime),L.radius*=.995;l.current=l.current.filter(L=>L.lifetime>0&&L.opacity>.01)},[t]),P=v.useCallback(()=>{r.current=[],o.current=[],l.current=[]},[]),C=v.useCallback(m=>{const j=a.current,R=m.targetX,k=m.targetY;for(let w=0;w<j.dropletCount;w++){const T=Math.floor(Math.random()*m.vertices.length),_=m.vertices[T],L=_.pos.x-R,V=_.pos.y-k,q=Math.atan2(V,L)+(Math.random()-.5)*.8,Q=j.dropletSpeed*(.5+Math.random()*.8),A={id:`droplet-${c.current++}`,pos:{x:_.pos.x,y:_.pos.y},vel:{x:Math.cos(q)*Q,y:Math.sin(q)*Q-50},radius:j.dropletSize*(.5+Math.random()*.7),color:m.color,opacity:1,lifetime:j.dropletLifetime*(.7+Math.random()*.6),maxLifetime:j.dropletLifetime};l.current.push(A)}},[]),g=v.useCallback(m=>r.current.find(j=>j.id===m),[]),h=v.useCallback(m=>{for(const j of r.current){const k=-(m-j.createdAtRotation)*Pt;for(const w of j.vertices)w.pos.x+=k,w.oldPos.x+=k;for(const w of j.innerVertices)w.pos.x+=k,w.oldPos.x+=k;j.targetX+=k,j.createdAtRotation=m}},[]),x=v.useCallback(()=>{var k;const m=r.current.find(w=>w.isFalling&&!w.isLocked);if(!m)return null;let j=((k=m.gridCells[0])==null?void 0:k.y)??0;for(const w of m.gridCells)w.y<j&&(j=w.y);return{gridY:j+Qe,isColliding:m.isColliding}},[]);return{blobs:r.current,attractionSprings:o.current,params:a.current,createBlob:f,removeBlob:d,updateBlobTarget:p,lockBlob:y,step:S,clearBlobs:P,getBlob:g,shiftBlobsForRotation:h,droplets:l.current,createDropletsForPop:C,getActivePieceState:x}}const pm=({onExit:e,onRunComplete:t,initialTotalScore:n,powerUps:s={},scraps:r,settings:o,onOpenSettings:l,onOpenHelp:c,onOpenUpgrades:a,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,equippedActives:p=[],onToggleEquip:y})=>{const[S,P]=v.useState(!1),[C,g]=v.useState({...Ai}),[h,x]=v.useState(.2),[m,j]=v.useState(!1),[R,k]=v.useState(5),[w,T]=v.useState(40),[_,L]=v.useState(-11),[V,q]=v.useState(5),[Q,A]=v.useState(40),[Z,ce]=v.useState(-11),Y=dm({enabled:!pt,params:C}),K=v.useCallback((W,M)=>{if(M.state.gameOver||!M.isSessionActive)return;const B={grid:M.state.grid,tankRotation:M.state.tankRotation,fallSpeed:M.freezeFalling?0:M.getFallSpeed()};Y.step(W,B);const de=M.state.activeGoop;if(de){const I=`active-${de.spawnTimestamp}`,F=Y.getBlob(I);if(F&&F.isFalling&&!F.isLocked){const D=Y.getActivePieceState();D&&M.syncActivePieceFromPhysics(D.isColliding,D.gridY)}}},[Y]),{engine:$,gameState:U}=Qg(n,s,t,p,K);v.useEffect(()=>{$.usePhysicsForFalling=!pt},[$]);const J=v.useCallback(W=>{$.execute(new yg(W))},[$]),G=v.useRef(new Set),pe=v.useRef(0),we=v.useRef(0),O=v.useRef(null),H=v.useRef(!1),me=v.useRef(null),ue=v.useRef(null),Se=250,Ce=1500-((s==null?void 0:s.GOOP_SWAP)||0)*250,ee=U.complications.find(W=>W.type===_e.CONTROLS),je=v.useRef(0);v.useEffect(()=>{ee||(je.current=0)},[ee==null?void 0:ee.id]);const xe=o.invertRotation?-1:1;v.useEffect(()=>{if(U.gameOver&&U.phase===Ze.ConsoleScreen){const W=U.goalsCleared>=U.goalsTarget;t({score:U.shiftScore,won:W})}},[U.gameOver]);const Me=v.useCallback(()=>{H.current=!1,O.current&&(cancelAnimationFrame(O.current),O.current=null)},[]),Oe=v.useCallback(()=>{ue.current&&(clearInterval(ue.current),ue.current=null),me.current=null,ve.emit(ge.INPUT_SWAP_HOLD,{progress:-1})},[]),Ne=v.useCallback(()=>{ue.current||(me.current=Date.now(),ve.emit(ge.INPUT_SWAP_HOLD,{progress:0}),ue.current=window.setInterval(()=>{if(!me.current)return;const W=Date.now()-me.current;if(W<Se)return;const M=W-Se,B=Math.min(100,M/Ce*100);ve.emit(ge.INPUT_SWAP_HOLD,{progress:B}),B>=100&&(ve.emit(ge.INPUT_SWAP),Oe())},16))},[Oe]),Fe=v.useCallback(()=>{if(H.current)return;H.current=!0;const W=()=>{if(!H.current)return;const M=Date.now(),B=ee?200:100;if(M>=we.current){let I=0;(G.current.has("ArrowLeft")||G.current.has("KeyA"))&&(I=1*xe),(G.current.has("ArrowRight")||G.current.has("KeyD"))&&(I=-1*xe),pe.current!==0&&(I=pe.current*xe),I!==0&&(ee?(je.current++,je.current>=2&&($.execute(new _r(I)),je.current=0)):$.execute(new _r(I)),we.current=M+B)}(G.current.has("ArrowLeft")||G.current.has("ArrowRight")||G.current.has("KeyA")||G.current.has("KeyD")||pe.current!==0)&&U.phase===Ze.TankScreen&&!$.state.isPaused&&$.isSessionActive?O.current=requestAnimationFrame(W):Me()};O.current=requestAnimationFrame(W)},[$,U.phase,Me,xe,ee]);v.useEffect(()=>{const W=de=>{if(!de.repeat){if(G.current.add(de.code),de.key==="`"){de.preventDefault(),P(I=>!I);return}if(de.key==="Backspace"&&U.phase===Ze.TankScreen&&$.execute(new $s(Ze.ConsoleScreen)),U.gameOver){de.key==="Enter"&&$.resetSession();return}if(U.phase===Ze.TankScreen&&!$.state.isPaused&&$.isSessionActive)switch(de.code){case"ArrowLeft":case"KeyA":$.execute(new _r(1*xe)),we.current=Date.now()+250,Fe();break;case"ArrowRight":case"KeyD":$.execute(new _r(-1*xe)),we.current=Date.now()+250,Fe();break;case"KeyQ":$.execute(new Ro(!1));break;case"KeyE":$.execute(new Ro(!0));break;case"KeyS":$.execute(new Tl(!0));break;case"Space":$.execute(new $s(Ze.ConsoleScreen));break;case"KeyW":$.execute(new $s(Ze.ConsoleScreen));break;case"KeyR":Ne();break}}},M=de=>{if(G.current.delete(de.code),U.phase===Ze.TankScreen)switch(de.code){case"KeyS":$.execute(new Tl(!1));break;case"KeyR":Oe();break;case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":!(G.current.has("ArrowLeft")||G.current.has("ArrowRight")||G.current.has("KeyA")||G.current.has("KeyD"))&&pe.current===0&&Me();break}},B=de=>{U.phase===Ze.TankScreen&&!$.state.isPaused&&!U.gameOver&&$.isSessionActive&&(de.deltaY>0?$.execute(new Ro(!0)):$.execute(new Ro(!1)))};return window.addEventListener("keydown",W),window.addEventListener("keyup",M),window.addEventListener("wheel",B),()=>{window.removeEventListener("keydown",W),window.removeEventListener("keyup",M),window.removeEventListener("wheel",B),Me(),Oe()}},[$,U.phase,U.gameOver,Fe,Me,Ne,Oe,xe]),v.useEffect(()=>{const W=ve.on(ge.INPUT_ROTATE,D=>{$.execute(new Ro((D==null?void 0:D.clockwise)??!0))}),M=ve.on(ge.INPUT_DRAG,D=>{pe.current=(D==null?void 0:D.direction)??0,(D==null?void 0:D.direction)!==0?Fe():G.current.has("ArrowLeft")||G.current.has("ArrowRight")||G.current.has("KeyA")||G.current.has("KeyD")||Me()}),B=ve.on(ge.INPUT_SWIPE_UP,()=>{$.execute(new $s(Ze.ConsoleScreen))}),de=ve.on(ge.INPUT_FAST_DROP,D=>{$.execute(new Tl((D==null?void 0:D.active)??!1))}),I=ve.on(ge.INPUT_SWAP,()=>{$.execute(new dg)}),F=ve.on(ge.INPUT_BLOCK_TAP,D=>{D&&$.execute(new pg(D.x,D.y))});return()=>{W(),M(),B(),de(),I(),F()}},[$,Fe,Me]);const $e=xt(n).rank;return i.jsxs("div",{className:"w-full h-full relative touch-none bg-slate-950 overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0",children:i.jsx(By,{state:U,rank:$e,maxTime:$.maxTime,lightsBrightness:U.phase===Ze.TankScreen?U.lightsBrightness:100,laserCharge:U.laserCharge,controlsHeat:U.controlsHeat,complicationCooldowns:U.complicationCooldowns,equippedActives:p,activeCharges:U.activeCharges,onActivateAbility:J,powerUps:s,storedGoop:$.state.storedGoop,nextGoop:$.state.nextGoop,softBodyPhysics:Y,normalGoopOpacity:h,showVertexDebug:m,gooStdDev:R,gooAlphaMul:w,gooAlphaOff:_,fallingGooStdDev:V,fallingGooAlphaMul:Q,fallingGooAlphaOff:Z})}),i.jsx("div",{className:`absolute inset-0 z-50 transition-opacity duration-500 ${U.phase===Ze.ConsoleScreen?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:i.jsx(Hg,{engine:$,state:U,careerScore:n,scraps:r,powerUps:s,onOpenSettings:l,onOpenHelp:c,onOpenUpgrades:a,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,onDismissGameOver:()=>$.resetSession(),equippedActives:p,onToggleEquip:y})}),i.jsx("div",{className:`absolute inset-0 z-20 pointer-events-none transition-opacity duration-500 ${U.phase===Ze.TankScreen?"opacity-100":"opacity-0"}`,children:i.jsx(og,{state:U,onRestart:()=>$.execute(new hg),onExit:()=>{ve.emit(ge.GAME_EXITED),$.execute(new $s(Ze.ConsoleScreen))},initialTotalScore:$.initialTotalScore,maxTime:$.maxTime})}),S&&!pt&&i.jsxs("div",{className:"absolute top-2 right-2 z-[100] bg-black/90 text-white p-3 rounded-lg text-xs font-mono pointer-events-auto overflow-y-auto",style:{minWidth:460,maxHeight:"95vh"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"font-bold",children:"Physics Debug"}),i.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-white",children:""})]}),i.jsxs("div",{className:"space-y-2 mb-2",children:[i.jsx("div",{className:"text-gray-400 text-[10px] uppercase tracking-wider",children:"Shared"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Damping: ",C.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:C.damping,onChange:W=>g(M=>({...M,damping:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Stiffness: ",C.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:C.stiffness,onChange:W=>g(M=>({...M,stiffness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Pressure: ",C.pressure]}),i.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:C.pressure,onChange:W=>g(M=>({...M,pressure:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Inner Home Stiffness: ",C.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:C.innerHomeStiffness,onChange:W=>g(M=>({...M,innerHomeStiffness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Iterations: ",C.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:C.iterations,onChange:W=>g(M=>({...M,iterations:Number(W.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-600",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-yellow-400 text-[10px] uppercase tracking-wider",children:"Locked"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Home Stiffness: ",C.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C.homeStiffness,onChange:W=>g(M=>({...M,homeStiffness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Return Speed: ",C.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C.returnSpeed,onChange:W=>g(M=>({...M,returnSpeed:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Viscosity: ",C.viscosity.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:C.viscosity,onChange:W=>g(M=>({...M,viscosity:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Gravity: ",C.gravity]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:C.gravity,onChange:W=>g(M=>({...M,gravity:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Goo Filter"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Blur: ",R]}),i.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:R,onChange:W=>k(Number(W.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Mul: ",w]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:w,onChange:W=>T(Number(W.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Off: ",_]}),i.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:_,onChange:W=>L(Number(W.target.value)),className:"w-full"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-cyan-400 text-[10px] uppercase tracking-wider",children:"Falling"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Home Stiffness: ",C.fallingHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C.fallingHomeStiffness,onChange:W=>g(M=>({...M,fallingHomeStiffness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Return Speed: ",C.fallingReturnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C.fallingReturnSpeed,onChange:W=>g(M=>({...M,fallingReturnSpeed:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Viscosity: ",C.fallingViscosity.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:C.fallingViscosity,onChange:W=>g(M=>({...M,fallingViscosity:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Gravity: ",C.fallingGravity]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:C.fallingGravity,onChange:W=>g(M=>({...M,fallingGravity:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Tendrils"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Goopiness: ",C.fallingGoopiness]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:C.fallingGoopiness,onChange:W=>g(M=>({...M,fallingGoopiness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["End Radius: ",C.fallingTendrilEndRadius]}),i.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:C.fallingTendrilEndRadius,onChange:W=>g(M=>({...M,fallingTendrilEndRadius:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Skinniness: ",C.fallingTendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C.fallingTendrilSkinniness,onChange:W=>g(M=>({...M,fallingTendrilSkinniness:Number(W.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Goo Filter"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Blur: ",V]}),i.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:V,onChange:W=>q(Number(W.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Mul: ",Q]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:Q,onChange:W=>A(Number(W.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Off: ",Z]}),i.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:Z,onChange:W=>ce(Number(W.target.value)),className:"w-full"})]})]})]})]}),i.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600 mt-2",children:[i.jsxs("div",{className:"pt-0",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Attraction"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Radius: ",C.attractionRadius]}),i.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:C.attractionRadius,onChange:W=>g(M=>({...M,attractionRadius:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Rest Length: ",C.attractionRestLength]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:C.attractionRestLength,onChange:W=>g(M=>({...M,attractionRestLength:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Stiffness: ",C.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",value:C.attractionStiffness,onChange:W=>g(M=>({...M,attractionStiffness:Number(W.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Rendering"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Goopiness: ",C.goopiness]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:C.goopiness,onChange:W=>g(M=>({...M,goopiness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Tendril End Radius: ",C.tendrilEndRadius]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:C.tendrilEndRadius,onChange:W=>g(M=>({...M,tendrilEndRadius:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Tendril Skinniness: ",C.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C.tendrilSkinniness,onChange:W=>g(M=>({...M,tendrilSkinniness:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Wall Thickness: ",C.wallThickness]}),i.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:C.wallThickness,onChange:W=>g(M=>({...M,wallThickness:Number(W.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Droplets (Pop Effect)"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Count: ",C.dropletCount]}),i.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:C.dropletCount,onChange:W=>g(M=>({...M,dropletCount:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Speed: ",C.dropletSpeed]}),i.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:C.dropletSpeed,onChange:W=>g(M=>({...M,dropletSpeed:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Lifetime: ",C.dropletLifetime,"s"]}),i.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:C.dropletLifetime,onChange:W=>g(M=>({...M,dropletLifetime:Number(W.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Size: ",C.dropletSize]}),i.jsx("input",{type:"range",min:"2",max:"30",step:"1",value:C.dropletSize,onChange:W=>g(M=>({...M,dropletSize:Number(W.target.value)})),className:"w-full"})]})]}),i.jsx("div",{className:"pt-2 border-t border-gray-600",children:i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Normal Goop Opacity: ",h.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:h,onChange:W=>x(Number(W.target.value)),className:"w-full"})]})}),i.jsxs("div",{className:"pt-2 border-t border-gray-600 text-gray-400",children:[i.jsxs("div",{children:["Blobs: ",Y.blobs.length]}),i.jsxs("label",{className:"flex items-center gap-2 mt-1",children:[i.jsx("input",{type:"checkbox",checked:m,onChange:W=>j(W.target.checked)}),i.jsx("span",{children:"Show Vertices"})]}),i.jsxs("label",{className:"flex items-center gap-2 mt-1",children:[i.jsx("input",{type:"checkbox",checked:$.freezeTimer,onChange:W=>{$.freezeTimer=W.target.checked}}),i.jsx("span",{children:"Freeze Timer"})]}),i.jsxs("label",{className:"flex items-center gap-2 mt-1",children:[i.jsx("input",{type:"checkbox",checked:$.freezeFalling,onChange:W=>{$.freezeFalling=W.target.checked}}),i.jsx("span",{children:"Freeze Falling"})]}),i.jsxs("div",{className:"flex gap-1 mt-1",children:[i.jsx("button",{onClick:()=>{g({...Ai}),x(.25),j(!1),k(8),T(24),L(-13),q(8),A(24),ce(-13)},className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Reset to Defaults"}),i.jsx("button",{onClick:()=>{const W={...C,gooStdDev:R,gooAlphaMul:w,gooAlphaOff:_,fallingGooStdDev:V,fallingGooAlphaMul:Q,fallingGooAlphaOff:Z,normalGoopOpacity:h};console.log("=== DEBUG PARAMS SNAPSHOT ==="),console.log(JSON.stringify(W,null,2)),console.log("============================")},className:"px-2 py-1 bg-blue-700 hover:bg-blue-600 rounded text-xs",children:"Save"})]})]})]})]})]})},hm=({onBack:e})=>i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-4",children:i.jsx("h2",{className:"text-2xl font-bold text-yellow-400 tracking-wider",children:"UPGRADES"})}),i.jsx("div",{className:"w-full max-w-md space-y-4 opacity-50 pointer-events-none",children:[1,2,3].map(t=>i.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center",children:i.jsx(qy,{className:"w-6 h-6 text-slate-600"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-bold text-slate-300",children:["Locked Upgrade ",t]}),i.jsxs("div",{className:"text-xs text-slate-500",children:["Requires Rank ",t*5]})]})]}),i.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded text-slate-500 text-xs font-bold",children:"LOCKED"})]},t))}),i.jsx("div",{className:"mt-8 text-center text-slate-500 text-sm",children:"Play more to unlock system upgrades."})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),xm=({settings:e,onUpdate:t,onBack:n})=>{v.useEffect(()=>{vt.init(e)},[]);const s=(l,c)=>{t({...e,[l]:c})},r=({label:l,value:c,onChange:a,icon:u,colorClass:f})=>i.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex flex-col gap-3 transition-colors hover:border-slate-700",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{className:`w-5 h-5 ${f}`}),i.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase text-sm",children:l})]}),i.jsxs("span",{className:`font-bold text-sm ${f}`,children:[c,"%"]})]}),i.jsxs("div",{className:"relative w-full h-6 flex items-center",children:[i.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:d=>a(Number(d.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-cyan-500 z-10",style:{background:`linear-gradient(to right, currentColor 0%, currentColor ${c}%, rgba(30, 41, 59, 1) ${c}%, rgba(30, 41, 59, 1) 100%)`}}),i.jsx("style",{children:`
              input[type=range]::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  height: 16px;
                  width: 16px;
                  border-radius: 50%;
                  background: #f1f5f9;
                  margin-top: -2px; /* align center */
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
              input[type=range]::-moz-range-thumb {
                  height: 16px;
                  width: 16px;
                  border: none;
                  border-radius: 50%;
                  background: #f1f5f9;
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
           `})]})]}),o=({label:l,value:c,onChange:a,icon:u,colorClass:f})=>i.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex items-center justify-between transition-colors hover:border-slate-700 cursor-pointer",onClick:()=>a(!c),children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{className:`w-5 h-5 ${f}`}),i.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase text-sm",children:l})]}),i.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${c?"bg-cyan-600":"bg-slate-700"}`,children:i.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform duration-300 ${c?"translate-x-6":"translate-x-0"}`})})]});return i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6",children:i.jsx("h2",{className:"text-3xl text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Config"})}),i.jsxs("div",{className:"w-full max-w-md space-y-4",children:[i.jsx(r,{label:"Master Output",value:e.masterVolume,onChange:l=>s("masterVolume",l),icon:ng,colorClass:"text-cyan-400"}),i.jsx(r,{label:"Music Level",value:e.musicVolume,onChange:l=>s("musicVolume",l),icon:Ky,colorClass:"text-purple-400"}),i.jsx(r,{label:"SFX Level",value:e.sfxVolume,onChange:l=>{s("sfxVolume",l)},icon:eg,colorClass:"text-green-400"}),i.jsx("div",{className:"h-px bg-slate-800 my-2"}),i.jsx(o,{label:"Invert Rotation",value:e.invertRotation||!1,onChange:l=>s("invertRotation",l),icon:Jy,colorClass:"text-yellow-400"})]}),i.jsx("div",{className:"mt-8 text-center text-slate-700 text-[10px] uppercase tracking-widest font-bold",children:"Audio System v2.1  Initialized"})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:n,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},ym=({onBack:e})=>i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6 flex-shrink-0",children:i.jsx("h2",{className:"text-3xl text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Operator Manual"})}),i.jsxs("div",{className:"w-full max-w-md space-y-6",children:[i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx(Xy,{className:"w-6 h-6 text-red-500"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"THE OBJECTIVE"})]}),i.jsxs("p",{className:"text-slate-400 leading-relaxed text-base",children:["The filtration system is clogging! Pop as much ooze as you can before the ",i.jsx("span",{className:"text-red-400 font-bold",children:"Pressure"})," reaches 100%.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("span",{className:"text-green-400 font-bold",children:"PRO TIP:"})," Popping larger groups of goop vents pressure, buying you more time to work."]})]}),i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx(Vy,{className:"w-6 h-6 text-slate-400"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"CONTROLS"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx(Os,{keyName:"A / D",action:"Rotate Tank View"}),i.jsx(Os,{keyName:"Q / E",action:"Rotate Falling Goop"}),i.jsx(Os,{keyName:"S",action:"Fall Faster"}),i.jsx(Os,{keyName:"R",action:"Swap Held Goop"}),i.jsx(Os,{keyName:"W / Space",action:"Return to Console"}),i.jsx(Os,{keyName:"CLICK",action:"Pop Solid Goop"})]}),i.jsx("div",{className:"mt-4 text-center text-sm text-slate-500 italic",children:"* Touch controls: Drag to rotate tank, tap sides to rotate piece."})]}),i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[i.jsx(Uy,{className:"w-6 h-6 text-cyan-400"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"MECHANICS"})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(tg,{className:"w-5 h-5 text-red-500"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Priority Targets"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Sensors identify impurity hotspots with ",i.jsx("span",{className:"text-white font-bold",children:"colored markers"})," on the grid. Clear goop of the ",i.jsx("span",{className:"text-white font-bold",children:"matching color"})," at these coordinates to execute a localized flush protocol."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(Zy,{className:"w-5 h-5 text-yellow-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Purging (Clicking)"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["You can only pop goop that is ",i.jsx("span",{className:"text-white font-bold",children:"fully filled"})," (solid) and sitting ",i.jsx("span",{className:"text-white font-bold",children:"below the pressure line"})," (the water level)."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(Wy,{className:"w-5 h-5 text-green-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Scoring"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Goop combines with like colors.",i.jsx("br",{})," ",i.jsx("span",{className:"text-green-400",children:"Bigger Groups"})," = More XP.",i.jsx("br",{})," ",i.jsx("span",{className:"text-green-400",children:"Higher Elevation"})," = More XP."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(Qy,{className:"w-5 h-5 text-orange-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Console Maintenance"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Sometimes equipment fails! If controls lock up or lights go out, press ",i.jsx("span",{className:"text-white font-bold",children:"SPACE"})," or ",i.jsx("span",{className:"text-white font-bold",children:"W"})," to return to the Console and fix the issue manually."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(sg,{className:"w-5 h-5 text-purple-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Progression"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Level up your Operator Rank to earn ",i.jsx("span",{className:"text-yellow-400",children:"Scraps"}),". Spend these in the Upgrades menu to enhance your efficiency!"]})]})]})]})]})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),Os=({keyName:e,action:t})=>i.jsxs("div",{className:"flex flex-col bg-slate-950 border border-slate-800 p-2 rounded-lg text-center",children:[i.jsx("span",{className:"text-cyan-400 font-black text-base mb-1",children:e}),i.jsx("span",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider",children:t})]}),Ii="gooptris_save_v3",Pf="gooptris_save_v2",Hc=()=>({careerRank:1,careerScore:0,scraps:0,powerUps:{},equippedActives:[],unlockedUpgrades:[],firstRunComplete:!1,milestonesReached:[],settings:{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1}}),gm=e=>{const t={...e};return"operatorXP"in t&&(t.careerScore=t.operatorXP,delete t.operatorXP),"operatorRank"in t&&(t.careerRank=t.operatorRank,delete t.operatorRank),t},mm=()=>{try{let e=localStorage.getItem(Ii);const t=Hc();if(!e){const s=localStorage.getItem(Pf);if(s){const r=JSON.parse(s),o=gm(r);localStorage.setItem(Ii,JSON.stringify(o)),localStorage.removeItem(Pf),e=JSON.stringify(o)}}if(!e)return t;const n=JSON.parse(e);return{...t,...n,settings:{...t.settings,...n.settings||{}},powerUps:{...t.powerUps,...n.powerUps||{}},equippedActives:n.equippedActives||t.equippedActives,unlockedUpgrades:n.unlockedUpgrades||t.unlockedUpgrades,milestonesReached:n.milestonesReached||t.milestonesReached}}catch(e){return console.error("Failed to load save data",e),Hc()}},vm=e=>{try{localStorage.setItem(Ii,JSON.stringify(e))}catch(t){console.error("Failed to save data",t)}},Sm=()=>{const e=Hc();try{localStorage.setItem(Ii,JSON.stringify(e))}catch(t){console.error("Failed to wipe save data",t)}return e},Cm=()=>{v.useEffect(()=>{const e=ve.on(ge.PIECE_MOVED,()=>vt.playMove()),t=ve.on(ge.PIECE_ROTATED,()=>vt.playRotate()),n=ve.on(ge.PIECE_DROPPED,()=>vt.playDrop()),s=ve.on(ge.GOOP_POPPED,f=>{vt.playPop((f==null?void 0:f.popStreak)||0)}),r=ve.on(ge.ACTION_REJECTED,()=>vt.playReject()),o=ve.on(ge.GOAL_CAPTURED,f=>{vt.playPop(10)}),l=ve.on(ge.GAME_OVER,()=>{vt.playGameOver(),vt.stopMusic()}),c=ve.on(ge.MUSIC_START,()=>vt.startMusic()),a=ve.on(ge.MUSIC_STOP,()=>vt.stopMusic()),u=ve.on(ge.GAME_RESUMED,()=>{vt.resume(),vt.startMusic()});return()=>{e(),t(),n(),s(),r(),o(),l(),c(),a(),u()}},[])},Rf={damping:.975,gravity:30,stiffness:20,pressure:2.5,iterations:3},bf=40;function Mf(e,t){const n=[],s=[],r=[],o=bf,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=up(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,centerX:e,centerY:t,radius:bf*1.5}}function up(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function fp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function km(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function wm(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function jm(e,t){const n=up(e.vertices);if(n<1)return;const s=e.restArea/n,r=fp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Pm(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5)}function Rm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function bm(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Rm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=fp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill(),e.fillStyle="#fff",e.font="10px monospace",e.fillText(String(a),u.pos.x-3,u.pos.y+3)}e.strokeStyle="rgba(52, 152, 219, 0.5)",e.lineWidth=1;for(const a of t.ringsprings)e.beginPath(),e.moveTo(s[a.a].pos.x,s[a.a].pos.y),e.lineTo(s[a.b].pos.x,s[a.b].pos.y),e.stroke();e.strokeStyle="rgba(155, 89, 182, 0.3)";for(const a of t.crossSprings)e.beginPath(),e.moveTo(s[a.a].pos.x,s[a.a].pos.y),e.lineTo(s[a.b].pos.x,s[a.b].pos.y),e.stroke();e.beginPath(),e.arc(l.x,l.y,5,0,Math.PI*2),e.fillStyle="#f39c12",e.fill()}}const Il=500,Ll=400;function Mm(){const e=v.useRef(null),t=v.useRef(Mf(Il/2,Ll/3)),n=v.useRef(0),s=v.useRef(-1),r=v.useRef({active:!1,vertexIndex:-1}),[o,l]=v.useState(Rf),[c,a]=v.useState(!0),[u,f]=v.useState(0);v.useEffect(()=>{const g=e.current;if(!g)return;const h=g.getContext("2d");if(!h)return;let x=0,m=performance.now();const j=R=>{x++,R-m>1e3&&(f(x),x=0,m=R);const k=t.current;if(s.current>=0){const w=Math.min((R-s.current)/1e3,.033);km(k,w,o);for(let T=0;T<o.iterations;T++)wm(k,o),jm(k,o);Pm(k,g.width,g.height)}s.current=R,r.current.active&&r.current.vertexIndex>=0,h.fillStyle="#2c3e50",h.fillRect(0,0,g.width,g.height),h.fillStyle="#34495e",h.fillRect(0,g.height-10,g.width,10),bm(h,k,c),n.current=requestAnimationFrame(j)};return n.current=requestAnimationFrame(j),()=>{cancelAnimationFrame(n.current)}},[o,c]);const d=v.useCallback((g,h)=>{const x=t.current;if(!x)return-1;let m=1/0,j=-1;for(let R=0;R<x.vertices.length;R++){const k=x.vertices[R],w=k.pos.x-g,T=k.pos.y-h,_=Math.sqrt(w*w+T*T);_<m&&_<50&&(m=_,j=R)}return j},[]),p=v.useCallback(g=>{const h=e.current;if(!h)return;const x=h.getBoundingClientRect(),m=g.clientX-x.left,j=g.clientY-x.top,R=d(m,j);R>=0&&(r.current={active:!0,vertexIndex:R})},[d]),y=v.useCallback(g=>{if(!r.current.active)return;const h=e.current;if(!h)return;const x=t.current,m=h.getBoundingClientRect(),j=g.clientX-m.left,R=g.clientY-m.top,k=x.vertices[r.current.vertexIndex];k.pos.x=j,k.pos.y=R,k.oldPos.x=j,k.oldPos.y=R},[]),S=v.useCallback(()=>{r.current={active:!1,vertexIndex:-1}},[]),P=v.useCallback(()=>{t.current=Mf(Il/2,Ll/3),s.current=-1},[]),C=v.useCallback(()=>{const g=t.current;for(const h of g.vertices)h.oldPos.x=h.pos.x+(Math.random()-.5)*30,h.oldPos.y=h.pos.y+(Math.random()-.5)*30},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-1: Soft Body Blob"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Click and drag vertices to poke the blob"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Il,height:Ll,onMouseDown:p,onMouseMove:y,onMouseUp:S,onMouseLeave:S,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"pointer"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",u]}),i.jsx("span",{children:"Vertices: 10"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping (velocity): ",o.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.001",value:o.damping,onChange:g=>l(h=>({...h,damping:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Gravity: ",o.gravity]}),i.jsx("input",{type:"range",min:"-25",max:"50",step:"5",value:o.gravity,onChange:g=>l(h=>({...h,gravity:parseFloat(g.target.value)}))}),i.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"-25 = floats up, 0 = zero-g, 50 = gentle fall"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Stiffness (k): ",o.stiffness]}),i.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:o.stiffness,onChange:g=>l(h=>({...h,stiffness:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Pressure: ",o.pressure.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:o.pressure,onChange:g=>l(h=>({...h,pressure:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Constraint Iterations: ",o.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:o.iterations,onChange:g=>l(h=>({...h,iterations:parseInt(g.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:c,onChange:g=>a(g.target.checked)}),i.jsx("span",{children:"Show Debug (vertices, springs)"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:C,style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Poke!"}),i.jsx("button",{onClick:P,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset"})]}),i.jsx("button",{onClick:()=>l(Rf),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset Parameters"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-1 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Verlet integration with position-based constraints"}),i.jsx("li",{children:"T-tetromino shape with 10 perimeter vertices"}),i.jsx("li",{children:"Ring springs (perimeter) + cross springs (structural)"}),i.jsx("li",{children:"Pressure force for volume preservation"}),i.jsx("li",{children:"Catmull-Rom to Bezier for smooth rendering"})]})]})]})}const Tf={damping:.92,gravity:0,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.03},Tm=40,Ol=500,Nl=400;function Ef(e,t){const n=[],s=[],r=[],o=Tm,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=dp(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t}}function dp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function pp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Em(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function Am(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function _m(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Im(e,t){const n=dp(e.vertices);if(n<1)return;const s=e.restArea/n,r=pp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Lm(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3)}function Om(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Nm(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let a=0;a<r;a++){const u=t.targetX+s[a].homeOffset.x,f=t.targetY+s[a].homeOffset.y;a===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Om(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=pp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}e.strokeStyle="#f39c12",e.lineWidth=2,e.beginPath(),e.moveTo(t.targetX-10,t.targetY),e.lineTo(t.targetX+10,t.targetY),e.moveTo(t.targetX,t.targetY-10),e.lineTo(t.targetX,t.targetY+10),e.stroke()}}function Dm(){const e=v.useRef(null),t=v.useRef(Ef(Ol/2,Nl/2)),n=v.useRef(0),s=v.useRef(-1),[r,o]=v.useState(Tf),[l,c]=v.useState(!0),[a,u]=v.useState(0),[f,d]=v.useState("cursor");v.useEffect(()=>{const C=e.current;if(!C)return;const g=C.getContext("2d");if(!g)return;let h=0,x=performance.now();const m=j=>{h++,j-x>1e3&&(u(h),h=0,x=j);const R=t.current;if(s.current>=0){const k=Math.min((j-s.current)/1e3,.033);Em(R,k,r),Am(R,r);for(let w=0;w<r.iterations;w++)_m(R,r),Im(R,r);Lm(R,C.width,C.height)}s.current=j,g.fillStyle="#2c3e50",g.fillRect(0,0,C.width,C.height),Nm(g,R,l),g.fillStyle="rgba(255,255,255,0.5)",g.font="12px system-ui",g.fillText(f==="cursor"?"Move mouse to guide blob":"Click to set target",10,20),n.current=requestAnimationFrame(m)};return n.current=requestAnimationFrame(m),()=>cancelAnimationFrame(n.current)},[r,l,f]);const p=v.useCallback(C=>{if(f!=="cursor")return;const g=e.current;if(!g)return;const h=g.getBoundingClientRect(),x=C.clientX-h.left,m=C.clientY-h.top;t.current.targetX=x,t.current.targetY=m},[f]),y=v.useCallback(C=>{if(f!=="click")return;const g=e.current;if(!g)return;const h=g.getBoundingClientRect();t.current.targetX=C.clientX-h.left,t.current.targetY=C.clientY-h.top},[f]),S=v.useCallback(()=>{t.current=Ef(Ol/2,Nl/2),s.current=-1},[]),P=v.useCallback(()=>{const C=t.current;for(const g of C.vertices){const h=g.homeOffset.x,x=g.homeOffset.y;g.homeOffset.x=x,g.homeOffset.y=-h}},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-2: Blob Follows Cursor"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Testing two-layer architecture: render follows data"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Ol,height:Nl,onMouseMove:p,onClick:y,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"crosshair"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:i.jsxs("span",{children:["FPS: ",a]})}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>d("cursor"),style:{flex:1,padding:"8px",backgroundColor:f==="cursor"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Follow Cursor"}),i.jsx("button",{onClick:()=>d("click"),style:{flex:1,padding:"8px",backgroundColor:f==="click"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Click Target"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Home Stiffness: ",r.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.5",step:"0.01",value:r.homeStiffness,onChange:C=>o(g=>({...g,homeStiffness:parseFloat(C.target.value)}))}),i.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"Low = laggy/stretchy, High = snappy"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping: ",r.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.005",value:r.damping,onChange:C=>o(g=>({...g,damping:parseFloat(C.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Stiffness: ",r.stiffness]}),i.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:r.stiffness,onChange:C=>o(g=>({...g,stiffness:parseFloat(C.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Iterations: ",r.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:r.iterations,onChange:C=>o(g=>({...g,iterations:parseInt(C.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:l,onChange:C=>c(C.target.checked)}),i.jsx("span",{children:"Show Debug (target, ghost)"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:P,style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Rotate 90"}),i.jsx("button",{onClick:S,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]}),i.jsx("button",{onClick:()=>o(Tf),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Parameters"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-2 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Test two-layer architecture (data layer drives render layer)"}),i.jsx("li",{children:"Blob follows cursor/click target with springy physics"}),i.jsx("li",{children:"Slow moves = smooth follow"}),i.jsx("li",{children:"Fast/jump moves = overshoot, bounce, settle"}),i.jsx("li",{children:"Tune homeStiffness for responsive but physical feel"})]})]})]})}const $m={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.18},Fm=40,Dl=500,$l=400;function Af(e,t){const n=[],s=[],r=[],o=Fm,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=hp(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t,rotationCount:0}}function hp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function xp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Bm(e){let t=0;for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=n.pos.x-s,l=n.pos.y-r;t+=Math.sqrt(o*o+l*l)}return t/e.vertices.length}function zm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Gm(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Ym(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Hm(e,t){const n=hp(e.vertices);if(n<1)return;const s=e.restArea/n,r=xp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Wm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Um(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let a=0;a<r;a++){const u=t.targetX+s[a].homeOffset.x,f=t.targetY+s[a].homeOffset.y;a===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Wm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=xp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n)for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Xm(){const e=v.useRef(null),t=v.useRef(Af(Dl/2,$l/2)),n=v.useRef(0),s=v.useRef(-1),r=v.useRef(0),[o,l]=v.useState($m),[c,a]=v.useState(!0),[u,f]=v.useState(0),[d,p]=v.useState(0),[y,S]=v.useState(0),[P,C]=v.useState(!1),[g,h]=v.useState(500),[x,m]=v.useState(0);v.useEffect(()=>{const k=e.current;if(!k)return;const w=k.getContext("2d");if(!w)return;let T=0,_=performance.now();const L=V=>{T++,V-_>1e3&&(f(T),T=0,_=V);const q=t.current;if(P&&V-r.current>g){for(const U of q.vertices){const J=U.homeOffset.x,G=U.homeOffset.y;U.homeOffset.x=G,U.homeOffset.y=-J}q.rotationCount++,S(q.rotationCount),r.current=V}if(s.current>=0){const U=Math.min((V-s.current)/1e3,.033);zm(q,U,o),Gm(q,o);for(let J=0;J<o.iterations;J++)Ym(q,o),Hm(q,o)}s.current=V;const Q=Bm(q);p(Q),Q>x&&m(Q),w.fillStyle="#2c3e50",w.fillRect(0,0,k.width,k.height),Um(w,q,c);const A=150,Z=20,ce=10,Y=k.height-30;w.fillStyle="#34495e",w.fillRect(ce,Y,A,Z);const K=Math.min(Q/50,1),$=K<.3?"#27ae60":K<.7?"#f39c12":"#e74c3c";w.fillStyle=$,w.fillRect(ce,Y,A*K,Z),w.strokeStyle="#fff",w.strokeRect(ce,Y,A,Z),w.fillStyle="#fff",w.font="12px system-ui",w.fillText(`Deviation: ${Q.toFixed(1)}px`,ce+5,Y+14),n.current=requestAnimationFrame(L)};return n.current=requestAnimationFrame(L),()=>cancelAnimationFrame(n.current)},[o,c,P,g,x]);const j=v.useCallback(()=>{const k=t.current;for(const w of k.vertices){const T=w.homeOffset.x,_=w.homeOffset.y;w.homeOffset.x=_,w.homeOffset.y=-T}k.rotationCount++,S(k.rotationCount)},[]),R=v.useCallback(()=>{t.current=Af(Dl/2,$l/2),s.current=-1,S(0),m(0)},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-3: Rotation Stress Test"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Spam rotate - does lag accumulate?"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Dl,height:$l,style:{border:"2px solid #34495e",borderRadius:"8px"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",u]}),i.jsxs("span",{children:["Rotations: ",y]})]}),i.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c3e50",borderRadius:"4px",textAlign:"center"},children:[i.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[d.toFixed(1),"px"]}),i.jsx("div",{style:{fontSize:"12px",opacity:.7},children:"Current Deviation"}),i.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"5px"},children:["Peak: ",x.toFixed(1),"px"]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("button",{onClick:j,style:{padding:"15px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"18px",fontWeight:"bold"},children:"ROTATE 90"}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:P,onChange:k=>C(k.target.checked)}),i.jsx("span",{children:"Auto-rotate"})]}),i.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:g,onChange:k=>h(parseInt(k.target.value)),style:{flex:1},disabled:!P}),i.jsxs("span",{style:{fontSize:"12px",width:"50px"},children:[g,"ms"]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Home Stiffness: ",o.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.005",value:o.homeStiffness,onChange:k=>l(w=>({...w,homeStiffness:parseFloat(k.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping: ",o.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:o.damping,onChange:k=>l(w=>({...w,damping:parseFloat(k.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:c,onChange:k=>a(k.target.checked)}),i.jsx("span",{children:"Show Debug"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>m(0),style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Peak"}),i.jsx("button",{onClick:R,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset All"})]})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-3 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Spam rotate button - observe deviation meter"}),i.jsx("li",{children:"Enable auto-rotate at various speeds"}),i.jsx("li",{children:"Watch for lag accumulation (peak deviation climbing)"}),i.jsx("li",{children:"Target: deviation stays bounded, recovers between rotations"}),i.jsx("li",{children:"Success = peak deviation stays under ~40px even with spam"})]})]})]})}const yp=30,bo=600,Mo=450,Vm={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.05,attractionRadius:yp,attractionRestLength:0,attractionStiffness:.02,breakDistance:60};function Nr(e,t,n,s){const r=[],o=[],l=[],c=[],a=yp;let u,f,d,p;const y=1.5,S=.3;s==="T"?(u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],p=[y,y,y,y,y,S,y,y,S,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]],d=[{center:{x:-1*a,y:-.5*a},vertices:[0,1,9]},{center:{x:0*a,y:-.5*a},vertices:[1,2,5,8]},{center:{x:1*a,y:-.5*a},vertices:[2,3,4,5]},{center:{x:0*a,y:.5*a},vertices:[5,6,7,8]}]):(u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],p=[y,y,S,S,y,y,y,y,y,y,y,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]],d=[{center:{x:-1*a,y:-.5*a},vertices:[0,1,2,11]},{center:{x:1*a,y:-.5*a},vertices:[3,4,5,6]},{center:{x:-1*a,y:.5*a},vertices:[9,10,11,2]},{center:{x:0*a,y:.5*a},vertices:[2,3,8,9]},{center:{x:1*a,y:.5*a},vertices:[3,6,7,8]}]);for(let g=0;g<u.length;g++){const h=u[g];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:p[g]})}const P=r.length;for(let g=0;g<P;g++){const h=(g+1)%P,x=r[h].pos.x-r[g].pos.x,m=r[h].pos.y-r[g].pos.y,j=Math.sqrt(x*x+m*m);o.push({a:g,b:h,restLength:j})}for(const[g,h]of f)if(g<P&&h<P){const x=r[h].pos.x-r[g].pos.x,m=r[h].pos.y-r[g].pos.y,j=Math.sqrt(x*x+m*m);l.push({a:g,b:h,restLength:j})}const C=gp(r);for(const g of d)c.push({center:g.center,vertexIndices:g.vertices});return{vertices:r,ringsprings:o,crossSprings:l,restArea:C,targetX:e,targetY:t,color:n,blocks:c}}function gp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function Ba(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function qm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Zm(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Km(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Qm(e,t){const n=gp(e.vertices);if(n<1)return;const s=e.restArea/n,r=Ba(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function _f(e,t){return{x:e.targetX+t.center.x,y:e.targetY+t.center.y}}function Jm(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.breakDistance&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];for(const u of c.blocks)for(const f of a.blocks){const d=_f(c,u),p=_f(a,f),y=p.x-d.x,S=p.y-d.y;if(Math.sqrt(y*y+S*S)<n.attractionRadius*4)for(const C of u.vertexIndices)for(const g of f.vertexIndices){const h=`${o}-${C}-${l}-${g}`;if(r.has(h))continue;const x=c.vertices[C],m=a.vertices[g],j=m.pos.x-x.pos.x,R=m.pos.y-x.pos.y,k=Math.sqrt(j*j+R*R),w=n.attractionRadius*x.attractionRadius,T=n.attractionRadius*m.attractionRadius,_=w+T;k<_&&(s.push({blobA:o,vertA:C,blobB:l,vertB:g,restLength:n.attractionRestLength}),r.add(h))}}}return s}function ev(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),P=(f-o.restLength)*y*.5,C=a/f*P,g=u/f*P;l.pos.x+=C,l.pos.y+=g,c.pos.x-=C,c.pos.y-=g}}function tv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function nv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=tv(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=Ba(s),c=e.createRadialGradient(l.x-15,l.y-15,0,l.x,l.y,60);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=2,e.stroke(),n)for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function sv(e,t,n){e.strokeStyle="#f39c12",e.lineWidth=2,e.setLineDash([4,4]);for(const s of n){const r=t[s.blobA].vertices[s.vertA],o=t[s.blobB].vertices[s.vertB];e.beginPath(),e.moveTo(r.pos.x,r.pos.y),e.lineTo(o.pos.x,o.pos.y),e.stroke()}e.setLineDash([])}function ov(){const e=v.useRef(null),t=v.useRef([Nr(bo/3,Mo/2,"#27ae60","T"),Nr(bo*2/3,Mo/2,"#27ae60","U")]),n=v.useRef([]),s=v.useRef(0),r=v.useRef(-1),o=v.useRef(null),[l,c]=v.useState(Vm),[a,u]=v.useState(!0),[f,d]=v.useState(0),[p,y]=v.useState(0);v.useEffect(()=>{const x=e.current;if(!x)return;const m=x.getContext("2d");if(!m)return;let j=0,R=performance.now();const k=w=>{j++,w-R>1e3&&(d(j),j=0,R=w);const T=t.current;if(r.current>=0){const _=Math.min((w-r.current)/1e3,.033);n.current=Jm(T,n.current,l),y(n.current.length);for(let L=0;L<T.length;L++){const V=T[L];qm(V,_,l);const q=L===0?{...l,homeStiffness:.3}:l;Zm(V,q);for(let Q=0;Q<l.iterations;Q++)Km(V,l),Qm(V,l)}ev(T,n.current,l)}if(r.current=w,m.fillStyle="#2c3e50",m.fillRect(0,0,x.width,x.height),a){m.lineWidth=1;for(const _ of T)for(const L of _.vertices){const V=l.attractionRadius*L.attractionRadius,q=L.attractionRadius>1;m.strokeStyle=q?"rgba(243, 156, 18, 0.3)":"rgba(52, 152, 219, 0.3)",m.beginPath(),m.arc(L.pos.x,L.pos.y,V,0,Math.PI*2),m.stroke()}}a&&sv(m,T,n.current);for(const _ of T)nv(m,_,a);m.fillStyle="rgba(255,255,255,0.5)",m.font="12px system-ui",m.fillText("Drag blobs to test attraction",10,20),s.current=requestAnimationFrame(k)};return s.current=requestAnimationFrame(k),()=>cancelAnimationFrame(s.current)},[l,a]);const S=v.useCallback(x=>{const m=e.current;if(!m)return;const j=m.getBoundingClientRect(),R=m.width/j.width,k=m.height/j.height,w=(x.clientX-j.left)*R,T=(x.clientY-j.top)*k,_=t.current[1],L=Ba(_.vertices),V=w-L.x,q=T-L.y;Math.sqrt(V*V+q*q)<150&&(o.current={blobIndex:1,offsetX:_.targetX-w,offsetY:_.targetY-T})},[]),P=v.useCallback(x=>{if(!o.current)return;const m=e.current;if(!m)return;const j=m.getBoundingClientRect(),R=m.width/j.width,k=m.height/j.height,w=(x.clientX-j.left)*R,T=(x.clientY-j.top)*k,_=t.current[o.current.blobIndex];_.targetX=w+o.current.offsetX,_.targetY=T+o.current.offsetY},[]),C=v.useCallback(()=>{o.current=null},[]),g=v.useCallback(()=>{t.current=[Nr(bo/3,Mo/2,"#27ae60","T"),Nr(bo*2/3,Mo/2,"#27ae60","U")],n.current=[],r.current=-1},[]),h=v.useCallback(x=>{const m=t.current[x];for(const j of m.vertices){const R=j.homeOffset.x,k=j.homeOffset.y;j.homeOffset.x=k,j.homeOffset.y=-R}for(const j of m.blocks){const R=j.center.x,k=j.center.y;j.center.x=k,j.center.y=-R}},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-4: Two Blobs Attraction"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:'Do vertex springs create the "reaching" effect?'}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:bo,height:Mo,onMouseDown:S,onMouseMove:P,onMouseUp:C,onMouseLeave:C,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"grab"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"280px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",f]}),i.jsxs("span",{children:["Springs: ",p]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("div",{style:{fontWeight:"bold",color:"#f39c12"},children:"Attraction Settings"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Attraction Radius: ",l.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:l.attractionRadius,onChange:x=>c(m=>({...m,attractionRadius:parseInt(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Rest Length: ",l.attractionRestLength,"px"]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:l.attractionRestLength,onChange:x=>c(m=>({...m,attractionRestLength:parseInt(x.target.value)}))}),i.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"0 = vertices touch"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Attraction Stiffness: ",l.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.1",step:"0.005",value:l.attractionStiffness,onChange:x=>c(m=>({...m,attractionStiffness:parseFloat(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Break Distance: ",l.breakDistance,"px"]}),i.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:l.breakDistance,onChange:x=>c(m=>({...m,breakDistance:parseInt(x.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("div",{style:{fontWeight:"bold",color:"#3498db"},children:"Blob Physics"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Home Stiffness: ",l.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.01",value:l.homeStiffness,onChange:x=>c(m=>({...m,homeStiffness:parseFloat(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Damping: ",l.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:l.damping,onChange:x=>c(m=>({...m,damping:parseFloat(x.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:a,onChange:x=>u(x.target.checked)}),i.jsx("span",{children:"Show Debug (springs, radius)"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>h(0),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate T"}),i.jsx("button",{onClick:()=>h(1),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate U"})]}),i.jsx("button",{onClick:g,style:{padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"860px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-4 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:'Drag blobs close together - watch for "reaching" effect'}),i.jsx("li",{children:"Vertices should stretch toward each other before touching"}),i.jsx("li",{children:"Orange dashed lines = attraction springs forming"}),i.jsx("li",{children:"Drag apart - springs should break cleanly"}),i.jsx("li",{children:"Success = gummy/stretchy feel, NOT magnetic snap"})]})]})]})}const mp=30,rv=600,iv=450,lv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08},Fl={none:{enabled:!1,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6},subtle:{enabled:!0,stdDeviation:10,alphaMultiplier:20,alphaOffset:-8},medium:{enabled:!0,stdDeviation:15,alphaMultiplier:24,alphaOffset:-7},aggressive:{enabled:!0,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6}};function cv(e,t){const n=[],s=[],r=mp*.45,o=8,l=12,c=[{x:-r,y:-r},{x:r,y:-r},{x:r,y:r},{x:-r,y:r}];for(let u=0;u<4;u++){const f=c[u],d={x:-Math.sign(f.x),y:-Math.sign(f.y)},p=f.x+d.x*o,y=f.y,S=f.x,P=f.y+d.y*o;u===0?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):u===1?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1}):u===2?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1})}for(let u=0;u<l;u++){const f=(u+1)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:f,restLength:Math.sqrt(d*d+p*p)})}for(let u=0;u<l/2;u++){const f=(u+l/2)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:Math.floor(f),restLength:Math.sqrt(d*d+p*p)})}let a=0;for(let u=0;u<l;u++){const f=(u+1)%l;a+=n[u].homeOffset.x*n[f].homeOffset.y,a-=n[f].homeOffset.x*n[u].homeOffset.y}return{vertices:n,springs:s,restArea:Math.abs(a)/2,centerOffset:{x:e,y:t}}}function If(e,t,n,s){const r=[],o=mp;let l;n==="T"?l=[{x:-o,y:-o*.5},{x:0,y:-o*.5},{x:o,y:-o*.5},{x:0,y:o*.5}]:l=[{x:-o,y:-o*.5},{x:o,y:-o*.5},{x:-o,y:o*.5},{x:0,y:o*.5},{x:o,y:o*.5}];for(const a of l){const u=cv(a.x,a.y);r.push(u)}const c={blocks:r,targetX:e,targetY:t,rotation:0,color:s};return av(c),c}function Li(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function av(e){for(const t of e.blocks){const n=Li(t.centerOffset.x,t.centerOffset.y,e.rotation),s=e.targetX+n.x,r=e.targetY+n.y;for(const o of t.vertices){const l=Li(o.homeOffset.x,o.homeOffset.y,e.rotation),c=s+l.x,a=r+l.y;o.pos.x===0&&o.pos.y===0&&(o.pos={x:c,y:a},o.oldPos={x:c,y:a})}}}function uv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function fv(e,t,n){const s=Li(t.centerOffset.x,t.centerOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of t.vertices){const c=Li(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*n.homeStiffness,l.pos.y+=d*n.homeStiffness}}function dv(e,t){for(const n of e.springs){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function pv(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const u=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[u].pos.y,s-=e.vertices[u].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;let l=0,c=0;for(const a of e.vertices)l+=a.pos.x,c+=a.pos.y;l/=n,c/=n;for(const a of e.vertices){const u=a.pos.x-l,f=a.pos.y-c,d=Math.sqrt(u*u+f*f);d>1e-4&&(a.pos.x+=u/d*o,a.pos.y+=f/d*o)}}function hv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function xv(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],c=n[(r+1)%t],a=n[(r+2)%t],{cp1:u,cp2:f}=hv(o,l,c,a);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`}return s+" Z"}function yv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef(null),o=v.useRef({x:0,y:0}),[l]=v.useState(lv),[c,a]=v.useState(Fl.aggressive),[u,f]=v.useState("aggressive"),[,d]=v.useState({});v.useEffect(()=>{const h=[If(180,250,"T","#e74c3c"),If(380,250,"U","#e74c3c")];s.current=h},[]),v.useEffect(()=>{let h=!0;const x=m=>{if(h){n.current=m,h=!1,t.current=requestAnimationFrame(x);return}const j=Math.min((m-n.current)/1e3,.033);n.current=m;for(const R of s.current)for(const k of R.blocks){uv(k,l,j),fv(R,k,l);for(let w=0;w<l.iterations;w++)dv(k,l);pv(k,l)}d({}),t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[l]);const p=v.useCallback(h=>{const x=e.current;if(!x)return;const m=x.getBoundingClientRect(),j=h.clientX-m.left,R=h.clientY-m.top;for(let k=0;k<s.current.length;k++){const w=s.current[k],T=j-w.targetX,_=R-w.targetY;if(T*T+_*_<80*80){r.current=k,o.current={x:T,y:_},h.target.setPointerCapture(h.pointerId);break}}},[]),y=v.useCallback(h=>{if(r.current===null)return;const x=e.current;if(!x)return;const m=x.getBoundingClientRect(),j=h.clientX-m.left-o.current.x,R=h.clientY-m.top-o.current.y;s.current[r.current].targetX=j,s.current[r.current].targetY=R},[]),S=v.useCallback(()=>{r.current=null},[]),P=h=>{const x=s.current[h];x.rotation=(x.rotation+90)%360},C=h=>{const x=Fl[h];x&&(a(x),f(h))},g=()=>{const{alphaMultiplier:h,alphaOffset:x}=c;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${h} ${x}`};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5: Goo Filter Variations"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Drag pieces to overlap. Use Rotate buttons. Both pieces are same color for merge test."}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Fl).map(h=>i.jsx("button",{onClick:()=>C(h),style:{padding:"8px 16px",background:u===h?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:u===h?"bold":"normal"},children:h.charAt(0).toUpperCase()+h.slice(1)},h))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",c.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:c.stdDeviation,onChange:h=>{a(x=>({...x,stdDeviation:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",c.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:c.alphaMultiplier,onChange:h=>{a(x=>({...x,alphaMultiplier:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",c.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:c.alphaOffset,onChange:h=>{a(x=>({...x,alphaOffset:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:c.enabled,onChange:h=>{a(x=>({...x,enabled:h.target.checked})),f(h.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>P(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>P(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"})]})]}),i.jsxs("svg",{ref:e,width:rv,height:iv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:p,onPointerMove:y,onPointerUp:S,onPointerLeave:S,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:c.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:g(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:180,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T-tetromino"}),i.jsx("text",{x:380,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U-pentomino"}),i.jsx("g",{filter:c.enabled?"url(#goo-filter)":void 0,children:s.current.map((h,x)=>h.blocks.map((m,j)=>i.jsx("path",{d:xv(m.vertices),fill:h.color,stroke:h.color,strokeWidth:2},`${x}-${j}`)))}),s.current.map((h,x)=>i.jsx("circle",{cx:h.targetX,cy:h.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${x}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Goal:"})," Find filter settings where blocks within a piece merge smoothly, AND where two pieces overlap their blocks also merge into one membrane.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test:"})," Drag the T into the U's alcove. Rotate pieces. Watch how blocks merge visually."]})]})}const gv=30,mv=600,vv=450,Sv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25},Bl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function zl(e,t,n,s){const r=[],o=[],l=[],c=gv;let a,u;const f=1.5,d=.3,p=1;let y;if(n==="T")a=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],y=[f,p,p,f,p,d,f,f,d,p],u=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")a=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],y=[f,f,d,d,f,f,p,f,p,p,f,p],u=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else{const g=.08*c;a=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-g,y:-.5*c},{x:-g,y:-.5*c+g},{x:-.5*c,y:-.5*c+g},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+g},{x:g,y:-.5*c+g},{x:g,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+g,y:-.5*c},{x:.5*c+g,y:-.5*c-g},{x:-.5*c-g,y:-.5*c-g},{x:-.5*c-g,y:-.5*c},{x:-1.5*c,y:-.5*c}],y=[f,p,f,d,d,f,f,f,f,d,d,f,p,f,f,d,d,d,d,p],u=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}for(let g=0;g<a.length;g++){const h=a[g];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:y[g]})}const S=r.length;for(let g=0;g<S;g++){const h=(g+1)%S,x=r[h].homeOffset.x-r[g].homeOffset.x,m=r[h].homeOffset.y-r[g].homeOffset.y;o.push({a:g,b:h,restLength:Math.sqrt(x*x+m*m)})}for(const[g,h]of u){const x=r[h].homeOffset.x-r[g].homeOffset.x,m=r[h].homeOffset.y-r[g].homeOffset.y;l.push({a:g,b:h,restLength:Math.sqrt(x*x+m*m)})}let P=0;for(let g=0;g<S;g++){const h=(g+1)%S;P+=r[g].homeOffset.x*r[h].homeOffset.y,P-=r[h].homeOffset.x*r[g].homeOffset.y}const C=Math.abs(P)/2;return{vertices:r,ringsprings:o,crossSprings:l,restArea:C,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Cv(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function kv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function wv(e,t){for(const n of e.vertices){const s=Cv(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}}function jv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Pv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function Rv(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],C=`${o}-${p}-${l}-${y}`;if(r.has(C))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,j=n.attractionRadius*P.attractionRadius,R=m+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(C))}}return s}function bv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,P=a/f*S*y,C=u/f*S*y;l.pos.x+=P,l.pos.y+=C,c.pos.x-=P,c.pos.y-=C}}function Mv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Tv(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],c=n[(r+1)%t],a=n[(r+2)%t],{cp1:u,cp2:f}=Mv(o,l,c,a);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`}return s+" Z"}function Ev(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Sv),[u,f]=v.useState(Bl.medium),[d,p]=v.useState("medium"),[y,S]=v.useState(!1),[,P]=v.useState({});v.useEffect(()=>{const R=[zl(120,250,"T","#e74c3c"),zl(300,250,"U","#e74c3c"),zl(480,250,"Corrupt","#e74c3c")];s.current=R},[]),v.useEffect(()=>{let R=!0;const k=w=>{if(R){n.current=w,R=!1,t.current=requestAnimationFrame(k);return}const T=Math.min((w-n.current)/1e3,.033);n.current=w;for(const _ of s.current){kv(_,c,T),wv(_,c);for(let L=0;L<c.iterations;L++)jv(_,c);_.usePressure&&Pv(_,c)}r.current=Rv(s.current,r.current,c),bv(s.current,r.current,c),P({}),t.current=requestAnimationFrame(k)};return t.current=requestAnimationFrame(k),()=>cancelAnimationFrame(t.current)},[c]);const C=v.useCallback(R=>{const k=e.current;if(!k)return;const w=k.getBoundingClientRect(),T=R.clientX-w.left,_=R.clientY-w.top;for(let L=0;L<s.current.length;L++){const V=s.current[L],q=T-V.targetX,Q=_-V.targetY;if(q*q+Q*Q<80*80){o.current=L,l.current={x:q,y:Q},R.target.setPointerCapture(R.pointerId);break}}},[]),g=v.useCallback(R=>{if(o.current===null)return;const k=e.current;if(!k)return;const w=k.getBoundingClientRect(),T=R.clientX-w.left-l.current.x,_=R.clientY-w.top-l.current.y;s.current[o.current].targetX=T,s.current[o.current].targetY=_},[]),h=v.useCallback(()=>{o.current=null},[]),x=R=>{s.current[R].rotation=(s.current[R].rotation+90)%360},m=R=>{const k=Bl[R];k&&(f(k),p(R))},j=()=>{const{alphaMultiplier:R,alphaOffset:k}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${R} ${k}`};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5b: Single Perimeter Shapes"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Each shape is ONE continuous soft body (not composed of blocks). Same color for merge test."}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Bl).map(R=>i.jsx("button",{onClick:()=>m(R),style:{padding:"8px 16px",background:d===R?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===R?"bold":"normal"},children:R.charAt(0).toUpperCase()+R.slice(1)},R))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",u.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:R=>{f(k=>({...k,stdDeviation:Number(R.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:R=>{f(k=>({...k,alphaMultiplier:Number(R.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:R=>{f(k=>({...k,alphaOffset:Number(R.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:u.enabled,onChange:R=>{f(k=>({...k,enabled:R.target.checked})),p(R.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:R=>a(k=>({...k,goopiness:Number(R.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance (mozzarella)"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:R=>a(k=>({...k,attractionRadius:Number(R.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How close to connect"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:R=>a(k=>({...k,attractionStiffness:Number(R.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Pull force (10%-100%)"})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:y,onChange:R=>S(R.target.checked)}),i.jsx("span",{children:"Show Springs"})]})]}),i.jsxs("svg",{ref:e,width:mv,height:vv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:C,onPointerMove:g,onPointerUp:h,onPointerLeave:h,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-5b",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:u.enabled?"url(#goo-filter-5b)":void 0,children:[r.current.map((R,k)=>{var $,U;const w=($=s.current[R.blobA])==null?void 0:$.vertices[R.vertA],T=(U=s.current[R.blobB])==null?void 0:U.vertices[R.vertB];if(!w||!T)return null;const _=T.pos.x-w.pos.x,L=T.pos.y-w.pos.y,V=Math.sqrt(_*_+L*L),q=Math.min(1,V/c.goopiness),Q=8,A=4,Z=Q-(Q-A)*q,ce=Z*1.5,Y=Math.max(2,Math.ceil(V/ce)),K=[];for(let J=0;J<=Y;J++){const G=J/Y,pe=1-.3*Math.sin(G*Math.PI),we=Z*pe;K.push({cx:w.pos.x+_*G,cy:w.pos.y+L*G,r:Math.max(A*.5,we)})}return i.jsx("g",{children:K.map((J,G)=>i.jsx("circle",{cx:J.cx,cy:J.cy,r:J.r,fill:"#e74c3c"},G))},`tendril-${k}`)}),s.current.map((R,k)=>i.jsx("path",{d:Tv(R.vertices),fill:R.color,stroke:R.color,strokeWidth:2},k))]}),y&&r.current.map((R,k)=>{var Z,ce;const w=(Z=s.current[R.blobA])==null?void 0:Z.vertices[R.vertA],T=(ce=s.current[R.blobB])==null?void 0:ce.vertices[R.vertB];if(!w||!T)return null;const _=T.pos.x-w.pos.x,L=T.pos.y-w.pos.y,q=Math.sqrt(_*_+L*L)/c.goopiness,Q=Math.min(255,Math.floor(q*255)),A=Math.max(0,255-Math.floor(q*255));return i.jsx("line",{x1:w.pos.x,y1:w.pos.y,x2:T.pos.x,y2:T.pos.y,stroke:`rgb(${Q},${A},100)`,strokeWidth:2,opacity:.7},`spring-${k}`)}),s.current.map((R,k)=>i.jsx("circle",{cx:R.targetX,cy:R.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${k}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-5b + Attraction:"}),' Single-perimeter shapes with physics-based attraction springs. When pieces get close, springs form. Pull them apart to see the "mozzarella pull" effect  they stretch until breaking at the Goopiness distance.',i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Goopiness:"}),' Controls how far the "mozzarella strings" stretch before snapping. Higher = longer stretchy connections when pulling apart.',i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Stiffness Ramp:"})," Attraction is weak (10%) at max distance (reaching effect) and strong (100%) when close (solid merge). This creates natural-looking goop behavior.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test:"})," Drag T into U's notch, let them merge, then slowly pull apart to see the stretching effect."]})]})}const Av=30,_v=600,Iv=450,Lv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Gl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function Yl(e,t,n,s){const r=[],o=[],l=[],c=[],a=Av;let u,f;const d=1.5,p=.3,y=1;let S;if(n==="T")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],S=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],S=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*a;u=[{x:-1.5*a,y:-1.5*a},{x:-.5*a,y:-1.5*a},{x:-.5*a,y:-.5*a},{x:-x,y:-.5*a},{x:-x,y:-.5*a+x},{x:-.5*a,y:-.5*a+x},{x:-.5*a,y:1.5*a},{x:.5*a,y:1.5*a},{x:.5*a,y:-.5*a+x},{x,y:-.5*a+x},{x,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:-1.5*a},{x:1.5*a,y:-1.5*a},{x:1.5*a,y:-.5*a},{x:.5*a+x,y:-.5*a},{x:.5*a+x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a},{x:-1.5*a,y:-.5*a}],S=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*a,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:.5*a},{x:-.5*a,y:.5*a}],S=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a}],S=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const m=u[x];r.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y},mass:1,attractionRadius:S[x]}),o.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y}})}const P=r.length;for(let x=0;x<P;x++){const m=(x+1)%P,j=r[m].homeOffset.x-r[x].homeOffset.x,R=r[m].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:m,restLength:Math.sqrt(j*j+R*R)})}for(const[x,m]of f){const j=r[m].homeOffset.x-r[x].homeOffset.x,R=r[m].homeOffset.y-r[x].homeOffset.y;c.push({a:x,b:m,restLength:Math.sqrt(j*j+R*R)})}let C=0;for(let x=0;x<P;x++){const m=(x+1)%P;C+=r[x].homeOffset.x*r[m].homeOffset.y,C-=r[m].homeOffset.x*r[x].homeOffset.y}const g=Math.abs(C)/2;let h;if(n==="Corrupt"){const x=.5*a;h=[{offsetX:-a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-a},{x,y:-a},{x,y:a},{x:-x,y:a}],outerVertexIndices:[5,8,7,6]}].map(j=>{const R=j.points.map(k=>{const w=e+j.offsetX+k.x,T=t+j.offsetY+k.y;return{pos:{x:w,y:T},oldPos:{x:w,y:T},homeOffset:{x:k.x,y:k.y}}});return{...j,vertices:R,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:c,restArea:g,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Dr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Ov(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function Nv(e,t){for(const n of e.vertices){const s=Dr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}for(const n of e.innerVertices){const s=Dr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=c*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Dr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const c=Dr(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function Dv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function $v(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function Fv(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],C=`${o}-${p}-${l}-${y}`;if(r.has(C))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,j=n.attractionRadius*P.attractionRadius,R=m+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(C))}}return s}function Bv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,P=a/f*S*y,C=u/f*S*y;l.pos.x+=P,l.pos.y+=C,c.pos.x-=P,c.pos.y-=C}}function zv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Wc(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=zv(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function Gv(e){return Wc(e.map(t=>t.pos))}function Lf(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,C=f/y,g=d/S,h=p/S,x=-C,m=P,j=-h,R=g;let k=x+j,w=m+R;const T=Math.sqrt(k*k+w*w);T<.001?(k=x,w=m):(k/=T,w/=T);const _=P*g+C*h,L=Math.sqrt((1+_)/2),V=L>.1?1/L:10,q=s[o]*.4,Q=Math.min(t,q);r.push({x:c.x+k*Q*Math.min(V,3),y:c.y+w*Q*Math.min(V,3)})}return r}function Yv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Lv),[u,f]=v.useState(Gl.medium),[d,p]=v.useState("medium"),[y,S]=v.useState(!1),[,P]=v.useState({});v.useEffect(()=>{const k=[Yl(120,250,"T","#e74c3c"),Yl(300,250,"U","#e74c3c"),Yl(480,250,"Corrupt","#e74c3c")];s.current=k},[]),v.useEffect(()=>{let k=!0;const w=T=>{if(k){n.current=T,k=!1,t.current=requestAnimationFrame(w);return}const _=Math.min((T-n.current)/1e3,.033);n.current=T;for(const L of s.current){Ov(L,c,_),Nv(L,c);for(let V=0;V<c.iterations;V++)Dv(L,c);L.usePressure&&$v(L,c)}r.current=Fv(s.current,r.current,c),Bv(s.current,r.current,c),P({}),t.current=requestAnimationFrame(w)};return t.current=requestAnimationFrame(w),()=>cancelAnimationFrame(t.current)},[c]);const C=v.useCallback(k=>{const w=e.current;if(!w)return;const T=w.getBoundingClientRect(),_=k.clientX-T.left,L=k.clientY-T.top;for(let V=0;V<s.current.length;V++){const q=s.current[V],Q=_-q.targetX,A=L-q.targetY;if(Q*Q+A*A<80*80){o.current=V,l.current={x:Q,y:A},k.target.setPointerCapture(k.pointerId);break}}},[]),g=v.useCallback(k=>{if(o.current===null)return;const w=e.current;if(!w)return;const T=w.getBoundingClientRect(),_=k.clientX-T.left-l.current.x,L=k.clientY-T.top-l.current.y;s.current[o.current].targetX=_,s.current[o.current].targetY=L},[]),h=v.useCallback(()=>{o.current=null},[]),x=k=>{s.current[k].rotation=(s.current[k].rotation+90)%360},m=k=>{const w=Gl[k];w&&(f(w),p(k))},j=()=>{const{alphaMultiplier:k,alphaOffset:w}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${k} ${w}`},R="#2c3e50";return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5c: Cell Wall (Outer - Inner)"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Outer gooey silhouette + stable inner core = visible cell wall ring"}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Gl).map(k=>i.jsx("button",{onClick:()=>m(k),style:{padding:"8px 16px",background:d===k?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===k?"bold":"normal"},children:k.charAt(0).toUpperCase()+k.slice(1)},k))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",u.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:k=>{f(w=>({...w,stdDeviation:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:k=>{f(w=>({...w,alphaMultiplier:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:k=>{f(w=>({...w,alphaOffset:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:u.enabled,onChange:k=>{f(w=>({...w,enabled:k.target.checked})),p(k.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",c.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:c.innerHomeStiffness,onChange:k=>a(w=>({...w,innerHomeStiffness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:k=>a(w=>({...w,goopiness:Number(k.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:k=>a(w=>({...w,attractionRadius:Number(k.target.value)})),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:k=>a(w=>({...w,attractionStiffness:Number(k.target.value)})),style:{width:100}})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:y,onChange:k=>S(k.target.checked)}),i.jsx("span",{children:"Show Springs"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",c.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:c.tendrilEndRadius,onChange:k=>a(w=>({...w,tendrilEndRadius:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",c.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:c.tendrilSkinniness,onChange:k=>a(w=>({...w,tendrilSkinniness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",c.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:c.wallThickness,onChange:k=>a(w=>({...w,wallThickness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),i.jsxs("svg",{ref:e,width:_v,height:Iv,style:{background:R,borderRadius:8,cursor:"grab"},onPointerDown:C,onPointerMove:g,onPointerUp:h,onPointerLeave:h,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-5c",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:u.enabled?"url(#goo-filter-5c)":void 0,children:[r.current.map((k,w)=>{var G,pe;const T=(G=s.current[k.blobA])==null?void 0:G.vertices[k.vertA],_=(pe=s.current[k.blobB])==null?void 0:pe.vertices[k.vertB];if(!T||!_)return null;const L=_.pos.x-T.pos.x,V=_.pos.y-T.pos.y,q=Math.sqrt(L*L+V*V),Q=Math.min(1,q/c.goopiness),A=c.tendrilEndRadius,Z=1-c.tendrilSkinniness,ce=1-c.tendrilSkinniness*.3,Y=ce-(ce-Z)*Q,K=A*Y,$=A*1.4,U=Math.max(2,Math.ceil(q/$)),J=[];for(let we=0;we<=U;we++){const O=we/U,H=Math.sin(O*Math.PI),me=A-(A-K)*H;J.push({cx:T.pos.x+L*O,cy:T.pos.y+V*O,r:Math.max(2,me)})}return i.jsx("g",{children:J.map((we,O)=>i.jsx("circle",{cx:we.cx,cy:we.cy,r:we.r,fill:"#e74c3c"},O))},`tendril-${w}`)}),s.current.map((k,w)=>i.jsx("path",{d:Gv(k.vertices),fill:k.color,stroke:k.color,strokeWidth:2},w))]}),s.current.map((k,w)=>{if(k.innerRegions)return k.innerRegions.map((T,_)=>{let L;T.outerVertexIndices?L=T.outerVertexIndices.map(q=>k.vertices[q].pos):L=T.vertices.map(q=>q.pos);const V=Lf(L,c.wallThickness);return i.jsx("path",{d:Wc(V),fill:R},`inner-${w}-${_}`)});{const T=k.vertices.map(L=>L.pos),_=Lf(T,c.wallThickness);return i.jsx("path",{d:Wc(_),fill:R},`inner-${w}`)}}),y&&r.current.map((k,w)=>{var ce,Y;const T=(ce=s.current[k.blobA])==null?void 0:ce.vertices[k.vertA],_=(Y=s.current[k.blobB])==null?void 0:Y.vertices[k.vertB];if(!T||!_)return null;const L=_.pos.x-T.pos.x,V=_.pos.y-T.pos.y,Q=Math.sqrt(L*L+V*V)/c.goopiness,A=Math.min(255,Math.floor(Q*255)),Z=Math.max(0,255-Math.floor(Q*255));return i.jsx("line",{x1:T.pos.x,y1:T.pos.y,x2:_.pos.x,y2:_.pos.y,stroke:`rgb(${A},${Z},100)`,strokeWidth:2,opacity:.7},`spring-${w}`)}),s.current.map((k,w)=>i.jsx("circle",{cx:k.targetX,cy:k.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${w}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-5c: Cell Wall Model"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Two layers:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Outer"})," (gooey): Stretches, merges with filter effect",i.jsx("br",{})," ",i.jsx("strong",{children:"Inner"})," (stable): Barely moves, cuts out the center",i.jsx("br",{})," ",i.jsx("strong",{children:"Cell Wall"}),": The visible ring between them",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Inner Stiffness:"})," Controls how stable the core is (higher = more rigid)",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Next:"})," Dynamic rebuilding when pieces lock (merge walls) or become loose goop (amputate)"]})]})}const Hv=30,Wv=600,Uv=450,Xv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Hl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},Vv={autoFill:!0,fillRate:.15},Of=1.15,qv=200;function Wl(e,t,n,s){const r=[],o=[],l=[],c=[],a=Hv;let u,f;const d=1.5,p=.3,y=1;let S;if(n==="T")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],S=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],S=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*a;u=[{x:-1.5*a,y:-1.5*a},{x:-.5*a,y:-1.5*a},{x:-.5*a,y:-.5*a},{x:-x,y:-.5*a},{x:-x,y:-.5*a+x},{x:-.5*a,y:-.5*a+x},{x:-.5*a,y:1.5*a},{x:.5*a,y:1.5*a},{x:.5*a,y:-.5*a+x},{x,y:-.5*a+x},{x,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:-1.5*a},{x:1.5*a,y:-1.5*a},{x:1.5*a,y:-.5*a},{x:.5*a+x,y:-.5*a},{x:.5*a+x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a},{x:-1.5*a,y:-.5*a}],S=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*a,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:.5*a},{x:-.5*a,y:.5*a}],S=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a}],S=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const m=u[x];r.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y},mass:1,attractionRadius:S[x]}),o.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y}})}const P=r.length;for(let x=0;x<P;x++){const m=(x+1)%P,j=r[m].homeOffset.x-r[x].homeOffset.x,R=r[m].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:m,restLength:Math.sqrt(j*j+R*R)})}for(const[x,m]of f){const j=r[m].homeOffset.x-r[x].homeOffset.x,R=r[m].homeOffset.y-r[x].homeOffset.y;c.push({a:x,b:m,restLength:Math.sqrt(j*j+R*R)})}let C=0;for(let x=0;x<P;x++){const m=(x+1)%P;C+=r[x].homeOffset.x*r[m].homeOffset.y,C-=r[m].homeOffset.x*r[x].homeOffset.y}const g=Math.abs(C)/2;let h;if(n==="Corrupt"){const x=.5*a;h=[{offsetX:-a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-a},{x,y:-a},{x,y:a},{x:-x,y:a}],outerVertexIndices:[5,8,7,6]}].map(j=>{const R=j.points.map(k=>{const w=e+j.offsetX+k.x,T=t+j.offsetY+k.y;return{pos:{x:w,y:T},oldPos:{x:w,y:T},homeOffset:{x:k.x,y:k.y}}});return{...j,vertices:R,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:c,restArea:g,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt",fillAmount:0,isShaking:!1,boopScale:1,wasFullLastFrame:!1}}function $r(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Zv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function Kv(e,t){for(const n of e.vertices){const s=$r(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}for(const n of e.innerVertices){const s=$r(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=c*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=$r(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const c=$r(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function Qv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Jv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function e2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],C=`${o}-${p}-${l}-${y}`;if(r.has(C))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,j=n.attractionRadius*P.attractionRadius,R=m+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(C))}}return s}function t2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,P=a/f*S*y,C=u/f*S*y;l.pos.x+=P,l.pos.y+=C,c.pos.x-=P,c.pos.y-=C}}function n2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function vp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=n2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function s2(e){return vp(e.map(t=>t.pos))}function Nf(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,C=f/y,g=d/S,h=p/S,x=-C,m=P,j=-h,R=g;let k=x+j,w=m+R;const T=Math.sqrt(k*k+w*w);T<.001?(k=x,w=m):(k/=T,w/=T);const _=P*g+C*h,L=Math.sqrt((1+_)/2),V=L>.1?1/L:10,q=s[o]*.4,Q=Math.min(t,q);r.push({x:c.x+k*Q*Math.min(V,3),y:c.y+w*Q*Math.min(V,3)})}return r}function o2(){var V,q,Q;const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Xv),[u,f]=v.useState(Vv),[d,p]=v.useState(Hl.medium),[y,S]=v.useState("medium"),[P,C]=v.useState(!1),[,g]=v.useState({});v.useEffect(()=>{const A=[Wl(120,250,"T","#e74c3c"),Wl(300,250,"U","#e74c3c"),Wl(480,250,"Corrupt","#e74c3c")];s.current=A},[]),v.useEffect(()=>{let A=!0;const Z=ce=>{if(A){n.current=ce,A=!1,t.current=requestAnimationFrame(Z);return}const Y=Math.min((ce-n.current)/1e3,.033);n.current=ce;for(const K of s.current){Zv(K,c,Y),Kv(K,c);for(let U=0;U<c.iterations;U++)Qv(K,c);K.usePressure&&Jv(K,c),u.autoFill&&K.fillAmount<1&&(K.fillAmount=Math.min(1,K.fillAmount+u.fillRate*Y));const $=K.fillAmount>=1;if($&&!K.wasFullLastFrame&&(K.boopScale=Of),K.wasFullLastFrame=$,K.boopScale>1){const U=(Of-1)/(qv/1e3);K.boopScale=Math.max(1,K.boopScale-U*Y)}}r.current=e2(s.current,r.current,c),t2(s.current,r.current,c),g({}),t.current=requestAnimationFrame(Z)};return t.current=requestAnimationFrame(Z),()=>cancelAnimationFrame(t.current)},[c,u]);const h=v.useCallback(A=>{const Z=e.current;if(!Z)return;const ce=Z.getBoundingClientRect(),Y=A.clientX-ce.left,K=A.clientY-ce.top;for(let $=0;$<s.current.length;$++){const U=s.current[$],J=Y-U.targetX,G=K-U.targetY;if(J*J+G*G<80*80){U.fillAmount<1&&(U.isShaking=!0,setTimeout(()=>{U.isShaking=!1,g({})},300)),o.current=$,l.current={x:J,y:G},A.target.setPointerCapture(A.pointerId);break}}},[]),x=v.useCallback(A=>{if(o.current===null)return;const Z=e.current;if(!Z)return;const ce=Z.getBoundingClientRect(),Y=A.clientX-ce.left-l.current.x,K=A.clientY-ce.top-l.current.y;s.current[o.current].targetX=Y,s.current[o.current].targetY=K},[]),m=v.useCallback(()=>{o.current=null},[]),j=A=>{s.current[A].rotation=(s.current[A].rotation+90)%360},R=()=>{for(const A of s.current)A.fillAmount=0,A.wasFullLastFrame=!1,A.boopScale=1},k=A=>{const Z=Hl[A];Z&&(p(Z),S(A))},w=()=>{const{alphaMultiplier:A,alphaOffset:Z}=d;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${A} ${Z}`},T="#2c3e50",_=A=>{let Z=1/0,ce=-1/0,Y=1/0,K=-1/0;for(const $ of A)$.x<Z&&(Z=$.x),$.x>ce&&(ce=$.x),$.y<Y&&(Y=$.y),$.y>K&&(K=$.y);return{minX:Z,maxX:ce,minY:Y,maxY:K}},L=`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  `;return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("style",{children:L}),i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-6: Fill / Pour"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:'Goop fills the cell wall container over time  visual "time to pop" mechanic'}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Hl).map(A=>i.jsx("button",{onClick:()=>k(A),style:{padding:"8px 16px",background:y===A?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:y===A?"bold":"normal"},children:A.charAt(0).toUpperCase()+A.slice(1)},A))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:"bold"},children:[i.jsx("input",{type:"checkbox",checked:u.autoFill,onChange:A=>f(Z=>({...Z,autoFill:A.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Fill Rate: ",u.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:u.fillRate,onChange:A=>f(Z=>({...Z,fillRate:Number(A.target.value)})),style:{width:120}})]}),i.jsx("button",{onClick:R,style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Fill"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:12},children:[i.jsxs("span",{children:["T: ",Math.round(((V=s.current[0])==null?void 0:V.fillAmount)*100||0),"%"]}),i.jsxs("span",{children:["U: ",Math.round(((q=s.current[1])==null?void 0:q.fillAmount)*100||0),"%"]}),i.jsxs("span",{children:["C: ",Math.round(((Q=s.current[2])==null?void 0:Q.fillAmount)*100||0),"%"]})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",d.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:d.stdDeviation,onChange:A=>{p(Z=>({...Z,stdDeviation:Number(A.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",d.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:d.alphaMultiplier,onChange:A=>{p(Z=>({...Z,alphaMultiplier:Number(A.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",d.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:d.alphaOffset,onChange:A=>{p(Z=>({...Z,alphaOffset:Number(A.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:d.enabled,onChange:A=>{p(Z=>({...Z,enabled:A.target.checked})),S(A.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>j(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>j(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>j(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",c.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:c.innerHomeStiffness,onChange:A=>a(Z=>({...Z,innerHomeStiffness:Number(A.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:A=>a(Z=>({...Z,goopiness:Number(A.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:A=>a(Z=>({...Z,attractionRadius:Number(A.target.value)})),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:A=>a(Z=>({...Z,attractionStiffness:Number(A.target.value)})),style:{width:100}})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:P,onChange:A=>C(A.target.checked)}),i.jsx("span",{children:"Show Springs"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",c.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:c.tendrilEndRadius,onChange:A=>a(Z=>({...Z,tendrilEndRadius:Number(A.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",c.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:c.tendrilSkinniness,onChange:A=>a(Z=>({...Z,tendrilSkinniness:Number(A.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",c.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:c.wallThickness,onChange:A=>a(Z=>({...Z,wallThickness:Number(A.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),i.jsxs("svg",{ref:e,width:Wv,height:Uv,style:{background:T,borderRadius:8,cursor:"grab"},onPointerDown:h,onPointerMove:x,onPointerUp:m,onPointerLeave:m,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-6",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:d.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:w(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:d.enabled?"url(#goo-filter-6)":void 0,children:[r.current.map((A,Z)=>{var oe,Ce;const ce=(oe=s.current[A.blobA])==null?void 0:oe.vertices[A.vertA],Y=(Ce=s.current[A.blobB])==null?void 0:Ce.vertices[A.vertB];if(!ce||!Y)return null;const K=Y.pos.x-ce.pos.x,$=Y.pos.y-ce.pos.y,U=Math.sqrt(K*K+$*$),J=Math.min(1,U/c.goopiness),G=c.tendrilEndRadius,pe=1-c.tendrilSkinniness,we=1-c.tendrilSkinniness*.3,O=we-(we-pe)*J,H=G*O,me=G*1.4,ue=Math.max(2,Math.ceil(U/me)),Se=[];for(let ee=0;ee<=ue;ee++){const je=ee/ue,xe=Math.sin(je*Math.PI),Me=G-(G-H)*xe;Se.push({cx:ce.pos.x+K*je,cy:ce.pos.y+$*je,r:Math.max(2,Me)})}return i.jsx("g",{children:Se.map((ee,je)=>i.jsx("circle",{cx:ee.cx,cy:ee.cy,r:ee.r,fill:"#e74c3c"},je))},`tendril-${Z}`)}),s.current.map((A,Z)=>{const ce=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0;return i.jsx("g",{transform:ce,style:A.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,children:i.jsx("path",{d:s2(A.vertices),fill:A.color,stroke:A.color,strokeWidth:2})},Z)})]}),s.current.map((A,Z)=>{const ce=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0,Y=A.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,K=($,U)=>{const J=_($),G=J.maxY-J.minY,pe=J.maxY-G*A.fillAmount,we=50;return A.fillAmount>=1?null:i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:U,children:i.jsx("rect",{x:J.minX-we,y:J.minY-we,width:J.maxX-J.minX+we*2,height:pe-J.minY+we})})}),i.jsx("path",{d:vp($),fill:T,clipPath:`url(#${U})`})]},U)};if(A.innerRegions)return i.jsx("g",{transform:ce,style:Y,children:A.innerRegions.map(($,U)=>{let J;$.outerVertexIndices?J=$.outerVertexIndices.map(pe=>A.vertices[pe].pos):J=$.vertices.map(pe=>pe.pos);const G=Nf(J,c.wallThickness);return K(G,`unfilled-clip-${Z}-${U}`)})},`inner-group-${Z}`);{const $=A.vertices.map(J=>J.pos),U=Nf($,c.wallThickness);return i.jsx("g",{transform:ce,style:Y,children:K(U,`unfilled-clip-${Z}`)},`inner-group-${Z}`)}}),P&&r.current.map((A,Z)=>{var we,O;const ce=(we=s.current[A.blobA])==null?void 0:we.vertices[A.vertA],Y=(O=s.current[A.blobB])==null?void 0:O.vertices[A.vertB];if(!ce||!Y)return null;const K=Y.pos.x-ce.pos.x,$=Y.pos.y-ce.pos.y,J=Math.sqrt(K*K+$*$)/c.goopiness,G=Math.min(255,Math.floor(J*255)),pe=Math.max(0,255-Math.floor(J*255));return i.jsx("line",{x1:ce.pos.x,y1:ce.pos.y,x2:Y.pos.x,y2:Y.pos.y,stroke:`rgb(${G},${pe},100)`,strokeWidth:2,opacity:.7},`spring-${Z}`)}),s.current.map((A,Z)=>i.jsx("circle",{cx:A.targetX,cy:A.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${Z}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-6: Fill / Pour"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"New mechanics:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Fill Amount"}),": Each blob has 0-100% fill level (same color as outer goop)",i.jsx("br",{})," ",i.jsx("strong",{children:"Auto-Fill"}),": Fill rises over time (adjustable rate)",i.jsx("br",{})," ",i.jsx("strong",{children:"Shake on early click"}),": Click before 100% and the goop shakes",i.jsx("br",{})," ",i.jsx("strong",{children:"Boop at 100%"}),": Scale pulse from center when fill completes",i.jsx("br",{})," ",i.jsx("strong",{children:"Reset"}),": Empty all containers to start over",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Game implication:"})," Player must clear goop before it fills to 100% (pop!)",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Next:"})," Proto-7 (Pop)  what happens when fill reaches 100%?"]})]})}const jn=6,rt=8,gt=50,Dn=50,$n=50,r2=jn*gt+Dn*2,i2=rt*gt+$n*2,l2={damping:.97,stiffness:1,pressure:5,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Ul={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},c2={autoFill:!0,fillRate:.15},Df=1.15,a2=200,u2=200,Fr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function f2(e,t){return{x:Dn+(e+.5)*gt,y:$n+(t+.5)*gt}}function si(e,t){return{x:Dn+e*gt,y:$n+t*gt}}function Oi(e){let t=0,n=0;for(const s of e){const r=f2(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function d2(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function p2(e){if(e.length===0)return[];const t=new Map;for(const l of e){const c=`${l.x1},${l.y1}`,a=`${l.x2},${l.y2}`;t.has(c)||t.set(c,[]),t.has(a)||t.set(a,[]),t.get(c).push(l),t.get(a).push(l)}const n=new Set,s=[];let r=e[0],o={x:r.x1,y:r.y1};for(;n.size<e.length;){n.add(r),s.push(si(o.x,o.y));const l=o.x===r.x1&&o.y===r.y1?{x:r.x2,y:r.y2}:{x:r.x1,y:r.y1},c=`${l.x},${l.y}`,u=(t.get(c)||[]).find(f=>!n.has(f));if(!u)break;r=u,o=l}return s}let Sp=0;function Br(e,t,n){const s=`blob-${Sp++}`,r=d2(e),o=p2(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const C=Oi(e),g=gt*.4;o.push({x:C.x-g,y:C.y-g},{x:C.x+g,y:C.y-g},{x:C.x+g,y:C.y+g},{x:C.x-g,y:C.y+g})}const l=Oi(e),c=o.map(C=>({pos:{x:C.x,y:C.y},oldPos:{x:C.x,y:C.y},homeOffset:{x:C.x-l.x,y:C.y-l.y},mass:1,attractionRadius:1})),a=o.map(C=>({pos:{x:C.x,y:C.y},oldPos:{x:C.x,y:C.y},homeOffset:{x:C.x-l.x,y:C.y-l.y}})),u=[],f=c.length;for(let C=0;C<f;C++){const g=(C+1)%f,h=c[g].homeOffset.x-c[C].homeOffset.x,x=c[g].homeOffset.y-c[C].homeOffset.y;u.push({a:C,b:g,restLength:Math.sqrt(h*h+x*x)})}const d=[],p=gt*1.5,y=new Set;for(let C=0;C<f;C++)for(let g=C+2;g<f;g++){if(g===f-1&&C===0)continue;const h=c[g].homeOffset.x-c[C].homeOffset.x,x=c[g].homeOffset.y-c[C].homeOffset.y,m=Math.sqrt(h*h+x*x);if(m<p){const j=`${Math.min(C,g)}-${Math.max(C,g)}`;y.has(j)||(y.add(j),d.push({a:C,b:g,restLength:m}))}}let S=0;for(let C=0;C<f;C++){const g=(C+1)%f;S+=c[C].homeOffset.x*c[g].homeOffset.y,S-=c[g].homeOffset.x*c[C].homeOffset.y}const P=Math.abs(S)/2;return{id:s,vertices:c,innerVertices:a,ringsprings:u,crossSprings:d,restArea:P,targetX:l.x,targetY:l.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,boopScale:1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function h2(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const c of n){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const c of s){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const x2={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function $f(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function y2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function g2(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=$f(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=$f(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function m2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function v2(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function S2(e){const t=Dn,n=Dn+jn*gt,s=$n,r=$n+rt*gt,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function C2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],C=`${o}-${p}-${l}-${y}`;if(r.has(C))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,j=n.attractionRadius*P.attractionRadius,R=m+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(C))}}return s}function k2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),P=s+S*(r-s),C=p-o.restLength,g=f/p*C*P,h=d/p*C*P;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function w2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Cp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=w2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function j2(e){return Cp(e.map(t=>t.pos))}function P2(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,C=f/y,g=d/S,h=p/S,x=-C,m=P,j=-h,R=g;let k=x+j,w=m+R;const T=Math.sqrt(k*k+w*w);T<.001?(k=x,w=m):(k/=T,w/=T);const _=P*g+C*h,L=Math.sqrt((1+_)/2),V=L>.1?1/L:10,q=s[o]*.4,Q=Math.min(t,q);r.push({x:c.x+k*Q*Math.min(V,3),y:c.y+w*Q*Math.min(V,3)})}return r}function R2(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(u2),[f,d]=v.useState(l2),[p,y]=v.useState(c2),[S,P]=v.useState(Ul.medium),[C,g]=v.useState("medium"),[h,x]=v.useState(!0),[m,j]=v.useState(Fr[0]),[R,k]=v.useState("T"),[,w]=v.useState({}),[T,_]=v.useState(5),[L,V]=v.useState(1.5),q=v.useRef(T),Q=v.useRef(L);q.current=T,Q.current=L,v.useEffect(()=>{const O=[];for(let Ce=0;Ce<rt;Ce++){O[Ce]=[];for(let ee=0;ee<jn;ee++)O[Ce][ee]=null}r.current=O;const H=[],me=[{x:0,y:rt-1},{x:1,y:rt-1},{x:2,y:rt-1},{x:1,y:rt-2}],ue=Br(me,Fr[0],!0);H.push(ue);for(const Ce of me)O[Ce.y][Ce.x]={blobId:ue.id,color:ue.color};const Se=[{x:4,y:rt-1},{x:5,y:rt-1},{x:4,y:rt-2},{x:5,y:rt-2}],oe=Br(Se,Fr[1],!0);H.push(oe);for(const Ce of Se)O[Ce.y][Ce.x]={blobId:oe.id,color:oe.color};s.current=H},[]),v.useEffect(()=>{let O=!0;const H=me=>{var Se,oe,Ce;if(O){n.current=me,O=!1,t.current=requestAnimationFrame(H);return}const ue=Math.min((me-n.current)/1e3,.033);n.current=me;for(const ee of s.current){y2(ee,f,ue),g2(ee,f);for(let xe=0;xe<f.iterations;xe++)m2(ee,f);ee.usePressure&&v2(ee,f),S2(ee),ee.isLocked&&p.autoFill&&ee.fillAmount<1&&(ee.fillAmount=Math.min(1,ee.fillAmount+p.fillRate*ue));const je=ee.fillAmount>=1;if(je&&!ee.wasFullLastFrame&&(ee.boopScale=Df),ee.wasFullLastFrame=je,ee.boopScale>1){const xe=(Df-1)/(a2/1e3);ee.boopScale=Math.max(1,ee.boopScale-xe*ue)}}if(l.current!==null){const ee=s.current[l.current];if(ee&&!ee.isLocked){let je=rt-1;for(const W of ee.gridCells){let M=W.y;for(;M<rt-1;){const I=M+1,F=(Se=r.current[I])==null?void 0:Se[W.x];if(F&&F.blobId!==ee.id)break;M=I}M-W.y+ee.gridCells[0].y;const B=M-W.y;W.y+B-W.y<je-ee.gridCells[0].y}let xe=rt;for(const W of ee.gridCells){let M=0;for(;W.y+M+1<rt;){const B=W.y+M+1,de=(oe=r.current[B])==null?void 0:oe[W.x];if(de&&de.blobId!==ee.id)break;M++}xe=Math.min(xe,M)}const Me=xe*gt,Oe=a*ue,Ne=Math.min(ee.visualOffsetY+Oe,Me);for(ee.visualOffsetY=Ne;ee.visualOffsetY>=gt;){for(const W of ee.gridCells)W.y+=1;ee.visualOffsetY-=gt}const Fe=Oi(ee.gridCells);ee.targetY=Fe.y+ee.visualOffsetY;let $e=!0;for(const W of ee.gridCells){const M=W.y+1;if(M>=rt){$e=!1;break}const B=(Ce=r.current[M])==null?void 0:Ce[W.x];if(B&&B.blobId!==ee.id){$e=!1;break}}!$e&&ee.visualOffsetY<.1&&(ee.visualOffsetY=0,ee.targetY=Fe.y,c.current=!0)}}o.current=C2(s.current,o.current,f),k2(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,Y()),w({}),t.current=requestAnimationFrame(H)};return t.current=requestAnimationFrame(H),()=>cancelAnimationFrame(t.current)},[f,p,a]);const A=v.useCallback((O,H)=>{var me;return H<0||H>=rt||O<0||O>=jn?!0:((me=r.current[H])==null?void 0:me[O])!==null},[]),Z=v.useCallback((O,H)=>{const me=new Set,ue=r.current;for(const Se of O){const oe=[{x:Se.x-1,y:Se.y},{x:Se.x+1,y:Se.y},{x:Se.x,y:Se.y-1},{x:Se.x,y:Se.y+1}];for(const Ce of oe)if(Ce.y>=0&&Ce.y<rt&&Ce.x>=0&&Ce.x<jn){const ee=ue[Ce.y][Ce.x];ee&&ee.color===H&&me.add(ee.blobId)}}return me},[]),ce=v.useCallback(O=>{var oe,Ce,ee;const H=q.current,me=Q.current,ue=[];for(const je of O.gridCells){const xe=je.y+1;xe<rt&&((oe=r.current[xe])!=null&&oe[je.x])&&ue.push(si(je.x+.5,je.y+1)),je.x>0&&((Ce=r.current[je.y])!=null&&Ce[je.x-1])&&ue.push(si(je.x,je.y+.5)),je.x<jn-1&&((ee=r.current[je.y])!=null&&ee[je.x+1])&&ue.push(si(je.x+1,je.y+.5))}if(ue.length===0)return;const Se=gt*me;for(const je of s.current)if(je.id!==O.id){for(const xe of je.vertices){let Me=1/0,Oe=null;for(const Ne of ue){const Fe=xe.pos.x-Ne.x,$e=xe.pos.y-Ne.y,W=Math.sqrt(Fe*Fe+$e*$e);W<Me&&(Me=W,Oe=Ne)}if(Me<Se&&Oe){const Ne=1-Me/Se,Fe=H*Ne*Ne,$e=(xe.pos.x-Oe.x)/(Me+.1),W=(xe.pos.y-Oe.y)/(Me+.1);xe.oldPos.x-=$e*Fe,xe.oldPos.y-=W*Fe*.5}}for(const xe of je.innerVertices){let Me=1/0,Oe=null;for(const Ne of ue){const Fe=xe.pos.x-Ne.x,$e=xe.pos.y-Ne.y,W=Math.sqrt(Fe*Fe+$e*$e);W<Me&&(Me=W,Oe=Ne)}if(Me<Se&&Oe){const Ne=1-Me/Se,Fe=H*Ne*Ne*.3,$e=(xe.pos.x-Oe.x)/(Me+.1),W=(xe.pos.y-Oe.y)/(Me+.1);xe.oldPos.x-=$e*Fe,xe.oldPos.y-=W*Fe*.5}}}},[]),Y=v.useCallback(()=>{if(l.current===null)return;const O=s.current[l.current];if(!O)return;ce(O),O.visualOffsetY=0;const H=Oi(O.gridCells);O.targetY=H.y;const me=Z(O.gridCells,O.color);if(me.size>0){const ue=[...O.gridCells],Se=[O],oe=[O.id];for(const ee of me){const je=s.current.find(xe=>xe.id===ee);je&&(ue.push(...je.gridCells),Se.push(je),oe.push(ee))}const Ce=Br(ue,O.color,!0);h2(Ce,Se);for(const ee of ue)r.current[ee.y][ee.x]={blobId:Ce.id,color:Ce.color};s.current=s.current.filter(ee=>!oe.includes(ee.id)),s.current.push(Ce),console.log(`Merged ${oe.length} blobs into one with ${ue.length} cells`)}else{O.isLocked=!0,O.fillAmount=0,O.wasFullLastFrame=!1;for(const ue of O.gridCells)r.current[ue.y][ue.x]={blobId:O.id,color:O.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[Z,ce]),K=v.useCallback(()=>{if(l.current!==null)return;const O=x2[R],H=Math.floor((jn-4)/2),me=0,ue=O.map(oe=>({x:oe.x+H,y:oe.y+me}));for(const oe of ue)if(A(oe.x,oe.y)){console.log("Cannot spawn - space occupied");return}const Se=Br(ue,m,!1);Se.visualOffsetY=0,s.current.push(Se),l.current=s.current.length-1},[R,m,A]),$=v.useCallback(()=>{var H;if(l.current===null)return;const O=s.current[l.current];if(O){for(;;){let me=!0;for(const ue of O.gridCells){const Se=ue.y+1;if(Se>=rt){me=!1;break}const oe=(H=r.current[Se])==null?void 0:H[ue.x];if(oe&&oe.blobId!==O.id){me=!1;break}}if(!me)break;for(const ue of O.gridCells)ue.y+=1}O.visualOffsetY=0,Y()}},[Y]),U=v.useCallback(()=>{l.current=null,c.current=!1;for(let O=0;O<rt;O++)for(let H=0;H<jn;H++)r.current[O][H]=null;s.current=[],Sp=0,o.current=[]},[]),J=O=>{const H=Ul[O];H&&(P(H),g(O))},G=()=>{const{alphaMultiplier:O,alphaOffset:H}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${O} ${H}`},pe="#2c3e50",we=O=>{let H=1/0,me=-1/0,ue=1/0,Se=-1/0;for(const oe of O)oe.x<H&&(H=oe.x),oe.x>me&&(me=oe.x),oe.y<ue&&(ue=oe.y),oe.y>Se&&(Se=oe.y);return{minX:H,maxX:me,minY:ue,maxY:Se}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-7: Merge"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Dynamic blob generation when pieces lock  same-color merge with unified fill layer"}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Fr.map((O,H)=>i.jsx("button",{onClick:()=>j(O),style:{width:30,height:30,background:O,border:m===O?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},O)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(O=>i.jsx("button",{onClick:()=>k(O),style:{padding:"6px 12px",background:R===O?"#fff":"#2c3e50",color:R===O?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:O},O))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:K,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:$,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:U,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:O=>x(O.target.checked)}),i.jsx("span",{children:"Show Grid"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Ul).map(O=>i.jsx("button",{onClick:()=>J(O),style:{padding:"6px 12px",background:C===O?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:C===O?"bold":"normal",fontSize:12},children:O.charAt(0).toUpperCase()+O.slice(1)},O))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:O=>y(H=>({...H,fillRate:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:O=>u(Number(O.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:O=>d(H=>({...H,wallThickness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:O=>y(H=>({...H,autoFill:O.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:O=>d(H=>({...H,damping:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:O=>d(H=>({...H,stiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:f.pressure,onChange:O=>d(H=>({...H,pressure:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:O=>d(H=>({...H,homeStiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:O=>d(H=>({...H,innerHomeStiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:O=>d(H=>({...H,returnSpeed:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:O=>d(H=>({...H,viscosity:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:O=>d(H=>({...H,iterations:Number(O.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",T]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:O=>_(Number(O.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",L.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:L,onChange:O=>V(Number(O.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:O=>d(H=>({...H,goopiness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:O=>d(H=>({...H,attractionRadius:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:O=>d(H=>({...H,attractionStiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:O=>d(H=>({...H,tendrilEndRadius:Number(O.target.value)})),style:{width:80}})]})]}),i.jsxs("svg",{ref:e,width:r2,height:i2,style:{background:pe,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:G(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:jn+1}).map((O,H)=>i.jsx("line",{x1:Dn+H*gt,y1:$n,x2:Dn+H*gt,y2:$n+rt*gt,stroke:"#fff",strokeWidth:1},`v${H}`)),Array.from({length:rt+1}).map((O,H)=>i.jsx("line",{x1:Dn,y1:$n+H*gt,x2:Dn+jn*gt,y2:$n+H*gt,stroke:"#fff",strokeWidth:1},`h${H}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((O,H)=>{const me=s.current[O.blobA],ue=s.current[O.blobB];if(!me||!ue)return null;const Se=me.vertices[O.vertA],oe=ue.vertices[O.vertB];if(!Se||!oe)return null;const Ce=oe.pos.x-Se.pos.x,ee=oe.pos.y-Se.pos.y,je=Math.sqrt(Ce*Ce+ee*ee),xe=Math.min(1,je/f.goopiness),Me=f.tendrilEndRadius,Oe=1-f.tendrilSkinniness,Ne=1-f.tendrilSkinniness*.3,Fe=Ne-(Ne-Oe)*xe,$e=Me*Fe,W=Me*1.4,M=Math.max(2,Math.ceil(je/W)),B=[];for(let de=0;de<=M;de++){const I=de/M,F=Math.sin(I*Math.PI),D=Me-(Me-$e)*F;B.push({cx:Se.pos.x+Ce*I,cy:Se.pos.y+ee*I,r:Math.max(2,D)})}return i.jsx("g",{children:B.map((de,I)=>i.jsx("circle",{cx:de.cx,cy:de.cy,r:de.r,fill:me.color},I))},`tendril-${H}`)}),s.current.map((O,H)=>{const me=O.boopScale!==1?`translate(${O.targetX}, ${O.targetY}) scale(${O.boopScale}) translate(${-O.targetX}, ${-O.targetY})`:void 0;return i.jsx("g",{transform:me,children:i.jsx("path",{d:j2(O.vertices),fill:O.color,stroke:O.color,strokeWidth:2})},O.id)})]}),s.current.map(O=>{if(!O.isLocked||O.fillAmount>=1)return null;const H=O.boopScale!==1?`translate(${O.targetX}, ${O.targetY}) scale(${O.boopScale}) translate(${-O.targetX}, ${-O.targetY})`:void 0,me=O.vertices.map(xe=>xe.pos),ue=P2(me,f.wallThickness),Se=we(ue),oe=Se.maxY-Se.minY,Ce=Se.maxY-oe*O.fillAmount,ee=50,je=`unfilled-clip-${O.id}`;return i.jsxs("g",{transform:H,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:je,children:i.jsx("rect",{x:Se.minX-ee,y:Se.minY-ee,width:Se.maxX-Se.minX+ee*2,height:Ce-Se.minY+ee})})}),i.jsx("path",{d:Cp(ue),fill:pe,clipPath:`url(#${je})`})]},`inner-${O.id}`)}),s.current.map((O,H)=>i.jsx("text",{x:O.targetX,y:O.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:O.isLocked?`${Math.round(O.fillAmount*100)}%`:"falling"},`info-${O.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-7: Merge"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test scenarios:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Same color adjacent"}),": Blobs merge into one, unified fill restarts",i.jsx("br",{})," ",i.jsx("strong",{children:"Different color"}),": No merge, just neighbors",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Current pieces:"})," ",s.current.length," blobs",i.jsx("br",{}),i.jsx("strong",{children:"Attraction springs:"})," ",o.current.length]})]})}const Pn=6,it=8,at=50,hn=50,xn=50,b2=Pn*at+hn*2,M2=it*at+xn*2,T2={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Xl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},E2={autoFill:!0,fillRate:.15},A2=4,_2=200,zr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function I2(e,t){return{x:hn+(e+.5)*at,y:xn+(t+.5)*at}}function oi(e,t){return{x:hn+e*at,y:xn+t*at}}function Ni(e){let t=0,n=0;for(const s of e){const r=I2(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function L2(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function O2(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(oi(c.x,c.y));const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(C=>!r.has(C));if(y.length===0)break;let S=y[0],P=1/0;for(const C of y){const g=n(C,u),h=s(a,g);(h>P||P===1/0)&&(P=h,S=C)}l=S,c=u}return o}let kp=0;function Gr(e,t,n){const s=`blob-${kp++}`,r=L2(e),o=O2(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Ni(e),x=at*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const c=Ni(e),a=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y}})),f=[],d=a.length;for(let h=0;h<d;h++){const x=(h+1)%d,m=a[x].homeOffset.x-a[h].homeOffset.x,j=a[x].homeOffset.y-a[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(m*m+j*j)})}const p=[],y=at*1.5,S=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const m=a[x].homeOffset.x-a[h].homeOffset.x,j=a[x].homeOffset.y-a[h].homeOffset.y,R=Math.sqrt(m*m+j*j);if(R<y){const k=`${Math.min(h,x)}-${Math.max(h,x)}`;S.has(k)||(S.add(k),p.push({a:h,b:x,restLength:R}))}}let P=0;for(let h=0;h<d;h++){const x=(h+1)%d;P+=a[h].homeOffset.x*a[x].homeOffset.y,P-=a[x].homeOffset.x*a[h].homeOffset.y}const C=P>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${P.toFixed(0)}, winding=${C}, cells=${e.length}`);const g=Math.abs(P)/2;return{id:s,vertices:a,innerVertices:u,ringsprings:f,crossSprings:p,restArea:g,targetX:c.x,targetY:c.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function N2(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const c of n){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const c of s){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const D2={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Ff(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function $2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function F2(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Ff(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Ff(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function B2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function z2(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,c=o.pos.y-s,a=Math.sqrt(l*l+c*c),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(a>1e-4&&u>1e-4){const d=(u-a)*r;o.pos.x+=l/a*d,o.pos.y+=c/a*d}}}function G2(e){const t=hn,n=hn+Pn*at,s=xn,r=xn+it*at,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function Y2(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color===a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>at*4))for(const p of c.vertices)for(const y of a.vertices){const S=y.pos.x-p.pos.x,P=y.pos.y-p.pos.y,C=Math.sqrt(S*S+P*P);if(C<20&&C>.01){const g=20-C,h=S/C,x=P/C,m=g*.8;p.pos.x-=h*m*.5,p.pos.y-=x*m*.5,y.pos.x+=h*m*.5,y.pos.y+=x*m*.5,p.oldPos.x-=h*m*.3,p.oldPos.y-=x*m*.3,y.oldPos.x+=h*m*.3,y.oldPos.y+=x*m*.3}}}}function H2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],C=`${o}-${p}-${l}-${y}`;if(r.has(C))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,j=n.attractionRadius*P.attractionRadius,R=m+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(C))}}return s}function W2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),P=s+S*(r-s),C=p-o.restLength,g=f/p*C*P,h=d/p*C*P;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function U2(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,c=n[(r+1)%s].pos,a=l.x-o.x,u=l.y-o.y,f=c.x-l.x,d=c.y-l.y,p=Math.sqrt(a*a+u*u)||1,y=Math.sqrt(f*f+d*d)||1,S=a/p,P=u/p,C=f/y,g=d/y,h=P,x=-S,m=g,j=-C;let R=h+m,k=x+j;const w=Math.sqrt(R*R+k*k)||1;R/=w,k/=w,n[r].oldPos.x-=R*t,n[r].oldPos.y-=k*t}}function X2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function wp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=X2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function V2(e){return wp(e.map(t=>t.pos))}function q2(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,C=f/y,g=d/S,h=p/S,x=-C,m=P,j=-h,R=g;let k=x+j,w=m+R;const T=Math.sqrt(k*k+w*w);T<.001?(k=x,w=m):(k/=T,w/=T);const _=P*g+C*h,L=Math.sqrt((1+_)/2),V=L>.1?1/L:10,q=s[o]*.4,Q=Math.min(t,q);r.push({x:c.x+k*Q*Math.min(V,3),y:c.y+w*Q*Math.min(V,3)})}return r}function Z2(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(_2),[f,d]=v.useState(T2),[p,y]=v.useState(E2),[S,P]=v.useState(Xl.medium),[C,g]=v.useState("medium"),[h,x]=v.useState(!0),[m,j]=v.useState(zr[0]),[R,k]=v.useState("T"),[,w]=v.useState({}),[T,_]=v.useState(5),[L,V]=v.useState(1.5),q=v.useRef(T),Q=v.useRef(L);q.current=T,Q.current=L;const A=v.useRef([]),Z=v.useRef(0),[ce,Y]=v.useState(12),[K,$]=v.useState(150),[U,J]=v.useState(1),[G,pe]=v.useState(8),[we,O]=v.useState(!1),H="proto8-dev-settings";v.useEffect(()=>{const M=localStorage.getItem(H);if(M)try{const B=JSON.parse(M);B.physics&&d(B.physics),B.fillParams&&y(B.fillParams),B.filterParams&&(P(B.filterParams),g("custom")),B.fallSpeed&&u(B.fallSpeed),B.impactStrength&&_(B.impactStrength),B.impactRadius&&V(B.impactRadius),B.dropletCount&&Y(B.dropletCount),B.dropletSpeed&&$(B.dropletSpeed),B.dropletLifetime&&J(B.dropletLifetime),B.dropletSize&&pe(B.dropletSize),console.log("Loaded dev settings from localStorage")}catch(B){console.warn("Failed to load dev settings:",B)}},[]),v.useEffect(()=>{const M=B=>{B.key==="`"&&(B.preventDefault(),O(de=>!de))};return window.addEventListener("keydown",M),()=>window.removeEventListener("keydown",M)},[]);const me=v.useCallback(()=>{const M={physics:f,fillParams:p,filterParams:S,fallSpeed:a,impactStrength:T,impactRadius:L,dropletCount:ce,dropletSpeed:K,dropletLifetime:U,dropletSize:G};localStorage.setItem(H,JSON.stringify(M)),console.log("Saved dev settings to localStorage")},[f,p,S,a,T,L,ce,K,U,G]),ue=v.useCallback(()=>{const M=[];for(let X=0;X<it;X++){M[X]=[];for(let ne=0;ne<Pn;ne++)M[X][ne]=null}r.current=M,kp=0;const B=[],de=[{x:0,y:it-1},{x:1,y:it-1},{x:2,y:it-1},{x:1,y:it-2}],I=Gr(de,zr[0],!0);B.push(I);for(const X of de)M[X.y][X.x]={blobId:I.id,color:I.color};const F=[{x:4,y:it-1},{x:5,y:it-1},{x:4,y:it-2},{x:5,y:it-2}],D=Gr(F,zr[1],!0);B.push(D);for(const X of F)M[X.y][X.x]={blobId:D.id,color:D.color};s.current=B,o.current=[],A.current=[],l.current=null,c.current=!1},[]);v.useEffect(()=>{ue()},[ue]),v.useEffect(()=>{let M=!0;const B=de=>{var ye,b,N;if(M){n.current=de,M=!1,t.current=requestAnimationFrame(B);return}const I=Math.min((de-n.current)/1e3,.033);n.current=de;for(const E of s.current){$2(E,f,I),F2(E,f);for(let z=0;z<f.iterations;z++)B2(E,f);E.usePressure&&z2(E,f),G2(E)}Y2(s.current);for(const E of s.current){E.isLocked&&p.autoFill&&E.fillAmount<1&&(E.fillAmount=Math.min(1,E.fillAmount+p.fillRate*I));const z=E.fillAmount>=1;z&&!E.wasFullLastFrame&&U2(E,A2),E.wasFullLastFrame=z}if(l.current!==null){const E=s.current[l.current];if(E&&!E.isLocked){let z=it-1;for(const Ee of E.gridCells){let Ie=Ee.y;for(;Ie<it-1;){const He=Ie+1,Ue=(ye=r.current[He])==null?void 0:ye[Ee.x];if(Ue&&Ue.blobId!==E.id)break;Ie=He}Ie-Ee.y+E.gridCells[0].y;const De=Ie-Ee.y;Ee.y+De-Ee.y<z-E.gridCells[0].y}let re=it;for(const Ee of E.gridCells){let Ie=0;for(;Ee.y+Ie+1<it;){const De=Ee.y+Ie+1,Pe=(b=r.current[De])==null?void 0:b[Ee.x];if(Pe&&Pe.blobId!==E.id)break;Ie++}re=Math.min(re,Ie)}const te=re*at,ie=a*I,ae=Math.min(E.visualOffsetY+ie,te);for(E.visualOffsetY=ae;E.visualOffsetY>=at;){for(const Ee of E.gridCells)Ee.y+=1;E.visualOffsetY-=at}const he=Ni(E.gridCells);E.targetY=he.y+E.visualOffsetY;let Ae=!0;for(const Ee of E.gridCells){const Ie=Ee.y+1;if(Ie>=it){Ae=!1;break}const De=(N=r.current[Ie])==null?void 0:N[Ee.x];if(De&&De.blobId!==E.id){Ae=!1;break}}!Ae&&E.visualOffsetY<.1&&(E.visualOffsetY=0,E.targetY=he.y,c.current=!0)}}o.current=H2(s.current,o.current,f),W2(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,je());const F=300,D=hn,X=hn+Pn*at,ne=xn,se=xn+it*at;for(const E of A.current)E.vel.y+=F*I,E.pos.x+=E.vel.x*I,E.pos.y+=E.vel.y*I,(E.pos.x+E.radius<D||E.pos.x-E.radius>X)&&(E.lifetime=0),E.pos.y+E.radius<ne&&(E.lifetime=0),E.pos.y+E.radius>se&&(E.pos.y=se-E.radius,E.vel.y*=-.3),E.lifetime-=I,E.opacity=Math.max(0,E.lifetime/E.maxLifetime),E.radius*=.995;A.current=A.current.filter(E=>E.lifetime>0&&E.opacity>.01),w({}),t.current=requestAnimationFrame(B)};return t.current=requestAnimationFrame(B),()=>cancelAnimationFrame(t.current)},[f,p,a]);const Se=v.useCallback((M,B)=>{var de;return B<0||B>=it||M<0||M>=Pn?!0:((de=r.current[B])==null?void 0:de[M])!==null},[]),oe=v.useCallback((M,B)=>{const de=new Set,I=r.current;for(const F of M){const D=[{x:F.x-1,y:F.y},{x:F.x+1,y:F.y},{x:F.x,y:F.y-1},{x:F.x,y:F.y+1}];for(const X of D)if(X.y>=0&&X.y<it&&X.x>=0&&X.x<Pn){const ne=I[X.y][X.x];ne&&ne.color===B&&de.add(ne.blobId)}}return de},[]),Ce=v.useCallback(M=>{var D,X,ne;const B=q.current,de=Q.current,I=[];for(const se of M.gridCells){const ye=se.y+1;ye<it&&((D=r.current[ye])!=null&&D[se.x])&&I.push(oi(se.x+.5,se.y+1)),se.x>0&&((X=r.current[se.y])!=null&&X[se.x-1])&&I.push(oi(se.x,se.y+.5)),se.x<Pn-1&&((ne=r.current[se.y])!=null&&ne[se.x+1])&&I.push(oi(se.x+1,se.y+.5))}if(I.length===0)return;const F=at*de;for(const se of s.current)if(se.id!==M.id){for(const ye of se.vertices){let b=1/0,N=null;for(const E of I){const z=ye.pos.x-E.x,re=ye.pos.y-E.y,te=Math.sqrt(z*z+re*re);te<b&&(b=te,N=E)}if(b<F&&N){const E=1-b/F,z=B*E*E,re=(ye.pos.x-N.x)/(b+.1),te=(ye.pos.y-N.y)/(b+.1);ye.oldPos.x-=re*z,ye.oldPos.y-=te*z*.5}}for(const ye of se.innerVertices){let b=1/0,N=null;for(const E of I){const z=ye.pos.x-E.x,re=ye.pos.y-E.y,te=Math.sqrt(z*z+re*re);te<b&&(b=te,N=E)}if(b<F&&N){const E=1-b/F,z=B*E*E*.3,re=(ye.pos.x-N.x)/(b+.1),te=(ye.pos.y-N.y)/(b+.1);ye.oldPos.x-=re*z,ye.oldPos.y-=te*z*.5}}}},[]),ee=v.useCallback(M=>{var I,F;const B=M.targetX,de=M.targetY;for(let D=0;D<ce;D++){const X=Math.floor(Math.random()*M.vertices.length),ne=M.vertices[X],se=ne.pos.x-B,ye=ne.pos.y-de,b=Math.atan2(ye,se)+(Math.random()-.5)*.8,N=K*(.5+Math.random()*.8),E={id:`droplet-${Z.current++}`,pos:{x:ne.pos.x,y:ne.pos.y},vel:{x:Math.cos(b)*N,y:Math.sin(b)*N-50},radius:G*(.5+Math.random()*.7),color:M.color,opacity:1,lifetime:U*(.7+Math.random()*.6),maxLifetime:U};A.current.push(E),console.log("Created droplet:",E.pos,E.radius,E.color)}for(const D of M.gridCells)((F=(I=r.current[D.y])==null?void 0:I[D.x])==null?void 0:F.blobId)===M.id&&(r.current[D.y][D.x]=null);s.current=s.current.filter(D=>D.id!==M.id),console.log(`Popped blob with ${M.gridCells.length} cells, spawned ${A.current.length} droplets total`)},[ce,K,U,G]),je=v.useCallback(()=>{if(l.current===null)return;const M=s.current[l.current];if(!M)return;Ce(M),M.visualOffsetY=0;const B=Ni(M.gridCells);M.targetY=B.y;const de=oe(M.gridCells,M.color);if(de.size>0){const I=[...M.gridCells],F=[M],D=[M.id];for(const ne of de){const se=s.current.find(ye=>ye.id===ne);se&&(I.push(...se.gridCells),F.push(se),D.push(ne))}const X=Gr(I,M.color,!0);N2(X,F);for(const ne of I)r.current[ne.y][ne.x]={blobId:X.id,color:X.color};s.current=s.current.filter(ne=>!D.includes(ne.id)),s.current.push(X),console.log(`Merged ${D.length} blobs into one with ${I.length} cells`)}else{M.isLocked=!0,M.fillAmount=0,M.wasFullLastFrame=!1;for(const I of M.gridCells)r.current[I.y][I.x]={blobId:M.id,color:M.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[oe,Ce]),xe=v.useCallback(()=>{if(l.current!==null)return;const M=D2[R],B=Math.floor((Pn-4)/2),de=0,I=M.map(D=>({x:D.x+B,y:D.y+de}));for(const D of I)if(Se(D.x,D.y)){console.log("Cannot spawn - space occupied");return}const F=Gr(I,m,!1);F.visualOffsetY=0,s.current.push(F),l.current=s.current.length-1},[R,m,Se]),Me=v.useCallback(()=>{var B;if(l.current===null)return;const M=s.current[l.current];if(M){for(;;){let de=!0;for(const I of M.gridCells){const F=I.y+1;if(F>=it){de=!1;break}const D=(B=r.current[F])==null?void 0:B[I.x];if(D&&D.blobId!==M.id){de=!1;break}}if(!de)break;for(const I of M.gridCells)I.y+=1}M.visualOffsetY=0,je()}},[je]),Oe=v.useCallback(()=>{ue()},[ue]),Ne=M=>{const B=Xl[M];B&&(P(B),g(M))},Fe=()=>{const{alphaMultiplier:M,alphaOffset:B}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${M} ${B}`},$e="#2c3e50",W=M=>{let B=1/0,de=-1/0,I=1/0,F=-1/0;for(const D of M)D.x<B&&(B=D.x),D.x>de&&(de=D.x),D.y<I&&(I=D.y),D.y>F&&(F=D.y);return{minX:B,maxX:de,minY:I,maxY:F}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-8: Pop"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Pop with residue  click filled blobs to pop them, droplets scatter and fade"}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),zr.map((M,B)=>i.jsx("button",{onClick:()=>j(M),style:{width:30,height:30,background:M,border:m===M?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},M)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(M=>i.jsx("button",{onClick:()=>k(M),style:{padding:"6px 12px",background:R===M?"#fff":"#2c3e50",color:R===M?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:M},M))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:xe,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:Me,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:Oe,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:M=>x(M.target.checked)}),i.jsx("span",{children:"Show Grid"})]}),i.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),we&&i.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[i.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),i.jsxs("div",{style:{display:"flex",gap:10},children:[i.jsx("button",{onClick:me,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),i.jsx("button",{onClick:()=>O(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Xl).map(M=>i.jsx("button",{onClick:()=>Ne(M),style:{padding:"6px 12px",background:C===M?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:C===M?"bold":"normal",fontSize:12},children:M.charAt(0).toUpperCase()+M.slice(1)},M))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:M=>y(B=>({...B,fillRate:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:M=>u(Number(M.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:M=>d(B=>({...B,wallThickness:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:M=>y(B=>({...B,autoFill:M.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:M=>d(B=>({...B,damping:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:M=>d(B=>({...B,stiffness:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:M=>d(B=>({...B,pressure:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:M=>d(B=>({...B,homeStiffness:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:M=>d(B=>({...B,innerHomeStiffness:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:M=>d(B=>({...B,returnSpeed:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:M=>d(B=>({...B,viscosity:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:M=>d(B=>({...B,iterations:Number(M.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",T]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:M=>_(Number(M.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",L.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:L,onChange:M=>V(Number(M.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Droplets: ",ce]}),i.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:ce,onChange:M=>Y(Number(M.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Speed: ",K]}),i.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:K,onChange:M=>$(Number(M.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Lifetime: ",U.toFixed(1),"s"]}),i.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:U,onChange:M=>J(Number(M.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Size: ",G,"px"]}),i.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:G,onChange:M=>pe(Number(M.target.value)),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:M=>d(B=>({...B,goopiness:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:M=>d(B=>({...B,attractionRadius:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:M=>d(B=>({...B,attractionStiffness:Number(M.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:M=>d(B=>({...B,tendrilEndRadius:Number(M.target.value)})),style:{width:80}})]})]})]}),i.jsxs("svg",{ref:e,width:b2,height:M2,style:{background:$e,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Fe(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:Pn+1}).map((M,B)=>i.jsx("line",{x1:hn+B*at,y1:xn,x2:hn+B*at,y2:xn+it*at,stroke:"#fff",strokeWidth:1},`v${B}`)),Array.from({length:it+1}).map((M,B)=>i.jsx("line",{x1:hn,y1:xn+B*at,x2:hn+Pn*at,y2:xn+B*at,stroke:"#fff",strokeWidth:1},`h${B}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((M,B)=>{const de=s.current[M.blobA],I=s.current[M.blobB];if(!de||!I)return null;const F=de.vertices[M.vertA],D=I.vertices[M.vertB];if(!F||!D)return null;const X=D.pos.x-F.pos.x,ne=D.pos.y-F.pos.y,se=Math.sqrt(X*X+ne*ne),ye=Math.min(1,se/f.goopiness),b=f.tendrilEndRadius,N=1-f.tendrilSkinniness,E=1-f.tendrilSkinniness*.3,z=E-(E-N)*ye,re=b*z,te=b*1.4,ie=Math.max(2,Math.ceil(se/te)),ae=[];for(let he=0;he<=ie;he++){const Ae=he/ie,Ee=Math.sin(Ae*Math.PI),Ie=b-(b-re)*Ee;ae.push({cx:F.pos.x+X*Ae,cy:F.pos.y+ne*Ae,r:Math.max(2,Ie)})}return i.jsx("g",{children:ae.map((he,Ae)=>i.jsx("circle",{cx:he.cx,cy:he.cy,r:he.r,fill:de.color},Ae))},`tendril-${B}`)}),s.current.map((M,B)=>{const de=M.isLocked&&M.fillAmount>=1;return i.jsx("g",{style:{cursor:de?"pointer":"default"},onClick:()=>de&&ee(M),children:i.jsx("path",{d:V2(M.vertices),fill:M.color,stroke:M.color,strokeWidth:2})},M.id)})]}),s.current.map(M=>{if(!M.isLocked||M.fillAmount>=1)return null;const B=M.vertices.map(se=>se.pos),de=q2(B,f.wallThickness),I=W(de),F=I.maxY-I.minY,D=I.maxY-F*M.fillAmount,X=50,ne=`unfilled-clip-${M.id}`;return i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:ne,children:i.jsx("rect",{x:I.minX-X,y:I.minY-X,width:I.maxX-I.minX+X*2,height:D-I.minY+X})})}),i.jsx("path",{d:wp(de),fill:$e,clipPath:`url(#${ne})`})]},`inner-${M.id}`)}),i.jsx("g",{children:A.current.map(M=>i.jsx("circle",{cx:M.pos.x,cy:M.pos.y,r:M.radius,fill:M.color,opacity:M.opacity},M.id))}),s.current.filter(M=>M.gridCells.length>4).map(M=>i.jsxs("g",{children:[M.vertices.map((B,de)=>i.jsxs("g",{children:[i.jsx("circle",{cx:B.pos.x,cy:B.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:B.pos.x+6,y:B.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:de})]},`v-${de}`)),M.vertices.map((B,de)=>{const I=M.vertices[(de+1)%M.vertices.length];return i.jsx("line",{x1:B.pos.x,y1:B.pos.y,x2:I.pos.x,y2:I.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${de}`)})]},`debug-verts-${M.id}`)),s.current.map((M,B)=>i.jsx("text",{x:M.targetX,y:M.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:M.isLocked?`${Math.round(M.fillAmount*100)}%`:"falling"},`info-${M.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-8: Pop"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"How to test:"}),i.jsx("br",{})," Wait for a blob to fill to 100%",i.jsx("br",{})," Click the filled blob to pop it",i.jsx("br",{})," Droplets scatter outward and fade",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",i.jsx("strong",{children:"Droplets:"})," ",A.current.length]})]})}const Jt=6,Ve=8,Je=50,yn=50,gn=50,K2=Jt*Je+yn*2,Q2=Ve*Je+gn*2,J2={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Vl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},e3={autoFill:!0,fillRate:.15},t3=4,n3=200,To=["#e74c3c","#3498db","#2ecc71","#f39c12"],s3={T_I_C:[{x:0,y:2},{x:0,y:3},{x:1,y:0},{x:1,y:1}],T_L_C:[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:2}],T_T_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:2,y:1}],T_S_C:[{x:0,y:2},{x:1,y:0},{x:1,y:1},{x:2,y:1}],T_O_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:1,y:2}]};function o3(e,t){return{x:yn+(e+.5)*Je,y:gn+(t+.5)*Je}}function ri(e,t){return{x:yn+e*Je,y:gn+t*Je}}function Ks(e){let t=0,n=0;for(const s of e){const r=o3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function r3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function i3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(ri(c.x,c.y));const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(C=>!r.has(C));if(y.length===0)break;let S=y[0],P=1/0;for(const C of y){const g=n(C,u),h=s(a,g);(h>P||P===1/0)&&(P=h,S=C)}l=S,c=u}return o}let jp=0;function Xn(e,t,n){const s=`blob-${jp++}`,r=r3(e),o=i3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Ks(e),x=Je*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const c=Ks(e),a=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y}})),f=[],d=a.length;for(let h=0;h<d;h++){const x=(h+1)%d,m=a[x].homeOffset.x-a[h].homeOffset.x,j=a[x].homeOffset.y-a[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(m*m+j*j)})}const p=[],y=Je*1.5,S=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const m=a[x].homeOffset.x-a[h].homeOffset.x,j=a[x].homeOffset.y-a[h].homeOffset.y,R=Math.sqrt(m*m+j*j);if(R<y){const k=`${Math.min(h,x)}-${Math.max(h,x)}`;S.has(k)||(S.add(k),p.push({a:h,b:x,restLength:R}))}}let P=0;for(let h=0;h<d;h++){const x=(h+1)%d;P+=a[h].homeOffset.x*a[x].homeOffset.y,P-=a[x].homeOffset.x*a[h].homeOffset.y}const C=P>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${P.toFixed(0)}, winding=${C}, cells=${e.length}`);const g=Math.abs(P)/2;return{id:s,vertices:a,innerVertices:u,ringsprings:f,crossSprings:p,restArea:g,targetX:c.x,targetY:c.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,isLoose:!1,visualOffsetY:0}}function Bf(e,t,n=.3){const s=[];for(const o of t)for(const l of o.vertices)s.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.vertices){let l=1/0,c={x:0,y:0};for(const a of s){const u=o.pos.x-a.pos.x,f=o.pos.y-a.pos.y,d=u*u+f*f;d<l&&(l=d,c=a.velocity)}o.oldPos.x=o.pos.x-c.x*n,o.oldPos.y=o.pos.y-c.y*n}const r=[];for(const o of t)for(const l of o.innerVertices)r.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.innerVertices){let l=1/0,c={x:0,y:0};for(const a of r){const u=o.pos.x-a.pos.x,f=o.pos.y-a.pos.y,d=u*u+f*f;d<l&&(l=d,c=a.velocity)}o.oldPos.x=o.pos.x-c.x*n,o.oldPos.y=o.pos.y-c.y*n}}const l3=Je*.02*1e3;function c3(e){if(e.length===0)return[];if(e.length===1)return[[...e]];const t=new Set(e.map(r=>`${r.x},${r.y}`)),n=new Set,s=[];for(const r of e){const o=`${r.x},${r.y}`;if(n.has(o))continue;const l=[],c=[r];for(;c.length>0;){const a=c.shift(),u=`${a.x},${a.y}`;if(n.has(u))continue;n.add(u),l.push(a);const f=[{x:a.x,y:a.y-1},{x:a.x,y:a.y+1},{x:a.x-1,y:a.y},{x:a.x+1,y:a.y}];for(const d of f){const p=`${d.x},${d.y}`;t.has(p)&&!n.has(p)&&c.push(d)}}l.length>0&&s.push(l)}return s}function a3(e,t,n){var s;for(const r of e.gridCells)if(r.y>=Ve-1)return!0;for(const r of e.gridCells){const o=r.y+1;if(o<Ve){const l=(s=t[o])==null?void 0:s[r.x];if(l&&l.blobId!==e.id&&n.has(l.blobId))return!0}}return!1}function zf(e,t){var c,a;const n=new Set;for(const u of e)if(!(!u.isLocked||u.isLoose)){for(const f of u.gridCells)if(f.y>=Ve-1){n.add(u.id);break}}let s=!0;for(;s;){s=!1;for(const u of e)n.has(u.id)||!u.isLocked||u.isLoose||a3(u,t,n)&&(n.add(u.id),s=!0)}const r=[],o=[],l=[];for(const u of e){if(!u.isLocked||u.isLoose||n.has(u.id))continue;for(const d of u.gridCells)((a=(c=t[d.y])==null?void 0:c[d.x])==null?void 0:a.blobId)===u.id&&(t[d.y][d.x]=null);const f=c3(u.gridCells);if(f.length===1)u.isLocked=!1,u.isLoose=!0,u.visualOffsetY=0,r.push(u),console.log(`Blob ${u.id} became loose (lost support)`);else{console.log(`Blob ${u.id} splitting into ${f.length} disconnected pieces`),o.push(u.id);for(const d of f){const p=Xn(d,u.color,!1);p.isLocked=!1,p.isLoose=!0,p.visualOffsetY=0,p.fillAmount=u.fillAmount,l.push(p),r.push(p),console.log(`  - Created loose piece with ${d.length} cell(s)`)}}}if(o.length>0||l.length>0){const u=e.filter(f=>!o.includes(f.id));e.length=0,e.push(...u,...l)}return r}const u3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Gf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function f3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function d3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Gf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Gf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function p3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function h3(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,c=o.pos.y-s,a=Math.sqrt(l*l+c*c),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(a>1e-4&&u>1e-4){const d=(u-a)*r;o.pos.x+=l/a*d,o.pos.y+=c/a*d}}}function x3(e){const t=yn,n=yn+Jt*Je,s=gn,r=gn+Ve*Je,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function y3(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color===a.color)continue;const u=c.isFalling||c.isLoose,f=a.isFalling||a.isLoose;if(!u&&!f)continue;const d=c.targetX-a.targetX,p=c.targetY-a.targetY;if(!(Math.sqrt(d*d+p*p)>Je*4))for(const S of c.vertices)for(const P of a.vertices){const C=P.pos.x-S.pos.x,g=P.pos.y-S.pos.y,h=Math.sqrt(C*C+g*g);if(h<20&&h>.01){const x=20-h,m=C/h,j=g/h,R=x*.8;S.pos.x-=m*R*.5,S.pos.y-=j*R*.5,P.pos.x+=m*R*.5,P.pos.y+=j*R*.5,S.oldPos.x-=m*R*.3,S.oldPos.y-=j*R*.3,P.oldPos.x+=m*R*.3,P.oldPos.y+=j*R*.3}}}}function g3(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],C=`${o}-${p}-${l}-${y}`;if(r.has(C))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,j=n.attractionRadius*P.attractionRadius,R=m+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(C))}}return s}function m3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),P=s+S*(r-s),C=p-o.restLength,g=f/p*C*P,h=d/p*C*P;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function v3(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,c=n[(r+1)%s].pos,a=l.x-o.x,u=l.y-o.y,f=c.x-l.x,d=c.y-l.y,p=Math.sqrt(a*a+u*u)||1,y=Math.sqrt(f*f+d*d)||1,S=a/p,P=u/p,C=f/y,g=d/y,h=P,x=-S,m=g,j=-C;let R=h+m,k=x+j;const w=Math.sqrt(R*R+k*k)||1;R/=w,k/=w,n[r].oldPos.x-=R*t,n[r].oldPos.y-=k*t}}function S3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Pp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=S3(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function C3(e){return Pp(e.map(t=>t.pos))}function k3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,C=f/y,g=d/S,h=p/S,x=-C,m=P,j=-h,R=g;let k=x+j,w=m+R;const T=Math.sqrt(k*k+w*w);T<.001?(k=x,w=m):(k/=T,w/=T);const _=P*g+C*h,L=Math.sqrt((1+_)/2),V=L>.1?1/L:10,q=s[o]*.4,Q=Math.min(t,q);r.push({x:c.x+k*Q*Math.min(V,3),y:c.y+w*Q*Math.min(V,3)})}return r}function w3(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(n3),[f,d]=v.useState(J2),[p,y]=v.useState(e3),[S,P]=v.useState(Vl.medium),[C,g]=v.useState("medium"),[h,x]=v.useState(!0),[m,j]=v.useState(To[0]),[R,k]=v.useState("T"),[,w]=v.useState({}),[T,_]=v.useState("A"),[L,V]=v.useState("T_T_C"),[q,Q]=v.useState(0),[A,Z]=v.useState(5),[ce,Y]=v.useState(1.5),K=v.useRef(A),$=v.useRef(ce);K.current=A,$.current=ce;const U=v.useRef([]),J=v.useRef(0),[G,pe]=v.useState(12),[we,O]=v.useState(150),[H,me]=v.useState(1),[ue,Se]=v.useState(8),[oe,Ce]=v.useState(!1),ee="proto9-dev-settings";v.useEffect(()=>{const b=localStorage.getItem(ee);if(b)try{const N=JSON.parse(b);N.physics&&d(N.physics),N.fillParams&&y(N.fillParams),N.filterParams&&(P(N.filterParams),g("custom")),N.fallSpeed&&u(N.fallSpeed),N.impactStrength&&Z(N.impactStrength),N.impactRadius&&Y(N.impactRadius),N.dropletCount&&pe(N.dropletCount),N.dropletSpeed&&O(N.dropletSpeed),N.dropletLifetime&&me(N.dropletLifetime),N.dropletSize&&Se(N.dropletSize),console.log("Loaded dev settings from localStorage")}catch(N){console.warn("Failed to load dev settings:",N)}},[]),v.useEffect(()=>{const b=N=>{N.key==="`"&&(N.preventDefault(),Ce(E=>!E))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]);const je=v.useCallback(()=>{const b={physics:f,fillParams:p,filterParams:S,fallSpeed:a,impactStrength:A,impactRadius:ce,dropletCount:G,dropletSpeed:we,dropletLifetime:H,dropletSize:ue};localStorage.setItem(ee,JSON.stringify(b)),console.log("Saved dev settings to localStorage")},[f,p,S,a,A,ce,G,we,H,ue]),xe=v.useCallback(()=>{const b=[];for(let he=0;he<Ve;he++){b[he]=[];for(let Ae=0;Ae<Jt;Ae++)b[he][Ae]=null}r.current=b,jp=0;const N=[],E=[{x:1,y:Ve-1},{x:2,y:Ve-1},{x:3,y:Ve-1},{x:4,y:Ve-1}],z=Xn(E,To[1],!0);z.fillAmount=1,z.wasFullLastFrame=!0,N.push(z);for(const he of E)b[he.y][he.x]={blobId:z.id,color:z.color};const re=[{x:1,y:Ve-2},{x:2,y:Ve-2},{x:3,y:Ve-2},{x:2,y:Ve-3}],te=Xn(re,To[0],!0);te.fillAmount=1,te.wasFullLastFrame=!0,N.push(te);for(const he of re)b[he.y][he.x]={blobId:te.id,color:te.color};const ie=[{x:1,y:Ve-5},{x:1,y:Ve-4},{x:2,y:Ve-4},{x:3,y:Ve-4}],ae=Xn(ie,To[1],!0);ae.fillAmount=1,ae.wasFullLastFrame=!0,N.push(ae);for(const he of ie)b[he.y][he.x]={blobId:ae.id,color:ae.color};s.current=N,o.current=[],U.current=[],l.current=null,c.current=!1,console.log("Test A initialized: 4x1 blue, T red, J blue")},[]);v.useEffect(()=>{xe()},[xe]);const Me=v.useCallback(b=>{_(b),xe()},[xe]);v.useEffect(()=>{let b=!0;const N=E=>{var Ie,De,Pe,He,Ue;if(b){n.current=E,b=!1,t.current=requestAnimationFrame(N);return}const z=Math.min((E-n.current)/1e3,.033);n.current=E;for(const le of s.current){f3(le,f,z),d3(le,f);for(let Be=0;Be<f.iterations;Be++)p3(le,f);le.usePressure&&h3(le,f),x3(le)}y3(s.current);for(const le of s.current){le.isLocked&&p.autoFill&&le.fillAmount<1&&(le.fillAmount=Math.min(1,le.fillAmount+p.fillRate*z));const Be=le.fillAmount>=1;Be&&!le.wasFullLastFrame&&v3(le,t3),le.wasFullLastFrame=Be}if(l.current!==null){const le=s.current[l.current];if(le&&!le.isLocked){let Be=Ve-1;for(const ot of le.gridCells){let wt=ot.y;for(;wt<Ve-1;){const za=wt+1,Ga=(Ie=r.current[za])==null?void 0:Ie[ot.x];if(Ga&&Ga.blobId!==le.id)break;wt=za}wt-ot.y+le.gridCells[0].y;const An=wt-ot.y;ot.y+An-ot.y<Be-le.gridCells[0].y}let Xe=Ve;for(const ot of le.gridCells){let wt=0;for(;ot.y+wt+1<Ve;){const An=ot.y+wt+1,el=(De=r.current[An])==null?void 0:De[ot.x];if(el&&el.blobId!==le.id)break;wt++}Xe=Math.min(Xe,wt)}const kt=Xe*Je,Wn=a*z,Ht=Math.min(le.visualOffsetY+Wn,kt);for(le.visualOffsetY=Ht;le.visualOffsetY>=Je;){for(const ot of le.gridCells)ot.y+=1;le.visualOffsetY-=Je}const Es=Ks(le.gridCells);le.targetY=Es.y+le.visualOffsetY;let Qt=!0;for(const ot of le.gridCells){const wt=ot.y+1;if(wt>=Ve){Qt=!1;break}const An=(Pe=r.current[wt])==null?void 0:Pe[ot.x];if(An&&An.blobId!==le.id){Qt=!1;break}}!Qt&&le.visualOffsetY<.1&&(le.visualOffsetY=0,le.targetY=Es.y,c.current=!0)}}const re=s.current.filter(le=>le.isLoose),te=[];for(const le of re){let Be=Ve;for(const Qt of le.gridCells){let ot=0;for(;Qt.y+ot+1<Ve;){const wt=Qt.y+ot+1,An=(He=r.current[wt])==null?void 0:He[Qt.x];if(An&&An.blobId!==le.id)break;ot++}Be=Math.min(Be,ot)}const Xe=Be*Je,kt=l3*z,Wn=Math.min(le.visualOffsetY+kt,Xe);for(le.visualOffsetY=Wn;le.visualOffsetY>=Je;){for(const Qt of le.gridCells)Qt.y+=1;le.visualOffsetY-=Je}const Ht=Ks(le.gridCells);le.targetY=Ht.y+le.visualOffsetY;let Es=!0;for(const Qt of le.gridCells){const ot=Qt.y+1;if(ot>=Ve){Es=!1;break}const wt=(Ue=r.current[ot])==null?void 0:Ue[Qt.x];if(wt&&wt.blobId!==le.id){Es=!1;break}}!Es&&le.visualOffsetY<.1&&(le.visualOffsetY=0,le.targetY=Ht.y,te.push(le))}for(const le of te)W(le);o.current=g3(s.current,o.current,f),m3(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,M());const ie=300,ae=yn,he=yn+Jt*Je,Ae=gn,Ee=gn+Ve*Je;for(const le of U.current)le.vel.y+=ie*z,le.pos.x+=le.vel.x*z,le.pos.y+=le.vel.y*z,(le.pos.x+le.radius<ae||le.pos.x-le.radius>he)&&(le.lifetime=0),le.pos.y+le.radius<Ae&&(le.lifetime=0),le.pos.y+le.radius>Ee&&(le.pos.y=Ee-le.radius,le.vel.y*=-.3),le.lifetime-=z,le.opacity=Math.max(0,le.lifetime/le.maxLifetime),le.radius*=.995;U.current=U.current.filter(le=>le.lifetime>0&&le.opacity>.01),w({}),t.current=requestAnimationFrame(N)};return t.current=requestAnimationFrame(N),()=>cancelAnimationFrame(t.current)},[f,p,a]);const Oe=v.useCallback((b,N)=>{var E;return N<0||N>=Ve||b<0||b>=Jt?!0:((E=r.current[N])==null?void 0:E[b])!==null},[]),Ne=v.useCallback((b,N)=>{const E=new Set,z=r.current;for(const re of b){const te=[{x:re.x-1,y:re.y},{x:re.x+1,y:re.y},{x:re.x,y:re.y-1},{x:re.x,y:re.y+1}];for(const ie of te)if(ie.y>=0&&ie.y<Ve&&ie.x>=0&&ie.x<Jt){const ae=z[ie.y][ie.x];ae&&ae.color===N&&E.add(ae.blobId)}}return E},[]),Fe=v.useCallback(b=>{var te,ie,ae;const N=K.current,E=$.current,z=[];for(const he of b.gridCells){const Ae=he.y+1;Ae<Ve&&((te=r.current[Ae])!=null&&te[he.x])&&z.push(ri(he.x+.5,he.y+1)),he.x>0&&((ie=r.current[he.y])!=null&&ie[he.x-1])&&z.push(ri(he.x,he.y+.5)),he.x<Jt-1&&((ae=r.current[he.y])!=null&&ae[he.x+1])&&z.push(ri(he.x+1,he.y+.5))}if(z.length===0)return;const re=Je*E;for(const he of s.current)if(he.id!==b.id){for(const Ae of he.vertices){let Ee=1/0,Ie=null;for(const De of z){const Pe=Ae.pos.x-De.x,He=Ae.pos.y-De.y,Ue=Math.sqrt(Pe*Pe+He*He);Ue<Ee&&(Ee=Ue,Ie=De)}if(Ee<re&&Ie){const De=1-Ee/re,Pe=N*De*De,He=(Ae.pos.x-Ie.x)/(Ee+.1),Ue=(Ae.pos.y-Ie.y)/(Ee+.1);Ae.oldPos.x-=He*Pe,Ae.oldPos.y-=Ue*Pe*.5}}for(const Ae of he.innerVertices){let Ee=1/0,Ie=null;for(const De of z){const Pe=Ae.pos.x-De.x,He=Ae.pos.y-De.y,Ue=Math.sqrt(Pe*Pe+He*He);Ue<Ee&&(Ee=Ue,Ie=De)}if(Ee<re&&Ie){const De=1-Ee/re,Pe=N*De*De*.3,He=(Ae.pos.x-Ie.x)/(Ee+.1),Ue=(Ae.pos.y-Ie.y)/(Ee+.1);Ae.oldPos.x-=He*Pe,Ae.oldPos.y-=Ue*Pe*.5}}}},[]),$e=v.useCallback(b=>{var re,te;const N=b.targetX,E=b.targetY;for(let ie=0;ie<G;ie++){const ae=Math.floor(Math.random()*b.vertices.length),he=b.vertices[ae],Ae=he.pos.x-N,Ee=he.pos.y-E,Ie=Math.atan2(Ee,Ae)+(Math.random()-.5)*.8,De=we*(.5+Math.random()*.8),Pe={id:`droplet-${J.current++}`,pos:{x:he.pos.x,y:he.pos.y},vel:{x:Math.cos(Ie)*De,y:Math.sin(Ie)*De-50},radius:ue*(.5+Math.random()*.7),color:b.color,opacity:1,lifetime:H*(.7+Math.random()*.6),maxLifetime:H};U.current.push(Pe),console.log("Created droplet:",Pe.pos,Pe.radius,Pe.color)}for(const ie of b.gridCells)((te=(re=r.current[ie.y])==null?void 0:re[ie.x])==null?void 0:te.blobId)===b.id&&(r.current[ie.y][ie.x]=null);s.current=s.current.filter(ie=>ie.id!==b.id);const z=zf(s.current,r.current);z.length>0&&console.log(`Pop created ${z.length} loose goop blob(s)`),console.log(`Popped blob with ${b.gridCells.length} cells, spawned ${U.current.length} droplets total`)},[G,we,H,ue]),W=v.useCallback(b=>{if(!b.isLoose)return;console.log(`Locking loose blob ${b.id}`),Fe(b),b.visualOffsetY=0;const N=Ks(b.gridCells);b.targetY=N.y;const E=Ne(b.gridCells,b.color);if(E.size>0){const re=[...b.gridCells],te=[b],ie=[b.id];for(const he of E){const Ae=s.current.find(Ee=>Ee.id===he);Ae&&(re.push(...Ae.gridCells),te.push(Ae),ie.push(he))}const ae=Xn(re,b.color,!0);Bf(ae,te);for(const he of re)r.current[he.y][he.x]={blobId:ae.id,color:ae.color};s.current=s.current.filter(he=>!ie.includes(he.id)),s.current.push(ae),console.log(`Loose blob merged with ${E.size} neighbor(s) into ${re.length} cells`)}else{b.isLocked=!0,b.isLoose=!1,b.fillAmount=0,b.wasFullLastFrame=!1;for(const re of b.gridCells)r.current[re.y][re.x]={blobId:b.id,color:b.color};console.log("Loose blob locked (no same-color neighbors)")}const z=zf(s.current,r.current);z.length>0&&console.log(`Landing created ${z.length} more loose goop blob(s)`)},[Ne,Fe]),M=v.useCallback(()=>{if(l.current===null)return;const b=s.current[l.current];if(!b)return;Fe(b),b.visualOffsetY=0;const N=Ks(b.gridCells);b.targetY=N.y;const E=Ne(b.gridCells,b.color);if(E.size>0){const z=[...b.gridCells],re=[b],te=[b.id];for(const ae of E){const he=s.current.find(Ae=>Ae.id===ae);he&&(z.push(...he.gridCells),re.push(he),te.push(ae))}const ie=Xn(z,b.color,!0);Bf(ie,re);for(const ae of z)r.current[ae.y][ae.x]={blobId:ie.id,color:ie.color};s.current=s.current.filter(ae=>!te.includes(ae.id)),s.current.push(ie),console.log(`Merged ${te.length} blobs into one with ${z.length} cells`)}else{b.isLocked=!0,b.fillAmount=0,b.wasFullLastFrame=!1;for(const z of b.gridCells)r.current[z.y][z.x]={blobId:b.id,color:b.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[Ne,Fe]),B=v.useCallback(()=>{if(l.current!==null)return;const b=u3[R],N=Math.floor((Jt-4)/2),E=0,z=b.map(te=>({x:te.x+N,y:te.y+E}));for(const te of z)if(Oe(te.x,te.y)){console.log("Cannot spawn - space occupied");return}const re=Xn(z,m,!1);re.visualOffsetY=0,s.current.push(re),l.current=s.current.length-1},[R,m,Oe]),de=(b,N)=>{let E=b.map(te=>({...te}));for(let te=0;te<N%4;te++)E=E.map(({x:ie,y:ae})=>({x:-ae,y:ie}));const z=Math.min(...E.map(te=>te.x)),re=Math.min(...E.map(te=>te.y));return E.map(te=>({x:te.x-z,y:te.y-re}))},I=v.useCallback(()=>{if(l.current!==null)return;const b=s3[L];if(!b)return;const N=de(b,q),E=Math.floor((Jt-3)/2),z=0,re=N.map(ie=>({x:ie.x+E,y:ie.y+z}));for(const ie of re){if(ie.x<0||ie.x>=Jt||ie.y<0||ie.y>=Ve){console.log("Cannot spawn - out of bounds");return}if(Oe(ie.x,ie.y)){console.log("Cannot spawn - space occupied");return}}const te=Xn(re,m,!1);te.visualOffsetY=0,s.current.push(te),l.current=s.current.length-1,console.log(`Spawned corrupted piece ${L} with rotation ${q*90}`)},[L,q,m,Oe]),F=v.useCallback(()=>{var N;if(l.current===null)return;const b=s.current[l.current];if(b){for(;;){let E=!0;for(const z of b.gridCells){const re=z.y+1;if(re>=Ve){E=!1;break}const te=(N=r.current[re])==null?void 0:N[z.x];if(te&&te.blobId!==b.id){E=!1;break}}if(!E)break;for(const z of b.gridCells)z.y+=1}b.visualOffsetY=0,M()}},[M]),D=v.useCallback(()=>{xe()},[xe]),X=b=>{const N=Vl[b];N&&(P(N),g(b))},ne=()=>{const{alphaMultiplier:b,alphaOffset:N}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${b} ${N}`},se="#2c3e50",ye=b=>{let N=1/0,E=-1/0,z=1/0,re=-1/0;for(const te of b)te.x<N&&(N=te.x),te.x>E&&(E=te.x),te.y<z&&(z=te.y),te.y>re&&(re=te.y);return{minX:N,maxX:E,minY:z,maxY:re}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-9: Loose Goop"}),i.jsxs("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:[T==="A"&&"Test A: Click red blob to pop  top blue becomes loose  falls  merges with bottom blue",T==="B"&&"Test B: Spawn corrupted pieces, build stacks, pop middle pieces to test loose goop",T==="default"&&"Default: Original Proto-8 setup with T and square pieces"]}),i.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15,background:"#8e44ad",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold",marginRight:10},children:"Test Mode:"}),i.jsx("button",{onClick:()=>Me("A"),style:{padding:"8px 16px",background:T==="A"?"#fff":"#2c3e50",color:T==="A"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test A: Stack Pop"}),i.jsx("button",{onClick:()=>Me("B"),style:{padding:"8px 16px",background:T==="B"?"#fff":"#2c3e50",color:T==="B"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test B: Corrupted"}),i.jsx("button",{onClick:()=>Me("default"),style:{padding:"8px 16px",background:T==="default"?"#fff":"#2c3e50",color:T==="default"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Default"})]}),T==="A"&&i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#e74c3c",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:14},children:"Blue (floor)  Red (middle)  Blue (top)"}),i.jsx("button",{onClick:()=>xe(),style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Stack"})]}),T==="B"&&i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#16a085",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Corrupted Shape:"}),i.jsxs("select",{value:L,onChange:b=>V(b.target.value),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#fff",cursor:"pointer"},children:[i.jsx("option",{value:"T_T_C",children:"T Corrupted (split T)"}),i.jsx("option",{value:"T_I_C",children:"I Corrupted (split I)"}),i.jsx("option",{value:"T_L_C",children:"L Corrupted (diagonal L)"}),i.jsx("option",{value:"T_S_C",children:"S Corrupted (diagonal S)"}),i.jsx("option",{value:"T_O_C",children:"O Corrupted (split O)"})]}),i.jsx("span",{style:{fontWeight:"bold",marginLeft:10},children:"Rotate:"}),i.jsx("button",{onClick:()=>Q(b=>(b+3)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CCW"}),i.jsx("button",{onClick:()=>Q(b=>(b+1)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CW"}),i.jsxs("span",{style:{opacity:.7},children:[q*90,""]}),i.jsx("button",{onClick:I,disabled:l.current!==null,style:{padding:"8px 16px",background:l.current!==null?"#7f8c8d":"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold",marginLeft:10},children:"Spawn Corrupted"})]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),To.map((b,N)=>i.jsx("button",{onClick:()=>j(b),style:{width:30,height:30,background:b,border:m===b?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},b)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(b=>i.jsx("button",{onClick:()=>k(b),style:{padding:"6px 12px",background:R===b?"#fff":"#2c3e50",color:R===b?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:b},b))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:B,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:F,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:D,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:b=>x(b.target.checked)}),i.jsx("span",{children:"Show Grid"})]}),i.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),oe&&i.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[i.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),i.jsxs("div",{style:{display:"flex",gap:10},children:[i.jsx("button",{onClick:je,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),i.jsx("button",{onClick:()=>Ce(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Vl).map(b=>i.jsx("button",{onClick:()=>X(b),style:{padding:"6px 12px",background:C===b?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:C===b?"bold":"normal",fontSize:12},children:b.charAt(0).toUpperCase()+b.slice(1)},b))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:b=>y(N=>({...N,fillRate:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:b=>u(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:b=>d(N=>({...N,wallThickness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:b=>y(N=>({...N,autoFill:b.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:b=>d(N=>({...N,damping:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:b=>d(N=>({...N,stiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:b=>d(N=>({...N,pressure:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:b=>d(N=>({...N,homeStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:b=>d(N=>({...N,innerHomeStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:b=>d(N=>({...N,returnSpeed:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:b=>d(N=>({...N,viscosity:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:b=>d(N=>({...N,iterations:Number(b.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",A]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:A,onChange:b=>Z(Number(b.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",ce.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:ce,onChange:b=>Y(Number(b.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Droplets: ",G]}),i.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:G,onChange:b=>pe(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Speed: ",we]}),i.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:we,onChange:b=>O(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Lifetime: ",H.toFixed(1),"s"]}),i.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:H,onChange:b=>me(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Size: ",ue,"px"]}),i.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:ue,onChange:b=>Se(Number(b.target.value)),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:b=>d(N=>({...N,goopiness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:b=>d(N=>({...N,attractionRadius:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:b=>d(N=>({...N,attractionStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:b=>d(N=>({...N,tendrilEndRadius:Number(b.target.value)})),style:{width:80}})]})]})]}),i.jsxs("svg",{ref:e,width:K2,height:Q2,style:{background:se,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:ne(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:Jt+1}).map((b,N)=>i.jsx("line",{x1:yn+N*Je,y1:gn,x2:yn+N*Je,y2:gn+Ve*Je,stroke:"#fff",strokeWidth:1},`v${N}`)),Array.from({length:Ve+1}).map((b,N)=>i.jsx("line",{x1:yn,y1:gn+N*Je,x2:yn+Jt*Je,y2:gn+N*Je,stroke:"#fff",strokeWidth:1},`h${N}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((b,N)=>{const E=s.current[b.blobA],z=s.current[b.blobB];if(!E||!z)return null;const re=E.vertices[b.vertA],te=z.vertices[b.vertB];if(!re||!te)return null;const ie=te.pos.x-re.pos.x,ae=te.pos.y-re.pos.y,he=Math.sqrt(ie*ie+ae*ae),Ae=Math.min(1,he/f.goopiness),Ee=f.tendrilEndRadius,Ie=1-f.tendrilSkinniness,De=1-f.tendrilSkinniness*.3,Pe=De-(De-Ie)*Ae,He=Ee*Pe,Ue=Ee*1.4,le=Math.max(2,Math.ceil(he/Ue)),Be=[];for(let Xe=0;Xe<=le;Xe++){const kt=Xe/le,Wn=Math.sin(kt*Math.PI),Ht=Ee-(Ee-He)*Wn;Be.push({cx:re.pos.x+ie*kt,cy:re.pos.y+ae*kt,r:Math.max(2,Ht)})}return i.jsx("g",{children:Be.map((Xe,kt)=>i.jsx("circle",{cx:Xe.cx,cy:Xe.cy,r:Xe.r,fill:E.color},kt))},`tendril-${N}`)}),s.current.map((b,N)=>{const E=b.isLocked&&b.fillAmount>=1;return i.jsx("g",{style:{cursor:E?"pointer":"default"},onClick:()=>E&&$e(b),children:i.jsx("path",{d:C3(b.vertices),fill:b.color,stroke:b.color,strokeWidth:2})},b.id)})]}),s.current.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const N=b.vertices.map(he=>he.pos),E=k3(N,f.wallThickness),z=ye(E),re=z.maxY-z.minY,te=z.maxY-re*b.fillAmount,ie=50,ae=`unfilled-clip-${b.id}`;return i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:ae,children:i.jsx("rect",{x:z.minX-ie,y:z.minY-ie,width:z.maxX-z.minX+ie*2,height:te-z.minY+ie})})}),i.jsx("path",{d:Pp(E),fill:se,clipPath:`url(#${ae})`})]},`inner-${b.id}`)}),i.jsx("g",{children:U.current.map(b=>i.jsx("circle",{cx:b.pos.x,cy:b.pos.y,r:b.radius,fill:b.color,opacity:b.opacity},b.id))}),s.current.filter(b=>b.gridCells.length>4).map(b=>i.jsxs("g",{children:[b.vertices.map((N,E)=>i.jsxs("g",{children:[i.jsx("circle",{cx:N.pos.x,cy:N.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:N.pos.x+6,y:N.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:E})]},`v-${E}`)),b.vertices.map((N,E)=>{const z=b.vertices[(E+1)%b.vertices.length];return i.jsx("line",{x1:N.pos.x,y1:N.pos.y,x2:z.pos.x,y2:z.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${E}`)})]},`debug-verts-${b.id}`)),s.current.map((b,N)=>i.jsx("text",{x:b.targetX,y:b.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:b.isLocked?`${Math.round(b.fillAmount*100)}%`:"falling"},`info-${b.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-8: Pop"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"How to test:"}),i.jsx("br",{})," Wait for a blob to fill to 100%",i.jsx("br",{})," Click the filled blob to pop it",i.jsx("br",{})," Droplets scatter outward and fade",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",i.jsx("strong",{children:"Droplets:"})," ",U.current.length]})]})}const j3=()=>new URLSearchParams(window.location.search).get("proto"),P3=()=>{const[e,t]=v.useState("GAME"),[n,s]=v.useState(()=>mm()),[r,o]=v.useState(0);Cm(),v.useEffect(()=>{vm(n)},[n]),v.useEffect(()=>{vt.init(n.settings)},[]);const l=v.useCallback(y=>{s(S=>{const P=xt(S.careerScore),{newCareerScore:C,ranksGained:g}=ap(S.careerScore,y.score,y.won),h=xt(C),x=g>0?g:0,j=lg(P.rank,h.rank).filter(R=>!S.milestonesReached.includes(R));return j.length>0&&ve.emit(ge.MILESTONE_REACHED,{milestones:j}),{...S,careerScore:C,careerRank:h.rank,scraps:S.scraps+x,milestonesReached:[...S.milestonesReached,...j],firstRunComplete:!0}})},[]),c=y=>{s(S=>({...S,settings:y})),vt.updateSettings(y)},a=y=>{if(y===0){const S=Sm();s(S),o(P=>P+1),vt.init(S.settings)}else{const S=rg(y);s(P=>({...P,careerScore:S,careerRank:y,scraps:y,powerUps:{}})),o(P=>P+1)}},u=v.useCallback(y=>{s(S=>{const P=S.powerUps[y]||0,C=En[y],g=(C==null?void 0:C.maxLevel)||4,h=(C==null?void 0:C.costPerLevel)||1;return S.scraps<h||P>=g?S:{...S,scraps:S.scraps-h,powerUps:{...S.powerUps,[y]:P+1}}})},[]),f=v.useCallback(y=>{s(S=>{const P=S.powerUps[y]||0,C=En[y],g=(C==null?void 0:C.costPerLevel)||1;if(P<=0)return S;let h=S.equippedActives;return P===1&&S.equippedActives.includes(y)&&(h=S.equippedActives.filter(x=>x!==y)),{...S,scraps:S.scraps+g,powerUps:{...S.powerUps,[y]:P-1},equippedActives:h}})},[]),d=v.useCallback(y=>{s(S=>{const P=S.equippedActives.includes(y);let C;if(P)C=S.equippedActives.filter(g=>g!==y);else{const h=1+((S.powerUps.ACTIVE_EXPANSION_SLOT||0)+(S.powerUps.ACTIVE_EXPANSION_SLOT_2||0));S.equippedActives.length>=h?C=[...S.equippedActives.slice(0,h-1),y]:C=[...S.equippedActives,y]}return{...S,equippedActives:C}})},[]),p=j3();return p==="1"?i.jsx(Mm,{}):p==="2"?i.jsx(Dm,{}):p==="3"?i.jsx(Xm,{}):p==="4"?i.jsx(ov,{}):p==="5"?i.jsx(yv,{}):p==="5b"?i.jsx(Ev,{}):p==="5c"?i.jsx(Yv,{}):p==="6"?i.jsx(o2,{}):p==="7"?i.jsx(R2,{}):p==="8"?i.jsx(Z2,{}):p==="9"?i.jsx(w3,{}):i.jsxs("div",{className:"w-full h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[e==="GAME"&&i.jsx(pm,{onExit:()=>{},onRunComplete:l,initialTotalScore:n.careerScore,powerUps:n.powerUps,scraps:n.scraps,settings:n.settings,onOpenSettings:()=>t("SETTINGS"),onOpenHelp:()=>t("HOW_TO_PLAY"),onOpenUpgrades:()=>t("UPGRADES"),onSetRank:a,onPurchaseUpgrade:u,onRefundUpgrade:f,equippedActives:n.equippedActives,onToggleEquip:d},r),e==="UPGRADES"&&i.jsx(hm,{onBack:()=>t("GAME")}),e==="SETTINGS"&&i.jsx(xm,{settings:n.settings,onUpdate:c,onBack:()=>t("GAME")}),e==="HOW_TO_PLAY"&&i.jsx(ym,{onBack:()=>t("GAME")})]})},Rp=document.getElementById("root");if(!Rp)throw new Error("Could not find root element to mount to");const R3=ql.createRoot(Rp);R3.render(i.jsx(Wp.StrictMode,{children:i.jsx(P3,{})}));
