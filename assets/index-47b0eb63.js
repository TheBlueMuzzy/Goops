var bp=Object.defineProperty;var Mp=(e,t,n)=>t in e?bp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ze=(e,t,n)=>(Mp(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function Tp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Vf={exports:{}},Di={},qf={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fr=Symbol.for("react.element"),Ep=Symbol.for("react.portal"),Ap=Symbol.for("react.fragment"),_p=Symbol.for("react.strict_mode"),Ip=Symbol.for("react.profiler"),Lp=Symbol.for("react.provider"),Np=Symbol.for("react.context"),Op=Symbol.for("react.forward_ref"),Dp=Symbol.for("react.suspense"),$p=Symbol.for("react.memo"),Fp=Symbol.for("react.lazy"),qa=Symbol.iterator;function Bp(e){return e===null||typeof e!="object"?null:(e=qa&&e[qa]||e["@@iterator"],typeof e=="function"?e:null)}var Zf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Kf=Object.assign,Qf={};function xo(e,t,n){this.props=e,this.context=t,this.refs=Qf,this.updater=n||Zf}xo.prototype.isReactComponent={};xo.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};xo.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Jf(){}Jf.prototype=xo.prototype;function Xc(e,t,n){this.props=e,this.context=t,this.refs=Qf,this.updater=n||Zf}var Vc=Xc.prototype=new Jf;Vc.constructor=Xc;Kf(Vc,xo.prototype);Vc.isPureReactComponent=!0;var Za=Array.isArray,ed=Object.prototype.hasOwnProperty,qc={current:null},td={key:!0,ref:!0,__self:!0,__source:!0};function nd(e,t,n){var s,r={},o=null,l=null;if(t!=null)for(s in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)ed.call(t,s)&&!td.hasOwnProperty(s)&&(r[s]=t[s]);var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){for(var a=Array(c),u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}if(e&&e.defaultProps)for(s in c=e.defaultProps,c)r[s]===void 0&&(r[s]=c[s]);return{$$typeof:fr,type:e,key:o,ref:l,props:r,_owner:qc.current}}function zp(e,t){return{$$typeof:fr,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Zc(e){return typeof e=="object"&&e!==null&&e.$$typeof===fr}function Gp(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Ka=/\/+/g;function tl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Gp(""+e.key):t.toString(36)}function Ur(e,t,n,s,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case fr:case Ep:l=!0}}if(l)return l=e,r=r(l),e=s===""?"."+tl(l,0):s,Za(r)?(n="",e!=null&&(n=e.replace(Ka,"$&/")+"/"),Ur(r,t,n,"",function(u){return u})):r!=null&&(Zc(r)&&(r=zp(r,n+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(Ka,"$&/")+"/")+e)),t.push(r)),1;if(l=0,s=s===""?".":s+":",Za(e))for(var c=0;c<e.length;c++){o=e[c];var a=s+tl(o,c);l+=Ur(o,t,n,a,r)}else if(a=Bp(e),typeof a=="function")for(e=a.call(e),c=0;!(o=e.next()).done;)o=o.value,a=s+tl(o,c++),l+=Ur(o,t,n,a,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function yr(e,t,n){if(e==null)return e;var s=[],r=0;return Ur(e,s,"","",function(o){return t.call(n,o,r++)}),s}function Yp(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ot={current:null},Xr={transition:null},Hp={ReactCurrentDispatcher:Ot,ReactCurrentBatchConfig:Xr,ReactCurrentOwner:qc};function sd(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:yr,forEach:function(e,t,n){yr(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return yr(e,function(){t++}),t},toArray:function(e){return yr(e,function(t){return t})||[]},only:function(e){if(!Zc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};He.Component=xo;He.Fragment=Ap;He.Profiler=Ip;He.PureComponent=Xc;He.StrictMode=_p;He.Suspense=Dp;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hp;He.act=sd;He.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Kf({},e.props),r=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=qc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(a in t)ed.call(t,a)&&!td.hasOwnProperty(a)&&(s[a]=t[a]===void 0&&c!==void 0?c[a]:t[a])}var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){c=Array(a);for(var u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}return{$$typeof:fr,type:e.type,key:r,ref:o,props:s,_owner:l}};He.createContext=function(e){return e={$$typeof:Np,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Lp,_context:e},e.Consumer=e};He.createElement=nd;He.createFactory=function(e){var t=nd.bind(null,e);return t.type=e,t};He.createRef=function(){return{current:null}};He.forwardRef=function(e){return{$$typeof:Op,render:e}};He.isValidElement=Zc;He.lazy=function(e){return{$$typeof:Fp,_payload:{_status:-1,_result:e},_init:Yp}};He.memo=function(e,t){return{$$typeof:$p,type:e,compare:t===void 0?null:t}};He.startTransition=function(e){var t=Xr.transition;Xr.transition={};try{e()}finally{Xr.transition=t}};He.unstable_act=sd;He.useCallback=function(e,t){return Ot.current.useCallback(e,t)};He.useContext=function(e){return Ot.current.useContext(e)};He.useDebugValue=function(){};He.useDeferredValue=function(e){return Ot.current.useDeferredValue(e)};He.useEffect=function(e,t){return Ot.current.useEffect(e,t)};He.useId=function(){return Ot.current.useId()};He.useImperativeHandle=function(e,t,n){return Ot.current.useImperativeHandle(e,t,n)};He.useInsertionEffect=function(e,t){return Ot.current.useInsertionEffect(e,t)};He.useLayoutEffect=function(e,t){return Ot.current.useLayoutEffect(e,t)};He.useMemo=function(e,t){return Ot.current.useMemo(e,t)};He.useReducer=function(e,t,n){return Ot.current.useReducer(e,t,n)};He.useRef=function(e){return Ot.current.useRef(e)};He.useState=function(e){return Ot.current.useState(e)};He.useSyncExternalStore=function(e,t,n){return Ot.current.useSyncExternalStore(e,t,n)};He.useTransition=function(){return Ot.current.useTransition()};He.version="18.3.1";qf.exports=He;var v=qf.exports;const Wp=Tp(v);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Up=v,Xp=Symbol.for("react.element"),Vp=Symbol.for("react.fragment"),qp=Object.prototype.hasOwnProperty,Zp=Up.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kp={key:!0,ref:!0,__self:!0,__source:!0};function od(e,t,n){var s,r={},o=null,l=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(s in t)qp.call(t,s)&&!Kp.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:Xp,type:e,key:o,ref:l,props:r,_owner:Zp.current}}Di.Fragment=Vp;Di.jsx=od;Di.jsxs=od;Vf.exports=Di;var i=Vf.exports,Zl={},rd={exports:{}},Kt={},id={exports:{}},ld={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(W,K){var Y=W.length;W.push(K);e:for(;0<Y;){var re=Y-1>>>1,te=W[re];if(0<r(te,K))W[re]=K,W[Y]=te,Y=re;else break e}}function n(W){return W.length===0?null:W[0]}function s(W){if(W.length===0)return null;var K=W[0],Y=W.pop();if(Y!==K){W[0]=Y;e:for(var re=0,te=W.length,Z=te>>>1;re<Z;){var de=2*(re+1)-1,we=W[de],E=de+1,B=W[E];if(0>r(we,Y))E<te&&0>r(B,we)?(W[re]=B,W[E]=Y,re=E):(W[re]=we,W[de]=Y,re=de);else if(E<te&&0>r(B,Y))W[re]=B,W[E]=Y,re=E;else break e}}return K}function r(W,K){var Y=W.sortIndex-K.sortIndex;return Y!==0?Y:W.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var a=[],u=[],f=1,d=null,p=3,y=!1,S=!1,P=!1,j=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(W){for(var K=n(u);K!==null;){if(K.callback===null)s(u);else if(K.startTime<=W)s(u),K.sortIndex=K.expirationTime,t(a,K);else break;K=n(u)}}function C(W){if(P=!1,x(W),!S)if(n(a)!==null)S=!0,Q(R);else{var K=n(u);K!==null&&ae(C,K.startTime-W)}}function R(W,K){S=!1,P&&(P=!1,g(m),m=-1),y=!0;var Y=p;try{for(x(K),d=n(a);d!==null&&(!(d.expirationTime>K)||W&&!L());){var re=d.callback;if(typeof re=="function"){d.callback=null,p=d.priorityLevel;var te=re(d.expirationTime<=K);K=e.unstable_now(),typeof te=="function"?d.callback=te:d===n(a)&&s(a),x(K)}else s(a);d=n(a)}if(d!==null)var Z=!0;else{var de=n(u);de!==null&&ae(C,de.startTime-K),Z=!1}return Z}finally{d=null,p=Y,y=!1}}var w=!1,k=null,m=-1,M=5,I=-1;function L(){return!(e.unstable_now()-I<M)}function H(){if(k!==null){var W=e.unstable_now();I=W;var K=!0;try{K=k(!0,W)}finally{K?q():(w=!1,k=null)}}else w=!1}var q;if(typeof h=="function")q=function(){h(H)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,N=ee.port2;ee.port1.onmessage=H,q=function(){N.postMessage(null)}}else q=function(){j(H,0)};function Q(W){k=W,w||(w=!0,q())}function ae(W,K){m=j(function(){W(e.unstable_now())},K)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){S||y||(S=!0,Q(R))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(W){switch(p){case 1:case 2:case 3:var K=3;break;default:K=p}var Y=p;p=K;try{return W()}finally{p=Y}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,K){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Y=p;p=W;try{return K()}finally{p=Y}},e.unstable_scheduleCallback=function(W,K,Y){var re=e.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,W){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Y+te,W={id:f++,callback:K,priorityLevel:W,startTime:Y,expirationTime:te,sortIndex:-1},Y>re?(W.sortIndex=Y,t(u,W),n(a)===null&&W===n(u)&&(P?(g(m),m=-1):P=!0,ae(C,Y-re))):(W.sortIndex=te,t(a,W),S||y||(S=!0,Q(R))),W},e.unstable_shouldYield=L,e.unstable_wrapCallback=function(W){var K=p;return function(){var Y=p;p=K;try{return W.apply(this,arguments)}finally{p=Y}}}})(ld);id.exports=ld;var Qp=id.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jp=v,Zt=Qp;function fe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var cd=new Set,Vo={};function Ms(e,t){oo(e,t),oo(e+"Capture",t)}function oo(e,t){for(Vo[e]=t,e=0;e<t.length;e++)cd.add(t[e])}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Kl=Object.prototype.hasOwnProperty,eh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qa={},Ja={};function th(e){return Kl.call(Ja,e)?!0:Kl.call(Qa,e)?!1:eh.test(e)?Ja[e]=!0:(Qa[e]=!0,!1)}function nh(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function sh(e,t,n,s){if(t===null||typeof t>"u"||nh(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Dt(e,t,n,s,r,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Tt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Tt[e]=new Dt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Tt[t]=new Dt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Tt[e]=new Dt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Tt[e]=new Dt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Tt[e]=new Dt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Tt[e]=new Dt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Tt[e]=new Dt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Tt[e]=new Dt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Tt[e]=new Dt(e,5,!1,e.toLowerCase(),null,!1,!1)});var Kc=/[\-:]([a-z])/g;function Qc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Kc,Qc);Tt[t]=new Dt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Kc,Qc);Tt[t]=new Dt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Kc,Qc);Tt[t]=new Dt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Tt[e]=new Dt(e,1,!1,e.toLowerCase(),null,!1,!1)});Tt.xlinkHref=new Dt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Tt[e]=new Dt(e,1,!1,e.toLowerCase(),null,!0,!0)});function Jc(e,t,n,s){var r=Tt.hasOwnProperty(t)?Tt[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(sh(t,n,r,s)&&(n=null),s||r===null?th(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Hn=Jp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gr=Symbol.for("react.element"),Fs=Symbol.for("react.portal"),Bs=Symbol.for("react.fragment"),ea=Symbol.for("react.strict_mode"),Ql=Symbol.for("react.profiler"),ad=Symbol.for("react.provider"),ud=Symbol.for("react.context"),ta=Symbol.for("react.forward_ref"),Jl=Symbol.for("react.suspense"),ec=Symbol.for("react.suspense_list"),na=Symbol.for("react.memo"),Vn=Symbol.for("react.lazy"),fd=Symbol.for("react.offscreen"),eu=Symbol.iterator;function mo(e){return e===null||typeof e!="object"?null:(e=eu&&e[eu]||e["@@iterator"],typeof e=="function"?e:null)}var pt=Object.assign,nl;function Ao(e){if(nl===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);nl=t&&t[1]||""}return`
`+nl+e}var sl=!1;function ol(e,t){if(!e||sl)return"";sl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),l=r.length-1,c=o.length-1;1<=l&&0<=c&&r[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(r[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||r[l]!==o[c]){var a=`
`+r[l].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=l&&0<=c);break}}}finally{sl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ao(e):""}function oh(e){switch(e.tag){case 5:return Ao(e.type);case 16:return Ao("Lazy");case 13:return Ao("Suspense");case 19:return Ao("SuspenseList");case 0:case 2:case 15:return e=ol(e.type,!1),e;case 11:return e=ol(e.type.render,!1),e;case 1:return e=ol(e.type,!0),e;default:return""}}function tc(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Bs:return"Fragment";case Fs:return"Portal";case Ql:return"Profiler";case ea:return"StrictMode";case Jl:return"Suspense";case ec:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ud:return(e.displayName||"Context")+".Consumer";case ad:return(e._context.displayName||"Context")+".Provider";case ta:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case na:return t=e.displayName||null,t!==null?t:tc(e.type)||"Memo";case Vn:t=e._payload,e=e._init;try{return tc(e(t))}catch{}}return null}function rh(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tc(t);case 8:return t===ea?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function as(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function dd(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ih(e){var t=dd(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(l){s=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(l){s=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function mr(e){e._valueTracker||(e._valueTracker=ih(e))}function pd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=dd(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function li(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function nc(e,t){var n=t.checked;return pt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function tu(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=as(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function hd(e,t){t=t.checked,t!=null&&Jc(e,"checked",t,!1)}function sc(e,t){hd(e,t);var n=as(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?oc(e,t.type,n):t.hasOwnProperty("defaultValue")&&oc(e,t.type,as(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function nu(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function oc(e,t,n){(t!=="number"||li(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var _o=Array.isArray;function Qs(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+as(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function rc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(fe(91));return pt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function su(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(fe(92));if(_o(n)){if(1<n.length)throw Error(fe(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:as(n)}}function xd(e,t){var n=as(t.value),s=as(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function ou(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function yd(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ic(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?yd(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var vr,gd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(vr=vr||document.createElement("div"),vr.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=vr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function qo(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Do={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lh=["Webkit","ms","Moz","O"];Object.keys(Do).forEach(function(e){lh.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Do[t]=Do[e]})});function md(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Do.hasOwnProperty(e)&&Do[e]?(""+t).trim():t+"px"}function vd(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=md(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var ch=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function lc(e,t){if(t){if(ch[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(fe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(fe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(fe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(fe(62))}}function cc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ac=null;function sa(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var uc=null,Js=null,eo=null;function ru(e){if(e=hr(e)){if(typeof uc!="function")throw Error(fe(280));var t=e.stateNode;t&&(t=Gi(t),uc(e.stateNode,e.type,t))}}function Sd(e){Js?eo?eo.push(e):eo=[e]:Js=e}function Cd(){if(Js){var e=Js,t=eo;if(eo=Js=null,ru(e),t)for(e=0;e<t.length;e++)ru(t[e])}}function kd(e,t){return e(t)}function wd(){}var rl=!1;function jd(e,t,n){if(rl)return e(t,n);rl=!0;try{return kd(e,t,n)}finally{rl=!1,(Js!==null||eo!==null)&&(wd(),Cd())}}function Zo(e,t){var n=e.stateNode;if(n===null)return null;var s=Gi(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(fe(231,t,typeof n));return n}var fc=!1;if(Bn)try{var vo={};Object.defineProperty(vo,"passive",{get:function(){fc=!0}}),window.addEventListener("test",vo,vo),window.removeEventListener("test",vo,vo)}catch{fc=!1}function ah(e,t,n,s,r,o,l,c,a){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(f){this.onError(f)}}var $o=!1,ci=null,ai=!1,dc=null,uh={onError:function(e){$o=!0,ci=e}};function fh(e,t,n,s,r,o,l,c,a){$o=!1,ci=null,ah.apply(uh,arguments)}function dh(e,t,n,s,r,o,l,c,a){if(fh.apply(this,arguments),$o){if($o){var u=ci;$o=!1,ci=null}else throw Error(fe(198));ai||(ai=!0,dc=u)}}function Ts(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Pd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function iu(e){if(Ts(e)!==e)throw Error(fe(188))}function ph(e){var t=e.alternate;if(!t){if(t=Ts(e),t===null)throw Error(fe(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return iu(r),e;if(o===s)return iu(r),t;o=o.sibling}throw Error(fe(188))}if(n.return!==s.return)n=r,s=o;else{for(var l=!1,c=r.child;c;){if(c===n){l=!0,n=r,s=o;break}if(c===s){l=!0,s=r,n=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===n){l=!0,n=o,s=r;break}if(c===s){l=!0,s=o,n=r;break}c=c.sibling}if(!l)throw Error(fe(189))}}if(n.alternate!==s)throw Error(fe(190))}if(n.tag!==3)throw Error(fe(188));return n.stateNode.current===n?e:t}function Rd(e){return e=ph(e),e!==null?bd(e):null}function bd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=bd(e);if(t!==null)return t;e=e.sibling}return null}var Md=Zt.unstable_scheduleCallback,lu=Zt.unstable_cancelCallback,hh=Zt.unstable_shouldYield,xh=Zt.unstable_requestPaint,xt=Zt.unstable_now,yh=Zt.unstable_getCurrentPriorityLevel,oa=Zt.unstable_ImmediatePriority,Td=Zt.unstable_UserBlockingPriority,ui=Zt.unstable_NormalPriority,gh=Zt.unstable_LowPriority,Ed=Zt.unstable_IdlePriority,$i=null,Mn=null;function mh(e){if(Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot($i,e,void 0,(e.current.flags&128)===128)}catch{}}var Sn=Math.clz32?Math.clz32:Ch,vh=Math.log,Sh=Math.LN2;function Ch(e){return e>>>=0,e===0?32:31-(vh(e)/Sh|0)|0}var Sr=64,Cr=4194304;function Io(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function fi(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes,l=n&268435455;if(l!==0){var c=l&~r;c!==0?s=Io(c):(o&=l,o!==0&&(s=Io(o)))}else l=n&~r,l!==0?s=Io(l):o!==0&&(s=Io(o));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-Sn(t),r=1<<n,s|=e[n],t&=~r;return s}function kh(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wh(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-Sn(o),c=1<<l,a=r[l];a===-1?(!(c&n)||c&s)&&(r[l]=kh(c,t)):a<=t&&(e.expiredLanes|=c),o&=~c}}function pc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Ad(){var e=Sr;return Sr<<=1,!(Sr&4194240)&&(Sr=64),e}function il(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function dr(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Sn(t),e[t]=n}function jh(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-Sn(n),o=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~o}}function ra(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Sn(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var Ke=0;function _d(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Id,ia,Ld,Nd,Od,hc=!1,kr=[],es=null,ts=null,ns=null,Ko=new Map,Qo=new Map,Zn=[],Ph="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cu(e,t){switch(e){case"focusin":case"focusout":es=null;break;case"dragenter":case"dragleave":ts=null;break;case"mouseover":case"mouseout":ns=null;break;case"pointerover":case"pointerout":Ko.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qo.delete(t.pointerId)}}function So(e,t,n,s,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},t!==null&&(t=hr(t),t!==null&&ia(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function Rh(e,t,n,s,r){switch(t){case"focusin":return es=So(es,e,t,n,s,r),!0;case"dragenter":return ts=So(ts,e,t,n,s,r),!0;case"mouseover":return ns=So(ns,e,t,n,s,r),!0;case"pointerover":var o=r.pointerId;return Ko.set(o,So(Ko.get(o)||null,e,t,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,Qo.set(o,So(Qo.get(o)||null,e,t,n,s,r)),!0}return!1}function Dd(e){var t=ms(e.target);if(t!==null){var n=Ts(t);if(n!==null){if(t=n.tag,t===13){if(t=Pd(n),t!==null){e.blockedOn=t,Od(e.priority,function(){Ld(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Vr(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=xc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);ac=s,n.target.dispatchEvent(s),ac=null}else return t=hr(n),t!==null&&ia(t),e.blockedOn=n,!1;t.shift()}return!0}function au(e,t,n){Vr(e)&&n.delete(t)}function bh(){hc=!1,es!==null&&Vr(es)&&(es=null),ts!==null&&Vr(ts)&&(ts=null),ns!==null&&Vr(ns)&&(ns=null),Ko.forEach(au),Qo.forEach(au)}function Co(e,t){e.blockedOn===t&&(e.blockedOn=null,hc||(hc=!0,Zt.unstable_scheduleCallback(Zt.unstable_NormalPriority,bh)))}function Jo(e){function t(r){return Co(r,e)}if(0<kr.length){Co(kr[0],e);for(var n=1;n<kr.length;n++){var s=kr[n];s.blockedOn===e&&(s.blockedOn=null)}}for(es!==null&&Co(es,e),ts!==null&&Co(ts,e),ns!==null&&Co(ns,e),Ko.forEach(t),Qo.forEach(t),n=0;n<Zn.length;n++)s=Zn[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<Zn.length&&(n=Zn[0],n.blockedOn===null);)Dd(n),n.blockedOn===null&&Zn.shift()}var to=Hn.ReactCurrentBatchConfig,di=!0;function Mh(e,t,n,s){var r=Ke,o=to.transition;to.transition=null;try{Ke=1,la(e,t,n,s)}finally{Ke=r,to.transition=o}}function Th(e,t,n,s){var r=Ke,o=to.transition;to.transition=null;try{Ke=4,la(e,t,n,s)}finally{Ke=r,to.transition=o}}function la(e,t,n,s){if(di){var r=xc(e,t,n,s);if(r===null)yl(e,t,s,pi,n),cu(e,s);else if(Rh(r,e,t,n,s))s.stopPropagation();else if(cu(e,s),t&4&&-1<Ph.indexOf(e)){for(;r!==null;){var o=hr(r);if(o!==null&&Id(o),o=xc(e,t,n,s),o===null&&yl(e,t,s,pi,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else yl(e,t,s,null,n)}}var pi=null;function xc(e,t,n,s){if(pi=null,e=sa(s),e=ms(e),e!==null)if(t=Ts(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Pd(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return pi=e,null}function $d(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yh()){case oa:return 1;case Td:return 4;case ui:case gh:return 16;case Ed:return 536870912;default:return 16}default:return 16}}var Qn=null,ca=null,qr=null;function Fd(){if(qr)return qr;var e,t=ca,n=t.length,s,r="value"in Qn?Qn.value:Qn.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var l=n-e;for(s=1;s<=l&&t[n-s]===r[o-s];s++);return qr=r.slice(e,1<s?1-s:void 0)}function Zr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function wr(){return!0}function uu(){return!1}function Qt(e){function t(n,s,r,o,l){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?wr:uu,this.isPropagationStopped=uu,this}return pt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=wr)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=wr)},persist:function(){},isPersistent:wr}),t}var yo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},aa=Qt(yo),pr=pt({},yo,{view:0,detail:0}),Eh=Qt(pr),ll,cl,ko,Fi=pt({},pr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ua,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ko&&(ko&&e.type==="mousemove"?(ll=e.screenX-ko.screenX,cl=e.screenY-ko.screenY):cl=ll=0,ko=e),ll)},movementY:function(e){return"movementY"in e?e.movementY:cl}}),fu=Qt(Fi),Ah=pt({},Fi,{dataTransfer:0}),_h=Qt(Ah),Ih=pt({},pr,{relatedTarget:0}),al=Qt(Ih),Lh=pt({},yo,{animationName:0,elapsedTime:0,pseudoElement:0}),Nh=Qt(Lh),Oh=pt({},yo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Dh=Qt(Oh),$h=pt({},yo,{data:0}),du=Qt($h),Fh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zh[e])?!!t[e]:!1}function ua(){return Gh}var Yh=pt({},pr,{key:function(e){if(e.key){var t=Fh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Bh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ua,charCode:function(e){return e.type==="keypress"?Zr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Hh=Qt(Yh),Wh=pt({},Fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),pu=Qt(Wh),Uh=pt({},pr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ua}),Xh=Qt(Uh),Vh=pt({},yo,{propertyName:0,elapsedTime:0,pseudoElement:0}),qh=Qt(Vh),Zh=pt({},Fi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Kh=Qt(Zh),Qh=[9,13,27,32],fa=Bn&&"CompositionEvent"in window,Fo=null;Bn&&"documentMode"in document&&(Fo=document.documentMode);var Jh=Bn&&"TextEvent"in window&&!Fo,Bd=Bn&&(!fa||Fo&&8<Fo&&11>=Fo),hu=String.fromCharCode(32),xu=!1;function zd(e,t){switch(e){case"keyup":return Qh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var zs=!1;function e1(e,t){switch(e){case"compositionend":return Gd(t);case"keypress":return t.which!==32?null:(xu=!0,hu);case"textInput":return e=t.data,e===hu&&xu?null:e;default:return null}}function t1(e,t){if(zs)return e==="compositionend"||!fa&&zd(e,t)?(e=Fd(),qr=ca=Qn=null,zs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bd&&t.locale!=="ko"?null:t.data;default:return null}}var n1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!n1[e.type]:t==="textarea"}function Yd(e,t,n,s){Sd(s),t=hi(t,"onChange"),0<t.length&&(n=new aa("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Bo=null,er=null;function s1(e){e0(e,0)}function Bi(e){var t=Hs(e);if(pd(t))return e}function o1(e,t){if(e==="change")return t}var Hd=!1;if(Bn){var ul;if(Bn){var fl="oninput"in document;if(!fl){var gu=document.createElement("div");gu.setAttribute("oninput","return;"),fl=typeof gu.oninput=="function"}ul=fl}else ul=!1;Hd=ul&&(!document.documentMode||9<document.documentMode)}function mu(){Bo&&(Bo.detachEvent("onpropertychange",Wd),er=Bo=null)}function Wd(e){if(e.propertyName==="value"&&Bi(er)){var t=[];Yd(t,er,e,sa(e)),jd(s1,t)}}function r1(e,t,n){e==="focusin"?(mu(),Bo=t,er=n,Bo.attachEvent("onpropertychange",Wd)):e==="focusout"&&mu()}function i1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Bi(er)}function l1(e,t){if(e==="click")return Bi(t)}function c1(e,t){if(e==="input"||e==="change")return Bi(t)}function a1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var kn=typeof Object.is=="function"?Object.is:a1;function tr(e,t){if(kn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Kl.call(t,r)||!kn(e[r],t[r]))return!1}return!0}function vu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Su(e,t){var n=vu(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=vu(n)}}function Ud(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Ud(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Xd(){for(var e=window,t=li();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=li(e.document)}return t}function da(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function u1(e){var t=Xd(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Ud(n.ownerDocument.documentElement,n)){if(s!==null&&da(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!e.extend&&o>s&&(r=s,s=o,o=r),r=Su(n,o);var l=Su(n,s);r&&l&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>s?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var f1=Bn&&"documentMode"in document&&11>=document.documentMode,Gs=null,yc=null,zo=null,gc=!1;function Cu(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;gc||Gs==null||Gs!==li(s)||(s=Gs,"selectionStart"in s&&da(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),zo&&tr(zo,s)||(zo=s,s=hi(yc,"onSelect"),0<s.length&&(t=new aa("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Gs)))}function jr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ys={animationend:jr("Animation","AnimationEnd"),animationiteration:jr("Animation","AnimationIteration"),animationstart:jr("Animation","AnimationStart"),transitionend:jr("Transition","TransitionEnd")},dl={},Vd={};Bn&&(Vd=document.createElement("div").style,"AnimationEvent"in window||(delete Ys.animationend.animation,delete Ys.animationiteration.animation,delete Ys.animationstart.animation),"TransitionEvent"in window||delete Ys.transitionend.transition);function zi(e){if(dl[e])return dl[e];if(!Ys[e])return e;var t=Ys[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Vd)return dl[e]=t[n];return e}var qd=zi("animationend"),Zd=zi("animationiteration"),Kd=zi("animationstart"),Qd=zi("transitionend"),Jd=new Map,ku="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ps(e,t){Jd.set(e,t),Ms(t,[e])}for(var pl=0;pl<ku.length;pl++){var hl=ku[pl],d1=hl.toLowerCase(),p1=hl[0].toUpperCase()+hl.slice(1);ps(d1,"on"+p1)}ps(qd,"onAnimationEnd");ps(Zd,"onAnimationIteration");ps(Kd,"onAnimationStart");ps("dblclick","onDoubleClick");ps("focusin","onFocus");ps("focusout","onBlur");ps(Qd,"onTransitionEnd");oo("onMouseEnter",["mouseout","mouseover"]);oo("onMouseLeave",["mouseout","mouseover"]);oo("onPointerEnter",["pointerout","pointerover"]);oo("onPointerLeave",["pointerout","pointerover"]);Ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ms("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lo));function wu(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,dh(s,t,void 0,e),e.currentTarget=null}function e0(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var l=s.length-1;0<=l;l--){var c=s[l],a=c.instance,u=c.currentTarget;if(c=c.listener,a!==o&&r.isPropagationStopped())break e;wu(r,c,u),o=a}else for(l=0;l<s.length;l++){if(c=s[l],a=c.instance,u=c.currentTarget,c=c.listener,a!==o&&r.isPropagationStopped())break e;wu(r,c,u),o=a}}}if(ai)throw e=dc,ai=!1,dc=null,e}function tt(e,t){var n=t[kc];n===void 0&&(n=t[kc]=new Set);var s=e+"__bubble";n.has(s)||(t0(t,e,2,!1),n.add(s))}function xl(e,t,n){var s=0;t&&(s|=4),t0(n,e,s,t)}var Pr="_reactListening"+Math.random().toString(36).slice(2);function nr(e){if(!e[Pr]){e[Pr]=!0,cd.forEach(function(n){n!=="selectionchange"&&(h1.has(n)||xl(n,!1,e),xl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Pr]||(t[Pr]=!0,xl("selectionchange",!1,t))}}function t0(e,t,n,s){switch($d(t)){case 1:var r=Mh;break;case 4:r=Th;break;default:r=la}n=r.bind(null,t,n,e),r=void 0,!fc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function yl(e,t,n,s,r){var o=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var l=s.tag;if(l===3||l===4){var c=s.stateNode.containerInfo;if(c===r||c.nodeType===8&&c.parentNode===r)break;if(l===4)for(l=s.return;l!==null;){var a=l.tag;if((a===3||a===4)&&(a=l.stateNode.containerInfo,a===r||a.nodeType===8&&a.parentNode===r))return;l=l.return}for(;c!==null;){if(l=ms(c),l===null)return;if(a=l.tag,a===5||a===6){s=o=l;continue e}c=c.parentNode}}s=s.return}jd(function(){var u=o,f=sa(n),d=[];e:{var p=Jd.get(e);if(p!==void 0){var y=aa,S=e;switch(e){case"keypress":if(Zr(n)===0)break e;case"keydown":case"keyup":y=Hh;break;case"focusin":S="focus",y=al;break;case"focusout":S="blur",y=al;break;case"beforeblur":case"afterblur":y=al;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=fu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=_h;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Xh;break;case qd:case Zd:case Kd:y=Nh;break;case Qd:y=qh;break;case"scroll":y=Eh;break;case"wheel":y=Kh;break;case"copy":case"cut":case"paste":y=Dh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=pu}var P=(t&4)!==0,j=!P&&e==="scroll",g=P?p!==null?p+"Capture":null:p;P=[];for(var h=u,x;h!==null;){x=h;var C=x.stateNode;if(x.tag===5&&C!==null&&(x=C,g!==null&&(C=Zo(h,g),C!=null&&P.push(sr(h,C,x)))),j)break;h=h.return}0<P.length&&(p=new y(p,S,null,n,f),d.push({event:p,listeners:P}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",p&&n!==ac&&(S=n.relatedTarget||n.fromElement)&&(ms(S)||S[zn]))break e;if((y||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,y?(S=n.relatedTarget||n.toElement,y=u,S=S?ms(S):null,S!==null&&(j=Ts(S),S!==j||S.tag!==5&&S.tag!==6)&&(S=null)):(y=null,S=u),y!==S)){if(P=fu,C="onMouseLeave",g="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(P=pu,C="onPointerLeave",g="onPointerEnter",h="pointer"),j=y==null?p:Hs(y),x=S==null?p:Hs(S),p=new P(C,h+"leave",y,n,f),p.target=j,p.relatedTarget=x,C=null,ms(f)===u&&(P=new P(g,h+"enter",S,n,f),P.target=x,P.relatedTarget=j,C=P),j=C,y&&S)t:{for(P=y,g=S,h=0,x=P;x;x=As(x))h++;for(x=0,C=g;C;C=As(C))x++;for(;0<h-x;)P=As(P),h--;for(;0<x-h;)g=As(g),x--;for(;h--;){if(P===g||g!==null&&P===g.alternate)break t;P=As(P),g=As(g)}P=null}else P=null;y!==null&&ju(d,p,y,P,!1),S!==null&&j!==null&&ju(d,j,S,P,!0)}}e:{if(p=u?Hs(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var R=o1;else if(yu(p))if(Hd)R=c1;else{R=i1;var w=r1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(R=l1);if(R&&(R=R(e,u))){Yd(d,R,n,f);break e}w&&w(e,p,u),e==="focusout"&&(w=p._wrapperState)&&w.controlled&&p.type==="number"&&oc(p,"number",p.value)}switch(w=u?Hs(u):window,e){case"focusin":(yu(w)||w.contentEditable==="true")&&(Gs=w,yc=u,zo=null);break;case"focusout":zo=yc=Gs=null;break;case"mousedown":gc=!0;break;case"contextmenu":case"mouseup":case"dragend":gc=!1,Cu(d,n,f);break;case"selectionchange":if(f1)break;case"keydown":case"keyup":Cu(d,n,f)}var k;if(fa)e:{switch(e){case"compositionstart":var m="onCompositionStart";break e;case"compositionend":m="onCompositionEnd";break e;case"compositionupdate":m="onCompositionUpdate";break e}m=void 0}else zs?zd(e,n)&&(m="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(m="onCompositionStart");m&&(Bd&&n.locale!=="ko"&&(zs||m!=="onCompositionStart"?m==="onCompositionEnd"&&zs&&(k=Fd()):(Qn=f,ca="value"in Qn?Qn.value:Qn.textContent,zs=!0)),w=hi(u,m),0<w.length&&(m=new du(m,e,null,n,f),d.push({event:m,listeners:w}),k?m.data=k:(k=Gd(n),k!==null&&(m.data=k)))),(k=Jh?e1(e,n):t1(e,n))&&(u=hi(u,"onBeforeInput"),0<u.length&&(f=new du("onBeforeInput","beforeinput",null,n,f),d.push({event:f,listeners:u}),f.data=k))}e0(d,t)})}function sr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function hi(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=Zo(e,n),o!=null&&s.unshift(sr(e,o,r)),o=Zo(e,t),o!=null&&s.push(sr(e,o,r))),e=e.return}return s}function As(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ju(e,t,n,s,r){for(var o=t._reactName,l=[];n!==null&&n!==s;){var c=n,a=c.alternate,u=c.stateNode;if(a!==null&&a===s)break;c.tag===5&&u!==null&&(c=u,r?(a=Zo(n,o),a!=null&&l.unshift(sr(n,a,c))):r||(a=Zo(n,o),a!=null&&l.push(sr(n,a,c)))),n=n.return}l.length!==0&&e.push({event:t,listeners:l})}var x1=/\r\n?/g,y1=/\u0000|\uFFFD/g;function Pu(e){return(typeof e=="string"?e:""+e).replace(x1,`
`).replace(y1,"")}function Rr(e,t,n){if(t=Pu(t),Pu(e)!==t&&n)throw Error(fe(425))}function xi(){}var mc=null,vc=null;function Sc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Cc=typeof setTimeout=="function"?setTimeout:void 0,g1=typeof clearTimeout=="function"?clearTimeout:void 0,Ru=typeof Promise=="function"?Promise:void 0,m1=typeof queueMicrotask=="function"?queueMicrotask:typeof Ru<"u"?function(e){return Ru.resolve(null).then(e).catch(v1)}:Cc;function v1(e){setTimeout(function(){throw e})}function gl(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),Jo(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Jo(t)}function ss(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function bu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var go=Math.random().toString(36).slice(2),bn="__reactFiber$"+go,or="__reactProps$"+go,zn="__reactContainer$"+go,kc="__reactEvents$"+go,S1="__reactListeners$"+go,C1="__reactHandles$"+go;function ms(e){var t=e[bn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[zn]||n[bn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=bu(e);e!==null;){if(n=e[bn])return n;e=bu(e)}return t}e=n,n=e.parentNode}return null}function hr(e){return e=e[bn]||e[zn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Hs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(fe(33))}function Gi(e){return e[or]||null}var wc=[],Ws=-1;function hs(e){return{current:e}}function nt(e){0>Ws||(e.current=wc[Ws],wc[Ws]=null,Ws--)}function et(e,t){Ws++,wc[Ws]=e.current,e.current=t}var us={},It=hs(us),zt=hs(!1),ws=us;function ro(e,t){var n=e.type.contextTypes;if(!n)return us;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Gt(e){return e=e.childContextTypes,e!=null}function yi(){nt(zt),nt(It)}function Mu(e,t,n){if(It.current!==us)throw Error(fe(168));et(It,t),et(zt,n)}function n0(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(fe(108,rh(e)||"Unknown",r));return pt({},n,s)}function gi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||us,ws=It.current,et(It,e),et(zt,zt.current),!0}function Tu(e,t,n){var s=e.stateNode;if(!s)throw Error(fe(169));n?(e=n0(e,t,ws),s.__reactInternalMemoizedMergedChildContext=e,nt(zt),nt(It),et(It,e)):nt(zt),et(zt,n)}var In=null,Yi=!1,ml=!1;function s0(e){In===null?In=[e]:In.push(e)}function k1(e){Yi=!0,s0(e)}function xs(){if(!ml&&In!==null){ml=!0;var e=0,t=Ke;try{var n=In;for(Ke=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}In=null,Yi=!1}catch(r){throw In!==null&&(In=In.slice(e+1)),Md(oa,xs),r}finally{Ke=t,ml=!1}}return null}var Us=[],Xs=0,mi=null,vi=0,nn=[],sn=0,js=null,Nn=1,On="";function ys(e,t){Us[Xs++]=vi,Us[Xs++]=mi,mi=e,vi=t}function o0(e,t,n){nn[sn++]=Nn,nn[sn++]=On,nn[sn++]=js,js=e;var s=Nn;e=On;var r=32-Sn(s)-1;s&=~(1<<r),n+=1;var o=32-Sn(t)+r;if(30<o){var l=r-r%5;o=(s&(1<<l)-1).toString(32),s>>=l,r-=l,Nn=1<<32-Sn(t)+r|n<<r|s,On=o+e}else Nn=1<<o|n<<r|s,On=e}function pa(e){e.return!==null&&(ys(e,1),o0(e,1,0))}function ha(e){for(;e===mi;)mi=Us[--Xs],Us[Xs]=null,vi=Us[--Xs],Us[Xs]=null;for(;e===js;)js=nn[--sn],nn[sn]=null,On=nn[--sn],nn[sn]=null,Nn=nn[--sn],nn[sn]=null}var Vt=null,Xt=null,ot=!1,pn=null;function r0(e,t){var n=rn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Eu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Vt=e,Xt=ss(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Vt=e,Xt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=js!==null?{id:Nn,overflow:On}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=rn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,Vt=e,Xt=null,!0):!1;default:return!1}}function jc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Pc(e){if(ot){var t=Xt;if(t){var n=t;if(!Eu(e,t)){if(jc(e))throw Error(fe(418));t=ss(n.nextSibling);var s=Vt;t&&Eu(e,t)?r0(s,n):(e.flags=e.flags&-4097|2,ot=!1,Vt=e)}}else{if(jc(e))throw Error(fe(418));e.flags=e.flags&-4097|2,ot=!1,Vt=e}}}function Au(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Vt=e}function br(e){if(e!==Vt)return!1;if(!ot)return Au(e),ot=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Sc(e.type,e.memoizedProps)),t&&(t=Xt)){if(jc(e))throw i0(),Error(fe(418));for(;t;)r0(e,t),t=ss(t.nextSibling)}if(Au(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(fe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Xt=ss(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Xt=null}}else Xt=Vt?ss(e.stateNode.nextSibling):null;return!0}function i0(){for(var e=Xt;e;)e=ss(e.nextSibling)}function io(){Xt=Vt=null,ot=!1}function xa(e){pn===null?pn=[e]:pn.push(e)}var w1=Hn.ReactCurrentBatchConfig;function wo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(fe(309));var s=n.stateNode}if(!s)throw Error(fe(147,e));var r=s,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=r.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(fe(284));if(!n._owner)throw Error(fe(290,e))}return e}function Mr(e,t){throw e=Object.prototype.toString.call(t),Error(fe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _u(e){var t=e._init;return t(e._payload)}function l0(e){function t(g,h){if(e){var x=g.deletions;x===null?(g.deletions=[h],g.flags|=16):x.push(h)}}function n(g,h){if(!e)return null;for(;h!==null;)t(g,h),h=h.sibling;return null}function s(g,h){for(g=new Map;h!==null;)h.key!==null?g.set(h.key,h):g.set(h.index,h),h=h.sibling;return g}function r(g,h){return g=ls(g,h),g.index=0,g.sibling=null,g}function o(g,h,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<h?(g.flags|=2,h):x):(g.flags|=2,h)):(g.flags|=1048576,h)}function l(g){return e&&g.alternate===null&&(g.flags|=2),g}function c(g,h,x,C){return h===null||h.tag!==6?(h=Pl(x,g.mode,C),h.return=g,h):(h=r(h,x),h.return=g,h)}function a(g,h,x,C){var R=x.type;return R===Bs?f(g,h,x.props.children,C,x.key):h!==null&&(h.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Vn&&_u(R)===h.type)?(C=r(h,x.props),C.ref=wo(g,h,x),C.return=g,C):(C=si(x.type,x.key,x.props,null,g.mode,C),C.ref=wo(g,h,x),C.return=g,C)}function u(g,h,x,C){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=Rl(x,g.mode,C),h.return=g,h):(h=r(h,x.children||[]),h.return=g,h)}function f(g,h,x,C,R){return h===null||h.tag!==7?(h=ks(x,g.mode,C,R),h.return=g,h):(h=r(h,x),h.return=g,h)}function d(g,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Pl(""+h,g.mode,x),h.return=g,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case gr:return x=si(h.type,h.key,h.props,null,g.mode,x),x.ref=wo(g,null,h),x.return=g,x;case Fs:return h=Rl(h,g.mode,x),h.return=g,h;case Vn:var C=h._init;return d(g,C(h._payload),x)}if(_o(h)||mo(h))return h=ks(h,g.mode,x,null),h.return=g,h;Mr(g,h)}return null}function p(g,h,x,C){var R=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return R!==null?null:c(g,h,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case gr:return x.key===R?a(g,h,x,C):null;case Fs:return x.key===R?u(g,h,x,C):null;case Vn:return R=x._init,p(g,h,R(x._payload),C)}if(_o(x)||mo(x))return R!==null?null:f(g,h,x,C,null);Mr(g,x)}return null}function y(g,h,x,C,R){if(typeof C=="string"&&C!==""||typeof C=="number")return g=g.get(x)||null,c(h,g,""+C,R);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case gr:return g=g.get(C.key===null?x:C.key)||null,a(h,g,C,R);case Fs:return g=g.get(C.key===null?x:C.key)||null,u(h,g,C,R);case Vn:var w=C._init;return y(g,h,x,w(C._payload),R)}if(_o(C)||mo(C))return g=g.get(x)||null,f(h,g,C,R,null);Mr(h,C)}return null}function S(g,h,x,C){for(var R=null,w=null,k=h,m=h=0,M=null;k!==null&&m<x.length;m++){k.index>m?(M=k,k=null):M=k.sibling;var I=p(g,k,x[m],C);if(I===null){k===null&&(k=M);break}e&&k&&I.alternate===null&&t(g,k),h=o(I,h,m),w===null?R=I:w.sibling=I,w=I,k=M}if(m===x.length)return n(g,k),ot&&ys(g,m),R;if(k===null){for(;m<x.length;m++)k=d(g,x[m],C),k!==null&&(h=o(k,h,m),w===null?R=k:w.sibling=k,w=k);return ot&&ys(g,m),R}for(k=s(g,k);m<x.length;m++)M=y(k,g,m,x[m],C),M!==null&&(e&&M.alternate!==null&&k.delete(M.key===null?m:M.key),h=o(M,h,m),w===null?R=M:w.sibling=M,w=M);return e&&k.forEach(function(L){return t(g,L)}),ot&&ys(g,m),R}function P(g,h,x,C){var R=mo(x);if(typeof R!="function")throw Error(fe(150));if(x=R.call(x),x==null)throw Error(fe(151));for(var w=R=null,k=h,m=h=0,M=null,I=x.next();k!==null&&!I.done;m++,I=x.next()){k.index>m?(M=k,k=null):M=k.sibling;var L=p(g,k,I.value,C);if(L===null){k===null&&(k=M);break}e&&k&&L.alternate===null&&t(g,k),h=o(L,h,m),w===null?R=L:w.sibling=L,w=L,k=M}if(I.done)return n(g,k),ot&&ys(g,m),R;if(k===null){for(;!I.done;m++,I=x.next())I=d(g,I.value,C),I!==null&&(h=o(I,h,m),w===null?R=I:w.sibling=I,w=I);return ot&&ys(g,m),R}for(k=s(g,k);!I.done;m++,I=x.next())I=y(k,g,m,I.value,C),I!==null&&(e&&I.alternate!==null&&k.delete(I.key===null?m:I.key),h=o(I,h,m),w===null?R=I:w.sibling=I,w=I);return e&&k.forEach(function(H){return t(g,H)}),ot&&ys(g,m),R}function j(g,h,x,C){if(typeof x=="object"&&x!==null&&x.type===Bs&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case gr:e:{for(var R=x.key,w=h;w!==null;){if(w.key===R){if(R=x.type,R===Bs){if(w.tag===7){n(g,w.sibling),h=r(w,x.props.children),h.return=g,g=h;break e}}else if(w.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Vn&&_u(R)===w.type){n(g,w.sibling),h=r(w,x.props),h.ref=wo(g,w,x),h.return=g,g=h;break e}n(g,w);break}else t(g,w);w=w.sibling}x.type===Bs?(h=ks(x.props.children,g.mode,C,x.key),h.return=g,g=h):(C=si(x.type,x.key,x.props,null,g.mode,C),C.ref=wo(g,h,x),C.return=g,g=C)}return l(g);case Fs:e:{for(w=x.key;h!==null;){if(h.key===w)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(g,h.sibling),h=r(h,x.children||[]),h.return=g,g=h;break e}else{n(g,h);break}else t(g,h);h=h.sibling}h=Rl(x,g.mode,C),h.return=g,g=h}return l(g);case Vn:return w=x._init,j(g,h,w(x._payload),C)}if(_o(x))return S(g,h,x,C);if(mo(x))return P(g,h,x,C);Mr(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(g,h.sibling),h=r(h,x),h.return=g,g=h):(n(g,h),h=Pl(x,g.mode,C),h.return=g,g=h),l(g)):n(g,h)}return j}var lo=l0(!0),c0=l0(!1),Si=hs(null),Ci=null,Vs=null,ya=null;function ga(){ya=Vs=Ci=null}function ma(e){var t=Si.current;nt(Si),e._currentValue=t}function Rc(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function no(e,t){Ci=e,ya=Vs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Bt=!0),e.firstContext=null)}function cn(e){var t=e._currentValue;if(ya!==e)if(e={context:e,memoizedValue:t,next:null},Vs===null){if(Ci===null)throw Error(fe(308));Vs=e,Ci.dependencies={lanes:0,firstContext:e}}else Vs=Vs.next=e;return t}var vs=null;function va(e){vs===null?vs=[e]:vs.push(e)}function a0(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,va(t)):(n.next=r.next,r.next=n),t.interleaved=n,Gn(e,s)}function Gn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var qn=!1;function Sa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function os(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,qe&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Gn(e,n)}return r=s.interleaved,r===null?(t.next=t,va(s)):(t.next=r.next,r.next=t),s.interleaved=t,Gn(e,n)}function Kr(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,ra(e,n)}}function Iu(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=l:o=o.next=l,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ki(e,t,n,s){var r=e.updateQueue;qn=!1;var o=r.firstBaseUpdate,l=r.lastBaseUpdate,c=r.shared.pending;if(c!==null){r.shared.pending=null;var a=c,u=a.next;a.next=null,l===null?o=u:l.next=u,l=a;var f=e.alternate;f!==null&&(f=f.updateQueue,c=f.lastBaseUpdate,c!==l&&(c===null?f.firstBaseUpdate=u:c.next=u,f.lastBaseUpdate=a))}if(o!==null){var d=r.baseState;l=0,f=u=a=null,c=o;do{var p=c.lane,y=c.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var S=e,P=c;switch(p=t,y=n,P.tag){case 1:if(S=P.payload,typeof S=="function"){d=S.call(y,d,p);break e}d=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=P.payload,p=typeof S=="function"?S.call(y,d,p):S,p==null)break e;d=pt({},d,p);break e;case 2:qn=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,p=r.effects,p===null?r.effects=[c]:p.push(c))}else y={eventTime:y,lane:p,tag:c.tag,payload:c.payload,callback:c.callback,next:null},f===null?(u=f=y,a=d):f=f.next=y,l|=p;if(c=c.next,c===null){if(c=r.shared.pending,c===null)break;p=c,c=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(f===null&&(a=d),r.baseState=a,r.firstBaseUpdate=u,r.lastBaseUpdate=f,t=r.shared.interleaved,t!==null){r=t;do l|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Rs|=l,e.lanes=l,e.memoizedState=d}}function Lu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(fe(191,r));r.call(s)}}}var xr={},Tn=hs(xr),rr=hs(xr),ir=hs(xr);function Ss(e){if(e===xr)throw Error(fe(174));return e}function Ca(e,t){switch(et(ir,t),et(rr,e),et(Tn,xr),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ic(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ic(t,e)}nt(Tn),et(Tn,t)}function co(){nt(Tn),nt(rr),nt(ir)}function f0(e){Ss(ir.current);var t=Ss(Tn.current),n=ic(t,e.type);t!==n&&(et(rr,e),et(Tn,n))}function ka(e){rr.current===e&&(nt(Tn),nt(rr))}var ut=hs(0);function wi(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var vl=[];function wa(){for(var e=0;e<vl.length;e++)vl[e]._workInProgressVersionPrimary=null;vl.length=0}var Qr=Hn.ReactCurrentDispatcher,Sl=Hn.ReactCurrentBatchConfig,Ps=0,dt=null,vt=null,jt=null,ji=!1,Go=!1,lr=0,j1=0;function Et(){throw Error(fe(321))}function ja(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!kn(e[n],t[n]))return!1;return!0}function Pa(e,t,n,s,r,o){if(Ps=o,dt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qr.current=e===null||e.memoizedState===null?M1:T1,e=n(s,r),Go){o=0;do{if(Go=!1,lr=0,25<=o)throw Error(fe(301));o+=1,jt=vt=null,t.updateQueue=null,Qr.current=E1,e=n(s,r)}while(Go)}if(Qr.current=Pi,t=vt!==null&&vt.next!==null,Ps=0,jt=vt=dt=null,ji=!1,t)throw Error(fe(300));return e}function Ra(){var e=lr!==0;return lr=0,e}function jn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jt===null?dt.memoizedState=jt=e:jt=jt.next=e,jt}function an(){if(vt===null){var e=dt.alternate;e=e!==null?e.memoizedState:null}else e=vt.next;var t=jt===null?dt.memoizedState:jt.next;if(t!==null)jt=t,vt=e;else{if(e===null)throw Error(fe(310));vt=e,e={memoizedState:vt.memoizedState,baseState:vt.baseState,baseQueue:vt.baseQueue,queue:vt.queue,next:null},jt===null?dt.memoizedState=jt=e:jt=jt.next=e}return jt}function cr(e,t){return typeof t=="function"?t(e):t}function Cl(e){var t=an(),n=t.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=e;var s=vt,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var l=r.next;r.next=o.next,o.next=l}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var c=l=null,a=null,u=o;do{var f=u.lane;if((Ps&f)===f)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var d={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(c=a=d,l=s):a=a.next=d,dt.lanes|=f,Rs|=f}u=u.next}while(u!==null&&u!==o);a===null?l=s:a.next=c,kn(s,t.memoizedState)||(Bt=!0),t.memoizedState=s,t.baseState=l,t.baseQueue=a,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do o=r.lane,dt.lanes|=o,Rs|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function kl(e){var t=an(),n=t.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var l=r=r.next;do o=e(o,l.action),l=l.next;while(l!==r);kn(o,t.memoizedState)||(Bt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function d0(){}function p0(e,t){var n=dt,s=an(),r=t(),o=!kn(s.memoizedState,r);if(o&&(s.memoizedState=r,Bt=!0),s=s.queue,ba(y0.bind(null,n,s,e),[e]),s.getSnapshot!==t||o||jt!==null&&jt.memoizedState.tag&1){if(n.flags|=2048,ar(9,x0.bind(null,n,s,r,t),void 0,null),Rt===null)throw Error(fe(349));Ps&30||h0(n,t,r)}return r}function h0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=dt.updateQueue,t===null?(t={lastEffect:null,stores:null},dt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function x0(e,t,n,s){t.value=n,t.getSnapshot=s,g0(t)&&m0(e)}function y0(e,t,n){return n(function(){g0(t)&&m0(e)})}function g0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!kn(e,n)}catch{return!0}}function m0(e){var t=Gn(e,1);t!==null&&Cn(t,e,1,-1)}function Nu(e){var t=jn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cr,lastRenderedState:e},t.queue=e,e=e.dispatch=b1.bind(null,dt,e),[t.memoizedState,e]}function ar(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=dt.updateQueue,t===null?(t={lastEffect:null,stores:null},dt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function v0(){return an().memoizedState}function Jr(e,t,n,s){var r=jn();dt.flags|=e,r.memoizedState=ar(1|t,n,void 0,s===void 0?null:s)}function Hi(e,t,n,s){var r=an();s=s===void 0?null:s;var o=void 0;if(vt!==null){var l=vt.memoizedState;if(o=l.destroy,s!==null&&ja(s,l.deps)){r.memoizedState=ar(t,n,o,s);return}}dt.flags|=e,r.memoizedState=ar(1|t,n,o,s)}function Ou(e,t){return Jr(8390656,8,e,t)}function ba(e,t){return Hi(2048,8,e,t)}function S0(e,t){return Hi(4,2,e,t)}function C0(e,t){return Hi(4,4,e,t)}function k0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function w0(e,t,n){return n=n!=null?n.concat([e]):null,Hi(4,4,k0.bind(null,t,e),n)}function Ma(){}function j0(e,t){var n=an();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&ja(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function P0(e,t){var n=an();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&ja(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function R0(e,t,n){return Ps&21?(kn(n,t)||(n=Ad(),dt.lanes|=n,Rs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Bt=!0),e.memoizedState=n)}function P1(e,t){var n=Ke;Ke=n!==0&&4>n?n:4,e(!0);var s=Sl.transition;Sl.transition={};try{e(!1),t()}finally{Ke=n,Sl.transition=s}}function b0(){return an().memoizedState}function R1(e,t,n){var s=is(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},M0(e))T0(t,n);else if(n=a0(e,t,n,s),n!==null){var r=Nt();Cn(n,e,s,r),E0(n,t,s)}}function b1(e,t,n){var s=is(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(M0(e))T0(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,n);if(r.hasEagerState=!0,r.eagerState=c,kn(c,l)){var a=t.interleaved;a===null?(r.next=r,va(t)):(r.next=a.next,a.next=r),t.interleaved=r;return}}catch{}finally{}n=a0(e,t,r,s),n!==null&&(r=Nt(),Cn(n,e,s,r),E0(n,t,s))}}function M0(e){var t=e.alternate;return e===dt||t!==null&&t===dt}function T0(e,t){Go=ji=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function E0(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,ra(e,n)}}var Pi={readContext:cn,useCallback:Et,useContext:Et,useEffect:Et,useImperativeHandle:Et,useInsertionEffect:Et,useLayoutEffect:Et,useMemo:Et,useReducer:Et,useRef:Et,useState:Et,useDebugValue:Et,useDeferredValue:Et,useTransition:Et,useMutableSource:Et,useSyncExternalStore:Et,useId:Et,unstable_isNewReconciler:!1},M1={readContext:cn,useCallback:function(e,t){return jn().memoizedState=[e,t===void 0?null:t],e},useContext:cn,useEffect:Ou,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Jr(4194308,4,k0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Jr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Jr(4,2,e,t)},useMemo:function(e,t){var n=jn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=jn();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=R1.bind(null,dt,e),[s.memoizedState,e]},useRef:function(e){var t=jn();return e={current:e},t.memoizedState=e},useState:Nu,useDebugValue:Ma,useDeferredValue:function(e){return jn().memoizedState=e},useTransition:function(){var e=Nu(!1),t=e[0];return e=P1.bind(null,e[1]),jn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=dt,r=jn();if(ot){if(n===void 0)throw Error(fe(407));n=n()}else{if(n=t(),Rt===null)throw Error(fe(349));Ps&30||h0(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Ou(y0.bind(null,s,o,e),[e]),s.flags|=2048,ar(9,x0.bind(null,s,o,n,t),void 0,null),n},useId:function(){var e=jn(),t=Rt.identifierPrefix;if(ot){var n=On,s=Nn;n=(s&~(1<<32-Sn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=lr++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=j1++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},T1={readContext:cn,useCallback:j0,useContext:cn,useEffect:ba,useImperativeHandle:w0,useInsertionEffect:S0,useLayoutEffect:C0,useMemo:P0,useReducer:Cl,useRef:v0,useState:function(){return Cl(cr)},useDebugValue:Ma,useDeferredValue:function(e){var t=an();return R0(t,vt.memoizedState,e)},useTransition:function(){var e=Cl(cr)[0],t=an().memoizedState;return[e,t]},useMutableSource:d0,useSyncExternalStore:p0,useId:b0,unstable_isNewReconciler:!1},E1={readContext:cn,useCallback:j0,useContext:cn,useEffect:ba,useImperativeHandle:w0,useInsertionEffect:S0,useLayoutEffect:C0,useMemo:P0,useReducer:kl,useRef:v0,useState:function(){return kl(cr)},useDebugValue:Ma,useDeferredValue:function(e){var t=an();return vt===null?t.memoizedState=e:R0(t,vt.memoizedState,e)},useTransition:function(){var e=kl(cr)[0],t=an().memoizedState;return[e,t]},useMutableSource:d0,useSyncExternalStore:p0,useId:b0,unstable_isNewReconciler:!1};function fn(e,t){if(e&&e.defaultProps){t=pt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function bc(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:pt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Wi={isMounted:function(e){return(e=e._reactInternals)?Ts(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Nt(),r=is(e),o=Fn(s,r);o.payload=t,n!=null&&(o.callback=n),t=os(e,o,r),t!==null&&(Cn(t,e,r,s),Kr(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Nt(),r=is(e),o=Fn(s,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=os(e,o,r),t!==null&&(Cn(t,e,r,s),Kr(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Nt(),s=is(e),r=Fn(n,s);r.tag=2,t!=null&&(r.callback=t),t=os(e,r,s),t!==null&&(Cn(t,e,s,n),Kr(t,e,s))}};function Du(e,t,n,s,r,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,o,l):t.prototype&&t.prototype.isPureReactComponent?!tr(n,s)||!tr(r,o):!0}function A0(e,t,n){var s=!1,r=us,o=t.contextType;return typeof o=="object"&&o!==null?o=cn(o):(r=Gt(t)?ws:It.current,s=t.contextTypes,o=(s=s!=null)?ro(e,r):us),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Wi,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function $u(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Wi.enqueueReplaceState(t,t.state,null)}function Mc(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Sa(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=cn(o):(o=Gt(t)?ws:It.current,r.context=ro(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(bc(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Wi.enqueueReplaceState(r,r.state,null),ki(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function ao(e,t){try{var n="",s=t;do n+=oh(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function wl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Tc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var A1=typeof WeakMap=="function"?WeakMap:Map;function _0(e,t,n){n=Fn(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){bi||(bi=!0,Fc=s),Tc(e,t)},n}function I0(e,t,n){n=Fn(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Tc(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Tc(e,t),typeof s!="function"&&(rs===null?rs=new Set([this]):rs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),n}function Fu(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new A1;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=W1.bind(null,e,t,n),t.then(e,e))}function Bu(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function zu(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Fn(-1,1),t.tag=2,os(n,t,1))),n.lanes|=1),e)}var _1=Hn.ReactCurrentOwner,Bt=!1;function Lt(e,t,n,s){t.child=e===null?c0(t,null,n,s):lo(t,e.child,n,s)}function Gu(e,t,n,s,r){n=n.render;var o=t.ref;return no(t,r),s=Pa(e,t,n,s,o,r),n=Ra(),e!==null&&!Bt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Yn(e,t,r)):(ot&&n&&pa(t),t.flags|=1,Lt(e,t,s,r),t.child)}function Yu(e,t,n,s,r){if(e===null){var o=n.type;return typeof o=="function"&&!Oa(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,L0(e,t,o,s,r)):(e=si(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var l=o.memoizedProps;if(n=n.compare,n=n!==null?n:tr,n(l,s)&&e.ref===t.ref)return Yn(e,t,r)}return t.flags|=1,e=ls(o,s),e.ref=t.ref,e.return=t,t.child=e}function L0(e,t,n,s,r){if(e!==null){var o=e.memoizedProps;if(tr(o,s)&&e.ref===t.ref)if(Bt=!1,t.pendingProps=s=o,(e.lanes&r)!==0)e.flags&131072&&(Bt=!0);else return t.lanes=e.lanes,Yn(e,t,r)}return Ec(e,t,n,s,r)}function N0(e,t,n){var s=t.pendingProps,r=s.children,o=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Zs,Ut),Ut|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,et(Zs,Ut),Ut|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,et(Zs,Ut),Ut|=s}else o!==null?(s=o.baseLanes|n,t.memoizedState=null):s=n,et(Zs,Ut),Ut|=s;return Lt(e,t,r,n),t.child}function O0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ec(e,t,n,s,r){var o=Gt(n)?ws:It.current;return o=ro(t,o),no(t,r),n=Pa(e,t,n,s,o,r),s=Ra(),e!==null&&!Bt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Yn(e,t,r)):(ot&&s&&pa(t),t.flags|=1,Lt(e,t,n,r),t.child)}function Hu(e,t,n,s,r){if(Gt(n)){var o=!0;gi(t)}else o=!1;if(no(t,r),t.stateNode===null)ei(e,t),A0(t,n,s),Mc(t,n,s,r),s=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var a=l.context,u=n.contextType;typeof u=="object"&&u!==null?u=cn(u):(u=Gt(n)?ws:It.current,u=ro(t,u));var f=n.getDerivedStateFromProps,d=typeof f=="function"||typeof l.getSnapshotBeforeUpdate=="function";d||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==s||a!==u)&&$u(t,l,s,u),qn=!1;var p=t.memoizedState;l.state=p,ki(t,s,l,r),a=t.memoizedState,c!==s||p!==a||zt.current||qn?(typeof f=="function"&&(bc(t,n,f,s),a=t.memoizedState),(c=qn||Du(t,n,c,s,p,a,u))?(d||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=a),l.props=s,l.state=a,l.context=u,s=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{l=t.stateNode,u0(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:fn(t.type,c),l.props=u,d=t.pendingProps,p=l.context,a=n.contextType,typeof a=="object"&&a!==null?a=cn(a):(a=Gt(n)?ws:It.current,a=ro(t,a));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==d||p!==a)&&$u(t,l,s,a),qn=!1,p=t.memoizedState,l.state=p,ki(t,s,l,r);var S=t.memoizedState;c!==d||p!==S||zt.current||qn?(typeof y=="function"&&(bc(t,n,y,s),S=t.memoizedState),(u=qn||Du(t,n,u,s,p,S,a)||!1)?(f||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(s,S,a),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(s,S,a)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=S),l.props=s,l.state=S,l.context=a,s=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return Ac(e,t,n,s,o,r)}function Ac(e,t,n,s,r,o){O0(e,t);var l=(t.flags&128)!==0;if(!s&&!l)return r&&Tu(t,n,!1),Yn(e,t,o);s=t.stateNode,_1.current=t;var c=l&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&l?(t.child=lo(t,e.child,null,o),t.child=lo(t,null,c,o)):Lt(e,t,c,o),t.memoizedState=s.state,r&&Tu(t,n,!0),t.child}function D0(e){var t=e.stateNode;t.pendingContext?Mu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Mu(e,t.context,!1),Ca(e,t.containerInfo)}function Wu(e,t,n,s,r){return io(),xa(r),t.flags|=256,Lt(e,t,n,s),t.child}var _c={dehydrated:null,treeContext:null,retryLane:0};function Ic(e){return{baseLanes:e,cachePool:null,transitions:null}}function $0(e,t,n){var s=t.pendingProps,r=ut.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(r&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),et(ut,r&1),e===null)return Pc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=Vi(l,s,0,null),e=ks(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Ic(n),t.memoizedState=_c,e):Ta(t,l));if(r=e.memoizedState,r!==null&&(c=r.dehydrated,c!==null))return I1(e,t,l,s,c,r,n);if(o){o=s.fallback,l=t.mode,r=e.child,c=r.sibling;var a={mode:"hidden",children:s.children};return!(l&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=a,t.deletions=null):(s=ls(r,a),s.subtreeFlags=r.subtreeFlags&14680064),c!==null?o=ls(c,o):(o=ks(o,l,n,null),o.flags|=2),o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=e.child.memoizedState,l=l===null?Ic(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=_c,s}return o=e.child,e=o.sibling,s=ls(o,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Ta(e,t){return t=Vi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Tr(e,t,n,s){return s!==null&&xa(s),lo(t,e.child,null,n),e=Ta(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function I1(e,t,n,s,r,o,l){if(n)return t.flags&256?(t.flags&=-257,s=wl(Error(fe(422))),Tr(e,t,l,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=s.fallback,r=t.mode,s=Vi({mode:"visible",children:s.children},r,0,null),o=ks(o,r,l,null),o.flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,t.mode&1&&lo(t,e.child,null,l),t.child.memoizedState=Ic(l),t.memoizedState=_c,o);if(!(t.mode&1))return Tr(e,t,l,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var c=s.dgst;return s=c,o=Error(fe(419)),s=wl(o,s,void 0),Tr(e,t,l,s)}if(c=(l&e.childLanes)!==0,Bt||c){if(s=Rt,s!==null){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|l)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Gn(e,r),Cn(s,e,r,-1))}return Na(),s=wl(Error(fe(421))),Tr(e,t,l,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=U1.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,Xt=ss(r.nextSibling),Vt=t,ot=!0,pn=null,e!==null&&(nn[sn++]=Nn,nn[sn++]=On,nn[sn++]=js,Nn=e.id,On=e.overflow,js=t),t=Ta(t,s.children),t.flags|=4096,t)}function Uu(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Rc(e.return,t,n)}function jl(e,t,n,s,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function F0(e,t,n){var s=t.pendingProps,r=s.revealOrder,o=s.tail;if(Lt(e,t,s.children,n),s=ut.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Uu(e,n,t);else if(e.tag===19)Uu(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(et(ut,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&wi(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),jl(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&wi(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}jl(t,!0,n,null,o);break;case"together":jl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ei(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Yn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Rs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(fe(153));if(t.child!==null){for(e=t.child,n=ls(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ls(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function L1(e,t,n){switch(t.tag){case 3:D0(t),io();break;case 5:f0(t);break;case 1:Gt(t.type)&&gi(t);break;case 4:Ca(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;et(Si,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(et(ut,ut.current&1),t.flags|=128,null):n&t.child.childLanes?$0(e,t,n):(et(ut,ut.current&1),e=Yn(e,t,n),e!==null?e.sibling:null);et(ut,ut.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return F0(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),et(ut,ut.current),s)break;return null;case 22:case 23:return t.lanes=0,N0(e,t,n)}return Yn(e,t,n)}var B0,Lc,z0,G0;B0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Lc=function(){};z0=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Ss(Tn.current);var o=null;switch(n){case"input":r=nc(e,r),s=nc(e,s),o=[];break;case"select":r=pt({},r,{value:void 0}),s=pt({},s,{value:void 0}),o=[];break;case"textarea":r=rc(e,r),s=rc(e,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=xi)}lc(n,s);var l;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var c=r[u];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Vo.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var a=s[u];if(c=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&a!==c&&(a!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||a&&a.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in a)a.hasOwnProperty(l)&&c[l]!==a[l]&&(n||(n={}),n[l]=a[l])}else n||(o||(o=[]),o.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,c=c?c.__html:void 0,a!=null&&c!==a&&(o=o||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Vo.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&tt("scroll",e),o||c===a||(o=[])):(o=o||[]).push(u,a))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};G0=function(e,t,n,s){n!==s&&(t.flags|=4)};function jo(e,t){if(!ot)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function At(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function N1(e,t,n){var s=t.pendingProps;switch(ha(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return At(t),null;case 1:return Gt(t.type)&&yi(),At(t),null;case 3:return s=t.stateNode,co(),nt(zt),nt(It),wa(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(br(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pn!==null&&(Gc(pn),pn=null))),Lc(e,t),At(t),null;case 5:ka(t);var r=Ss(ir.current);if(n=t.type,e!==null&&t.stateNode!=null)z0(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(fe(166));return At(t),null}if(e=Ss(Tn.current),br(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[bn]=t,s[or]=o,e=(t.mode&1)!==0,n){case"dialog":tt("cancel",s),tt("close",s);break;case"iframe":case"object":case"embed":tt("load",s);break;case"video":case"audio":for(r=0;r<Lo.length;r++)tt(Lo[r],s);break;case"source":tt("error",s);break;case"img":case"image":case"link":tt("error",s),tt("load",s);break;case"details":tt("toggle",s);break;case"input":tu(s,o),tt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},tt("invalid",s);break;case"textarea":su(s,o),tt("invalid",s)}lc(n,o),r=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?s.textContent!==c&&(o.suppressHydrationWarning!==!0&&Rr(s.textContent,c,e),r=["children",c]):typeof c=="number"&&s.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&Rr(s.textContent,c,e),r=["children",""+c]):Vo.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&tt("scroll",s)}switch(n){case"input":mr(s),nu(s,o,!0);break;case"textarea":mr(s),ou(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=xi)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{l=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=yd(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=l.createElement(n,{is:s.is}):(e=l.createElement(n),n==="select"&&(l=e,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):e=l.createElementNS(e,n),e[bn]=t,e[or]=s,B0(e,t,!1,!1),t.stateNode=e;e:{switch(l=cc(n,s),n){case"dialog":tt("cancel",e),tt("close",e),r=s;break;case"iframe":case"object":case"embed":tt("load",e),r=s;break;case"video":case"audio":for(r=0;r<Lo.length;r++)tt(Lo[r],e);r=s;break;case"source":tt("error",e),r=s;break;case"img":case"image":case"link":tt("error",e),tt("load",e),r=s;break;case"details":tt("toggle",e),r=s;break;case"input":tu(e,s),r=nc(e,s),tt("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=pt({},s,{value:void 0}),tt("invalid",e);break;case"textarea":su(e,s),r=rc(e,s),tt("invalid",e);break;default:r=s}lc(n,r),c=r;for(o in c)if(c.hasOwnProperty(o)){var a=c[o];o==="style"?vd(e,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&gd(e,a)):o==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&qo(e,a):typeof a=="number"&&qo(e,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Vo.hasOwnProperty(o)?a!=null&&o==="onScroll"&&tt("scroll",e):a!=null&&Jc(e,o,a,l))}switch(n){case"input":mr(e),nu(e,s,!1);break;case"textarea":mr(e),ou(e);break;case"option":s.value!=null&&e.setAttribute("value",""+as(s.value));break;case"select":e.multiple=!!s.multiple,o=s.value,o!=null?Qs(e,!!s.multiple,o,!1):s.defaultValue!=null&&Qs(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=xi)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return At(t),null;case 6:if(e&&t.stateNode!=null)G0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(fe(166));if(n=Ss(ir.current),Ss(Tn.current),br(t)){if(s=t.stateNode,n=t.memoizedProps,s[bn]=t,(o=s.nodeValue!==n)&&(e=Vt,e!==null))switch(e.tag){case 3:Rr(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Rr(s.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[bn]=t,t.stateNode=s}return At(t),null;case 13:if(nt(ut),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ot&&Xt!==null&&t.mode&1&&!(t.flags&128))i0(),io(),t.flags|=98560,o=!1;else if(o=br(t),s!==null&&s.dehydrated!==null){if(e===null){if(!o)throw Error(fe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(fe(317));o[bn]=t}else io(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;At(t),o=!1}else pn!==null&&(Gc(pn),pn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||ut.current&1?Ct===0&&(Ct=3):Na())),t.updateQueue!==null&&(t.flags|=4),At(t),null);case 4:return co(),Lc(e,t),e===null&&nr(t.stateNode.containerInfo),At(t),null;case 10:return ma(t.type._context),At(t),null;case 17:return Gt(t.type)&&yi(),At(t),null;case 19:if(nt(ut),o=t.memoizedState,o===null)return At(t),null;if(s=(t.flags&128)!==0,l=o.rendering,l===null)if(s)jo(o,!1);else{if(Ct!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=wi(e),l!==null){for(t.flags|=128,jo(o,!1),s=l.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)o=n,e=s,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return et(ut,ut.current&1|2),t.child}e=e.sibling}o.tail!==null&&xt()>uo&&(t.flags|=128,s=!0,jo(o,!1),t.lanes=4194304)}else{if(!s)if(e=wi(l),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),jo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!ot)return At(t),null}else 2*xt()-o.renderingStartTime>uo&&n!==1073741824&&(t.flags|=128,s=!0,jo(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(n=o.last,n!==null?n.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=xt(),t.sibling=null,n=ut.current,et(ut,s?n&1|2:n&1),t):(At(t),null);case 22:case 23:return La(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Ut&1073741824&&(At(t),t.subtreeFlags&6&&(t.flags|=8192)):At(t),null;case 24:return null;case 25:return null}throw Error(fe(156,t.tag))}function O1(e,t){switch(ha(t),t.tag){case 1:return Gt(t.type)&&yi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return co(),nt(zt),nt(It),wa(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return ka(t),null;case 13:if(nt(ut),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(fe(340));io()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return nt(ut),null;case 4:return co(),null;case 10:return ma(t.type._context),null;case 22:case 23:return La(),null;case 24:return null;default:return null}}var Er=!1,_t=!1,D1=typeof WeakSet=="function"?WeakSet:Set,Re=null;function qs(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){ht(e,t,s)}else n.current=null}function Nc(e,t,n){try{n()}catch(s){ht(e,t,s)}}var Xu=!1;function $1(e,t){if(mc=di,e=Xd(),da(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var l=0,c=-1,a=-1,u=0,f=0,d=e,p=null;t:for(;;){for(var y;d!==n||r!==0&&d.nodeType!==3||(c=l+r),d!==o||s!==0&&d.nodeType!==3||(a=l+s),d.nodeType===3&&(l+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===e)break t;if(p===n&&++u===r&&(c=l),p===o&&++f===s&&(a=l),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}n=c===-1||a===-1?null:{start:c,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(vc={focusedElem:e,selectionRange:n},di=!1,Re=t;Re!==null;)if(t=Re,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Re=e;else for(;Re!==null;){t=Re;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var P=S.memoizedProps,j=S.memoizedState,g=t.stateNode,h=g.getSnapshotBeforeUpdate(t.elementType===t.type?P:fn(t.type,P),j);g.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(C){ht(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,Re=e;break}Re=t.return}return S=Xu,Xu=!1,S}function Yo(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Nc(t,n,o)}r=r.next}while(r!==s)}}function Ui(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Oc(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Y0(e){var t=e.alternate;t!==null&&(e.alternate=null,Y0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[bn],delete t[or],delete t[kc],delete t[S1],delete t[C1])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function H0(e){return e.tag===5||e.tag===3||e.tag===4}function Vu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||H0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Dc(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=xi));else if(s!==4&&(e=e.child,e!==null))for(Dc(e,t,n),e=e.sibling;e!==null;)Dc(e,t,n),e=e.sibling}function $c(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for($c(e,t,n),e=e.sibling;e!==null;)$c(e,t,n),e=e.sibling}var bt=null,dn=!1;function Un(e,t,n){for(n=n.child;n!==null;)W0(e,t,n),n=n.sibling}function W0(e,t,n){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount($i,n)}catch{}switch(n.tag){case 5:_t||qs(n,t);case 6:var s=bt,r=dn;bt=null,Un(e,t,n),bt=s,dn=r,bt!==null&&(dn?(e=bt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):bt.removeChild(n.stateNode));break;case 18:bt!==null&&(dn?(e=bt,n=n.stateNode,e.nodeType===8?gl(e.parentNode,n):e.nodeType===1&&gl(e,n),Jo(e)):gl(bt,n.stateNode));break;case 4:s=bt,r=dn,bt=n.stateNode.containerInfo,dn=!0,Un(e,t,n),bt=s,dn=r;break;case 0:case 11:case 14:case 15:if(!_t&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&Nc(n,t,l),r=r.next}while(r!==s)}Un(e,t,n);break;case 1:if(!_t&&(qs(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(c){ht(n,t,c)}Un(e,t,n);break;case 21:Un(e,t,n);break;case 22:n.mode&1?(_t=(s=_t)||n.memoizedState!==null,Un(e,t,n),_t=s):Un(e,t,n);break;default:Un(e,t,n)}}function qu(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new D1),t.forEach(function(s){var r=X1.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function un(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:bt=c.stateNode,dn=!1;break e;case 3:bt=c.stateNode.containerInfo,dn=!0;break e;case 4:bt=c.stateNode.containerInfo,dn=!0;break e}c=c.return}if(bt===null)throw Error(fe(160));W0(o,l,r),bt=null,dn=!1;var a=r.alternate;a!==null&&(a.return=null),r.return=null}catch(u){ht(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)U0(t,e),t=t.sibling}function U0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(un(t,e),wn(e),s&4){try{Yo(3,e,e.return),Ui(3,e)}catch(P){ht(e,e.return,P)}try{Yo(5,e,e.return)}catch(P){ht(e,e.return,P)}}break;case 1:un(t,e),wn(e),s&512&&n!==null&&qs(n,n.return);break;case 5:if(un(t,e),wn(e),s&512&&n!==null&&qs(n,n.return),e.flags&32){var r=e.stateNode;try{qo(r,"")}catch(P){ht(e,e.return,P)}}if(s&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,l=n!==null?n.memoizedProps:o,c=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&hd(r,o),cc(c,l);var u=cc(c,o);for(l=0;l<a.length;l+=2){var f=a[l],d=a[l+1];f==="style"?vd(r,d):f==="dangerouslySetInnerHTML"?gd(r,d):f==="children"?qo(r,d):Jc(r,f,d,u)}switch(c){case"input":sc(r,o);break;case"textarea":xd(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?Qs(r,!!o.multiple,y,!1):p!==!!o.multiple&&(o.defaultValue!=null?Qs(r,!!o.multiple,o.defaultValue,!0):Qs(r,!!o.multiple,o.multiple?[]:"",!1))}r[or]=o}catch(P){ht(e,e.return,P)}}break;case 6:if(un(t,e),wn(e),s&4){if(e.stateNode===null)throw Error(fe(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(P){ht(e,e.return,P)}}break;case 3:if(un(t,e),wn(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Jo(t.containerInfo)}catch(P){ht(e,e.return,P)}break;case 4:un(t,e),wn(e);break;case 13:un(t,e),wn(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(_a=xt())),s&4&&qu(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(_t=(u=_t)||f,un(t,e),_t=u):un(t,e),wn(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!f&&e.mode&1)for(Re=e,f=e.child;f!==null;){for(d=Re=f;Re!==null;){switch(p=Re,y=p.child,p.tag){case 0:case 11:case 14:case 15:Yo(4,p,p.return);break;case 1:qs(p,p.return);var S=p.stateNode;if(typeof S.componentWillUnmount=="function"){s=p,n=p.return;try{t=s,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(P){ht(s,n,P)}}break;case 5:qs(p,p.return);break;case 22:if(p.memoizedState!==null){Ku(d);continue}}y!==null?(y.return=p,Re=y):Ku(d)}f=f.sibling}e:for(f=null,d=e;;){if(d.tag===5){if(f===null){f=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=d.stateNode,a=d.memoizedProps.style,l=a!=null&&a.hasOwnProperty("display")?a.display:null,c.style.display=md("display",l))}catch(P){ht(e,e.return,P)}}}else if(d.tag===6){if(f===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(P){ht(e,e.return,P)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:un(t,e),wn(e),s&4&&qu(e);break;case 21:break;default:un(t,e),wn(e)}}function wn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(H0(n)){var s=n;break e}n=n.return}throw Error(fe(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(qo(r,""),s.flags&=-33);var o=Vu(e);$c(e,o,r);break;case 3:case 4:var l=s.stateNode.containerInfo,c=Vu(e);Dc(e,c,l);break;default:throw Error(fe(161))}}catch(a){ht(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function F1(e,t,n){Re=e,X0(e)}function X0(e,t,n){for(var s=(e.mode&1)!==0;Re!==null;){var r=Re,o=r.child;if(r.tag===22&&s){var l=r.memoizedState!==null||Er;if(!l){var c=r.alternate,a=c!==null&&c.memoizedState!==null||_t;c=Er;var u=_t;if(Er=l,(_t=a)&&!u)for(Re=r;Re!==null;)l=Re,a=l.child,l.tag===22&&l.memoizedState!==null?Qu(r):a!==null?(a.return=l,Re=a):Qu(r);for(;o!==null;)Re=o,X0(o),o=o.sibling;Re=r,Er=c,_t=u}Zu(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Re=o):Zu(e)}}function Zu(e){for(;Re!==null;){var t=Re;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:_t||Ui(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!_t)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:fn(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Lu(t,o,s);break;case 3:var l=t.updateQueue;if(l!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Lu(t,l,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var d=f.dehydrated;d!==null&&Jo(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}_t||t.flags&512&&Oc(t)}catch(p){ht(t,t.return,p)}}if(t===e){Re=null;break}if(n=t.sibling,n!==null){n.return=t.return,Re=n;break}Re=t.return}}function Ku(e){for(;Re!==null;){var t=Re;if(t===e){Re=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Re=n;break}Re=t.return}}function Qu(e){for(;Re!==null;){var t=Re;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Ui(4,t)}catch(a){ht(t,n,a)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(a){ht(t,r,a)}}var o=t.return;try{Oc(t)}catch(a){ht(t,o,a)}break;case 5:var l=t.return;try{Oc(t)}catch(a){ht(t,l,a)}}}catch(a){ht(t,t.return,a)}if(t===e){Re=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Re=c;break}Re=t.return}}var B1=Math.ceil,Ri=Hn.ReactCurrentDispatcher,Ea=Hn.ReactCurrentOwner,ln=Hn.ReactCurrentBatchConfig,qe=0,Rt=null,gt=null,Mt=0,Ut=0,Zs=hs(0),Ct=0,ur=null,Rs=0,Xi=0,Aa=0,Ho=null,Ft=null,_a=0,uo=1/0,_n=null,bi=!1,Fc=null,rs=null,Ar=!1,Jn=null,Mi=0,Wo=0,Bc=null,ti=-1,ni=0;function Nt(){return qe&6?xt():ti!==-1?ti:ti=xt()}function is(e){return e.mode&1?qe&2&&Mt!==0?Mt&-Mt:w1.transition!==null?(ni===0&&(ni=Ad()),ni):(e=Ke,e!==0||(e=window.event,e=e===void 0?16:$d(e.type)),e):1}function Cn(e,t,n,s){if(50<Wo)throw Wo=0,Bc=null,Error(fe(185));dr(e,n,s),(!(qe&2)||e!==Rt)&&(e===Rt&&(!(qe&2)&&(Xi|=n),Ct===4&&Kn(e,Mt)),Yt(e,s),n===1&&qe===0&&!(t.mode&1)&&(uo=xt()+500,Yi&&xs()))}function Yt(e,t){var n=e.callbackNode;wh(e,t);var s=fi(e,e===Rt?Mt:0);if(s===0)n!==null&&lu(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&lu(n),t===1)e.tag===0?k1(Ju.bind(null,e)):s0(Ju.bind(null,e)),m1(function(){!(qe&6)&&xs()}),n=null;else{switch(_d(s)){case 1:n=oa;break;case 4:n=Td;break;case 16:n=ui;break;case 536870912:n=Ed;break;default:n=ui}n=tp(n,V0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function V0(e,t){if(ti=-1,ni=0,qe&6)throw Error(fe(327));var n=e.callbackNode;if(so()&&e.callbackNode!==n)return null;var s=fi(e,e===Rt?Mt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=Ti(e,s);else{t=s;var r=qe;qe|=2;var o=Z0();(Rt!==e||Mt!==t)&&(_n=null,uo=xt()+500,Cs(e,t));do try{Y1();break}catch(c){q0(e,c)}while(1);ga(),Ri.current=o,qe=r,gt!==null?t=0:(Rt=null,Mt=0,t=Ct)}if(t!==0){if(t===2&&(r=pc(e),r!==0&&(s=r,t=zc(e,r))),t===1)throw n=ur,Cs(e,0),Kn(e,s),Yt(e,xt()),n;if(t===6)Kn(e,s);else{if(r=e.current.alternate,!(s&30)&&!z1(r)&&(t=Ti(e,s),t===2&&(o=pc(e),o!==0&&(s=o,t=zc(e,o))),t===1))throw n=ur,Cs(e,0),Kn(e,s),Yt(e,xt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(fe(345));case 2:gs(e,Ft,_n);break;case 3:if(Kn(e,s),(s&130023424)===s&&(t=_a+500-xt(),10<t)){if(fi(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Nt(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Cc(gs.bind(null,e,Ft,_n),t);break}gs(e,Ft,_n);break;case 4:if(Kn(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var l=31-Sn(s);o=1<<l,l=t[l],l>r&&(r=l),s&=~o}if(s=r,s=xt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*B1(s/1960))-s,10<s){e.timeoutHandle=Cc(gs.bind(null,e,Ft,_n),s);break}gs(e,Ft,_n);break;case 5:gs(e,Ft,_n);break;default:throw Error(fe(329))}}}return Yt(e,xt()),e.callbackNode===n?V0.bind(null,e):null}function zc(e,t){var n=Ho;return e.current.memoizedState.isDehydrated&&(Cs(e,t).flags|=256),e=Ti(e,t),e!==2&&(t=Ft,Ft=n,t!==null&&Gc(t)),e}function Gc(e){Ft===null?Ft=e:Ft.push.apply(Ft,e)}function z1(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!kn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kn(e,t){for(t&=~Aa,t&=~Xi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Sn(t),s=1<<n;e[n]=-1,t&=~s}}function Ju(e){if(qe&6)throw Error(fe(327));so();var t=fi(e,0);if(!(t&1))return Yt(e,xt()),null;var n=Ti(e,t);if(e.tag!==0&&n===2){var s=pc(e);s!==0&&(t=s,n=zc(e,s))}if(n===1)throw n=ur,Cs(e,0),Kn(e,t),Yt(e,xt()),n;if(n===6)throw Error(fe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,gs(e,Ft,_n),Yt(e,xt()),null}function Ia(e,t){var n=qe;qe|=1;try{return e(t)}finally{qe=n,qe===0&&(uo=xt()+500,Yi&&xs())}}function bs(e){Jn!==null&&Jn.tag===0&&!(qe&6)&&so();var t=qe;qe|=1;var n=ln.transition,s=Ke;try{if(ln.transition=null,Ke=1,e)return e()}finally{Ke=s,ln.transition=n,qe=t,!(qe&6)&&xs()}}function La(){Ut=Zs.current,nt(Zs)}function Cs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,g1(n)),gt!==null)for(n=gt.return;n!==null;){var s=n;switch(ha(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&yi();break;case 3:co(),nt(zt),nt(It),wa();break;case 5:ka(s);break;case 4:co();break;case 13:nt(ut);break;case 19:nt(ut);break;case 10:ma(s.type._context);break;case 22:case 23:La()}n=n.return}if(Rt=e,gt=e=ls(e.current,null),Mt=Ut=t,Ct=0,ur=null,Aa=Xi=Rs=0,Ft=Ho=null,vs!==null){for(t=0;t<vs.length;t++)if(n=vs[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var l=o.next;o.next=r,s.next=l}n.pending=s}vs=null}return e}function q0(e,t){do{var n=gt;try{if(ga(),Qr.current=Pi,ji){for(var s=dt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}ji=!1}if(Ps=0,jt=vt=dt=null,Go=!1,lr=0,Ea.current=null,n===null||n.return===null){Ct=1,ur=t,gt=null;break}e:{var o=e,l=n.return,c=n,a=t;if(t=Mt,c.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,f=c,d=f.tag;if(!(f.mode&1)&&(d===0||d===11||d===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=Bu(l);if(y!==null){y.flags&=-257,zu(y,l,c,o,t),y.mode&1&&Fu(o,u,t),t=y,a=u;var S=t.updateQueue;if(S===null){var P=new Set;P.add(a),t.updateQueue=P}else S.add(a);break e}else{if(!(t&1)){Fu(o,u,t),Na();break e}a=Error(fe(426))}}else if(ot&&c.mode&1){var j=Bu(l);if(j!==null){!(j.flags&65536)&&(j.flags|=256),zu(j,l,c,o,t),xa(ao(a,c));break e}}o=a=ao(a,c),Ct!==4&&(Ct=2),Ho===null?Ho=[o]:Ho.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var g=_0(o,a,t);Iu(o,g);break e;case 1:c=a;var h=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(rs===null||!rs.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var C=I0(o,c,t);Iu(o,C);break e}}o=o.return}while(o!==null)}Q0(n)}catch(R){t=R,gt===n&&n!==null&&(gt=n=n.return);continue}break}while(1)}function Z0(){var e=Ri.current;return Ri.current=Pi,e===null?Pi:e}function Na(){(Ct===0||Ct===3||Ct===2)&&(Ct=4),Rt===null||!(Rs&268435455)&&!(Xi&268435455)||Kn(Rt,Mt)}function Ti(e,t){var n=qe;qe|=2;var s=Z0();(Rt!==e||Mt!==t)&&(_n=null,Cs(e,t));do try{G1();break}catch(r){q0(e,r)}while(1);if(ga(),qe=n,Ri.current=s,gt!==null)throw Error(fe(261));return Rt=null,Mt=0,Ct}function G1(){for(;gt!==null;)K0(gt)}function Y1(){for(;gt!==null&&!hh();)K0(gt)}function K0(e){var t=ep(e.alternate,e,Ut);e.memoizedProps=e.pendingProps,t===null?Q0(e):gt=t,Ea.current=null}function Q0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=O1(n,t),n!==null){n.flags&=32767,gt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ct=6,gt=null;return}}else if(n=N1(n,t,Ut),n!==null){gt=n;return}if(t=t.sibling,t!==null){gt=t;return}gt=t=e}while(t!==null);Ct===0&&(Ct=5)}function gs(e,t,n){var s=Ke,r=ln.transition;try{ln.transition=null,Ke=1,H1(e,t,n,s)}finally{ln.transition=r,Ke=s}return null}function H1(e,t,n,s){do so();while(Jn!==null);if(qe&6)throw Error(fe(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(fe(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(jh(e,o),e===Rt&&(gt=Rt=null,Mt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ar||(Ar=!0,tp(ui,function(){return so(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=ln.transition,ln.transition=null;var l=Ke;Ke=1;var c=qe;qe|=4,Ea.current=null,$1(e,n),U0(n,e),u1(vc),di=!!mc,vc=mc=null,e.current=n,F1(n),xh(),qe=c,Ke=l,ln.transition=o}else e.current=n;if(Ar&&(Ar=!1,Jn=e,Mi=r),o=e.pendingLanes,o===0&&(rs=null),mh(n.stateNode),Yt(e,xt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(bi)throw bi=!1,e=Fc,Fc=null,e;return Mi&1&&e.tag!==0&&so(),o=e.pendingLanes,o&1?e===Bc?Wo++:(Wo=0,Bc=e):Wo=0,xs(),null}function so(){if(Jn!==null){var e=_d(Mi),t=ln.transition,n=Ke;try{if(ln.transition=null,Ke=16>e?16:e,Jn===null)var s=!1;else{if(e=Jn,Jn=null,Mi=0,qe&6)throw Error(fe(331));var r=qe;for(qe|=4,Re=e.current;Re!==null;){var o=Re,l=o.child;if(Re.flags&16){var c=o.deletions;if(c!==null){for(var a=0;a<c.length;a++){var u=c[a];for(Re=u;Re!==null;){var f=Re;switch(f.tag){case 0:case 11:case 15:Yo(8,f,o)}var d=f.child;if(d!==null)d.return=f,Re=d;else for(;Re!==null;){f=Re;var p=f.sibling,y=f.return;if(Y0(f),f===u){Re=null;break}if(p!==null){p.return=y,Re=p;break}Re=y}}}var S=o.alternate;if(S!==null){var P=S.child;if(P!==null){S.child=null;do{var j=P.sibling;P.sibling=null,P=j}while(P!==null)}}Re=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Re=l;else e:for(;Re!==null;){if(o=Re,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Yo(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,Re=g;break e}Re=o.return}}var h=e.current;for(Re=h;Re!==null;){l=Re;var x=l.child;if(l.subtreeFlags&2064&&x!==null)x.return=l,Re=x;else e:for(l=h;Re!==null;){if(c=Re,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Ui(9,c)}}catch(R){ht(c,c.return,R)}if(c===l){Re=null;break e}var C=c.sibling;if(C!==null){C.return=c.return,Re=C;break e}Re=c.return}}if(qe=r,xs(),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot($i,e)}catch{}s=!0}return s}finally{Ke=n,ln.transition=t}}return!1}function ef(e,t,n){t=ao(n,t),t=_0(e,t,1),e=os(e,t,1),t=Nt(),e!==null&&(dr(e,1,t),Yt(e,t))}function ht(e,t,n){if(e.tag===3)ef(e,e,n);else for(;t!==null;){if(t.tag===3){ef(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(rs===null||!rs.has(s))){e=ao(n,e),e=I0(t,e,1),t=os(t,e,1),e=Nt(),t!==null&&(dr(t,1,e),Yt(t,e));break}}t=t.return}}function W1(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Nt(),e.pingedLanes|=e.suspendedLanes&n,Rt===e&&(Mt&n)===n&&(Ct===4||Ct===3&&(Mt&130023424)===Mt&&500>xt()-_a?Cs(e,0):Aa|=n),Yt(e,t)}function J0(e,t){t===0&&(e.mode&1?(t=Cr,Cr<<=1,!(Cr&130023424)&&(Cr=4194304)):t=1);var n=Nt();e=Gn(e,t),e!==null&&(dr(e,t,n),Yt(e,n))}function U1(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),J0(e,n)}function X1(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(fe(314))}s!==null&&s.delete(t),J0(e,n)}var ep;ep=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||zt.current)Bt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Bt=!1,L1(e,t,n);Bt=!!(e.flags&131072)}else Bt=!1,ot&&t.flags&1048576&&o0(t,vi,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;ei(e,t),e=t.pendingProps;var r=ro(t,It.current);no(t,n),r=Pa(null,t,s,e,r,n);var o=Ra();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Gt(s)?(o=!0,gi(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Sa(t),r.updater=Wi,t.stateNode=r,r._reactInternals=t,Mc(t,s,e,n),t=Ac(null,t,s,!0,o,n)):(t.tag=0,ot&&o&&pa(t),Lt(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(ei(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=q1(s),e=fn(s,e),r){case 0:t=Ec(null,t,s,e,n);break e;case 1:t=Hu(null,t,s,e,n);break e;case 11:t=Gu(null,t,s,e,n);break e;case 14:t=Yu(null,t,s,fn(s.type,e),n);break e}throw Error(fe(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Ec(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Hu(e,t,s,r,n);case 3:e:{if(D0(t),e===null)throw Error(fe(387));s=t.pendingProps,o=t.memoizedState,r=o.element,u0(e,t),ki(t,s,null,n);var l=t.memoizedState;if(s=l.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=ao(Error(fe(423)),t),t=Wu(e,t,s,n,r);break e}else if(s!==r){r=ao(Error(fe(424)),t),t=Wu(e,t,s,n,r);break e}else for(Xt=ss(t.stateNode.containerInfo.firstChild),Vt=t,ot=!0,pn=null,n=c0(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(io(),s===r){t=Yn(e,t,n);break e}Lt(e,t,s,n)}t=t.child}return t;case 5:return f0(t),e===null&&Pc(t),s=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,l=r.children,Sc(s,r)?l=null:o!==null&&Sc(s,o)&&(t.flags|=32),O0(e,t),Lt(e,t,l,n),t.child;case 6:return e===null&&Pc(t),null;case 13:return $0(e,t,n);case 4:return Ca(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=lo(t,null,s,n):Lt(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Gu(e,t,s,r,n);case 7:return Lt(e,t,t.pendingProps,n),t.child;case 8:return Lt(e,t,t.pendingProps.children,n),t.child;case 12:return Lt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,o=t.memoizedProps,l=r.value,et(Si,s._currentValue),s._currentValue=l,o!==null)if(kn(o.value,l)){if(o.children===r.children&&!zt.current){t=Yn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var a=c.firstContext;a!==null;){if(a.context===s){if(o.tag===1){a=Fn(-1,n&-n),a.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?a.next=a:(a.next=f.next,f.next=a),u.pending=a}}o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Rc(o.return,n,t),c.lanes|=n;break}a=a.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(fe(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),Rc(l,n,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}Lt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,no(t,n),r=cn(r),s=s(r),t.flags|=1,Lt(e,t,s,n),t.child;case 14:return s=t.type,r=fn(s,t.pendingProps),r=fn(s.type,r),Yu(e,t,s,r,n);case 15:return L0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),ei(e,t),t.tag=1,Gt(s)?(e=!0,gi(t)):e=!1,no(t,n),A0(t,s,r),Mc(t,s,r,n),Ac(null,t,s,!0,e,n);case 19:return F0(e,t,n);case 22:return N0(e,t,n)}throw Error(fe(156,t.tag))};function tp(e,t){return Md(e,t)}function V1(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rn(e,t,n,s){return new V1(e,t,n,s)}function Oa(e){return e=e.prototype,!(!e||!e.isReactComponent)}function q1(e){if(typeof e=="function")return Oa(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ta)return 11;if(e===na)return 14}return 2}function ls(e,t){var n=e.alternate;return n===null?(n=rn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function si(e,t,n,s,r,o){var l=2;if(s=e,typeof e=="function")Oa(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Bs:return ks(n.children,r,o,t);case ea:l=8,r|=8;break;case Ql:return e=rn(12,n,t,r|2),e.elementType=Ql,e.lanes=o,e;case Jl:return e=rn(13,n,t,r),e.elementType=Jl,e.lanes=o,e;case ec:return e=rn(19,n,t,r),e.elementType=ec,e.lanes=o,e;case fd:return Vi(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ad:l=10;break e;case ud:l=9;break e;case ta:l=11;break e;case na:l=14;break e;case Vn:l=16,s=null;break e}throw Error(fe(130,e==null?e:typeof e,""))}return t=rn(l,n,t,r),t.elementType=e,t.type=s,t.lanes=o,t}function ks(e,t,n,s){return e=rn(7,e,s,t),e.lanes=n,e}function Vi(e,t,n,s){return e=rn(22,e,s,t),e.elementType=fd,e.lanes=n,e.stateNode={isHidden:!1},e}function Pl(e,t,n){return e=rn(6,e,null,t),e.lanes=n,e}function Rl(e,t,n){return t=rn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Z1(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=il(0),this.expirationTimes=il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=il(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Da(e,t,n,s,r,o,l,c,a){return e=new Z1(e,t,n,c,a),t===1?(t=1,o===!0&&(t|=8)):t=0,o=rn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Sa(o),e}function K1(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fs,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function np(e){if(!e)return us;e=e._reactInternals;e:{if(Ts(e)!==e||e.tag!==1)throw Error(fe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Gt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(fe(171))}if(e.tag===1){var n=e.type;if(Gt(n))return n0(e,n,t)}return t}function sp(e,t,n,s,r,o,l,c,a){return e=Da(n,s,!0,e,r,o,l,c,a),e.context=np(null),n=e.current,s=Nt(),r=is(n),o=Fn(s,r),o.callback=t??null,os(n,o,r),e.current.lanes=r,dr(e,r,s),Yt(e,s),e}function qi(e,t,n,s){var r=t.current,o=Nt(),l=is(r);return n=np(n),t.context===null?t.context=n:t.pendingContext=n,t=Fn(o,l),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=os(r,t,l),e!==null&&(Cn(e,r,l,o),Kr(e,r,l)),l}function Ei(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function tf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function $a(e,t){tf(e,t),(e=e.alternate)&&tf(e,t)}function Q1(){return null}var op=typeof reportError=="function"?reportError:function(e){console.error(e)};function Fa(e){this._internalRoot=e}Zi.prototype.render=Fa.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(fe(409));qi(e,t,null,null)};Zi.prototype.unmount=Fa.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;bs(function(){qi(null,e,null,null)}),t[zn]=null}};function Zi(e){this._internalRoot=e}Zi.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nd();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Zn.length&&t!==0&&t<Zn[n].priority;n++);Zn.splice(n,0,e),n===0&&Dd(e)}};function Ba(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ki(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function nf(){}function J1(e,t,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Ei(l);o.call(u)}}var l=sp(t,s,e,0,null,!1,!1,"",nf);return e._reactRootContainer=l,e[zn]=l.current,nr(e.nodeType===8?e.parentNode:e),bs(),l}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var c=s;s=function(){var u=Ei(a);c.call(u)}}var a=Da(e,0,!1,null,null,!1,!1,"",nf);return e._reactRootContainer=a,e[zn]=a.current,nr(e.nodeType===8?e.parentNode:e),bs(function(){qi(t,a,n,s)}),a}function Qi(e,t,n,s,r){var o=n._reactRootContainer;if(o){var l=o;if(typeof r=="function"){var c=r;r=function(){var a=Ei(l);c.call(a)}}qi(t,l,e,r)}else l=J1(n,t,e,r,s);return Ei(l)}Id=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Io(t.pendingLanes);n!==0&&(ra(t,n|1),Yt(t,xt()),!(qe&6)&&(uo=xt()+500,xs()))}break;case 13:bs(function(){var s=Gn(e,1);if(s!==null){var r=Nt();Cn(s,e,1,r)}}),$a(e,1)}};ia=function(e){if(e.tag===13){var t=Gn(e,134217728);if(t!==null){var n=Nt();Cn(t,e,134217728,n)}$a(e,134217728)}};Ld=function(e){if(e.tag===13){var t=is(e),n=Gn(e,t);if(n!==null){var s=Nt();Cn(n,e,t,s)}$a(e,t)}};Nd=function(){return Ke};Od=function(e,t){var n=Ke;try{return Ke=e,t()}finally{Ke=n}};uc=function(e,t,n){switch(t){case"input":if(sc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=Gi(s);if(!r)throw Error(fe(90));pd(s),sc(s,r)}}}break;case"textarea":xd(e,n);break;case"select":t=n.value,t!=null&&Qs(e,!!n.multiple,t,!1)}};kd=Ia;wd=bs;var ex={usingClientEntryPoint:!1,Events:[hr,Hs,Gi,Sd,Cd,Ia]},Po={findFiberByHostInstance:ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tx={bundleType:Po.bundleType,version:Po.version,rendererPackageName:Po.rendererPackageName,rendererConfig:Po.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Rd(e),e===null?null:e.stateNode},findFiberByHostInstance:Po.findFiberByHostInstance||Q1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _r=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_r.isDisabled&&_r.supportsFiber)try{$i=_r.inject(tx),Mn=_r}catch{}}Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ex;Kt.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ba(t))throw Error(fe(200));return K1(e,t,null,n)};Kt.createRoot=function(e,t){if(!Ba(e))throw Error(fe(299));var n=!1,s="",r=op;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Da(e,1,!1,null,null,n,!1,s,r),e[zn]=t.current,nr(e.nodeType===8?e.parentNode:e),new Fa(t)};Kt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(fe(188)):(e=Object.keys(e).join(","),Error(fe(268,e)));return e=Rd(t),e=e===null?null:e.stateNode,e};Kt.flushSync=function(e){return bs(e)};Kt.hydrate=function(e,t,n){if(!Ki(t))throw Error(fe(200));return Qi(null,e,t,!0,n)};Kt.hydrateRoot=function(e,t,n){if(!Ba(e))throw Error(fe(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",l=op;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),t=sp(t,null,e,1,n??null,r,!1,o,l),e[zn]=t.current,nr(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Zi(t)};Kt.render=function(e,t,n){if(!Ki(t))throw Error(fe(200));return Qi(null,e,t,!1,n)};Kt.unmountComponentAtNode=function(e){if(!Ki(e))throw Error(fe(40));return e._reactRootContainer?(bs(function(){Qi(null,null,e,!1,function(){e._reactRootContainer=null,e[zn]=null})}),!0):!1};Kt.unstable_batchedUpdates=Ia;Kt.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Ki(n))throw Error(fe(200));if(e==null||e._reactInternals===void 0)throw Error(fe(38));return Qi(e,t,n,!1,s)};Kt.version="18.3.1-next-f1338f8080-20240426";function rp(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rp)}catch(e){console.error(e)}}rp(),rd.exports=Kt;var nx=rd.exports,sf=nx;Zl.createRoot=sf.createRoot,Zl.hydrateRoot=sf.hydrateRoot;var be=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e.T_I="T_I",e.T_L="T_L",e.T_T="T_T",e.T_S="T_S",e.T_O="T_O",e.T_I_C="T_I_C",e.T_L_C="T_L_C",e.T_T_C="T_T_C",e.T_S_C="T_S_C",e.T_O_C="T_O_C",e.P_I="P_I",e.P_L="P_L",e.P_X="P_X",e.P_U="P_U",e.P_L2="P_L2",e.P_Y="P_Y",e.P_T="P_T",e.P_S="P_S",e.P_P="P_P",e.P_Z="P_Z",e.P_W="P_W",e.P_I_C="P_I_C",e.P_L_C="P_L_C",e.P_X_C="P_X_C",e.P_U_C="P_U_C",e.P_L2_C="P_L2_C",e.P_Y_C="P_Y_C",e.P_T_C="P_T_C",e.P_S_C="P_S_C",e.P_P_C="P_P_C",e.P_Z_C="P_Z_C",e.P_W_C="P_W_C",e.H_I="H_I",e.H_L="H_L",e.H_X="H_X",e.H_U="H_U",e.H_L2="H_L2",e.H_Y="H_Y",e.H_T="H_T",e.H_S="H_S",e.H_P="H_P",e.H_Z="H_Z",e.H_W="H_W",e.H_I_C="H_I_C",e.H_L_C="H_L_C",e.H_X_C="H_X_C",e.H_U_C="H_U_C",e.H_L2_C="H_L2_C",e.H_Y_C="H_Y_C",e.H_T_C="H_T_C",e.H_S_C="H_S_C",e.H_P_C="H_P_C",e.H_Z_C="H_Z_C",e.H_W_C="H_W_C",e))(be||{}),Ln=(e=>(e.SPAWNED="SPAWNED",e.FALLING="FALLING",e.LOCKED="LOCKED",e))(Ln||{}),Ze=(e=>(e.ConsoleScreen="CONSOLE",e.TankScreen="PERISCOPE",e.COMPLICATION_MINIGAME="COMPLICATION_MINIGAME",e.EndGameScreen="GAME_OVER",e))(Ze||{}),Ae=(e=>(e.LIGHTS="LIGHTS",e.CONTROLS="CONTROLS",e.LASER="LASER",e))(Ae||{});const st=12,Se=30,qt=21,Ye=24,Qe=Ye-qt,fo=375,bl=75*1e3,Ml=.15,sx=.5,ox=30,rx=0,ix=100,of=15,lx=10,cx=250,En={CIRCUIT_STABILIZER:{id:"CIRCUIT_STABILIZER",name:"Circuit Stabilizer",desc:"Extends grace period before lights start dimming.",type:"passive",category:"complication",unlockRank:2,costPerLevel:1,maxLevel:4,effectPerLevel:.75,formatEffect:e=>`+${(e*.75).toFixed(2)}s Grace Period`,maxLevelBonus:"Easier Fixing Sequence"},AUTO_POPPER:{id:"AUTO_POPPER",name:"Auto-Popper",desc:"At end of game, remaining goop has a chance to auto-pop before penalty.",type:"passive",unlockRank:3,costPerLevel:1,maxLevel:4,effectPerLevel:.04,formatEffect:e=>`-${20-e*4}% decay per unit`,maxLevelBonus:void 0},CAPACITOR_EFFICIENCY:{id:"CAPACITOR_EFFICIENCY",name:"Capacitor Efficiency",desc:"Reduces laser capacitor drain rate when popping goop.",type:"passive",category:"complication",unlockRank:4,costPerLevel:1,maxLevel:4,effectPerLevel:.0625,formatEffect:e=>`-${(e*6.25).toFixed(2)}% Drain Rate`,maxLevelBonus:"Easier Fixing Sequence"},COOLDOWN_BOOSTER:{id:"COOLDOWN_BOOSTER",name:"Cooldown Booster",desc:"When activated, extends all active malfunction cooldowns.",type:"active",unlockRank:5,costPerLevel:1,maxLevel:3,chargeCost:8,effectPerLevel:0,formatEffect:e=>`+${[25,35,50][e-1]||25}% Cooldown Extension`,maxLevelBonus:"+50% Cooldown Extension"},GEAR_LUBRICATION:{id:"GEAR_LUBRICATION",name:"Gear Lubrication",desc:"Increases heat dissipation rate when idle.",type:"passive",category:"complication",unlockRank:6,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Heat Dissipation`,maxLevelBonus:"Easier Fixing Sequence"},FOCUS_MODE:{id:"FOCUS_MODE",name:"Focus Mode",desc:"Time slows while at the console viewing minigames.",type:"passive",unlockRank:7,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`-${e*10}% Time Speed`,maxLevelBonus:void 0},DENSE_GOOP:{id:"DENSE_GOOP",name:"Dense Goop",desc:"Goop falls faster. Can add or remove scraps via respec.",type:"passive",unlockRank:8,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Fall Speed`,maxLevelBonus:void 0},PRESSURE_CONTROL:{id:"PRESSURE_CONTROL",name:"Pressure Control",desc:"Extends time before pressure reaches 100%.",type:"passive",unlockRank:9,costPerLevel:1,maxLevel:8,effectPerLevel:5,formatEffect:e=>`+${e*5}s Game Time`,maxLevelBonus:void 0},JUNK_UNIFORMER:{id:"JUNK_UNIFORMER",name:"Junk Uniformer",desc:"Starting junk is more likely to be the same color.",type:"passive",unlockRank:10,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`+${e*10}% Same Color`,maxLevelBonus:void 0},GOOP_SWAP:{id:"GOOP_SWAP",name:"Goop Swap",desc:"Swap falling goop with stored goop faster.",type:"passive",unlockRank:12,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${(1.5-e*.25).toFixed(2)}s Swap Time`,maxLevelBonus:void 0},GOOP_DUMP:{id:"GOOP_DUMP",name:"Goop Dump",desc:"When activated, rains same-color junk from the sky. Higher levels add more waves.",type:"active",unlockRank:15,costPerLevel:1,maxLevel:3,chargeCost:12,effectPerLevel:1,formatEffect:e=>`${e} wave${e>1?"s":""} of junk`,maxLevelBonus:"3 waves of matching junk"},SEALING_BONUS:{id:"SEALING_BONUS",name:"Sealing Bonus",desc:"Sealing cracks reduces active cooldowns more.",type:"passive",unlockRank:18,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`${10+e*5}% Cooldown per Seal`,maxLevelBonus:void 0},ACTIVE_EXPANSION_SLOT:{id:"ACTIVE_EXPANSION_SLOT",name:"Active Expansion Slot",desc:"Allows equipping a second active ability simultaneously.",type:"feature",unlockRank:20,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"2 Active Slots",maxLevelBonus:void 0},GOOP_HOLD_VIEWER:{id:"GOOP_HOLD_VIEWER",name:"Goop Hold Viewer",desc:"Shows the goop currently held.",type:"feature",unlockRank:22,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"View Held Goop",maxLevelBonus:void 0},GOOP_COLORIZER:{id:"GOOP_COLORIZER",name:"Goop Colorizer",desc:"When activated, upcoming goop matches your current color.",type:"active",unlockRank:25,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:1,formatEffect:e=>`Next ${5+e} goop match`,maxLevelBonus:"Next 8 goop match"},GOOP_WINDOW:{id:"GOOP_WINDOW",name:"Goop Window",desc:"Shows you the next goop piece.",type:"feature",unlockRank:28,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"Preview Next Goop",maxLevelBonus:void 0},SLOW_CRACKS:{id:"SLOW_CRACKS",name:"Slow Cracks",desc:"Cracks grow slower over time.",type:"passive",unlockRank:30,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`-${e*5}% Growth Chance`,maxLevelBonus:void 0},CRACK_MATCHER:{id:"CRACK_MATCHER",name:"Crack Matcher",desc:"Falling goop color biased toward the lowest crack.",type:"passive",unlockRank:32,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${e*25}% Match Chance`,maxLevelBonus:void 0},CRACK_DOWN:{id:"CRACK_DOWN",name:"Crack Down",desc:"When activated, next cracks form in the bottom 4 rows.",type:"active",unlockRank:35,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:2,formatEffect:e=>`Next ${1+e*2} cracks spawn low`,maxLevelBonus:"Next 7 cracks spawn low"},ACTIVE_EXPANSION_SLOT_2:{id:"ACTIVE_EXPANSION_SLOT_2",name:"Active Expansion Slot",desc:"Allows equipping a third active ability simultaneously.",type:"feature",unlockRank:38,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"3 Active Slots",maxLevelBonus:void 0}},St={RED:"#ef4444",BLUE:"#3b82f6",GREEN:"#22c55e",YELLOW:"#eab308",PURPLE:"#a855f7",WHITE:"#f8fafc",BLACK:"#1a1a2e",WILD:"wild",ORANGE:"#f97316",TEAL:"#14b8a6",GRID_BG:"#020617",GRID_EMPTY:"#1e293b"},Me=(e,t)=>({type:e,color:St.RED,cells:t.map(([n,s])=>({x:n,y:s}))}),rf=[Me(be.I,[[-1,0],[0,0],[1,0],[2,0]]),Me(be.J,[[-1,-1],[-1,0],[0,0],[1,0]]),Me(be.L,[[1,-1],[-1,0],[0,0],[1,0]]),Me(be.O,[[0,0],[1,0],[0,1],[1,1]]),Me(be.S,[[0,0],[1,0],[0,1],[-1,1]]),Me(be.T,[[0,-1],[-1,0],[0,0],[1,1]]),Me(be.Z,[[-1,0],[0,0],[0,1],[1,1]])],ax=Me(be.T_I,[[0,-1],[0,0],[0,1],[0,2]]),ux=Me(be.T_L,[[0,0],[0,1],[0,2],[1,0]]),fx=Me(be.T_T,[[0,0],[0,1],[0,2],[1,1]]),dx=Me(be.T_S,[[0,0],[0,1],[1,1],[1,2]]),px=Me(be.T_O,[[0,0],[0,1],[1,0],[1,1]]),hx=Me(be.T_I_C,[[0,2],[0,3],[1,0],[1,1]]),xx=Me(be.T_L_C,[[0,0],[0,1],[1,0],[1,2]]),yx=Me(be.T_T_C,[[0,0],[0,2],[1,1],[2,1]]),gx=Me(be.T_S_C,[[0,2],[1,0],[1,1],[2,1]]),mx=Me(be.T_O_C,[[0,0],[0,2],[1,1],[1,2]]),Uo=[ax,ux,fx,dx,px],Xo=[hx,xx,yx,gx,mx];[...Uo,...Xo];const vx=Me(be.P_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2]]),Sx=Me(be.P_L,[[0,0],[0,1],[1,1],[1,2],[2,1]]),Cx=Me(be.P_X,[[0,1],[1,0],[1,1],[1,2],[2,1]]),kx=Me(be.P_U,[[0,0],[1,0],[1,1],[1,2],[2,0]]),wx=Me(be.P_L2,[[0,0],[0,1],[1,0],[1,1],[1,2]]),jx=Me(be.P_Y,[[0,0],[0,1],[1,1],[1,2],[2,2]]),Px=Me(be.P_T,[[0,0],[0,1],[0,2],[0,3],[1,1]]),Rx=Me(be.P_S,[[0,0],[0,1],[0,2],[0,3],[1,3]]),bx=Me(be.P_P,[[0,0],[0,1],[0,3],[1,0],[1,2]]),Mx=Me(be.P_Z,[[0,0],[0,1],[0,2],[0,3],[1,1]]),Tx=Me(be.P_W,[[0,0],[0,2],[1,1],[1,2],[2,2]]),Ex=Me(be.P_I_C,[[0,0],[0,2],[0,4],[1,1],[1,3]]),Ax=Me(be.P_L_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),_x=Me(be.P_X_C,[[0,0],[1,1],[1,2],[2,0],[2,2]]),Ix=Me(be.P_U_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),Lx=Me(be.P_L2_C,[[0,0],[0,2],[1,1],[1,2],[2,2]]),Nx=Me(be.P_Y_C,[[0,0],[0,1],[1,1],[2,0],[2,2]]),Ox=Me(be.P_T_C,[[0,0],[0,1],[0,3],[1,2],[1,3]]),Dx=Me(be.P_S_C,[[0,0],[0,1],[1,0],[1,2],[2,1]]),$x=Me(be.P_P_C,[[0,0],[0,2],[1,0],[1,1],[1,3]]),Fx=Me(be.P_Z_C,[[0,0],[0,2],[1,1],[1,3],[2,0]]),Bx=Me(be.P_W_C,[[0,0],[0,2],[1,1],[2,0],[2,2]]),za=[vx,Sx,Cx,kx,wx,jx,Px,Rx,bx,Mx,Tx],Ga=[Ex,Ax,_x,Ix,Lx,Nx,Ox,Dx,$x,Fx,Bx];[...za,...Ga];const zx=Me(be.H_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2],[0,3]]),Gx=Me(be.H_L,[[0,0],[0,1],[0,2],[0,3],[1,1],[2,1]]),Yx=Me(be.H_X,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,3]]),Hx=Me(be.H_U,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,0]]),Wx=Me(be.H_L2,[[0,0],[0,1],[1,0],[1,1],[1,2],[1,3]]),Ux=Me(be.H_Y,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2]]),Xx=Me(be.H_T,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,2]]),Vx=Me(be.H_S,[[0,0],[0,1],[1,0],[1,1],[2,1],[2,2]]),qx=Me(be.H_P,[[0,0],[0,1],[0,2],[0,3],[1,2],[1,3]]),Zx=Me(be.H_Z,[[0,0],[0,1],[0,2],[0,3],[1,0],[1,3]]),Kx=Me(be.H_W,[[0,0],[0,3],[1,1],[1,2],[1,3],[2,3]]),Qx=Me(be.H_I_C,[[0,0],[0,3],[0,5],[1,1],[1,2],[1,4]]),Jx=Me(be.H_L_C,[[0,0],[0,2],[1,1],[1,2],[1,3],[2,0]]),ey=Me(be.H_X_C,[[0,0],[0,2],[0,3],[1,1],[1,3],[2,0]]),ty=Me(be.H_U_C,[[0,0],[0,3],[1,1],[1,2],[1,4],[2,0]]),ny=Me(be.H_L2_C,[[0,0],[0,1],[1,1],[1,2],[1,3],[2,0]]),sy=Me(be.H_Y_C,[[0,0],[0,2],[1,0],[1,2],[1,3],[2,1]]),oy=Me(be.H_T_C,[[0,0],[0,1],[0,3],[1,1],[1,2],[1,4]]),ry=Me(be.H_S_C,[[0,0],[0,2],[1,1],[1,3],[2,0],[2,2]]),iy=Me(be.H_P_C,[[0,0],[0,2],[0,4],[1,1],[1,2],[1,3]]),ly=Me(be.H_Z_C,[[0,0],[0,1],[0,3],[1,0],[1,2],[2,3]]),cy=Me(be.H_W_C,[[0,0],[0,3],[1,1],[1,2],[2,0],[2,3]]),Ya=[zx,Gx,Yx,Hx,Wx,Ux,Xx,Vx,qx,Zx,Kx],Ha=[Qx,Jx,ey,ty,ny,sy,oy,ry,iy,ly,cy];[...Ya,...Ha];const Ue=e=>(e%Se+Se)%Se,Yc=(e,t)=>Ue(Math.round(e)+t),ay=(e,t)=>{let n=e-t;for(;n>Se/2;)n-=Se;for(;n<=-Se/2;)n+=Se;return n},uy=(e,t,n)=>{const s=n?n.x:Math.round(e.reduce((o,l)=>o+l.x,0)/e.length),r=n?n.y:Math.round(e.reduce((o,l)=>o+l.y,0)/e.length);return e.map(({x:o,y:l})=>{const c=o-s,a=l-r;return t?{x:-a+s,y:c+r}:{x:a+s,y:-c+r}})},mn=e=>{const t=[St.RED,St.BLUE,St.GREEN,St.YELLOW];return e>=10&&t.push(St.PURPLE),e>=30&&t.push(St.WHITE),e>=50&&t.push(St.BLACK),t},fy=(e,t=1)=>{const n=e||rf[Math.floor(Math.random()*rf.length)],s=mn(t),o=(e==null?void 0:e.color)&&s.includes(e.color)?e.color:s[Math.floor(Math.random()*s.length)],l=Math.round(n.cells.reduce((a,u)=>a+u.x,0)/n.cells.length),c=Math.round(n.cells.reduce((a,u)=>a+u.y,0)/n.cells.length);return{definition:{...n,color:o},x:0,y:0,screenX:0,rotation:0,cells:[...n.cells],rotationCenter:{x:l,y:c},spawnTimestamp:Date.now(),startSpawnY:0,state:Ln.SPAWNED}},lf=(e,t)=>{const n=Array(Ye).fill(null).map(()=>Array(Se).fill(null));let s=0;if(e>=9?s=11:e>=6?s=8:e>=3&&(s=5),s>0){const r=mn(e),o=Array.from({length:Se},(d,p)=>p);for(let d=o.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[o[d],o[p]]=[o[p],o[d]]}const l=o.slice(0,s),c=Ye-1,u=((t==null?void 0:t.JUNK_UNIFORMER)||0)*.1;let f=null;l.forEach(d=>{let p;f===null?(p=r[Math.floor(Math.random()*r.length)],f=p):p=Math.random()<u?f:r[Math.floor(Math.random()*r.length)];const y=Math.random().toString(36).substr(2,9);n[c][d]={id:Math.random().toString(36).substr(2,9),goopGroupId:y,timestamp:Date.now(),color:p,groupMinY:c,groupMaxY:c,groupSize:1}})}return n},fs=(e,t,n)=>{for(const s of t.cells){const r=Ue(t.x+s.x),o=t.y+s.y;if(o+1>Ye)return!0;const l=Math.floor(o),c=Math.floor(o+1-1e-4);for(let a=l;a<=c;a++)if(a>=0&&a<Ye&&e[a][r]!==null)return!0}return!1},ip=(e,t,n)=>{let s=Math.floor(t.y);for(;s>-5&&fs(e,{...t,y:s});)s-=1;let r=s;for(;r<Ye&&!fs(e,{...t,y:r+1});)r+=1;return Math.max(s,r)},dy=(e,t,n)=>{const s=e[n][t];if(!s)return[];const r=[],o=new Set,l=[{x:t,y:n}],c=s.goopGroupId;for(;l.length>0;){const{x:a,y:u}=l.shift(),f=`${a},${u}`;if(o.has(f))continue;o.add(f),r.push({x:a,y:u});const d=[{x:Ue(a+1),y:u},{x:Ue(a-1),y:u},{x:a,y:u+1},{x:a,y:u-1}];for(const p of d)if(p.y>=0&&p.y<Ye){const y=e[p.y][p.x];y&&y.goopGroupId===c&&(o.has(`${p.x},${p.y}`)||l.push(p))}}return r},Ai=e=>{const t=e.map(r=>[...r]),n=new Set,s=(r,o,l,c)=>{const a=[],u=[{x:r,y:o}],f=new Set;for(;u.length>0;){const d=u.shift(),p=`${d.x},${d.y}`;if(f.has(p))continue;f.add(p),a.push(d);const y=[{x:Ue(d.x+1),y:d.y},{x:Ue(d.x-1),y:d.y},{x:d.x,y:d.y+1},{x:d.x,y:d.y-1}];for(const S of y)if(S.y>=0&&S.y<Ye){const P=t[S.y][S.x];if(!P||f.has(`${S.x},${S.y}`))continue;(c?P.isWild:P.color===l&&!P.isWild)&&u.push(S)}}return a};for(let r=0;r<Ye;r++)for(let o=0;o<Se;o++){const l=t[r][o];if(l&&!n.has(`${o},${r}`)){const c=s(o,r,l.color,!!l.isWild);let a=Ye,u=-1;c.forEach(j=>{j.y<a&&(a=j.y),j.y>u&&(u=j.y)});const f=c.length;let d=!0;const p=l.goopGroupId,y=l.groupSize;if(y!==f)d=!1;else for(const j of c){const g=t[j.y][j.x];if(!g||g.goopGroupId!==p||g.groupSize!==y){d=!1;break}}const S=d?p:Math.random().toString(36).substr(2,9),P=d?l.timestamp:Date.now();c.forEach(j=>{n.add(`${j.x},${j.y}`);const g=t[j.y][j.x];t[j.y][j.x]={...g,goopGroupId:S,timestamp:P,groupMinY:a,groupMaxY:u,groupSize:f}})}}return t},py=(e,t,n)=>{const s=e.map(p=>[...p]),r=Math.random().toString(36).substr(2,9),o=Date.now();let l=Ye,c=-1;const a=[],u=[];t.cells.forEach(p=>{const y=Math.floor(t.y+p.y);y<l&&(l=y),y>c&&(c=y)});const f=t.cells.length,d=t.definition.isWild;return t.cells.forEach((p,y)=>{var g;const S=Ue(t.x+p.x),P=Math.floor(t.y+p.y),j=((g=t.definition.cellColors)==null?void 0:g[y])??t.definition.color;if(P>=0&&P<Ye){const h=n.find(C=>C.x===S&&C.y===P);let x=!1;h&&(h.color===j||d)&&(a.push(h.id),x=!0),s[P][S]={id:Math.random().toString(36).substr(2,9),goopGroupId:r,timestamp:o,color:j,groupMinY:l,groupMaxY:c,groupSize:f,isSealingGoop:x,isWild:d}}}),{grid:Ai(s),consumedGoals:a,destroyedGoals:u}},hy=(e,t)=>{const n=e.map(c=>[...c]),s=t.definition.isWild,r=t.definition.color,o=[];t.cells.forEach(c=>{const a=Ue(t.x+c.x),u=Math.floor(t.y+c.y);u>=0&&u<Ye&&o.push({x:a,y:u})});const l=new Set;if(o.forEach(({x:c,y:a})=>{[{x:Ue(c+1),y:a},{x:Ue(c-1),y:a},{x:c,y:a+1},{x:c,y:a-1}].forEach(f=>{if(f.y>=0&&f.y<Ye){const d=n[f.y][f.x];if(!d||o.some(y=>y.x===f.x&&y.y===f.y))return;s?d.isWild||l.add(d.goopGroupId):d.isWild&&l.add(d.goopGroupId)}})}),l.size>0)for(let c=0;c<Ye;c++)for(let a=0;a<Se;a++){const u=n[c][a];u&&l.has(u.goopGroupId)&&(s?n[c][a]={...u,isWild:!0}:n[c][a]={...u,color:r,isWild:!1})}return Ai(n)},lp=(e,t)=>{const n=e.map(a=>[...a]),s=[],r=new Map;for(let a=0;a<Ye;a++)for(let u=0;u<Se;u++){const f=n[a][u];f&&(r.has(f.goopGroupId)||r.set(f.goopGroupId,[]),r.get(f.goopGroupId).push({x:u,y:a}))}let o;if(t&&t.length>0){const a=new Map;for(const u of t){const f=a.get(u.x);(f===void 0||u.y<f)&&a.set(u.x,u.y)}o=new Set;for(const[u,f]of r)for(const d of f){const p=a.get(d.x);if(p!==void 0&&d.y<p){o.add(u);break}}}else o=new Set(r.keys());const l=new Set;for(const[a,u]of r)for(const f of u)if(f.y===Ye-1){l.add(a);break}let c=!0;for(;c;){c=!1;for(const[a,u]of r)if(!l.has(a))for(const f of u){const d=f.y+1;if(d<Ye){const p=n[d][f.x];if(p&&p.goopGroupId!==a&&l.has(p.goopGroupId)){l.add(a),c=!0;break}}}}for(const a of o)if(!l.has(a)){const u=r.get(a);for(const f of u)s.push({data:n[f.y][f.x],x:f.x,y:f.y,velocity:0}),n[f.y][f.x]=null}return{grid:n,looseGoop:s}},xy=(e,t,n,s)=>{const r=[],o=[],l=.012*n,c=[...e].sort((a,u)=>u.y-a.y);for(const a of c){const u=a.y+l;if(u>=Ye-1){o.push({...a,y:Ye-1});continue}const f=Math.floor(u+1),d=a.x;t[f]&&t[f][d]?o.push({...a,y:Math.floor(u)}):r.push({...a,y:u})}return{active:r,landed:o}},yy=e=>Math.max(0,(Ye-e)*10),gy=(e,t)=>{const n=Ue(t+st/2);let s=Math.abs(e-n);return s>Se/2&&(s=Se-s),s>st/2?50:0},my=e=>1+e*.1,vy=(e,t)=>{let n=0;const s=new Set(t.map(r=>`${r.x},${r.y}`));return t.forEach(({x:r,y:o})=>{[{x:Ue(r+1),y:o},{x:Ue(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}].forEach(c=>{c.y>=0&&c.y<Ye&&e[c.y][c.x]&&!s.has(`${c.x},${c.y}`)&&n++})}),n*5},cf=(e,t,n,s,r,o=!1)=>{const l=mn(n),c=new Set(t.map(d=>d.color)),a=l.filter(d=>!c.has(d));if(a.length===0)return null;const u=a[Math.floor(Math.random()*a.length)];let f;if(o){const d=Ye-4,p=Ye-1;f=d+Math.floor(Math.random()*(p-d+1))}else{const p=1+Math.max(0,1-s/r)*(qt-1),y=Math.floor(Ye-p);f=Math.max(Qe,Math.min(Ye-1,y))}for(let d=0;d<20;d++){const p=Math.floor(Math.random()*Se),y=f;if(!e[y][p]&&!t.some(S=>S.x===p&&S.y===y))return{id:Math.random().toString(36).substr(2,9),x:p,y,color:u,spawnTime:Date.now()}}return null},Sy=(e,t,n,s,r)=>{const o=mn(n),l=[],c=[...t],u=1+Math.max(0,1-s/r)*(qt-1),f=Math.floor(Ye-u);let d=Qe,p=Math.max(Qe,f-1);for(const y of o)for(let S=0;S<20;S++){const P=Math.floor(Math.random()*Se),j=Math.floor(d+Math.random()*(p-d+1));if(j<Qe||j>=Ye)continue;const g=e[j][P]!==null,h=c.some(C=>C.x===P&&C.y===j),x=l.some(C=>C.x===P&&C.y===j);if(!g&&!h&&!x){const C={id:Math.random().toString(36).substr(2,9),x:P,y:j,color:y,spawnTime:Date.now()};l.push(C);break}}return l},tn=typeof navigator<"u"&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Cy=(e,t)=>{const n=Math.max(0,Math.min(100,e))/100;if(t==="drain")if(n>.5){const s=(n-.5)*2,r=Math.round(234+(59-234)*s),o=Math.round(179+(130-179)*s),l=Math.round(8+(246-8)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=n*2,r=Math.round(220+(234-220)*s),o=Math.round(38+(179-38)*s),l=Math.round(38+(8-38)*s);return`rgb(${r}, ${o}, ${l})`}else if(n<.5){const s=n*2,r=Math.round(34+(234-34)*s),o=Math.round(197+(179-197)*s),l=Math.round(94+(8-94)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=(n-.5)*2,r=Math.round(234+(220-234)*s),o=Math.round(179+(38-179)*s),l=Math.round(8+(38-8)*s);return`rgb(${r}, ${o}, ${l})`}},af=({value:e,maxValue:t=100,colorMode:n,x:s,y:r,height:o=200,width:l=16})=>{const a=Math.max(0,Math.min(t,e))/t*(o-4),u=Cy(e,n),f="#1f2937",d="#111827";return i.jsxs("g",{transform:`translate(${s}, ${r})`,children:[i.jsx("rect",{x:0,y:0,width:l,height:o,rx:3,ry:3,fill:d,stroke:f,strokeWidth:1}),i.jsx("rect",{x:2,y:o-2-a,width:l-4,height:a,rx:2,ry:2,fill:u}),[.25,.5,.75].map(p=>i.jsx("line",{x1:0,y1:o-p*(o-4)-2,x2:4,y2:o-p*(o-4)-2,stroke:f,strokeWidth:1,opacity:.5},p))]})},Oe=30,Os={x:-(st/2)*Oe,y:0,w:st*Oe,h:qt*Oe};function ct(e){return(e-st/2)*Oe}function ky(e){return e/Oe+st/2}class wy{constructor(){ze(this,"handlers",new Map)}on(t,n){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(n),()=>this.off(t,n)}off(t,n){var s;(s=this.handlers.get(t))==null||s.delete(n)}emit(t,n){var s;(s=this.handlers.get(t))==null||s.forEach(r=>r(n))}}const me=new wy;var xe=(e=>(e.PIECE_MOVED="PIECE_MOVED",e.PIECE_ROTATED="PIECE_ROTATED",e.PIECE_DROPPED="PIECE_DROPPED",e.GOOP_POPPED="GOOP_POPPED",e.ACTION_REJECTED="ACTION_REJECTED",e.GAME_OVER="GAME_OVER",e.GOAL_CAPTURED="GOAL_CAPTURED",e.COMPLICATION_SPAWNED="COMPLICATION_SPAWNED",e.COMPLICATION_RESOLVED="COMPLICATION_RESOLVED",e.LIGHTS_FLICKER="LIGHTS_FLICKER",e.ABILITY_ACTIVATED="ABILITY_ACTIVATED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.GAME_START="GAME_START",e.GAME_PAUSED="GAME_PAUSED",e.GAME_RESUMED="GAME_RESUMED",e.GAME_EXITED="GAME_EXITED",e.MUSIC_START="MUSIC_START",e.MUSIC_STOP="MUSIC_STOP",e.INPUT_ROTATE="INPUT_ROTATE",e.INPUT_DRAG="INPUT_DRAG",e.INPUT_SWIPE_UP="INPUT_SWIPE_UP",e.INPUT_FAST_DROP="INPUT_FAST_DROP",e.INPUT_SWAP="INPUT_SWAP",e.INPUT_BLOCK_TAP="INPUT_BLOCK_TAP",e.INPUT_SWAP_HOLD="INPUT_SWAP_HOLD",e))(xe||{});const jy=1500,_s=250,Ir=10,Ro=20;function Py({callbacks:e,tankRotation:t,grid:n,tankPressure:s,powerUps:r}){const{onBlockTap:o,onRotate:l,onDragInput:c,onSwipeUp:a,onFastDrop:u,onSwap:f}=e,d=(r==null?void 0:r.GOOP_SWAP)||0,p=jy-d*250,[y,S]=v.useState(null),[P,j]=v.useState(null),[g,h]=v.useState(0),[x,C]=v.useState(null),R=v.useRef(null),w=v.useRef(null),k=v.useRef(null),m=v.useRef(null),{x:M,y:I,w:L,h:H}=Os,q=v.useCallback((Z,de,we)=>{const E=we,B=E.getBoundingClientRect(),ve=E.clientLeft||0,ie=E.clientTop||0,ye=Z-B.left-ve,se=de-B.top-ie,ge=E.clientWidth,oe=E.clientHeight,ke=ge/L,he=oe/H,Ee=Math.min(ke,he),Ge=L*Ee,$e=(ge-Ge)/2,Fe=M+(ye-$e)/Ee,Ne=I+se/Ee,Ie=ky(Fe),O=Ne/Oe+Qe;return{vx:Ie,vy:O,svgX:Fe,svgY:Ne,relX:ye,contentW:ge,relY:se}},[M,I,L,H]),ee=v.useCallback((Z,de)=>{if(Z>=0&&Z<st){const we=Math.floor(Z),E=Ue(we+t),B=Math.floor(de);if(B>=0&&B<Ye){const ve=n[B][E];if(ve)return{type:"BLOCK",x:E,y:B,cell:ve}}}return{type:"EMPTY"}},[t,n]),N=v.useCallback(()=>{w.current&&(clearInterval(w.current),w.current=null),h(0),C(null)},[]);v.useEffect(()=>()=>{w.current&&clearInterval(w.current)},[]);const Q=v.useCallback(Z=>{if(R.current)return;Z.currentTarget.setPointerCapture(Z.pointerId);const{relX:de,relY:we,vx:E,vy:B}=q(Z.clientX,Z.clientY,Z.currentTarget);R.current={startX:Z.clientX,startY:Z.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:Z.pointerId,actionConsumed:!1},C({x:de,y:we}),h(0);const ve=Date.now();w.current=window.setInterval(()=>{const se=Date.now()-ve;if(se<_s)return;const ge=se-_s,oe=Math.min(100,ge/p*100);h(oe),oe>=100&&(R.current&&(R.current.actionConsumed=!0),me.emit(xe.INPUT_SWAP),f==null||f(),N(),navigator.vibrate&&navigator.vibrate(50))},16);const ie=ee(E,B);if(ie.type==="BLOCK"&&ie.cell){const ye=ie.cell.groupSize*fo,se=Date.now()-ie.cell.timestamp,ge=Ye-1-s*(qt-1);ie.cell.groupMinY<ge?(j(ie.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(oe=>oe===ie.cell.goopGroupId?null:oe),300)):se<ye?(j(ie.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(oe=>oe===ie.cell.goopGroupId?null:oe),300)):S(ie.cell.goopGroupId)}},[q,ee,s,N,p]),ae=v.useCallback(Z=>{if(!R.current||R.current.activePointerId!==Z.pointerId)return;const{startX:de,startY:we,isDragLocked:E}=R.current,B=Z.clientX-de,ve=Z.clientY-we,ie=Math.abs(B),ye=Math.abs(ve);if(E||(ie>Ir||ye>Ir)&&(N(),R.current.isDragLocked=!0,S(null),ie>ye?R.current.lockedAxis="H":(R.current.lockedAxis="V",ve>0&&(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)))),R.current.isDragLocked){const se=R.current.lockedAxis;if(se==="H")B<-Ro?(me.emit(xe.INPUT_DRAG,{direction:1}),c==null||c(1)):B>Ro?(me.emit(xe.INPUT_DRAG,{direction:-1}),c==null||c(-1)):(me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0));else if(se==="V"){const ge=ve>0;me.emit(xe.INPUT_FAST_DROP,{active:ge}),u==null||u(ge)}}},[N]),W=v.useCallback(Z=>{if(!R.current||R.current.activePointerId!==Z.pointerId)return;const{startTime:de,isDragLocked:we,actionConsumed:E,startX:B,startY:ve}=R.current,ie=Date.now()-de,ye=Z.clientX-B,se=Z.clientY-ve;if(N(),me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1),me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0),S(null),R.current=null,Z.currentTarget.releasePointerCapture(Z.pointerId),!E&&!(ie>=_s))if(we)ie<300&&Math.abs(se)>Math.abs(ye)&&Math.abs(se)>50&&(se<0?(me.emit(xe.INPUT_SWIPE_UP),a==null||a()):(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0),setTimeout(()=>{me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)},150)));else{const{vx:ge,vy:oe,relX:ke,contentW:he}=q(Z.clientX,Z.clientY,Z.currentTarget),Ee=ee(ge,oe);Ee.type==="BLOCK"&&Ee.cell?(me.emit(xe.INPUT_BLOCK_TAP,{x:Ee.x,y:Ee.y}),o==null||o(Ee.x,Ee.y)):ke<he/2?(me.emit(xe.INPUT_ROTATE,{clockwise:!1}),l==null||l(-1)):(me.emit(xe.INPUT_ROTATE,{clockwise:!0}),l==null||l(1))}},[N,q,ee]),K=v.useCallback(()=>{m.current&&(window.removeEventListener("touchmove",m.current.move),window.removeEventListener("touchend",m.current.end),window.removeEventListener("touchcancel",m.current.end),m.current=null)},[]),Y=v.useCallback(Z=>{if(Z.touches.length!==1||R.current)return;Z.preventDefault();const de=Z.touches[0],we=Z.currentTarget;k.current=we;const{relX:E,relY:B,vx:ve,vy:ie}=q(de.clientX,de.clientY,we);R.current={startX:de.clientX,startY:de.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:de.identifier,actionConsumed:!1},C({x:E,y:B}),h(0);const ye=Date.now();w.current=window.setInterval(()=>{const he=Date.now()-ye;if(he<_s)return;const Ee=he-_s,Ge=Math.min(100,Ee/p*100);h(Ge),Ge>=100&&(R.current&&(R.current.actionConsumed=!0),me.emit(xe.INPUT_SWAP),f==null||f(),N(),navigator.vibrate&&navigator.vibrate(50))},16);const se=ee(ve,ie);if(se.type==="BLOCK"&&se.cell){const ke=se.cell.groupSize*fo,he=Date.now()-se.cell.timestamp,Ee=Ye-1-s*(qt-1);se.cell.groupMinY<Ee?(j(se.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(Ge=>Ge===se.cell.goopGroupId?null:Ge),300)):he<ke?(j(se.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(Ge=>Ge===se.cell.goopGroupId?null:Ge),300)):S(se.cell.goopGroupId)}const ge=ke=>{if(!R.current||ke.touches.length!==1)return;ke.preventDefault();const he=ke.touches[0];if(he.identifier!==R.current.activePointerId)return;const{startX:Ee,startY:Ge,isDragLocked:$e}=R.current,Fe=he.clientX-Ee,Ne=he.clientY-Ge,Ie=Math.abs(Fe),O=Math.abs(Ne);if($e||(Ie>Ir||O>Ir)&&(N(),R.current.isDragLocked=!0,S(null),Ie>O?R.current.lockedAxis="H":(R.current.lockedAxis="V",Ne>0&&(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)))),R.current.isDragLocked){const G=R.current.lockedAxis;G==="H"?Fe<-Ro?(me.emit(xe.INPUT_DRAG,{direction:1}),c==null||c(1)):Fe>Ro?(me.emit(xe.INPUT_DRAG,{direction:-1}),c==null||c(-1)):(me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0)):G==="V"&&(Ne>Ro?(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)):(me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)))}},oe=ke=>{const he=ke.changedTouches[0];if(!R.current||!he||he.identifier!==R.current.activePointerId)return;const{startTime:Ee,isDragLocked:Ge,actionConsumed:$e,startX:Fe,startY:Ne}=R.current,Ie=Date.now()-Ee,O=he.clientX-Fe,G=he.clientY-Ne;N(),me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1),me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0),S(null);const Ce=k.current;if(R.current=null,k.current=null,K(),!$e&&!(Ie>=_s))if(!Ge&&Ce){const{vx:D,vy:F,relX:T,contentW:$}=q(he.clientX,he.clientY,Ce),V=ee(D,F);V.type==="BLOCK"&&V.cell?(me.emit(xe.INPUT_BLOCK_TAP,{x:V.x,y:V.y}),o==null||o(V.x,V.y)):T<$/2?(me.emit(xe.INPUT_ROTATE,{clockwise:!1}),l==null||l(-1)):(me.emit(xe.INPUT_ROTATE,{clockwise:!0}),l==null||l(1))}else Ge&&Ie<300&&Math.abs(G)>Math.abs(O)&&Math.abs(G)>50&&(G<0?(me.emit(xe.INPUT_SWIPE_UP),a==null||a()):(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0),setTimeout(()=>{me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)},150)))};m.current={move:ge,end:oe},window.addEventListener("touchmove",ge,{passive:!1}),window.addEventListener("touchend",oe),window.addEventListener("touchcancel",oe)},[q,ee,s,N,p,f,u,c,o,l,a,K]);v.useEffect(()=>()=>K(),[K]);const re=v.useCallback(Z=>{Z.preventDefault()},[]),te=v.useCallback(Z=>{Z.preventDefault()},[]);return{handlers:{onPointerDown:Q,onPointerMove:ae,onPointerUp:W,onTouchStart:Y,onTouchMove:re,onTouchEnd:te,onTouchCancel:te},holdState:{progress:g,position:x},highlightedGroupId:y,shakingGroupId:P,setHighlightedGroupId:S,setShakingGroupId:j}}const cp=8;function Ry(e,t,n,s,r,o=cp){let l="";return!r.t&&!r.l?l+=`M ${e} ${t+o} Q ${e} ${t} ${e+o} ${t} `:l+=`M ${e} ${t} `,!r.t&&!r.r?l+=`L ${e+n-o} ${t} Q ${e+n} ${t} ${e+n} ${t+o} `:l+=`L ${e+n} ${t} `,!r.b&&!r.r?l+=`L ${e+n} ${t+s-o} Q ${e+n} ${t+s} ${e+n-o} ${t+s} `:l+=`L ${e+n} ${t+s} `,!r.b&&!r.l?l+=`L ${e+o} ${t+s} Q ${e} ${t+s} ${e} ${t+s-o} `:l+=`L ${e} ${t+s} `,l+="Z",l}function Lr(e,t,n,s,r,o=cp){const l=o;let c="";if(!r.t){const a=r.l?e:e+l,u=r.r?e+n:e+n-l;c+=`M ${a} ${t} L ${u} ${t} `}if(!r.r){const a=r.t?t:t+l,u=r.b?t+s:t+s-l;c+=`M ${e+n} ${a} L ${e+n} ${u} `}if(!r.b){const a=r.l?e:e+l,u=r.r?e+n:e+n-l;c+=`M ${u} ${t+s} L ${a} ${t+s} `}if(!r.l){const a=r.t?t:t+l,u=r.b?t+s:t+s-l;c+=`M ${e} ${u} L ${e} ${a} `}return!r.t&&!r.l&&(c+=`M ${e} ${t+l} Q ${e} ${t} ${e+l} ${t} `),!r.t&&!r.r&&(c+=`M ${e+n-l} ${t} Q ${e+n} ${t} ${e+n} ${t+l} `),!r.b&&!r.r&&(c+=`M ${e+n} ${t+s-l} Q ${e+n} ${t+s} ${e+n-l} ${t+s} `),!r.b&&!r.l&&(c+=`M ${e+l} ${t+s} Q ${e} ${t+s} ${e} ${t+s-l} `),c}function by(e,t,n){var o,l,c,a;const s=new Map;for(let u=Qe;u<Qe+qt;u++)for(let f=0;f<st;f++){const d=Ue(f+t),p=e[u][d];if(!p)continue;const y=ct(f),P=ct(f+1)-y;if(P<=0)continue;const j=(u-Qe)*Oe,g={t:u>0&&((o=e[u-1][d])==null?void 0:o.goopGroupId)===p.goopGroupId,b:u<Ye-1&&((l=e[u+1][d])==null?void 0:l.goopGroupId)===p.goopGroupId,l:((c=e[u][Ue(d-1)])==null?void 0:c.goopGroupId)===p.goopGroupId,r:((a=e[u][Ue(d+1)])==null?void 0:a.goopGroupId)===p.goopGroupId};s.has(p.goopGroupId)||s.set(p.goopGroupId,[]),s.get(p.goopGroupId).push({visX:f,y:u,screenX:y,screenY:j,width:P,cell:p,color:p.color,neighbors:g})}const r=new Map;return n.forEach(u=>{r.has(u.data.goopGroupId)||r.set(u.data.goopGroupId,[]),r.get(u.data.goopGroupId).push(u)}),r.forEach((u,f)=>{const d=new Set;u.forEach(p=>d.add(`${Math.round(p.x)},${Math.round(p.y)}`)),u.forEach(p=>{if(p.y<Qe-1)return;let y=p.x-t;if(y>Se/2&&(y-=Se),y<-Se/2&&(y+=Se),y>=0&&y<st){const S=ct(y),j=ct(y+1)-S,g=(p.y-Qe)*Oe,h=Math.round(p.x),x=Math.round(p.y),C={t:d.has(`${h},${x-1}`),r:d.has(`${Ue(h+1)},${x}`),b:d.has(`${h},${x+1}`),l:d.has(`${Ue(h-1)},${x}`)};s.has(f)||s.set(f,[]),s.get(f).push({visX:y,y:p.y,screenX:S,screenY:g,width:j,cell:p.data,color:p.data.color,neighbors:C,isFalling:!0})}})}),s}const My=e=>{switch(e){case"COOLDOWN_BOOSTER":return"CB";case"GOOP_DUMP":return"GD";case"GOOP_COLORIZER":return"GC";case"CRACK_DOWN":return"CD";default:return e.charAt(0)}},Ty=e=>{switch(e){case"COOLDOWN_BOOSTER":return"#5bbc70";case"GOOP_DUMP":return"#f97316";case"GOOP_COLORIZER":return"#a855f7";case"CRACK_DOWN":return"#ef4444";default:return"#6acbda"}},Ey=({upgradeId:e,name:t,charge:n,isReady:s,x:r,y:o,size:l,onClick:c})=>{const[a,u]=v.useState(!1),f=v.useCallback(x=>{x.stopPropagation(),x.preventDefault(),s?c==null||c():(u(!0),setTimeout(()=>u(!1),300))},[s,c]),d=Ty(e),p=My(e),y=l/2,S=2,P=n/100,j=y*2,g=P*j,h=y-g;return i.jsx("g",{transform:`translate(${r}, ${o})`,children:i.jsxs("g",{className:a?"shake-anim":"",style:{cursor:"pointer"},onPointerDown:f,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:`clip-${e}`,children:i.jsx("circle",{cx:0,cy:0,r:y-S})})}),i.jsx("circle",{cx:0,cy:0,r:y-S,fill:d,fillOpacity:.25}),!s&&i.jsx("rect",{x:-(y-S),y:h,width:(y-S)*2,height:g,fill:d,fillOpacity:.75,clipPath:`url(#clip-${e})`}),s&&i.jsx("circle",{cx:0,cy:0,r:y-S,fill:d,fillOpacity:.85}),i.jsx("circle",{cx:0,cy:0,r:y-S,fill:"none",stroke:d,strokeWidth:S}),s&&i.jsx("circle",{cx:0,cy:0,r:y,fill:"none",stroke:d,strokeWidth:2,opacity:.5,className:"animate-pulse"}),i.jsx("text",{x:0,y:0,textAnchor:"middle",dominantBaseline:"central",fill:s?"white":"#e2e8f0",fontSize:l*.3,fontWeight:"bold",fontFamily:"monospace",children:p})]})})},Is=48,Ls=12,uf=({piece:e,label:t,visible:n,rank:s=0})=>{const[r,o]=v.useState(Date.now());if(v.useEffect(()=>{if(!(e!=null&&e.isWild))return;const a=setInterval(()=>o(Date.now()),50);return()=>clearInterval(a)},[e==null?void 0:e.isWild]),!n)return null;const l=a=>{const u=mn(s),f=400,d=.15,p=r%(u.length*f)/f,y=a*d,S=(p+y)%u.length,P=Math.floor(S),j=(P+1)%u.length,g=S-P,h=u[P],x=u[j],C=parseInt(h.slice(1,3),16),R=parseInt(h.slice(3,5),16),w=parseInt(h.slice(5,7),16),k=parseInt(x.slice(1,3),16),m=parseInt(x.slice(3,5),16),M=parseInt(x.slice(5,7),16),I=Math.round(C+(k-C)*g),L=Math.round(R+(m-R)*g),H=Math.round(w+(M-w)*g);return`rgb(${I}, ${L}, ${H})`};let c=null;if(e){const a=e.isWild,u=Math.min(...e.cells.map(g=>g.x)),f=Math.max(...e.cells.map(g=>g.x)),d=Math.min(...e.cells.map(g=>g.y)),p=Math.max(...e.cells.map(g=>g.y)),y=f-u+1,S=p-d+1,P=(Is-y*Ls)/2,j=(Is-S*Ls)/2;c=e.cells.map((g,h)=>{var C;const x=P+(g.x-u)*Ls;return i.jsx("rect",{x,y:j+(g.y-d)*Ls,width:Ls-1,height:Ls-1,fill:a?l(x):((C=e.cellColors)==null?void 0:C[h])??e.color,rx:2},h)})}return i.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",border:"2px solid #475569",borderRadius:"6px",padding:"4px 6px",display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsx("div",{style:{fontSize:"9px",color:"#94a3b8",textAlign:"center",marginBottom:"2px",fontFamily:"monospace",letterSpacing:"1px"},children:t}),i.jsxs("svg",{width:Is,height:Is,style:{display:"block"},children:[i.jsx("rect",{x:0,y:0,width:Is,height:Is,fill:"rgba(30, 41, 59, 0.5)",rx:4}),c]})]})};function Ay(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Wa(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=Ay(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function _y(e){return Wa(e.map(t=>t.pos))}function ff(e){if(!e.loopStarts||e.loopStarts.length<=1)return _y(e.vertices);let t="";for(let n=0;n<e.loopStarts.length;n++){const s=e.loopStarts[n],r=n+1<e.loopStarts.length?e.loopStarts[n+1]:e.vertices.length,o=e.vertices.slice(s,r);o.length>=3&&(t+=Wa(o.map(l=>l.pos))+" ")}return t.trim()}function Iy(e){let t=1/0,n=-1/0,s=1/0,r=-1/0;for(const o of e)o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y);return{minX:t,maxX:n,minY:s,maxY:r}}function Ly(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?100:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<1e-4||S<1e-4){r.push({...c});continue}const P=-f/y,j=u/y,g=-p/S,h=d/S;let x=P+g,C=j+h;const R=Math.sqrt(x*x+C*C);R<1e-4?(x=P,C=j):(x/=R,C/=R);const w=P*x+j*C,k=w>.1?1/w:1,m=s[o]*.4,M=Math.min(t,m)*Math.min(k,2);r.push({x:c.x+x*M,y:c.y+C*M})}return r}function df(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function pf(e,t){const n=t*Math.PI/180,s=Math.cos(n),r=Math.sin(n);return{x:e.x*s-e.y*r,y:e.x*r+e.y*s}}const _i={damping:.98,stiffness:10,pressure:20,iterations:3,homeStiffness:.35,innerHomeStiffness:.64,returnSpeed:.8,viscosity:.7,gravity:10,fallingHomeStiffness:.35,fallingReturnSpeed:.8,fallingViscosity:.7,fallingGravity:10,attractionRadius:30,attractionRestLength:1,attractionStiffness:.037,goopiness:36,tendrilEndRadius:1,tendrilSkinniness:.2,wallThickness:8,fallingGoopiness:36,fallingTendrilEndRadius:1,fallingTendrilSkinniness:.2,dropletCount:30,dropletSpeed:60,dropletLifetime:3,dropletSize:9,dropletGravity:180},Pt=30,vn={x:-(st/2)*Pt,y:0},No=Se*Pt;function Ny(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function Oy(e){if(e.length===0)return[];const t=new Map;for(const l of e){const c=`${l.x1},${l.y1}`,a=`${l.x2},${l.y2}`;t.has(c)||t.set(c,[]),t.has(a)||t.set(a,[]),t.get(c).push(l),t.get(a).push(l)}const n=(l,c)=>{const a=c.x===l.x1&&c.y===l.y1?l.x2:l.x1,u=c.x===l.x1&&c.y===l.y1?l.y2:l.y1;return Math.atan2(u-c.y,a-c.x)},s=(l,c)=>{let a=c-l;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a},r=new Set,o=[];for(;r.size<e.length;){const l=e.find(y=>!r.has(y));if(!l)break;const c=[];let a=l,u={x:a.x1,y:a.y1};const f={x:u.x,y:u.y};let d=n(a,u)+Math.PI,p=!0;for(;;){r.add(a),c.push({x:u.x,y:u.y});const y=u.x===a.x1&&u.y===a.y1?{x:a.x2,y:a.y2}:{x:a.x1,y:a.y1};if(!p&&y.x===f.x&&y.y===f.y)break;p=!1,d=Math.atan2(y.y-u.y,y.x-u.x)+Math.PI;const P=`${y.x},${y.y}`,g=(t.get(P)||[]).filter(C=>!r.has(C));if(g.length===0)break;let h=g[0],x=-1/0;for(const C of g){const R=n(C,y),w=s(d,R);w>x&&(x=w,h=C)}a=h,u=y}c.length>=3&&o.push(c)}return o}function Dy(e){return e.map(t=>({x:vn.x+t.x*Pt,y:vn.y+t.y*Pt}))}function hf(e){let t=0,n=0;for(const s of e){const r=vn.x+(s.x+.5)*Pt,o=vn.y+(s.y+.5)*Pt;t+=r,n+=o}return{x:t/e.length,y:n/e.length}}function $y(e,t,n,s,r=0){const o=Ny(e),c=Oy(o).map(m=>Dy(m)),a=m=>{let M=0;for(let I=0;I<m.length;I++){const L=(I+1)%m.length;M+=m[I].x*m[L].y-m[L].x*m[I].y}return M/2};c.sort((m,M)=>Math.abs(a(M))-Math.abs(a(m)));const u=c.map((m,M)=>{const I=a(m);return M===0?I>0?m:[...m].reverse():I<0?m:[...m].reverse()});let f=[];const d=[];for(const m of u)d.push(f.length),f=f.concat(m);if(f.length<3){const m=hf(e),M=Pt*.4;f=[{x:m.x-M,y:m.y-M},{x:m.x+M,y:m.y-M},{x:m.x+M,y:m.y+M},{x:m.x-M,y:m.y+M}],d.length=0,d.push(0)}const p=hf(e),y=p.x,S=p.y,P=f.map(m=>({pos:{x:m.x,y:m.y},oldPos:{x:m.x,y:m.y},homeOffset:{x:m.x-y,y:m.y-S},mass:1,attractionRadius:.8+Math.random()*.4})),j=P.length,g=[];for(let m=0;m<d.length;m++){const M=d[m],I=m+1<d.length?d[m+1]:j;for(let L=M;L<I;L++){const H=L+1<I?L+1:M;g.push({a:L,b:H,restLength:df(P[L].pos,P[H].pos)})}}const h=new Set;for(const m of g)h.add(`${Math.min(m.a,m.b)}-${Math.max(m.a,m.b)}`);const x=[],C=Pt*1.5,R=new Set;for(let m=0;m<j;m++)for(let M=m+1;M<j;M++){const I=`${m}-${M}`;if(h.has(I))continue;const L=df(P[m].pos,P[M].pos);L<C&&(R.has(I)||(R.add(I),x.push({a:m,b:M,restLength:L})))}let w=0;for(let m=0;m<d.length;m++){const M=d[m],I=m+1<d.length?d[m+1]:f.length;let L=0;for(let H=M;H<I;H++){const q=H+1<I?H+1:M;L+=f[H].x*f[q].y-f[q].x*f[H].y}w+=L}return w=Math.abs(w)/2,{id:n,color:t,vertices:P,innerVertices:[{pos:{x:y,y:S},oldPos:{x:y,y:S},homeOffset:{x:0,y:0},mass:1,attractionRadius:1}],loopStarts:d,ringsprings:g,crossSprings:x,restArea:w,gridCells:e.map(m=>({x:m.x,y:m.y})),isColliding:!1,isLocked:s,isFalling:!s,isLoose:!1,looseTime:0,fillAmount:s?0:1,wasFullLastFrame:!s,rotation:0,targetX:y,targetY:S,visualOffsetY:0,createdAtRotation:r}}function po(e,t){let n=t-e;return n>No/2&&(n-=No),n<-No/2&&(n+=No),n}function Fy(e,t,n){const s=Math.min(t,.033);for(const r of e){const o=n.damping;let l=r.isLocked?n.gravity:n.fallingGravity;if(r.isLoose){r.looseTime+=s;const c=.6,a=Math.min(1,r.looseTime/c);l*=a*a*a}else r.looseTime=0;for(const c of r.vertices){const a=(c.pos.x-c.oldPos.x)*o,u=(c.pos.y-c.oldPos.y)*o;c.oldPos.x=c.pos.x,c.oldPos.y=c.pos.y,c.pos.x+=a,c.pos.y+=u+l*s*s}for(const c of r.innerVertices){const a=(c.pos.x-c.oldPos.x)*o,u=(c.pos.y-c.oldPos.y)*o;c.oldPos.x=c.pos.x,c.oldPos.y=c.pos.y,c.pos.x+=a,c.pos.y+=u+l*s*s}}}function By(e,t){for(const n of e){const s=n.isLocked?t.returnSpeed:t.fallingReturnSpeed,r=s*s,o=n.isLocked?t.viscosity:t.fallingViscosity,l=Math.max(0,1-o),c=o>0?.03/Math.max(1,o):0,a=n.isLocked?t.homeStiffness:t.fallingHomeStiffness;for(const u of n.vertices){const f=pf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,S=p-u.pos.y,P=y*a*r,j=S*a*r;u.pos.x+=P*l,u.pos.y+=j*l,o>0&&(u.oldPos.x-=P*c,u.oldPos.y-=j*c)}for(const u of n.innerVertices){const f=pf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,S=p-u.pos.y,P=y*t.innerHomeStiffness*r,j=S*t.innerHomeStiffness*r;u.pos.x+=P*l,u.pos.y+=j*l,o>0&&(u.oldPos.x-=P*c,u.oldPos.y-=j*c)}}}function xf(e,t,n){const s=e[t.a],r=e[t.b],o=po(s.pos.x,r.pos.x),l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)return;const u=(c-t.restLength)/c*n*.5;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}function zy(e,t){for(let n=0;n<t.iterations;n++)for(const s of e){for(const r of s.ringsprings)xf(s.vertices,r,t.stiffness*.01);for(const r of s.crossSprings)xf(s.vertices,r,t.stiffness*.005)}}function Gy(e,t){for(const n of e){if(!n.isLocked)continue;const s=n.targetX,r=n.targetY,o=t.pressure*.002;for(const l of n.vertices){const c=l.pos.x-s,a=l.pos.y-r,u=Math.sqrt(c*c+a*a),f=Math.sqrt(l.homeOffset.x*l.homeOffset.x+l.homeOffset.y*l.homeOffset.y);if(u>1e-4&&f>1e-4){const p=(f-u)*o;l.pos.x+=c/u*p,l.pos.y+=a/u*p}}}}function Yy(e,t){for(const r of e){for(const o of r.vertices){if(o.pos.y<t.minY+2){o.pos.y=t.minY+2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}if(o.pos.y>t.maxY-2){o.pos.y=t.maxY-2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}}for(const o of r.innerVertices)o.pos.y<t.minY+2&&(o.pos.y=t.minY+2),o.pos.y>t.maxY-2&&(o.pos.y=t.maxY-2)}}function Hy(e,t,n,s){Fy(e,t,n),By(e,n),zy(e,n),Gy(e,n),Yy(e,s)}function Wy(e,t){const n=e.vertices,s=n.length;for(let r=0;r<s;r++){const o=n[(r-1+s)%s],l=n[r],c=n[(r+1)%s],a=l.pos.x-o.pos.x,u=l.pos.y-o.pos.y,f=c.pos.x-l.pos.x,d=c.pos.y-l.pos.y,p=Math.sqrt(a*a+u*u),y=Math.sqrt(f*f+d*d);if(p<1e-4||y<1e-4)continue;const S=u/p,P=-a/p,j=d/y,g=-f/y;let h=S+j,x=P+g;const C=Math.sqrt(h*h+x*x);C<1e-4||(h/=C,x/=C,n[r].oldPos.x-=h*t,n[r].oldPos.y-=x*t)}}function Uy(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertexA],u=c.vertices[o.vertexB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertexA}-${o.blobB}-${o.vertexB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=po(a.targetX,c.targetX),f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++){const y=c.vertices[p],S=n.attractionRadius*y.attractionRadius;for(let P=0;P<a.vertices.length;P++){const j=a.vertices[P],g=n.attractionRadius*j.attractionRadius,h=(S+g)/2,x=po(y.pos.x,j.pos.x),C=j.pos.y-y.pos.y,R=Math.sqrt(x*x+C*C),w=`${o}-${p}-${l}-${P}`;r.has(w)||R>h||(s.push({blobA:o,blobB:l,vertexA:p,vertexB:P,restLength:n.attractionRestLength}),r.add(w))}}}return s}function Xy(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertexA],u=c.vertices[o.vertexB];if(!a||!u)continue;const f=po(a.pos.x,u.pos.x),d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=Math.max(0,Math.min(1,1-p/n.goopiness)),S=s+y*(r-s),j=(p-o.restLength)*S,g=f/p*j,h=d/p*j;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function Vy(e,t=30){for(let o=0;o<3;o++)for(let l=0;l<e.length;l++)for(let c=l+1;c<e.length;c++){const a=e[l],u=e[c];if(a.color===u.color)continue;const f=a.isFalling||a.isLoose,d=u.isFalling||u.isLoose;if(!f&&!d)continue;const p=a.targetX-u.targetX,y=a.targetY-u.targetY;if(!(Math.sqrt(p*p+y*y)>t*4))for(const P of a.vertices)for(const j of u.vertices){const g=j.pos.x-P.pos.x,h=j.pos.y-P.pos.y,x=Math.sqrt(g*g+h*h);if(x<2.5&&x>.01){const C=2.5-x,R=g/x,w=h/x,k=C*.8;P.pos.x-=R*k*.5,P.pos.y-=w*k*.5,j.pos.x+=R*k*.5,j.pos.y+=w*k*.5,P.oldPos.x-=R*k*.3,P.oldPos.y-=w*k*.3,j.oldPos.x+=R*k*.3,j.oldPos.y+=w*k*.3}}}}function qy(e,t,n,s,r,o=0){var d;if(e.isLocked||e.isLoose)return;let l=!0;for(const p of e.gridCells){const y=p.y+1;if(y>=r){l=!1;break}const S=Math.floor(y)+Qe;let P=Math.floor(p.x)+o;for(;P<0;)P+=Se;for(;P>=Se;)P-=Se;const j=(d=s[S])==null?void 0:d[P];if(j&&j.goopGroupId!==void 0){l=!1;break}}if(e.isColliding=!l,l){const p=n*t;for(e.visualOffsetY+=p;e.visualOffsetY>=Pt;){for(const y of e.gridCells)y.y+=1;e.visualOffsetY-=Pt}}let c=0,a=0;for(const p of e.gridCells)c+=p.x,a+=p.y;const u=c/e.gridCells.length,f=a/e.gridCells.length;e.targetX=vn.x+(u+.5)*Pt,e.targetY=vn.y+(f+.5)*Pt+e.visualOffsetY}function Tl(e){if(e.vertices.length<3)return[0];const t=e.vertices.map(a=>a.pos.x),n=Math.min(...t),s=Math.max(...t),r=-180,o=180,l=[],c=No;for(const a of[0,c,-c]){const u=n+a;s+a>=r&&u<=o&&l.push(a)}return l.length>1&&console.log(`Blob ${e.id} straddles seam, rendering at offsets:`,l,`(X range: ${n.toFixed(0)} to ${s.toFixed(0)})`),l.length>0?l:[0]}const Zy=({state:e,rank:t,maxTime:n,lightsBrightness:s=100,laserCharge:r=100,controlsHeat:o=0,complicationCooldowns:l,equippedActives:c=[],activeCharges:a={},onActivateAbility:u,powerUps:f,storedGoop:d,nextGoop:p,softBodyPhysics:y,normalGoopOpacity:S=1,showVertexDebug:P=!1,gooStdDev:j=8,gooAlphaMul:g=24,gooAlphaOff:h=-13,fallingGooStdDev:x,fallingGooAlphaMul:C,fallingGooAlphaOff:R})=>{const{grid:w,tankRotation:k,activeGoop:m,looseGoop:M,floatingTexts:I,shiftTime:L,goalMarks:H,crackCells:q,dumpPieces:ee}=e,N=v.useMemo(()=>mn(t),[t]),Q=v.useMemo(()=>L<=0?1:Math.max(0,1-L/n),[L,n]),W=`hsla(${Math.max(0,120*(1-Q))}, 100%, 50%, 0.15)`,K=1+Q*(qt-1),{x:Y,y:re,w:te,h:Z}=Os,de=K*Oe,we=Z-de,E=v.useCallback((D,F)=>{let T=D-k;T>Se/2&&(T-=Se),T<-Se/2&&(T+=Se);const $=ct(T),V=(F-Qe)*Oe+Oe/2,U=($-Y)/te*100,le=(V-re)/Z*100;return{x:U,y:le}},[k]),{handlers:B,holdState:ve,highlightedGroupId:ie,shakingGroupId:ye}=Py({callbacks:{},tankRotation:k,grid:w,tankPressure:Q,powerUps:f}),[se,ge]=v.useState(-1),[oe,ke]=v.useState(0);v.useEffect(()=>me.on(xe.INPUT_SWAP_HOLD,F=>{ge((F==null?void 0:F.progress)??-1)}),[]),v.useEffect(()=>{var le,b;if(!y)return;const D=new Set;for(let _=Qe;_<Ye;_++)for(let A=0;A<Se;A++){const z=(le=w[_])==null?void 0:le[A];z!=null&&z.goopGroupId&&D.add(z.goopGroupId)}const F=new Map;for(let _=0;_<qt;_++){const A=_+Qe;for(let z=0;z<st;z++){const X=(k+z)%Se,J=(b=w[A])==null?void 0:b[X];if(J!=null&&J.goopGroupId){const ne=J.goopGroupId;F.has(ne)||F.set(ne,{cells:[],color:J.color}),F.get(ne).cells.push({x:z,y:_})}}}const T=new Set(y.blobs.map(_=>_.id));let $=!1;for(const[_,A]of F)T.has(_)||(y.createBlob(A.cells,A.color,_,!0,k),$=!0);y.shiftBlobsForRotation(k);const V=new Map;for(const _ of M){const A=_.data.goopGroupId;V.has(A)||V.set(A,{avgY:0,cells:[]}),V.get(A).cells.push({x:_.x,y:_.y})}for(const[_,A]of V){const z=A.cells.reduce((X,J)=>X+J.y,0)/A.cells.length;A.avgY=z}for(const _ of y.blobs){const A=V.get(_.id);if(A){_.isLoose=!0,_.isLocked=!1;const z=(A.avgY-Qe)*Pt;_.targetY=z}else _.isLoose&&(_.isLoose=!1,_.isLocked=!0,_.fillAmount=0)}const U=new Set(M.map(_=>_.data.goopGroupId));for(const _ of y.blobs)_.id.startsWith("active-")||!D.has(_.id)&&!U.has(_.id)&&(e.poppedGoopGroupIds.has(_.id)&&(y.createDropletsForPop(_),e.poppedGoopGroupIds.delete(_.id)),y.removeBlob(_.id),$=!0);$&&ke(_=>_+1)},[w,k,y]);const he=v.useRef(null);v.useEffect(()=>{var T;if(!y||!m||m.state!==Ln.FALLING)return;const D=`active-${m.spawnTimestamp}`;if(!y.getBlob(D)&&m.y<=5){const $=m.cells.map(b=>({x:b.x,y:b.y}));let V=m.x-k;V>Se/2&&(V-=Se),V<-Se/2&&(V+=Se);const U=$.map(b=>({x:V+b.x,y:m.y+b.y-Qe})),le=((T=m.definition.cellColors)==null?void 0:T[0])??m.definition.color;y.createBlob(U,le,D,!1,k),ke(b=>b+1)}},[m==null?void 0:m.spawnTimestamp,y,k]);const Ee=v.useRef(null),Ge=v.useRef(0);v.useEffect(()=>{if(!y||!m||m.state!==Ln.FALLING)return;const D=`active-${m.spawnTimestamp}`,F=y.getBlob(D);if(!F)return;let T=m.x-k;T>Se/2&&(T-=Se),T<-Se/2&&(T+=Se);const $=m.rotation,V=Ee.current!==null&&Ee.current!==$,U=Ge.current!==k;if(V){let le=F.gridCells.length>0?F.gridCells[0].y:0;for(const A of F.gridCells)A.y<le&&(le=A.y);let b=m.cells.length>0?m.cells[0].y:0;for(const A of m.cells)A.y<b&&(b=A.y);const _=m.cells.map(A=>({x:T+A.x,y:le+(A.y-b)}));F.gridCells=_,F.rotation=$*90}if(U||V){for(let A=0;A<F.gridCells.length&&A<m.cells.length;A++)F.gridCells[A].x=T+m.cells[A].x;let le=0;for(const A of F.gridCells)le+=A.x;const b=le/F.gridCells.length,_=vn.x+(b+.5)*Pt;if(U){const A=_-F.targetX;for(const z of F.vertices)z.pos.x+=A,z.oldPos.x+=A;for(const z of F.innerVertices)z.pos.x+=A,z.oldPos.x+=A}F.targetX=_}Ee.current=$,Ge.current=k},[m==null?void 0:m.x,m==null?void 0:m.rotation,m==null?void 0:m.state,y,k]),v.useEffect(()=>{if(!y)return;const D=he.current,F=m;if(D&&D.state===Ln.FALLING&&(!F||F.spawnTimestamp!==D.spawnTimestamp)){const T=`active-${D.spawnTimestamp}`;y.removeBlob(T),ke($=>$+1)}he.current=F},[m,y]);const $e=Date.now(),Fe=v.useMemo(()=>by(w,k,M),[w,k,M]),Ne=v.useCallback(D=>{if(N.length===0)return"#a855f7";const F=400,T=.02,$=$e%(N.length*F)/F,V=Math.abs(D)*T;let U=($+V)%N.length;U<0&&(U+=N.length);const le=Math.floor(U),b=(le+1)%N.length,_=U-le,A=N[le],z=N[b];if(!A||!z)return"#a855f7";const X=parseInt(A.slice(1,3),16),J=parseInt(A.slice(3,5),16),ne=parseInt(A.slice(5,7),16),ue=parseInt(z.slice(1,3),16),pe=parseInt(z.slice(3,5),16),Te=parseInt(z.slice(5,7),16),je=Math.round(X+(ue-X)*_),Le=Math.round(J+(pe-J)*_),De=Math.round(ne+(Te-ne)*_);return`rgb(${je}, ${Le}, ${De})`},[$e,N]),Ie=v.useMemo(()=>tn?null:i.jsx("defs",{children:Array.from(Fe.entries()).map(([D,F])=>i.jsx("mask",{id:`mask-${D}`,children:F.map((T,$)=>i.jsx("path",{d:Ry(T.screenX,T.screenY,T.width,Oe,T.neighbors),fill:"white",stroke:"white",strokeWidth:"1.5"},T.cell.id+"-"+$))},`mask-${D}`))}),[Fe]);v.useMemo(()=>new Set(H.map(D=>D.color)),[H]);const O=H.filter(D=>$e-D.spawnTime<500),G=((f==null?void 0:f.GOOP_HOLD_VIEWER)||0)>=1,Ce=((f==null?void 0:f.GOOP_WINDOW)||0)>=1;return i.jsxs("div",{className:"w-full h-full bg-slate-950 relative shadow-2xl border-x-4 border-slate-900 overflow-hidden select-none touch-none",style:{touchAction:"manipulation",contain:"strict"},onPointerDown:B.onPointerDown,onPointerMove:B.onPointerMove,onPointerUp:B.onPointerUp,onPointerLeave:B.onPointerUp,onTouchStart:B.onTouchStart,onTouchMove:B.onTouchMove,onTouchEnd:B.onTouchEnd,onTouchCancel:B.onTouchCancel,children:[!tn&&i.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] hidden md:block",style:{backgroundSize:"100% 2px, 3px 100%"}}),i.jsxs("svg",{width:"100%",height:"100%",viewBox:`${Y} ${re} ${te} ${Z}`,preserveAspectRatio:"xMidYMin meet",className:"touch-none",style:{pointerEvents:"none",willChange:"transform",filter:s<100?`brightness(${s/100}) grayscale(${Math.max(0,(50-s)/50)})`:s>100?`brightness(${s/100})`:void 0,transition:"filter 0.05s linear"},children:[Ie,i.jsxs("defs",{children:[i.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:j,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${g} ${h}`,result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),i.jsxs("filter",{id:"goo-filter-falling",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:x??j,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${C??g} ${R??h}`,result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),i.jsx("clipPath",{id:"tank-viewport-clip",children:i.jsx("rect",{x:Os.x,y:Os.y,width:Os.w,height:Os.h})})]}),i.jsx("rect",{x:Y,y:we,width:te,height:de,fill:W}),i.jsx("line",{x1:Y,y1:we,x2:Y+te,y2:we,stroke:W.replace("0.15","0.6"),strokeWidth:"2",strokeDasharray:"4 4"}),!tn&&Array.from({length:qt}).map((D,F)=>{const T=F*Oe;return Array.from({length:st}).map(($,V)=>{const U=ct(V),le=ct(V+1)-U;return i.jsxs("g",{children:[i.jsx("line",{x1:U,y1:T,x2:U+le,y2:T,stroke:St.GRID_EMPTY,strokeWidth:"1",opacity:.2}),i.jsx("line",{x1:U,y1:T,x2:U,y2:T+Oe,stroke:St.GRID_EMPTY,strokeWidth:"1",opacity:.2})]},`bg-${F}-${V}`)})}),q&&q.filter(D=>$e-D.spawnTime>=500).map(D=>D.branchCrackIds.map(F=>{const T=q.find(ne=>ne.id===F);if(!T||$e-T.spawnTime<500)return null;let $=D.x-k;$>Se/2&&($-=Se),$<-Se/2&&($+=Se);let V=T.x-k;if(V>Se/2&&(V-=Se),V<-Se/2&&(V+=Se),$<-1||$>st||V<-1||V>st)return null;const U=ct($),le=ct($+1)-U,b=U+le/2,_=(D.y-Qe)*Oe+Oe/2,A=ct(V),z=ct(V+1)-A,X=A+z/2,J=(T.y-Qe)*Oe+Oe/2;return i.jsx("line",{x1:b,y1:_,x2:X,y2:J,stroke:D.color,strokeWidth:"2",strokeOpacity:.7},`crack-line-${D.id}-${F}`)})),q&&q.filter(D=>$e-D.spawnTime>=500).map(D=>{let F=D.x-k;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F>=0&&F<st){const T=ct(F),$=ct(F+1)-T,V=(D.y-Qe)*Oe,U=T+$/2,le=V+Oe/2;return i.jsx("circle",{cx:U,cy:le,r:Oe/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`crack-${D.id}`)}return null}),H.filter(D=>$e-D.spawnTime>=500).map(D=>{let F=D.x-k;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F>=0&&F<st){const T=ct(F),$=ct(F+1)-T,V=(D.y-Qe)*Oe,U=T+$/2,le=V+Oe/2;return i.jsx("circle",{cx:U,cy:le,r:Oe/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`goal-${D.id}`)}return null}),H.map(D=>{const F=Ue(k+st/2);let T=D.x-F;if(T>Se/2&&(T-=Se),T<-Se/2&&(T+=Se),Math.abs(T)>st/2){const $=T>0,V=(D.y-Qe)*Oe+Oe/2,U=$?Y+te-5:Y+5;return i.jsx("g",{opacity:.7,children:i.jsx("path",{d:$?`M ${U} ${V-10} L ${U+10} ${V} L ${U} ${V+10} Z`:`M ${U} ${V-10} L ${U-10} ${V} L ${U} ${V+10} Z`,fill:D.color,stroke:"white",strokeWidth:"1"})},`off-${D.id}`)}return null}),i.jsx("g",{opacity:S,children:Array.from(Fe.entries()).map(([D,F])=>{if(F.length===0)return null;const $=F[0].color,V=D===ie,U=D===ye||e.prePoppedGoopGroups.has(D),le=F.some(ue=>ue.cell.isSealingGoop),b=e.prePoppedGoopGroups.has(D),_=F.some(ue=>ue.cell.isWild);let A=1/0,z=1/0,X=-1/0,J=-1/0;F.forEach(ue=>{A=Math.min(A,ue.screenX),z=Math.min(z,ue.screenY),X=Math.max(X,ue.screenX+ue.width),J=Math.max(J,ue.screenY+Oe)});const ne=_?Ne(A):$;if(tn){const ue=F[0].cell.groupSize*fo,pe=$e-F[0].cell.timestamp,Te=Math.min(1,pe/ue),je=Te>=1,Le=J-z,De=J-Te*Le;return i.jsxs("g",{className:U?"shake-anim":"",children:[F.map(Pe=>i.jsx("rect",{x:Pe.screenX-.5,y:Pe.screenY,width:Pe.width+1,height:Oe,fill:Pe.cell.isWild?Ne(Pe.screenX):$,fillOpacity:.25},`bg-${Pe.cell.id}`)),!je&&F.map(Pe=>{const _e=Pe.screenY+Oe,We=Pe.screenY;if(_e<=De)return null;const ce=Math.max(We,De),Be=_e-ce;return i.jsx("rect",{x:Pe.screenX-.5,y:ce,width:Pe.width+1,height:Be,fill:Pe.cell.isWild?Ne(Pe.screenX):$,fillOpacity:.75},`fill-${Pe.cell.id}`)}),je&&F.map(Pe=>i.jsx("rect",{x:Pe.screenX-.5,y:Pe.screenY,width:Pe.width+1,height:Oe,fill:Pe.cell.isWild?Ne(Pe.screenX):$,fillOpacity:.85},`full-${Pe.cell.id}`)),F.map(Pe=>i.jsx("path",{d:Lr(Pe.screenX,Pe.screenY,Pe.width,Oe,Pe.neighbors),fill:"none",stroke:b?"#ff6b6b":le?"white":Pe.cell.isWild?Ne(Pe.screenX):$,strokeWidth:b||le?3:2,strokeDasharray:b?"4 2":void 0,className:Pe.cell.isWild&&!b&&!le?"wild-stroke":void 0},`cnt-${Pe.cell.id}`)),V&&i.jsx("rect",{x:A,y:z,width:X-A,height:J-z,fill:"white",fillOpacity:.3})]},`group-${D}`)}return i.jsxs("g",{className:U?"shake-anim":"",children:[i.jsx("rect",{x:A,y:z,width:X-A,height:J-z,fill:ne,fillOpacity:.2,mask:`url(#mask-${D})`}),i.jsx("g",{opacity:.9,mask:`url(#mask-${D})`,children:F.map((ue,pe)=>{const Te=ue.cell.isWild?Ne(ue.screenX):$;if(!ue.cell||ue.isFalling)return i.jsx("rect",{x:ue.screenX-.5,y:ue.screenY,width:ue.width+1,height:Oe,fill:Te},`liq-${ue.cell.id}`);const je=ue.cell.groupSize*fo,Le=ue.cell.groupMaxY-ue.cell.groupMinY+1,De=je/Math.max(1,Le),_e=(ue.cell.groupMaxY-ue.y)*De,We=$e-ue.cell.timestamp-_e;let ce=We>=De?Oe:We>0?We/De*Oe:0;return i.jsx("rect",{x:ue.screenX-.5,y:ue.screenY+(Oe-ce),width:ue.width+1,height:ce,fill:Te},`liq-${ue.cell.id}`)})}),V&&i.jsx("rect",{x:A,y:z,width:X-A,height:J-z,fill:"white",fillOpacity:.3,mask:`url(#mask-${D})`}),F.map((ue,pe)=>i.jsx("path",{d:Lr(ue.screenX,ue.screenY,ue.width,Oe,ue.neighbors),fill:"none",stroke:b?"#ff6b6b":le?"white":ue.cell.isWild?Ne(ue.screenX):$,strokeWidth:b||le?"3":"2",strokeDasharray:b?"4 2":void 0,className:!tn&&!b?ue.cell.isWild?"wild-stroke":le?"super-glowing-stroke":"glow-stroke":void 0,style:!tn&&!b&&!ue.cell.isWild?{color:le?"white":$}:void 0},`cnt-${ue.cell.id}`))]},`group-${D}`)})}),y&&y.blobs.length>0&&(()=>{const D=new Map;for(const $ of y.blobs){if($.isFalling)continue;const V=D.get($.color)||[];V.push($),D.set($.color,V)}const F=y.attractionSprings,T=y.params;return i.jsx(i.Fragment,{children:Array.from(D.entries()).map(([$,V])=>i.jsxs("g",{children:[i.jsxs("g",{filter:"url(#goo-filter)",clipPath:"url(#tank-viewport-clip)",children:[F.map((U,le)=>{const b=y.blobs[U.blobA],_=y.blobs[U.blobB];if(!b||!_||b.color!==$)return null;const A=b.vertices[U.vertexA],z=_.vertices[U.vertexB];if(!A||!z)return null;const X=po(A.pos.x,z.pos.x),J=z.pos.y-A.pos.y,ne=Math.sqrt(X*X+J*J),ue=Math.min(1,ne/T.goopiness),pe=T.tendrilEndRadius;if(pe<1)return null;const Te=1-T.tendrilSkinniness,je=1-T.tendrilSkinniness*.3,Le=je-(je-Te)*ue,De=pe*Le,Pe=pe*1.4,_e=Math.max(2,Math.ceil(ne/Pe)),We=[];for(let ce=0;ce<=_e;ce++){const Be=ce/_e,Xe=Math.sin(Be*Math.PI),kt=pe-(pe-De)*Xe;We.push({cx:A.pos.x+X*Be,cy:A.pos.y+J*Be,r:Math.max(2,kt)})}return i.jsx("g",{children:We.map((ce,Be)=>i.jsx("circle",{cx:ce.cx,cy:ce.cy,r:ce.r,fill:b.color},Be))},`tendril-${le}`)}),V.map(U=>{const le=ff(U),_=Tl(U).map(A=>A===0?"":`translate(${A}, 0)`);return i.jsx("g",{children:_.map((A,z)=>i.jsx("path",{d:le,fill:U.color,fillRule:"evenodd",transform:A},`soft-${U.id}-${z}`))},`soft-${U.id}`)})]}),i.jsx("g",{clipPath:"url(#tank-viewport-clip)",children:V.map(U=>{if(!U.isLocked||U.fillAmount>=1)return null;const le=U.vertices.map(je=>je.pos),b=T.wallThickness,_=Ly(le,b),A=Wa(_),z=Iy(_),X=z.maxY-z.minY,J=z.maxY-X*U.fillAmount,ne=`fill-clip-${U.id}`,ue=50,Te=Tl(U).map(je=>je===0?"":`translate(${je}, 0)`);return i.jsx("g",{children:Te.map((je,Le)=>i.jsxs("g",{transform:je,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:`${ne}-${Le}`,children:i.jsx("rect",{x:z.minX-ue,y:z.minY-ue,width:z.maxX-z.minX+ue*2,height:J-z.minY+ue})})}),i.jsx("path",{d:A,fill:"#1e293b",clipPath:`url(#${ne}-${Le})`})]},`cutout-${U.id}-${Le}`))},`cutout-${U.id}`)})})]},`color-group-${$}`))})})(),y&&(()=>{const D=y.blobs.filter($=>$.isFalling&&!$.isLocked);if(D.length===0)return null;const F=y.attractionSprings,T=y.params;return i.jsxs("g",{filter:"url(#goo-filter-falling)",clipPath:"url(#tank-viewport-clip)",children:[F.map(($,V)=>{const U=y.blobs[$.blobA],le=y.blobs[$.blobB];if(!U||!le||!U.isFalling&&!le.isFalling)return null;const b=U.vertices[$.vertexA],_=le.vertices[$.vertexB];if(!b||!_)return null;const A=po(b.pos.x,_.pos.x),z=_.pos.y-b.pos.y,X=Math.sqrt(A*A+z*z),J=Math.min(1,X/T.fallingGoopiness),ne=T.fallingTendrilEndRadius;if(ne<1)return null;const ue=1-T.fallingTendrilSkinniness,pe=1-T.fallingTendrilSkinniness*.3,Te=pe-(pe-ue)*J,je=ne*Te,Le=ne*1.4,De=Math.max(2,Math.ceil(X/Le)),Pe=[];for(let _e=0;_e<=De;_e++){const We=_e/De,ce=Math.sin(We*Math.PI),Be=ne-(ne-je)*ce;Pe.push({cx:b.pos.x+A*We,cy:b.pos.y+z*We,r:Math.max(2,Be)})}return i.jsx("g",{children:Pe.map((_e,We)=>i.jsx("circle",{cx:_e.cx,cy:_e.cy,r:_e.r,fill:U.color},We))},`falling-tendril-${V}`)}),D.map($=>Tl($).map((U,le)=>{const b=ff($);if(!b)return null;const _=U===0?void 0:`translate(${U}, 0)`,A=m==null?void 0:m.definition.isWild,z=A?Ne($.targetX):$.color;return i.jsx("path",{d:b,fill:z,fillRule:"evenodd",fillOpacity:.8,transform:_,className:A?"wild-stroke wild-fill":void 0},`falling-${$.id}-${le}`)}))]})})(),y&&y.droplets.length>0&&i.jsx("g",{children:y.droplets.map(D=>i.jsx("circle",{cx:D.pos.x,cy:D.pos.y,r:D.radius,fill:D.color,opacity:D.opacity},D.id))}),P&&y&&y.blobs.length>0&&i.jsx("g",{children:y.blobs.map(D=>i.jsxs("g",{children:[i.jsx("circle",{cx:D.targetX,cy:D.targetY,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),D.vertices.map((F,T)=>{const $=D.vertices[(T+1)%D.vertices.length];return i.jsx("line",{x1:F.pos.x,y1:F.pos.y,x2:$.pos.x,y2:$.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${D.id}-${T}`)}),D.vertices.map((F,T)=>i.jsxs("g",{children:[i.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:F.pos.x+6,y:F.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:T})]},`v-${D.id}-${T}`)),D.innerVertices.map((F,T)=>i.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:3,fill:"gray",stroke:"white",strokeWidth:1},`iv-${D.id}-${T}`)),i.jsx("text",{x:D.targetX,y:D.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:D.isLocked?`${Math.round(D.fillAmount*100)}%`:"falling"})]},`debug-${D.id}`))}),m&&m.state===Ln.FALLING&&(()=>{const D=ip(w,m),F=m.definition.isWild;return m.cells.map((T,$)=>{var _;const V=((_=m.definition.cellColors)==null?void 0:_[$])??m.definition.color,U=Ue(m.x+T.x),le=D+T.y;if(le<Qe)return null;let b=U-k;if(b>Se/2&&(b-=Se),b<-Se/2&&(b+=Se),b>=-2&&b<st+2){const A=ct(b),z=ct(b+1)-A,X=(le-Qe)*Oe,J={t:m.cells.some(ne=>ne.x===T.x&&ne.y===T.y-1),r:m.cells.some(ne=>ne.x===T.x+1&&ne.y===T.y),b:m.cells.some(ne=>ne.x===T.x&&ne.y===T.y+1),l:m.cells.some(ne=>ne.x===T.x-1&&ne.y===T.y)};return i.jsxs("g",{children:[i.jsx("rect",{x:A,y:X,width:z,height:Oe,fill:F?Ne(A):V,fillOpacity:.2,rx:4,ry:4}),i.jsx("path",{d:Lr(A,X,z,Oe,J),fill:"none",stroke:F?Ne(A):V,strokeWidth:"1",strokeDasharray:"4 2",opacity:"0.75",className:F?"wild-stroke":void 0})]},`ghost-${$}`)}return null})})(),ee&&ee.map(D=>{let F=D.x-k;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F<-1||F>st)return null;const T=ct(F),$=ct(F+1)-T,V=(D.y-Qe)*Oe;return V<-Oe?null:i.jsxs("g",{children:[i.jsx("rect",{x:T,y:V,width:$,height:Oe,fill:D.color,fillOpacity:.3,rx:4,ry:4}),i.jsx("rect",{x:T,y:V,width:$,height:Oe,fill:"none",stroke:D.color,strokeWidth:"2",strokeDasharray:"4 2",rx:4,ry:4})]},`dump-${D.id}`)}),!y&&m&&m.state===Ln.FALLING&&(()=>{const D=m.definition.isWild,F=m.cells.map((T,$)=>{var _;const V=((_=m.definition.cellColors)==null?void 0:_[$])??m.definition.color,U=Ue(m.x+T.x),le=m.y+T.y;let b=U-k;if(b>Se/2&&(b-=Se),b<-Se/2&&(b+=Se),b>=-2&&b<st+2){const A=ct(b),z=ct(b+1)-A,X=(le-Qe)*Oe,J={t:m.cells.some(ne=>ne.x===T.x&&ne.y===T.y-1),r:m.cells.some(ne=>ne.x===T.x+1&&ne.y===T.y),b:m.cells.some(ne=>ne.x===T.x&&ne.y===T.y+1),l:m.cells.some(ne=>ne.x===T.x-1&&ne.y===T.y)};return{screenX:A,screenY:X,width:z,neighbors:J,color:V}}return null}).filter(Boolean);return F.length===0?null:i.jsxs("g",{children:[i.jsx("g",{opacity:.8,children:F.map((T,$)=>i.jsx("rect",{x:T.screenX,y:T.screenY,width:T.width,height:Oe,fill:D?Ne(T.screenX):T.color,rx:4,ry:4},$))}),F.map((T,$)=>i.jsx("path",{d:Lr(T.screenX,T.screenY,T.width,Oe,T.neighbors),fill:"none",stroke:"white",strokeWidth:"2",className:D?"wild-stroke":void 0},`outline-${$}`))]})})(),I.map(D=>{let F=D.x-k;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F>=-2&&F<st+2){const T=ct(F),$=ct(F+1)-T,V=(D.y-Qe)*Oe;return i.jsx("text",{x:T+$/2,y:V+Oe/2,fill:D.color,textAnchor:"middle",className:"floating-score",fontSize:"24",children:D.text},D.id)}return null}),e.phase===Ze.TankScreen&&i.jsxs(i.Fragment,{children:[t>=1&&i.jsxs("g",{children:[l&&l[Ae.LASER]>Date.now()&&i.jsxs("text",{x:Y+8+6,y:Z*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[Ae.LASER]-Date.now())/1e3),"s"]}),i.jsx(af,{value:r,colorMode:"drain",x:Y+8,y:Z*.04,height:Z*.2,width:12})]}),t>=3&&i.jsxs("g",{children:[l&&l[Ae.CONTROLS]>Date.now()&&i.jsxs("text",{x:Y+te-20+6,y:Z*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[Ae.CONTROLS]-Date.now())/1e3),"s"]}),i.jsx(af,{value:o,colorMode:"heat",x:Y+te-20,y:Z*.04,height:Z*.2,width:12})]}),c.length>0&&c.map((D,F)=>{const T=En[D];if(!T)return null;const $=a[D]||0,V=$>=100,U=36,le=Y+te-26,b=Z*.3+F*(U+8);return i.jsx(Ey,{upgradeId:D,name:T.name,charge:$,isReady:V,x:le,y:b,size:U,onClick:()=>V&&(u==null?void 0:u(D))},D)})]})]}),ve.position&&ve.progress>0&&i.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:ve.position.x,top:ve.position.y,transform:"translate(-50%, -50%)"},children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${ve.progress/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),se>=0&&i.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:"50%",bottom:"15%",transform:"translate(-50%, 0)"},children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${se/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),e.complications.length>0&&i.jsx("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none",style:{gap:"1.5rem"},children:[...e.complications].sort((D,F)=>D.startTime-F.startTime).map(D=>{const T={[Ae.LIGHTS]:"Lights",[Ae.CONTROLS]:"Controls",[Ae.LASER]:"Laser"}[D.type]||D.type;return i.jsxs("div",{className:"malfunction-pulse text-center",style:{textShadow:"0 0 20px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.5)"},children:[i.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:T}),i.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:"Malfunction"}),i.jsx("div",{className:"text-red-400 mt-2",style:{fontFamily:"'Amazon Ember', sans-serif",fontSize:"clamp(0.875rem, 3vw, 1.25rem)"},children:"Fix at Console"})]},D.id)})}),O.map(D=>{const F=$e-D.spawnTime,T=Math.min(1,F/500),$=1-(1-T)*(1-T),U=50+(N.indexOf(D.color)-(N.length-1)/2)*8,le=6,b=E(D.x,D.y),_=U+(b.x-U)*$,A=le+(b.y-le)*$;return i.jsx("div",{className:"absolute w-4 h-4 rounded-full shadow-lg border border-white/50 z-30",style:{backgroundColor:D.color,left:`${_}%`,top:`${A}%`,transform:"translate(-50%, -50%)",boxShadow:tn?`0 0 4px ${D.color}`:`0 0 10px ${D.color}`}},`fly-${D.id}`)}),e.phase===Ze.TankScreen&&(G||Ce)&&i.jsxs("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:10,display:"flex",gap:"8px"},children:[i.jsx(uf,{piece:d??null,label:"STORED",visible:G,rank:t}),i.jsx(uf,{piece:p??null,label:"NEXT",visible:Ce,rank:t})]})]})};var Ky={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Qy=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Jy=(e,t)=>{const n=v.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:l,children:c,...a},u)=>v.createElement("svg",{ref:u,...Ky,width:r,height:r,stroke:s,strokeWidth:l?Number(o)*24/Number(r):o,className:`lucide lucide-${Qy(e)}`,...a},[...t.map(([f,d])=>v.createElement(f,d)),...(Array.isArray(c)?c:[c])||[]]));return n.displayName=`${e}`,n};var $t=Jy;const eg=$t("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),tg=$t("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Ji=$t("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),ng=$t("Combine",[["rect",{width:"8",height:"8",x:"2",y:"2",rx:"2",key:"z1hh3n"}],["path",{d:"M14 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"83orz6"}],["path",{d:"M20 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"k86dmt"}],["path",{d:"M10 18H5c-1.7 0-3-1.3-3-3v-1",key:"6vokjl"}],["polyline",{points:"7 21 10 18 7 15",key:"1k02g0"}],["rect",{width:"8",height:"8",x:"14",y:"14",rx:"2",key:"1fa9i4"}]]),sg=$t("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),og=$t("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),rg=$t("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ig=$t("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),lg=$t("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),cg=$t("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ag=$t("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),ug=$t("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["line",{x1:"12",x2:"12.01",y1:"6",y2:"6",key:"16cbga"}]]),fg=$t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),dg=$t("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),pg=$t("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),hg=({state:e,maxTime:t})=>{const{shiftScore:n,gameOver:s,popStreak:r,shiftTime:o}=e,l=Math.max(0,Math.min(1,1-o/t)),c=l>.8,a=l>.9;return i.jsxs(i.Fragment,{children:[a&&!s&&i.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_40%,rgba(100,0,0,0.4)_100%)] animate-pulse"}),i.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 px-1 pt-4 pointer-events-none z-50 flex justify-between items-start",style:{width:"min(100%, 100dvh * 0.75)"},children:[i.jsxs("div",{className:"flex flex-col items-start drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[i.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-0.5 text-slate-400/90",children:"Pressure"}),i.jsxs("div",{className:`flex items-baseline gap-1 ${c?"text-red-500 animate-pulse":"text-slate-200"}`,children:[i.jsx(eg,{className:"w-5 h-5 opacity-90"}),i.jsxs("span",{className:"text-4xl font-mono font-black leading-none tracking-tighter",children:[(l*100).toFixed(0),"%"]})]})]}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-16 flex flex-col items-center",children:r>1&&i.jsxs("div",{className:"text-2xl text-yellow-400 animate-bounce font-black tracking-wider whitespace-nowrap drop-shadow-[0_4px_4px_rgba(0,0,0,0.9)] stroke-black",children:["x",r," SURGE"]})}),i.jsxs("div",{className:"flex flex-col items-end drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[i.jsx("span",{className:"text-[10px] text-green-500/90 uppercase font-bold tracking-widest mb-0.5",children:"Shift Score"}),i.jsx("span",{className:"text-4xl font-mono text-green-400 font-black leading-none tracking-tighter shadow-green-500/10",children:n.toLocaleString()})]})]}),i.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center text-slate-500 text-xs pointer-events-none hidden md:block opacity-30 z-50 font-mono",children:"ARROWS / WASD to Rotate Cylinder  SPACE to Drop  CLICK Masses to Purge"})]})},cs=50,on=e=>e<=0?0:e*(3375+125*e),xg=e=>{if(e<=0)return 0;if(e>=cs)return on(cs);const t=on(e),n=on(e+1);return Math.floor(t+(n-t)*.5)},yg=()=>{const e=[];for(let t=10;t<=cs;t+=10)e.push(t);return e},gg=(e,t)=>{if(t<=e)return[];const n=[],s=yg();for(const r of s)r>e&&r<=t&&n.push(r);return n},ft=e=>{if(e<on(1))return{rank:0,progress:Math.max(0,e),toNextRank:3500,careerScore:Math.max(0,e),isMaxRank:!1};let t=1;for(;t<cs&&e>=on(t+1);)t++;const n=on(t),s=on(t+1),r=e-n,o=s-n;return{rank:t,progress:r,toNextRank:o,careerScore:e,isMaxRank:t>=cs}},ap=(e,t,n)=>{const s=ft(e).rank,r=s+2,o=e+t,l=ft(o),c=l.rank-s;let a,u;return n?c===0?(a=s+1,u=on(a)+100):c===1?(a=s+2,u=on(a)+100):(a=r,u=on(a)+100):c<=2?(u=o,a=l.rank):(a=r,u=on(a)+100),a>cs&&(a=cs,u=on(cs)),{newCareerScore:u,ranksGained:a-s}},ds={[Ae.LASER]:{unlockRank:4,capacitorMax:100,drainPerUnit:4,drainUpgradeEffect:En.CAPACITOR_EFFICIENCY.effectPerLevel},[Ae.LIGHTS]:{unlockRank:2,graceBaseSec:5,gracePerLevel:.75,dimDurationSec:5,recoverRate:400,overflarePeak:110,overflareUpMs:50,overflareDownMs:100,dimThreshold:10,failedBrightness:5,snapToFailMs:100,flickerDipBrightness:70,flickerDipMs:80,flickerRecoverMs:120},[Ae.CONTROLS]:{unlockRank:6,heatMax:100,heatPerRotation:5,dissipationBase:50,dissipationUpgradeEffect:En.GEAR_LUBRICATION.effectPerLevel,idleThresholdMs:200}},yf={minSeconds:8,maxSeconds:20};function mg(e,t){const n=ds[e].unlockRank;return Math.max(yf.minSeconds,yf.maxSeconds-(t-n))*1e3}function ho(e,t){return t>=ds[e].unlockRank}class vg{constructor(){ze(this,"ctx",null);ze(this,"masterGain",null);ze(this,"musicGain",null);ze(this,"sfxGain",null);ze(this,"droneOsc",null);ze(this,"droneLfo",null);ze(this,"settings",{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1});ze(this,"isInitialized",!1)}init(t){if(this.isInitialized){this.updateSettings(t);return}this.settings=t;try{const n=window.AudioContext||window.webkitAudioContext;this.ctx=new n,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.updateVolumes(),this.isInitialized=!0}catch(n){console.error("Audio init failed",n)}}updateSettings(t){this.settings=t,this.updateVolumes()}updateVolumes(){if(!this.masterGain||!this.musicGain||!this.sfxGain||!this.ctx)return;const t=this.ctx.currentTime,n=this.settings.masterVolume/100*.5,s=this.settings.musicVolume/100,r=this.settings.sfxVolume/100;this.masterGain.gain.setTargetAtTime(n,t,.1),this.musicGain.gain.setTargetAtTime(s,t,.1),this.sfxGain.gain.setTargetAtTime(r,t,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}startMusic(){this.stopMusic()}stopMusic(){if(this.droneOsc){try{this.droneOsc.stop()}catch{}this.droneOsc=null}if(this.droneLfo){try{this.droneLfo.stop()}catch{}this.droneLfo=null}}setPressure(t){}playPop(t){if(!this.ctx||!this.sfxGain)return;const n=this.ctx.currentTime,s=this.ctx.createOscillator(),r=this.ctx.createGain();s.connect(r),r.connect(this.sfxGain);const o=400+t*50;s.frequency.setValueAtTime(o,n),s.frequency.exponentialRampToValueAtTime(o*2,n+.1),r.gain.setValueAtTime(.5,n),r.gain.exponentialRampToValueAtTime(.01,n+.15),s.start(n),s.stop(n+.15)}playReject(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(150,t),n.frequency.linearRampToValueAtTime(100,t+.15),s.gain.setValueAtTime(.3,t),s.gain.linearRampToValueAtTime(0,t+.15),n.start(t),n.stop(t+.15)}playMove(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="triangle";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(800,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),n.start(t),n.stop(t+.05)}playRotate(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="square";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(600,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),n.start(t),n.stop(t+.08)}playDrop(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sine",n.frequency.setValueAtTime(350,t),n.frequency.exponentialRampToValueAtTime(60,t+.15);const s=this.ctx.createGain();s.gain.setValueAtTime(.4,t),s.gain.exponentialRampToValueAtTime(.01,t+.15),n.connect(s),s.connect(this.sfxGain),n.start(t),n.stop(t+.15);const r=this.ctx.sampleRate*.2,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),l=o.getChannelData(0);for(let f=0;f<r;f++)l[f]=Math.random()*2-1;const c=this.ctx.createBufferSource();c.buffer=o;const a=this.ctx.createBiquadFilter();a.type="lowpass",a.Q.value=8,a.frequency.setValueAtTime(800,t),a.frequency.exponentialRampToValueAtTime(200,t+.15);const u=this.ctx.createGain();u.gain.setValueAtTime(.3,t),u.gain.exponentialRampToValueAtTime(.01,t+.15),c.connect(a),a.connect(u),u.connect(this.sfxGain),c.start(t)}playGameOver(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(400,t),n.frequency.linearRampToValueAtTime(50,t+1.5),s.gain.setValueAtTime(.5,t),s.gain.linearRampToValueAtTime(0,t+1.5),n.start(t),n.stop(t+1.5)}}const mt=new vg,Sg=1e3;class Cg{checkComplications(t,n,s){const r=Date.now();if(r-s<Sg)return{spawned:null,newLastCheckTime:s};const o=f=>t.complications.some(d=>d.type===f),l=f=>r<t.complicationCooldowns[f],c=ft(n).rank,a=ds[Ae.CONTROLS];let u=null;return!o(Ae.LASER)&&!l(Ae.LASER)&&ho(Ae.LASER,c)&&t.laserCharge<=0?u=Ae.LASER:!o(Ae.CONTROLS)&&!l(Ae.CONTROLS)&&ho(Ae.CONTROLS,c)&&t.controlsHeat>=a.heatMax&&(u=Ae.CONTROLS),{spawned:u,newLastCheckTime:r}}spawnComplication(t,n){const r={id:Math.random().toString(36).substr(2,9),type:n,startTime:Date.now(),severity:1};return t.complications=[...t.complications,r],me.emit(xe.COMPLICATION_SPAWNED,{type:n}),r}resolveComplication(t,n,s,r){const o=t.complications.find(l=>l.id===n);if(o){switch(o.type){case Ae.LASER:t.laserCharge=ds[Ae.LASER].capacitorMax,t.prePoppedGoopGroups.clear();break;case Ae.CONTROLS:t.controlsHeat=0,t.rotationTimestamps=[];break;case Ae.LIGHTS:t.lightsBrightness=100,t.lightsGraceStart=Date.now(),t.lightsFlickered=!1;break}const l=ft(s+t.shiftScore).rank,c=mg(o.type,l);t.complicationCooldowns[o.type]=Date.now()+c}t.complications=t.complications.filter(l=>l.id!==n),t.activeComplicationId=null,me.emit(xe.COMPLICATION_RESOLVED),mt.playPop(5)}extendAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Ae)){const o=t.complicationCooldowns[r];if(o>s){const c=(o-s)*n;t.complicationCooldowns[r]=o+c}}}reduceAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Ae)){const o=t.complicationCooldowns[r];if(o>s){const c=(o-s)*n;t.complicationCooldowns[r]=Math.max(s,o-c)}}}}const Ds=new Cg;class Nr{constructor(t){ze(this,"type","SPIN_TANK");this.dir=t}execute(t){if(t.state.gameOver||t.state.isPaused)return;const n=Ue(t.state.tankRotation+this.dir);let s=t.state.activeGoop;if(t.state.activeGoop){const a=Yc(t.state.activeGoop.screenX,n);s={...t.state.activeGoop,x:a};const u=Math.round(s.y),f={...s,y:u};if(fs(t.state.grid,f)){me.emit(xe.ACTION_REJECTED);return}fs(t.state.grid,s)&&(s=f)}t.state.tankRotation=n,s&&(t.state.activeGoop=s),t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++);const r=Date.now();t.state.rotationTimestamps.push(r),t.state.rotationTimestamps.length>ox&&t.state.rotationTimestamps.shift();const o=ft(t.initialTotalScore).rank,l=ds[Ae.CONTROLS],c=Date.now()<t.state.complicationCooldowns[Ae.CONTROLS];ho(Ae.CONTROLS,o)&&!c&&(t.state.controlsHeat=Math.min(l.heatMax,t.state.controlsHeat+l.heatPerRotation)),me.emit(xe.PIECE_MOVED),t.emitChange()}}class bo{constructor(t){ze(this,"type","ROTATE_GOOP");this.clockwise=t}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=(n.rotation+(this.clockwise?1:-1)+4)%4;if(n.definition.type===be.O||n.definition.type===be.T_O){const c=n.definition.cellColors,a=c&&c.length===4?this.clockwise?[c[2],c[0],c[3],c[1]]:[c[1],c[3],c[0],c[2]]:c;me.emit(xe.PIECE_ROTATED),t.state.activeGoop={...n,rotation:s,definition:{...n.definition,cellColors:a}},t.emitChange();return}const r=uy(n.cells,this.clockwise,n.rotationCenter),o={...n,cells:r,rotation:s},l=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:0,y:-2},{x:1,y:-2},{x:-1,y:-2},{x:2,y:0},{x:-2,y:0}];for(const c of l){const a=Ue(o.x+c.x),u=ay(a,t.state.tankRotation),f={...o,x:a,y:o.y+c.y,screenX:u};if(!fs(t.state.grid,f,t.state.tankRotation)){me.emit(xe.PIECE_ROTATED),t.state.activeGoop=f,t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++),t.emitChange();return}}}}class El{constructor(t){ze(this,"type","SET_FAST_DROP");this.active=t}execute(t){t.isFastDropping=this.active}}class kg{constructor(){ze(this,"type","SWAP_PIECE")}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=n.definition,r=t.state.storedGoop;if(r){const o=Math.round(r.cells.reduce((a,u)=>a+u.x,0)/r.cells.length),l=Math.round(r.cells.reduce((a,u)=>a+u.y,0)/r.cells.length),c={definition:r,cells:[...r.cells],rotation:0,rotationCenter:{x:o,y:l},spawnTimestamp:Date.now(),startSpawnY:n.y,screenX:n.screenX,x:n.x,y:n.y,state:Ln.FALLING};if(fs(t.state.grid,c,t.state.tankRotation)){me.emit(xe.ACTION_REJECTED);return}me.emit(xe.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.state.activeGoop=c}else me.emit(xe.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.spawnNewPiece();t.emitChange()}}class wg{constructor(t,n){ze(this,"type","POP_GOOP");this.x=t,this.y=n}execute(t){if(t.state.gameOver||t.state.isPaused)return;const n=t.state.grid[this.y][this.x];if(!n)return;const s=Math.max(0,1-t.state.shiftTime/t.maxTime),r=Ye-1-s*(qt-1);if(n.groupMinY<r){me.emit(xe.ACTION_REJECTED);return}const o=Date.now(),l=n.groupSize*fo;if(o-(n.timestamp||0)<l){me.emit(xe.ACTION_REJECTED);return}const a=dy(t.state.grid,this.x,this.y);if(a.length>0){if(t.state.complications.find(N=>N.type===Ae.LASER)){const N=n.goopGroupId;if(!t.state.prePoppedGoopGroups.has(N)){t.state.prePoppedGoopGroups.add(N);const Q=Date.now();a.forEach(ae=>{const W=t.state.grid[ae.y][ae.x];W&&(W.timestamp=Q)}),me.emit(xe.ACTION_REJECTED),t.emitChange();return}t.state.prePoppedGoopGroups.delete(N)}me.emit(xe.GOOP_POPPED,{popStreak:t.state.popStreak,count:a.length}),t.state.cellsCleared++,t.state.totalUnitsPopped+=a.length;const f=ft(t.initialTotalScore).rank,d=ds[Ae.LASER];if(ho(Ae.LASER,f)){const N=t.powerUps.CAPACITOR_EFFICIENCY||0,Q=1-d.drainUpgradeEffect*N,ae=a.length*d.drainPerUnit*Q;t.state.laserCharge=Math.max(0,t.state.laserCharge-ae)}const p=a.length;t.state.gameStats.maxGroupSize=Math.max(t.state.gameStats.maxGroupSize,p);const y=rx,S=p*ix;let P=0;p>=of&&(P=(Math.floor((p-of)/lx)+1)*cx);let j=0;a.forEach(N=>{var Q;(Q=t.state.grid[N.y][N.x])!=null&&Q.isSealingGoop&&j++});const g=j*3e3;if(j>0){t.state.goalsCleared+=j,me.emit(xe.GOAL_CAPTURED,{count:j}),t.chargeActiveAbilities(j*25);const N=t.powerUps.SEALING_BONUS||0;if(N>0){const W=.1+N*.05;for(let K=0;K<j;K++)Ds.reduceAllCooldowns(t.state,W)}}const h=y+S+P+g;t.state.shiftTime=Math.min(t.maxTime,t.state.shiftTime+h),t.state.gameStats.totalBonusTime+=h;let x=0,C=t.state.popStreak+1,R={base:0,height:0,offscreen:0,adjacency:0,speed:0};const w=vy(t.state.grid,a);x+=w,R.adjacency+=w,a.forEach(N=>{let Q=10,ae=yy(N.y),W=gy(N.x,t.state.tankRotation);const K=my(C),Y=(Q+ae+W)*K;x+=Y,R.base+=Q*K,R.height+=ae*K,R.offscreen+=W*K});const k=Math.floor(x);t.updateScoreAndStats(k,R),t.state.popStreak=C;const m=Math.random().toString(36).substr(2,9),M=[{id:m,text:`+${k}`,x:this.x,y:this.y,life:1,color:"#fbbf24"},{id:m+"_time",text:"Vented",x:this.x,y:this.y-1,life:1,color:"#4ade80"}];j>0&&M.push({id:m+"_bonus",text:"SEALED!",x:this.x,y:this.y-2,life:1.5,color:"#fff"}),t.state.floatingTexts.push(...M),setTimeout(()=>{t.state.floatingTexts=t.state.floatingTexts.filter(N=>!N.id.startsWith(m)),t.emitChange()},1e3);const I=n.goopGroupId;I&&t.state.poppedGoopGroupIds.add(I);let L=t.state.grid.map(N=>[...N]);const H=[];a.forEach(N=>{L[N.y][N.x]=null,H.push({x:N.x,y:N.y})});const{grid:q,looseGoop:ee}=lp(L,H);if(j>0&&t.state.goalsCleared>=t.state.goalsTarget){const N=Math.max(0,1-t.state.shiftTime/t.maxTime),Q=ft(t.initialTotalScore+t.state.shiftScore).rank;if(N<.9){const ae=Sy(q,t.state.goalMarks,Q,t.state.shiftTime,t.maxTime);t.state.goalMarks.push(...ae),me.emit(xe.GOAL_CAPTURED,{count:1})}else t.state.goalMarks=[]}t.state.grid=q,t.state.looseGoop.push(...ee),t.emitChange()}}}class jg{constructor(){ze(this,"type","START_RUN")}execute(t){t.startRun()}}class $s{constructor(t){ze(this,"type","SET_PHASE");this.phase=t}execute(t){this.phase===Ze.TankScreen?t.enterPeriscope():this.phase===Ze.ConsoleScreen?t.enterConsole():(t.state.phase=this.phase,t.emitChange())}}class Pg{constructor(t){ze(this,"type","RESOLVE_COMPLICATION");this.id=t}execute(t){t.resolveComplication(this.id)}}class Rg{constructor(t){ze(this,"type","ACTIVATE_ABILITY");this.upgradeId=t}execute(t){t.state.gameOver||t.state.isPaused||(t.state.activeCharges[this.upgradeId]||0)<100||(t.state.activeCharges[this.upgradeId]=0,t.activateAbility(this.upgradeId),me.emit(xe.ABILITY_ACTIVATED,{upgradeId:this.upgradeId}),t.emitChange())}}const bg=(e,t,n,s,r,o,l)=>{if(!e)return"FAILURE";const c=n>0?Math.min(100,t/n*100):100,a=Math.max(0,100-s*2),u=Math.max(0,100-s*3),f=o>0?Math.min(100,r/o*100):50,d=Math.min(100,l/100),p=(c+a+u+f+d)/5;return p>=80?"A":p>=60?"B":p>=40?"C":"FAILURE"},Mg=({shiftScore:e,rank:t,xpCurrent:n,xpNext:s,cracksFilled:r,cracksTarget:o,pressureVented:l,maxTime:c,massPurged:a,leftoverPenalty:u,unspentPower:f,isWin:d})=>{const y=Math.min(1,Math.max(0,n/s))*366.31,S=bg(d,r,o,u,l,c,e),P=S==="A"?"#5bbc70":S==="B"?"#6acbda":S==="C"?"#ffd92b":"#d82727",j=c>0?Math.round(l/c*100):0;return i.jsxs("g",{id:"End_Game_Monitor_Group",children:[i.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),i.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'From Where You Are'",fontSize:"42",transform:"translate(291.5 122.96)",textAnchor:"middle",children:"SHIFT OVER"}),i.jsxs("text",{fill:P,fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"24",letterSpacing:"0.1em",transform:"translate(291.5 155)",textAnchor:"middle",children:["GRADE: ",S]}),i.jsx("path",{fill:"#5bbc70",d:"M525.21,243.36H58.95c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM58.95,223.59c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H58.95Z"}),i.jsx("path",{fill:"#5bbc70",d:`M57.75,223.09h${y}v19.77H57.75c-4.79,0-8.68-3.89-8.68-8.68v-2.4c0-4.79,3.89-8.68,8.68-8.68Z`}),i.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(530 237)",children:[Math.floor(n).toLocaleString()," / ",Math.floor(s).toLocaleString()]}),i.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(530 213)",children:"PROMOTION THRESHOLD"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(49.87 209.32)",children:i.jsx("tspan",{x:"0",y:"0",children:"OPERATOR RANK"})}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(230 210.8)",textAnchor:"start",children:t}),i.jsx("path",{fill:"#fff",d:"M268.4,808.13v-1.02l.33-1.02c6.23-8.15,13.08-15.87,19.51-23.87,1.65-2.11,4.36-2.41,6.29-.46l20.02,23c.62.7,1,1.44,1.2,2.36-.03.33.04.7,0,1.02-.21,1.7-1.77,3.25-3.47,3.42h-40.15c-1.85-.05-3.51-1.61-3.74-3.42ZM271.73,793.93c1.56-1.89,3.12-3.76,4.65-5.6,2.57-3.07,5.23-6.25,7.76-9.4,1.83-2.35,4.56-3.73,7.45-3.73,2.47,0,4.83,1.01,6.66,2.85l.12.12,13.75,15.8h.16c1.7-.17,3.26-1.72,3.47-3.42.04-.32-.03-.69,0-1.02-.2-.92-.58-1.66-1.21-2.36l-20.02-23c-1.94-1.95-4.65-1.65-6.29.46-6.44,8.01-13.29,15.72-19.51,23.87l-.33,1.02v1.02c.21,1.67,1.66,3.12,3.33,3.37Z"}),i.jsx("text",{fill:"#d82727",fontFamily:"'From Where You Are'",fontSize:"24",transform:"translate(291.5 860.65)",textAnchor:"middle",children:"DRAG UP TO END SHIFT"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(165.69 321.1)",textAnchor:"middle",children:"SHIFT SCORE"}),i.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(165.69 390.05)",textAnchor:"middle",children:e.toLocaleString()}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M261.87,585.41H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 503.38)",textAnchor:"middle",children:"CRACKS FILLED"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 557.36)",textAnchor:"middle",children:[r," / ",o]})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M514.25,585.41h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 503.38)",textAnchor:"middle",children:"PRESSURE VENTED"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 557.36)",textAnchor:"middle",children:[j,"%"]})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M261.87,731.68H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 649.64)",textAnchor:"middle",children:"MAX POP"}),i.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 703.63)",textAnchor:"middle",children:a})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M514.25,731.68h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 649.64)",textAnchor:"middle",children:"RESIDUAL GOOP"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 703.63)",textAnchor:"middle",children:["-",u]})]}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(418.08 321.1)",textAnchor:"middle",children:"SCRAPS"}),i.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(418.08 390.05)",textAnchor:"middle",children:f})]})},Tg="#14b8a6",Eg="#ffffff",Ag="#22c55e",Or="#231f20",Dr="#d8672b";function _g({complications:e,isLaserMaxed:t,onResolveComplication:n}){const[s,r]=v.useState({active:!1,solved:!1,targets:[0,0,0,0]}),[o,l]=v.useState([0,0,0,0]),[c,a]=v.useState(null),[u,f]=v.useState(!1),d=v.useRef([]),p=v.useRef(null),y=v.useRef(null),S=v.useCallback(()=>e.some(h=>h.type===Ae.LASER),[e]);v.useEffect(()=>{const h=d.current.some(C=>C.type===Ae.LASER),x=S();h&&!x&&(f(!0),y.current=setTimeout(()=>{f(!1)},2500)),d.current=e},[e,S]),v.useEffect(()=>{if(!S()&&(s.active||s.solved)&&(r({active:!1,solved:!1,targets:[0,0,0,0]}),l([0,0,0,0])),S()&&!s.active&&!s.solved){const h=t?[-1,1]:[-1,0,1],x=[0,1,2,3].map(()=>h[Math.floor(Math.random()*h.length)]),C=x.map(R=>{const w=h.filter(k=>k!==R);return w[Math.floor(Math.random()*w.length)]});l(C),r({active:!0,solved:!1,targets:x})}},[e,s.active,s.solved,t,S]),v.useEffect(()=>()=>{p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]);const P=v.useCallback((h,x)=>{l(R=>{const w=[...R];return w[h]=x,e.find(m=>m.type===Ae.LASER),w});const C=e.find(R=>R.type===Ae.LASER);if(C&&!s.solved){const R=s.targets[h];if(x!==R)a(h),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>a(null),300);else{const w=[...o];w[h]=x,w.every((m,M)=>m===s.targets[M])&&(r(m=>({...m,solved:!0})),l([0,0,0,0]),n&&n(C.id))}}},[e,s.solved,s.targets,o,n]),j=v.useCallback(h=>{if(!S())return{left:Or,right:Or};const x=s.targets[h];return x===-1?{left:Dr,right:Or}:x===1?{left:Or,right:Dr}:{left:Dr,right:Dr}},[S,s.targets]),g=v.useCallback(()=>S()?{text:"REPAIR LASER",color:Eg}:u?{text:"LASER FIXED",color:Ag}:{text:"REPAIR LASER",color:Tg},[S,u]);return{laserSliders:o,updateLaserSlider:P,shakingSlider:c,getLaserLightColors:j,getLaserTextState:g,recentlyFixed:u,isComplicationActive:S()}}const gf={0:"#96d7dd",1:"#f6f081",2:"#cb8abc"},Ig=[45,315,225,135],mf=[45,135,225,315],Lg="#14b8a6",Ng="#ffffff",Og="#22c55e",Wt="#231f20",$r="#d8672b";function Dg({complications:e,isLightsMaxed:t,pressedBtn:n,onResolveComplication:s}){const[r,o]=v.useState({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),[l,c]=v.useState(0),[a,u]=v.useState(!1),[f,d]=v.useState(!1),p=v.useRef([]),y=v.useRef(null),S=v.useRef(null),P=v.useRef([]),j=v.useCallback(()=>e.some(m=>m.type===Ae.LIGHTS),[e]),g=v.useCallback(()=>{const m=[],M=[0,0,0],I=t?3:4;for(let L=0;L<I;L++){const H=[];M[0]<2&&H.push(0),M[1]<2&&H.push(1),M[2]<2&&H.push(2);const q=H[Math.floor(Math.random()*H.length)];m.push(q),M[q]++}return m},[t]),h=v.useCallback(m=>{P.current.forEach(ee=>clearTimeout(ee)),P.current=[];let H=300;m.forEach(ee=>{const N=setTimeout(()=>{o(ae=>({...ae,showingIndex:ee}))},H);P.current.push(N);const Q=setTimeout(()=>{o(ae=>({...ae,showingIndex:-1}))},H+200);P.current.push(Q),H+=200+100});const q=setTimeout(()=>{o(ee=>({...ee,phase:"input",showingIndex:-1,inputIndex:0}))},H+100);P.current.push(q)},[]);v.useEffect(()=>{const m=p.current.some(I=>I.type===Ae.LIGHTS),M=j();m&&!M&&(d(!0),S.current=setTimeout(()=>{d(!1)},2500)),p.current=e},[e,j]),v.useEffect(()=>{if(!j()&&r.phase!=="inactive"&&(o({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),c(0)),j()&&r.phase==="inactive"){const m=g();o({phase:"slider1",slider1Target:Math.random()>.5?1:-1,sequence:m,inputIndex:0,showingIndex:-1}),c(0)}},[e,r.phase,j,g]),v.useEffect(()=>()=>{y.current&&clearTimeout(y.current),S.current&&clearTimeout(S.current),P.current.forEach(m=>clearTimeout(m))},[]);const x=v.useCallback(m=>{if(r.phase!=="input")return;const M=r.sequence[r.inputIndex];if(m===M){const I=r.inputIndex+1;I>=r.sequence.length?o(L=>({...L,phase:"slider2",inputIndex:0})):o(L=>({...L,inputIndex:I}))}else{o(L=>({...L,phase:"showing",inputIndex:0,showingIndex:-1}));const I=setTimeout(()=>{h(r.sequence)},300);P.current.push(I)}},[r.phase,r.sequence,r.inputIndex,h]),C=v.useCallback(m=>{const{phase:M,slider1Target:I,sequence:L}=r;if(M==="slider1")m===I?(c(m),o(H=>({...H,phase:"showing"})),h(L)):m!==0?(u(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),c(0)},400)):c(m);else if(M==="slider2"){const H=I===1?-1:1;if(c(m),m===H){o(ee=>({...ee,phase:"solved"})),c(0);const q=e.find(ee=>ee.type===Ae.LIGHTS);q&&s&&s(q.id)}}else c(m)},[e,r,s,h]),R=v.useCallback(m=>!j()||r.phase==="inactive"?Wt:r.phase==="showing"&&r.showingIndex===m||r.phase==="input"&&n===["blue","green","purple"][m]?gf[m]:Wt,[j,r.phase,r.showingIndex,n]),w=v.useCallback(()=>{const{phase:m,slider1Target:M}=r;return j()?m==="inactive"?{top:Wt,bottom:Wt}:m==="slider1"?M===1?{top:Wt,bottom:$r}:{top:$r,bottom:Wt}:m==="slider2"?M===1?{top:$r,bottom:Wt}:{top:Wt,bottom:$r}:{top:Wt,bottom:Wt}:{top:Wt,bottom:Wt}},[j,r]),k=v.useCallback(()=>j()?{text:"REPAIR LIGHTS",color:Ng}:f?{text:"LIGHTS FIXED",color:Og}:{text:"REPAIR LIGHTS",color:Lg},[j,f]);return{lightsComplication:r,lightSlider:l,handleLightsButton:x,handleLightsSliderChange:C,lightsSliderShaking:a,getLightsButtonLightColor:R,getLightsSliderLightColors:w,getLightsTextState:k,recentlyFixed:f,isComplicationActive:j()}}const $g="#14b8a6",Fg="#ffffff",Bg="#22c55e",Al="#231f20",zg="#d8672b",vf=194.32,Sf=1586.66,Gg=86.84,Yg=Gg*1.3;function Hg({complications:e,isControlsMaxed:t,onResolveComplication:n}){const[s,r]=v.useState({active:!1,solved:!1,targetCorner:null,completedCorners:0}),[o,l]=v.useState(0),[c,a]=v.useState(!1),[u,f]=v.useState(!1),[d,p]=v.useState(!1),[y,S]=v.useState(!1),P=v.useRef([]),j=v.useRef(null),g=v.useRef(null),h=v.useRef(null),x=v.useRef(null),C=v.useRef(!1),R=v.useRef(0),w=v.useRef(0),k=v.useRef(0),m=v.useRef(!1),M=v.useRef(!1),I=v.useCallback(()=>e.some(Y=>Y.type===Ae.CONTROLS),[e]),L=v.useCallback((Y,re)=>{try{const te=document.getElementById("coord-reference");if(!te)return null;const Z=te.ownerSVGElement;if(!Z)return null;const de=Z.createSVGPoint();de.x=Y,de.y=re;const we=te.getScreenCTM();if(!we)return null;const E=de.matrixTransform(we.inverse());return{x:E.x,y:E.y}}catch{return null}},[]);v.useEffect(()=>{const Y=P.current.some(te=>te.type===Ae.CONTROLS),re=I();Y&&!re&&(S(!0),g.current=setTimeout(()=>{S(!1)},2500)),P.current=e},[e,I]),v.useEffect(()=>{if(!I()&&(s.active||s.solved)&&r({active:!1,solved:!1,targetCorner:null,completedCorners:0}),I()&&!s.active&&!s.solved){const Y=Math.floor(Math.random()*4);r({active:!0,solved:!1,targetCorner:Y,completedCorners:0})}},[e,s.active,s.solved,I]),v.useEffect(()=>()=>{j.current&&clearTimeout(j.current),g.current&&clearTimeout(g.current),h.current&&clearTimeout(h.current),x.current&&clearTimeout(x.current)},[]);const H=v.useCallback((Y,re)=>{const te=L(Y,re);if(!te)return;const Z=te.x-vf,de=te.y-Sf;Math.sqrt(Z*Z+de*de)>Yg||(R.current=Math.atan2(de,Z)*(180/Math.PI),w.current=o,C.current=!0,m.current=!1,a(!0))},[o,L]),q=v.useCallback((Y,re)=>{if(!C.current)return;const te=L(Y,re);if(!te)return;const Z=te.x-vf,de=te.y-Sf,E=Math.atan2(de,Z)*(180/Math.PI)-R.current+w.current;k.current=E,m.current=!0,l(E)},[L]),ee=v.useCallback(()=>{if(!C.current||(C.current=!1,a(!1),m.current&&(M.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{M.current=!1},100)),!m.current))return;const Y=k.current;let re=Y%360;re<0&&(re+=360);let te=mf[0],Z=1/0;for(const ve of mf){const ie=Math.min(Math.abs(re-ve),Math.abs(re-ve+360),Math.abs(re-ve-360));ie<Z&&(Z=ie,te=ve)}const de=Math.floor(Y/360)*360,we=[de+te-360,de+te,de+te+360];let E=we[0],B=Math.abs(Y-we[0]);for(const ve of we){const ie=Math.abs(Y-ve);ie<B&&(B=ie,E=ve)}k.current=E,l(E)},[]);v.useEffect(()=>{if(!c)return;const Y=de=>{q(de.clientX,de.clientY)},re=()=>{ee()},te=de=>{de.touches.length>0&&q(de.touches[0].clientX,de.touches[0].clientY)},Z=()=>{ee()};return window.addEventListener("mousemove",Y),window.addEventListener("mouseup",re),window.addEventListener("touchmove",te),window.addEventListener("touchend",Z),()=>{window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",re),window.removeEventListener("touchmove",te),window.removeEventListener("touchend",Z)}},[c,q,ee]);const N=v.useCallback(()=>{if(s.targetCorner===null)return!1;const Y=Ig[s.targetCorner],re=(o%360+360)%360,te=Math.abs(re-Y);return Math.min(te,360-te)<15},[s.targetCorner,o]),Q=v.useCallback(()=>{f(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>f(!1),300)},[]),ae=v.useCallback(()=>{if(!(!I()||s.solved)&&!c&&!M.current)if(p(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>p(!1),150),N()){const Y=s.completedCorners+1;if(Y>=(t?3:4)){r(Z=>({...Z,solved:!0,targetCorner:null,completedCorners:4}));const te=e.find(Z=>Z.type===Ae.CONTROLS);te&&n&&n(te.id)}else{const te=[0,1,2,3].filter(de=>de!==s.targetCorner),Z=te[Math.floor(Math.random()*te.length)];r(de=>({...de,targetCorner:Z,completedCorners:Y}))}}else Q()},[I,s.solved,s.completedCorners,s.targetCorner,c,N,t,e,n,Q]),W=v.useCallback(Y=>!I()||s.solved?Al:s.targetCorner===Y?zg:Al,[I,s.solved,s.targetCorner]),K=v.useCallback(()=>I()?{text:"REPAIR CONTROLS",color:Fg}:y?{text:"CONTROLS FIXED",color:Bg}:{text:"REPAIR CONTROLS",color:$g},[I,y]);return{localDialRotation:o,isDialDragging:c,dialShaking:u,dialPressed:d,handleDialStart:H,handleDialMove:q,handleDialEnd:ee,handleDialPress:ae,getControlsCornerLightColor:W,getControlsTextState:K,recentlyFixed:y,isDialAligned:N,isComplicationActive:I()&&!s.solved}}const Oo=({x:e,y:t,rotation:n=0,length:s=176,width:r=50,handleSize:o=50,value:l=0,onChange:c,trackColor:a="#eebfc5",handleColor:u="#d36b28",arrowColor:f="#ffffff",className:d=""})=>{const[p,y]=v.useState(!1),[S,P]=v.useState(0),j=v.useRef(null),g=v.useRef(0),h=(s-o)/2,x={"-1":-h,0:0,1:h},C=p?S:x[`${l}`]||0,R=m=>{m.stopPropagation(),m.currentTarget.setPointerCapture(m.pointerId),j.current={x:m.clientX,y:m.clientY},g.current=C,P(C),y(!0)},w=m=>{if(!p||!j.current)return;m.stopPropagation();const M=m.clientX-j.current.x,I=m.clientY-j.current.y,L=n*Math.PI/180,H=M*Math.cos(L)+I*Math.sin(L),q=g.current+H,ee=Math.max(-h,Math.min(h,q));P(ee)},k=m=>{if(!p)return;m.stopPropagation(),m.currentTarget.releasePointerCapture(m.pointerId),y(!1);const M=Math.abs(S-x[-1]),I=Math.abs(S-x[0]),L=Math.abs(S-x[1]);let H=0;M<I&&M<L?H=-1:L<I&&L<M?H=1:H=0,c&&H!==l&&c(H)};return i.jsx("g",{transform:`translate(${e}, ${t}) rotate(${n})`,children:i.jsxs("g",{className:d,children:[i.jsx("rect",{x:-s/2,y:-r/2,width:s,height:r,rx:6.92,ry:6.92,fill:a}),i.jsx("g",{transform:`translate(${C}, 0)`,style:{transition:p?"none":"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:i.jsx("rect",{x:-o/2,y:-o/2,width:o,height:o,rx:3.69,ry:3.69,fill:u})}),i.jsx("rect",{x:-s/2-20,y:-r/2-20,width:s+40,height:r+40,fill:"transparent",style:{cursor:"grab",touchAction:"none"},onPointerDown:R,onPointerMove:w,onPointerUp:k,onPointerLeave:k})]})})},Wg=({laserSliders:e,shakingSlider:t,onSliderChange:n,getLaserLightColors:s,textState:r,isComplicationActive:o=!1})=>i.jsxs("g",{id:"Reset_Laser_Top",children:[i.jsxs("g",{pointerEvents:"none",children:[i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M157.91,233.16h-4.24l-18.69-18.69c-3.62-3.62-3.62-9.52,0-13.14l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0-8.89l20.81,20.81ZM111.51,212.35c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-1.75,1.75-2.72,4.09-2.72,6.57s.97,4.81,2.72,6.57l18.69,18.69h4.24l-20.81-20.81ZM107.64,182.65h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM235.4,214.47c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,233.16h4.24l18.69-18.69c1.75-1.75,2.72-4.09,2.72-6.57s-.97-4.81-2.72-6.57l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM260.08,214.47c.17-.17.33-.36.49-.54v-12.05c-.16-.19-.32-.37-.49-.54l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"}),i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M132.32,324.04h-4.24l-18.69-18.69c-1.75-1.75-2.72-4.09-2.72-6.57s.97-4.81,2.72-6.57l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0,8.89l20.81,20.81ZM137.1,303.23c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-3.62,3.62-3.62-9.52,0,13.14l18.69,18.69h4.24l-20.81-20.81ZM107.64,273.53h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM260.08,305.35c.18-.18.34-.36.49-.55v-12.04c-.16-.19-.32-.37-.49-.55l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,324.04h4.24l18.69-18.69c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c1.19,1.19,1.84,2.77,1.84,4.45s-.65,3.26-1.84,4.45l-20.81,20.81ZM235.4,305.35c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"})]}),i.jsx(Oo,{x:172.65,y:207.9,value:e[0],onChange:l=>n(0,l),className:t===0?"shake-anim":""}),i.jsx(Oo,{x:172.65,y:298.78,value:e[1],onChange:l=>n(1,l),className:t===1?"shake-anim":""}),i.jsx(Oo,{x:445.24,y:207.9,value:e[2],onChange:l=>n(2,l),className:t===2?"shake-anim":""}),i.jsx(Oo,{x:445.24,y:298.78,value:e[3],onChange:l=>n(3,l),className:t===3?"shake-anim":""}),i.jsxs("g",{children:[i.jsx("path",{fill:s(0).right,fillRule:"evenodd",d:"M280.92,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(0).left,fillRule:"evenodd",d:"M63.6,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(1).right,fillRule:"evenodd",d:"M280.92,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(1).left,fillRule:"evenodd",d:"M63.6,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(2).left,fillRule:"evenodd",d:"M336.96,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(2).right,fillRule:"evenodd",d:"M554.28,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(3).left,fillRule:"evenodd",d:"M336.96,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(3).right,fillRule:"evenodd",d:"M554.28,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsx("text",{fill:r.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(245.29 261.57)",children:r.text})]}),_l=({x:e,y:t,colorBody:n,colorTop:s,isPressed:r,onPress:o,onRelease:l})=>{const c="M42.31,73.62C18.58,73.62,0,59.79,0,42.13S18.58,10.65,42.31,10.65s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",a="M74.5,41.03c0,11.84-14.45,21.44-32.27,21.44S9.97,52.87,9.97,41.03c0-8.74.25-20.68.25-20.68h64.43s-.15,13.21-.15,20.68Z",f="M42.31,62.97C18.58,62.97,0,49.14,0,31.48S18.58,0,42.31,0s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",d="M74.5,30.38c0,11.84-14.45,21.44-32.27,21.44S9.97,42.22,9.97,30.38c0-8.74.25-8.47.25-8.47h64.43s-.15.99-.15,8.47Z";return i.jsx("g",{transform:`translate(${e}, ${t})`,style:{cursor:"pointer"},onMouseDown:S=>{S.stopPropagation(),o()},onMouseUp:S=>{S.stopPropagation(),l()},onMouseLeave:()=>{r&&l()},onTouchStart:S=>{S.stopPropagation(),o()},onTouchEnd:S=>{S.stopPropagation(),l()},children:r?i.jsxs("g",{transform:`translate(0, ${10.65})`,children:[i.jsx("path",{fill:"#0d1a19",d:f}),i.jsx("path",{fill:n,fillRule:"evenodd",d}),i.jsx("ellipse",{fill:s,cx:"42.31",cy:23.01,rx:"32.27",ry:"21.44"})]}):i.jsxs("g",{children:[i.jsx("path",{fill:"#0d1a19",d:c}),i.jsx("path",{fill:n,fillRule:"evenodd",d:a}),i.jsx("ellipse",{fill:s,cx:"42.31",cy:21.44,rx:"32.27",ry:"21.44"})]})})},Ug=({lightsComplication:e,lightSlider:t,onSliderChange:n,onButtonPress:s,onButtonRelease:r,getLightsButtonLightColor:o,getLightsSliderLightColors:l,textState:c,pressedBtn:a,sliderShaking:u,onBlueClick:f,onGreenClick:d,onPurpleClick:p,isComplicationActive:y=!1,recentlyFixed:S=!1})=>{const P=l(),j=e.phase==="slider1"||e.phase==="showing";return i.jsxs("g",{id:"Reset_Lights",children:[i.jsx("polygon",{fill:"#45486c",points:"608.7 1720.12 341.17 1720.12 341.17 1452.22 564.14 1452.22 608.7 1720.12",className:y?"minigame-active-pulse":S?"minigame-solved-fade":""}),i.jsx("text",{fill:c.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(414.68 1480.38)",children:c.text}),i.jsx("g",{clipPath:"url(#reset-lights-slider-clip)",children:i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M417.83,1530.35l-30.21-30.21c-3.04-3.04-7.97-3.04-11.02,0l-30.21,30.21M346.4,1555.03l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M346.4,1580.62l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M417.83,1643.18l-30.21,30.21c-3.04,3.04-7.97,3.04-11.02,0l-30.21-30.21M346.4,1618.5l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21M346.4,1592.91l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21"})}),i.jsx(Oo,{x:382.11,y:1587.01,rotation:90,value:t,onChange:n,className:u?"shake":""}),i.jsxs("g",{children:[i.jsx("path",{fill:P.bottom,d:"M382.12,1706.83c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M382.12,1685.25c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1682.25c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:P.top,d:"M382.12,1489.51c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M382.12,1467.94c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1464.94c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsx(_l,{x:431.19,y:1495,colorBody:"#3d8380",colorTop:"#96d7dd",isPressed:a==="blue"||j,onPress:()=>s("blue"),onRelease:()=>r("blue",f)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(0),d:"M546.19,1547c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M546.19,1525.42c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M546.19,1522.42c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsx(_l,{x:437.5,y:1565,colorBody:"#4c833c",colorTop:"#f6f081",isPressed:a==="green"||j,onPress:()=>s("green"),onRelease:()=>r("green",d)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(1),d:"M554.61,1616.4c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M554.61,1594.82c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M554.61,1591.82c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsx(_l,{x:444.51,y:1635,colorBody:"#803d83",colorTop:"#cb8abc",isPressed:a==="purple"||j,onPress:()=>s("purple"),onRelease:()=>r("purple",p)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(2),d:"M565.12,1689.3c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M565.12,1667.73c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.04h0M565.12,1664.73c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]})]})},Cf=194.32,kf=1586.66,Xg=({localDialRotation:e,isDialDragging:t,dialShaking:n,dialPressed:s,onDialStart:r,onDialPress:o,getControlsCornerLightColor:l,textState:c,isDialAligned:a,isComplicationActive:u,recentlyFixed:f=!1})=>i.jsxs("g",{id:"Reset_Controls",children:[i.jsx("path",{fill:"#45486c",d:"M290.21,1663.73c10.78-17.3,17.01-37.73,17.01-59.61,0-23.97-7.48-46.2-20.22-64.48,7.77-.06,15.53-3.05,21.46-8.98,11.98-11.98,11.98-31.4,0-43.37-1.9-1.9-3.99-3.5-6.21-4.8-.5-17.51-14.85-31.56-32.48-31.56H121.34c-17.78,0-32.22,14.28-32.49,32-1.95,1.22-3.81,2.66-5.5,4.36-11.98,11.98-11.98,31.4,0,43.37,5.16,5.16,11.69,8.09,18.42,8.8-12.82,18.31-20.34,40.6-20.34,64.65,0,22.08,6.34,42.67,17.3,60.07-5.63,1.18-11,3.95-15.38,8.32-11.98,11.98-11.98,31.4,0,43.37,11.98,11.98,31.4,11.98,43.37,0,4.44-4.44,7.23-9.91,8.38-15.64,17.22,10.63,37.5,16.77,59.22,16.77,22.93,0,44.26-6.84,62.07-18.59.88,6.39,3.78,12.55,8.69,17.46,11.98,11.98,31.4,11.98,43.37,0,11.98-11.98,11.98-31.4,0-43.37-5.11-5.11-11.58-8.03-18.24-8.78Z",className:u?"minigame-active-pulse":f?"minigame-solved-fade":""}),i.jsx("circle",{fill:"#0d1a19",cx:"194.32",cy:"1604.12",r:"97.6",opacity:"0.3"}),i.jsxs("g",{children:[i.jsx("path",{fill:l(1),d:"M103.94,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M103.94,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(0),d:"M288.3,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M288.3,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(2),d:"M103.94,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M103.94,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(3),d:"M288.3,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.53,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M288.3,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsx("text",{fill:c.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(108.17 1480.38)",children:c.text}),i.jsx("g",{transform:`translate(0 ${s?4:0}) rotate(${Math.round(e)} ${Cf} ${kf})`,style:{cursor:t?"grabbing":"grab"},onMouseDown:d=>r(d.clientX,d.clientY),onTouchStart:d=>{d.touches.length>0&&r(d.touches[0].clientX,d.touches[0].clientY)},onClick:o,children:i.jsxs("g",{className:n?"shake":"",children:[i.jsx("circle",{fill:"#d36b28",cx:"194.32",cy:"1586.66",r:"86.84"}),i.jsx("path",{fill:"none",stroke:"#fff",strokeWidth:"6",strokeMiterlimit:"10",d:"M238.98,1629.6c-11.27,11.72-27.11,19.01-44.65,19.01s-32.11-6.72-43.27-17.62"}),i.jsx("g",{transform:"translate(170.65 1623.1) rotate(135) scale(1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),i.jsx("g",{transform:"translate(219.09 1623.1) rotate(45) scale(1.74 -1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),i.jsx("path",{fill:"#fff",d:"M169.51,1524.47l20.43-20.43c1.99-1.99,5.23-1.99,7.22,0l20.43,20.43c3.22,3.22.94,8.72-3.61,8.72h-40.86c-4.55,0-6.83-5.5-3.61-8.72Z"})]})}),u&&a&&i.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"24",fontWeight:"bold",textAnchor:"middle",x:Cf,y:kf+8,style:{pointerEvents:"none"},children:"PRESS"})]}),Vg=194.32,qg=1586.66,Zg=({dialRotation:e,monitorOffset:t,periscopeY:n,dragHandlers:s,monitorDragHandlers:r,isMonitorDragging:o,isPeriscopeDragging:l=!1,isSnapping:c=!1,onDialClick:a,onBlueClick:u,onGreenClick:f,onPurpleClick:d,onUpgradesClick:p,onSettingsClick:y,onHelpClick:S,onSetRank:P,onAbortClick:j,upgradeCount:g,screenContent:h,isGameOver:x=!1,isSessionActive:C=!1,rank:R,currentXP:w,nextRankXP:k,shiftScore:m=0,gameStats:M={startTime:0,totalBonusTime:0,maxGroupSize:0,penalty:0},goalsCleared:I=0,goalsTarget:L=0,unspentPower:H=0,maxTime:q=75e3,complications:ee=[],onResolveComplication:N,upgradeLevels:Q={}})=>{const ae=(Q.CAPACITOR_EFFICIENCY||0)>=En.CAPACITOR_EFFICIENCY.maxLevel,W=(Q.CIRCUIT_STABILIZER||0)>=En.CIRCUIT_STABILIZER.maxLevel,K=(Q.GEAR_LUBRICATION||0)>=En.GEAR_LUBRICATION.maxLevel,[Y,re]=v.useState(null),[te,Z]=v.useState(!1),[de,we]=v.useState(!1),{laserSliders:E,updateLaserSlider:B,shakingSlider:ve,getLaserLightColors:ie,getLaserTextState:ye,recentlyFixed:se,isComplicationActive:ge}=_g({complications:ee,isLaserMaxed:ae,onResolveComplication:N}),{lightsComplication:oe,lightSlider:ke,handleLightsButton:he,handleLightsSliderChange:Ee,lightsSliderShaking:Ge,getLightsButtonLightColor:$e,getLightsSliderLightColors:Fe,getLightsTextState:Ne,recentlyFixed:Ie,isComplicationActive:O}=Dg({complications:ee,isLightsMaxed:W,pressedBtn:Y,onResolveComplication:N}),{localDialRotation:G,isDialDragging:Ce,dialShaking:D,dialPressed:F,handleDialStart:T,handleDialMove:$,handleDialEnd:V,handleDialPress:U,getControlsCornerLightColor:le,getControlsTextState:b,recentlyFixed:_,isDialAligned:A,isComplicationActive:z}=Hg({complications:ee,isControlsMaxed:K,onResolveComplication:N});v.useEffect(()=>{if(!Ce)return;const Be=Ht=>{$(Ht.clientX,Ht.clientY)},Xe=()=>{V()},kt=Ht=>{Ht.touches.length>0&&$(Ht.touches[0].clientX,Ht.touches[0].clientY)},Wn=()=>{V()};return window.addEventListener("mousemove",Be),window.addEventListener("mouseup",Xe),window.addEventListener("touchmove",kt),window.addEventListener("touchend",Wn),()=>{window.removeEventListener("mousemove",Be),window.removeEventListener("mouseup",Xe),window.removeEventListener("touchmove",kt),window.removeEventListener("touchend",Wn)}},[Ce]),v.useEffect(()=>{C||we(!1)},[C]);const X=Be=>{re(Be)},J=(Be,Xe)=>{Y===Be?(re(null),Be==="blue"?he(0):Be==="green"?he(1):Be==="purple"&&he(2),Xe&&Xe()):re(null)},ne=Be=>{Be.stopPropagation(),Z(Xe=>!Xe)},ue=Be=>{P&&P(Be),Z(!1)},pe=Be=>{Be.stopPropagation(),de?(j&&j(),we(!1)):(we(!0),setTimeout(()=>we(!1),3e3))},Te={transition:o?"none":"transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},je={transition:o?"none":"opacity 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},De=363.9*Math.min(1,Math.max(0,w/k)),Pe=Math.min(1,Math.max(0,(t+400)/920)),_e=Math.min(1,Math.max(0,n/300)),We=Math.max(Pe,_e)*.85,ce="translate(31.92, 399.44)";return i.jsxs("svg",{viewBox:"0 827.84 648 1152",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{overflow:"hidden"},onClick:()=>{te&&Z(!1)},children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:"console-gradient",x1:"324",y1:"1979.84",x2:"324",y2:"827.84",gradientUnits:"userSpaceOnUse",children:[i.jsx("stop",{offset:"0",stopColor:"#363b5e"}),i.jsx("stop",{offset:"1",stopColor:"#0b1c3f"})]}),i.jsx("clipPath",{id:"reset-lights-slider-clip",children:i.jsx("rect",{x:"356.86",y:"1499.08",width:"50.51",height:"175.86",rx:"6.92",ry:"6.92"})})]}),i.jsxs("g",{id:"Console_Base",children:[i.jsx("polygon",{fill:"#0f1829",points:"42.37 1807.1 54.73 1865.36 592.78 1865.36 605.14 1807.1 42.37 1807.1"}),i.jsx("path",{fill:"#616a79",d:"M615.77,1807.1l14.87-84.85c.65-3.69-2.19-7.08-5.94-7.08H22.81c-3.75,0-6.59,3.38-5.94,7.08l14.87,84.85h584.04Z"}),i.jsx("path",{fill:"#59acae",d:"M583.65,1441.46H63.86l-47.08,283.09c-.6,3.61,2,6.92,5.44,6.92h603.07c3.44,0,6.04-3.31,5.44-6.92l-47.08-283.09Z"}),i.jsxs("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",transform:"translate(55 1855.15)",children:[i.jsx("tspan",{letterSpacing:"-0.04em",children:"V"}),i.jsxs("tspan",{x:"9.49",children:["ersion 1.1.13.",229]})]}),i.jsx("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",textAnchor:"end",transform:"translate(592.5 1855.15)",children:"MuzzyMade @ 2026"}),i.jsx("g",{id:"RankSelector",className:x?"pointer-events-none":"cursor-pointer hover:brightness-125 active:brightness-90 transition-all origin-center",onClick:x?void 0:ne,children:i.jsx("text",{fill:te?"#5bbc70":"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:te?"bold":"normal",textAnchor:"middle",transform:"translate(323.75 1855.99)",children:"RANK SELECT"})})]}),i.jsxs("g",{transform:"translate(17.28, 1057.14)",children:[i.jsx("path",{fill:"#616a79",fillRule:"evenodd",d:"M597.13,32.56H15.82C6.56,32.56-.51,40.11.03,49.42l18.54,321.98c.39,6.78,5.81,12.28,12.11,12.28h551.59c6.3,0,11.72-5.5,12.11-12.28l18.54-321.98c.54-9.31-6.53-16.86-15.79-16.86Z"}),i.jsx("path",{fill:"#aad9d9",fillRule:"evenodd",d:"M604.74,37.21H8.21c-3.37,0-5.34-4.05-3.17-6.52L23.09,10.16C28.83,3.68,37.14,0,46.03,0h520.89c8.89,0,17.2,3.68,22.94,10.16l18.06,20.52c2.17,2.47.19,6.52-3.17,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M536.44,362.92H76.51c-21.64,0-40.25-18.8-41.48-41.9l-11.76-220.89c-.6-11.35,3.24-22,10.81-29.99,7.45-7.85,17.63-12.18,28.67-12.18h487.46c11.04,0,21.22,4.33,28.67,12.18,7.58,7.99,11.41,18.64,10.81,29.99l-11.76,220.89c-1.23,23.1-19.84,41.9-41.48,41.9ZM62.75,62.96c-9.65,0-18.55,3.77-25.04,10.62-6.62,6.98-9.98,16.32-9.45,26.28l11.76,220.89c1.09,20.49,17.46,37.17,36.49,37.17h459.93c19.03,0,35.4-16.67,36.49-37.17l11.76-220.89c.53-9.96-2.82-19.3-9.45-26.28-6.49-6.85-15.39-10.62-25.04-10.62H62.75Z"}),i.jsx("path",{fill:"#35385b",fillRule:"evenodd",d:"M550.2,60.46H62.75c-21.59,0-38.15,17.7-36.98,39.53l11.76,220.89c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.76-220.89c1.16-21.83-15.4-39.53-36.98-39.53Z"}),i.jsx("path",{fill:"#474871",fillRule:"evenodd",d:"M549.56,74.42H63.39c-21.53,0-38.04,17.7-36.88,39.53l11.02,206.94c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.02-206.94c1.16-21.83-15.35-39.53-36.88-39.53Z",className:ge?"minigame-active-pulse-laser":se?"minigame-solved-fade-laser":""}),i.jsxs("g",{id:"Operator_Rank_-_meter",children:[i.jsx("path",{fill:"#5bbc70",d:"M540.77,147.84H74.51c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM74.51,128.07c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H74.51Z"}),i.jsx("path",{fill:"#5bbc70",d:`M74.51,127.57h${De}c.66,0,1.2.54,1.2,1.2v17.36c0,.66-.54,1.2-1.2,1.2H74.51c-5.45,0-9.88-4.43-9.88-9.88h0c0-5.45,4.43-9.88,9.88-9.88Z`}),i.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(545 142)",children:[Math.floor(w).toLocaleString()," / ",Math.floor(k).toLocaleString()]}),i.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(545 118)",children:"PROMOTION THRESHOLD"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(239.35 115.28)",children:R}),i.jsxs("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(65.42 113.79)",children:[i.jsx("tspan",{x:"0",y:"0",children:"OPE"}),i.jsx("tspan",{letterSpacing:".02em",x:"40.54",y:"0",children:"R"}),i.jsx("tspan",{letterSpacing:"-.05em",x:"53.68",y:"0",children:"A"}),i.jsx("tspan",{letterSpacing:"-.03em",x:"66.07",y:"0",children:"T"}),i.jsx("tspan",{x:"77.45",y:"0",children:"OR "}),i.jsx("tspan",{letterSpacing:".02em",x:"112.01",y:"0",children:"R"}),i.jsx("tspan",{x:"125.16",y:"0",children:"ANK"})]})]}),i.jsx(Wg,{laserSliders:E,shakingSlider:ve,onSliderChange:B,getLaserLightColors:ie,textState:ye(),isComplicationActive:ge,recentlyFixed:se})]}),i.jsx(Ug,{lightsComplication:oe,lightSlider:ke,onSliderChange:Ee,onButtonPress:X,onButtonRelease:J,getLightsButtonLightColor:$e,getLightsSliderLightColors:Fe,textState:Ne(),pressedBtn:Y,sliderShaking:Ge,onBlueClick:u,onGreenClick:f,onPurpleClick:d,isComplicationActive:O,recentlyFixed:Ie}),i.jsx(Xg,{localDialRotation:G,isDialDragging:Ce,dialShaking:D,dialPressed:F,onDialStart:T,onDialPress:U,getControlsCornerLightColor:le,textState:b(),isDialAligned:A(),isComplicationActive:z,recentlyFixed:_}),i.jsx("circle",{id:"coord-reference",cx:Vg,cy:qg,r:"1",fill:"transparent",style:{pointerEvents:"none"}}),(C||R>0)&&i.jsx("g",{id:"System_Upgrades",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:C?pe:p,children:C?i.jsxs(i.Fragment,{children:[i.jsx("rect",{fill:"#ef4444",x:"123.18",y:"1748.67",width:"342.8",height:"44.19",rx:"12.37",ry:"12.37"}),i.jsx("rect",{fill:"none",stroke:"#ef4444",strokeMiterlimit:"10",x:"123.45",y:"1748.67",width:"420.29",height:"44.19",rx:"9.43",ry:"9.43"}),i.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"294.58",y:"1778.17",children:de?"ARE YOU SURE?":"END SHIFT EARLY"}),i.jsx("text",{fill:"#ef4444",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",transform:"translate(492.79 1783.33)",children:"X"})]}):i.jsxs(i.Fragment,{children:[i.jsx("rect",{fill:"#ffd92b",x:"205",y:"1748.67",width:"160",height:"44.19",rx:"12.37",ry:"12.37"}),i.jsx("rect",{fill:"none",stroke:"#ffd92b",strokeMiterlimit:"10",x:"205",y:"1748.67",width:"238",height:"44.19",rx:"9.43",ry:"9.43"}),i.jsx("text",{fill:"#45486c",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"285",y:"1778.17",children:"UPGRADES"}),i.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",textAnchor:"middle",x:"404",y:"1783.33",children:g})]})}),i.jsxs("text",{fill:"#5bbc70",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(210.86 1947.47)",children:[i.jsx("tspan",{letterSpacing:".01em",children:"G"}),i.jsx("tspan",{x:"50.77",children:"O"}),i.jsx("tspan",{letterSpacing:".01em",x:"94.43",children:"O"}),i.jsx("tspan",{letterSpacing:".03em",x:"138.94",children:"P"}),i.jsx("tspan",{x:"182.79",children:"S"})]}),i.jsxs("g",{id:"How_to_Play",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:S,children:[i.jsx("circle",{fill:"#5bbc70",cx:"60.02",cy:"1920.16",r:"42.65"}),i.jsx("text",{fill:"#0f1528",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(43.23 1951.29)",children:"?"})]}),i.jsxs("g",{id:"Settings",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:y,children:[i.jsx("circle",{fill:"#5bbc70",cx:"586.51",cy:"1921.29",r:"42.65"}),i.jsx("path",{fill:"#0f1528",d:"M575.34,1888.9c1.31-.22,2.74.1,3.77.94.53.43.76,1.11,1.28,1.57,3.07,2.69,6.81,3.17,10.41,1.27,2.93-1.54,3.23-4.63,7.35-3.65,2.47.59,8.3,3.99,10.15,5.79,3.3,3.22.52,5.23.71,8.67.17,3.07,2.34,6.18,5.12,7.42,2.12.95,4.78.73,5.84,3.27s.95,10.11.24,12.77c-1.23,4.62-4.11,3.02-7.31,4.93-2.36,1.42-4.2,4.72-4.2,7.5s1.94,4.09.64,6.88c-1.06,2.28-8.15,6.41-10.64,7.02-3.9.96-4.47-2.07-6.97-3.74-2.65-1.77-6.22-1.75-9.02-.28-3.07,1.61-3.15,5.19-7.61,4.38-2.27-.42-8.91-4.29-10.53-5.98-2.69-2.79-.66-4.28-.3-6.87.55-3.94-1.21-8.15-4.99-9.77-2.48-1.06-5.42-.37-6.52-3.73-.83-2.52-.68-11.58.66-13.88,1.2-2.06,3.02-1.68,4.85-2.27,4.19-1.36,6.81-5.14,6.29-9.6-.29-2.49-1.96-4.37.32-6.86,1.42-1.56,8.41-5.43,10.46-5.77ZM586.19,1909.97c-14.67.42-14.14,22.83.44,22.69,14.84-.14,14.53-23.12-.44-22.69Z"})]}),i.jsx("rect",{x:"0",y:"827.84",width:"648",height:"1152",fill:"#000",style:{opacity:We,...je,pointerEvents:"none"}}),i.jsxs("g",{id:"Periscope",transform:`translate(0, ${n})`,style:{transition:l||c?"none":"transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"grab"},...s,children:[i.jsx("rect",{fill:"#087962",x:"22.36",y:"978.45",width:"603.66",height:"51.13",rx:"11.03",ry:"11.03"}),i.jsx("path",{fill:"#087962",d:"M 390.17 -1000 V 1111.98 c 0 13.74 -11.16 24.9 -24.9 24.9 h -88.54 c -13.74 0 -24.9 -11.16 -24.9 -24.9 V -1000 H 390.17 Z"}),i.jsxs("g",{children:[i.jsx("path",{fill:"#5bbc70",fillRule:"evenodd",d:"M252.54,1089.77c-23.25,0-45.07-9.09-61.45-25.59-16.38-16.5-25.3-38.39-25.13-61.64.35-47.38,39.59-85.92,87.47-85.92h138.58c23.99,0,46.29,9.59,62.81,26.99,16.51,17.4,24.9,40.21,23.64,64.23-2.4,45.72-40.19,81.7-86.02,81.93h-.44c-24.04,0-47.19-10.12-63.53-27.77-2.19-2.36-4.86-2.71-6.27-2.71s-3.96.34-6.05,2.61c-16.35,17.72-39.54,27.87-63.63,27.87Z"}),i.jsx("path",{fill:"#0b1c3f",fillRule:"evenodd",d:"M392.01,931.91h-138.58c-39.31,0-71.89,31.44-72.18,70.75-.29,39.62,31.74,71.83,71.29,71.83,20.72,0,39.37-8.84,52.39-22.95,9.32-10.1,25.43-10,34.77.09,13.09,14.14,31.85,22.97,52.67,22.87,37.55-.18,68.86-29.95,70.83-67.44,2.16-41.12-30.54-75.13-71.19-75.13Z"}),i.jsx("path",{fill:"#373a60",fillRule:"evenodd",d:"M392.02,1054.51c-14.46,0-27.83-5.85-37.66-16.46-8.25-8.91-19.96-14.02-32.14-14.02s-23.79,5.09-31.97,13.96c-9.83,10.66-23.23,16.53-37.71,16.53s-26.71-5.39-36.42-15.17c-9.71-9.78-15-22.76-14.89-36.54.21-28.08,23.63-50.92,52.21-50.92h138.58c14.22,0,27.44,5.68,37.23,16,9.78,10.31,14.76,23.84,14.01,38.11-1.42,27.07-23.82,48.38-50.98,48.52h-.26Z"})]}),i.jsx("g",{transform:"translate(303.67 1091.18) scale(1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})})]}),i.jsx("g",{transform:`translate(0, ${t})`,style:{...Te,cursor:x?"grab":"default",pointerEvents:x?"auto":"none",touchAction:x?"none":"auto"},...x&&o!==void 0?r:{},children:x?i.jsx("g",{transform:ce,children:i.jsx(Mg,{shiftScore:m,rank:R,xpCurrent:w,xpNext:k,cracksFilled:I,cracksTarget:L,pressureVented:M.totalBonusTime||0,maxTime:q,massPurged:M.maxGroupSize||0,leftoverPenalty:M.penalty||0,unspentPower:H,isWin:I>=L})}):i.jsxs(i.Fragment,{children:[i.jsx("path",{fill:"#f2a743",d:"M48.78,432h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H44.2c-6.78,0-12.28-5.5-12.28-12.28V448.86c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M606.65,436.65H40.86c-3.39,0-5.14-4.05-2.82-6.52l19.25-20.52c6.08-6.49,14.58-10.16,23.47-10.16h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"none",stroke:"#1d1d3a",strokeWidth:"5",strokeMiterlimit:"10",d:"M592.34,1246.25c0,21.83-17.7,39.53-39.53,39.53H94.71c-21.83,0-39.53-17.7-39.53-39.53V499.44c0-21.83,17.7-39.53,39.53-39.53h458.1c21.83,0,39.53,17.7,39.53,39.53v746.81Z"}),i.jsx("rect",{fill:"#1f1f38",x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("foreignObject",{x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53",children:i.jsx("div",{className:"w-full h-full overflow-hidden rounded-[39px]",children:h})}),i.jsx("g",{pointerEvents:"none",children:i.jsx("path",{fill:"none",stroke:"#5bbc70",strokeWidth:"1",strokeOpacity:"0.2",d:"M94.71,474.42h458.1c21.82,0,39.53,17.71,39.53,39.53v732.85c0,21.82-17.71,39.53-39.53,39.53H94.71c-21.82,0-39.53-17.71-39.53-39.53V513.95c0-21.82,17.71-39.53,39.53-39.53Z"})})]})}),te&&!x&&i.jsx("foreignObject",{x:"200",y:"1550",width:"250",height:"300",children:i.jsxs("div",{onClick:Be=>Be.stopPropagation(),style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1d1d3a 0%, #0f1829 100%)",border:"2px solid #5bbc70",borderRadius:"8px",overflow:"hidden"},children:[i.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #5bbc70",color:"#5bbc70",fontFamily:"Amazon Ember, sans-serif",fontWeight:"bold",fontSize:"14px",textAlign:"center"},children:"SELECT RANK"}),i.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px"},children:Array.from({length:51},(Be,Xe)=>i.jsx("div",{onClick:()=>ue(Xe),style:{padding:"8px 12px",color:Xe===0?"#f87171":Xe===R?"#5bbc70":"#aad9d9",fontFamily:"Amazon Ember, sans-serif",fontSize:"14px",cursor:"pointer",borderRadius:"4px",background:Xe===R?"rgba(91, 188, 112, 0.2)":"transparent",fontWeight:Xe===R?"bold":"normal",transition:"background 0.15s"},onMouseEnter:kt=>{Xe!==R&&(kt.currentTarget.style.background="rgba(170, 217, 217, 0.1)")},onMouseLeave:kt=>{Xe!==R&&(kt.currentTarget.style.background="transparent")},children:Xe===0?"0 - WIPE DATA":`Rank ${Xe}`},Xe))})]})})]})},Kg=[{id:"actives",label:"TOOLS",unlockRank:5,color:"#fbbf24"},{id:"features",label:"FEATURES",unlockRank:20,color:"#a78bfa"},{id:"complications",label:"SYSTEMS",unlockRank:2,color:"#f97316"},{id:"passives",label:"UTILITY",unlockRank:3,color:"#5bbc70"}],Qg=(e,t)=>t==="active"?{accent:"#b45309",text:"#fbbf24"}:t==="feature"?{accent:"#7c3aed",text:"#a78bfa"}:e==="CAPACITOR_EFFICIENCY"?{accent:"#d82727",text:"#ff6b6b"}:e==="CIRCUIT_STABILIZER"?{accent:"#d36b28",text:"#ffa94d"}:e==="GEAR_LUBRICATION"?{accent:"#2d5a87",text:"#74c0fc"}:{accent:"#2d7a4d",text:"#5bbc70"},Jg=({scraps:e,upgrades:t,rank:n,onPurchase:s,onRefund:r,onClose:o,equippedActives:l=[],onToggleEquip:c,maxActiveSlots:a=1})=>{var m;const u=Kg.filter(M=>M.unlockRank<=n),[f,d]=v.useState(((m=u[0])==null?void 0:m.id)||"complications"),[p,y]=v.useState(!1),S=v.useRef(0),P=v.useRef(0),j=50,g=(M,I)=>{y(!0),S.current=M,P.current=I},h=(M,I)=>{if(!p)return;y(!1);const L=M-S.current,H=I-P.current;if(Math.abs(L)>Math.abs(H)&&Math.abs(L)>j){const q=u.findIndex(ee=>ee.id===f);L>0&&q<u.length-1?d(u[q+1].id):L<0&&q>0&&d(u[q-1].id)}};v.useEffect(()=>{const M=L=>{p&&h(L.clientX,L.clientY)},I=L=>{p&&L.changedTouches[0]&&h(L.changedTouches[0].clientX,L.changedTouches[0].clientY)};return p&&(window.addEventListener("mouseup",M),window.addEventListener("touchend",I)),()=>{window.removeEventListener("mouseup",M),window.removeEventListener("touchend",I)}},[p,f,u]);const C=(()=>{const M=Object.values(En).filter(I=>I.unlockRank<=n);switch(f){case"actives":return M.filter(I=>I.type==="active").sort((I,L)=>I.unlockRank-L.unlockRank);case"features":return M.filter(I=>I.type==="feature").sort((I,L)=>I.unlockRank-L.unlockRank);case"complications":return M.filter(I=>I.category==="complication").sort((I,L)=>I.unlockRank-L.unlockRank);case"passives":return M.filter(I=>I.type==="passive"&&I.category!=="complication").sort((I,L)=>I.unlockRank-L.unlockRank);default:return[]}})(),R=u.length>0,w=M=>{const I=t[M.id]||0,L=I>=M.maxLevel,q=e>=M.costPerLevel&&!L,ee=I>0,N=Qg(M.id,M.type),Q=M.type==="active",ae=l.includes(M.id);return i.jsxs("div",{className:"rounded-xl p-4 border",style:{backgroundColor:"#0c0f19",borderColor:Q&&ae?"#5bbc70":"#ffffff40"},children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold tracking-wide",style:{color:N.text,fontSize:"18px"},children:M.name}),i.jsx("p",{style:{color:"#59acae",fontSize:"13px"},className:"mt-1",children:M.desc})]}),Q&&I>0&&c&&i.jsx("button",{onClick:()=>c(M.id),disabled:!ae&&l.length>=a,className:"ml-2 px-3 py-1 rounded-lg font-bold text-sm border-2 transition-all",style:{borderColor:ae?"#5bbc70":"#59acae60",color:ae?"#5bbc70":"#59acae",backgroundColor:ae?"#5bbc7020":"transparent",cursor:!ae&&l.length>=a?"not-allowed":"pointer",opacity:!ae&&l.length>=a?.5:1},children:ae?"ON":"OFF"})]}),i.jsxs("div",{className:"flex items-center gap-3 my-3",children:[i.jsx("button",{onClick:()=>ee&&(r==null?void 0:r(M.id)),disabled:!ee,className:"w-8 h-8 rounded-lg font-bold text-xl border-2 transition-all flex items-center justify-center",style:{borderColor:ee?N.accent:"#59acae30",color:ee?N.text:"#59acae40",backgroundColor:ee?N.accent+"20":"transparent",cursor:ee?"pointer":"not-allowed"},children:""}),i.jsx("div",{className:"flex gap-1 flex-1 justify-center",children:Array.from({length:M.maxLevel}).map((W,K)=>i.jsx("div",{className:"h-4 rounded-sm border flex-1 max-w-8",style:{borderColor:K<I?N.accent:"#59acae40",backgroundColor:K<I?N.accent:"transparent"}},K))}),i.jsx("button",{onClick:()=>q&&s(M.id),disabled:!q,className:"w-8 h-8 rounded-lg font-bold text-xl border-2 transition-all flex items-center justify-center",style:{borderColor:q?N.accent:"#59acae30",color:q?N.text:"#59acae40",backgroundColor:q?N.accent+"20":"transparent",cursor:q?"pointer":"not-allowed"},children:"+"}),i.jsxs("span",{className:"font-bold w-12 text-right",style:{color:N.text,fontSize:"16px"},children:[I,"/",M.maxLevel]})]}),i.jsxs("div",{className:"flex justify-between items-start",style:{fontSize:"14px"},children:[i.jsx("div",{style:{color:"#ffffff"},children:Q?i.jsxs(i.Fragment,{children:["Effect: ",M.formatEffect(1)]}):I>0?i.jsxs(i.Fragment,{children:["Current: ",M.formatEffect(I)]}):i.jsx("span",{style:{color:"#59acae"},children:"Current: Spend points to upgrade"})}),L&&M.maxLevelBonus&&i.jsxs("div",{className:"italic text-right ml-2",style:{color:"#5bbc70"},children:["Max: ",M.maxLevelBonus]})]})]},M.id)},k=()=>u.length===0?null:i.jsx("div",{className:"flex w-full mb-3",style:{height:"36px"},children:u.map(M=>{const I=f===M.id;return i.jsx("button",{onClick:()=>d(M.id),className:"font-bold text-center transition-all",style:{width:"25%",backgroundColor:I?M.color+"30":"transparent",color:I?M.color:"#59acae",borderBottom:I?`3px solid ${M.color}`:"3px solid transparent",fontSize:"11px",padding:"8px 4px",fontFamily:"'From Where You Are', sans-serif",letterSpacing:"0.05em"},children:M.label},M.id)})});return i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:i.jsxs("div",{className:"relative",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:[i.jsxs("svg",{viewBox:"0 0 583.67 910",className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[i.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),i.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("text",{fill:"#f2a743",fontFamily:"'From Where You Are'",fontSize:"28",transform:"translate(50 105)",children:"UPGRADES"}),i.jsxs("text",{fill:"#5bbc70",fontFamily:"'Amazon Ember'",transform:"translate(530 105)",textAnchor:"end",children:[i.jsx("tspan",{fontSize:"16",fontWeight:"600",children:"SCRAPS: "}),i.jsx("tspan",{fontSize:"32",fontWeight:"800",children:e})]}),i.jsxs("foreignObject",{x:"40",y:"125",width:"503",height:"720",children:[i.jsx("style",{children:".upgrade-scroll::-webkit-scrollbar { display: none; }"}),i.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"upgrade-scroll w-full h-full overflow-y-auto",style:{fontFamily:"'Amazon Ember', sans-serif",scrollbarWidth:"none",msOverflowStyle:"none"},onMouseDown:M=>g(M.clientX,M.clientY),onTouchStart:M=>g(M.touches[0].clientX,M.touches[0].clientY),children:R?i.jsxs("div",{className:"pb-20",children:[i.jsx("div",{className:"text-lg mb-3 text-center",style:{color:"#fbbf24",fontFamily:"'Amazon Ember', sans-serif"},children:"Earn Scraps by Increasing your Operator Rank"}),k(),i.jsx("div",{className:"space-y-3",children:C.length>0?C.map(w):i.jsx("div",{className:"text-center py-8",style:{color:"#59acae"},children:"No upgrades available in this category yet."})})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[i.jsx("p",{className:"text-2xl tracking-wide mb-3",style:{color:"#6acbda",fontFamily:"'From Where You Are', sans-serif"},children:"NO UPGRADES AVAILABLE"}),i.jsx("p",{style:{color:"#59acae",fontSize:"16px"},children:"Reach Rank 2 to unlock your first upgrade"})]})})]})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:o,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})})]})})},em=({engine:e,state:t,careerScore:n,scraps:s,powerUps:r={},onOpenSettings:o,onOpenHelp:l,onOpenUpgrades:c,onSetRank:a,onPurchaseUpgrade:u,onRefundUpgrade:f,onDismissGameOver:d,equippedActives:p=[],onToggleEquip:y})=>{const S=t.shiftScore>0||t.gameOver;let P;if(S){const se=t.goalsCleared>=t.goalsTarget,{newCareerScore:ge}=ap(e.initialTotalScore,t.shiftScore,se);P=ft(ge)}else P=ft(n);const[j,g]=v.useState(!1),h=v.useRef(null),[x,C]=v.useState(0),[R,w]=v.useState(!1),[k,m]=v.useState(!1),M=v.useRef(0),I=200,L=300,[H,q]=v.useState(0),[ee,N]=v.useState(!1),Q=v.useRef(0),ae=150,[W,K]=v.useState(0);v.useEffect(()=>{if(!t.gameOver){const se=setInterval(()=>{K(ge=>(ge+1)%2)},2e3);return()=>clearInterval(se)}},[t.gameOver]),v.useEffect(()=>{t.phase===Ze.ConsoleScreen&&!t.gameOver&&(C(L),m(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{m(!1),C(0)})}))},[t.phase,t.gameOver]);const Y=se=>{t.gameOver||(w(!0),M.current=se-x)},re=se=>{if(!R)return;const ge=se-M.current,oe=Math.max(0,Math.min(L,ge));C(oe)},te=()=>{R&&(w(!1),x>I?(e.execute(new $s(Ze.TankScreen)),setTimeout(()=>C(0),1e3)):C(0))},Z=se=>{t.gameOver&&(N(!0),Q.current=se-H)},de=se=>{if(!ee)return;const ge=se-Q.current,oe=Math.min(0,ge);q(oe)},we=()=>{ee&&(N(!1),H<-ae&&d&&d(),q(0))};v.useEffect(()=>{const se=he=>{R&&re(he.clientY),ee&&de(he.clientY)},ge=()=>{R&&te(),ee&&we()},oe=he=>{R&&re(he.touches[0].clientY),ee&&de(he.touches[0].clientY)},ke=()=>{R&&te(),ee&&we()};return(R||ee)&&(window.addEventListener("mousemove",se),window.addEventListener("mouseup",ge),window.addEventListener("touchmove",oe),window.addEventListener("touchend",ke)),()=>{window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",ge),window.removeEventListener("touchmove",oe),window.removeEventListener("touchend",ke)}},[R,x,ee,H]);const E=()=>{e.abortRun()},B=e.isSessionActive&&!t.gameOver,ie=(t.gameOver?520:-400)+H,ye=()=>i.jsx("div",{className:"w-full h-full flex flex-col items-center pt-24 font-mono overflow-hidden text-center select-none",children:i.jsx("div",{className:"mt-auto mb-4 flex flex-col items-center",children:B?W===0?i.jsx("div",{className:"text-[#5bbc70] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse",children:"CLEANING..."}):i.jsxs("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are']",children:[Math.floor((1-t.shiftTime/e.maxTime)*100),"% PSI"]}):W===0?i.jsx("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"TO START SHIFT"}):i.jsx("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"PULL DOWN PERISCOPE"})})});return i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{ref:h,className:"relative z-10 select-none flex items-center justify-center",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsx("div",{className:"w-full h-full shadow-2xl relative",children:i.jsx(Zg,{dialRotation:0,monitorOffset:ie,periscopeY:x,dragHandlers:{onMouseDown:se=>Y(se.clientY),onTouchStart:se=>Y(se.touches[0].clientY)},monitorDragHandlers:{onMouseDown:se=>Z(se.clientY),onTouchStart:se=>Z(se.touches[0].clientY)},isMonitorDragging:ee,isPeriscopeDragging:R,isSnapping:k,onSettingsClick:o,onHelpClick:l,onUpgradesClick:()=>g(!0),onSetRank:a,onAbortClick:E,upgradeCount:s,screenContent:t.gameOver?null:i.jsx(ye,{}),isGameOver:t.gameOver,isSessionActive:e.isSessionActive,rank:P.rank,currentXP:P.progress,nextRankXP:P.toNextRank,shiftScore:t.shiftScore,gameStats:t.gameStats,goalsCleared:t.goalsCleared,goalsTarget:t.goalsTarget,unspentPower:s,maxTime:e.maxTime,complications:t.complications,onResolveComplication:se=>e.execute(new Pg(se)),upgradeLevels:r})})}),j&&i.jsx(Jg,{scraps:s,upgrades:r,rank:P.rank,onPurchase:se=>u==null?void 0:u(se),onRefund:se=>f==null?void 0:f(se),onClose:()=>g(!1),equippedActives:p,onToggleEquip:y,maxActiveSlots:1+(r.ACTIVE_EXPANSION_SLOT||0)+(r.ACTIVE_EXPANSION_SLOT_2||0)})]})};function Il(e){return`${e.x},${e.y}`}function wf(e){if(e.length<=1)return!0;const t=new Set(e.map(Il)),n=new Set,s=[e[0]];for(;s.length>0;){const r=s.shift(),o=Il(r);if(n.has(o))continue;n.add(o);const l=[{x:r.x,y:r.y+1},{x:r.x,y:r.y-1},{x:r.x+1,y:r.y},{x:r.x-1,y:r.y}];for(const c of l){const a=Il(c);t.has(a)&&!n.has(a)&&s.push(c)}}return n.size===e.length}function tm(e){const t=e.length;if(t<2)return null;let n=null,s=1/0;for(let r=1;r<(1<<t)-1;r++){const o=[],l=[];for(let f=0;f<t;f++)r&1<<f?o.push(f):l.push(f);const c=o.map(f=>e[f]),a=l.map(f=>e[f]);if(!wf(c)||!wf(a))continue;const u=Math.abs(o.length-l.length);if(u<s&&(s=u,n=[o,l],u===0))break}return n}function jf(e,t,n){const s=tm(e.cells);if(!s)return{...e,color:t};const[r]=s,o=new Set(r),l=e.cells.map((c,a)=>o.has(a)?t:n);return{...e,color:t,cellColors:l}}const Pf=5e3;class nm{trySpawnGoal(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{goal:null,newLastSpawnTime:l};const c=Date.now();if(c-l<=Pf)return{goal:null,newLastSpawnTime:l};const a=ft(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=cf(n,t.goalMarks,a,r,o,u);return f?(u&&t.crackDownRemaining--,mt.playPop(1),{goal:f,newLastSpawnTime:c}):{goal:null,newLastSpawnTime:c}}trySpawnCrack(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{crack:null,newLastSpawnTime:l};const c=Date.now();if(c-l<=Pf)return{crack:null,newLastSpawnTime:l};const a=ft(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=t.crackCells.map(p=>({id:p.id,x:p.x,y:p.y,color:p.color,spawnTime:p.spawnTime})),d=cf(n,f,a,r,o,u);if(d){const p={id:d.id,x:d.x,y:d.y,color:d.color,originCrackId:[],branchCrackIds:[],lastGrowthCheck:c,crackBranchInterval:7e3+Math.random()*5e3,spawnTime:d.spawnTime};return u&&t.crackDownRemaining--,mt.playPop(1),{crack:p,newLastSpawnTime:c}}return{crack:null,newLastSpawnTime:c}}handleGoals(t,n,s,r,o){t.goalMarks=t.goalMarks.filter(c=>!n.includes(c.id));const l=new Set(n);n.forEach(c=>{const a=t.crackCells.find(u=>u.id===c);a&&(a.originCrackId.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.branchCrackIds=f.branchCrackIds.filter(d=>d!==c))}),a.branchCrackIds.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.originCrackId=f.originCrackId.filter(d=>d!==c))}))}),t.crackCells=t.crackCells.filter(c=>!l.has(c.id)),n.forEach(c=>{const a=Ue(r.x),u=Math.floor(r.y),f=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:f,text:"Laser to Seal",x:a,y:u,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(d=>d.id!==f),o()},1e3),me.emit(xe.GOAL_CAPTURED,{count:1})})}handleCrackConsumption(t,n,s,r){if(n.length===0)return;const o=new Set(n);if(n.forEach(l=>{const c=t.crackCells.find(a=>a.id===l);c&&(c.originCrackId.forEach(a=>{const u=t.crackCells.find(f=>f.id===a);u&&(u.branchCrackIds=u.branchCrackIds.filter(f=>f!==l))}),c.branchCrackIds.forEach(a=>{const u=t.crackCells.find(f=>f.id===a);u&&(u.originCrackId=u.originCrackId.filter(f=>f!==l))}))}),t.crackCells=t.crackCells.filter(l=>!o.has(l.id)),t.goalMarks=t.goalMarks.filter(l=>!o.has(l.id)),n.length>0){const l=Ue(s.x),c=Math.floor(s.y),a=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:a,text:n.length>1?`Sealed ${n.length}`:"Sealed",x:l,y:c,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(u=>u.id!==a),r()},1e3),me.emit(xe.GOAL_CAPTURED,{count:n.length})}}countCracks(t){if(t.length===0)return 0;const n=new Set;let s=0;for(const r of t){if(n.has(r.id))continue;const o=[r.id];for(;o.length>0;){const l=o.shift();if(n.has(l))continue;n.add(l);const c=t.find(a=>a.id===l);c&&(c.originCrackId.forEach(a=>{n.has(a)||o.push(a)}),c.branchCrackIds.forEach(a=>{n.has(a)||o.push(a)}))}s++}return s}getConnectedComponent(t,n){const s=new Set,r=[],o=[t];for(;o.length>0;){const l=o.shift();if(s.has(l))continue;s.add(l);const c=n.find(a=>a.id===l);c&&(r.push(c),c.originCrackId.forEach(a=>{s.has(a)||o.push(a)}),c.branchCrackIds.forEach(a=>{s.has(a)||o.push(a)}))}return r}isLeafCell(t,n){const s=n.find(r=>r.id===t);return s?s.branchCrackIds.length===0:!0}}const Hc=new nm,sm=8;class om{tickGrowth(t,n,s,r){var c;if(ft(n).rank<30||t.phase===Ze.ConsoleScreen||t.phase===Ze.COMPLICATION_MINIGAME)return;const l=Date.now();for(const a of t.crackCells){if((c=t.grid[a.y])!=null&&c[a.x]||l-a.lastGrowthCheck<a.crackBranchInterval)continue;a.lastGrowthCheck=l,a.crackBranchInterval=5e3+Math.random()*5e3;const u=Math.max(0,1-t.shiftTime/r),f=Math.min(1,.1+u),p=(s.SLOW_CRACKS||0)*.05;let y=Math.max(0,f-p);a.branchCrackIds.length===0&&(y*=.5);const P=this.getDistanceFromRoot(a,t.crackCells),j=Math.max(.1,1-P*.25);if(y*=j,Math.random()>y)continue;const g=[{x:Ue(a.x+1),y:a.y},{x:Ue(a.x-1),y:a.y},{x:a.x,y:a.y+1},{x:a.x,y:a.y-1},{x:Ue(a.x+1),y:a.y-1},{x:Ue(a.x-1),y:a.y-1},{x:Ue(a.x+1),y:a.y+1},{x:Ue(a.x-1),y:a.y+1}],h=[];for(const C of g){if(C.y<Qe||C.y>=Ye)continue;const R=t.crackCells.find(k=>k.x===C.x&&k.y===C.y&&k.color===a.color);if(R){!a.branchCrackIds.includes(R.id)&&!a.originCrackId.includes(R.id)&&h.push({...C,existingCrack:R});continue}t.crackCells.find(k=>k.x===C.x&&k.y===C.y)||t.grid[C.y][C.x]||h.push(C)}if(h.length===0)continue;const x=h[Math.floor(Math.random()*h.length)];if(x.existingCrack)x.existingCrack.originCrackId.push(a.id),a.branchCrackIds.push(x.existingCrack.id);else{if(Hc.countCracks(t.crackCells)>=sm)continue;const R={id:Math.random().toString(36).substr(2,9),x:x.x,y:x.y,color:a.color,originCrackId:[a.id],branchCrackIds:[],lastGrowthCheck:l,crackBranchInterval:5e3+Math.random()*5e3,spawnTime:l};a.branchCrackIds.push(R.id),t.crackCells.push(R),t.goalMarks.push({id:R.id,x:R.x,y:R.y,color:R.color,spawnTime:R.spawnTime})}}}getDistanceFromRoot(t,n){if(t.originCrackId.length===0)return 0;let s=0,r=t.id;const o=new Set;for(;!o.has(r);){o.add(r);const l=n.find(c=>c.id===r);if(!l||l.originCrackId.length===0||(s++,r=l.originCrackId[0],s>20))break}return s}}const Rf=780,bf=8,Mf=500,rm=80,im=.03;class lm{constructor(t,n={},s=[]){ze(this,"state");ze(this,"listeners",new Set);ze(this,"maxTime",bl);ze(this,"lockStartTime",null);ze(this,"lockResetCount",0);ze(this,"usePhysicsForFalling",!1);ze(this,"freezeTimer",!1);ze(this,"freezeFalling",!1);ze(this,"devOverrideNextGoop",null);ze(this,"lastGoalSpawnTime",0);ze(this,"lastComplicationCheckTime",0);ze(this,"isFastDropping",!1);ze(this,"wasFastDropping",!1);ze(this,"lightsOverflarePhase","none");ze(this,"lightsOverflareTime",0);ze(this,"lightsFlickerTime",0);ze(this,"lightsFlickerActive",!1);ze(this,"lightsGracePausedAt",null);ze(this,"initialTotalScore",0);ze(this,"powerUps",{});ze(this,"isSessionActive",!1);ze(this,"equippedActives",[]);ze(this,"crackManager");ze(this,"pendingTotalScore",null);this.initialTotalScore=t,this.powerUps=n,this.equippedActives=s;const r=ft(t).rank,l=mn(r).length+r;this.state={grid:lf(r,n),tankRotation:0,activeGoop:null,storedGoop:null,nextGoop:null,shiftScore:0,gameOver:!1,isPaused:!1,canSwap:!0,level:1,cellsCleared:0,popStreak:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:bl,scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},gameStats:{startTime:0,totalBonusTime:0,maxGroupSize:0},floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:l,phase:Ze.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ae.LIGHTS]:0,[Ae.CONTROLS]:0,[Ae.LASER]:0},activeCharges:{},crackGoopPopped:0,colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.applyUpgrades(),this.crackManager=new om}randomThreshold(){return Math.floor(Math.random()*13)+12}hasAdjacentWild(t,n){for(const s of n.cells){const r=Ue(n.x+s.x),o=Math.floor(n.y+s.y);if(o<0||o>=Ye)continue;const l=[{x:Ue(r+1),y:o},{x:Ue(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}];for(const c of l)if(c.y>=0&&c.y<Ye){const a=t[c.y][c.x];if(a!=null&&a.isWild)return!0}}return!1}execute(t){t.execute(this)}applyUpgrades(){let t=bl;const n=this.powerUps.PRESSURE_CONTROL||0;if(n>0){const s=n*5*1e3;t+=s}this.maxTime=t,this.state.gameStats.startTime===0&&(this.state.shiftTime=this.maxTime)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emitChange(){this.listeners.forEach(t=>t())}syncTotalScore(t){this.state.gameOver?this.pendingTotalScore=t:(this.initialTotalScore=t,this.pendingTotalScore=null)}startRun(){const t=ft(this.initialTotalScore).rank,n=mn(t),s=n.length+t,r=n[Math.floor(Math.random()*n.length)],o=Math.random()<Ml,l=o?Xo:Uo,c=Math.floor(Math.random()*l.length),a=this.maybeApplyMirror({...l[c]}),u=!o&&t>=20&&Math.random()<.25;let f;if(u){const j=n.filter(x=>x!==r),g=j[Math.floor(Math.random()*j.length)],h={...a,color:r};f=jf(h,r,g)}else f={...a,color:r,isCorrupted:o||void 0};const d=Math.random()<Ml,p=d?Xo:Uo,y=Math.floor(Math.random()*p.length),S=this.maybeApplyMirror({...p[y]});this.state={...this.state,grid:lf(t,this.powerUps),tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...S,color:n[Math.floor(Math.random()*n.length)],isCorrupted:d||void 0},nextGoop:f,canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:this.maxTime,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:s,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:Ze.TankScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ae.LIGHTS]:0,[Ae.CONTROLS]:0,[Ae.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0;const P={};this.equippedActives.forEach(j=>{P[j]=0}),this.state.activeCharges=P,this.spawnNewPiece(),me.emit(xe.GAME_START),me.emit(xe.MUSIC_START),this.emitChange()}resetSession(){this.state.gameOver=!1,this.isSessionActive=!1,this.state.phase=Ze.ConsoleScreen,this.state.shiftScore=0,this.state.activeGoop=null,this.pendingTotalScore!==null&&(this.initialTotalScore=this.pendingTotalScore,this.pendingTotalScore=null),this.emitChange()}abortRun(){!this.isSessionActive||this.state.gameOver||(this.state.shiftScore=0,this.state.goalsCleared=0,this.finalizeGame())}enterConsole(){this.state.phase=Ze.ConsoleScreen,this.emitChange()}enterPeriscope(){this.state.gameOver?this.startRun():(this.state.phase=Ze.TankScreen,this.isSessionActive||this.startRun()),this.emitChange()}resolveComplication(t){this.state.gameOver||(Ds.resolveComplication(this.state,t,this.initialTotalScore,this.powerUps),this.state.phase=Ze.ConsoleScreen,this.emitChange())}activateAbility(t){var s,r;if(this.state.gameOver)return;const n=En[t];if(!(!n||n.type!=="active"))switch(t){case"COOLDOWN_BOOSTER":{const o=this.powerUps[t]||1,c=[.25,.35,.5][Math.min(o,3)-1];Ds.extendAllCooldowns(this.state,c),console.log(`COOLDOWN_BOOSTER activated: +${c*100}% cooldown extension`);break}case"GOOP_DUMP":{const o=mn(ft(this.initialTotalScore).rank),l=((s=this.state.activeGoop)==null?void 0:s.definition.color)||o[Math.floor(Math.random()*o.length)],c=this.powerUps[t]||1,a=Math.min(c,3),u=18,f=600,d=[];for(let p=0;p<a;p++)for(let y=0;y<u;y++)d.push({id:Math.random().toString(36).substr(2,9),color:l,x:Math.floor(Math.random()*Se),y:-1,spawnDelay:p*f+y*rm});this.state.dumpQueue.push(...d),console.log(`GOOP_DUMP activated: ${a} wave(s), ${d.length} total ${l} pieces`);break}case"GOOP_COLORIZER":{const o=(r=this.state.activeGoop)==null?void 0:r.definition.color;if(!o){console.log("GOOP_COLORIZER: No active piece to match color");break}const l=this.powerUps[t]||1,a=[6,7,8][Math.min(l,3)-1];this.state.colorizerColor=o,this.state.colorizerRemaining=a,console.log(`GOOP_COLORIZER activated: next ${a} pieces will be ${o}`);break}case"CRACK_DOWN":{const l=1+(this.powerUps[t]||1)*2;this.state.crackDownRemaining=l;break}}}chargeActiveAbilities(t){Object.keys(this.state.activeCharges).forEach(n=>{const s=this.state.activeCharges[n]||0;this.state.activeCharges[n]=Math.min(100,s+t)})}checkComplications(t){const{spawned:n,newLastCheckTime:s}=Ds.checkComplications(this.state,this.initialTotalScore,this.lastComplicationCheckTime);this.lastComplicationCheckTime=s,n&&(Ds.spawnComplication(this.state,n),this.emitChange())}finalizeGame(){if(this.state.gameOver)return;this.state.gameOver=!0,this.isSessionActive=!1,this.state.phase=Ze.ConsoleScreen;let t=0;for(let l=0;l<Ye;l++)for(let c=0;c<Se;c++)this.state.grid[l][c]&&t++;const n=this.powerUps.AUTO_POPPER||0;if(n>0){const l=t,c=.2-n*.04;let a=0;for(let u=0;u<l;u++)Math.random()>c&&a++;t-=a,console.log(`AUTO_POPPER: ${a} of ${l} goop auto-popped (${t} remaining)`)}const s=t*50;this.state.gameStats.penalty=s,this.state.shiftScore=Math.max(0,this.state.shiftScore-s);const o=100*ft(this.initialTotalScore).rank;this.state.shiftScore=Math.max(o,this.state.shiftScore),this.state.complications=[],this.state.activeComplicationId=null,this.state.prePoppedGoopGroups.clear(),me.emit(xe.GAME_OVER),this.emitChange()}getPiecePoolByZone(t){const s=(this.maxTime-this.state.shiftTime)/1e3,r=this.maxTime/3/1e3,o=!t&&Math.random()<Ml;return s<r?{pool:o?Xo:Uo,isCorrupted:o}:s<r*2?{pool:o?Ga:za,isCorrupted:o}:{pool:o?Ha:Ya,isCorrupted:o}}maybeApplyMirror(t){return Math.random()>=sx||t.cells.every(s=>t.cells.some(r=>r.x===-s.x&&r.y===s.y))?t:{...t,cells:t.cells.map(s=>({x:-s.x,y:s.y}))}}spawnNewPiece(t,n,s){const r=n||this.state.grid,o=s!==void 0?s:this.state.tankRotation,l=this.initialTotalScore+this.state.shiftScore,c=ft(l).rank,a=mn(c);let u=t;if(!u&&this.state.nextGoop){u=this.state.nextGoop;let y=a[Math.floor(Math.random()*a.length)];const S=this.powerUps.CRACK_MATCHER||0,P=this.state.crackCells.length>0?this.state.crackCells:this.state.goalMarks;if(S>0&&P.length>0){const w=P.reduce((m,M)=>M.y>m.y?M:m),k=S*.25;Math.random()<k&&(y=w.color)}const{pool:j,isCorrupted:g}=this.getPiecePoolByZone(),h=Math.floor(Math.random()*j.length),x=this.maybeApplyMirror({...j[h]}),C=!g&&c>=20&&Math.random()<.25;let R;if(C){const w=a.filter(M=>M!==y),k=w[Math.floor(Math.random()*w.length)],m={...x,color:y};R=jf(m,y,k)}else R={...x,color:y,isCorrupted:g||void 0};if(!g&&c>=40&&Math.random()<.15){const{pool:w}=this.getPiecePoolByZone(!0),k=Math.floor(Math.random()*w.length);R={...this.maybeApplyMirror({...w[k]}),color:St.WILD,isWild:!0},console.log("Wild piece queued for next spawn")}this.state.nextGoop=R,this.devOverrideNextGoop&&(this.state.nextGoop={...this.devOverrideNextGoop})}const f=fy(u,c);this.state.colorizerRemaining>0&&this.state.colorizerColor&&(f.definition={...f.definition,color:this.state.colorizerColor,cellColors:void 0},this.state.colorizerRemaining--,this.state.nextGoop&&this.state.colorizerRemaining>0&&(this.state.nextGoop={...this.state.nextGoop,color:this.state.colorizerColor,cellColors:void 0}),console.log(`GOOP_COLORIZER: Spawned ${this.state.colorizerColor} piece (${this.state.colorizerRemaining} remaining)`),this.state.colorizerRemaining===0&&(this.state.colorizerColor=null));const d=Math.floor((st-1)/2),p=0;if(f.screenX=d,f.x=Yc(d,o),f.y=p,f.startSpawnY=p,f.state=Ln.FALLING,this.lockStartTime=null,this.lockResetCount=0,fs(r,f)){this.finalizeGame();return}this.state.activeGoop=f,this.state.canSwap=!0,this.emitChange()}updateScoreAndStats(t,n){this.state.shiftScore+=t,n&&(this.state.scoreBreakdown.base+=n.base||0,this.state.scoreBreakdown.height+=n.height||0,this.state.scoreBreakdown.offscreen+=n.offscreen||0,this.state.scoreBreakdown.adjacency+=n.adjacency||0,this.state.scoreBreakdown.speed+=n.speed||0)}handleGoals(t,n,s){Hc.handleGoals(this.state,t,n,s,()=>this.emitChange())}tickTimer(t){const n=this.powerUps.FOCUS_MODE||0,r=this.state.phase===Ze.COMPLICATION_MINIGAME&&n>0?1-n*.1:1;return!this.freezeTimer&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*r),this.state.shiftTime<=0)?(this.finalizeGame(),!1):!0}tickGoals(){const{crack:t,newLastSpawnTime:n}=Hc.trySpawnCrack(this.state,this.state.grid,this.initialTotalScore,this.state.shiftTime,this.maxTime,this.lastGoalSpawnTime);this.lastGoalSpawnTime=n,t&&(this.state.crackCells.push(t),this.state.goalMarks.push({id:t.id,x:t.x,y:t.y,color:t.color,spawnTime:t.spawnTime}))}tickHeat(t){const n=ft(this.initialTotalScore).rank,s=ds[Ae.CONTROLS];if(ho(Ae.CONTROLS,n)&&this.state.controlsHeat>0){const r=Date.now(),o=this.state.rotationTimestamps.length>0?this.state.rotationTimestamps[this.state.rotationTimestamps.length-1]:0;if(r-o>s.idleThresholdMs){const c=this.powerUps.GEAR_LUBRICATION||0,a=s.dissipationBase*(1+s.dissipationUpgradeEffect*c);this.state.controlsHeat=Math.max(0,this.state.controlsHeat-a*t/1e3)}}}tickLightsBrightness(t){const n=ft(this.initialTotalScore).rank,s=ds[Ae.LIGHTS];if(!ho(Ae.LIGHTS,n))return;if(this.state.phase!==Ze.TankScreen){this.state.lightsGraceStart!==null&&this.lightsGracePausedAt===null&&(this.lightsGracePausedAt=Date.now());return}if(this.lightsGracePausedAt!==null&&this.state.lightsGraceStart!==null){const a=Date.now()-this.lightsGracePausedAt;this.state.lightsGraceStart+=a,this.lightsGracePausedAt=null}if(this.state.complications.some(a=>a.type===Ae.LIGHTS)){this.state.lightsBrightness=s.failedBrightness;return}const o=Date.now();this.isFastDropping&&!this.wasFastDropping&&(this.state.lightsGraceStart=null,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),!this.isFastDropping&&this.wasFastDropping&&(this.state.lightsGraceStart=o,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),this.wasFastDropping=this.isFastDropping;const l=this.powerUps.CIRCUIT_STABILIZER||0,c=(s.graceBaseSec+s.gracePerLevel*l)*1e3;if(this.isFastDropping){if(this.state.lightsBrightness<100){const a=s.recoverRate*t/1e3;this.state.lightsBrightness=Math.min(100,this.state.lightsBrightness+a),this.state.lightsBrightness>=100&&(this.lightsOverflarePhase="rising",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="rising"){this.lightsOverflareTime+=t;const a=Math.min(1,this.lightsOverflareTime/s.overflareUpMs);this.state.lightsBrightness=100+(s.overflarePeak-100)*a,a>=1&&(this.lightsOverflarePhase="falling",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="falling"){this.lightsOverflareTime+=t;const a=Math.min(1,this.lightsOverflareTime/s.overflareDownMs);this.state.lightsBrightness=s.overflarePeak-(s.overflarePeak-100)*a,a>=1&&(this.lightsOverflarePhase="none",this.state.lightsBrightness=100)}}else{this.state.lightsGraceStart===null&&(this.state.lightsGraceStart=o);const a=o-this.state.lightsGraceStart;if(a<c){if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1,this.state.lightsBrightness=100}}else if(a>=c&&!this.state.lightsFlickered)this.state.lightsFlickered=!0,this.lightsFlickerActive=!0,this.lightsFlickerTime=0,me.emit(xe.LIGHTS_FLICKER,{});else if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1}else{const u=a-c,f=s.dimDurationSec*1e3,d=Math.min(1,u/f);this.state.lightsBrightness=100-(100-s.dimThreshold)*d,this.state.lightsBrightness<=s.dimThreshold&&(this.state.lightsBrightness=s.failedBrightness,Ds.spawnComplication(this.state,Ae.LIGHTS))}}}tickLooseGoop(t){if(this.state.looseGoop.length===0)return;const{active:n,landed:s}=xy(this.state.looseGoop,this.state.grid,t);if(s.length>0){me.emit(xe.PIECE_DROPPED);const r=this.state.grid.map(c=>[...c]);let o=!1;const l=[];if(s.forEach(c=>{if(c.y>=0&&c.y<Ye){const a=Math.floor(c.y),u=this.state.goalMarks.find(d=>d.x===c.x&&d.y===a);let f=!1;u&&u.color===c.data.color&&(l.push(u.id),f=!0),r[a][c.x]={...c.data,timestamp:Date.now(),isSealingGoop:f},o=!0}}),o&&(this.state.grid=Ai(r)),l.length>0){const c=new Set(l);l.forEach(a=>{const u=this.state.crackCells.find(f=>f.id===a);u&&(u.originCrackId.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.branchCrackIds=d.branchCrackIds.filter(p=>p!==a))}),u.branchCrackIds.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.originCrackId=d.originCrackId.filter(p=>p!==a))}))}),this.state.crackCells=this.state.crackCells.filter(a=>!c.has(a.id)),this.state.goalMarks=this.state.goalMarks.filter(a=>!c.has(a.id)),me.emit(xe.GOAL_CAPTURED,{count:l.length})}this.state.looseGoop=n}else this.state.looseGoop=n}tickDumpPieces(t){var l;const n=[];for(const c of this.state.dumpQueue)c.spawnDelay-=t,c.spawnDelay<=0?this.state.dumpPieces.push(c):n.push(c);if(this.state.dumpQueue=n,this.state.dumpPieces.length===0)return;const s=[],r=this.state.grid.map(c=>[...c]);let o=!1;for(const c of this.state.dumpPieces){c.y+=im*t;const a=Math.floor(c.y),u=c.x;let f=!1;(a>=Ye-1||a>=0&&((l=r[a+1])!=null&&l[u]))&&(f=!0),f&&a>=0&&a<Ye?(r[a][u]={id:c.id,goopGroupId:Math.random().toString(36).substr(2,9),timestamp:Date.now(),color:c.color,groupMinY:a,groupMaxY:a,groupSize:1},o=!0):f||s.push(c)}this.state.dumpPieces=s,o&&(this.state.grid=Ai(r))}tickActivePiece(t){if(!this.state.activeGoop||this.usePhysicsForFalling)return;const s=1+(this.powerUps.DENSE_GOOP||0)*.125,r=Rf/s,o=this.isFastDropping?r/bf:r,l=t/o,c=this.state.activeGoop.y+l,a=Yc(this.state.activeGoop.screenX,this.state.tankRotation),u={...this.state.activeGoop,y:c,x:a};if(fs(this.state.grid,u,this.state.tankRotation)){this.lockStartTime===null&&(this.lockStartTime=Date.now());const f=Date.now()-this.lockStartTime,d=this.isFastDropping?50:Mf;(f>d||this.lockResetCount>=10)&&this.lockActivePiece()}else this.state.activeGoop=u,this.lockStartTime=null}lockActivePiece(){if(!this.state.activeGoop||this.state.gameOver)return;const t=ip(this.state.grid,this.state.activeGoop,this.state.tankRotation),n={...this.state.activeGoop,y:t};let{grid:s,consumedGoals:r,destroyedGoals:o}=py(this.state.grid,n,this.state.goalMarks);(n.definition.isWild||this.hasAdjacentWild(s,n))&&(s=hy(s,n)),(r.length>0||o.length>0)&&this.handleGoals(r,o,n),this.state.complications.some(u=>u.type===Ae.LASER)||(this.state.laserCharge=Math.min(100,this.state.laserCharge+10)),me.emit(xe.PIECE_DROPPED);const{grid:c,looseGoop:a}=lp(s);a.length>0&&this.state.looseGoop.push(...a),this.state.grid=c,this.spawnNewPiece(void 0,c),this.state.popStreak=0,this.isFastDropping=!1}tickActiveCharges(t){Object.keys(this.state.activeCharges).length===0&&this.equippedActives.length>0&&this.equippedActives.forEach(s=>{this.state.activeCharges[s]=this.state.activeCharges[s]??0});const n={COOLDOWN_BOOSTER:100/20,GOOP_DUMP:100/15,GOOP_COLORIZER:100/25,CRACK_DOWN:100/30};Object.keys(this.state.activeCharges).forEach(s=>{const r=this.state.activeCharges[s]||0;if(r<100){const o=n[s]||3,l=t/1e3*o,c=Math.min(100,r+l);this.state.activeCharges[s]=c}})}getFallSpeed(){const n=1+(this.powerUps.DENSE_GOOP||0)*.125,s=30/Rf*1e3*n;return this.isFastDropping?s*bf:s}syncActivePieceFromPhysics(t,n){if(!(!this.state.activeGoop||this.state.gameOver))if(this.state.activeGoop.y=n,t){this.lockStartTime===null&&(this.lockStartTime=Date.now());const s=Date.now()-this.lockStartTime,r=this.isFastDropping?50:Mf;(s>r||this.lockResetCount>=10)&&this.lockActivePiece()}else this.lockStartTime=null}tick(t){!this.isSessionActive||this.state.gameOver||this.state.isPaused||this.tickTimer(t)&&(this.tickGoals(),this.crackManager.tickGrowth(this.state,this.initialTotalScore,this.powerUps,this.maxTime),this.checkComplications(t),this.tickHeat(t),this.tickLightsBrightness(t),this.tickLooseGoop(t),this.tickDumpPieces(t),this.tickActivePiece(t),this.tickActiveCharges(t),this.emitChange())}}const Tf=tn?25:16,cm=(e,t,n,s=[],r)=>{const o=v.useRef(null);o.current||(o.current=new lm(e,t,s));const l=o.current;if(l.equippedActives.length!==s.length||!l.equippedActives.every((p,y)=>p===s[y])){l.equippedActives=s;const p=l.state.activeCharges||{},y={};s.forEach(S=>{y[S]=p[S]??0}),l.state.activeCharges=y}const[,a]=v.useReducer(p=>p+1,0),u=v.useRef(0),f=v.useRef(0),d=v.useRef(0);return v.useEffect(()=>{l.syncTotalScore(e)},[e,l]),v.useEffect(()=>l.subscribe(()=>{if(l.state.gameOver){a();return}const y=performance.now();y-f.current>=Tf&&(f.current=y,a())}),[l]),v.useEffect(()=>{const p=y=>{u.current||(u.current=y);const S=y-u.current;if(tn&&S<Tf){d.current=requestAnimationFrame(p);return}u.current=y,l.tick(S),r&&r(S/1e3,l),d.current=requestAnimationFrame(p)};return d.current=requestAnimationFrame(p),()=>cancelAnimationFrame(d.current)},[l]),{engine:l,gameState:l.state}},am=2.4;function um(){return{minX:vn.x,maxX:vn.x+st*Pt,minY:vn.y,maxY:vn.y+qt*Pt}}function fm(e){const{enabled:t,params:n,bounds:s}=e,r=v.useRef([]),o=v.useRef([]),l=v.useRef([]),c=v.useRef(0),a=v.useRef({..._i,...n}),u=v.useRef(s??um());v.useEffect(()=>{n&&(a.current={..._i,...n})},[n==null?void 0:n.damping,n==null?void 0:n.stiffness,n==null?void 0:n.pressure,n==null?void 0:n.iterations,n==null?void 0:n.homeStiffness,n==null?void 0:n.innerHomeStiffness,n==null?void 0:n.returnSpeed,n==null?void 0:n.viscosity,n==null?void 0:n.gravity,n==null?void 0:n.fallingHomeStiffness,n==null?void 0:n.fallingReturnSpeed,n==null?void 0:n.fallingViscosity,n==null?void 0:n.fallingGravity,n==null?void 0:n.attractionRadius,n==null?void 0:n.attractionRestLength,n==null?void 0:n.attractionStiffness,n==null?void 0:n.goopiness,n==null?void 0:n.tendrilEndRadius,n==null?void 0:n.tendrilSkinniness,n==null?void 0:n.wallThickness,n==null?void 0:n.fallingGoopiness,n==null?void 0:n.fallingTendrilEndRadius,n==null?void 0:n.fallingTendrilSkinniness,n==null?void 0:n.dropletCount,n==null?void 0:n.dropletSpeed,n==null?void 0:n.dropletLifetime,n==null?void 0:n.dropletSize,n==null?void 0:n.dropletGravity]),v.useEffect(()=>{s&&(u.current=s)},[s]);const f=v.useCallback((C,R,w,k,m=0)=>{const M=$y(C,R,w,k,m);return r.current=[...r.current,M],M},[]),d=v.useCallback(C=>{r.current=r.current.filter(R=>R.id!==C)},[]),p=v.useCallback((C,R,w)=>{const k=r.current.find(m=>m.id===C);k&&(k.targetX=R,k.targetY=w)},[]),y=v.useCallback(C=>{const R=r.current.find(w=>w.id===C);R&&(R.isLocked=!0,R.isFalling=!1,R.isLoose=!1,R.fillAmount=0)},[]),S=v.useCallback((C,R)=>{if(!t)return;const w=r.current,k=a.current,m=w.length>0;if(R&&m)for(const L of w)L.isFalling&&!L.isLocked&&qy(L,C,R.fallSpeed,R.grid,qt,R.tankRotation);if(m){Hy(w,C,k,u.current);for(const L of w)if(L.isLocked&&L.fillAmount<1){const q=1/(L.gridCells.length*fo/1e3);L.fillAmount=Math.min(1,L.fillAmount+q*C);const ee=L.fillAmount>=1;ee&&!L.wasFullLastFrame&&Wy(L,am),L.wasFullLastFrame=ee}o.current=Uy(w,o.current,k),Xy(w,o.current,k),Vy(w,Pt)}const M=k.dropletGravity,I=u.current;for(const L of l.current)L.vel.y+=M*C,L.pos.x+=L.vel.x*C,L.pos.y+=L.vel.y*C,(L.pos.x+L.radius<I.minX||L.pos.x-L.radius>I.maxX)&&(L.lifetime=0),L.pos.y+L.radius<I.minY&&(L.lifetime=0),L.pos.y+L.radius>I.maxY&&(L.pos.y=I.maxY-L.radius,L.vel.y*=-.3),L.lifetime-=C,L.opacity=Math.max(0,L.lifetime/L.maxLifetime),L.radius*=.995;l.current=l.current.filter(L=>L.lifetime>0&&L.opacity>.01)},[t]),P=v.useCallback(()=>{r.current=[],o.current=[],l.current=[]},[]),j=v.useCallback(C=>{const R=a.current,w=C.targetX,k=C.targetY;for(let m=0;m<R.dropletCount;m++){const M=Math.floor(Math.random()*C.vertices.length),I=C.vertices[M],L=I.pos.x-w,H=I.pos.y-k,q=Math.atan2(H,L)+(Math.random()-.5)*.8,ee=R.dropletSpeed*(.5+Math.random()*.8),N={id:`droplet-${c.current++}`,pos:{x:I.pos.x,y:I.pos.y},vel:{x:Math.cos(q)*ee,y:Math.sin(q)*ee-50},radius:R.dropletSize*(.5+Math.random()*.7),color:C.color,opacity:1,lifetime:R.dropletLifetime*(.7+Math.random()*.6),maxLifetime:R.dropletLifetime};l.current.push(N)}},[]),g=v.useCallback(C=>r.current.find(R=>R.id===C),[]),h=v.useCallback(C=>{for(const R of r.current){const k=-(C-R.createdAtRotation)*Pt;for(const m of R.vertices)m.pos.x+=k,m.oldPos.x+=k;for(const m of R.innerVertices)m.pos.x+=k,m.oldPos.x+=k;R.targetX+=k,R.createdAtRotation=C}},[]),x=v.useCallback(()=>{var k;const C=r.current.find(m=>m.isFalling&&!m.isLocked);if(!C)return null;let R=((k=C.gridCells[0])==null?void 0:k.y)??0;for(const m of C.gridCells)m.y<R&&(R=m.y);return{gridY:R+Qe,isColliding:C.isColliding}},[]);return{blobs:r.current,attractionSprings:o.current,params:a.current,createBlob:f,removeBlob:d,updateBlobTarget:p,lockBlob:y,step:S,clearBlobs:P,getBlob:g,shiftBlobsForRotation:h,droplets:l.current,createDropletsForPop:j,getActivePieceState:x}}const dm=({onExit:e,onRunComplete:t,initialTotalScore:n,powerUps:s={},scraps:r,settings:o,onOpenSettings:l,onOpenHelp:c,onOpenUpgrades:a,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,equippedActives:p=[],onToggleEquip:y})=>{const[S,P]=v.useState(!1),[j,g]=v.useState(!1),[h,x]=v.useState(St.RED),[C,R]=v.useState(!0),[w,k]=v.useState({..._i}),[m,M]=v.useState(.2),[I,L]=v.useState(!1),[H,q]=v.useState(5),[ee,N]=v.useState(40),[Q,ae]=v.useState(-11),[W,K]=v.useState(5),[Y,re]=v.useState(40),[te,Z]=v.useState(-11),de=fm({enabled:!0,params:w}),we=v.useCallback((T,$)=>{if($.state.gameOver||!$.isSessionActive)return;const V={grid:$.state.grid,tankRotation:$.state.tankRotation,fallSpeed:$.freezeFalling?0:$.getFallSpeed()};de.step(T,V);const U=$.state.activeGoop;if(U){const le=`active-${U.spawnTimestamp}`,b=de.getBlob(le);if(b&&b.isFalling&&!b.isLocked){const _=de.getActivePieceState();_&&$.syncActivePieceFromPhysics(_.isColliding,_.gridY)}}},[de]),{engine:E,gameState:B}=cm(n,s,t,p,we);v.useEffect(()=>{E.usePhysicsForFalling=!tn},[E]);const ve=v.useCallback(T=>{E.execute(new Rg(T))},[E]),ie=v.useRef(new Set),ye=v.useRef(0),se=v.useRef(0),ge=v.useRef(null),oe=v.useRef(!1),ke=v.useRef(null),he=v.useRef(null),Ee=250,$e=1500-((s==null?void 0:s.GOOP_SWAP)||0)*250,Fe=B.complications.find(T=>T.type===Ae.CONTROLS),Ne=v.useRef(0);v.useEffect(()=>{Fe||(Ne.current=0)},[Fe==null?void 0:Fe.id]);const Ie=o.invertRotation?-1:1;v.useEffect(()=>{if(B.gameOver&&B.phase===Ze.ConsoleScreen){const T=B.goalsCleared>=B.goalsTarget;t({score:B.shiftScore,won:T})}},[B.gameOver]);const O=v.useCallback(()=>{oe.current=!1,ge.current&&(cancelAnimationFrame(ge.current),ge.current=null)},[]),G=v.useCallback(()=>{he.current&&(clearInterval(he.current),he.current=null),ke.current=null,me.emit(xe.INPUT_SWAP_HOLD,{progress:-1})},[]),Ce=v.useCallback(()=>{he.current||(ke.current=Date.now(),me.emit(xe.INPUT_SWAP_HOLD,{progress:0}),he.current=window.setInterval(()=>{if(!ke.current)return;const T=Date.now()-ke.current;if(T<Ee)return;const $=T-Ee,V=Math.min(100,$/$e*100);me.emit(xe.INPUT_SWAP_HOLD,{progress:V}),V>=100&&(me.emit(xe.INPUT_SWAP),G())},16))},[G]),D=v.useCallback(()=>{if(oe.current)return;oe.current=!0;const T=()=>{if(!oe.current)return;const $=Date.now(),V=Fe?200:100;if($>=se.current){let le=0;(ie.current.has("ArrowLeft")||ie.current.has("KeyA"))&&(le=1*Ie),(ie.current.has("ArrowRight")||ie.current.has("KeyD"))&&(le=-1*Ie),ye.current!==0&&(le=ye.current*Ie),le!==0&&(Fe?(Ne.current++,Ne.current>=2&&(E.execute(new Nr(le)),Ne.current=0)):E.execute(new Nr(le)),se.current=$+V)}(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||ye.current!==0)&&B.phase===Ze.TankScreen&&!E.state.isPaused&&E.isSessionActive?ge.current=requestAnimationFrame(T):O()};ge.current=requestAnimationFrame(T)},[E,B.phase,O,Ie,Fe]);v.useEffect(()=>{const T=U=>{if(!U.repeat){if(ie.current.add(U.code),U.key==="`"){U.preventDefault(),P(le=>!le);return}if(U.key==="~"){U.preventDefault(),g(le=>!le);return}if(U.key==="Backspace"&&B.phase===Ze.TankScreen&&E.execute(new $s(Ze.ConsoleScreen)),B.gameOver){U.key==="Enter"&&E.resetSession();return}if(B.phase===Ze.TankScreen&&!E.state.isPaused&&E.isSessionActive)switch(U.code){case"ArrowLeft":case"KeyA":E.execute(new Nr(1*Ie)),se.current=Date.now()+250,D();break;case"ArrowRight":case"KeyD":E.execute(new Nr(-1*Ie)),se.current=Date.now()+250,D();break;case"KeyQ":E.execute(new bo(!1));break;case"KeyE":E.execute(new bo(!0));break;case"KeyS":E.execute(new El(!0));break;case"Space":E.execute(new $s(Ze.ConsoleScreen));break;case"KeyW":E.execute(new $s(Ze.ConsoleScreen));break;case"KeyR":Ce();break}}},$=U=>{if(ie.current.delete(U.code),B.phase===Ze.TankScreen)switch(U.code){case"KeyS":E.execute(new El(!1));break;case"KeyR":G();break;case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":!(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD"))&&ye.current===0&&O();break}},V=U=>{B.phase===Ze.TankScreen&&!E.state.isPaused&&!B.gameOver&&E.isSessionActive&&(U.deltaY>0?E.execute(new bo(!0)):E.execute(new bo(!1)))};return window.addEventListener("keydown",T),window.addEventListener("keyup",$),window.addEventListener("wheel",V),()=>{window.removeEventListener("keydown",T),window.removeEventListener("keyup",$),window.removeEventListener("wheel",V),O(),G()}},[E,B.phase,B.gameOver,D,O,Ce,G,Ie]),v.useEffect(()=>{const T=me.on(xe.INPUT_ROTATE,_=>{E.execute(new bo((_==null?void 0:_.clockwise)??!0))}),$=me.on(xe.INPUT_DRAG,_=>{ye.current=(_==null?void 0:_.direction)??0,(_==null?void 0:_.direction)!==0?D():ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||O()}),V=me.on(xe.INPUT_SWIPE_UP,()=>{E.execute(new $s(Ze.ConsoleScreen))}),U=me.on(xe.INPUT_FAST_DROP,_=>{E.execute(new El((_==null?void 0:_.active)??!1))}),le=me.on(xe.INPUT_SWAP,()=>{E.execute(new kg)}),b=me.on(xe.INPUT_BLOCK_TAP,_=>{_&&E.execute(new wg(_.x,_.y))});return()=>{T(),$(),V(),U(),le(),b()}},[E,D,O]);const F=ft(n).rank;return i.jsxs("div",{className:"w-full h-full relative touch-none bg-slate-950 overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0",children:i.jsx(Zy,{state:B,rank:F,maxTime:E.maxTime,lightsBrightness:B.phase===Ze.TankScreen?B.lightsBrightness:100,laserCharge:B.laserCharge,controlsHeat:B.controlsHeat,complicationCooldowns:B.complicationCooldowns,equippedActives:p,activeCharges:B.activeCharges,onActivateAbility:ve,powerUps:s,storedGoop:E.state.storedGoop,nextGoop:E.state.nextGoop,softBodyPhysics:de,normalGoopOpacity:m,showVertexDebug:I,gooStdDev:H,gooAlphaMul:ee,gooAlphaOff:Q,fallingGooStdDev:W,fallingGooAlphaMul:Y,fallingGooAlphaOff:te})}),i.jsx("div",{className:`absolute inset-0 z-50 transition-opacity duration-500 ${B.phase===Ze.ConsoleScreen?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:i.jsx(em,{engine:E,state:B,careerScore:n,scraps:r,powerUps:s,onOpenSettings:l,onOpenHelp:c,onOpenUpgrades:a,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,onDismissGameOver:()=>E.resetSession(),equippedActives:p,onToggleEquip:y})}),i.jsx("div",{className:`absolute inset-0 z-20 pointer-events-none transition-opacity duration-500 ${B.phase===Ze.TankScreen?"opacity-100":"opacity-0"}`,children:i.jsx(hg,{state:B,onRestart:()=>E.execute(new jg),onExit:()=>{me.emit(xe.GAME_EXITED),E.execute(new $s(Ze.ConsoleScreen))},initialTotalScore:E.initialTotalScore,maxTime:E.maxTime})}),S&&!tn&&i.jsxs("div",{className:"absolute top-2 right-2 z-[100] bg-black/90 text-white p-3 rounded-lg text-xs font-mono pointer-events-auto overflow-y-auto",style:{minWidth:460,maxHeight:"95vh"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"font-bold",children:"Physics Debug"}),i.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-white",children:""})]}),i.jsxs("div",{className:"space-y-2 mb-2",children:[i.jsx("div",{className:"text-gray-400 text-[10px] uppercase tracking-wider",children:"Shared"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Damping: ",w.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:w.damping,onChange:T=>k($=>({...$,damping:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Stiffness: ",w.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:w.stiffness,onChange:T=>k($=>({...$,stiffness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Pressure: ",w.pressure]}),i.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:w.pressure,onChange:T=>k($=>({...$,pressure:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Inner Home Stiffness: ",w.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:w.innerHomeStiffness,onChange:T=>k($=>({...$,innerHomeStiffness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Iterations: ",w.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:w.iterations,onChange:T=>k($=>({...$,iterations:Number(T.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-600",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-yellow-400 text-[10px] uppercase tracking-wider",children:"Locked"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Home Stiffness: ",w.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w.homeStiffness,onChange:T=>k($=>({...$,homeStiffness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Return Speed: ",w.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w.returnSpeed,onChange:T=>k($=>({...$,returnSpeed:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Viscosity: ",w.viscosity.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:w.viscosity,onChange:T=>k($=>({...$,viscosity:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Gravity: ",w.gravity]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:w.gravity,onChange:T=>k($=>({...$,gravity:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Goo Filter"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Blur: ",H]}),i.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:H,onChange:T=>q(Number(T.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Mul: ",ee]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:ee,onChange:T=>N(Number(T.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Off: ",Q]}),i.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:Q,onChange:T=>ae(Number(T.target.value)),className:"w-full"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-cyan-400 text-[10px] uppercase tracking-wider",children:"Falling"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Home Stiffness: ",w.fallingHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w.fallingHomeStiffness,onChange:T=>k($=>({...$,fallingHomeStiffness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Return Speed: ",w.fallingReturnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w.fallingReturnSpeed,onChange:T=>k($=>({...$,fallingReturnSpeed:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Viscosity: ",w.fallingViscosity.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:w.fallingViscosity,onChange:T=>k($=>({...$,fallingViscosity:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Gravity: ",w.fallingGravity]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:w.fallingGravity,onChange:T=>k($=>({...$,fallingGravity:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Tendrils"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Goopiness: ",w.fallingGoopiness]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:w.fallingGoopiness,onChange:T=>k($=>({...$,fallingGoopiness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["End Radius: ",w.fallingTendrilEndRadius]}),i.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:w.fallingTendrilEndRadius,onChange:T=>k($=>({...$,fallingTendrilEndRadius:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Skinniness: ",w.fallingTendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w.fallingTendrilSkinniness,onChange:T=>k($=>({...$,fallingTendrilSkinniness:Number(T.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Goo Filter"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Blur: ",W]}),i.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:W,onChange:T=>K(Number(T.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Mul: ",Y]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:Y,onChange:T=>re(Number(T.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Off: ",te]}),i.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:te,onChange:T=>Z(Number(T.target.value)),className:"w-full"})]})]})]})]}),i.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600 mt-2",children:[i.jsxs("div",{className:"pt-0",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Attraction"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Radius: ",w.attractionRadius]}),i.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:w.attractionRadius,onChange:T=>k($=>({...$,attractionRadius:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Rest Length: ",w.attractionRestLength]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:w.attractionRestLength,onChange:T=>k($=>({...$,attractionRestLength:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Stiffness: ",w.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",value:w.attractionStiffness,onChange:T=>k($=>({...$,attractionStiffness:Number(T.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Rendering"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Goopiness: ",w.goopiness]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:w.goopiness,onChange:T=>k($=>({...$,goopiness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Tendril End Radius: ",w.tendrilEndRadius]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:w.tendrilEndRadius,onChange:T=>k($=>({...$,tendrilEndRadius:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Tendril Skinniness: ",w.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w.tendrilSkinniness,onChange:T=>k($=>({...$,tendrilSkinniness:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Wall Thickness: ",w.wallThickness]}),i.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:w.wallThickness,onChange:T=>k($=>({...$,wallThickness:Number(T.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Droplets (Pop Effect)"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Count: ",w.dropletCount]}),i.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:w.dropletCount,onChange:T=>k($=>({...$,dropletCount:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Speed: ",w.dropletSpeed]}),i.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:w.dropletSpeed,onChange:T=>k($=>({...$,dropletSpeed:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Lifetime: ",w.dropletLifetime,"s"]}),i.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:w.dropletLifetime,onChange:T=>k($=>({...$,dropletLifetime:Number(T.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Size: ",w.dropletSize]}),i.jsx("input",{type:"range",min:"2",max:"30",step:"1",value:w.dropletSize,onChange:T=>k($=>({...$,dropletSize:Number(T.target.value)})),className:"w-full"})]})]}),i.jsx("div",{className:"pt-2 border-t border-gray-600",children:i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Normal Goop Opacity: ",m.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:m,onChange:T=>M(Number(T.target.value)),className:"w-full"})]})}),i.jsxs("div",{className:"pt-2 border-t border-gray-600 text-gray-400",children:[i.jsxs("div",{children:["Blobs: ",de.blobs.length]}),i.jsxs("div",{className:"flex gap-1 mt-1",children:[i.jsx("button",{onClick:()=>{k({..._i}),M(.25),L(!1),q(8),N(24),ae(-13),K(8),re(24),Z(-13)},className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Reset to Defaults"}),i.jsx("button",{onClick:()=>{const T={...w,gooStdDev:H,gooAlphaMul:ee,gooAlphaOff:Q,fallingGooStdDev:W,fallingGooAlphaMul:Y,fallingGooAlphaOff:te,normalGoopOpacity:m};console.log("=== DEBUG PARAMS SNAPSHOT ==="),console.log(JSON.stringify(T,null,2)),console.log("============================")},className:"px-2 py-1 bg-blue-700 hover:bg-blue-600 rounded text-xs",children:"Save"})]})]})]})]}),j&&!tn&&(()=>{var A,z;const T=ft(n).rank,$=mn(T),V=[{key:"RED",hex:St.RED},{key:"BLUE",hex:St.BLUE},{key:"GREEN",hex:St.GREEN},{key:"YELLOW",hex:St.YELLOW},{key:"PURPLE",hex:St.PURPLE},{key:"WHITE",hex:St.WHITE},{key:"BLACK",hex:St.BLACK}],U=36,le=7,b=(X,J)=>{const ne=Math.min(...X.cells.map(_e=>_e.x)),ue=Math.max(...X.cells.map(_e=>_e.x)),pe=Math.min(...X.cells.map(_e=>_e.y)),Te=Math.max(...X.cells.map(_e=>_e.y)),je=ue-ne+1,Le=Te-pe+1,De=(U-je*le)/2,Pe=(U-Le*le)/2;return i.jsx("div",{onClick:()=>{const _e={...X,color:h};E.state.nextGoop=_e,C||(E.devOverrideNextGoop=_e),E.emitChange()},style:{cursor:"pointer",borderRadius:4,border:"1px solid #334155",background:"rgba(30, 41, 59, 0.5)"},title:X.type,onMouseEnter:_e=>_e.currentTarget.style.background="rgba(51, 65, 85, 0.8)",onMouseLeave:_e=>_e.currentTarget.style.background="rgba(30, 41, 59, 0.5)",children:i.jsx("svg",{width:U,height:U,children:X.cells.map((_e,We)=>i.jsx("rect",{x:De+(_e.x-ne)*le,y:Pe+(_e.y-pe)*le,width:le-1,height:le-1,fill:h,rx:1},We))})},J)},_=[{label:"TETRA",normal:Uo,corrupted:Xo},{label:"PENTA",normal:za,corrupted:Ga},{label:"HEXA",normal:Ya,corrupted:Ha}];return i.jsxs("div",{className:"absolute top-2 left-2 z-[100] bg-black/90 text-white p-3 rounded-lg text-xs font-mono pointer-events-auto overflow-y-auto",style:{minWidth:280,maxHeight:"95vh"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"font-bold",children:"Piece Picker"}),i.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white px-1",children:""})]}),i.jsxs("div",{className:"flex gap-3 mb-2 pb-2 border-b border-gray-700",children:[i.jsxs("div",{className:"text-gray-400",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-wider",children:"Next:"})," ",i.jsx("span",{className:"text-gray-200",children:((A=B.nextGoop)==null?void 0:A.type)??""})]}),i.jsxs("div",{className:"text-gray-400",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-wider",children:"Hold:"})," ",i.jsx("span",{className:"text-gray-200",children:((z=B.storedGoop)==null?void 0:z.type)??""})]})]}),i.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700",children:[i.jsx("div",{className:"text-[10px] uppercase tracking-wider text-gray-400 mb-1",children:"Color"}),i.jsx("div",{className:"flex gap-1.5",children:V.map(X=>{const J=$.includes(X.hex),ne=h===X.hex;return i.jsx("div",{onClick:()=>J&&x(X.hex),style:{width:24,height:24,borderRadius:"50%",background:X.hex,opacity:J?1:.3,cursor:J?"pointer":"not-allowed",border:ne?"3px solid #facc15":J?"2px solid #475569":"2px dashed #334155",boxSizing:"border-box"},title:`${X.key}${J?"":" (locked)"}`},X.key)})})]}),i.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700 space-y-1",children:[i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:C,onChange:X=>{R(X.target.checked),X.target.checked&&(E.devOverrideNextGoop=null)}}),i.jsx("span",{children:"Random Pieces"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:I,onChange:X=>L(X.target.checked)}),i.jsx("span",{children:"Show Vertices"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:E.freezeTimer,onChange:X=>{E.freezeTimer=X.target.checked}}),i.jsx("span",{children:"Freeze Timer"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:E.freezeFalling,onChange:X=>{E.freezeFalling=X.target.checked}}),i.jsx("span",{children:"Freeze Falling"})]})]}),_.map(X=>i.jsxs("div",{className:"mb-2",children:[i.jsxs("div",{className:"text-[10px] uppercase tracking-wider text-cyan-400 mb-1",children:[X.label,"  Normal"]}),i.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:X.normal.map((J,ne)=>b(J,ne))}),i.jsxs("div",{className:"text-[10px] uppercase tracking-wider text-orange-400 mb-1",children:[X.label,"  Corrupted"]}),i.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:X.corrupted.map((J,ne)=>b(J,ne))})]},X.label))]})})()]})},pm=({onBack:e})=>i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-4",children:i.jsx("h2",{className:"text-2xl font-bold text-yellow-400 tracking-wider",children:"UPGRADES"})}),i.jsx("div",{className:"w-full max-w-md space-y-4 opacity-50 pointer-events-none",children:[1,2,3].map(t=>i.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center",children:i.jsx(rg,{className:"w-6 h-6 text-slate-600"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-bold text-slate-300",children:["Locked Upgrade ",t]}),i.jsxs("div",{className:"text-xs text-slate-500",children:["Requires Rank ",t*5]})]})]}),i.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded text-slate-500 text-xs font-bold",children:"LOCKED"})]},t))}),i.jsx("div",{className:"mt-8 text-center text-slate-500 text-sm",children:"Play more to unlock system upgrades."})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),hm=({settings:e,onUpdate:t,onBack:n})=>{v.useEffect(()=>{mt.init(e)},[]);const s=(l,c)=>{t({...e,[l]:c})},r=({label:l,value:c,onChange:a,icon:u,colorClass:f})=>i.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex flex-col gap-3 transition-colors hover:border-slate-700",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{className:`w-5 h-5 ${f}`}),i.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase text-sm",children:l})]}),i.jsxs("span",{className:`font-bold text-sm ${f}`,children:[c,"%"]})]}),i.jsxs("div",{className:"relative w-full h-6 flex items-center",children:[i.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:d=>a(Number(d.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-cyan-500 z-10",style:{background:`linear-gradient(to right, currentColor 0%, currentColor ${c}%, rgba(30, 41, 59, 1) ${c}%, rgba(30, 41, 59, 1) 100%)`}}),i.jsx("style",{children:`
              input[type=range]::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  height: 16px;
                  width: 16px;
                  border-radius: 50%;
                  background: #f1f5f9;
                  margin-top: -2px; /* align center */
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
              input[type=range]::-moz-range-thumb {
                  height: 16px;
                  width: 16px;
                  border: none;
                  border-radius: 50%;
                  background: #f1f5f9;
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
           `})]})]}),o=({label:l,value:c,onChange:a,icon:u,colorClass:f})=>i.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex items-center justify-between transition-colors hover:border-slate-700 cursor-pointer",onClick:()=>a(!c),children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{className:`w-5 h-5 ${f}`}),i.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase text-sm",children:l})]}),i.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${c?"bg-cyan-600":"bg-slate-700"}`,children:i.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform duration-300 ${c?"translate-x-6":"translate-x-0"}`})})]});return i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6",children:i.jsx("h2",{className:"text-3xl text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Config"})}),i.jsxs("div",{className:"w-full max-w-md space-y-4",children:[i.jsx(r,{label:"Master Output",value:e.masterVolume,onChange:l=>s("masterVolume",l),icon:dg,colorClass:"text-cyan-400"}),i.jsx(r,{label:"Music Level",value:e.musicVolume,onChange:l=>s("musicVolume",l),icon:lg,colorClass:"text-purple-400"}),i.jsx(r,{label:"SFX Level",value:e.sfxVolume,onChange:l=>{s("sfxVolume",l)},icon:ug,colorClass:"text-green-400"}),i.jsx("div",{className:"h-px bg-slate-800 my-2"}),i.jsx(o,{label:"Invert Rotation",value:e.invertRotation||!1,onChange:l=>s("invertRotation",l),icon:ag,colorClass:"text-yellow-400"})]}),i.jsx("div",{className:"mt-8 text-center text-slate-700 text-[10px] uppercase tracking-widest font-bold",children:"Audio System v2.1  Initialized"})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:n,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},xm=({onBack:e})=>i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6 flex-shrink-0",children:i.jsx("h2",{className:"text-3xl text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Operator Manual"})}),i.jsxs("div",{className:"w-full max-w-md space-y-6",children:[i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx(sg,{className:"w-6 h-6 text-red-500"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"THE OBJECTIVE"})]}),i.jsxs("p",{className:"text-slate-400 leading-relaxed text-base",children:["The filtration system is clogging! Pop as much ooze as you can before the ",i.jsx("span",{className:"text-red-400 font-bold",children:"Pressure"})," reaches 100%.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("span",{className:"text-green-400 font-bold",children:"PRO TIP:"})," Popping larger groups of goop vents pressure, buying you more time to work."]})]}),i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx(og,{className:"w-6 h-6 text-slate-400"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"CONTROLS"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx(Ns,{keyName:"A / D",action:"Rotate Tank View"}),i.jsx(Ns,{keyName:"Q / E",action:"Rotate Falling Goop"}),i.jsx(Ns,{keyName:"S",action:"Fall Faster"}),i.jsx(Ns,{keyName:"R",action:"Swap Held Goop"}),i.jsx(Ns,{keyName:"W / Space",action:"Return to Console"}),i.jsx(Ns,{keyName:"CLICK",action:"Pop Solid Goop"})]}),i.jsx("div",{className:"mt-4 text-center text-sm text-slate-500 italic",children:"* Touch controls: Drag to rotate tank, tap sides to rotate piece."})]}),i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[i.jsx(ng,{className:"w-6 h-6 text-cyan-400"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"MECHANICS"})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(fg,{className:"w-5 h-5 text-red-500"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Priority Targets"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Sensors identify impurity hotspots with ",i.jsx("span",{className:"text-white font-bold",children:"colored markers"})," on the grid. Clear goop of the ",i.jsx("span",{className:"text-white font-bold",children:"matching color"})," at these coordinates to execute a localized flush protocol."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(ig,{className:"w-5 h-5 text-yellow-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Purging (Clicking)"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["You can only pop goop that is ",i.jsx("span",{className:"text-white font-bold",children:"fully filled"})," (solid) and sitting ",i.jsx("span",{className:"text-white font-bold",children:"below the pressure line"})," (the water level)."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(tg,{className:"w-5 h-5 text-green-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Scoring"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Goop combines with like colors.",i.jsx("br",{})," ",i.jsx("span",{className:"text-green-400",children:"Bigger Groups"})," = More XP.",i.jsx("br",{})," ",i.jsx("span",{className:"text-green-400",children:"Higher Elevation"})," = More XP."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(cg,{className:"w-5 h-5 text-orange-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Console Maintenance"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Sometimes equipment fails! If controls lock up or lights go out, press ",i.jsx("span",{className:"text-white font-bold",children:"SPACE"})," or ",i.jsx("span",{className:"text-white font-bold",children:"W"})," to return to the Console and fix the issue manually."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(pg,{className:"w-5 h-5 text-purple-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Progression"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Level up your Operator Rank to earn ",i.jsx("span",{className:"text-yellow-400",children:"Scraps"}),". Spend these in the Upgrades menu to enhance your efficiency!"]})]})]})]})]})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),Ns=({keyName:e,action:t})=>i.jsxs("div",{className:"flex flex-col bg-slate-950 border border-slate-800 p-2 rounded-lg text-center",children:[i.jsx("span",{className:"text-cyan-400 font-black text-base mb-1",children:e}),i.jsx("span",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider",children:t})]}),Ii="gooptris_save_v3",Ef="gooptris_save_v2",Wc=()=>({careerRank:1,careerScore:0,scraps:0,powerUps:{},equippedActives:[],unlockedUpgrades:[],firstRunComplete:!1,milestonesReached:[],settings:{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1}}),ym=e=>{const t={...e};return"operatorXP"in t&&(t.careerScore=t.operatorXP,delete t.operatorXP),"operatorRank"in t&&(t.careerRank=t.operatorRank,delete t.operatorRank),t},gm=()=>{try{let e=localStorage.getItem(Ii);const t=Wc();if(!e){const s=localStorage.getItem(Ef);if(s){const r=JSON.parse(s),o=ym(r);localStorage.setItem(Ii,JSON.stringify(o)),localStorage.removeItem(Ef),e=JSON.stringify(o)}}if(!e)return t;const n=JSON.parse(e);return{...t,...n,settings:{...t.settings,...n.settings||{}},powerUps:{...t.powerUps,...n.powerUps||{}},equippedActives:n.equippedActives||t.equippedActives,unlockedUpgrades:n.unlockedUpgrades||t.unlockedUpgrades,milestonesReached:n.milestonesReached||t.milestonesReached}}catch(e){return console.error("Failed to load save data",e),Wc()}},mm=e=>{try{localStorage.setItem(Ii,JSON.stringify(e))}catch(t){console.error("Failed to save data",t)}},vm=()=>{const e=Wc();try{localStorage.setItem(Ii,JSON.stringify(e))}catch(t){console.error("Failed to wipe save data",t)}return e},Sm=()=>{v.useEffect(()=>{const e=me.on(xe.PIECE_MOVED,()=>mt.playMove()),t=me.on(xe.PIECE_ROTATED,()=>mt.playRotate()),n=me.on(xe.PIECE_DROPPED,()=>mt.playDrop()),s=me.on(xe.GOOP_POPPED,f=>{mt.playPop((f==null?void 0:f.popStreak)||0)}),r=me.on(xe.ACTION_REJECTED,()=>mt.playReject()),o=me.on(xe.GOAL_CAPTURED,f=>{mt.playPop(10)}),l=me.on(xe.GAME_OVER,()=>{mt.playGameOver(),mt.stopMusic()}),c=me.on(xe.MUSIC_START,()=>mt.startMusic()),a=me.on(xe.MUSIC_STOP,()=>mt.stopMusic()),u=me.on(xe.GAME_RESUMED,()=>{mt.resume(),mt.startMusic()});return()=>{e(),t(),n(),s(),r(),o(),l(),c(),a(),u()}},[])},Af={damping:.975,gravity:30,stiffness:20,pressure:2.5,iterations:3},_f=40;function If(e,t){const n=[],s=[],r=[],o=_f,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=up(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,centerX:e,centerY:t,radius:_f*1.5}}function up(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function fp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Cm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function km(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function wm(e,t){const n=up(e.vertices);if(n<1)return;const s=e.restArea/n,r=fp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function jm(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5)}function Pm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Rm(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Pm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=fp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill(),e.fillStyle="#fff",e.font="10px monospace",e.fillText(String(a),u.pos.x-3,u.pos.y+3)}e.strokeStyle="rgba(52, 152, 219, 0.5)",e.lineWidth=1;for(const a of t.ringsprings)e.beginPath(),e.moveTo(s[a.a].pos.x,s[a.a].pos.y),e.lineTo(s[a.b].pos.x,s[a.b].pos.y),e.stroke();e.strokeStyle="rgba(155, 89, 182, 0.3)";for(const a of t.crossSprings)e.beginPath(),e.moveTo(s[a.a].pos.x,s[a.a].pos.y),e.lineTo(s[a.b].pos.x,s[a.b].pos.y),e.stroke();e.beginPath(),e.arc(l.x,l.y,5,0,Math.PI*2),e.fillStyle="#f39c12",e.fill()}}const Ll=500,Nl=400;function bm(){const e=v.useRef(null),t=v.useRef(If(Ll/2,Nl/3)),n=v.useRef(0),s=v.useRef(-1),r=v.useRef({active:!1,vertexIndex:-1}),[o,l]=v.useState(Af),[c,a]=v.useState(!0),[u,f]=v.useState(0);v.useEffect(()=>{const g=e.current;if(!g)return;const h=g.getContext("2d");if(!h)return;let x=0,C=performance.now();const R=w=>{x++,w-C>1e3&&(f(x),x=0,C=w);const k=t.current;if(s.current>=0){const m=Math.min((w-s.current)/1e3,.033);Cm(k,m,o);for(let M=0;M<o.iterations;M++)km(k,o),wm(k,o);jm(k,g.width,g.height)}s.current=w,r.current.active&&r.current.vertexIndex>=0,h.fillStyle="#2c3e50",h.fillRect(0,0,g.width,g.height),h.fillStyle="#34495e",h.fillRect(0,g.height-10,g.width,10),Rm(h,k,c),n.current=requestAnimationFrame(R)};return n.current=requestAnimationFrame(R),()=>{cancelAnimationFrame(n.current)}},[o,c]);const d=v.useCallback((g,h)=>{const x=t.current;if(!x)return-1;let C=1/0,R=-1;for(let w=0;w<x.vertices.length;w++){const k=x.vertices[w],m=k.pos.x-g,M=k.pos.y-h,I=Math.sqrt(m*m+M*M);I<C&&I<50&&(C=I,R=w)}return R},[]),p=v.useCallback(g=>{const h=e.current;if(!h)return;const x=h.getBoundingClientRect(),C=g.clientX-x.left,R=g.clientY-x.top,w=d(C,R);w>=0&&(r.current={active:!0,vertexIndex:w})},[d]),y=v.useCallback(g=>{if(!r.current.active)return;const h=e.current;if(!h)return;const x=t.current,C=h.getBoundingClientRect(),R=g.clientX-C.left,w=g.clientY-C.top,k=x.vertices[r.current.vertexIndex];k.pos.x=R,k.pos.y=w,k.oldPos.x=R,k.oldPos.y=w},[]),S=v.useCallback(()=>{r.current={active:!1,vertexIndex:-1}},[]),P=v.useCallback(()=>{t.current=If(Ll/2,Nl/3),s.current=-1},[]),j=v.useCallback(()=>{const g=t.current;for(const h of g.vertices)h.oldPos.x=h.pos.x+(Math.random()-.5)*30,h.oldPos.y=h.pos.y+(Math.random()-.5)*30},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-1: Soft Body Blob"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Click and drag vertices to poke the blob"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Ll,height:Nl,onMouseDown:p,onMouseMove:y,onMouseUp:S,onMouseLeave:S,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"pointer"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",u]}),i.jsx("span",{children:"Vertices: 10"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping (velocity): ",o.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.001",value:o.damping,onChange:g=>l(h=>({...h,damping:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Gravity: ",o.gravity]}),i.jsx("input",{type:"range",min:"-25",max:"50",step:"5",value:o.gravity,onChange:g=>l(h=>({...h,gravity:parseFloat(g.target.value)}))}),i.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"-25 = floats up, 0 = zero-g, 50 = gentle fall"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Stiffness (k): ",o.stiffness]}),i.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:o.stiffness,onChange:g=>l(h=>({...h,stiffness:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Pressure: ",o.pressure.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:o.pressure,onChange:g=>l(h=>({...h,pressure:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Constraint Iterations: ",o.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:o.iterations,onChange:g=>l(h=>({...h,iterations:parseInt(g.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:c,onChange:g=>a(g.target.checked)}),i.jsx("span",{children:"Show Debug (vertices, springs)"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:j,style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Poke!"}),i.jsx("button",{onClick:P,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset"})]}),i.jsx("button",{onClick:()=>l(Af),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset Parameters"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-1 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Verlet integration with position-based constraints"}),i.jsx("li",{children:"T-tetromino shape with 10 perimeter vertices"}),i.jsx("li",{children:"Ring springs (perimeter) + cross springs (structural)"}),i.jsx("li",{children:"Pressure force for volume preservation"}),i.jsx("li",{children:"Catmull-Rom to Bezier for smooth rendering"})]})]})]})}const Lf={damping:.92,gravity:0,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.03},Mm=40,Ol=500,Dl=400;function Nf(e,t){const n=[],s=[],r=[],o=Mm,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=dp(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t}}function dp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function pp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Tm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function Em(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Am(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function _m(e,t){const n=dp(e.vertices);if(n<1)return;const s=e.restArea/n,r=pp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Im(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3)}function Lm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Nm(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let a=0;a<r;a++){const u=t.targetX+s[a].homeOffset.x,f=t.targetY+s[a].homeOffset.y;a===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Lm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=pp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}e.strokeStyle="#f39c12",e.lineWidth=2,e.beginPath(),e.moveTo(t.targetX-10,t.targetY),e.lineTo(t.targetX+10,t.targetY),e.moveTo(t.targetX,t.targetY-10),e.lineTo(t.targetX,t.targetY+10),e.stroke()}}function Om(){const e=v.useRef(null),t=v.useRef(Nf(Ol/2,Dl/2)),n=v.useRef(0),s=v.useRef(-1),[r,o]=v.useState(Lf),[l,c]=v.useState(!0),[a,u]=v.useState(0),[f,d]=v.useState("cursor");v.useEffect(()=>{const j=e.current;if(!j)return;const g=j.getContext("2d");if(!g)return;let h=0,x=performance.now();const C=R=>{h++,R-x>1e3&&(u(h),h=0,x=R);const w=t.current;if(s.current>=0){const k=Math.min((R-s.current)/1e3,.033);Tm(w,k,r),Em(w,r);for(let m=0;m<r.iterations;m++)Am(w,r),_m(w,r);Im(w,j.width,j.height)}s.current=R,g.fillStyle="#2c3e50",g.fillRect(0,0,j.width,j.height),Nm(g,w,l),g.fillStyle="rgba(255,255,255,0.5)",g.font="12px system-ui",g.fillText(f==="cursor"?"Move mouse to guide blob":"Click to set target",10,20),n.current=requestAnimationFrame(C)};return n.current=requestAnimationFrame(C),()=>cancelAnimationFrame(n.current)},[r,l,f]);const p=v.useCallback(j=>{if(f!=="cursor")return;const g=e.current;if(!g)return;const h=g.getBoundingClientRect(),x=j.clientX-h.left,C=j.clientY-h.top;t.current.targetX=x,t.current.targetY=C},[f]),y=v.useCallback(j=>{if(f!=="click")return;const g=e.current;if(!g)return;const h=g.getBoundingClientRect();t.current.targetX=j.clientX-h.left,t.current.targetY=j.clientY-h.top},[f]),S=v.useCallback(()=>{t.current=Nf(Ol/2,Dl/2),s.current=-1},[]),P=v.useCallback(()=>{const j=t.current;for(const g of j.vertices){const h=g.homeOffset.x,x=g.homeOffset.y;g.homeOffset.x=x,g.homeOffset.y=-h}},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-2: Blob Follows Cursor"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Testing two-layer architecture: render follows data"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Ol,height:Dl,onMouseMove:p,onClick:y,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"crosshair"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:i.jsxs("span",{children:["FPS: ",a]})}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>d("cursor"),style:{flex:1,padding:"8px",backgroundColor:f==="cursor"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Follow Cursor"}),i.jsx("button",{onClick:()=>d("click"),style:{flex:1,padding:"8px",backgroundColor:f==="click"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Click Target"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Home Stiffness: ",r.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.5",step:"0.01",value:r.homeStiffness,onChange:j=>o(g=>({...g,homeStiffness:parseFloat(j.target.value)}))}),i.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"Low = laggy/stretchy, High = snappy"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping: ",r.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.005",value:r.damping,onChange:j=>o(g=>({...g,damping:parseFloat(j.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Stiffness: ",r.stiffness]}),i.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:r.stiffness,onChange:j=>o(g=>({...g,stiffness:parseFloat(j.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Iterations: ",r.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:r.iterations,onChange:j=>o(g=>({...g,iterations:parseInt(j.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:l,onChange:j=>c(j.target.checked)}),i.jsx("span",{children:"Show Debug (target, ghost)"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:P,style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Rotate 90"}),i.jsx("button",{onClick:S,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]}),i.jsx("button",{onClick:()=>o(Lf),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Parameters"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-2 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Test two-layer architecture (data layer drives render layer)"}),i.jsx("li",{children:"Blob follows cursor/click target with springy physics"}),i.jsx("li",{children:"Slow moves = smooth follow"}),i.jsx("li",{children:"Fast/jump moves = overshoot, bounce, settle"}),i.jsx("li",{children:"Tune homeStiffness for responsive but physical feel"})]})]})]})}const Dm={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.18},$m=40,$l=500,Fl=400;function Of(e,t){const n=[],s=[],r=[],o=$m,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=hp(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t,rotationCount:0}}function hp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function xp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Fm(e){let t=0;for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=n.pos.x-s,l=n.pos.y-r;t+=Math.sqrt(o*o+l*l)}return t/e.vertices.length}function Bm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function zm(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Gm(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Ym(e,t){const n=hp(e.vertices);if(n<1)return;const s=e.restArea/n,r=xp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Hm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Wm(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let a=0;a<r;a++){const u=t.targetX+s[a].homeOffset.x,f=t.targetY+s[a].homeOffset.y;a===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Hm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=xp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n)for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Um(){const e=v.useRef(null),t=v.useRef(Of($l/2,Fl/2)),n=v.useRef(0),s=v.useRef(-1),r=v.useRef(0),[o,l]=v.useState(Dm),[c,a]=v.useState(!0),[u,f]=v.useState(0),[d,p]=v.useState(0),[y,S]=v.useState(0),[P,j]=v.useState(!1),[g,h]=v.useState(500),[x,C]=v.useState(0);v.useEffect(()=>{const k=e.current;if(!k)return;const m=k.getContext("2d");if(!m)return;let M=0,I=performance.now();const L=H=>{M++,H-I>1e3&&(f(M),M=0,I=H);const q=t.current;if(P&&H-r.current>g){for(const re of q.vertices){const te=re.homeOffset.x,Z=re.homeOffset.y;re.homeOffset.x=Z,re.homeOffset.y=-te}q.rotationCount++,S(q.rotationCount),r.current=H}if(s.current>=0){const re=Math.min((H-s.current)/1e3,.033);Bm(q,re,o),zm(q,o);for(let te=0;te<o.iterations;te++)Gm(q,o),Ym(q,o)}s.current=H;const ee=Fm(q);p(ee),ee>x&&C(ee),m.fillStyle="#2c3e50",m.fillRect(0,0,k.width,k.height),Wm(m,q,c);const N=150,Q=20,ae=10,W=k.height-30;m.fillStyle="#34495e",m.fillRect(ae,W,N,Q);const K=Math.min(ee/50,1),Y=K<.3?"#27ae60":K<.7?"#f39c12":"#e74c3c";m.fillStyle=Y,m.fillRect(ae,W,N*K,Q),m.strokeStyle="#fff",m.strokeRect(ae,W,N,Q),m.fillStyle="#fff",m.font="12px system-ui",m.fillText(`Deviation: ${ee.toFixed(1)}px`,ae+5,W+14),n.current=requestAnimationFrame(L)};return n.current=requestAnimationFrame(L),()=>cancelAnimationFrame(n.current)},[o,c,P,g,x]);const R=v.useCallback(()=>{const k=t.current;for(const m of k.vertices){const M=m.homeOffset.x,I=m.homeOffset.y;m.homeOffset.x=I,m.homeOffset.y=-M}k.rotationCount++,S(k.rotationCount)},[]),w=v.useCallback(()=>{t.current=Of($l/2,Fl/2),s.current=-1,S(0),C(0)},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-3: Rotation Stress Test"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Spam rotate - does lag accumulate?"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:$l,height:Fl,style:{border:"2px solid #34495e",borderRadius:"8px"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",u]}),i.jsxs("span",{children:["Rotations: ",y]})]}),i.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c3e50",borderRadius:"4px",textAlign:"center"},children:[i.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[d.toFixed(1),"px"]}),i.jsx("div",{style:{fontSize:"12px",opacity:.7},children:"Current Deviation"}),i.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"5px"},children:["Peak: ",x.toFixed(1),"px"]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("button",{onClick:R,style:{padding:"15px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"18px",fontWeight:"bold"},children:"ROTATE 90"}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:P,onChange:k=>j(k.target.checked)}),i.jsx("span",{children:"Auto-rotate"})]}),i.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:g,onChange:k=>h(parseInt(k.target.value)),style:{flex:1},disabled:!P}),i.jsxs("span",{style:{fontSize:"12px",width:"50px"},children:[g,"ms"]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Home Stiffness: ",o.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.005",value:o.homeStiffness,onChange:k=>l(m=>({...m,homeStiffness:parseFloat(k.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping: ",o.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:o.damping,onChange:k=>l(m=>({...m,damping:parseFloat(k.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:c,onChange:k=>a(k.target.checked)}),i.jsx("span",{children:"Show Debug"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>C(0),style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Peak"}),i.jsx("button",{onClick:w,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset All"})]})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-3 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Spam rotate button - observe deviation meter"}),i.jsx("li",{children:"Enable auto-rotate at various speeds"}),i.jsx("li",{children:"Watch for lag accumulation (peak deviation climbing)"}),i.jsx("li",{children:"Target: deviation stays bounded, recovers between rotations"}),i.jsx("li",{children:"Success = peak deviation stays under ~40px even with spam"})]})]})]})}const yp=30,Mo=600,To=450,Xm={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.05,attractionRadius:yp,attractionRestLength:0,attractionStiffness:.02,breakDistance:60};function Fr(e,t,n,s){const r=[],o=[],l=[],c=[],a=yp;let u,f,d,p;const y=1.5,S=.3;s==="T"?(u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],p=[y,y,y,y,y,S,y,y,S,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]],d=[{center:{x:-1*a,y:-.5*a},vertices:[0,1,9]},{center:{x:0*a,y:-.5*a},vertices:[1,2,5,8]},{center:{x:1*a,y:-.5*a},vertices:[2,3,4,5]},{center:{x:0*a,y:.5*a},vertices:[5,6,7,8]}]):(u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],p=[y,y,S,S,y,y,y,y,y,y,y,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]],d=[{center:{x:-1*a,y:-.5*a},vertices:[0,1,2,11]},{center:{x:1*a,y:-.5*a},vertices:[3,4,5,6]},{center:{x:-1*a,y:.5*a},vertices:[9,10,11,2]},{center:{x:0*a,y:.5*a},vertices:[2,3,8,9]},{center:{x:1*a,y:.5*a},vertices:[3,6,7,8]}]);for(let g=0;g<u.length;g++){const h=u[g];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:p[g]})}const P=r.length;for(let g=0;g<P;g++){const h=(g+1)%P,x=r[h].pos.x-r[g].pos.x,C=r[h].pos.y-r[g].pos.y,R=Math.sqrt(x*x+C*C);o.push({a:g,b:h,restLength:R})}for(const[g,h]of f)if(g<P&&h<P){const x=r[h].pos.x-r[g].pos.x,C=r[h].pos.y-r[g].pos.y,R=Math.sqrt(x*x+C*C);l.push({a:g,b:h,restLength:R})}const j=gp(r);for(const g of d)c.push({center:g.center,vertexIndices:g.vertices});return{vertices:r,ringsprings:o,crossSprings:l,restArea:j,targetX:e,targetY:t,color:n,blocks:c}}function gp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function Ua(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Vm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function qm(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Zm(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Km(e,t){const n=gp(e.vertices);if(n<1)return;const s=e.restArea/n,r=Ua(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Df(e,t){return{x:e.targetX+t.center.x,y:e.targetY+t.center.y}}function Qm(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.breakDistance&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];for(const u of c.blocks)for(const f of a.blocks){const d=Df(c,u),p=Df(a,f),y=p.x-d.x,S=p.y-d.y;if(Math.sqrt(y*y+S*S)<n.attractionRadius*4)for(const j of u.vertexIndices)for(const g of f.vertexIndices){const h=`${o}-${j}-${l}-${g}`;if(r.has(h))continue;const x=c.vertices[j],C=a.vertices[g],R=C.pos.x-x.pos.x,w=C.pos.y-x.pos.y,k=Math.sqrt(R*R+w*w),m=n.attractionRadius*x.attractionRadius,M=n.attractionRadius*C.attractionRadius,I=m+M;k<I&&(s.push({blobA:o,vertA:j,blobB:l,vertB:g,restLength:n.attractionRestLength}),r.add(h))}}}return s}function Jm(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),P=(f-o.restLength)*y*.5,j=a/f*P,g=u/f*P;l.pos.x+=j,l.pos.y+=g,c.pos.x-=j,c.pos.y-=g}}function ev(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function tv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=ev(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=Ua(s),c=e.createRadialGradient(l.x-15,l.y-15,0,l.x,l.y,60);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=2,e.stroke(),n)for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function nv(e,t,n){e.strokeStyle="#f39c12",e.lineWidth=2,e.setLineDash([4,4]);for(const s of n){const r=t[s.blobA].vertices[s.vertA],o=t[s.blobB].vertices[s.vertB];e.beginPath(),e.moveTo(r.pos.x,r.pos.y),e.lineTo(o.pos.x,o.pos.y),e.stroke()}e.setLineDash([])}function sv(){const e=v.useRef(null),t=v.useRef([Fr(Mo/3,To/2,"#27ae60","T"),Fr(Mo*2/3,To/2,"#27ae60","U")]),n=v.useRef([]),s=v.useRef(0),r=v.useRef(-1),o=v.useRef(null),[l,c]=v.useState(Xm),[a,u]=v.useState(!0),[f,d]=v.useState(0),[p,y]=v.useState(0);v.useEffect(()=>{const x=e.current;if(!x)return;const C=x.getContext("2d");if(!C)return;let R=0,w=performance.now();const k=m=>{R++,m-w>1e3&&(d(R),R=0,w=m);const M=t.current;if(r.current>=0){const I=Math.min((m-r.current)/1e3,.033);n.current=Qm(M,n.current,l),y(n.current.length);for(let L=0;L<M.length;L++){const H=M[L];Vm(H,I,l);const q=L===0?{...l,homeStiffness:.3}:l;qm(H,q);for(let ee=0;ee<l.iterations;ee++)Zm(H,l),Km(H,l)}Jm(M,n.current,l)}if(r.current=m,C.fillStyle="#2c3e50",C.fillRect(0,0,x.width,x.height),a){C.lineWidth=1;for(const I of M)for(const L of I.vertices){const H=l.attractionRadius*L.attractionRadius,q=L.attractionRadius>1;C.strokeStyle=q?"rgba(243, 156, 18, 0.3)":"rgba(52, 152, 219, 0.3)",C.beginPath(),C.arc(L.pos.x,L.pos.y,H,0,Math.PI*2),C.stroke()}}a&&nv(C,M,n.current);for(const I of M)tv(C,I,a);C.fillStyle="rgba(255,255,255,0.5)",C.font="12px system-ui",C.fillText("Drag blobs to test attraction",10,20),s.current=requestAnimationFrame(k)};return s.current=requestAnimationFrame(k),()=>cancelAnimationFrame(s.current)},[l,a]);const S=v.useCallback(x=>{const C=e.current;if(!C)return;const R=C.getBoundingClientRect(),w=C.width/R.width,k=C.height/R.height,m=(x.clientX-R.left)*w,M=(x.clientY-R.top)*k,I=t.current[1],L=Ua(I.vertices),H=m-L.x,q=M-L.y;Math.sqrt(H*H+q*q)<150&&(o.current={blobIndex:1,offsetX:I.targetX-m,offsetY:I.targetY-M})},[]),P=v.useCallback(x=>{if(!o.current)return;const C=e.current;if(!C)return;const R=C.getBoundingClientRect(),w=C.width/R.width,k=C.height/R.height,m=(x.clientX-R.left)*w,M=(x.clientY-R.top)*k,I=t.current[o.current.blobIndex];I.targetX=m+o.current.offsetX,I.targetY=M+o.current.offsetY},[]),j=v.useCallback(()=>{o.current=null},[]),g=v.useCallback(()=>{t.current=[Fr(Mo/3,To/2,"#27ae60","T"),Fr(Mo*2/3,To/2,"#27ae60","U")],n.current=[],r.current=-1},[]),h=v.useCallback(x=>{const C=t.current[x];for(const R of C.vertices){const w=R.homeOffset.x,k=R.homeOffset.y;R.homeOffset.x=k,R.homeOffset.y=-w}for(const R of C.blocks){const w=R.center.x,k=R.center.y;R.center.x=k,R.center.y=-w}},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-4: Two Blobs Attraction"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:'Do vertex springs create the "reaching" effect?'}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Mo,height:To,onMouseDown:S,onMouseMove:P,onMouseUp:j,onMouseLeave:j,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"grab"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"280px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",f]}),i.jsxs("span",{children:["Springs: ",p]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("div",{style:{fontWeight:"bold",color:"#f39c12"},children:"Attraction Settings"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Attraction Radius: ",l.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:l.attractionRadius,onChange:x=>c(C=>({...C,attractionRadius:parseInt(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Rest Length: ",l.attractionRestLength,"px"]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:l.attractionRestLength,onChange:x=>c(C=>({...C,attractionRestLength:parseInt(x.target.value)}))}),i.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"0 = vertices touch"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Attraction Stiffness: ",l.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.1",step:"0.005",value:l.attractionStiffness,onChange:x=>c(C=>({...C,attractionStiffness:parseFloat(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Break Distance: ",l.breakDistance,"px"]}),i.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:l.breakDistance,onChange:x=>c(C=>({...C,breakDistance:parseInt(x.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("div",{style:{fontWeight:"bold",color:"#3498db"},children:"Blob Physics"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Home Stiffness: ",l.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.01",value:l.homeStiffness,onChange:x=>c(C=>({...C,homeStiffness:parseFloat(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Damping: ",l.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:l.damping,onChange:x=>c(C=>({...C,damping:parseFloat(x.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:a,onChange:x=>u(x.target.checked)}),i.jsx("span",{children:"Show Debug (springs, radius)"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>h(0),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate T"}),i.jsx("button",{onClick:()=>h(1),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate U"})]}),i.jsx("button",{onClick:g,style:{padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"860px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-4 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:'Drag blobs close together - watch for "reaching" effect'}),i.jsx("li",{children:"Vertices should stretch toward each other before touching"}),i.jsx("li",{children:"Orange dashed lines = attraction springs forming"}),i.jsx("li",{children:"Drag apart - springs should break cleanly"}),i.jsx("li",{children:"Success = gummy/stretchy feel, NOT magnetic snap"})]})]})]})}const mp=30,ov=600,rv=450,iv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08},Bl={none:{enabled:!1,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6},subtle:{enabled:!0,stdDeviation:10,alphaMultiplier:20,alphaOffset:-8},medium:{enabled:!0,stdDeviation:15,alphaMultiplier:24,alphaOffset:-7},aggressive:{enabled:!0,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6}};function lv(e,t){const n=[],s=[],r=mp*.45,o=8,l=12,c=[{x:-r,y:-r},{x:r,y:-r},{x:r,y:r},{x:-r,y:r}];for(let u=0;u<4;u++){const f=c[u],d={x:-Math.sign(f.x),y:-Math.sign(f.y)},p=f.x+d.x*o,y=f.y,S=f.x,P=f.y+d.y*o;u===0?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):u===1?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1}):u===2?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:P},mass:1})}for(let u=0;u<l;u++){const f=(u+1)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:f,restLength:Math.sqrt(d*d+p*p)})}for(let u=0;u<l/2;u++){const f=(u+l/2)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:Math.floor(f),restLength:Math.sqrt(d*d+p*p)})}let a=0;for(let u=0;u<l;u++){const f=(u+1)%l;a+=n[u].homeOffset.x*n[f].homeOffset.y,a-=n[f].homeOffset.x*n[u].homeOffset.y}return{vertices:n,springs:s,restArea:Math.abs(a)/2,centerOffset:{x:e,y:t}}}function $f(e,t,n,s){const r=[],o=mp;let l;n==="T"?l=[{x:-o,y:-o*.5},{x:0,y:-o*.5},{x:o,y:-o*.5},{x:0,y:o*.5}]:l=[{x:-o,y:-o*.5},{x:o,y:-o*.5},{x:-o,y:o*.5},{x:0,y:o*.5},{x:o,y:o*.5}];for(const a of l){const u=lv(a.x,a.y);r.push(u)}const c={blocks:r,targetX:e,targetY:t,rotation:0,color:s};return cv(c),c}function Li(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function cv(e){for(const t of e.blocks){const n=Li(t.centerOffset.x,t.centerOffset.y,e.rotation),s=e.targetX+n.x,r=e.targetY+n.y;for(const o of t.vertices){const l=Li(o.homeOffset.x,o.homeOffset.y,e.rotation),c=s+l.x,a=r+l.y;o.pos.x===0&&o.pos.y===0&&(o.pos={x:c,y:a},o.oldPos={x:c,y:a})}}}function av(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function uv(e,t,n){const s=Li(t.centerOffset.x,t.centerOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of t.vertices){const c=Li(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*n.homeStiffness,l.pos.y+=d*n.homeStiffness}}function fv(e,t){for(const n of e.springs){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function dv(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const u=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[u].pos.y,s-=e.vertices[u].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;let l=0,c=0;for(const a of e.vertices)l+=a.pos.x,c+=a.pos.y;l/=n,c/=n;for(const a of e.vertices){const u=a.pos.x-l,f=a.pos.y-c,d=Math.sqrt(u*u+f*f);d>1e-4&&(a.pos.x+=u/d*o,a.pos.y+=f/d*o)}}function pv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function hv(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],c=n[(r+1)%t],a=n[(r+2)%t],{cp1:u,cp2:f}=pv(o,l,c,a);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`}return s+" Z"}function xv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef(null),o=v.useRef({x:0,y:0}),[l]=v.useState(iv),[c,a]=v.useState(Bl.aggressive),[u,f]=v.useState("aggressive"),[,d]=v.useState({});v.useEffect(()=>{const h=[$f(180,250,"T","#e74c3c"),$f(380,250,"U","#e74c3c")];s.current=h},[]),v.useEffect(()=>{let h=!0;const x=C=>{if(h){n.current=C,h=!1,t.current=requestAnimationFrame(x);return}const R=Math.min((C-n.current)/1e3,.033);n.current=C;for(const w of s.current)for(const k of w.blocks){av(k,l,R),uv(w,k,l);for(let m=0;m<l.iterations;m++)fv(k,l);dv(k,l)}d({}),t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[l]);const p=v.useCallback(h=>{const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),R=h.clientX-C.left,w=h.clientY-C.top;for(let k=0;k<s.current.length;k++){const m=s.current[k],M=R-m.targetX,I=w-m.targetY;if(M*M+I*I<80*80){r.current=k,o.current={x:M,y:I},h.target.setPointerCapture(h.pointerId);break}}},[]),y=v.useCallback(h=>{if(r.current===null)return;const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),R=h.clientX-C.left-o.current.x,w=h.clientY-C.top-o.current.y;s.current[r.current].targetX=R,s.current[r.current].targetY=w},[]),S=v.useCallback(()=>{r.current=null},[]),P=h=>{const x=s.current[h];x.rotation=(x.rotation+90)%360},j=h=>{const x=Bl[h];x&&(a(x),f(h))},g=()=>{const{alphaMultiplier:h,alphaOffset:x}=c;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${h} ${x}`};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5: Goo Filter Variations"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Drag pieces to overlap. Use Rotate buttons. Both pieces are same color for merge test."}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Bl).map(h=>i.jsx("button",{onClick:()=>j(h),style:{padding:"8px 16px",background:u===h?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:u===h?"bold":"normal"},children:h.charAt(0).toUpperCase()+h.slice(1)},h))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",c.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:c.stdDeviation,onChange:h=>{a(x=>({...x,stdDeviation:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",c.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:c.alphaMultiplier,onChange:h=>{a(x=>({...x,alphaMultiplier:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",c.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:c.alphaOffset,onChange:h=>{a(x=>({...x,alphaOffset:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:c.enabled,onChange:h=>{a(x=>({...x,enabled:h.target.checked})),f(h.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>P(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>P(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"})]})]}),i.jsxs("svg",{ref:e,width:ov,height:rv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:p,onPointerMove:y,onPointerUp:S,onPointerLeave:S,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:c.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:g(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:180,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T-tetromino"}),i.jsx("text",{x:380,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U-pentomino"}),i.jsx("g",{filter:c.enabled?"url(#goo-filter)":void 0,children:s.current.map((h,x)=>h.blocks.map((C,R)=>i.jsx("path",{d:hv(C.vertices),fill:h.color,stroke:h.color,strokeWidth:2},`${x}-${R}`)))}),s.current.map((h,x)=>i.jsx("circle",{cx:h.targetX,cy:h.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${x}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Goal:"})," Find filter settings where blocks within a piece merge smoothly, AND where two pieces overlap their blocks also merge into one membrane.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test:"})," Drag the T into the U's alcove. Rotate pieces. Watch how blocks merge visually."]})]})}const yv=30,gv=600,mv=450,vv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25},zl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function Gl(e,t,n,s){const r=[],o=[],l=[],c=yv;let a,u;const f=1.5,d=.3,p=1;let y;if(n==="T")a=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],y=[f,p,p,f,p,d,f,f,d,p],u=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")a=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],y=[f,f,d,d,f,f,p,f,p,p,f,p],u=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else{const g=.08*c;a=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-g,y:-.5*c},{x:-g,y:-.5*c+g},{x:-.5*c,y:-.5*c+g},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+g},{x:g,y:-.5*c+g},{x:g,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+g,y:-.5*c},{x:.5*c+g,y:-.5*c-g},{x:-.5*c-g,y:-.5*c-g},{x:-.5*c-g,y:-.5*c},{x:-1.5*c,y:-.5*c}],y=[f,p,f,d,d,f,f,f,f,d,d,f,p,f,f,d,d,d,d,p],u=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}for(let g=0;g<a.length;g++){const h=a[g];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:y[g]})}const S=r.length;for(let g=0;g<S;g++){const h=(g+1)%S,x=r[h].homeOffset.x-r[g].homeOffset.x,C=r[h].homeOffset.y-r[g].homeOffset.y;o.push({a:g,b:h,restLength:Math.sqrt(x*x+C*C)})}for(const[g,h]of u){const x=r[h].homeOffset.x-r[g].homeOffset.x,C=r[h].homeOffset.y-r[g].homeOffset.y;l.push({a:g,b:h,restLength:Math.sqrt(x*x+C*C)})}let P=0;for(let g=0;g<S;g++){const h=(g+1)%S;P+=r[g].homeOffset.x*r[h].homeOffset.y,P-=r[h].homeOffset.x*r[g].homeOffset.y}const j=Math.abs(P)/2;return{vertices:r,ringsprings:o,crossSprings:l,restArea:j,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Sv(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Cv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function kv(e,t){for(const n of e.vertices){const s=Sv(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}}function wv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function jv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function Pv(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),C=n.attractionRadius*S.attractionRadius,R=n.attractionRadius*P.attractionRadius,w=C+R;x<w&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function Rv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,P=a/f*S*y,j=u/f*S*y;l.pos.x+=P,l.pos.y+=j,c.pos.x-=P,c.pos.y-=j}}function bv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Mv(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],c=n[(r+1)%t],a=n[(r+2)%t],{cp1:u,cp2:f}=bv(o,l,c,a);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`}return s+" Z"}function Tv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(vv),[u,f]=v.useState(zl.medium),[d,p]=v.useState("medium"),[y,S]=v.useState(!1),[,P]=v.useState({});v.useEffect(()=>{const w=[Gl(120,250,"T","#e74c3c"),Gl(300,250,"U","#e74c3c"),Gl(480,250,"Corrupt","#e74c3c")];s.current=w},[]),v.useEffect(()=>{let w=!0;const k=m=>{if(w){n.current=m,w=!1,t.current=requestAnimationFrame(k);return}const M=Math.min((m-n.current)/1e3,.033);n.current=m;for(const I of s.current){Cv(I,c,M),kv(I,c);for(let L=0;L<c.iterations;L++)wv(I,c);I.usePressure&&jv(I,c)}r.current=Pv(s.current,r.current,c),Rv(s.current,r.current,c),P({}),t.current=requestAnimationFrame(k)};return t.current=requestAnimationFrame(k),()=>cancelAnimationFrame(t.current)},[c]);const j=v.useCallback(w=>{const k=e.current;if(!k)return;const m=k.getBoundingClientRect(),M=w.clientX-m.left,I=w.clientY-m.top;for(let L=0;L<s.current.length;L++){const H=s.current[L],q=M-H.targetX,ee=I-H.targetY;if(q*q+ee*ee<80*80){o.current=L,l.current={x:q,y:ee},w.target.setPointerCapture(w.pointerId);break}}},[]),g=v.useCallback(w=>{if(o.current===null)return;const k=e.current;if(!k)return;const m=k.getBoundingClientRect(),M=w.clientX-m.left-l.current.x,I=w.clientY-m.top-l.current.y;s.current[o.current].targetX=M,s.current[o.current].targetY=I},[]),h=v.useCallback(()=>{o.current=null},[]),x=w=>{s.current[w].rotation=(s.current[w].rotation+90)%360},C=w=>{const k=zl[w];k&&(f(k),p(w))},R=()=>{const{alphaMultiplier:w,alphaOffset:k}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${w} ${k}`};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5b: Single Perimeter Shapes"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Each shape is ONE continuous soft body (not composed of blocks). Same color for merge test."}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(zl).map(w=>i.jsx("button",{onClick:()=>C(w),style:{padding:"8px 16px",background:d===w?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===w?"bold":"normal"},children:w.charAt(0).toUpperCase()+w.slice(1)},w))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",u.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:w=>{f(k=>({...k,stdDeviation:Number(w.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:w=>{f(k=>({...k,alphaMultiplier:Number(w.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:w=>{f(k=>({...k,alphaOffset:Number(w.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:u.enabled,onChange:w=>{f(k=>({...k,enabled:w.target.checked})),p(w.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:w=>a(k=>({...k,goopiness:Number(w.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance (mozzarella)"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:w=>a(k=>({...k,attractionRadius:Number(w.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How close to connect"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:w=>a(k=>({...k,attractionStiffness:Number(w.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Pull force (10%-100%)"})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:y,onChange:w=>S(w.target.checked)}),i.jsx("span",{children:"Show Springs"})]})]}),i.jsxs("svg",{ref:e,width:gv,height:mv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:j,onPointerMove:g,onPointerUp:h,onPointerLeave:h,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-5b",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:R(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:u.enabled?"url(#goo-filter-5b)":void 0,children:[r.current.map((w,k)=>{var Y,re;const m=(Y=s.current[w.blobA])==null?void 0:Y.vertices[w.vertA],M=(re=s.current[w.blobB])==null?void 0:re.vertices[w.vertB];if(!m||!M)return null;const I=M.pos.x-m.pos.x,L=M.pos.y-m.pos.y,H=Math.sqrt(I*I+L*L),q=Math.min(1,H/c.goopiness),ee=8,N=4,Q=ee-(ee-N)*q,ae=Q*1.5,W=Math.max(2,Math.ceil(H/ae)),K=[];for(let te=0;te<=W;te++){const Z=te/W,de=1-.3*Math.sin(Z*Math.PI),we=Q*de;K.push({cx:m.pos.x+I*Z,cy:m.pos.y+L*Z,r:Math.max(N*.5,we)})}return i.jsx("g",{children:K.map((te,Z)=>i.jsx("circle",{cx:te.cx,cy:te.cy,r:te.r,fill:"#e74c3c"},Z))},`tendril-${k}`)}),s.current.map((w,k)=>i.jsx("path",{d:Mv(w.vertices),fill:w.color,stroke:w.color,strokeWidth:2},k))]}),y&&r.current.map((w,k)=>{var Q,ae;const m=(Q=s.current[w.blobA])==null?void 0:Q.vertices[w.vertA],M=(ae=s.current[w.blobB])==null?void 0:ae.vertices[w.vertB];if(!m||!M)return null;const I=M.pos.x-m.pos.x,L=M.pos.y-m.pos.y,q=Math.sqrt(I*I+L*L)/c.goopiness,ee=Math.min(255,Math.floor(q*255)),N=Math.max(0,255-Math.floor(q*255));return i.jsx("line",{x1:m.pos.x,y1:m.pos.y,x2:M.pos.x,y2:M.pos.y,stroke:`rgb(${ee},${N},100)`,strokeWidth:2,opacity:.7},`spring-${k}`)}),s.current.map((w,k)=>i.jsx("circle",{cx:w.targetX,cy:w.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${k}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-5b + Attraction:"}),' Single-perimeter shapes with physics-based attraction springs. When pieces get close, springs form. Pull them apart to see the "mozzarella pull" effect  they stretch until breaking at the Goopiness distance.',i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Goopiness:"}),' Controls how far the "mozzarella strings" stretch before snapping. Higher = longer stretchy connections when pulling apart.',i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Stiffness Ramp:"})," Attraction is weak (10%) at max distance (reaching effect) and strong (100%) when close (solid merge). This creates natural-looking goop behavior.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test:"})," Drag T into U's notch, let them merge, then slowly pull apart to see the stretching effect."]})]})}const Ev=30,Av=600,_v=450,Iv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Yl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function Hl(e,t,n,s){const r=[],o=[],l=[],c=[],a=Ev;let u,f;const d=1.5,p=.3,y=1;let S;if(n==="T")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],S=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],S=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*a;u=[{x:-1.5*a,y:-1.5*a},{x:-.5*a,y:-1.5*a},{x:-.5*a,y:-.5*a},{x:-x,y:-.5*a},{x:-x,y:-.5*a+x},{x:-.5*a,y:-.5*a+x},{x:-.5*a,y:1.5*a},{x:.5*a,y:1.5*a},{x:.5*a,y:-.5*a+x},{x,y:-.5*a+x},{x,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:-1.5*a},{x:1.5*a,y:-1.5*a},{x:1.5*a,y:-.5*a},{x:.5*a+x,y:-.5*a},{x:.5*a+x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a},{x:-1.5*a,y:-.5*a}],S=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*a,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:.5*a},{x:-.5*a,y:.5*a}],S=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a}],S=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:S[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const P=r.length;for(let x=0;x<P;x++){const C=(x+1)%P,R=r[C].homeOffset.x-r[x].homeOffset.x,w=r[C].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:C,restLength:Math.sqrt(R*R+w*w)})}for(const[x,C]of f){const R=r[C].homeOffset.x-r[x].homeOffset.x,w=r[C].homeOffset.y-r[x].homeOffset.y;c.push({a:x,b:C,restLength:Math.sqrt(R*R+w*w)})}let j=0;for(let x=0;x<P;x++){const C=(x+1)%P;j+=r[x].homeOffset.x*r[C].homeOffset.y,j-=r[C].homeOffset.x*r[x].homeOffset.y}const g=Math.abs(j)/2;let h;if(n==="Corrupt"){const x=.5*a;h=[{offsetX:-a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-a},{x,y:-a},{x,y:a},{x:-x,y:a}],outerVertexIndices:[5,8,7,6]}].map(R=>{const w=R.points.map(k=>{const m=e+R.offsetX+k.x,M=t+R.offsetY+k.y;return{pos:{x:m,y:M},oldPos:{x:m,y:M},homeOffset:{x:k.x,y:k.y}}});return{...R,vertices:w,outerVertexIndices:R.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:c,restArea:g,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Br(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Lv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function Nv(e,t){for(const n of e.vertices){const s=Br(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}for(const n of e.innerVertices){const s=Br(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=c*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Br(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const c=Br(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function Ov(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Dv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function $v(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),C=n.attractionRadius*S.attractionRadius,R=n.attractionRadius*P.attractionRadius,w=C+R;x<w&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function Fv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,P=a/f*S*y,j=u/f*S*y;l.pos.x+=P,l.pos.y+=j,c.pos.x-=P,c.pos.y-=j}}function Bv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Uc(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=Bv(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function zv(e){return Uc(e.map(t=>t.pos))}function Ff(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,j=f/y,g=d/S,h=p/S,x=-j,C=P,R=-h,w=g;let k=x+R,m=C+w;const M=Math.sqrt(k*k+m*m);M<.001?(k=x,m=C):(k/=M,m/=M);const I=P*g+j*h,L=Math.sqrt((1+I)/2),H=L>.1?1/L:10,q=s[o]*.4,ee=Math.min(t,q);r.push({x:c.x+k*ee*Math.min(H,3),y:c.y+m*ee*Math.min(H,3)})}return r}function Gv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Iv),[u,f]=v.useState(Yl.medium),[d,p]=v.useState("medium"),[y,S]=v.useState(!1),[,P]=v.useState({});v.useEffect(()=>{const k=[Hl(120,250,"T","#e74c3c"),Hl(300,250,"U","#e74c3c"),Hl(480,250,"Corrupt","#e74c3c")];s.current=k},[]),v.useEffect(()=>{let k=!0;const m=M=>{if(k){n.current=M,k=!1,t.current=requestAnimationFrame(m);return}const I=Math.min((M-n.current)/1e3,.033);n.current=M;for(const L of s.current){Lv(L,c,I),Nv(L,c);for(let H=0;H<c.iterations;H++)Ov(L,c);L.usePressure&&Dv(L,c)}r.current=$v(s.current,r.current,c),Fv(s.current,r.current,c),P({}),t.current=requestAnimationFrame(m)};return t.current=requestAnimationFrame(m),()=>cancelAnimationFrame(t.current)},[c]);const j=v.useCallback(k=>{const m=e.current;if(!m)return;const M=m.getBoundingClientRect(),I=k.clientX-M.left,L=k.clientY-M.top;for(let H=0;H<s.current.length;H++){const q=s.current[H],ee=I-q.targetX,N=L-q.targetY;if(ee*ee+N*N<80*80){o.current=H,l.current={x:ee,y:N},k.target.setPointerCapture(k.pointerId);break}}},[]),g=v.useCallback(k=>{if(o.current===null)return;const m=e.current;if(!m)return;const M=m.getBoundingClientRect(),I=k.clientX-M.left-l.current.x,L=k.clientY-M.top-l.current.y;s.current[o.current].targetX=I,s.current[o.current].targetY=L},[]),h=v.useCallback(()=>{o.current=null},[]),x=k=>{s.current[k].rotation=(s.current[k].rotation+90)%360},C=k=>{const m=Yl[k];m&&(f(m),p(k))},R=()=>{const{alphaMultiplier:k,alphaOffset:m}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${k} ${m}`},w="#2c3e50";return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5c: Cell Wall (Outer - Inner)"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Outer gooey silhouette + stable inner core = visible cell wall ring"}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Yl).map(k=>i.jsx("button",{onClick:()=>C(k),style:{padding:"8px 16px",background:d===k?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===k?"bold":"normal"},children:k.charAt(0).toUpperCase()+k.slice(1)},k))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",u.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:k=>{f(m=>({...m,stdDeviation:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:k=>{f(m=>({...m,alphaMultiplier:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:k=>{f(m=>({...m,alphaOffset:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:u.enabled,onChange:k=>{f(m=>({...m,enabled:k.target.checked})),p(k.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",c.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:c.innerHomeStiffness,onChange:k=>a(m=>({...m,innerHomeStiffness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:k=>a(m=>({...m,goopiness:Number(k.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:k=>a(m=>({...m,attractionRadius:Number(k.target.value)})),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:k=>a(m=>({...m,attractionStiffness:Number(k.target.value)})),style:{width:100}})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:y,onChange:k=>S(k.target.checked)}),i.jsx("span",{children:"Show Springs"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",c.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:c.tendrilEndRadius,onChange:k=>a(m=>({...m,tendrilEndRadius:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",c.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:c.tendrilSkinniness,onChange:k=>a(m=>({...m,tendrilSkinniness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",c.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:c.wallThickness,onChange:k=>a(m=>({...m,wallThickness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),i.jsxs("svg",{ref:e,width:Av,height:_v,style:{background:w,borderRadius:8,cursor:"grab"},onPointerDown:j,onPointerMove:g,onPointerUp:h,onPointerLeave:h,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-5c",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:R(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:u.enabled?"url(#goo-filter-5c)":void 0,children:[r.current.map((k,m)=>{var Z,de;const M=(Z=s.current[k.blobA])==null?void 0:Z.vertices[k.vertA],I=(de=s.current[k.blobB])==null?void 0:de.vertices[k.vertB];if(!M||!I)return null;const L=I.pos.x-M.pos.x,H=I.pos.y-M.pos.y,q=Math.sqrt(L*L+H*H),ee=Math.min(1,q/c.goopiness),N=c.tendrilEndRadius,Q=1-c.tendrilSkinniness,ae=1-c.tendrilSkinniness*.3,W=ae-(ae-Q)*ee,K=N*W,Y=N*1.4,re=Math.max(2,Math.ceil(q/Y)),te=[];for(let we=0;we<=re;we++){const E=we/re,B=Math.sin(E*Math.PI),ve=N-(N-K)*B;te.push({cx:M.pos.x+L*E,cy:M.pos.y+H*E,r:Math.max(2,ve)})}return i.jsx("g",{children:te.map((we,E)=>i.jsx("circle",{cx:we.cx,cy:we.cy,r:we.r,fill:"#e74c3c"},E))},`tendril-${m}`)}),s.current.map((k,m)=>i.jsx("path",{d:zv(k.vertices),fill:k.color,stroke:k.color,strokeWidth:2},m))]}),s.current.map((k,m)=>{if(k.innerRegions)return k.innerRegions.map((M,I)=>{let L;M.outerVertexIndices?L=M.outerVertexIndices.map(q=>k.vertices[q].pos):L=M.vertices.map(q=>q.pos);const H=Ff(L,c.wallThickness);return i.jsx("path",{d:Uc(H),fill:w},`inner-${m}-${I}`)});{const M=k.vertices.map(L=>L.pos),I=Ff(M,c.wallThickness);return i.jsx("path",{d:Uc(I),fill:w},`inner-${m}`)}}),y&&r.current.map((k,m)=>{var ae,W;const M=(ae=s.current[k.blobA])==null?void 0:ae.vertices[k.vertA],I=(W=s.current[k.blobB])==null?void 0:W.vertices[k.vertB];if(!M||!I)return null;const L=I.pos.x-M.pos.x,H=I.pos.y-M.pos.y,ee=Math.sqrt(L*L+H*H)/c.goopiness,N=Math.min(255,Math.floor(ee*255)),Q=Math.max(0,255-Math.floor(ee*255));return i.jsx("line",{x1:M.pos.x,y1:M.pos.y,x2:I.pos.x,y2:I.pos.y,stroke:`rgb(${N},${Q},100)`,strokeWidth:2,opacity:.7},`spring-${m}`)}),s.current.map((k,m)=>i.jsx("circle",{cx:k.targetX,cy:k.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${m}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-5c: Cell Wall Model"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Two layers:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Outer"})," (gooey): Stretches, merges with filter effect",i.jsx("br",{})," ",i.jsx("strong",{children:"Inner"})," (stable): Barely moves, cuts out the center",i.jsx("br",{})," ",i.jsx("strong",{children:"Cell Wall"}),": The visible ring between them",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Inner Stiffness:"})," Controls how stable the core is (higher = more rigid)",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Next:"})," Dynamic rebuilding when pieces lock (merge walls) or become loose goop (amputate)"]})]})}const Yv=30,Hv=600,Wv=450,Uv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Wl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},Xv={autoFill:!0,fillRate:.15},Bf=1.15,Vv=200;function Ul(e,t,n,s){const r=[],o=[],l=[],c=[],a=Yv;let u,f;const d=1.5,p=.3,y=1;let S;if(n==="T")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],S=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],S=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*a;u=[{x:-1.5*a,y:-1.5*a},{x:-.5*a,y:-1.5*a},{x:-.5*a,y:-.5*a},{x:-x,y:-.5*a},{x:-x,y:-.5*a+x},{x:-.5*a,y:-.5*a+x},{x:-.5*a,y:1.5*a},{x:.5*a,y:1.5*a},{x:.5*a,y:-.5*a+x},{x,y:-.5*a+x},{x,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:-1.5*a},{x:1.5*a,y:-1.5*a},{x:1.5*a,y:-.5*a},{x:.5*a+x,y:-.5*a},{x:.5*a+x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a},{x:-1.5*a,y:-.5*a}],S=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*a,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:.5*a},{x:-.5*a,y:.5*a}],S=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a}],S=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:S[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const P=r.length;for(let x=0;x<P;x++){const C=(x+1)%P,R=r[C].homeOffset.x-r[x].homeOffset.x,w=r[C].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:C,restLength:Math.sqrt(R*R+w*w)})}for(const[x,C]of f){const R=r[C].homeOffset.x-r[x].homeOffset.x,w=r[C].homeOffset.y-r[x].homeOffset.y;c.push({a:x,b:C,restLength:Math.sqrt(R*R+w*w)})}let j=0;for(let x=0;x<P;x++){const C=(x+1)%P;j+=r[x].homeOffset.x*r[C].homeOffset.y,j-=r[C].homeOffset.x*r[x].homeOffset.y}const g=Math.abs(j)/2;let h;if(n==="Corrupt"){const x=.5*a;h=[{offsetX:-a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-a},{x,y:-a},{x,y:a},{x:-x,y:a}],outerVertexIndices:[5,8,7,6]}].map(R=>{const w=R.points.map(k=>{const m=e+R.offsetX+k.x,M=t+R.offsetY+k.y;return{pos:{x:m,y:M},oldPos:{x:m,y:M},homeOffset:{x:k.x,y:k.y}}});return{...R,vertices:w,outerVertexIndices:R.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:c,restArea:g,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt",fillAmount:0,isShaking:!1,boopScale:1,wasFullLastFrame:!1}}function zr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function qv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function Zv(e,t){for(const n of e.vertices){const s=zr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}for(const n of e.innerVertices){const s=zr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=c*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=zr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const c=zr(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function Kv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Qv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function Jv(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),C=n.attractionRadius*S.attractionRadius,R=n.attractionRadius*P.attractionRadius,w=C+R;x<w&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function e2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,P=a/f*S*y,j=u/f*S*y;l.pos.x+=P,l.pos.y+=j,c.pos.x-=P,c.pos.y-=j}}function t2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function vp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=t2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function n2(e){return vp(e.map(t=>t.pos))}function zf(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,j=f/y,g=d/S,h=p/S,x=-j,C=P,R=-h,w=g;let k=x+R,m=C+w;const M=Math.sqrt(k*k+m*m);M<.001?(k=x,m=C):(k/=M,m/=M);const I=P*g+j*h,L=Math.sqrt((1+I)/2),H=L>.1?1/L:10,q=s[o]*.4,ee=Math.min(t,q);r.push({x:c.x+k*ee*Math.min(H,3),y:c.y+m*ee*Math.min(H,3)})}return r}function s2(){var H,q,ee;const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Uv),[u,f]=v.useState(Xv),[d,p]=v.useState(Wl.medium),[y,S]=v.useState("medium"),[P,j]=v.useState(!1),[,g]=v.useState({});v.useEffect(()=>{const N=[Ul(120,250,"T","#e74c3c"),Ul(300,250,"U","#e74c3c"),Ul(480,250,"Corrupt","#e74c3c")];s.current=N},[]),v.useEffect(()=>{let N=!0;const Q=ae=>{if(N){n.current=ae,N=!1,t.current=requestAnimationFrame(Q);return}const W=Math.min((ae-n.current)/1e3,.033);n.current=ae;for(const K of s.current){qv(K,c,W),Zv(K,c);for(let re=0;re<c.iterations;re++)Kv(K,c);K.usePressure&&Qv(K,c),u.autoFill&&K.fillAmount<1&&(K.fillAmount=Math.min(1,K.fillAmount+u.fillRate*W));const Y=K.fillAmount>=1;if(Y&&!K.wasFullLastFrame&&(K.boopScale=Bf),K.wasFullLastFrame=Y,K.boopScale>1){const re=(Bf-1)/(Vv/1e3);K.boopScale=Math.max(1,K.boopScale-re*W)}}r.current=Jv(s.current,r.current,c),e2(s.current,r.current,c),g({}),t.current=requestAnimationFrame(Q)};return t.current=requestAnimationFrame(Q),()=>cancelAnimationFrame(t.current)},[c,u]);const h=v.useCallback(N=>{const Q=e.current;if(!Q)return;const ae=Q.getBoundingClientRect(),W=N.clientX-ae.left,K=N.clientY-ae.top;for(let Y=0;Y<s.current.length;Y++){const re=s.current[Y],te=W-re.targetX,Z=K-re.targetY;if(te*te+Z*Z<80*80){re.fillAmount<1&&(re.isShaking=!0,setTimeout(()=>{re.isShaking=!1,g({})},300)),o.current=Y,l.current={x:te,y:Z},N.target.setPointerCapture(N.pointerId);break}}},[]),x=v.useCallback(N=>{if(o.current===null)return;const Q=e.current;if(!Q)return;const ae=Q.getBoundingClientRect(),W=N.clientX-ae.left-l.current.x,K=N.clientY-ae.top-l.current.y;s.current[o.current].targetX=W,s.current[o.current].targetY=K},[]),C=v.useCallback(()=>{o.current=null},[]),R=N=>{s.current[N].rotation=(s.current[N].rotation+90)%360},w=()=>{for(const N of s.current)N.fillAmount=0,N.wasFullLastFrame=!1,N.boopScale=1},k=N=>{const Q=Wl[N];Q&&(p(Q),S(N))},m=()=>{const{alphaMultiplier:N,alphaOffset:Q}=d;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${N} ${Q}`},M="#2c3e50",I=N=>{let Q=1/0,ae=-1/0,W=1/0,K=-1/0;for(const Y of N)Y.x<Q&&(Q=Y.x),Y.x>ae&&(ae=Y.x),Y.y<W&&(W=Y.y),Y.y>K&&(K=Y.y);return{minX:Q,maxX:ae,minY:W,maxY:K}},L=`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  `;return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("style",{children:L}),i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-6: Fill / Pour"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:'Goop fills the cell wall container over time  visual "time to pop" mechanic'}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Wl).map(N=>i.jsx("button",{onClick:()=>k(N),style:{padding:"8px 16px",background:y===N?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:y===N?"bold":"normal"},children:N.charAt(0).toUpperCase()+N.slice(1)},N))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:"bold"},children:[i.jsx("input",{type:"checkbox",checked:u.autoFill,onChange:N=>f(Q=>({...Q,autoFill:N.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Fill Rate: ",u.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:u.fillRate,onChange:N=>f(Q=>({...Q,fillRate:Number(N.target.value)})),style:{width:120}})]}),i.jsx("button",{onClick:w,style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Fill"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:12},children:[i.jsxs("span",{children:["T: ",Math.round(((H=s.current[0])==null?void 0:H.fillAmount)*100||0),"%"]}),i.jsxs("span",{children:["U: ",Math.round(((q=s.current[1])==null?void 0:q.fillAmount)*100||0),"%"]}),i.jsxs("span",{children:["C: ",Math.round(((ee=s.current[2])==null?void 0:ee.fillAmount)*100||0),"%"]})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",d.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:d.stdDeviation,onChange:N=>{p(Q=>({...Q,stdDeviation:Number(N.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",d.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:d.alphaMultiplier,onChange:N=>{p(Q=>({...Q,alphaMultiplier:Number(N.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",d.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:d.alphaOffset,onChange:N=>{p(Q=>({...Q,alphaOffset:Number(N.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:d.enabled,onChange:N=>{p(Q=>({...Q,enabled:N.target.checked})),S(N.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>R(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>R(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>R(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",c.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:c.innerHomeStiffness,onChange:N=>a(Q=>({...Q,innerHomeStiffness:Number(N.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:N=>a(Q=>({...Q,goopiness:Number(N.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:N=>a(Q=>({...Q,attractionRadius:Number(N.target.value)})),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:N=>a(Q=>({...Q,attractionStiffness:Number(N.target.value)})),style:{width:100}})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:P,onChange:N=>j(N.target.checked)}),i.jsx("span",{children:"Show Springs"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",c.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:c.tendrilEndRadius,onChange:N=>a(Q=>({...Q,tendrilEndRadius:Number(N.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",c.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:c.tendrilSkinniness,onChange:N=>a(Q=>({...Q,tendrilSkinniness:Number(N.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",c.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:c.wallThickness,onChange:N=>a(Q=>({...Q,wallThickness:Number(N.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),i.jsxs("svg",{ref:e,width:Hv,height:Wv,style:{background:M,borderRadius:8,cursor:"grab"},onPointerDown:h,onPointerMove:x,onPointerUp:C,onPointerLeave:C,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-6",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:d.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:m(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:d.enabled?"url(#goo-filter-6)":void 0,children:[r.current.map((N,Q)=>{var se,ge;const ae=(se=s.current[N.blobA])==null?void 0:se.vertices[N.vertA],W=(ge=s.current[N.blobB])==null?void 0:ge.vertices[N.vertB];if(!ae||!W)return null;const K=W.pos.x-ae.pos.x,Y=W.pos.y-ae.pos.y,re=Math.sqrt(K*K+Y*Y),te=Math.min(1,re/c.goopiness),Z=c.tendrilEndRadius,de=1-c.tendrilSkinniness,we=1-c.tendrilSkinniness*.3,E=we-(we-de)*te,B=Z*E,ve=Z*1.4,ie=Math.max(2,Math.ceil(re/ve)),ye=[];for(let oe=0;oe<=ie;oe++){const ke=oe/ie,he=Math.sin(ke*Math.PI),Ee=Z-(Z-B)*he;ye.push({cx:ae.pos.x+K*ke,cy:ae.pos.y+Y*ke,r:Math.max(2,Ee)})}return i.jsx("g",{children:ye.map((oe,ke)=>i.jsx("circle",{cx:oe.cx,cy:oe.cy,r:oe.r,fill:"#e74c3c"},ke))},`tendril-${Q}`)}),s.current.map((N,Q)=>{const ae=N.boopScale!==1?`translate(${N.targetX}, ${N.targetY}) scale(${N.boopScale}) translate(${-N.targetX}, ${-N.targetY})`:void 0;return i.jsx("g",{transform:ae,style:N.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,children:i.jsx("path",{d:n2(N.vertices),fill:N.color,stroke:N.color,strokeWidth:2})},Q)})]}),s.current.map((N,Q)=>{const ae=N.boopScale!==1?`translate(${N.targetX}, ${N.targetY}) scale(${N.boopScale}) translate(${-N.targetX}, ${-N.targetY})`:void 0,W=N.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,K=(Y,re)=>{const te=I(Y),Z=te.maxY-te.minY,de=te.maxY-Z*N.fillAmount,we=50;return N.fillAmount>=1?null:i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:re,children:i.jsx("rect",{x:te.minX-we,y:te.minY-we,width:te.maxX-te.minX+we*2,height:de-te.minY+we})})}),i.jsx("path",{d:vp(Y),fill:M,clipPath:`url(#${re})`})]},re)};if(N.innerRegions)return i.jsx("g",{transform:ae,style:W,children:N.innerRegions.map((Y,re)=>{let te;Y.outerVertexIndices?te=Y.outerVertexIndices.map(de=>N.vertices[de].pos):te=Y.vertices.map(de=>de.pos);const Z=zf(te,c.wallThickness);return K(Z,`unfilled-clip-${Q}-${re}`)})},`inner-group-${Q}`);{const Y=N.vertices.map(te=>te.pos),re=zf(Y,c.wallThickness);return i.jsx("g",{transform:ae,style:W,children:K(re,`unfilled-clip-${Q}`)},`inner-group-${Q}`)}}),P&&r.current.map((N,Q)=>{var we,E;const ae=(we=s.current[N.blobA])==null?void 0:we.vertices[N.vertA],W=(E=s.current[N.blobB])==null?void 0:E.vertices[N.vertB];if(!ae||!W)return null;const K=W.pos.x-ae.pos.x,Y=W.pos.y-ae.pos.y,te=Math.sqrt(K*K+Y*Y)/c.goopiness,Z=Math.min(255,Math.floor(te*255)),de=Math.max(0,255-Math.floor(te*255));return i.jsx("line",{x1:ae.pos.x,y1:ae.pos.y,x2:W.pos.x,y2:W.pos.y,stroke:`rgb(${Z},${de},100)`,strokeWidth:2,opacity:.7},`spring-${Q}`)}),s.current.map((N,Q)=>i.jsx("circle",{cx:N.targetX,cy:N.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${Q}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-6: Fill / Pour"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"New mechanics:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Fill Amount"}),": Each blob has 0-100% fill level (same color as outer goop)",i.jsx("br",{})," ",i.jsx("strong",{children:"Auto-Fill"}),": Fill rises over time (adjustable rate)",i.jsx("br",{})," ",i.jsx("strong",{children:"Shake on early click"}),": Click before 100% and the goop shakes",i.jsx("br",{})," ",i.jsx("strong",{children:"Boop at 100%"}),": Scale pulse from center when fill completes",i.jsx("br",{})," ",i.jsx("strong",{children:"Reset"}),": Empty all containers to start over",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Game implication:"})," Player must clear goop before it fills to 100% (pop!)",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Next:"})," Proto-7 (Pop)  what happens when fill reaches 100%?"]})]})}const Pn=6,it=8,yt=50,Dn=50,$n=50,o2=Pn*yt+Dn*2,r2=it*yt+$n*2,i2={damping:.97,stiffness:1,pressure:5,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Xl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},l2={autoFill:!0,fillRate:.15},Gf=1.15,c2=200,a2=200,Gr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function u2(e,t){return{x:Dn+(e+.5)*yt,y:$n+(t+.5)*yt}}function oi(e,t){return{x:Dn+e*yt,y:$n+t*yt}}function Ni(e){let t=0,n=0;for(const s of e){const r=u2(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function f2(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function d2(e){if(e.length===0)return[];const t=new Map;for(const l of e){const c=`${l.x1},${l.y1}`,a=`${l.x2},${l.y2}`;t.has(c)||t.set(c,[]),t.has(a)||t.set(a,[]),t.get(c).push(l),t.get(a).push(l)}const n=new Set,s=[];let r=e[0],o={x:r.x1,y:r.y1};for(;n.size<e.length;){n.add(r),s.push(oi(o.x,o.y));const l=o.x===r.x1&&o.y===r.y1?{x:r.x2,y:r.y2}:{x:r.x1,y:r.y1},c=`${l.x},${l.y}`,u=(t.get(c)||[]).find(f=>!n.has(f));if(!u)break;r=u,o=l}return s}let Sp=0;function Yr(e,t,n){const s=`blob-${Sp++}`,r=f2(e),o=d2(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const j=Ni(e),g=yt*.4;o.push({x:j.x-g,y:j.y-g},{x:j.x+g,y:j.y-g},{x:j.x+g,y:j.y+g},{x:j.x-g,y:j.y+g})}const l=Ni(e),c=o.map(j=>({pos:{x:j.x,y:j.y},oldPos:{x:j.x,y:j.y},homeOffset:{x:j.x-l.x,y:j.y-l.y},mass:1,attractionRadius:1})),a=o.map(j=>({pos:{x:j.x,y:j.y},oldPos:{x:j.x,y:j.y},homeOffset:{x:j.x-l.x,y:j.y-l.y}})),u=[],f=c.length;for(let j=0;j<f;j++){const g=(j+1)%f,h=c[g].homeOffset.x-c[j].homeOffset.x,x=c[g].homeOffset.y-c[j].homeOffset.y;u.push({a:j,b:g,restLength:Math.sqrt(h*h+x*x)})}const d=[],p=yt*1.5,y=new Set;for(let j=0;j<f;j++)for(let g=j+2;g<f;g++){if(g===f-1&&j===0)continue;const h=c[g].homeOffset.x-c[j].homeOffset.x,x=c[g].homeOffset.y-c[j].homeOffset.y,C=Math.sqrt(h*h+x*x);if(C<p){const R=`${Math.min(j,g)}-${Math.max(j,g)}`;y.has(R)||(y.add(R),d.push({a:j,b:g,restLength:C}))}}let S=0;for(let j=0;j<f;j++){const g=(j+1)%f;S+=c[j].homeOffset.x*c[g].homeOffset.y,S-=c[g].homeOffset.x*c[j].homeOffset.y}const P=Math.abs(S)/2;return{id:s,vertices:c,innerVertices:a,ringsprings:u,crossSprings:d,restArea:P,targetX:l.x,targetY:l.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,boopScale:1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function p2(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const c of n){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const c of s){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const h2={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Yf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function x2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function y2(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Yf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Yf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function g2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function m2(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function v2(e){const t=Dn,n=Dn+Pn*yt,s=$n,r=$n+it*yt,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function S2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),C=n.attractionRadius*S.attractionRadius,R=n.attractionRadius*P.attractionRadius,w=C+R;x<w&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function C2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),P=s+S*(r-s),j=p-o.restLength,g=f/p*j*P,h=d/p*j*P;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function k2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Cp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=k2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function w2(e){return Cp(e.map(t=>t.pos))}function j2(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,j=f/y,g=d/S,h=p/S,x=-j,C=P,R=-h,w=g;let k=x+R,m=C+w;const M=Math.sqrt(k*k+m*m);M<.001?(k=x,m=C):(k/=M,m/=M);const I=P*g+j*h,L=Math.sqrt((1+I)/2),H=L>.1?1/L:10,q=s[o]*.4,ee=Math.min(t,q);r.push({x:c.x+k*ee*Math.min(H,3),y:c.y+m*ee*Math.min(H,3)})}return r}function P2(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(a2),[f,d]=v.useState(i2),[p,y]=v.useState(l2),[S,P]=v.useState(Xl.medium),[j,g]=v.useState("medium"),[h,x]=v.useState(!0),[C,R]=v.useState(Gr[0]),[w,k]=v.useState("T"),[,m]=v.useState({}),[M,I]=v.useState(5),[L,H]=v.useState(1.5),q=v.useRef(M),ee=v.useRef(L);q.current=M,ee.current=L,v.useEffect(()=>{const E=[];for(let ge=0;ge<it;ge++){E[ge]=[];for(let oe=0;oe<Pn;oe++)E[ge][oe]=null}r.current=E;const B=[],ve=[{x:0,y:it-1},{x:1,y:it-1},{x:2,y:it-1},{x:1,y:it-2}],ie=Yr(ve,Gr[0],!0);B.push(ie);for(const ge of ve)E[ge.y][ge.x]={blobId:ie.id,color:ie.color};const ye=[{x:4,y:it-1},{x:5,y:it-1},{x:4,y:it-2},{x:5,y:it-2}],se=Yr(ye,Gr[1],!0);B.push(se);for(const ge of ye)E[ge.y][ge.x]={blobId:se.id,color:se.color};s.current=B},[]),v.useEffect(()=>{let E=!0;const B=ve=>{var ye,se,ge;if(E){n.current=ve,E=!1,t.current=requestAnimationFrame(B);return}const ie=Math.min((ve-n.current)/1e3,.033);n.current=ve;for(const oe of s.current){x2(oe,f,ie),y2(oe,f);for(let he=0;he<f.iterations;he++)g2(oe,f);oe.usePressure&&m2(oe,f),v2(oe),oe.isLocked&&p.autoFill&&oe.fillAmount<1&&(oe.fillAmount=Math.min(1,oe.fillAmount+p.fillRate*ie));const ke=oe.fillAmount>=1;if(ke&&!oe.wasFullLastFrame&&(oe.boopScale=Gf),oe.wasFullLastFrame=ke,oe.boopScale>1){const he=(Gf-1)/(c2/1e3);oe.boopScale=Math.max(1,oe.boopScale-he*ie)}}if(l.current!==null){const oe=s.current[l.current];if(oe&&!oe.isLocked){let ke=it-1;for(const Ie of oe.gridCells){let O=Ie.y;for(;O<it-1;){const D=O+1,F=(ye=r.current[D])==null?void 0:ye[Ie.x];if(F&&F.blobId!==oe.id)break;O=D}O-Ie.y+oe.gridCells[0].y;const G=O-Ie.y;Ie.y+G-Ie.y<ke-oe.gridCells[0].y}let he=it;for(const Ie of oe.gridCells){let O=0;for(;Ie.y+O+1<it;){const G=Ie.y+O+1,Ce=(se=r.current[G])==null?void 0:se[Ie.x];if(Ce&&Ce.blobId!==oe.id)break;O++}he=Math.min(he,O)}const Ee=he*yt,Ge=a*ie,$e=Math.min(oe.visualOffsetY+Ge,Ee);for(oe.visualOffsetY=$e;oe.visualOffsetY>=yt;){for(const Ie of oe.gridCells)Ie.y+=1;oe.visualOffsetY-=yt}const Fe=Ni(oe.gridCells);oe.targetY=Fe.y+oe.visualOffsetY;let Ne=!0;for(const Ie of oe.gridCells){const O=Ie.y+1;if(O>=it){Ne=!1;break}const G=(ge=r.current[O])==null?void 0:ge[Ie.x];if(G&&G.blobId!==oe.id){Ne=!1;break}}!Ne&&oe.visualOffsetY<.1&&(oe.visualOffsetY=0,oe.targetY=Fe.y,c.current=!0)}}o.current=S2(s.current,o.current,f),C2(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,W()),m({}),t.current=requestAnimationFrame(B)};return t.current=requestAnimationFrame(B),()=>cancelAnimationFrame(t.current)},[f,p,a]);const N=v.useCallback((E,B)=>{var ve;return B<0||B>=it||E<0||E>=Pn?!0:((ve=r.current[B])==null?void 0:ve[E])!==null},[]),Q=v.useCallback((E,B)=>{const ve=new Set,ie=r.current;for(const ye of E){const se=[{x:ye.x-1,y:ye.y},{x:ye.x+1,y:ye.y},{x:ye.x,y:ye.y-1},{x:ye.x,y:ye.y+1}];for(const ge of se)if(ge.y>=0&&ge.y<it&&ge.x>=0&&ge.x<Pn){const oe=ie[ge.y][ge.x];oe&&oe.color===B&&ve.add(oe.blobId)}}return ve},[]),ae=v.useCallback(E=>{var se,ge,oe;const B=q.current,ve=ee.current,ie=[];for(const ke of E.gridCells){const he=ke.y+1;he<it&&((se=r.current[he])!=null&&se[ke.x])&&ie.push(oi(ke.x+.5,ke.y+1)),ke.x>0&&((ge=r.current[ke.y])!=null&&ge[ke.x-1])&&ie.push(oi(ke.x,ke.y+.5)),ke.x<Pn-1&&((oe=r.current[ke.y])!=null&&oe[ke.x+1])&&ie.push(oi(ke.x+1,ke.y+.5))}if(ie.length===0)return;const ye=yt*ve;for(const ke of s.current)if(ke.id!==E.id){for(const he of ke.vertices){let Ee=1/0,Ge=null;for(const $e of ie){const Fe=he.pos.x-$e.x,Ne=he.pos.y-$e.y,Ie=Math.sqrt(Fe*Fe+Ne*Ne);Ie<Ee&&(Ee=Ie,Ge=$e)}if(Ee<ye&&Ge){const $e=1-Ee/ye,Fe=B*$e*$e,Ne=(he.pos.x-Ge.x)/(Ee+.1),Ie=(he.pos.y-Ge.y)/(Ee+.1);he.oldPos.x-=Ne*Fe,he.oldPos.y-=Ie*Fe*.5}}for(const he of ke.innerVertices){let Ee=1/0,Ge=null;for(const $e of ie){const Fe=he.pos.x-$e.x,Ne=he.pos.y-$e.y,Ie=Math.sqrt(Fe*Fe+Ne*Ne);Ie<Ee&&(Ee=Ie,Ge=$e)}if(Ee<ye&&Ge){const $e=1-Ee/ye,Fe=B*$e*$e*.3,Ne=(he.pos.x-Ge.x)/(Ee+.1),Ie=(he.pos.y-Ge.y)/(Ee+.1);he.oldPos.x-=Ne*Fe,he.oldPos.y-=Ie*Fe*.5}}}},[]),W=v.useCallback(()=>{if(l.current===null)return;const E=s.current[l.current];if(!E)return;ae(E),E.visualOffsetY=0;const B=Ni(E.gridCells);E.targetY=B.y;const ve=Q(E.gridCells,E.color);if(ve.size>0){const ie=[...E.gridCells],ye=[E],se=[E.id];for(const oe of ve){const ke=s.current.find(he=>he.id===oe);ke&&(ie.push(...ke.gridCells),ye.push(ke),se.push(oe))}const ge=Yr(ie,E.color,!0);p2(ge,ye);for(const oe of ie)r.current[oe.y][oe.x]={blobId:ge.id,color:ge.color};s.current=s.current.filter(oe=>!se.includes(oe.id)),s.current.push(ge),console.log(`Merged ${se.length} blobs into one with ${ie.length} cells`)}else{E.isLocked=!0,E.fillAmount=0,E.wasFullLastFrame=!1;for(const ie of E.gridCells)r.current[ie.y][ie.x]={blobId:E.id,color:E.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[Q,ae]),K=v.useCallback(()=>{if(l.current!==null)return;const E=h2[w],B=Math.floor((Pn-4)/2),ve=0,ie=E.map(se=>({x:se.x+B,y:se.y+ve}));for(const se of ie)if(N(se.x,se.y)){console.log("Cannot spawn - space occupied");return}const ye=Yr(ie,C,!1);ye.visualOffsetY=0,s.current.push(ye),l.current=s.current.length-1},[w,C,N]),Y=v.useCallback(()=>{var B;if(l.current===null)return;const E=s.current[l.current];if(E){for(;;){let ve=!0;for(const ie of E.gridCells){const ye=ie.y+1;if(ye>=it){ve=!1;break}const se=(B=r.current[ye])==null?void 0:B[ie.x];if(se&&se.blobId!==E.id){ve=!1;break}}if(!ve)break;for(const ie of E.gridCells)ie.y+=1}E.visualOffsetY=0,W()}},[W]),re=v.useCallback(()=>{l.current=null,c.current=!1;for(let E=0;E<it;E++)for(let B=0;B<Pn;B++)r.current[E][B]=null;s.current=[],Sp=0,o.current=[]},[]),te=E=>{const B=Xl[E];B&&(P(B),g(E))},Z=()=>{const{alphaMultiplier:E,alphaOffset:B}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${E} ${B}`},de="#2c3e50",we=E=>{let B=1/0,ve=-1/0,ie=1/0,ye=-1/0;for(const se of E)se.x<B&&(B=se.x),se.x>ve&&(ve=se.x),se.y<ie&&(ie=se.y),se.y>ye&&(ye=se.y);return{minX:B,maxX:ve,minY:ie,maxY:ye}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-7: Merge"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Dynamic blob generation when pieces lock  same-color merge with unified fill layer"}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Gr.map((E,B)=>i.jsx("button",{onClick:()=>R(E),style:{width:30,height:30,background:E,border:C===E?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},E)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(E=>i.jsx("button",{onClick:()=>k(E),style:{padding:"6px 12px",background:w===E?"#fff":"#2c3e50",color:w===E?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:E},E))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:K,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:Y,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:re,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:E=>x(E.target.checked)}),i.jsx("span",{children:"Show Grid"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Xl).map(E=>i.jsx("button",{onClick:()=>te(E),style:{padding:"6px 12px",background:j===E?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:j===E?"bold":"normal",fontSize:12},children:E.charAt(0).toUpperCase()+E.slice(1)},E))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:E=>y(B=>({...B,fillRate:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:E=>u(Number(E.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:E=>d(B=>({...B,wallThickness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:E=>y(B=>({...B,autoFill:E.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:E=>d(B=>({...B,damping:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:E=>d(B=>({...B,stiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:f.pressure,onChange:E=>d(B=>({...B,pressure:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:E=>d(B=>({...B,homeStiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:E=>d(B=>({...B,innerHomeStiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:E=>d(B=>({...B,returnSpeed:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:E=>d(B=>({...B,viscosity:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:E=>d(B=>({...B,iterations:Number(E.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",M]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:M,onChange:E=>I(Number(E.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",L.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:L,onChange:E=>H(Number(E.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:E=>d(B=>({...B,goopiness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:E=>d(B=>({...B,attractionRadius:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:E=>d(B=>({...B,attractionStiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:E=>d(B=>({...B,tendrilEndRadius:Number(E.target.value)})),style:{width:80}})]})]}),i.jsxs("svg",{ref:e,width:o2,height:r2,style:{background:de,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Z(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:Pn+1}).map((E,B)=>i.jsx("line",{x1:Dn+B*yt,y1:$n,x2:Dn+B*yt,y2:$n+it*yt,stroke:"#fff",strokeWidth:1},`v${B}`)),Array.from({length:it+1}).map((E,B)=>i.jsx("line",{x1:Dn,y1:$n+B*yt,x2:Dn+Pn*yt,y2:$n+B*yt,stroke:"#fff",strokeWidth:1},`h${B}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((E,B)=>{const ve=s.current[E.blobA],ie=s.current[E.blobB];if(!ve||!ie)return null;const ye=ve.vertices[E.vertA],se=ie.vertices[E.vertB];if(!ye||!se)return null;const ge=se.pos.x-ye.pos.x,oe=se.pos.y-ye.pos.y,ke=Math.sqrt(ge*ge+oe*oe),he=Math.min(1,ke/f.goopiness),Ee=f.tendrilEndRadius,Ge=1-f.tendrilSkinniness,$e=1-f.tendrilSkinniness*.3,Fe=$e-($e-Ge)*he,Ne=Ee*Fe,Ie=Ee*1.4,O=Math.max(2,Math.ceil(ke/Ie)),G=[];for(let Ce=0;Ce<=O;Ce++){const D=Ce/O,F=Math.sin(D*Math.PI),T=Ee-(Ee-Ne)*F;G.push({cx:ye.pos.x+ge*D,cy:ye.pos.y+oe*D,r:Math.max(2,T)})}return i.jsx("g",{children:G.map((Ce,D)=>i.jsx("circle",{cx:Ce.cx,cy:Ce.cy,r:Ce.r,fill:ve.color},D))},`tendril-${B}`)}),s.current.map((E,B)=>{const ve=E.boopScale!==1?`translate(${E.targetX}, ${E.targetY}) scale(${E.boopScale}) translate(${-E.targetX}, ${-E.targetY})`:void 0;return i.jsx("g",{transform:ve,children:i.jsx("path",{d:w2(E.vertices),fill:E.color,stroke:E.color,strokeWidth:2})},E.id)})]}),s.current.map(E=>{if(!E.isLocked||E.fillAmount>=1)return null;const B=E.boopScale!==1?`translate(${E.targetX}, ${E.targetY}) scale(${E.boopScale}) translate(${-E.targetX}, ${-E.targetY})`:void 0,ve=E.vertices.map(he=>he.pos),ie=j2(ve,f.wallThickness),ye=we(ie),se=ye.maxY-ye.minY,ge=ye.maxY-se*E.fillAmount,oe=50,ke=`unfilled-clip-${E.id}`;return i.jsxs("g",{transform:B,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:ke,children:i.jsx("rect",{x:ye.minX-oe,y:ye.minY-oe,width:ye.maxX-ye.minX+oe*2,height:ge-ye.minY+oe})})}),i.jsx("path",{d:Cp(ie),fill:de,clipPath:`url(#${ke})`})]},`inner-${E.id}`)}),s.current.map((E,B)=>i.jsx("text",{x:E.targetX,y:E.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:E.isLocked?`${Math.round(E.fillAmount*100)}%`:"falling"},`info-${E.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-7: Merge"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test scenarios:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Same color adjacent"}),": Blobs merge into one, unified fill restarts",i.jsx("br",{})," ",i.jsx("strong",{children:"Different color"}),": No merge, just neighbors",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Current pieces:"})," ",s.current.length," blobs",i.jsx("br",{}),i.jsx("strong",{children:"Attraction springs:"})," ",o.current.length]})]})}const Rn=6,lt=8,at=50,hn=50,xn=50,R2=Rn*at+hn*2,b2=lt*at+xn*2,M2={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Vl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},T2={autoFill:!0,fillRate:.15},E2=4,A2=200,Hr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function _2(e,t){return{x:hn+(e+.5)*at,y:xn+(t+.5)*at}}function ri(e,t){return{x:hn+e*at,y:xn+t*at}}function Oi(e){let t=0,n=0;for(const s of e){const r=_2(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function I2(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function L2(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(ri(c.x,c.y));const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(j=>!r.has(j));if(y.length===0)break;let S=y[0],P=1/0;for(const j of y){const g=n(j,u),h=s(a,g);(h>P||P===1/0)&&(P=h,S=j)}l=S,c=u}return o}let kp=0;function Wr(e,t,n){const s=`blob-${kp++}`,r=I2(e),o=L2(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Oi(e),x=at*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const c=Oi(e),a=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y}})),f=[],d=a.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=a[x].homeOffset.x-a[h].homeOffset.x,R=a[x].homeOffset.y-a[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+R*R)})}const p=[],y=at*1.5,S=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=a[x].homeOffset.x-a[h].homeOffset.x,R=a[x].homeOffset.y-a[h].homeOffset.y,w=Math.sqrt(C*C+R*R);if(w<y){const k=`${Math.min(h,x)}-${Math.max(h,x)}`;S.has(k)||(S.add(k),p.push({a:h,b:x,restLength:w}))}}let P=0;for(let h=0;h<d;h++){const x=(h+1)%d;P+=a[h].homeOffset.x*a[x].homeOffset.y,P-=a[x].homeOffset.x*a[h].homeOffset.y}const j=P>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${P.toFixed(0)}, winding=${j}, cells=${e.length}`);const g=Math.abs(P)/2;return{id:s,vertices:a,innerVertices:u,ringsprings:f,crossSprings:p,restArea:g,targetX:c.x,targetY:c.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function N2(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const c of n){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const c of s){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const O2={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Hf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function D2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function $2(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Hf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Hf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function F2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function B2(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,c=o.pos.y-s,a=Math.sqrt(l*l+c*c),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(a>1e-4&&u>1e-4){const d=(u-a)*r;o.pos.x+=l/a*d,o.pos.y+=c/a*d}}}function z2(e){const t=hn,n=hn+Rn*at,s=xn,r=xn+lt*at,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function G2(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color===a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>at*4))for(const p of c.vertices)for(const y of a.vertices){const S=y.pos.x-p.pos.x,P=y.pos.y-p.pos.y,j=Math.sqrt(S*S+P*P);if(j<20&&j>.01){const g=20-j,h=S/j,x=P/j,C=g*.8;p.pos.x-=h*C*.5,p.pos.y-=x*C*.5,y.pos.x+=h*C*.5,y.pos.y+=x*C*.5,p.oldPos.x-=h*C*.3,p.oldPos.y-=x*C*.3,y.oldPos.x+=h*C*.3,y.oldPos.y+=x*C*.3}}}}function Y2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),C=n.attractionRadius*S.attractionRadius,R=n.attractionRadius*P.attractionRadius,w=C+R;x<w&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function H2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),P=s+S*(r-s),j=p-o.restLength,g=f/p*j*P,h=d/p*j*P;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function W2(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,c=n[(r+1)%s].pos,a=l.x-o.x,u=l.y-o.y,f=c.x-l.x,d=c.y-l.y,p=Math.sqrt(a*a+u*u)||1,y=Math.sqrt(f*f+d*d)||1,S=a/p,P=u/p,j=f/y,g=d/y,h=P,x=-S,C=g,R=-j;let w=h+C,k=x+R;const m=Math.sqrt(w*w+k*k)||1;w/=m,k/=m,n[r].oldPos.x-=w*t,n[r].oldPos.y-=k*t}}function U2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function wp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=U2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function X2(e){return wp(e.map(t=>t.pos))}function V2(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,j=f/y,g=d/S,h=p/S,x=-j,C=P,R=-h,w=g;let k=x+R,m=C+w;const M=Math.sqrt(k*k+m*m);M<.001?(k=x,m=C):(k/=M,m/=M);const I=P*g+j*h,L=Math.sqrt((1+I)/2),H=L>.1?1/L:10,q=s[o]*.4,ee=Math.min(t,q);r.push({x:c.x+k*ee*Math.min(H,3),y:c.y+m*ee*Math.min(H,3)})}return r}function q2(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(A2),[f,d]=v.useState(M2),[p,y]=v.useState(T2),[S,P]=v.useState(Vl.medium),[j,g]=v.useState("medium"),[h,x]=v.useState(!0),[C,R]=v.useState(Hr[0]),[w,k]=v.useState("T"),[,m]=v.useState({}),[M,I]=v.useState(5),[L,H]=v.useState(1.5),q=v.useRef(M),ee=v.useRef(L);q.current=M,ee.current=L;const N=v.useRef([]),Q=v.useRef(0),[ae,W]=v.useState(12),[K,Y]=v.useState(150),[re,te]=v.useState(1),[Z,de]=v.useState(8),[we,E]=v.useState(!1),B="proto8-dev-settings";v.useEffect(()=>{const O=localStorage.getItem(B);if(O)try{const G=JSON.parse(O);G.physics&&d(G.physics),G.fillParams&&y(G.fillParams),G.filterParams&&(P(G.filterParams),g("custom")),G.fallSpeed&&u(G.fallSpeed),G.impactStrength&&I(G.impactStrength),G.impactRadius&&H(G.impactRadius),G.dropletCount&&W(G.dropletCount),G.dropletSpeed&&Y(G.dropletSpeed),G.dropletLifetime&&te(G.dropletLifetime),G.dropletSize&&de(G.dropletSize),console.log("Loaded dev settings from localStorage")}catch(G){console.warn("Failed to load dev settings:",G)}},[]),v.useEffect(()=>{const O=G=>{G.key==="`"&&(G.preventDefault(),E(Ce=>!Ce))};return window.addEventListener("keydown",O),()=>window.removeEventListener("keydown",O)},[]);const ve=v.useCallback(()=>{const O={physics:f,fillParams:p,filterParams:S,fallSpeed:a,impactStrength:M,impactRadius:L,dropletCount:ae,dropletSpeed:K,dropletLifetime:re,dropletSize:Z};localStorage.setItem(B,JSON.stringify(O)),console.log("Saved dev settings to localStorage")},[f,p,S,a,M,L,ae,K,re,Z]),ie=v.useCallback(()=>{const O=[];for(let $=0;$<lt;$++){O[$]=[];for(let V=0;V<Rn;V++)O[$][V]=null}r.current=O,kp=0;const G=[],Ce=[{x:0,y:lt-1},{x:1,y:lt-1},{x:2,y:lt-1},{x:1,y:lt-2}],D=Wr(Ce,Hr[0],!0);G.push(D);for(const $ of Ce)O[$.y][$.x]={blobId:D.id,color:D.color};const F=[{x:4,y:lt-1},{x:5,y:lt-1},{x:4,y:lt-2},{x:5,y:lt-2}],T=Wr(F,Hr[1],!0);G.push(T);for(const $ of F)O[$.y][$.x]={blobId:T.id,color:T.color};s.current=G,o.current=[],N.current=[],l.current=null,c.current=!1},[]);v.useEffect(()=>{ie()},[ie]),v.useEffect(()=>{let O=!0;const G=Ce=>{var le,b,_;if(O){n.current=Ce,O=!1,t.current=requestAnimationFrame(G);return}const D=Math.min((Ce-n.current)/1e3,.033);n.current=Ce;for(const A of s.current){D2(A,f,D),$2(A,f);for(let z=0;z<f.iterations;z++)F2(A,f);A.usePressure&&B2(A,f),z2(A)}G2(s.current);for(const A of s.current){A.isLocked&&p.autoFill&&A.fillAmount<1&&(A.fillAmount=Math.min(1,A.fillAmount+p.fillRate*D));const z=A.fillAmount>=1;z&&!A.wasFullLastFrame&&W2(A,E2),A.wasFullLastFrame=z}if(l.current!==null){const A=s.current[l.current];if(A&&!A.isLocked){let z=lt-1;for(const je of A.gridCells){let Le=je.y;for(;Le<lt-1;){const _e=Le+1,We=(le=r.current[_e])==null?void 0:le[je.x];if(We&&We.blobId!==A.id)break;Le=_e}Le-je.y+A.gridCells[0].y;const De=Le-je.y;je.y+De-je.y<z-A.gridCells[0].y}let X=lt;for(const je of A.gridCells){let Le=0;for(;je.y+Le+1<lt;){const De=je.y+Le+1,Pe=(b=r.current[De])==null?void 0:b[je.x];if(Pe&&Pe.blobId!==A.id)break;Le++}X=Math.min(X,Le)}const J=X*at,ne=a*D,ue=Math.min(A.visualOffsetY+ne,J);for(A.visualOffsetY=ue;A.visualOffsetY>=at;){for(const je of A.gridCells)je.y+=1;A.visualOffsetY-=at}const pe=Oi(A.gridCells);A.targetY=pe.y+A.visualOffsetY;let Te=!0;for(const je of A.gridCells){const Le=je.y+1;if(Le>=lt){Te=!1;break}const De=(_=r.current[Le])==null?void 0:_[je.x];if(De&&De.blobId!==A.id){Te=!1;break}}!Te&&A.visualOffsetY<.1&&(A.visualOffsetY=0,A.targetY=pe.y,c.current=!0)}}o.current=Y2(s.current,o.current,f),H2(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,ke());const F=300,T=hn,$=hn+Rn*at,V=xn,U=xn+lt*at;for(const A of N.current)A.vel.y+=F*D,A.pos.x+=A.vel.x*D,A.pos.y+=A.vel.y*D,(A.pos.x+A.radius<T||A.pos.x-A.radius>$)&&(A.lifetime=0),A.pos.y+A.radius<V&&(A.lifetime=0),A.pos.y+A.radius>U&&(A.pos.y=U-A.radius,A.vel.y*=-.3),A.lifetime-=D,A.opacity=Math.max(0,A.lifetime/A.maxLifetime),A.radius*=.995;N.current=N.current.filter(A=>A.lifetime>0&&A.opacity>.01),m({}),t.current=requestAnimationFrame(G)};return t.current=requestAnimationFrame(G),()=>cancelAnimationFrame(t.current)},[f,p,a]);const ye=v.useCallback((O,G)=>{var Ce;return G<0||G>=lt||O<0||O>=Rn?!0:((Ce=r.current[G])==null?void 0:Ce[O])!==null},[]),se=v.useCallback((O,G)=>{const Ce=new Set,D=r.current;for(const F of O){const T=[{x:F.x-1,y:F.y},{x:F.x+1,y:F.y},{x:F.x,y:F.y-1},{x:F.x,y:F.y+1}];for(const $ of T)if($.y>=0&&$.y<lt&&$.x>=0&&$.x<Rn){const V=D[$.y][$.x];V&&V.color===G&&Ce.add(V.blobId)}}return Ce},[]),ge=v.useCallback(O=>{var T,$,V;const G=q.current,Ce=ee.current,D=[];for(const U of O.gridCells){const le=U.y+1;le<lt&&((T=r.current[le])!=null&&T[U.x])&&D.push(ri(U.x+.5,U.y+1)),U.x>0&&(($=r.current[U.y])!=null&&$[U.x-1])&&D.push(ri(U.x,U.y+.5)),U.x<Rn-1&&((V=r.current[U.y])!=null&&V[U.x+1])&&D.push(ri(U.x+1,U.y+.5))}if(D.length===0)return;const F=at*Ce;for(const U of s.current)if(U.id!==O.id){for(const le of U.vertices){let b=1/0,_=null;for(const A of D){const z=le.pos.x-A.x,X=le.pos.y-A.y,J=Math.sqrt(z*z+X*X);J<b&&(b=J,_=A)}if(b<F&&_){const A=1-b/F,z=G*A*A,X=(le.pos.x-_.x)/(b+.1),J=(le.pos.y-_.y)/(b+.1);le.oldPos.x-=X*z,le.oldPos.y-=J*z*.5}}for(const le of U.innerVertices){let b=1/0,_=null;for(const A of D){const z=le.pos.x-A.x,X=le.pos.y-A.y,J=Math.sqrt(z*z+X*X);J<b&&(b=J,_=A)}if(b<F&&_){const A=1-b/F,z=G*A*A*.3,X=(le.pos.x-_.x)/(b+.1),J=(le.pos.y-_.y)/(b+.1);le.oldPos.x-=X*z,le.oldPos.y-=J*z*.5}}}},[]),oe=v.useCallback(O=>{var D,F;const G=O.targetX,Ce=O.targetY;for(let T=0;T<ae;T++){const $=Math.floor(Math.random()*O.vertices.length),V=O.vertices[$],U=V.pos.x-G,le=V.pos.y-Ce,b=Math.atan2(le,U)+(Math.random()-.5)*.8,_=K*(.5+Math.random()*.8),A={id:`droplet-${Q.current++}`,pos:{x:V.pos.x,y:V.pos.y},vel:{x:Math.cos(b)*_,y:Math.sin(b)*_-50},radius:Z*(.5+Math.random()*.7),color:O.color,opacity:1,lifetime:re*(.7+Math.random()*.6),maxLifetime:re};N.current.push(A),console.log("Created droplet:",A.pos,A.radius,A.color)}for(const T of O.gridCells)((F=(D=r.current[T.y])==null?void 0:D[T.x])==null?void 0:F.blobId)===O.id&&(r.current[T.y][T.x]=null);s.current=s.current.filter(T=>T.id!==O.id),console.log(`Popped blob with ${O.gridCells.length} cells, spawned ${N.current.length} droplets total`)},[ae,K,re,Z]),ke=v.useCallback(()=>{if(l.current===null)return;const O=s.current[l.current];if(!O)return;ge(O),O.visualOffsetY=0;const G=Oi(O.gridCells);O.targetY=G.y;const Ce=se(O.gridCells,O.color);if(Ce.size>0){const D=[...O.gridCells],F=[O],T=[O.id];for(const V of Ce){const U=s.current.find(le=>le.id===V);U&&(D.push(...U.gridCells),F.push(U),T.push(V))}const $=Wr(D,O.color,!0);N2($,F);for(const V of D)r.current[V.y][V.x]={blobId:$.id,color:$.color};s.current=s.current.filter(V=>!T.includes(V.id)),s.current.push($),console.log(`Merged ${T.length} blobs into one with ${D.length} cells`)}else{O.isLocked=!0,O.fillAmount=0,O.wasFullLastFrame=!1;for(const D of O.gridCells)r.current[D.y][D.x]={blobId:O.id,color:O.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[se,ge]),he=v.useCallback(()=>{if(l.current!==null)return;const O=O2[w],G=Math.floor((Rn-4)/2),Ce=0,D=O.map(T=>({x:T.x+G,y:T.y+Ce}));for(const T of D)if(ye(T.x,T.y)){console.log("Cannot spawn - space occupied");return}const F=Wr(D,C,!1);F.visualOffsetY=0,s.current.push(F),l.current=s.current.length-1},[w,C,ye]),Ee=v.useCallback(()=>{var G;if(l.current===null)return;const O=s.current[l.current];if(O){for(;;){let Ce=!0;for(const D of O.gridCells){const F=D.y+1;if(F>=lt){Ce=!1;break}const T=(G=r.current[F])==null?void 0:G[D.x];if(T&&T.blobId!==O.id){Ce=!1;break}}if(!Ce)break;for(const D of O.gridCells)D.y+=1}O.visualOffsetY=0,ke()}},[ke]),Ge=v.useCallback(()=>{ie()},[ie]),$e=O=>{const G=Vl[O];G&&(P(G),g(O))},Fe=()=>{const{alphaMultiplier:O,alphaOffset:G}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${O} ${G}`},Ne="#2c3e50",Ie=O=>{let G=1/0,Ce=-1/0,D=1/0,F=-1/0;for(const T of O)T.x<G&&(G=T.x),T.x>Ce&&(Ce=T.x),T.y<D&&(D=T.y),T.y>F&&(F=T.y);return{minX:G,maxX:Ce,minY:D,maxY:F}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-8: Pop"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Pop with residue  click filled blobs to pop them, droplets scatter and fade"}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Hr.map((O,G)=>i.jsx("button",{onClick:()=>R(O),style:{width:30,height:30,background:O,border:C===O?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},O)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(O=>i.jsx("button",{onClick:()=>k(O),style:{padding:"6px 12px",background:w===O?"#fff":"#2c3e50",color:w===O?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:O},O))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:he,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:Ee,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:Ge,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:O=>x(O.target.checked)}),i.jsx("span",{children:"Show Grid"})]}),i.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),we&&i.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[i.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),i.jsxs("div",{style:{display:"flex",gap:10},children:[i.jsx("button",{onClick:ve,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),i.jsx("button",{onClick:()=>E(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Vl).map(O=>i.jsx("button",{onClick:()=>$e(O),style:{padding:"6px 12px",background:j===O?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:j===O?"bold":"normal",fontSize:12},children:O.charAt(0).toUpperCase()+O.slice(1)},O))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:O=>y(G=>({...G,fillRate:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:O=>u(Number(O.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:O=>d(G=>({...G,wallThickness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:O=>y(G=>({...G,autoFill:O.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:O=>d(G=>({...G,damping:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:O=>d(G=>({...G,stiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:O=>d(G=>({...G,pressure:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:O=>d(G=>({...G,homeStiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:O=>d(G=>({...G,innerHomeStiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:O=>d(G=>({...G,returnSpeed:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:O=>d(G=>({...G,viscosity:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:O=>d(G=>({...G,iterations:Number(O.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",M]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:M,onChange:O=>I(Number(O.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",L.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:L,onChange:O=>H(Number(O.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Droplets: ",ae]}),i.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:ae,onChange:O=>W(Number(O.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Speed: ",K]}),i.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:K,onChange:O=>Y(Number(O.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Lifetime: ",re.toFixed(1),"s"]}),i.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:re,onChange:O=>te(Number(O.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Size: ",Z,"px"]}),i.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:Z,onChange:O=>de(Number(O.target.value)),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:O=>d(G=>({...G,goopiness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:O=>d(G=>({...G,attractionRadius:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:O=>d(G=>({...G,attractionStiffness:Number(O.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:O=>d(G=>({...G,tendrilEndRadius:Number(O.target.value)})),style:{width:80}})]})]})]}),i.jsxs("svg",{ref:e,width:R2,height:b2,style:{background:Ne,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Fe(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:Rn+1}).map((O,G)=>i.jsx("line",{x1:hn+G*at,y1:xn,x2:hn+G*at,y2:xn+lt*at,stroke:"#fff",strokeWidth:1},`v${G}`)),Array.from({length:lt+1}).map((O,G)=>i.jsx("line",{x1:hn,y1:xn+G*at,x2:hn+Rn*at,y2:xn+G*at,stroke:"#fff",strokeWidth:1},`h${G}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((O,G)=>{const Ce=s.current[O.blobA],D=s.current[O.blobB];if(!Ce||!D)return null;const F=Ce.vertices[O.vertA],T=D.vertices[O.vertB];if(!F||!T)return null;const $=T.pos.x-F.pos.x,V=T.pos.y-F.pos.y,U=Math.sqrt($*$+V*V),le=Math.min(1,U/f.goopiness),b=f.tendrilEndRadius,_=1-f.tendrilSkinniness,A=1-f.tendrilSkinniness*.3,z=A-(A-_)*le,X=b*z,J=b*1.4,ne=Math.max(2,Math.ceil(U/J)),ue=[];for(let pe=0;pe<=ne;pe++){const Te=pe/ne,je=Math.sin(Te*Math.PI),Le=b-(b-X)*je;ue.push({cx:F.pos.x+$*Te,cy:F.pos.y+V*Te,r:Math.max(2,Le)})}return i.jsx("g",{children:ue.map((pe,Te)=>i.jsx("circle",{cx:pe.cx,cy:pe.cy,r:pe.r,fill:Ce.color},Te))},`tendril-${G}`)}),s.current.map((O,G)=>{const Ce=O.isLocked&&O.fillAmount>=1;return i.jsx("g",{style:{cursor:Ce?"pointer":"default"},onClick:()=>Ce&&oe(O),children:i.jsx("path",{d:X2(O.vertices),fill:O.color,stroke:O.color,strokeWidth:2})},O.id)})]}),s.current.map(O=>{if(!O.isLocked||O.fillAmount>=1)return null;const G=O.vertices.map(U=>U.pos),Ce=V2(G,f.wallThickness),D=Ie(Ce),F=D.maxY-D.minY,T=D.maxY-F*O.fillAmount,$=50,V=`unfilled-clip-${O.id}`;return i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:V,children:i.jsx("rect",{x:D.minX-$,y:D.minY-$,width:D.maxX-D.minX+$*2,height:T-D.minY+$})})}),i.jsx("path",{d:wp(Ce),fill:Ne,clipPath:`url(#${V})`})]},`inner-${O.id}`)}),i.jsx("g",{children:N.current.map(O=>i.jsx("circle",{cx:O.pos.x,cy:O.pos.y,r:O.radius,fill:O.color,opacity:O.opacity},O.id))}),s.current.filter(O=>O.gridCells.length>4).map(O=>i.jsxs("g",{children:[O.vertices.map((G,Ce)=>i.jsxs("g",{children:[i.jsx("circle",{cx:G.pos.x,cy:G.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:G.pos.x+6,y:G.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:Ce})]},`v-${Ce}`)),O.vertices.map((G,Ce)=>{const D=O.vertices[(Ce+1)%O.vertices.length];return i.jsx("line",{x1:G.pos.x,y1:G.pos.y,x2:D.pos.x,y2:D.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${Ce}`)})]},`debug-verts-${O.id}`)),s.current.map((O,G)=>i.jsx("text",{x:O.targetX,y:O.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:O.isLocked?`${Math.round(O.fillAmount*100)}%`:"falling"},`info-${O.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-8: Pop"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"How to test:"}),i.jsx("br",{})," Wait for a blob to fill to 100%",i.jsx("br",{})," Click the filled blob to pop it",i.jsx("br",{})," Droplets scatter outward and fade",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",i.jsx("strong",{children:"Droplets:"})," ",N.current.length]})]})}const en=6,Ve=8,Je=50,yn=50,gn=50,Z2=en*Je+yn*2,K2=Ve*Je+gn*2,Q2={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ql={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},J2={autoFill:!0,fillRate:.15},e3=4,t3=200,Eo=["#e74c3c","#3498db","#2ecc71","#f39c12"],n3={T_I_C:[{x:0,y:2},{x:0,y:3},{x:1,y:0},{x:1,y:1}],T_L_C:[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:2}],T_T_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:2,y:1}],T_S_C:[{x:0,y:2},{x:1,y:0},{x:1,y:1},{x:2,y:1}],T_O_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:1,y:2}]};function s3(e,t){return{x:yn+(e+.5)*Je,y:gn+(t+.5)*Je}}function ii(e,t){return{x:yn+e*Je,y:gn+t*Je}}function Ks(e){let t=0,n=0;for(const s of e){const r=s3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function o3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function r3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(ii(c.x,c.y));const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(j=>!r.has(j));if(y.length===0)break;let S=y[0],P=1/0;for(const j of y){const g=n(j,u),h=s(a,g);(h>P||P===1/0)&&(P=h,S=j)}l=S,c=u}return o}let jp=0;function Xn(e,t,n){const s=`blob-${jp++}`,r=o3(e),o=r3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Ks(e),x=Je*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const c=Ks(e),a=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y}})),f=[],d=a.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=a[x].homeOffset.x-a[h].homeOffset.x,R=a[x].homeOffset.y-a[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+R*R)})}const p=[],y=Je*1.5,S=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=a[x].homeOffset.x-a[h].homeOffset.x,R=a[x].homeOffset.y-a[h].homeOffset.y,w=Math.sqrt(C*C+R*R);if(w<y){const k=`${Math.min(h,x)}-${Math.max(h,x)}`;S.has(k)||(S.add(k),p.push({a:h,b:x,restLength:w}))}}let P=0;for(let h=0;h<d;h++){const x=(h+1)%d;P+=a[h].homeOffset.x*a[x].homeOffset.y,P-=a[x].homeOffset.x*a[h].homeOffset.y}const j=P>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${P.toFixed(0)}, winding=${j}, cells=${e.length}`);const g=Math.abs(P)/2;return{id:s,vertices:a,innerVertices:u,ringsprings:f,crossSprings:p,restArea:g,targetX:c.x,targetY:c.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,isLoose:!1,visualOffsetY:0}}function Wf(e,t,n=.3){const s=[];for(const o of t)for(const l of o.vertices)s.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.vertices){let l=1/0,c={x:0,y:0};for(const a of s){const u=o.pos.x-a.pos.x,f=o.pos.y-a.pos.y,d=u*u+f*f;d<l&&(l=d,c=a.velocity)}o.oldPos.x=o.pos.x-c.x*n,o.oldPos.y=o.pos.y-c.y*n}const r=[];for(const o of t)for(const l of o.innerVertices)r.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.innerVertices){let l=1/0,c={x:0,y:0};for(const a of r){const u=o.pos.x-a.pos.x,f=o.pos.y-a.pos.y,d=u*u+f*f;d<l&&(l=d,c=a.velocity)}o.oldPos.x=o.pos.x-c.x*n,o.oldPos.y=o.pos.y-c.y*n}}const i3=Je*.02*1e3;function l3(e){if(e.length===0)return[];if(e.length===1)return[[...e]];const t=new Set(e.map(r=>`${r.x},${r.y}`)),n=new Set,s=[];for(const r of e){const o=`${r.x},${r.y}`;if(n.has(o))continue;const l=[],c=[r];for(;c.length>0;){const a=c.shift(),u=`${a.x},${a.y}`;if(n.has(u))continue;n.add(u),l.push(a);const f=[{x:a.x,y:a.y-1},{x:a.x,y:a.y+1},{x:a.x-1,y:a.y},{x:a.x+1,y:a.y}];for(const d of f){const p=`${d.x},${d.y}`;t.has(p)&&!n.has(p)&&c.push(d)}}l.length>0&&s.push(l)}return s}function c3(e,t,n){var s;for(const r of e.gridCells)if(r.y>=Ve-1)return!0;for(const r of e.gridCells){const o=r.y+1;if(o<Ve){const l=(s=t[o])==null?void 0:s[r.x];if(l&&l.blobId!==e.id&&n.has(l.blobId))return!0}}return!1}function Uf(e,t){var c,a;const n=new Set;for(const u of e)if(!(!u.isLocked||u.isLoose)){for(const f of u.gridCells)if(f.y>=Ve-1){n.add(u.id);break}}let s=!0;for(;s;){s=!1;for(const u of e)n.has(u.id)||!u.isLocked||u.isLoose||c3(u,t,n)&&(n.add(u.id),s=!0)}const r=[],o=[],l=[];for(const u of e){if(!u.isLocked||u.isLoose||n.has(u.id))continue;for(const d of u.gridCells)((a=(c=t[d.y])==null?void 0:c[d.x])==null?void 0:a.blobId)===u.id&&(t[d.y][d.x]=null);const f=l3(u.gridCells);if(f.length===1)u.isLocked=!1,u.isLoose=!0,u.visualOffsetY=0,r.push(u),console.log(`Blob ${u.id} became loose (lost support)`);else{console.log(`Blob ${u.id} splitting into ${f.length} disconnected pieces`),o.push(u.id);for(const d of f){const p=Xn(d,u.color,!1);p.isLocked=!1,p.isLoose=!0,p.visualOffsetY=0,p.fillAmount=u.fillAmount,l.push(p),r.push(p),console.log(`  - Created loose piece with ${d.length} cell(s)`)}}}if(o.length>0||l.length>0){const u=e.filter(f=>!o.includes(f.id));e.length=0,e.push(...u,...l)}return r}const a3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Xf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function u3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function f3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Xf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Xf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function d3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function p3(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,c=o.pos.y-s,a=Math.sqrt(l*l+c*c),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(a>1e-4&&u>1e-4){const d=(u-a)*r;o.pos.x+=l/a*d,o.pos.y+=c/a*d}}}function h3(e){const t=yn,n=yn+en*Je,s=gn,r=gn+Ve*Je,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function x3(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color===a.color)continue;const u=c.isFalling||c.isLoose,f=a.isFalling||a.isLoose;if(!u&&!f)continue;const d=c.targetX-a.targetX,p=c.targetY-a.targetY;if(!(Math.sqrt(d*d+p*p)>Je*4))for(const S of c.vertices)for(const P of a.vertices){const j=P.pos.x-S.pos.x,g=P.pos.y-S.pos.y,h=Math.sqrt(j*j+g*g);if(h<20&&h>.01){const x=20-h,C=j/h,R=g/h,w=x*.8;S.pos.x-=C*w*.5,S.pos.y-=R*w*.5,P.pos.x+=C*w*.5,P.pos.y+=R*w*.5,S.oldPos.x-=C*w*.3,S.oldPos.y-=R*w*.3,P.oldPos.x+=C*w*.3,P.oldPos.y+=R*w*.3}}}}function y3(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],P=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=P.pos.x-S.pos.x,h=P.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),C=n.attractionRadius*S.attractionRadius,R=n.attractionRadius*P.attractionRadius,w=C+R;x<w&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function g3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),P=s+S*(r-s),j=p-o.restLength,g=f/p*j*P,h=d/p*j*P;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function m3(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,c=n[(r+1)%s].pos,a=l.x-o.x,u=l.y-o.y,f=c.x-l.x,d=c.y-l.y,p=Math.sqrt(a*a+u*u)||1,y=Math.sqrt(f*f+d*d)||1,S=a/p,P=u/p,j=f/y,g=d/y,h=P,x=-S,C=g,R=-j;let w=h+C,k=x+R;const m=Math.sqrt(w*w+k*k)||1;w/=m,k/=m,n[r].oldPos.x-=w*t,n[r].oldPos.y-=k*t}}function v3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Pp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=v3(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function S3(e){return Pp(e.map(t=>t.pos))}function C3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const P=u/y,j=f/y,g=d/S,h=p/S,x=-j,C=P,R=-h,w=g;let k=x+R,m=C+w;const M=Math.sqrt(k*k+m*m);M<.001?(k=x,m=C):(k/=M,m/=M);const I=P*g+j*h,L=Math.sqrt((1+I)/2),H=L>.1?1/L:10,q=s[o]*.4,ee=Math.min(t,q);r.push({x:c.x+k*ee*Math.min(H,3),y:c.y+m*ee*Math.min(H,3)})}return r}function k3(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(t3),[f,d]=v.useState(Q2),[p,y]=v.useState(J2),[S,P]=v.useState(ql.medium),[j,g]=v.useState("medium"),[h,x]=v.useState(!0),[C,R]=v.useState(Eo[0]),[w,k]=v.useState("T"),[,m]=v.useState({}),[M,I]=v.useState("A"),[L,H]=v.useState("T_T_C"),[q,ee]=v.useState(0),[N,Q]=v.useState(5),[ae,W]=v.useState(1.5),K=v.useRef(N),Y=v.useRef(ae);K.current=N,Y.current=ae;const re=v.useRef([]),te=v.useRef(0),[Z,de]=v.useState(12),[we,E]=v.useState(150),[B,ve]=v.useState(1),[ie,ye]=v.useState(8),[se,ge]=v.useState(!1),oe="proto9-dev-settings";v.useEffect(()=>{const b=localStorage.getItem(oe);if(b)try{const _=JSON.parse(b);_.physics&&d(_.physics),_.fillParams&&y(_.fillParams),_.filterParams&&(P(_.filterParams),g("custom")),_.fallSpeed&&u(_.fallSpeed),_.impactStrength&&Q(_.impactStrength),_.impactRadius&&W(_.impactRadius),_.dropletCount&&de(_.dropletCount),_.dropletSpeed&&E(_.dropletSpeed),_.dropletLifetime&&ve(_.dropletLifetime),_.dropletSize&&ye(_.dropletSize),console.log("Loaded dev settings from localStorage")}catch(_){console.warn("Failed to load dev settings:",_)}},[]),v.useEffect(()=>{const b=_=>{_.key==="`"&&(_.preventDefault(),ge(A=>!A))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]);const ke=v.useCallback(()=>{const b={physics:f,fillParams:p,filterParams:S,fallSpeed:a,impactStrength:N,impactRadius:ae,dropletCount:Z,dropletSpeed:we,dropletLifetime:B,dropletSize:ie};localStorage.setItem(oe,JSON.stringify(b)),console.log("Saved dev settings to localStorage")},[f,p,S,a,N,ae,Z,we,B,ie]),he=v.useCallback(()=>{const b=[];for(let pe=0;pe<Ve;pe++){b[pe]=[];for(let Te=0;Te<en;Te++)b[pe][Te]=null}r.current=b,jp=0;const _=[],A=[{x:1,y:Ve-1},{x:2,y:Ve-1},{x:3,y:Ve-1},{x:4,y:Ve-1}],z=Xn(A,Eo[1],!0);z.fillAmount=1,z.wasFullLastFrame=!0,_.push(z);for(const pe of A)b[pe.y][pe.x]={blobId:z.id,color:z.color};const X=[{x:1,y:Ve-2},{x:2,y:Ve-2},{x:3,y:Ve-2},{x:2,y:Ve-3}],J=Xn(X,Eo[0],!0);J.fillAmount=1,J.wasFullLastFrame=!0,_.push(J);for(const pe of X)b[pe.y][pe.x]={blobId:J.id,color:J.color};const ne=[{x:1,y:Ve-5},{x:1,y:Ve-4},{x:2,y:Ve-4},{x:3,y:Ve-4}],ue=Xn(ne,Eo[1],!0);ue.fillAmount=1,ue.wasFullLastFrame=!0,_.push(ue);for(const pe of ne)b[pe.y][pe.x]={blobId:ue.id,color:ue.color};s.current=_,o.current=[],re.current=[],l.current=null,c.current=!1,console.log("Test A initialized: 4x1 blue, T red, J blue")},[]);v.useEffect(()=>{he()},[he]);const Ee=v.useCallback(b=>{I(b),he()},[he]);v.useEffect(()=>{let b=!0;const _=A=>{var Le,De,Pe,_e,We;if(b){n.current=A,b=!1,t.current=requestAnimationFrame(_);return}const z=Math.min((A-n.current)/1e3,.033);n.current=A;for(const ce of s.current){u3(ce,f,z),f3(ce,f);for(let Be=0;Be<f.iterations;Be++)d3(ce,f);ce.usePressure&&p3(ce,f),h3(ce)}x3(s.current);for(const ce of s.current){ce.isLocked&&p.autoFill&&ce.fillAmount<1&&(ce.fillAmount=Math.min(1,ce.fillAmount+p.fillRate*z));const Be=ce.fillAmount>=1;Be&&!ce.wasFullLastFrame&&m3(ce,e3),ce.wasFullLastFrame=Be}if(l.current!==null){const ce=s.current[l.current];if(ce&&!ce.isLocked){let Be=Ve-1;for(const rt of ce.gridCells){let wt=rt.y;for(;wt<Ve-1;){const Xa=wt+1,Va=(Le=r.current[Xa])==null?void 0:Le[rt.x];if(Va&&Va.blobId!==ce.id)break;wt=Xa}wt-rt.y+ce.gridCells[0].y;const An=wt-rt.y;rt.y+An-rt.y<Be-ce.gridCells[0].y}let Xe=Ve;for(const rt of ce.gridCells){let wt=0;for(;rt.y+wt+1<Ve;){const An=rt.y+wt+1,el=(De=r.current[An])==null?void 0:De[rt.x];if(el&&el.blobId!==ce.id)break;wt++}Xe=Math.min(Xe,wt)}const kt=Xe*Je,Wn=a*z,Ht=Math.min(ce.visualOffsetY+Wn,kt);for(ce.visualOffsetY=Ht;ce.visualOffsetY>=Je;){for(const rt of ce.gridCells)rt.y+=1;ce.visualOffsetY-=Je}const Es=Ks(ce.gridCells);ce.targetY=Es.y+ce.visualOffsetY;let Jt=!0;for(const rt of ce.gridCells){const wt=rt.y+1;if(wt>=Ve){Jt=!1;break}const An=(Pe=r.current[wt])==null?void 0:Pe[rt.x];if(An&&An.blobId!==ce.id){Jt=!1;break}}!Jt&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=Es.y,c.current=!0)}}const X=s.current.filter(ce=>ce.isLoose),J=[];for(const ce of X){let Be=Ve;for(const Jt of ce.gridCells){let rt=0;for(;Jt.y+rt+1<Ve;){const wt=Jt.y+rt+1,An=(_e=r.current[wt])==null?void 0:_e[Jt.x];if(An&&An.blobId!==ce.id)break;rt++}Be=Math.min(Be,rt)}const Xe=Be*Je,kt=i3*z,Wn=Math.min(ce.visualOffsetY+kt,Xe);for(ce.visualOffsetY=Wn;ce.visualOffsetY>=Je;){for(const Jt of ce.gridCells)Jt.y+=1;ce.visualOffsetY-=Je}const Ht=Ks(ce.gridCells);ce.targetY=Ht.y+ce.visualOffsetY;let Es=!0;for(const Jt of ce.gridCells){const rt=Jt.y+1;if(rt>=Ve){Es=!1;break}const wt=(We=r.current[rt])==null?void 0:We[Jt.x];if(wt&&wt.blobId!==ce.id){Es=!1;break}}!Es&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=Ht.y,J.push(ce))}for(const ce of J)Ie(ce);o.current=y3(s.current,o.current,f),g3(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,O());const ne=300,ue=yn,pe=yn+en*Je,Te=gn,je=gn+Ve*Je;for(const ce of re.current)ce.vel.y+=ne*z,ce.pos.x+=ce.vel.x*z,ce.pos.y+=ce.vel.y*z,(ce.pos.x+ce.radius<ue||ce.pos.x-ce.radius>pe)&&(ce.lifetime=0),ce.pos.y+ce.radius<Te&&(ce.lifetime=0),ce.pos.y+ce.radius>je&&(ce.pos.y=je-ce.radius,ce.vel.y*=-.3),ce.lifetime-=z,ce.opacity=Math.max(0,ce.lifetime/ce.maxLifetime),ce.radius*=.995;re.current=re.current.filter(ce=>ce.lifetime>0&&ce.opacity>.01),m({}),t.current=requestAnimationFrame(_)};return t.current=requestAnimationFrame(_),()=>cancelAnimationFrame(t.current)},[f,p,a]);const Ge=v.useCallback((b,_)=>{var A;return _<0||_>=Ve||b<0||b>=en?!0:((A=r.current[_])==null?void 0:A[b])!==null},[]),$e=v.useCallback((b,_)=>{const A=new Set,z=r.current;for(const X of b){const J=[{x:X.x-1,y:X.y},{x:X.x+1,y:X.y},{x:X.x,y:X.y-1},{x:X.x,y:X.y+1}];for(const ne of J)if(ne.y>=0&&ne.y<Ve&&ne.x>=0&&ne.x<en){const ue=z[ne.y][ne.x];ue&&ue.color===_&&A.add(ue.blobId)}}return A},[]),Fe=v.useCallback(b=>{var J,ne,ue;const _=K.current,A=Y.current,z=[];for(const pe of b.gridCells){const Te=pe.y+1;Te<Ve&&((J=r.current[Te])!=null&&J[pe.x])&&z.push(ii(pe.x+.5,pe.y+1)),pe.x>0&&((ne=r.current[pe.y])!=null&&ne[pe.x-1])&&z.push(ii(pe.x,pe.y+.5)),pe.x<en-1&&((ue=r.current[pe.y])!=null&&ue[pe.x+1])&&z.push(ii(pe.x+1,pe.y+.5))}if(z.length===0)return;const X=Je*A;for(const pe of s.current)if(pe.id!==b.id){for(const Te of pe.vertices){let je=1/0,Le=null;for(const De of z){const Pe=Te.pos.x-De.x,_e=Te.pos.y-De.y,We=Math.sqrt(Pe*Pe+_e*_e);We<je&&(je=We,Le=De)}if(je<X&&Le){const De=1-je/X,Pe=_*De*De,_e=(Te.pos.x-Le.x)/(je+.1),We=(Te.pos.y-Le.y)/(je+.1);Te.oldPos.x-=_e*Pe,Te.oldPos.y-=We*Pe*.5}}for(const Te of pe.innerVertices){let je=1/0,Le=null;for(const De of z){const Pe=Te.pos.x-De.x,_e=Te.pos.y-De.y,We=Math.sqrt(Pe*Pe+_e*_e);We<je&&(je=We,Le=De)}if(je<X&&Le){const De=1-je/X,Pe=_*De*De*.3,_e=(Te.pos.x-Le.x)/(je+.1),We=(Te.pos.y-Le.y)/(je+.1);Te.oldPos.x-=_e*Pe,Te.oldPos.y-=We*Pe*.5}}}},[]),Ne=v.useCallback(b=>{var X,J;const _=b.targetX,A=b.targetY;for(let ne=0;ne<Z;ne++){const ue=Math.floor(Math.random()*b.vertices.length),pe=b.vertices[ue],Te=pe.pos.x-_,je=pe.pos.y-A,Le=Math.atan2(je,Te)+(Math.random()-.5)*.8,De=we*(.5+Math.random()*.8),Pe={id:`droplet-${te.current++}`,pos:{x:pe.pos.x,y:pe.pos.y},vel:{x:Math.cos(Le)*De,y:Math.sin(Le)*De-50},radius:ie*(.5+Math.random()*.7),color:b.color,opacity:1,lifetime:B*(.7+Math.random()*.6),maxLifetime:B};re.current.push(Pe),console.log("Created droplet:",Pe.pos,Pe.radius,Pe.color)}for(const ne of b.gridCells)((J=(X=r.current[ne.y])==null?void 0:X[ne.x])==null?void 0:J.blobId)===b.id&&(r.current[ne.y][ne.x]=null);s.current=s.current.filter(ne=>ne.id!==b.id);const z=Uf(s.current,r.current);z.length>0&&console.log(`Pop created ${z.length} loose goop blob(s)`),console.log(`Popped blob with ${b.gridCells.length} cells, spawned ${re.current.length} droplets total`)},[Z,we,B,ie]),Ie=v.useCallback(b=>{if(!b.isLoose)return;console.log(`Locking loose blob ${b.id}`),Fe(b),b.visualOffsetY=0;const _=Ks(b.gridCells);b.targetY=_.y;const A=$e(b.gridCells,b.color);if(A.size>0){const X=[...b.gridCells],J=[b],ne=[b.id];for(const pe of A){const Te=s.current.find(je=>je.id===pe);Te&&(X.push(...Te.gridCells),J.push(Te),ne.push(pe))}const ue=Xn(X,b.color,!0);Wf(ue,J);for(const pe of X)r.current[pe.y][pe.x]={blobId:ue.id,color:ue.color};s.current=s.current.filter(pe=>!ne.includes(pe.id)),s.current.push(ue),console.log(`Loose blob merged with ${A.size} neighbor(s) into ${X.length} cells`)}else{b.isLocked=!0,b.isLoose=!1,b.fillAmount=0,b.wasFullLastFrame=!1;for(const X of b.gridCells)r.current[X.y][X.x]={blobId:b.id,color:b.color};console.log("Loose blob locked (no same-color neighbors)")}const z=Uf(s.current,r.current);z.length>0&&console.log(`Landing created ${z.length} more loose goop blob(s)`)},[$e,Fe]),O=v.useCallback(()=>{if(l.current===null)return;const b=s.current[l.current];if(!b)return;Fe(b),b.visualOffsetY=0;const _=Ks(b.gridCells);b.targetY=_.y;const A=$e(b.gridCells,b.color);if(A.size>0){const z=[...b.gridCells],X=[b],J=[b.id];for(const ue of A){const pe=s.current.find(Te=>Te.id===ue);pe&&(z.push(...pe.gridCells),X.push(pe),J.push(ue))}const ne=Xn(z,b.color,!0);Wf(ne,X);for(const ue of z)r.current[ue.y][ue.x]={blobId:ne.id,color:ne.color};s.current=s.current.filter(ue=>!J.includes(ue.id)),s.current.push(ne),console.log(`Merged ${J.length} blobs into one with ${z.length} cells`)}else{b.isLocked=!0,b.fillAmount=0,b.wasFullLastFrame=!1;for(const z of b.gridCells)r.current[z.y][z.x]={blobId:b.id,color:b.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[$e,Fe]),G=v.useCallback(()=>{if(l.current!==null)return;const b=a3[w],_=Math.floor((en-4)/2),A=0,z=b.map(J=>({x:J.x+_,y:J.y+A}));for(const J of z)if(Ge(J.x,J.y)){console.log("Cannot spawn - space occupied");return}const X=Xn(z,C,!1);X.visualOffsetY=0,s.current.push(X),l.current=s.current.length-1},[w,C,Ge]),Ce=(b,_)=>{let A=b.map(J=>({...J}));for(let J=0;J<_%4;J++)A=A.map(({x:ne,y:ue})=>({x:-ue,y:ne}));const z=Math.min(...A.map(J=>J.x)),X=Math.min(...A.map(J=>J.y));return A.map(J=>({x:J.x-z,y:J.y-X}))},D=v.useCallback(()=>{if(l.current!==null)return;const b=n3[L];if(!b)return;const _=Ce(b,q),A=Math.floor((en-3)/2),z=0,X=_.map(ne=>({x:ne.x+A,y:ne.y+z}));for(const ne of X){if(ne.x<0||ne.x>=en||ne.y<0||ne.y>=Ve){console.log("Cannot spawn - out of bounds");return}if(Ge(ne.x,ne.y)){console.log("Cannot spawn - space occupied");return}}const J=Xn(X,C,!1);J.visualOffsetY=0,s.current.push(J),l.current=s.current.length-1,console.log(`Spawned corrupted piece ${L} with rotation ${q*90}`)},[L,q,C,Ge]),F=v.useCallback(()=>{var _;if(l.current===null)return;const b=s.current[l.current];if(b){for(;;){let A=!0;for(const z of b.gridCells){const X=z.y+1;if(X>=Ve){A=!1;break}const J=(_=r.current[X])==null?void 0:_[z.x];if(J&&J.blobId!==b.id){A=!1;break}}if(!A)break;for(const z of b.gridCells)z.y+=1}b.visualOffsetY=0,O()}},[O]),T=v.useCallback(()=>{he()},[he]),$=b=>{const _=ql[b];_&&(P(_),g(b))},V=()=>{const{alphaMultiplier:b,alphaOffset:_}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${b} ${_}`},U="#2c3e50",le=b=>{let _=1/0,A=-1/0,z=1/0,X=-1/0;for(const J of b)J.x<_&&(_=J.x),J.x>A&&(A=J.x),J.y<z&&(z=J.y),J.y>X&&(X=J.y);return{minX:_,maxX:A,minY:z,maxY:X}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-9: Loose Goop"}),i.jsxs("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:[M==="A"&&"Test A: Click red blob to pop  top blue becomes loose  falls  merges with bottom blue",M==="B"&&"Test B: Spawn corrupted pieces, build stacks, pop middle pieces to test loose goop",M==="default"&&"Default: Original Proto-8 setup with T and square pieces"]}),i.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15,background:"#8e44ad",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold",marginRight:10},children:"Test Mode:"}),i.jsx("button",{onClick:()=>Ee("A"),style:{padding:"8px 16px",background:M==="A"?"#fff":"#2c3e50",color:M==="A"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test A: Stack Pop"}),i.jsx("button",{onClick:()=>Ee("B"),style:{padding:"8px 16px",background:M==="B"?"#fff":"#2c3e50",color:M==="B"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test B: Corrupted"}),i.jsx("button",{onClick:()=>Ee("default"),style:{padding:"8px 16px",background:M==="default"?"#fff":"#2c3e50",color:M==="default"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Default"})]}),M==="A"&&i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#e74c3c",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:14},children:"Blue (floor)  Red (middle)  Blue (top)"}),i.jsx("button",{onClick:()=>he(),style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Stack"})]}),M==="B"&&i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#16a085",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Corrupted Shape:"}),i.jsxs("select",{value:L,onChange:b=>H(b.target.value),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#fff",cursor:"pointer"},children:[i.jsx("option",{value:"T_T_C",children:"T Corrupted (split T)"}),i.jsx("option",{value:"T_I_C",children:"I Corrupted (split I)"}),i.jsx("option",{value:"T_L_C",children:"L Corrupted (diagonal L)"}),i.jsx("option",{value:"T_S_C",children:"S Corrupted (diagonal S)"}),i.jsx("option",{value:"T_O_C",children:"O Corrupted (split O)"})]}),i.jsx("span",{style:{fontWeight:"bold",marginLeft:10},children:"Rotate:"}),i.jsx("button",{onClick:()=>ee(b=>(b+3)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CCW"}),i.jsx("button",{onClick:()=>ee(b=>(b+1)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CW"}),i.jsxs("span",{style:{opacity:.7},children:[q*90,""]}),i.jsx("button",{onClick:D,disabled:l.current!==null,style:{padding:"8px 16px",background:l.current!==null?"#7f8c8d":"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold",marginLeft:10},children:"Spawn Corrupted"})]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Eo.map((b,_)=>i.jsx("button",{onClick:()=>R(b),style:{width:30,height:30,background:b,border:C===b?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},b)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(b=>i.jsx("button",{onClick:()=>k(b),style:{padding:"6px 12px",background:w===b?"#fff":"#2c3e50",color:w===b?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:b},b))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:G,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:F,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:T,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:b=>x(b.target.checked)}),i.jsx("span",{children:"Show Grid"})]}),i.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),se&&i.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[i.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),i.jsxs("div",{style:{display:"flex",gap:10},children:[i.jsx("button",{onClick:ke,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),i.jsx("button",{onClick:()=>ge(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ql).map(b=>i.jsx("button",{onClick:()=>$(b),style:{padding:"6px 12px",background:j===b?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:j===b?"bold":"normal",fontSize:12},children:b.charAt(0).toUpperCase()+b.slice(1)},b))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:b=>y(_=>({..._,fillRate:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:b=>u(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:b=>d(_=>({..._,wallThickness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:b=>y(_=>({..._,autoFill:b.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:b=>d(_=>({..._,damping:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:b=>d(_=>({..._,stiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:b=>d(_=>({..._,pressure:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:b=>d(_=>({..._,homeStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:b=>d(_=>({..._,innerHomeStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:b=>d(_=>({..._,returnSpeed:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:b=>d(_=>({..._,viscosity:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:b=>d(_=>({..._,iterations:Number(b.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",N]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:N,onChange:b=>Q(Number(b.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",ae.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:ae,onChange:b=>W(Number(b.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Droplets: ",Z]}),i.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:Z,onChange:b=>de(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Speed: ",we]}),i.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:we,onChange:b=>E(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Lifetime: ",B.toFixed(1),"s"]}),i.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:B,onChange:b=>ve(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Size: ",ie,"px"]}),i.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:ie,onChange:b=>ye(Number(b.target.value)),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:b=>d(_=>({..._,goopiness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:b=>d(_=>({..._,attractionRadius:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:b=>d(_=>({..._,attractionStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:b=>d(_=>({..._,tendrilEndRadius:Number(b.target.value)})),style:{width:80}})]})]})]}),i.jsxs("svg",{ref:e,width:Z2,height:K2,style:{background:U,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:V(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:en+1}).map((b,_)=>i.jsx("line",{x1:yn+_*Je,y1:gn,x2:yn+_*Je,y2:gn+Ve*Je,stroke:"#fff",strokeWidth:1},`v${_}`)),Array.from({length:Ve+1}).map((b,_)=>i.jsx("line",{x1:yn,y1:gn+_*Je,x2:yn+en*Je,y2:gn+_*Je,stroke:"#fff",strokeWidth:1},`h${_}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((b,_)=>{const A=s.current[b.blobA],z=s.current[b.blobB];if(!A||!z)return null;const X=A.vertices[b.vertA],J=z.vertices[b.vertB];if(!X||!J)return null;const ne=J.pos.x-X.pos.x,ue=J.pos.y-X.pos.y,pe=Math.sqrt(ne*ne+ue*ue),Te=Math.min(1,pe/f.goopiness),je=f.tendrilEndRadius,Le=1-f.tendrilSkinniness,De=1-f.tendrilSkinniness*.3,Pe=De-(De-Le)*Te,_e=je*Pe,We=je*1.4,ce=Math.max(2,Math.ceil(pe/We)),Be=[];for(let Xe=0;Xe<=ce;Xe++){const kt=Xe/ce,Wn=Math.sin(kt*Math.PI),Ht=je-(je-_e)*Wn;Be.push({cx:X.pos.x+ne*kt,cy:X.pos.y+ue*kt,r:Math.max(2,Ht)})}return i.jsx("g",{children:Be.map((Xe,kt)=>i.jsx("circle",{cx:Xe.cx,cy:Xe.cy,r:Xe.r,fill:A.color},kt))},`tendril-${_}`)}),s.current.map((b,_)=>{const A=b.isLocked&&b.fillAmount>=1;return i.jsx("g",{style:{cursor:A?"pointer":"default"},onClick:()=>A&&Ne(b),children:i.jsx("path",{d:S3(b.vertices),fill:b.color,stroke:b.color,strokeWidth:2})},b.id)})]}),s.current.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const _=b.vertices.map(pe=>pe.pos),A=C3(_,f.wallThickness),z=le(A),X=z.maxY-z.minY,J=z.maxY-X*b.fillAmount,ne=50,ue=`unfilled-clip-${b.id}`;return i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:ue,children:i.jsx("rect",{x:z.minX-ne,y:z.minY-ne,width:z.maxX-z.minX+ne*2,height:J-z.minY+ne})})}),i.jsx("path",{d:Pp(A),fill:U,clipPath:`url(#${ue})`})]},`inner-${b.id}`)}),i.jsx("g",{children:re.current.map(b=>i.jsx("circle",{cx:b.pos.x,cy:b.pos.y,r:b.radius,fill:b.color,opacity:b.opacity},b.id))}),s.current.filter(b=>b.gridCells.length>4).map(b=>i.jsxs("g",{children:[b.vertices.map((_,A)=>i.jsxs("g",{children:[i.jsx("circle",{cx:_.pos.x,cy:_.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:_.pos.x+6,y:_.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:A})]},`v-${A}`)),b.vertices.map((_,A)=>{const z=b.vertices[(A+1)%b.vertices.length];return i.jsx("line",{x1:_.pos.x,y1:_.pos.y,x2:z.pos.x,y2:z.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${A}`)})]},`debug-verts-${b.id}`)),s.current.map((b,_)=>i.jsx("text",{x:b.targetX,y:b.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:b.isLocked?`${Math.round(b.fillAmount*100)}%`:"falling"},`info-${b.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-8: Pop"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"How to test:"}),i.jsx("br",{})," Wait for a blob to fill to 100%",i.jsx("br",{})," Click the filled blob to pop it",i.jsx("br",{})," Droplets scatter outward and fade",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",i.jsx("strong",{children:"Droplets:"})," ",re.current.length]})]})}const w3=()=>new URLSearchParams(window.location.search).get("proto"),j3=()=>{const[e,t]=v.useState("GAME"),[n,s]=v.useState(()=>gm()),[r,o]=v.useState(0);Sm(),v.useEffect(()=>{mm(n)},[n]),v.useEffect(()=>{mt.init(n.settings)},[]);const l=v.useCallback(y=>{s(S=>{const P=ft(S.careerScore),{newCareerScore:j,ranksGained:g}=ap(S.careerScore,y.score,y.won),h=ft(j),x=g>0?g:0,R=gg(P.rank,h.rank).filter(w=>!S.milestonesReached.includes(w));return R.length>0&&me.emit(xe.MILESTONE_REACHED,{milestones:R}),{...S,careerScore:j,careerRank:h.rank,scraps:S.scraps+x,milestonesReached:[...S.milestonesReached,...R],firstRunComplete:!0}})},[]),c=y=>{s(S=>({...S,settings:y})),mt.updateSettings(y)},a=y=>{if(y===0){const S=vm();s(S),o(P=>P+1),mt.init(S.settings)}else{const S=xg(y);s(P=>({...P,careerScore:S,careerRank:y,scraps:y,powerUps:{}})),o(P=>P+1)}},u=v.useCallback(y=>{s(S=>{const P=S.powerUps[y]||0,j=En[y],g=(j==null?void 0:j.maxLevel)||4,h=(j==null?void 0:j.costPerLevel)||1;return S.scraps<h||P>=g?S:{...S,scraps:S.scraps-h,powerUps:{...S.powerUps,[y]:P+1}}})},[]),f=v.useCallback(y=>{s(S=>{const P=S.powerUps[y]||0,j=En[y],g=(j==null?void 0:j.costPerLevel)||1;if(P<=0)return S;let h=S.equippedActives;return P===1&&S.equippedActives.includes(y)&&(h=S.equippedActives.filter(x=>x!==y)),{...S,scraps:S.scraps+g,powerUps:{...S.powerUps,[y]:P-1},equippedActives:h}})},[]),d=v.useCallback(y=>{s(S=>{const P=S.equippedActives.includes(y);let j;if(P)j=S.equippedActives.filter(g=>g!==y);else{const h=1+((S.powerUps.ACTIVE_EXPANSION_SLOT||0)+(S.powerUps.ACTIVE_EXPANSION_SLOT_2||0));S.equippedActives.length>=h?j=[...S.equippedActives.slice(0,h-1),y]:j=[...S.equippedActives,y]}return{...S,equippedActives:j}})},[]),p=w3();return p==="1"?i.jsx(bm,{}):p==="2"?i.jsx(Om,{}):p==="3"?i.jsx(Um,{}):p==="4"?i.jsx(sv,{}):p==="5"?i.jsx(xv,{}):p==="5b"?i.jsx(Tv,{}):p==="5c"?i.jsx(Gv,{}):p==="6"?i.jsx(s2,{}):p==="7"?i.jsx(P2,{}):p==="8"?i.jsx(q2,{}):p==="9"?i.jsx(k3,{}):i.jsxs("div",{className:"w-full h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[e==="GAME"&&i.jsx(dm,{onExit:()=>{},onRunComplete:l,initialTotalScore:n.careerScore,powerUps:n.powerUps,scraps:n.scraps,settings:n.settings,onOpenSettings:()=>t("SETTINGS"),onOpenHelp:()=>t("HOW_TO_PLAY"),onOpenUpgrades:()=>t("UPGRADES"),onSetRank:a,onPurchaseUpgrade:u,onRefundUpgrade:f,equippedActives:n.equippedActives,onToggleEquip:d},r),e==="UPGRADES"&&i.jsx(pm,{onBack:()=>t("GAME")}),e==="SETTINGS"&&i.jsx(hm,{settings:n.settings,onUpdate:c,onBack:()=>t("GAME")}),e==="HOW_TO_PLAY"&&i.jsx(xm,{onBack:()=>t("GAME")})]})},Rp=document.getElementById("root");if(!Rp)throw new Error("Could not find root element to mount to");const P3=Zl.createRoot(Rp);P3.render(i.jsx(Wp.StrictMode,{children:i.jsx(j3,{})}));
