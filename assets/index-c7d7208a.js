var th=Object.defineProperty;var nh=(e,t,n)=>t in e?th(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Ye=(e,t,n)=>(nh(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function sh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hd={exports:{}},Ui={},xd={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gr=Symbol.for("react.element"),oh=Symbol.for("react.portal"),rh=Symbol.for("react.fragment"),ih=Symbol.for("react.strict_mode"),lh=Symbol.for("react.profiler"),ah=Symbol.for("react.provider"),ch=Symbol.for("react.context"),uh=Symbol.for("react.forward_ref"),fh=Symbol.for("react.suspense"),dh=Symbol.for("react.memo"),ph=Symbol.for("react.lazy"),lu=Symbol.iterator;function hh(e){return e===null||typeof e!="object"?null:(e=lu&&e[lu]||e["@@iterator"],typeof e=="function"?e:null)}var yd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},md=Object.assign,gd={};function So(e,t,n){this.props=e,this.context=t,this.refs=gd,this.updater=n||yd}So.prototype.isReactComponent={};So.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};So.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function vd(){}vd.prototype=So.prototype;function lc(e,t,n){this.props=e,this.context=t,this.refs=gd,this.updater=n||yd}var ac=lc.prototype=new vd;ac.constructor=lc;md(ac,So.prototype);ac.isPureReactComponent=!0;var au=Array.isArray,Sd=Object.prototype.hasOwnProperty,cc={current:null},Cd={key:!0,ref:!0,__self:!0,__source:!0};function kd(e,t,n){var s,r={},o=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(o=""+t.key),t)Sd.call(t,s)&&!Cd.hasOwnProperty(s)&&(r[s]=t[s]);var i=arguments.length-2;if(i===1)r.children=n;else if(1<i){for(var c=Array(i),u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(s in i=e.defaultProps,i)r[s]===void 0&&(r[s]=i[s]);return{$$typeof:gr,type:e,key:o,ref:a,props:r,_owner:cc.current}}function xh(e,t){return{$$typeof:gr,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function uc(e){return typeof e=="object"&&e!==null&&e.$$typeof===gr}function yh(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var cu=/\/+/g;function fl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?yh(""+e.key):t.toString(36)}function ti(e,t,n,s,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case gr:case oh:a=!0}}if(a)return a=e,r=r(a),e=s===""?"."+fl(a,0):s,au(r)?(n="",e!=null&&(n=e.replace(cu,"$&/")+"/"),ti(r,t,n,"",function(u){return u})):r!=null&&(uc(r)&&(r=xh(r,n+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(cu,"$&/")+"/")+e)),t.push(r)),1;if(a=0,s=s===""?".":s+":",au(e))for(var i=0;i<e.length;i++){o=e[i];var c=s+fl(o,i);a+=ti(o,t,n,c,r)}else if(c=hh(e),typeof c=="function")for(e=c.call(e),i=0;!(o=e.next()).done;)o=o.value,c=s+fl(o,i++),a+=ti(o,t,n,c,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function wr(e,t,n){if(e==null)return e;var s=[],r=0;return ti(e,s,"","",function(o){return t.call(n,o,r++)}),s}function mh(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Wt={current:null},ni={transition:null},gh={ReactCurrentDispatcher:Wt,ReactCurrentBatchConfig:ni,ReactCurrentOwner:cc};function wd(){throw Error("act(...) is not supported in production builds of React.")}Ke.Children={map:wr,forEach:function(e,t,n){wr(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return wr(e,function(){t++}),t},toArray:function(e){return wr(e,function(t){return t})||[]},only:function(e){if(!uc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ke.Component=So;Ke.Fragment=rh;Ke.Profiler=lh;Ke.PureComponent=lc;Ke.StrictMode=ih;Ke.Suspense=fh;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gh;Ke.act=wd;Ke.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=md({},e.props),r=e.key,o=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,a=cc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)Sd.call(t,c)&&!Cd.hasOwnProperty(c)&&(s[c]=t[c]===void 0&&i!==void 0?i[c]:t[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){i=Array(c);for(var u=0;u<c;u++)i[u]=arguments[u+2];s.children=i}return{$$typeof:gr,type:e.type,key:r,ref:o,props:s,_owner:a}};Ke.createContext=function(e){return e={$$typeof:ch,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:ah,_context:e},e.Consumer=e};Ke.createElement=kd;Ke.createFactory=function(e){var t=kd.bind(null,e);return t.type=e,t};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(e){return{$$typeof:uh,render:e}};Ke.isValidElement=uc;Ke.lazy=function(e){return{$$typeof:ph,_payload:{_status:-1,_result:e},_init:mh}};Ke.memo=function(e,t){return{$$typeof:dh,type:e,compare:t===void 0?null:t}};Ke.startTransition=function(e){var t=ni.transition;ni.transition={};try{e()}finally{ni.transition=t}};Ke.unstable_act=wd;Ke.useCallback=function(e,t){return Wt.current.useCallback(e,t)};Ke.useContext=function(e){return Wt.current.useContext(e)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(e){return Wt.current.useDeferredValue(e)};Ke.useEffect=function(e,t){return Wt.current.useEffect(e,t)};Ke.useId=function(){return Wt.current.useId()};Ke.useImperativeHandle=function(e,t,n){return Wt.current.useImperativeHandle(e,t,n)};Ke.useInsertionEffect=function(e,t){return Wt.current.useInsertionEffect(e,t)};Ke.useLayoutEffect=function(e,t){return Wt.current.useLayoutEffect(e,t)};Ke.useMemo=function(e,t){return Wt.current.useMemo(e,t)};Ke.useReducer=function(e,t,n){return Wt.current.useReducer(e,t,n)};Ke.useRef=function(e){return Wt.current.useRef(e)};Ke.useState=function(e){return Wt.current.useState(e)};Ke.useSyncExternalStore=function(e,t,n){return Wt.current.useSyncExternalStore(e,t,n)};Ke.useTransition=function(){return Wt.current.useTransition()};Ke.version="18.3.1";xd.exports=Ke;var g=xd.exports;const vh=sh(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sh=g,Ch=Symbol.for("react.element"),kh=Symbol.for("react.fragment"),wh=Object.prototype.hasOwnProperty,Rh=Sh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ph={key:!0,ref:!0,__self:!0,__source:!0};function Rd(e,t,n){var s,r={},o=null,a=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)wh.call(t,s)&&!Ph.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:Ch,type:e,key:o,ref:a,props:r,_owner:Rh.current}}Ui.Fragment=kh;Ui.jsx=Rd;Ui.jsxs=Rd;hd.exports=Ui;var l=hd.exports,la={},Pd={exports:{}},on={},jd={exports:{}},Td={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(B,Z){var q=B.length;B.push(Z);e:for(;0<q;){var oe=q-1>>>1,ne=B[oe];if(0<r(ne,Z))B[oe]=Z,B[q]=ne,q=oe;else break e}}function n(B){return B.length===0?null:B[0]}function s(B){if(B.length===0)return null;var Z=B[0],q=B.pop();if(q!==Z){B[0]=q;e:for(var oe=0,ne=B.length,ve=ne>>>1;oe<ve;){var Te=2*(oe+1)-1,pe=B[Te],A=Te+1,Y=B[A];if(0>r(pe,q))A<ne&&0>r(Y,pe)?(B[oe]=Y,B[A]=q,oe=A):(B[oe]=pe,B[Te]=q,oe=Te);else if(A<ne&&0>r(Y,q))B[oe]=Y,B[A]=q,oe=A;else break e}}return Z}function r(B,Z){var q=B.sortIndex-Z.sortIndex;return q!==0?q:B.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,i=a.now();e.unstable_now=function(){return a.now()-i}}var c=[],u=[],f=1,d=null,p=3,y=!1,v=!1,k=!1,w=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(B){for(var Z=n(u);Z!==null;){if(Z.callback===null)s(u);else if(Z.startTime<=B)s(u),Z.sortIndex=Z.expirationTime,t(c,Z);else break;Z=n(u)}}function C(B){if(k=!1,x(B),!v)if(n(c)!==null)v=!0,z(j);else{var Z=n(u);Z!==null&&Q(C,Z.startTime-B)}}function j(B,Z){v=!1,k&&(k=!1,m(S),S=-1),y=!0;var q=p;try{for(x(Z),d=n(c);d!==null&&(!(d.expirationTime>Z)||B&&!M());){var oe=d.callback;if(typeof oe=="function"){d.callback=null,p=d.priorityLevel;var ne=oe(d.expirationTime<=Z);Z=e.unstable_now(),typeof ne=="function"?d.callback=ne:d===n(c)&&s(c),x(Z)}else s(c);d=n(c)}if(d!==null)var ve=!0;else{var Te=n(u);Te!==null&&Q(C,Te.startTime-Z),ve=!1}return ve}finally{d=null,p=q,y=!1}}var P=!1,R=null,S=-1,T=5,E=-1;function M(){return!(e.unstable_now()-E<T)}function U(){if(R!==null){var B=e.unstable_now();E=B;var Z=!0;try{Z=R(!0,B)}finally{Z?ee():(P=!1,R=null)}}else P=!1}var ee;if(typeof h=="function")ee=function(){h(U)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,N=te.port2;te.port1.onmessage=U,ee=function(){N.postMessage(null)}}else ee=function(){w(U,0)};function z(B){R=B,P||(P=!0,ee())}function Q(B,Z){S=w(function(){B(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_continueExecution=function(){v||y||(v=!0,z(j))},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(B){switch(p){case 1:case 2:case 3:var Z=3;break;default:Z=p}var q=p;p=Z;try{return B()}finally{p=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(B,Z){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var q=p;p=B;try{return Z()}finally{p=q}},e.unstable_scheduleCallback=function(B,Z,q){var oe=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?oe+q:oe):q=oe,B){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=q+ne,B={id:f++,callback:Z,priorityLevel:B,startTime:q,expirationTime:ne,sortIndex:-1},q>oe?(B.sortIndex=q,t(u,B),n(c)===null&&B===n(u)&&(k?(m(S),S=-1):k=!0,Q(C,q-oe))):(B.sortIndex=ne,t(c,B),v||y||(v=!0,z(j))),B},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(B){var Z=p;return function(){var q=p;p=Z;try{return B.apply(this,arguments)}finally{p=q}}}})(Td);jd.exports=Td;var jh=jd.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Th=g,sn=jh;function Se(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var bd=new Set,er={};function Ns(e,t){uo(e,t),uo(e+"Capture",t)}function uo(e,t){for(er[e]=t,e=0;e<t.length;e++)bd.add(t[e])}var Un=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aa=Object.prototype.hasOwnProperty,bh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,uu={},fu={};function Mh(e){return aa.call(fu,e)?!0:aa.call(uu,e)?!1:bh.test(e)?fu[e]=!0:(uu[e]=!0,!1)}function Ah(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Eh(e,t,n,s){if(t===null||typeof t>"u"||Ah(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ut(e,t,n,s,r,o,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var Dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Dt[e]=new Ut(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Dt[t]=new Ut(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Dt[e]=new Ut(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Dt[e]=new Ut(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Dt[e]=new Ut(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Dt[e]=new Ut(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Dt[e]=new Ut(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Dt[e]=new Ut(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Dt[e]=new Ut(e,5,!1,e.toLowerCase(),null,!1,!1)});var fc=/[\-:]([a-z])/g;function dc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(fc,dc);Dt[t]=new Ut(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(fc,dc);Dt[t]=new Ut(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(fc,dc);Dt[t]=new Ut(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Dt[e]=new Ut(e,1,!1,e.toLowerCase(),null,!1,!1)});Dt.xlinkHref=new Ut("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Dt[e]=new Ut(e,1,!1,e.toLowerCase(),null,!0,!0)});function pc(e,t,n,s){var r=Dt.hasOwnProperty(t)?Dt[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Eh(t,n,r,s)&&(n=null),s||r===null?Mh(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Kn=Th.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Rr=Symbol.for("react.element"),Ws=Symbol.for("react.portal"),Us=Symbol.for("react.fragment"),hc=Symbol.for("react.strict_mode"),ca=Symbol.for("react.profiler"),Md=Symbol.for("react.provider"),Ad=Symbol.for("react.context"),xc=Symbol.for("react.forward_ref"),ua=Symbol.for("react.suspense"),fa=Symbol.for("react.suspense_list"),yc=Symbol.for("react.memo"),es=Symbol.for("react.lazy"),Ed=Symbol.for("react.offscreen"),du=Symbol.iterator;function Ro(e){return e===null||typeof e!="object"?null:(e=du&&e[du]||e["@@iterator"],typeof e=="function"?e:null)}var St=Object.assign,dl;function $o(e){if(dl===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);dl=t&&t[1]||""}return`
`+dl+e}var pl=!1;function hl(e,t){if(!e||pl)return"";pl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),a=r.length-1,i=o.length-1;1<=a&&0<=i&&r[a]!==o[i];)i--;for(;1<=a&&0<=i;a--,i--)if(r[a]!==o[i]){if(a!==1||i!==1)do if(a--,i--,0>i||r[a]!==o[i]){var c=`
`+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=a&&0<=i);break}}}finally{pl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?$o(e):""}function Ih(e){switch(e.tag){case 5:return $o(e.type);case 16:return $o("Lazy");case 13:return $o("Suspense");case 19:return $o("SuspenseList");case 0:case 2:case 15:return e=hl(e.type,!1),e;case 11:return e=hl(e.type.render,!1),e;case 1:return e=hl(e.type,!0),e;default:return""}}function da(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Us:return"Fragment";case Ws:return"Portal";case ca:return"Profiler";case hc:return"StrictMode";case ua:return"Suspense";case fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ad:return(e.displayName||"Context")+".Consumer";case Md:return(e._context.displayName||"Context")+".Provider";case xc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case yc:return t=e.displayName||null,t!==null?t:da(e.type)||"Memo";case es:t=e._payload,e=e._init;try{return da(e(t))}catch{}}return null}function _h(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return da(t);case 8:return t===hc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function xs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Id(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Oh(e){var t=Id(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(a){s=""+a,o.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Pr(e){e._valueTracker||(e._valueTracker=Oh(e))}function _d(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Id(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function yi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function pa(e,t){var n=t.checked;return St({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function pu(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=xs(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Od(e,t){t=t.checked,t!=null&&pc(e,"checked",t,!1)}function ha(e,t){Od(e,t);var n=xs(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?xa(e,t.type,n):t.hasOwnProperty("defaultValue")&&xa(e,t.type,xs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function hu(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function xa(e,t,n){(t!=="number"||yi(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Fo=Array.isArray;function oo(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+xs(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function ya(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Se(91));return St({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function xu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Se(92));if(Fo(n)){if(1<n.length)throw Error(Se(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:xs(n)}}function Ld(e,t){var n=xs(t.value),s=xs(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function yu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Nd(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ma(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Nd(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var jr,Dd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(jr=jr||document.createElement("div"),jr.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=jr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function tr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ho={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lh=["Webkit","ms","Moz","O"];Object.keys(Ho).forEach(function(e){Lh.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ho[t]=Ho[e]})});function $d(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ho.hasOwnProperty(e)&&Ho[e]?(""+t).trim():t+"px"}function Fd(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=$d(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var Nh=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ga(e,t){if(t){if(Nh[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Se(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Se(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Se(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Se(62))}}function va(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sa=null;function mc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ca=null,ro=null,io=null;function mu(e){if(e=Cr(e)){if(typeof Ca!="function")throw Error(Se(280));var t=e.stateNode;t&&(t=Zi(t),Ca(e.stateNode,e.type,t))}}function Gd(e){ro?io?io.push(e):io=[e]:ro=e}function Bd(){if(ro){var e=ro,t=io;if(io=ro=null,mu(e),t)for(e=0;e<t.length;e++)mu(t[e])}}function zd(e,t){return e(t)}function Yd(){}var xl=!1;function Hd(e,t,n){if(xl)return e(t,n);xl=!0;try{return zd(e,t,n)}finally{xl=!1,(ro!==null||io!==null)&&(Yd(),Bd())}}function nr(e,t){var n=e.stateNode;if(n===null)return null;var s=Zi(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Se(231,t,typeof n));return n}var ka=!1;if(Un)try{var Po={};Object.defineProperty(Po,"passive",{get:function(){ka=!0}}),window.addEventListener("test",Po,Po),window.removeEventListener("test",Po,Po)}catch{ka=!1}function Dh(e,t,n,s,r,o,a,i,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(f){this.onError(f)}}var Wo=!1,mi=null,gi=!1,wa=null,$h={onError:function(e){Wo=!0,mi=e}};function Fh(e,t,n,s,r,o,a,i,c){Wo=!1,mi=null,Dh.apply($h,arguments)}function Gh(e,t,n,s,r,o,a,i,c){if(Fh.apply(this,arguments),Wo){if(Wo){var u=mi;Wo=!1,mi=null}else throw Error(Se(198));gi||(gi=!0,wa=u)}}function Ds(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Wd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function gu(e){if(Ds(e)!==e)throw Error(Se(188))}function Bh(e){var t=e.alternate;if(!t){if(t=Ds(e),t===null)throw Error(Se(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return gu(r),e;if(o===s)return gu(r),t;o=o.sibling}throw Error(Se(188))}if(n.return!==s.return)n=r,s=o;else{for(var a=!1,i=r.child;i;){if(i===n){a=!0,n=r,s=o;break}if(i===s){a=!0,s=r,n=o;break}i=i.sibling}if(!a){for(i=o.child;i;){if(i===n){a=!0,n=o,s=r;break}if(i===s){a=!0,s=o,n=r;break}i=i.sibling}if(!a)throw Error(Se(189))}}if(n.alternate!==s)throw Error(Se(190))}if(n.tag!==3)throw Error(Se(188));return n.stateNode.current===n?e:t}function Ud(e){return e=Bh(e),e!==null?Xd(e):null}function Xd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Xd(e);if(t!==null)return t;e=e.sibling}return null}var Vd=sn.unstable_scheduleCallback,vu=sn.unstable_cancelCallback,zh=sn.unstable_shouldYield,Yh=sn.unstable_requestPaint,wt=sn.unstable_now,Hh=sn.unstable_getCurrentPriorityLevel,gc=sn.unstable_ImmediatePriority,qd=sn.unstable_UserBlockingPriority,vi=sn.unstable_NormalPriority,Wh=sn.unstable_LowPriority,Kd=sn.unstable_IdlePriority,Xi=null,On=null;function Uh(e){if(On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(Xi,e,void 0,(e.current.flags&128)===128)}catch{}}var jn=Math.clz32?Math.clz32:qh,Xh=Math.log,Vh=Math.LN2;function qh(e){return e>>>=0,e===0?32:31-(Xh(e)/Vh|0)|0}var Tr=64,br=4194304;function Go(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Si(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes,a=n&268435455;if(a!==0){var i=a&~r;i!==0?s=Go(i):(o&=a,o!==0&&(s=Go(o)))}else a=n&~r,a!==0?s=Go(a):o!==0&&(s=Go(o));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-jn(t),r=1<<n,s|=e[n],t&=~r;return s}function Kh(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zh(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-jn(o),i=1<<a,c=r[a];c===-1?(!(i&n)||i&s)&&(r[a]=Kh(i,t)):c<=t&&(e.expiredLanes|=i),o&=~i}}function Ra(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Zd(){var e=Tr;return Tr<<=1,!(Tr&4194240)&&(Tr=64),e}function yl(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vr(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-jn(t),e[t]=n}function Qh(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-jn(n),o=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~o}}function vc(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-jn(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var at=0;function Qd(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Jd,Sc,ep,tp,np,Pa=!1,Mr=[],is=null,ls=null,as=null,sr=new Map,or=new Map,ns=[],Jh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Su(e,t){switch(e){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":ls=null;break;case"mouseover":case"mouseout":as=null;break;case"pointerover":case"pointerout":sr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":or.delete(t.pointerId)}}function jo(e,t,n,s,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},t!==null&&(t=Cr(t),t!==null&&Sc(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function e1(e,t,n,s,r){switch(t){case"focusin":return is=jo(is,e,t,n,s,r),!0;case"dragenter":return ls=jo(ls,e,t,n,s,r),!0;case"mouseover":return as=jo(as,e,t,n,s,r),!0;case"pointerover":var o=r.pointerId;return sr.set(o,jo(sr.get(o)||null,e,t,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,or.set(o,jo(or.get(o)||null,e,t,n,s,r)),!0}return!1}function sp(e){var t=Ps(e.target);if(t!==null){var n=Ds(t);if(n!==null){if(t=n.tag,t===13){if(t=Wd(n),t!==null){e.blockedOn=t,np(e.priority,function(){ep(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function si(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=ja(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Sa=s,n.target.dispatchEvent(s),Sa=null}else return t=Cr(n),t!==null&&Sc(t),e.blockedOn=n,!1;t.shift()}return!0}function Cu(e,t,n){si(e)&&n.delete(t)}function t1(){Pa=!1,is!==null&&si(is)&&(is=null),ls!==null&&si(ls)&&(ls=null),as!==null&&si(as)&&(as=null),sr.forEach(Cu),or.forEach(Cu)}function To(e,t){e.blockedOn===t&&(e.blockedOn=null,Pa||(Pa=!0,sn.unstable_scheduleCallback(sn.unstable_NormalPriority,t1)))}function rr(e){function t(r){return To(r,e)}if(0<Mr.length){To(Mr[0],e);for(var n=1;n<Mr.length;n++){var s=Mr[n];s.blockedOn===e&&(s.blockedOn=null)}}for(is!==null&&To(is,e),ls!==null&&To(ls,e),as!==null&&To(as,e),sr.forEach(t),or.forEach(t),n=0;n<ns.length;n++)s=ns[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<ns.length&&(n=ns[0],n.blockedOn===null);)sp(n),n.blockedOn===null&&ns.shift()}var lo=Kn.ReactCurrentBatchConfig,Ci=!0;function n1(e,t,n,s){var r=at,o=lo.transition;lo.transition=null;try{at=1,Cc(e,t,n,s)}finally{at=r,lo.transition=o}}function s1(e,t,n,s){var r=at,o=lo.transition;lo.transition=null;try{at=4,Cc(e,t,n,s)}finally{at=r,lo.transition=o}}function Cc(e,t,n,s){if(Ci){var r=ja(e,t,n,s);if(r===null)jl(e,t,s,ki,n),Su(e,s);else if(e1(r,e,t,n,s))s.stopPropagation();else if(Su(e,s),t&4&&-1<Jh.indexOf(e)){for(;r!==null;){var o=Cr(r);if(o!==null&&Jd(o),o=ja(e,t,n,s),o===null&&jl(e,t,s,ki,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else jl(e,t,s,null,n)}}var ki=null;function ja(e,t,n,s){if(ki=null,e=mc(s),e=Ps(e),e!==null)if(t=Ds(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Wd(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ki=e,null}function op(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Hh()){case gc:return 1;case qd:return 4;case vi:case Wh:return 16;case Kd:return 536870912;default:return 16}default:return 16}}var os=null,kc=null,oi=null;function rp(){if(oi)return oi;var e,t=kc,n=t.length,s,r="value"in os?os.value:os.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===r[o-s];s++);return oi=r.slice(e,1<s?1-s:void 0)}function ri(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ar(){return!0}function ku(){return!1}function rn(e){function t(n,s,r,o,a){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(n=e[i],this[i]=n?n(o):o[i]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Ar:ku,this.isPropagationStopped=ku,this}return St(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ar)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ar)},persist:function(){},isPersistent:Ar}),t}var Co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wc=rn(Co),Sr=St({},Co,{view:0,detail:0}),o1=rn(Sr),ml,gl,bo,Vi=St({},Sr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==bo&&(bo&&e.type==="mousemove"?(ml=e.screenX-bo.screenX,gl=e.screenY-bo.screenY):gl=ml=0,bo=e),ml)},movementY:function(e){return"movementY"in e?e.movementY:gl}}),wu=rn(Vi),r1=St({},Vi,{dataTransfer:0}),i1=rn(r1),l1=St({},Sr,{relatedTarget:0}),vl=rn(l1),a1=St({},Co,{animationName:0,elapsedTime:0,pseudoElement:0}),c1=rn(a1),u1=St({},Co,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),f1=rn(u1),d1=St({},Co,{data:0}),Ru=rn(d1),p1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},h1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},x1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function y1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=x1[e])?!!t[e]:!1}function Rc(){return y1}var m1=St({},Sr,{key:function(e){if(e.key){var t=p1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ri(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?h1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rc,charCode:function(e){return e.type==="keypress"?ri(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ri(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),g1=rn(m1),v1=St({},Vi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pu=rn(v1),S1=St({},Sr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rc}),C1=rn(S1),k1=St({},Co,{propertyName:0,elapsedTime:0,pseudoElement:0}),w1=rn(k1),R1=St({},Vi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),P1=rn(R1),j1=[9,13,27,32],Pc=Un&&"CompositionEvent"in window,Uo=null;Un&&"documentMode"in document&&(Uo=document.documentMode);var T1=Un&&"TextEvent"in window&&!Uo,ip=Un&&(!Pc||Uo&&8<Uo&&11>=Uo),ju=String.fromCharCode(32),Tu=!1;function lp(e,t){switch(e){case"keyup":return j1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ap(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Xs=!1;function b1(e,t){switch(e){case"compositionend":return ap(t);case"keypress":return t.which!==32?null:(Tu=!0,ju);case"textInput":return e=t.data,e===ju&&Tu?null:e;default:return null}}function M1(e,t){if(Xs)return e==="compositionend"||!Pc&&lp(e,t)?(e=rp(),oi=kc=os=null,Xs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ip&&t.locale!=="ko"?null:t.data;default:return null}}var A1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!A1[e.type]:t==="textarea"}function cp(e,t,n,s){Gd(s),t=wi(t,"onChange"),0<t.length&&(n=new wc("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Xo=null,ir=null;function E1(e){Sp(e,0)}function qi(e){var t=Ks(e);if(_d(t))return e}function I1(e,t){if(e==="change")return t}var up=!1;if(Un){var Sl;if(Un){var Cl="oninput"in document;if(!Cl){var Mu=document.createElement("div");Mu.setAttribute("oninput","return;"),Cl=typeof Mu.oninput=="function"}Sl=Cl}else Sl=!1;up=Sl&&(!document.documentMode||9<document.documentMode)}function Au(){Xo&&(Xo.detachEvent("onpropertychange",fp),ir=Xo=null)}function fp(e){if(e.propertyName==="value"&&qi(ir)){var t=[];cp(t,ir,e,mc(e)),Hd(E1,t)}}function _1(e,t,n){e==="focusin"?(Au(),Xo=t,ir=n,Xo.attachEvent("onpropertychange",fp)):e==="focusout"&&Au()}function O1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return qi(ir)}function L1(e,t){if(e==="click")return qi(t)}function N1(e,t){if(e==="input"||e==="change")return qi(t)}function D1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var bn=typeof Object.is=="function"?Object.is:D1;function lr(e,t){if(bn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!aa.call(t,r)||!bn(e[r],t[r]))return!1}return!0}function Eu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Iu(e,t){var n=Eu(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Eu(n)}}function dp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?dp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function pp(){for(var e=window,t=yi();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=yi(e.document)}return t}function jc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function $1(e){var t=pp(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dp(n.ownerDocument.documentElement,n)){if(s!==null&&jc(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!e.extend&&o>s&&(r=s,s=o,o=r),r=Iu(n,o);var a=Iu(n,s);r&&a&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var F1=Un&&"documentMode"in document&&11>=document.documentMode,Vs=null,Ta=null,Vo=null,ba=!1;function _u(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ba||Vs==null||Vs!==yi(s)||(s=Vs,"selectionStart"in s&&jc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Vo&&lr(Vo,s)||(Vo=s,s=wi(Ta,"onSelect"),0<s.length&&(t=new wc("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Vs)))}function Er(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var qs={animationend:Er("Animation","AnimationEnd"),animationiteration:Er("Animation","AnimationIteration"),animationstart:Er("Animation","AnimationStart"),transitionend:Er("Transition","TransitionEnd")},kl={},hp={};Un&&(hp=document.createElement("div").style,"AnimationEvent"in window||(delete qs.animationend.animation,delete qs.animationiteration.animation,delete qs.animationstart.animation),"TransitionEvent"in window||delete qs.transitionend.transition);function Ki(e){if(kl[e])return kl[e];if(!qs[e])return e;var t=qs[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in hp)return kl[e]=t[n];return e}var xp=Ki("animationend"),yp=Ki("animationiteration"),mp=Ki("animationstart"),gp=Ki("transitionend"),vp=new Map,Ou="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vs(e,t){vp.set(e,t),Ns(t,[e])}for(var wl=0;wl<Ou.length;wl++){var Rl=Ou[wl],G1=Rl.toLowerCase(),B1=Rl[0].toUpperCase()+Rl.slice(1);vs(G1,"on"+B1)}vs(xp,"onAnimationEnd");vs(yp,"onAnimationIteration");vs(mp,"onAnimationStart");vs("dblclick","onDoubleClick");vs("focusin","onFocus");vs("focusout","onBlur");vs(gp,"onTransitionEnd");uo("onMouseEnter",["mouseout","mouseover"]);uo("onMouseLeave",["mouseout","mouseover"]);uo("onPointerEnter",["pointerout","pointerover"]);uo("onPointerLeave",["pointerout","pointerover"]);Ns("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ns("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ns("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ns("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ns("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ns("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bo));function Lu(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Gh(s,t,void 0,e),e.currentTarget=null}function Sp(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var a=s.length-1;0<=a;a--){var i=s[a],c=i.instance,u=i.currentTarget;if(i=i.listener,c!==o&&r.isPropagationStopped())break e;Lu(r,i,u),o=c}else for(a=0;a<s.length;a++){if(i=s[a],c=i.instance,u=i.currentTarget,i=i.listener,c!==o&&r.isPropagationStopped())break e;Lu(r,i,u),o=c}}}if(gi)throw e=wa,gi=!1,wa=null,e}function ft(e,t){var n=t[_a];n===void 0&&(n=t[_a]=new Set);var s=e+"__bubble";n.has(s)||(Cp(t,e,2,!1),n.add(s))}function Pl(e,t,n){var s=0;t&&(s|=4),Cp(n,e,s,t)}var Ir="_reactListening"+Math.random().toString(36).slice(2);function ar(e){if(!e[Ir]){e[Ir]=!0,bd.forEach(function(n){n!=="selectionchange"&&(z1.has(n)||Pl(n,!1,e),Pl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ir]||(t[Ir]=!0,Pl("selectionchange",!1,t))}}function Cp(e,t,n,s){switch(op(t)){case 1:var r=n1;break;case 4:r=s1;break;default:r=Cc}n=r.bind(null,t,n,e),r=void 0,!ka||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function jl(e,t,n,s,r){var o=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var i=s.stateNode.containerInfo;if(i===r||i.nodeType===8&&i.parentNode===r)break;if(a===4)for(a=s.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;i!==null;){if(a=Ps(i),a===null)return;if(c=a.tag,c===5||c===6){s=o=a;continue e}i=i.parentNode}}s=s.return}Hd(function(){var u=o,f=mc(n),d=[];e:{var p=vp.get(e);if(p!==void 0){var y=wc,v=e;switch(e){case"keypress":if(ri(n)===0)break e;case"keydown":case"keyup":y=g1;break;case"focusin":v="focus",y=vl;break;case"focusout":v="blur",y=vl;break;case"beforeblur":case"afterblur":y=vl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=wu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=i1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=C1;break;case xp:case yp:case mp:y=c1;break;case gp:y=w1;break;case"scroll":y=o1;break;case"wheel":y=P1;break;case"copy":case"cut":case"paste":y=f1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Pu}var k=(t&4)!==0,w=!k&&e==="scroll",m=k?p!==null?p+"Capture":null:p;k=[];for(var h=u,x;h!==null;){x=h;var C=x.stateNode;if(x.tag===5&&C!==null&&(x=C,m!==null&&(C=nr(h,m),C!=null&&k.push(cr(h,C,x)))),w)break;h=h.return}0<k.length&&(p=new y(p,v,null,n,f),d.push({event:p,listeners:k}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",p&&n!==Sa&&(v=n.relatedTarget||n.fromElement)&&(Ps(v)||v[Xn]))break e;if((y||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,y?(v=n.relatedTarget||n.toElement,y=u,v=v?Ps(v):null,v!==null&&(w=Ds(v),v!==w||v.tag!==5&&v.tag!==6)&&(v=null)):(y=null,v=u),y!==v)){if(k=wu,C="onMouseLeave",m="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(k=Pu,C="onPointerLeave",m="onPointerEnter",h="pointer"),w=y==null?p:Ks(y),x=v==null?p:Ks(v),p=new k(C,h+"leave",y,n,f),p.target=w,p.relatedTarget=x,C=null,Ps(f)===u&&(k=new k(m,h+"enter",v,n,f),k.target=x,k.relatedTarget=w,C=k),w=C,y&&v)t:{for(k=y,m=v,h=0,x=k;x;x=$s(x))h++;for(x=0,C=m;C;C=$s(C))x++;for(;0<h-x;)k=$s(k),h--;for(;0<x-h;)m=$s(m),x--;for(;h--;){if(k===m||m!==null&&k===m.alternate)break t;k=$s(k),m=$s(m)}k=null}else k=null;y!==null&&Nu(d,p,y,k,!1),v!==null&&w!==null&&Nu(d,w,v,k,!0)}}e:{if(p=u?Ks(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var j=I1;else if(bu(p))if(up)j=N1;else{j=O1;var P=_1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(j=L1);if(j&&(j=j(e,u))){cp(d,j,n,f);break e}P&&P(e,p,u),e==="focusout"&&(P=p._wrapperState)&&P.controlled&&p.type==="number"&&xa(p,"number",p.value)}switch(P=u?Ks(u):window,e){case"focusin":(bu(P)||P.contentEditable==="true")&&(Vs=P,Ta=u,Vo=null);break;case"focusout":Vo=Ta=Vs=null;break;case"mousedown":ba=!0;break;case"contextmenu":case"mouseup":case"dragend":ba=!1,_u(d,n,f);break;case"selectionchange":if(F1)break;case"keydown":case"keyup":_u(d,n,f)}var R;if(Pc)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Xs?lp(e,n)&&(S="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(ip&&n.locale!=="ko"&&(Xs||S!=="onCompositionStart"?S==="onCompositionEnd"&&Xs&&(R=rp()):(os=f,kc="value"in os?os.value:os.textContent,Xs=!0)),P=wi(u,S),0<P.length&&(S=new Ru(S,e,null,n,f),d.push({event:S,listeners:P}),R?S.data=R:(R=ap(n),R!==null&&(S.data=R)))),(R=T1?b1(e,n):M1(e,n))&&(u=wi(u,"onBeforeInput"),0<u.length&&(f=new Ru("onBeforeInput","beforeinput",null,n,f),d.push({event:f,listeners:u}),f.data=R))}Sp(d,t)})}function cr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function wi(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=nr(e,n),o!=null&&s.unshift(cr(e,o,r)),o=nr(e,t),o!=null&&s.push(cr(e,o,r))),e=e.return}return s}function $s(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Nu(e,t,n,s,r){for(var o=t._reactName,a=[];n!==null&&n!==s;){var i=n,c=i.alternate,u=i.stateNode;if(c!==null&&c===s)break;i.tag===5&&u!==null&&(i=u,r?(c=nr(n,o),c!=null&&a.unshift(cr(n,c,i))):r||(c=nr(n,o),c!=null&&a.push(cr(n,c,i)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var Y1=/\r\n?/g,H1=/\u0000|\uFFFD/g;function Du(e){return(typeof e=="string"?e:""+e).replace(Y1,`
`).replace(H1,"")}function _r(e,t,n){if(t=Du(t),Du(e)!==t&&n)throw Error(Se(425))}function Ri(){}var Ma=null,Aa=null;function Ea(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Ia=typeof setTimeout=="function"?setTimeout:void 0,W1=typeof clearTimeout=="function"?clearTimeout:void 0,$u=typeof Promise=="function"?Promise:void 0,U1=typeof queueMicrotask=="function"?queueMicrotask:typeof $u<"u"?function(e){return $u.resolve(null).then(e).catch(X1)}:Ia;function X1(e){setTimeout(function(){throw e})}function Tl(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),rr(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);rr(t)}function cs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Fu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ko=Math.random().toString(36).slice(2),_n="__reactFiber$"+ko,ur="__reactProps$"+ko,Xn="__reactContainer$"+ko,_a="__reactEvents$"+ko,V1="__reactListeners$"+ko,q1="__reactHandles$"+ko;function Ps(e){var t=e[_n];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Xn]||n[_n]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Fu(e);e!==null;){if(n=e[_n])return n;e=Fu(e)}return t}e=n,n=e.parentNode}return null}function Cr(e){return e=e[_n]||e[Xn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ks(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Se(33))}function Zi(e){return e[ur]||null}var Oa=[],Zs=-1;function Ss(e){return{current:e}}function dt(e){0>Zs||(e.current=Oa[Zs],Oa[Zs]=null,Zs--)}function ut(e,t){Zs++,Oa[Zs]=e.current,e.current=t}var ys={},zt=Ss(ys),qt=Ss(!1),Es=ys;function fo(e,t){var n=e.type.contextTypes;if(!n)return ys;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Kt(e){return e=e.childContextTypes,e!=null}function Pi(){dt(qt),dt(zt)}function Gu(e,t,n){if(zt.current!==ys)throw Error(Se(168));ut(zt,t),ut(qt,n)}function kp(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(Se(108,_h(e)||"Unknown",r));return St({},n,s)}function ji(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ys,Es=zt.current,ut(zt,e),ut(qt,qt.current),!0}function Bu(e,t,n){var s=e.stateNode;if(!s)throw Error(Se(169));n?(e=kp(e,t,Es),s.__reactInternalMemoizedMergedChildContext=e,dt(qt),dt(zt),ut(zt,e)):dt(qt),ut(qt,n)}var $n=null,Qi=!1,bl=!1;function wp(e){$n===null?$n=[e]:$n.push(e)}function K1(e){Qi=!0,wp(e)}function Cs(){if(!bl&&$n!==null){bl=!0;var e=0,t=at;try{var n=$n;for(at=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}$n=null,Qi=!1}catch(r){throw $n!==null&&($n=$n.slice(e+1)),Vd(gc,Cs),r}finally{at=t,bl=!1}}return null}var Qs=[],Js=0,Ti=null,bi=0,an=[],cn=0,Is=null,Gn=1,Bn="";function ws(e,t){Qs[Js++]=bi,Qs[Js++]=Ti,Ti=e,bi=t}function Rp(e,t,n){an[cn++]=Gn,an[cn++]=Bn,an[cn++]=Is,Is=e;var s=Gn;e=Bn;var r=32-jn(s)-1;s&=~(1<<r),n+=1;var o=32-jn(t)+r;if(30<o){var a=r-r%5;o=(s&(1<<a)-1).toString(32),s>>=a,r-=a,Gn=1<<32-jn(t)+r|n<<r|s,Bn=o+e}else Gn=1<<o|n<<r|s,Bn=e}function Tc(e){e.return!==null&&(ws(e,1),Rp(e,1,0))}function bc(e){for(;e===Ti;)Ti=Qs[--Js],Qs[Js]=null,bi=Qs[--Js],Qs[Js]=null;for(;e===Is;)Is=an[--cn],an[cn]=null,Bn=an[--cn],an[cn]=null,Gn=an[--cn],an[cn]=null}var nn=null,tn=null,pt=!1,gn=null;function Pp(e,t){var n=un(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function zu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,nn=e,tn=cs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,nn=e,tn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Is!==null?{id:Gn,overflow:Bn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=un(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,nn=e,tn=null,!0):!1;default:return!1}}function La(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Na(e){if(pt){var t=tn;if(t){var n=t;if(!zu(e,t)){if(La(e))throw Error(Se(418));t=cs(n.nextSibling);var s=nn;t&&zu(e,t)?Pp(s,n):(e.flags=e.flags&-4097|2,pt=!1,nn=e)}}else{if(La(e))throw Error(Se(418));e.flags=e.flags&-4097|2,pt=!1,nn=e}}}function Yu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;nn=e}function Or(e){if(e!==nn)return!1;if(!pt)return Yu(e),pt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ea(e.type,e.memoizedProps)),t&&(t=tn)){if(La(e))throw jp(),Error(Se(418));for(;t;)Pp(e,t),t=cs(t.nextSibling)}if(Yu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Se(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){tn=cs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}tn=null}}else tn=nn?cs(e.stateNode.nextSibling):null;return!0}function jp(){for(var e=tn;e;)e=cs(e.nextSibling)}function po(){tn=nn=null,pt=!1}function Mc(e){gn===null?gn=[e]:gn.push(e)}var Z1=Kn.ReactCurrentBatchConfig;function Mo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Se(309));var s=n.stateNode}if(!s)throw Error(Se(147,e));var r=s,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(a){var i=r.refs;a===null?delete i[o]:i[o]=a},t._stringRef=o,t)}if(typeof e!="string")throw Error(Se(284));if(!n._owner)throw Error(Se(290,e))}return e}function Lr(e,t){throw e=Object.prototype.toString.call(t),Error(Se(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Hu(e){var t=e._init;return t(e._payload)}function Tp(e){function t(m,h){if(e){var x=m.deletions;x===null?(m.deletions=[h],m.flags|=16):x.push(h)}}function n(m,h){if(!e)return null;for(;h!==null;)t(m,h),h=h.sibling;return null}function s(m,h){for(m=new Map;h!==null;)h.key!==null?m.set(h.key,h):m.set(h.index,h),h=h.sibling;return m}function r(m,h){return m=ps(m,h),m.index=0,m.sibling=null,m}function o(m,h,x){return m.index=x,e?(x=m.alternate,x!==null?(x=x.index,x<h?(m.flags|=2,h):x):(m.flags|=2,h)):(m.flags|=1048576,h)}function a(m){return e&&m.alternate===null&&(m.flags|=2),m}function i(m,h,x,C){return h===null||h.tag!==6?(h=Ll(x,m.mode,C),h.return=m,h):(h=r(h,x),h.return=m,h)}function c(m,h,x,C){var j=x.type;return j===Us?f(m,h,x.props.children,C,x.key):h!==null&&(h.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===es&&Hu(j)===h.type)?(C=r(h,x.props),C.ref=Mo(m,h,x),C.return=m,C):(C=di(x.type,x.key,x.props,null,m.mode,C),C.ref=Mo(m,h,x),C.return=m,C)}function u(m,h,x,C){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=Nl(x,m.mode,C),h.return=m,h):(h=r(h,x.children||[]),h.return=m,h)}function f(m,h,x,C,j){return h===null||h.tag!==7?(h=As(x,m.mode,C,j),h.return=m,h):(h=r(h,x),h.return=m,h)}function d(m,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Ll(""+h,m.mode,x),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Rr:return x=di(h.type,h.key,h.props,null,m.mode,x),x.ref=Mo(m,null,h),x.return=m,x;case Ws:return h=Nl(h,m.mode,x),h.return=m,h;case es:var C=h._init;return d(m,C(h._payload),x)}if(Fo(h)||Ro(h))return h=As(h,m.mode,x,null),h.return=m,h;Lr(m,h)}return null}function p(m,h,x,C){var j=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return j!==null?null:i(m,h,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Rr:return x.key===j?c(m,h,x,C):null;case Ws:return x.key===j?u(m,h,x,C):null;case es:return j=x._init,p(m,h,j(x._payload),C)}if(Fo(x)||Ro(x))return j!==null?null:f(m,h,x,C,null);Lr(m,x)}return null}function y(m,h,x,C,j){if(typeof C=="string"&&C!==""||typeof C=="number")return m=m.get(x)||null,i(h,m,""+C,j);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Rr:return m=m.get(C.key===null?x:C.key)||null,c(h,m,C,j);case Ws:return m=m.get(C.key===null?x:C.key)||null,u(h,m,C,j);case es:var P=C._init;return y(m,h,x,P(C._payload),j)}if(Fo(C)||Ro(C))return m=m.get(x)||null,f(h,m,C,j,null);Lr(h,C)}return null}function v(m,h,x,C){for(var j=null,P=null,R=h,S=h=0,T=null;R!==null&&S<x.length;S++){R.index>S?(T=R,R=null):T=R.sibling;var E=p(m,R,x[S],C);if(E===null){R===null&&(R=T);break}e&&R&&E.alternate===null&&t(m,R),h=o(E,h,S),P===null?j=E:P.sibling=E,P=E,R=T}if(S===x.length)return n(m,R),pt&&ws(m,S),j;if(R===null){for(;S<x.length;S++)R=d(m,x[S],C),R!==null&&(h=o(R,h,S),P===null?j=R:P.sibling=R,P=R);return pt&&ws(m,S),j}for(R=s(m,R);S<x.length;S++)T=y(R,m,S,x[S],C),T!==null&&(e&&T.alternate!==null&&R.delete(T.key===null?S:T.key),h=o(T,h,S),P===null?j=T:P.sibling=T,P=T);return e&&R.forEach(function(M){return t(m,M)}),pt&&ws(m,S),j}function k(m,h,x,C){var j=Ro(x);if(typeof j!="function")throw Error(Se(150));if(x=j.call(x),x==null)throw Error(Se(151));for(var P=j=null,R=h,S=h=0,T=null,E=x.next();R!==null&&!E.done;S++,E=x.next()){R.index>S?(T=R,R=null):T=R.sibling;var M=p(m,R,E.value,C);if(M===null){R===null&&(R=T);break}e&&R&&M.alternate===null&&t(m,R),h=o(M,h,S),P===null?j=M:P.sibling=M,P=M,R=T}if(E.done)return n(m,R),pt&&ws(m,S),j;if(R===null){for(;!E.done;S++,E=x.next())E=d(m,E.value,C),E!==null&&(h=o(E,h,S),P===null?j=E:P.sibling=E,P=E);return pt&&ws(m,S),j}for(R=s(m,R);!E.done;S++,E=x.next())E=y(R,m,S,E.value,C),E!==null&&(e&&E.alternate!==null&&R.delete(E.key===null?S:E.key),h=o(E,h,S),P===null?j=E:P.sibling=E,P=E);return e&&R.forEach(function(U){return t(m,U)}),pt&&ws(m,S),j}function w(m,h,x,C){if(typeof x=="object"&&x!==null&&x.type===Us&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Rr:e:{for(var j=x.key,P=h;P!==null;){if(P.key===j){if(j=x.type,j===Us){if(P.tag===7){n(m,P.sibling),h=r(P,x.props.children),h.return=m,m=h;break e}}else if(P.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===es&&Hu(j)===P.type){n(m,P.sibling),h=r(P,x.props),h.ref=Mo(m,P,x),h.return=m,m=h;break e}n(m,P);break}else t(m,P);P=P.sibling}x.type===Us?(h=As(x.props.children,m.mode,C,x.key),h.return=m,m=h):(C=di(x.type,x.key,x.props,null,m.mode,C),C.ref=Mo(m,h,x),C.return=m,m=C)}return a(m);case Ws:e:{for(P=x.key;h!==null;){if(h.key===P)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(m,h.sibling),h=r(h,x.children||[]),h.return=m,m=h;break e}else{n(m,h);break}else t(m,h);h=h.sibling}h=Nl(x,m.mode,C),h.return=m,m=h}return a(m);case es:return P=x._init,w(m,h,P(x._payload),C)}if(Fo(x))return v(m,h,x,C);if(Ro(x))return k(m,h,x,C);Lr(m,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(m,h.sibling),h=r(h,x),h.return=m,m=h):(n(m,h),h=Ll(x,m.mode,C),h.return=m,m=h),a(m)):n(m,h)}return w}var ho=Tp(!0),bp=Tp(!1),Mi=Ss(null),Ai=null,eo=null,Ac=null;function Ec(){Ac=eo=Ai=null}function Ic(e){var t=Mi.current;dt(Mi),e._currentValue=t}function Da(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function ao(e,t){Ai=e,Ac=eo=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Vt=!0),e.firstContext=null)}function dn(e){var t=e._currentValue;if(Ac!==e)if(e={context:e,memoizedValue:t,next:null},eo===null){if(Ai===null)throw Error(Se(308));eo=e,Ai.dependencies={lanes:0,firstContext:e}}else eo=eo.next=e;return t}var js=null;function _c(e){js===null?js=[e]:js.push(e)}function Mp(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,_c(t)):(n.next=r.next,r.next=n),t.interleaved=n,Vn(e,s)}function Vn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ts=!1;function Oc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ap(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Hn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function us(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,st&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Vn(e,n)}return r=s.interleaved,r===null?(t.next=t,_c(s)):(t.next=r.next,r.next=t),s.interleaved=t,Vn(e,n)}function ii(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,vc(e,n)}}function Wu(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=a:o=o.next=a,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ei(e,t,n,s){var r=e.updateQueue;ts=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,i=r.shared.pending;if(i!==null){r.shared.pending=null;var c=i,u=c.next;c.next=null,a===null?o=u:a.next=u,a=c;var f=e.alternate;f!==null&&(f=f.updateQueue,i=f.lastBaseUpdate,i!==a&&(i===null?f.firstBaseUpdate=u:i.next=u,f.lastBaseUpdate=c))}if(o!==null){var d=r.baseState;a=0,f=u=c=null,i=o;do{var p=i.lane,y=i.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:y,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var v=e,k=i;switch(p=t,y=n,k.tag){case 1:if(v=k.payload,typeof v=="function"){d=v.call(y,d,p);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=k.payload,p=typeof v=="function"?v.call(y,d,p):v,p==null)break e;d=St({},d,p);break e;case 2:ts=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,p=r.effects,p===null?r.effects=[i]:p.push(i))}else y={eventTime:y,lane:p,tag:i.tag,payload:i.payload,callback:i.callback,next:null},f===null?(u=f=y,c=d):f=f.next=y,a|=p;if(i=i.next,i===null){if(i=r.shared.pending,i===null)break;p=i,i=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(f===null&&(c=d),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=f,t=r.shared.interleaved,t!==null){r=t;do a|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Os|=a,e.lanes=a,e.memoizedState=d}}function Uu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(Se(191,r));r.call(s)}}}var kr={},Ln=Ss(kr),fr=Ss(kr),dr=Ss(kr);function Ts(e){if(e===kr)throw Error(Se(174));return e}function Lc(e,t){switch(ut(dr,t),ut(fr,e),ut(Ln,kr),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ma(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ma(t,e)}dt(Ln),ut(Ln,t)}function xo(){dt(Ln),dt(fr),dt(dr)}function Ep(e){Ts(dr.current);var t=Ts(Ln.current),n=ma(t,e.type);t!==n&&(ut(fr,e),ut(Ln,n))}function Nc(e){fr.current===e&&(dt(Ln),dt(fr))}var mt=Ss(0);function Ii(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ml=[];function Dc(){for(var e=0;e<Ml.length;e++)Ml[e]._workInProgressVersionPrimary=null;Ml.length=0}var li=Kn.ReactCurrentDispatcher,Al=Kn.ReactCurrentBatchConfig,_s=0,vt=null,bt=null,At=null,_i=!1,qo=!1,pr=0,Q1=0;function $t(){throw Error(Se(321))}function $c(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!bn(e[n],t[n]))return!1;return!0}function Fc(e,t,n,s,r,o){if(_s=o,vt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,li.current=e===null||e.memoizedState===null?nx:sx,e=n(s,r),qo){o=0;do{if(qo=!1,pr=0,25<=o)throw Error(Se(301));o+=1,At=bt=null,t.updateQueue=null,li.current=ox,e=n(s,r)}while(qo)}if(li.current=Oi,t=bt!==null&&bt.next!==null,_s=0,At=bt=vt=null,_i=!1,t)throw Error(Se(300));return e}function Gc(){var e=pr!==0;return pr=0,e}function An(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return At===null?vt.memoizedState=At=e:At=At.next=e,At}function pn(){if(bt===null){var e=vt.alternate;e=e!==null?e.memoizedState:null}else e=bt.next;var t=At===null?vt.memoizedState:At.next;if(t!==null)At=t,bt=e;else{if(e===null)throw Error(Se(310));bt=e,e={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},At===null?vt.memoizedState=At=e:At=At.next=e}return At}function hr(e,t){return typeof t=="function"?t(e):t}function El(e){var t=pn(),n=t.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=e;var s=bt,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var a=r.next;r.next=o.next,o.next=a}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var i=a=null,c=null,u=o;do{var f=u.lane;if((_s&f)===f)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var d={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(i=c=d,a=s):c=c.next=d,vt.lanes|=f,Os|=f}u=u.next}while(u!==null&&u!==o);c===null?a=s:c.next=i,bn(s,t.memoizedState)||(Vt=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=c,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do o=r.lane,vt.lanes|=o,Os|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Il(e){var t=pn(),n=t.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var a=r=r.next;do o=e(o,a.action),a=a.next;while(a!==r);bn(o,t.memoizedState)||(Vt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function Ip(){}function _p(e,t){var n=vt,s=pn(),r=t(),o=!bn(s.memoizedState,r);if(o&&(s.memoizedState=r,Vt=!0),s=s.queue,Bc(Np.bind(null,n,s,e),[e]),s.getSnapshot!==t||o||At!==null&&At.memoizedState.tag&1){if(n.flags|=2048,xr(9,Lp.bind(null,n,s,r,t),void 0,null),It===null)throw Error(Se(349));_s&30||Op(n,t,r)}return r}function Op(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Lp(e,t,n,s){t.value=n,t.getSnapshot=s,Dp(t)&&$p(e)}function Np(e,t,n){return n(function(){Dp(t)&&$p(e)})}function Dp(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!bn(e,n)}catch{return!0}}function $p(e){var t=Vn(e,1);t!==null&&Tn(t,e,1,-1)}function Xu(e){var t=An();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hr,lastRenderedState:e},t.queue=e,e=e.dispatch=tx.bind(null,vt,e),[t.memoizedState,e]}function xr(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Fp(){return pn().memoizedState}function ai(e,t,n,s){var r=An();vt.flags|=e,r.memoizedState=xr(1|t,n,void 0,s===void 0?null:s)}function Ji(e,t,n,s){var r=pn();s=s===void 0?null:s;var o=void 0;if(bt!==null){var a=bt.memoizedState;if(o=a.destroy,s!==null&&$c(s,a.deps)){r.memoizedState=xr(t,n,o,s);return}}vt.flags|=e,r.memoizedState=xr(1|t,n,o,s)}function Vu(e,t){return ai(8390656,8,e,t)}function Bc(e,t){return Ji(2048,8,e,t)}function Gp(e,t){return Ji(4,2,e,t)}function Bp(e,t){return Ji(4,4,e,t)}function zp(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Yp(e,t,n){return n=n!=null?n.concat([e]):null,Ji(4,4,zp.bind(null,t,e),n)}function zc(){}function Hp(e,t){var n=pn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&$c(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Wp(e,t){var n=pn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&$c(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Up(e,t,n){return _s&21?(bn(n,t)||(n=Zd(),vt.lanes|=n,Os|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Vt=!0),e.memoizedState=n)}function J1(e,t){var n=at;at=n!==0&&4>n?n:4,e(!0);var s=Al.transition;Al.transition={};try{e(!1),t()}finally{at=n,Al.transition=s}}function Xp(){return pn().memoizedState}function ex(e,t,n){var s=ds(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Vp(e))qp(t,n);else if(n=Mp(e,t,n,s),n!==null){var r=Ht();Tn(n,e,s,r),Kp(n,t,s)}}function tx(e,t,n){var s=ds(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Vp(e))qp(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var a=t.lastRenderedState,i=o(a,n);if(r.hasEagerState=!0,r.eagerState=i,bn(i,a)){var c=t.interleaved;c===null?(r.next=r,_c(t)):(r.next=c.next,c.next=r),t.interleaved=r;return}}catch{}finally{}n=Mp(e,t,r,s),n!==null&&(r=Ht(),Tn(n,e,s,r),Kp(n,t,s))}}function Vp(e){var t=e.alternate;return e===vt||t!==null&&t===vt}function qp(e,t){qo=_i=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Kp(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,vc(e,n)}}var Oi={readContext:dn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},nx={readContext:dn,useCallback:function(e,t){return An().memoizedState=[e,t===void 0?null:t],e},useContext:dn,useEffect:Vu,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,ai(4194308,4,zp.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ai(4194308,4,e,t)},useInsertionEffect:function(e,t){return ai(4,2,e,t)},useMemo:function(e,t){var n=An();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=An();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=ex.bind(null,vt,e),[s.memoizedState,e]},useRef:function(e){var t=An();return e={current:e},t.memoizedState=e},useState:Xu,useDebugValue:zc,useDeferredValue:function(e){return An().memoizedState=e},useTransition:function(){var e=Xu(!1),t=e[0];return e=J1.bind(null,e[1]),An().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=vt,r=An();if(pt){if(n===void 0)throw Error(Se(407));n=n()}else{if(n=t(),It===null)throw Error(Se(349));_s&30||Op(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Vu(Np.bind(null,s,o,e),[e]),s.flags|=2048,xr(9,Lp.bind(null,s,o,n,t),void 0,null),n},useId:function(){var e=An(),t=It.identifierPrefix;if(pt){var n=Bn,s=Gn;n=(s&~(1<<32-jn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=pr++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=Q1++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},sx={readContext:dn,useCallback:Hp,useContext:dn,useEffect:Bc,useImperativeHandle:Yp,useInsertionEffect:Gp,useLayoutEffect:Bp,useMemo:Wp,useReducer:El,useRef:Fp,useState:function(){return El(hr)},useDebugValue:zc,useDeferredValue:function(e){var t=pn();return Up(t,bt.memoizedState,e)},useTransition:function(){var e=El(hr)[0],t=pn().memoizedState;return[e,t]},useMutableSource:Ip,useSyncExternalStore:_p,useId:Xp,unstable_isNewReconciler:!1},ox={readContext:dn,useCallback:Hp,useContext:dn,useEffect:Bc,useImperativeHandle:Yp,useInsertionEffect:Gp,useLayoutEffect:Bp,useMemo:Wp,useReducer:Il,useRef:Fp,useState:function(){return Il(hr)},useDebugValue:zc,useDeferredValue:function(e){var t=pn();return bt===null?t.memoizedState=e:Up(t,bt.memoizedState,e)},useTransition:function(){var e=Il(hr)[0],t=pn().memoizedState;return[e,t]},useMutableSource:Ip,useSyncExternalStore:_p,useId:Xp,unstable_isNewReconciler:!1};function yn(e,t){if(e&&e.defaultProps){t=St({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function $a(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:St({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var el={isMounted:function(e){return(e=e._reactInternals)?Ds(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Ht(),r=ds(e),o=Hn(s,r);o.payload=t,n!=null&&(o.callback=n),t=us(e,o,r),t!==null&&(Tn(t,e,r,s),ii(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Ht(),r=ds(e),o=Hn(s,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=us(e,o,r),t!==null&&(Tn(t,e,r,s),ii(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ht(),s=ds(e),r=Hn(n,s);r.tag=2,t!=null&&(r.callback=t),t=us(e,r,s),t!==null&&(Tn(t,e,s,n),ii(t,e,s))}};function qu(e,t,n,s,r,o,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,o,a):t.prototype&&t.prototype.isPureReactComponent?!lr(n,s)||!lr(r,o):!0}function Zp(e,t,n){var s=!1,r=ys,o=t.contextType;return typeof o=="object"&&o!==null?o=dn(o):(r=Kt(t)?Es:zt.current,s=t.contextTypes,o=(s=s!=null)?fo(e,r):ys),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=el,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Ku(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&el.enqueueReplaceState(t,t.state,null)}function Fa(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Oc(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=dn(o):(o=Kt(t)?Es:zt.current,r.context=fo(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&($a(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&el.enqueueReplaceState(r,r.state,null),Ei(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function yo(e,t){try{var n="",s=t;do n+=Ih(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function _l(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ga(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var rx=typeof WeakMap=="function"?WeakMap:Map;function Qp(e,t,n){n=Hn(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Ni||(Ni=!0,Ka=s),Ga(e,t)},n}function Jp(e,t,n){n=Hn(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Ga(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Ga(e,t),typeof s!="function"&&(fs===null?fs=new Set([this]):fs.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function Zu(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new rx;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=vx.bind(null,e,t,n),t.then(e,e))}function Qu(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ju(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Hn(-1,1),t.tag=2,us(n,t,1))),n.lanes|=1),e)}var ix=Kn.ReactCurrentOwner,Vt=!1;function Yt(e,t,n,s){t.child=e===null?bp(t,null,n,s):ho(t,e.child,n,s)}function ef(e,t,n,s,r){n=n.render;var o=t.ref;return ao(t,r),s=Fc(e,t,n,s,o,r),n=Gc(),e!==null&&!Vt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qn(e,t,r)):(pt&&n&&Tc(t),t.flags|=1,Yt(e,t,s,r),t.child)}function tf(e,t,n,s,r){if(e===null){var o=n.type;return typeof o=="function"&&!Kc(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,e0(e,t,o,s,r)):(e=di(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var a=o.memoizedProps;if(n=n.compare,n=n!==null?n:lr,n(a,s)&&e.ref===t.ref)return qn(e,t,r)}return t.flags|=1,e=ps(o,s),e.ref=t.ref,e.return=t,t.child=e}function e0(e,t,n,s,r){if(e!==null){var o=e.memoizedProps;if(lr(o,s)&&e.ref===t.ref)if(Vt=!1,t.pendingProps=s=o,(e.lanes&r)!==0)e.flags&131072&&(Vt=!0);else return t.lanes=e.lanes,qn(e,t,r)}return Ba(e,t,n,s,r)}function t0(e,t,n){var s=t.pendingProps,r=s.children,o=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut(no,Jt),Jt|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ut(no,Jt),Jt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,ut(no,Jt),Jt|=s}else o!==null?(s=o.baseLanes|n,t.memoizedState=null):s=n,ut(no,Jt),Jt|=s;return Yt(e,t,r,n),t.child}function n0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ba(e,t,n,s,r){var o=Kt(n)?Es:zt.current;return o=fo(t,o),ao(t,r),n=Fc(e,t,n,s,o,r),s=Gc(),e!==null&&!Vt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qn(e,t,r)):(pt&&s&&Tc(t),t.flags|=1,Yt(e,t,n,r),t.child)}function nf(e,t,n,s,r){if(Kt(n)){var o=!0;ji(t)}else o=!1;if(ao(t,r),t.stateNode===null)ci(e,t),Zp(t,n,s),Fa(t,n,s,r),s=!0;else if(e===null){var a=t.stateNode,i=t.memoizedProps;a.props=i;var c=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=dn(u):(u=Kt(n)?Es:zt.current,u=fo(t,u));var f=n.getDerivedStateFromProps,d=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(i!==s||c!==u)&&Ku(t,a,s,u),ts=!1;var p=t.memoizedState;a.state=p,Ei(t,s,a,r),c=t.memoizedState,i!==s||p!==c||qt.current||ts?(typeof f=="function"&&($a(t,n,f,s),c=t.memoizedState),(i=ts||qu(t,n,i,s,p,c,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),a.props=s,a.state=c,a.context=u,s=i):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,Ap(e,t),i=t.memoizedProps,u=t.type===t.elementType?i:yn(t.type,i),a.props=u,d=t.pendingProps,p=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=dn(c):(c=Kt(n)?Es:zt.current,c=fo(t,c));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(i!==d||p!==c)&&Ku(t,a,s,c),ts=!1,p=t.memoizedState,a.state=p,Ei(t,s,a,r);var v=t.memoizedState;i!==d||p!==v||qt.current||ts?(typeof y=="function"&&($a(t,n,y,s),v=t.memoizedState),(u=ts||qu(t,n,u,s,p,v,c)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,v,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,v,c)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=v),a.props=s,a.state=v,a.context=c,s=u):(typeof a.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return za(e,t,n,s,o,r)}function za(e,t,n,s,r,o){n0(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return r&&Bu(t,n,!1),qn(e,t,o);s=t.stateNode,ix.current=t;var i=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=ho(t,e.child,null,o),t.child=ho(t,null,i,o)):Yt(e,t,i,o),t.memoizedState=s.state,r&&Bu(t,n,!0),t.child}function s0(e){var t=e.stateNode;t.pendingContext?Gu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Gu(e,t.context,!1),Lc(e,t.containerInfo)}function sf(e,t,n,s,r){return po(),Mc(r),t.flags|=256,Yt(e,t,n,s),t.child}var Ya={dehydrated:null,treeContext:null,retryLane:0};function Ha(e){return{baseLanes:e,cachePool:null,transitions:null}}function o0(e,t,n){var s=t.pendingProps,r=mt.current,o=!1,a=(t.flags&128)!==0,i;if((i=a)||(i=e!==null&&e.memoizedState===null?!1:(r&2)!==0),i?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),ut(mt,r&1),e===null)return Na(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,o?(s=t.mode,o=t.child,a={mode:"hidden",children:a},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=sl(a,s,0,null),e=As(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Ha(n),t.memoizedState=Ya,e):Yc(t,a));if(r=e.memoizedState,r!==null&&(i=r.dehydrated,i!==null))return lx(e,t,a,s,i,r,n);if(o){o=s.fallback,a=t.mode,r=e.child,i=r.sibling;var c={mode:"hidden",children:s.children};return!(a&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=c,t.deletions=null):(s=ps(r,c),s.subtreeFlags=r.subtreeFlags&14680064),i!==null?o=ps(i,o):(o=As(o,a,n,null),o.flags|=2),o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,a=e.child.memoizedState,a=a===null?Ha(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=e.childLanes&~n,t.memoizedState=Ya,s}return o=e.child,e=o.sibling,s=ps(o,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Yc(e,t){return t=sl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Nr(e,t,n,s){return s!==null&&Mc(s),ho(t,e.child,null,n),e=Yc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function lx(e,t,n,s,r,o,a){if(n)return t.flags&256?(t.flags&=-257,s=_l(Error(Se(422))),Nr(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=s.fallback,r=t.mode,s=sl({mode:"visible",children:s.children},r,0,null),o=As(o,r,a,null),o.flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,t.mode&1&&ho(t,e.child,null,a),t.child.memoizedState=Ha(a),t.memoizedState=Ya,o);if(!(t.mode&1))return Nr(e,t,a,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var i=s.dgst;return s=i,o=Error(Se(419)),s=_l(o,s,void 0),Nr(e,t,a,s)}if(i=(a&e.childLanes)!==0,Vt||i){if(s=It,s!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|a)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Vn(e,r),Tn(s,e,r,-1))}return qc(),s=_l(Error(Se(421))),Nr(e,t,a,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=Sx.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,tn=cs(r.nextSibling),nn=t,pt=!0,gn=null,e!==null&&(an[cn++]=Gn,an[cn++]=Bn,an[cn++]=Is,Gn=e.id,Bn=e.overflow,Is=t),t=Yc(t,s.children),t.flags|=4096,t)}function of(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Da(e.return,t,n)}function Ol(e,t,n,s,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function r0(e,t,n){var s=t.pendingProps,r=s.revealOrder,o=s.tail;if(Yt(e,t,s.children,n),s=mt.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&of(e,n,t);else if(e.tag===19)of(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ut(mt,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&Ii(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ol(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&Ii(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ol(t,!0,n,null,o);break;case"together":Ol(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ci(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Os|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Se(153));if(t.child!==null){for(e=t.child,n=ps(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ps(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function ax(e,t,n){switch(t.tag){case 3:s0(t),po();break;case 5:Ep(t);break;case 1:Kt(t.type)&&ji(t);break;case 4:Lc(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;ut(Mi,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(ut(mt,mt.current&1),t.flags|=128,null):n&t.child.childLanes?o0(e,t,n):(ut(mt,mt.current&1),e=qn(e,t,n),e!==null?e.sibling:null);ut(mt,mt.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return r0(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ut(mt,mt.current),s)break;return null;case 22:case 23:return t.lanes=0,t0(e,t,n)}return qn(e,t,n)}var i0,Wa,l0,a0;i0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Wa=function(){};l0=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Ts(Ln.current);var o=null;switch(n){case"input":r=pa(e,r),s=pa(e,s),o=[];break;case"select":r=St({},r,{value:void 0}),s=St({},s,{value:void 0}),o=[];break;case"textarea":r=ya(e,r),s=ya(e,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=Ri)}ga(n,s);var a;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var i=r[u];for(a in i)i.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(er.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var c=s[u];if(i=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&c!==i&&(c!=null||i!=null))if(u==="style")if(i){for(a in i)!i.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&i[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(o||(o=[]),o.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,i=i?i.__html:void 0,c!=null&&i!==c&&(o=o||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(er.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&ft("scroll",e),o||i===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};a0=function(e,t,n,s){n!==s&&(t.flags|=4)};function Ao(e,t){if(!pt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Ft(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function cx(e,t,n){var s=t.pendingProps;switch(bc(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ft(t),null;case 1:return Kt(t.type)&&Pi(),Ft(t),null;case 3:return s=t.stateNode,xo(),dt(qt),dt(zt),Dc(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Or(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,gn!==null&&(Ja(gn),gn=null))),Wa(e,t),Ft(t),null;case 5:Nc(t);var r=Ts(dr.current);if(n=t.type,e!==null&&t.stateNode!=null)l0(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(Se(166));return Ft(t),null}if(e=Ts(Ln.current),Or(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[_n]=t,s[ur]=o,e=(t.mode&1)!==0,n){case"dialog":ft("cancel",s),ft("close",s);break;case"iframe":case"object":case"embed":ft("load",s);break;case"video":case"audio":for(r=0;r<Bo.length;r++)ft(Bo[r],s);break;case"source":ft("error",s);break;case"img":case"image":case"link":ft("error",s),ft("load",s);break;case"details":ft("toggle",s);break;case"input":pu(s,o),ft("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},ft("invalid",s);break;case"textarea":xu(s,o),ft("invalid",s)}ga(n,o),r=null;for(var a in o)if(o.hasOwnProperty(a)){var i=o[a];a==="children"?typeof i=="string"?s.textContent!==i&&(o.suppressHydrationWarning!==!0&&_r(s.textContent,i,e),r=["children",i]):typeof i=="number"&&s.textContent!==""+i&&(o.suppressHydrationWarning!==!0&&_r(s.textContent,i,e),r=["children",""+i]):er.hasOwnProperty(a)&&i!=null&&a==="onScroll"&&ft("scroll",s)}switch(n){case"input":Pr(s),hu(s,o,!0);break;case"textarea":Pr(s),yu(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=Ri)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Nd(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[_n]=t,e[ur]=s,i0(e,t,!1,!1),t.stateNode=e;e:{switch(a=va(n,s),n){case"dialog":ft("cancel",e),ft("close",e),r=s;break;case"iframe":case"object":case"embed":ft("load",e),r=s;break;case"video":case"audio":for(r=0;r<Bo.length;r++)ft(Bo[r],e);r=s;break;case"source":ft("error",e),r=s;break;case"img":case"image":case"link":ft("error",e),ft("load",e),r=s;break;case"details":ft("toggle",e),r=s;break;case"input":pu(e,s),r=pa(e,s),ft("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=St({},s,{value:void 0}),ft("invalid",e);break;case"textarea":xu(e,s),r=ya(e,s),ft("invalid",e);break;default:r=s}ga(n,r),i=r;for(o in i)if(i.hasOwnProperty(o)){var c=i[o];o==="style"?Fd(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Dd(e,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&tr(e,c):typeof c=="number"&&tr(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(er.hasOwnProperty(o)?c!=null&&o==="onScroll"&&ft("scroll",e):c!=null&&pc(e,o,c,a))}switch(n){case"input":Pr(e),hu(e,s,!1);break;case"textarea":Pr(e),yu(e);break;case"option":s.value!=null&&e.setAttribute("value",""+xs(s.value));break;case"select":e.multiple=!!s.multiple,o=s.value,o!=null?oo(e,!!s.multiple,o,!1):s.defaultValue!=null&&oo(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=Ri)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ft(t),null;case 6:if(e&&t.stateNode!=null)a0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(Se(166));if(n=Ts(dr.current),Ts(Ln.current),Or(t)){if(s=t.stateNode,n=t.memoizedProps,s[_n]=t,(o=s.nodeValue!==n)&&(e=nn,e!==null))switch(e.tag){case 3:_r(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&_r(s.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[_n]=t,t.stateNode=s}return Ft(t),null;case 13:if(dt(mt),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(pt&&tn!==null&&t.mode&1&&!(t.flags&128))jp(),po(),t.flags|=98560,o=!1;else if(o=Or(t),s!==null&&s.dehydrated!==null){if(e===null){if(!o)throw Error(Se(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Se(317));o[_n]=t}else po(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ft(t),o=!1}else gn!==null&&(Ja(gn),gn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||mt.current&1?Mt===0&&(Mt=3):qc())),t.updateQueue!==null&&(t.flags|=4),Ft(t),null);case 4:return xo(),Wa(e,t),e===null&&ar(t.stateNode.containerInfo),Ft(t),null;case 10:return Ic(t.type._context),Ft(t),null;case 17:return Kt(t.type)&&Pi(),Ft(t),null;case 19:if(dt(mt),o=t.memoizedState,o===null)return Ft(t),null;if(s=(t.flags&128)!==0,a=o.rendering,a===null)if(s)Ao(o,!1);else{if(Mt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=Ii(e),a!==null){for(t.flags|=128,Ao(o,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)o=n,e=s,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,e=a.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ut(mt,mt.current&1|2),t.child}e=e.sibling}o.tail!==null&&wt()>mo&&(t.flags|=128,s=!0,Ao(o,!1),t.lanes=4194304)}else{if(!s)if(e=Ii(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ao(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!pt)return Ft(t),null}else 2*wt()-o.renderingStartTime>mo&&n!==1073741824&&(t.flags|=128,s=!0,Ao(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(n=o.last,n!==null?n.sibling=a:t.child=a,o.last=a)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=wt(),t.sibling=null,n=mt.current,ut(mt,s?n&1|2:n&1),t):(Ft(t),null);case 22:case 23:return Vc(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Jt&1073741824&&(Ft(t),t.subtreeFlags&6&&(t.flags|=8192)):Ft(t),null;case 24:return null;case 25:return null}throw Error(Se(156,t.tag))}function ux(e,t){switch(bc(t),t.tag){case 1:return Kt(t.type)&&Pi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return xo(),dt(qt),dt(zt),Dc(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Nc(t),null;case 13:if(dt(mt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Se(340));po()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return dt(mt),null;case 4:return xo(),null;case 10:return Ic(t.type._context),null;case 22:case 23:return Vc(),null;case 24:return null;default:return null}}var Dr=!1,Gt=!1,fx=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function to(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){kt(e,t,s)}else n.current=null}function Ua(e,t,n){try{n()}catch(s){kt(e,t,s)}}var rf=!1;function dx(e,t){if(Ma=Ci,e=pp(),jc(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var a=0,i=-1,c=-1,u=0,f=0,d=e,p=null;t:for(;;){for(var y;d!==n||r!==0&&d.nodeType!==3||(i=a+r),d!==o||s!==0&&d.nodeType!==3||(c=a+s),d.nodeType===3&&(a+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===e)break t;if(p===n&&++u===r&&(i=a),p===o&&++f===s&&(c=a),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}n=i===-1||c===-1?null:{start:i,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Aa={focusedElem:e,selectionRange:n},Ci=!1,Ie=t;Ie!==null;)if(t=Ie,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ie=e;else for(;Ie!==null;){t=Ie;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var k=v.memoizedProps,w=v.memoizedState,m=t.stateNode,h=m.getSnapshotBeforeUpdate(t.elementType===t.type?k:yn(t.type,k),w);m.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(C){kt(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,Ie=e;break}Ie=t.return}return v=rf,rf=!1,v}function Ko(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Ua(t,n,o)}r=r.next}while(r!==s)}}function tl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Xa(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function c0(e){var t=e.alternate;t!==null&&(e.alternate=null,c0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[_n],delete t[ur],delete t[_a],delete t[V1],delete t[q1])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function u0(e){return e.tag===5||e.tag===3||e.tag===4}function lf(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||u0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Va(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Ri));else if(s!==4&&(e=e.child,e!==null))for(Va(e,t,n),e=e.sibling;e!==null;)Va(e,t,n),e=e.sibling}function qa(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(qa(e,t,n),e=e.sibling;e!==null;)qa(e,t,n),e=e.sibling}var Lt=null,mn=!1;function Qn(e,t,n){for(n=n.child;n!==null;)f0(e,t,n),n=n.sibling}function f0(e,t,n){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(Xi,n)}catch{}switch(n.tag){case 5:Gt||to(n,t);case 6:var s=Lt,r=mn;Lt=null,Qn(e,t,n),Lt=s,mn=r,Lt!==null&&(mn?(e=Lt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Lt.removeChild(n.stateNode));break;case 18:Lt!==null&&(mn?(e=Lt,n=n.stateNode,e.nodeType===8?Tl(e.parentNode,n):e.nodeType===1&&Tl(e,n),rr(e)):Tl(Lt,n.stateNode));break;case 4:s=Lt,r=mn,Lt=n.stateNode.containerInfo,mn=!0,Qn(e,t,n),Lt=s,mn=r;break;case 0:case 11:case 14:case 15:if(!Gt&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&Ua(n,t,a),r=r.next}while(r!==s)}Qn(e,t,n);break;case 1:if(!Gt&&(to(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(i){kt(n,t,i)}Qn(e,t,n);break;case 21:Qn(e,t,n);break;case 22:n.mode&1?(Gt=(s=Gt)||n.memoizedState!==null,Qn(e,t,n),Gt=s):Qn(e,t,n);break;default:Qn(e,t,n)}}function af(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new fx),t.forEach(function(s){var r=Cx.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function xn(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=e,a=t,i=a;e:for(;i!==null;){switch(i.tag){case 5:Lt=i.stateNode,mn=!1;break e;case 3:Lt=i.stateNode.containerInfo,mn=!0;break e;case 4:Lt=i.stateNode.containerInfo,mn=!0;break e}i=i.return}if(Lt===null)throw Error(Se(160));f0(o,a,r),Lt=null,mn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){kt(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)d0(t,e),t=t.sibling}function d0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xn(t,e),Mn(e),s&4){try{Ko(3,e,e.return),tl(3,e)}catch(k){kt(e,e.return,k)}try{Ko(5,e,e.return)}catch(k){kt(e,e.return,k)}}break;case 1:xn(t,e),Mn(e),s&512&&n!==null&&to(n,n.return);break;case 5:if(xn(t,e),Mn(e),s&512&&n!==null&&to(n,n.return),e.flags&32){var r=e.stateNode;try{tr(r,"")}catch(k){kt(e,e.return,k)}}if(s&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,a=n!==null?n.memoizedProps:o,i=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{i==="input"&&o.type==="radio"&&o.name!=null&&Od(r,o),va(i,a);var u=va(i,o);for(a=0;a<c.length;a+=2){var f=c[a],d=c[a+1];f==="style"?Fd(r,d):f==="dangerouslySetInnerHTML"?Dd(r,d):f==="children"?tr(r,d):pc(r,f,d,u)}switch(i){case"input":ha(r,o);break;case"textarea":Ld(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?oo(r,!!o.multiple,y,!1):p!==!!o.multiple&&(o.defaultValue!=null?oo(r,!!o.multiple,o.defaultValue,!0):oo(r,!!o.multiple,o.multiple?[]:"",!1))}r[ur]=o}catch(k){kt(e,e.return,k)}}break;case 6:if(xn(t,e),Mn(e),s&4){if(e.stateNode===null)throw Error(Se(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(k){kt(e,e.return,k)}}break;case 3:if(xn(t,e),Mn(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{rr(t.containerInfo)}catch(k){kt(e,e.return,k)}break;case 4:xn(t,e),Mn(e);break;case 13:xn(t,e),Mn(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Uc=wt())),s&4&&af(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(Gt=(u=Gt)||f,xn(t,e),Gt=u):xn(t,e),Mn(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!f&&e.mode&1)for(Ie=e,f=e.child;f!==null;){for(d=Ie=f;Ie!==null;){switch(p=Ie,y=p.child,p.tag){case 0:case 11:case 14:case 15:Ko(4,p,p.return);break;case 1:to(p,p.return);var v=p.stateNode;if(typeof v.componentWillUnmount=="function"){s=p,n=p.return;try{t=s,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(k){kt(s,n,k)}}break;case 5:to(p,p.return);break;case 22:if(p.memoizedState!==null){uf(d);continue}}y!==null?(y.return=p,Ie=y):uf(d)}f=f.sibling}e:for(f=null,d=e;;){if(d.tag===5){if(f===null){f=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(i=d.stateNode,c=d.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,i.style.display=$d("display",a))}catch(k){kt(e,e.return,k)}}}else if(d.tag===6){if(f===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(k){kt(e,e.return,k)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:xn(t,e),Mn(e),s&4&&af(e);break;case 21:break;default:xn(t,e),Mn(e)}}function Mn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(u0(n)){var s=n;break e}n=n.return}throw Error(Se(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(tr(r,""),s.flags&=-33);var o=lf(e);qa(e,o,r);break;case 3:case 4:var a=s.stateNode.containerInfo,i=lf(e);Va(e,i,a);break;default:throw Error(Se(161))}}catch(c){kt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function px(e,t,n){Ie=e,p0(e)}function p0(e,t,n){for(var s=(e.mode&1)!==0;Ie!==null;){var r=Ie,o=r.child;if(r.tag===22&&s){var a=r.memoizedState!==null||Dr;if(!a){var i=r.alternate,c=i!==null&&i.memoizedState!==null||Gt;i=Dr;var u=Gt;if(Dr=a,(Gt=c)&&!u)for(Ie=r;Ie!==null;)a=Ie,c=a.child,a.tag===22&&a.memoizedState!==null?ff(r):c!==null?(c.return=a,Ie=c):ff(r);for(;o!==null;)Ie=o,p0(o),o=o.sibling;Ie=r,Dr=i,Gt=u}cf(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Ie=o):cf(e)}}function cf(e){for(;Ie!==null;){var t=Ie;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Gt||tl(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Gt)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:yn(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Uu(t,o,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Uu(t,a,n)}break;case 5:var i=t.stateNode;if(n===null&&t.flags&4){n=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var d=f.dehydrated;d!==null&&rr(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}Gt||t.flags&512&&Xa(t)}catch(p){kt(t,t.return,p)}}if(t===e){Ie=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ie=n;break}Ie=t.return}}function uf(e){for(;Ie!==null;){var t=Ie;if(t===e){Ie=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ie=n;break}Ie=t.return}}function ff(e){for(;Ie!==null;){var t=Ie;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{tl(4,t)}catch(c){kt(t,n,c)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(c){kt(t,r,c)}}var o=t.return;try{Xa(t)}catch(c){kt(t,o,c)}break;case 5:var a=t.return;try{Xa(t)}catch(c){kt(t,a,c)}}}catch(c){kt(t,t.return,c)}if(t===e){Ie=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Ie=i;break}Ie=t.return}}var hx=Math.ceil,Li=Kn.ReactCurrentDispatcher,Hc=Kn.ReactCurrentOwner,fn=Kn.ReactCurrentBatchConfig,st=0,It=null,jt=null,Nt=0,Jt=0,no=Ss(0),Mt=0,yr=null,Os=0,nl=0,Wc=0,Zo=null,Xt=null,Uc=0,mo=1/0,Dn=null,Ni=!1,Ka=null,fs=null,$r=!1,rs=null,Di=0,Qo=0,Za=null,ui=-1,fi=0;function Ht(){return st&6?wt():ui!==-1?ui:ui=wt()}function ds(e){return e.mode&1?st&2&&Nt!==0?Nt&-Nt:Z1.transition!==null?(fi===0&&(fi=Zd()),fi):(e=at,e!==0||(e=window.event,e=e===void 0?16:op(e.type)),e):1}function Tn(e,t,n,s){if(50<Qo)throw Qo=0,Za=null,Error(Se(185));vr(e,n,s),(!(st&2)||e!==It)&&(e===It&&(!(st&2)&&(nl|=n),Mt===4&&ss(e,Nt)),Zt(e,s),n===1&&st===0&&!(t.mode&1)&&(mo=wt()+500,Qi&&Cs()))}function Zt(e,t){var n=e.callbackNode;Zh(e,t);var s=Si(e,e===It?Nt:0);if(s===0)n!==null&&vu(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&vu(n),t===1)e.tag===0?K1(df.bind(null,e)):wp(df.bind(null,e)),U1(function(){!(st&6)&&Cs()}),n=null;else{switch(Qd(s)){case 1:n=gc;break;case 4:n=qd;break;case 16:n=vi;break;case 536870912:n=Kd;break;default:n=vi}n=C0(n,h0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function h0(e,t){if(ui=-1,fi=0,st&6)throw Error(Se(327));var n=e.callbackNode;if(co()&&e.callbackNode!==n)return null;var s=Si(e,e===It?Nt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=$i(e,s);else{t=s;var r=st;st|=2;var o=y0();(It!==e||Nt!==t)&&(Dn=null,mo=wt()+500,Ms(e,t));do try{mx();break}catch(i){x0(e,i)}while(1);Ec(),Li.current=o,st=r,jt!==null?t=0:(It=null,Nt=0,t=Mt)}if(t!==0){if(t===2&&(r=Ra(e),r!==0&&(s=r,t=Qa(e,r))),t===1)throw n=yr,Ms(e,0),ss(e,s),Zt(e,wt()),n;if(t===6)ss(e,s);else{if(r=e.current.alternate,!(s&30)&&!xx(r)&&(t=$i(e,s),t===2&&(o=Ra(e),o!==0&&(s=o,t=Qa(e,o))),t===1))throw n=yr,Ms(e,0),ss(e,s),Zt(e,wt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(Se(345));case 2:Rs(e,Xt,Dn);break;case 3:if(ss(e,s),(s&130023424)===s&&(t=Uc+500-wt(),10<t)){if(Si(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Ht(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Ia(Rs.bind(null,e,Xt,Dn),t);break}Rs(e,Xt,Dn);break;case 4:if(ss(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var a=31-jn(s);o=1<<a,a=t[a],a>r&&(r=a),s&=~o}if(s=r,s=wt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*hx(s/1960))-s,10<s){e.timeoutHandle=Ia(Rs.bind(null,e,Xt,Dn),s);break}Rs(e,Xt,Dn);break;case 5:Rs(e,Xt,Dn);break;default:throw Error(Se(329))}}}return Zt(e,wt()),e.callbackNode===n?h0.bind(null,e):null}function Qa(e,t){var n=Zo;return e.current.memoizedState.isDehydrated&&(Ms(e,t).flags|=256),e=$i(e,t),e!==2&&(t=Xt,Xt=n,t!==null&&Ja(t)),e}function Ja(e){Xt===null?Xt=e:Xt.push.apply(Xt,e)}function xx(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!bn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ss(e,t){for(t&=~Wc,t&=~nl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-jn(t),s=1<<n;e[n]=-1,t&=~s}}function df(e){if(st&6)throw Error(Se(327));co();var t=Si(e,0);if(!(t&1))return Zt(e,wt()),null;var n=$i(e,t);if(e.tag!==0&&n===2){var s=Ra(e);s!==0&&(t=s,n=Qa(e,s))}if(n===1)throw n=yr,Ms(e,0),ss(e,t),Zt(e,wt()),n;if(n===6)throw Error(Se(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rs(e,Xt,Dn),Zt(e,wt()),null}function Xc(e,t){var n=st;st|=1;try{return e(t)}finally{st=n,st===0&&(mo=wt()+500,Qi&&Cs())}}function Ls(e){rs!==null&&rs.tag===0&&!(st&6)&&co();var t=st;st|=1;var n=fn.transition,s=at;try{if(fn.transition=null,at=1,e)return e()}finally{at=s,fn.transition=n,st=t,!(st&6)&&Cs()}}function Vc(){Jt=no.current,dt(no)}function Ms(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,W1(n)),jt!==null)for(n=jt.return;n!==null;){var s=n;switch(bc(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Pi();break;case 3:xo(),dt(qt),dt(zt),Dc();break;case 5:Nc(s);break;case 4:xo();break;case 13:dt(mt);break;case 19:dt(mt);break;case 10:Ic(s.type._context);break;case 22:case 23:Vc()}n=n.return}if(It=e,jt=e=ps(e.current,null),Nt=Jt=t,Mt=0,yr=null,Wc=nl=Os=0,Xt=Zo=null,js!==null){for(t=0;t<js.length;t++)if(n=js[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var a=o.next;o.next=r,s.next=a}n.pending=s}js=null}return e}function x0(e,t){do{var n=jt;try{if(Ec(),li.current=Oi,_i){for(var s=vt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}_i=!1}if(_s=0,At=bt=vt=null,qo=!1,pr=0,Hc.current=null,n===null||n.return===null){Mt=1,yr=t,jt=null;break}e:{var o=e,a=n.return,i=n,c=t;if(t=Nt,i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,f=i,d=f.tag;if(!(f.mode&1)&&(d===0||d===11||d===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=Qu(a);if(y!==null){y.flags&=-257,Ju(y,a,i,o,t),y.mode&1&&Zu(o,u,t),t=y,c=u;var v=t.updateQueue;if(v===null){var k=new Set;k.add(c),t.updateQueue=k}else v.add(c);break e}else{if(!(t&1)){Zu(o,u,t),qc();break e}c=Error(Se(426))}}else if(pt&&i.mode&1){var w=Qu(a);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Ju(w,a,i,o,t),Mc(yo(c,i));break e}}o=c=yo(c,i),Mt!==4&&(Mt=2),Zo===null?Zo=[o]:Zo.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var m=Qp(o,c,t);Wu(o,m);break e;case 1:i=c;var h=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(fs===null||!fs.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var C=Jp(o,i,t);Wu(o,C);break e}}o=o.return}while(o!==null)}g0(n)}catch(j){t=j,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(1)}function y0(){var e=Li.current;return Li.current=Oi,e===null?Oi:e}function qc(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),It===null||!(Os&268435455)&&!(nl&268435455)||ss(It,Nt)}function $i(e,t){var n=st;st|=2;var s=y0();(It!==e||Nt!==t)&&(Dn=null,Ms(e,t));do try{yx();break}catch(r){x0(e,r)}while(1);if(Ec(),st=n,Li.current=s,jt!==null)throw Error(Se(261));return It=null,Nt=0,Mt}function yx(){for(;jt!==null;)m0(jt)}function mx(){for(;jt!==null&&!zh();)m0(jt)}function m0(e){var t=S0(e.alternate,e,Jt);e.memoizedProps=e.pendingProps,t===null?g0(e):jt=t,Hc.current=null}function g0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=ux(n,t),n!==null){n.flags&=32767,jt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Mt=6,jt=null;return}}else if(n=cx(n,t,Jt),n!==null){jt=n;return}if(t=t.sibling,t!==null){jt=t;return}jt=t=e}while(t!==null);Mt===0&&(Mt=5)}function Rs(e,t,n){var s=at,r=fn.transition;try{fn.transition=null,at=1,gx(e,t,n,s)}finally{fn.transition=r,at=s}return null}function gx(e,t,n,s){do co();while(rs!==null);if(st&6)throw Error(Se(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Se(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(Qh(e,o),e===It&&(jt=It=null,Nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||$r||($r=!0,C0(vi,function(){return co(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=fn.transition,fn.transition=null;var a=at;at=1;var i=st;st|=4,Hc.current=null,dx(e,n),d0(n,e),$1(Aa),Ci=!!Ma,Aa=Ma=null,e.current=n,px(n),Yh(),st=i,at=a,fn.transition=o}else e.current=n;if($r&&($r=!1,rs=e,Di=r),o=e.pendingLanes,o===0&&(fs=null),Uh(n.stateNode),Zt(e,wt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Ni)throw Ni=!1,e=Ka,Ka=null,e;return Di&1&&e.tag!==0&&co(),o=e.pendingLanes,o&1?e===Za?Qo++:(Qo=0,Za=e):Qo=0,Cs(),null}function co(){if(rs!==null){var e=Qd(Di),t=fn.transition,n=at;try{if(fn.transition=null,at=16>e?16:e,rs===null)var s=!1;else{if(e=rs,rs=null,Di=0,st&6)throw Error(Se(331));var r=st;for(st|=4,Ie=e.current;Ie!==null;){var o=Ie,a=o.child;if(Ie.flags&16){var i=o.deletions;if(i!==null){for(var c=0;c<i.length;c++){var u=i[c];for(Ie=u;Ie!==null;){var f=Ie;switch(f.tag){case 0:case 11:case 15:Ko(8,f,o)}var d=f.child;if(d!==null)d.return=f,Ie=d;else for(;Ie!==null;){f=Ie;var p=f.sibling,y=f.return;if(c0(f),f===u){Ie=null;break}if(p!==null){p.return=y,Ie=p;break}Ie=y}}}var v=o.alternate;if(v!==null){var k=v.child;if(k!==null){v.child=null;do{var w=k.sibling;k.sibling=null,k=w}while(k!==null)}}Ie=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,Ie=a;else e:for(;Ie!==null;){if(o=Ie,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ko(9,o,o.return)}var m=o.sibling;if(m!==null){m.return=o.return,Ie=m;break e}Ie=o.return}}var h=e.current;for(Ie=h;Ie!==null;){a=Ie;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Ie=x;else e:for(a=h;Ie!==null;){if(i=Ie,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:tl(9,i)}}catch(j){kt(i,i.return,j)}if(i===a){Ie=null;break e}var C=i.sibling;if(C!==null){C.return=i.return,Ie=C;break e}Ie=i.return}}if(st=r,Cs(),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(Xi,e)}catch{}s=!0}return s}finally{at=n,fn.transition=t}}return!1}function pf(e,t,n){t=yo(n,t),t=Qp(e,t,1),e=us(e,t,1),t=Ht(),e!==null&&(vr(e,1,t),Zt(e,t))}function kt(e,t,n){if(e.tag===3)pf(e,e,n);else for(;t!==null;){if(t.tag===3){pf(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(fs===null||!fs.has(s))){e=yo(n,e),e=Jp(t,e,1),t=us(t,e,1),e=Ht(),t!==null&&(vr(t,1,e),Zt(t,e));break}}t=t.return}}function vx(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Ht(),e.pingedLanes|=e.suspendedLanes&n,It===e&&(Nt&n)===n&&(Mt===4||Mt===3&&(Nt&130023424)===Nt&&500>wt()-Uc?Ms(e,0):Wc|=n),Zt(e,t)}function v0(e,t){t===0&&(e.mode&1?(t=br,br<<=1,!(br&130023424)&&(br=4194304)):t=1);var n=Ht();e=Vn(e,t),e!==null&&(vr(e,t,n),Zt(e,n))}function Sx(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),v0(e,n)}function Cx(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(Se(314))}s!==null&&s.delete(t),v0(e,n)}var S0;S0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||qt.current)Vt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Vt=!1,ax(e,t,n);Vt=!!(e.flags&131072)}else Vt=!1,pt&&t.flags&1048576&&Rp(t,bi,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;ci(e,t),e=t.pendingProps;var r=fo(t,zt.current);ao(t,n),r=Fc(null,t,s,e,r,n);var o=Gc();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Kt(s)?(o=!0,ji(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Oc(t),r.updater=el,t.stateNode=r,r._reactInternals=t,Fa(t,s,e,n),t=za(null,t,s,!0,o,n)):(t.tag=0,pt&&o&&Tc(t),Yt(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(ci(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=wx(s),e=yn(s,e),r){case 0:t=Ba(null,t,s,e,n);break e;case 1:t=nf(null,t,s,e,n);break e;case 11:t=ef(null,t,s,e,n);break e;case 14:t=tf(null,t,s,yn(s.type,e),n);break e}throw Error(Se(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),Ba(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),nf(e,t,s,r,n);case 3:e:{if(s0(t),e===null)throw Error(Se(387));s=t.pendingProps,o=t.memoizedState,r=o.element,Ap(e,t),Ei(t,s,null,n);var a=t.memoizedState;if(s=a.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=yo(Error(Se(423)),t),t=sf(e,t,s,n,r);break e}else if(s!==r){r=yo(Error(Se(424)),t),t=sf(e,t,s,n,r);break e}else for(tn=cs(t.stateNode.containerInfo.firstChild),nn=t,pt=!0,gn=null,n=bp(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(po(),s===r){t=qn(e,t,n);break e}Yt(e,t,s,n)}t=t.child}return t;case 5:return Ep(t),e===null&&Na(t),s=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,a=r.children,Ea(s,r)?a=null:o!==null&&Ea(s,o)&&(t.flags|=32),n0(e,t),Yt(e,t,a,n),t.child;case 6:return e===null&&Na(t),null;case 13:return o0(e,t,n);case 4:return Lc(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=ho(t,null,s,n):Yt(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),ef(e,t,s,r,n);case 7:return Yt(e,t,t.pendingProps,n),t.child;case 8:return Yt(e,t,t.pendingProps.children,n),t.child;case 12:return Yt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,o=t.memoizedProps,a=r.value,ut(Mi,s._currentValue),s._currentValue=a,o!==null)if(bn(o.value,a)){if(o.children===r.children&&!qt.current){t=qn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var i=o.dependencies;if(i!==null){a=o.child;for(var c=i.firstContext;c!==null;){if(c.context===s){if(o.tag===1){c=Hn(-1,n&-n),c.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?c.next=c:(c.next=f.next,f.next=c),u.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),Da(o.return,n,t),i.lanes|=n;break}c=c.next}}else if(o.tag===10)a=o.type===t.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(Se(341));a.lanes|=n,i=a.alternate,i!==null&&(i.lanes|=n),Da(a,n,t),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===t){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Yt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,ao(t,n),r=dn(r),s=s(r),t.flags|=1,Yt(e,t,s,n),t.child;case 14:return s=t.type,r=yn(s,t.pendingProps),r=yn(s.type,r),tf(e,t,s,r,n);case 15:return e0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),ci(e,t),t.tag=1,Kt(s)?(e=!0,ji(t)):e=!1,ao(t,n),Zp(t,s,r),Fa(t,s,r,n),za(null,t,s,!0,e,n);case 19:return r0(e,t,n);case 22:return t0(e,t,n)}throw Error(Se(156,t.tag))};function C0(e,t){return Vd(e,t)}function kx(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function un(e,t,n,s){return new kx(e,t,n,s)}function Kc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function wx(e){if(typeof e=="function")return Kc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===xc)return 11;if(e===yc)return 14}return 2}function ps(e,t){var n=e.alternate;return n===null?(n=un(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function di(e,t,n,s,r,o){var a=2;if(s=e,typeof e=="function")Kc(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Us:return As(n.children,r,o,t);case hc:a=8,r|=8;break;case ca:return e=un(12,n,t,r|2),e.elementType=ca,e.lanes=o,e;case ua:return e=un(13,n,t,r),e.elementType=ua,e.lanes=o,e;case fa:return e=un(19,n,t,r),e.elementType=fa,e.lanes=o,e;case Ed:return sl(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Md:a=10;break e;case Ad:a=9;break e;case xc:a=11;break e;case yc:a=14;break e;case es:a=16,s=null;break e}throw Error(Se(130,e==null?e:typeof e,""))}return t=un(a,n,t,r),t.elementType=e,t.type=s,t.lanes=o,t}function As(e,t,n,s){return e=un(7,e,s,t),e.lanes=n,e}function sl(e,t,n,s){return e=un(22,e,s,t),e.elementType=Ed,e.lanes=n,e.stateNode={isHidden:!1},e}function Ll(e,t,n){return e=un(6,e,null,t),e.lanes=n,e}function Nl(e,t,n){return t=un(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Rx(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yl(0),this.expirationTimes=yl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yl(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Zc(e,t,n,s,r,o,a,i,c){return e=new Rx(e,t,n,i,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=un(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oc(o),e}function Px(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ws,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function k0(e){if(!e)return ys;e=e._reactInternals;e:{if(Ds(e)!==e||e.tag!==1)throw Error(Se(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Kt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Se(171))}if(e.tag===1){var n=e.type;if(Kt(n))return kp(e,n,t)}return t}function w0(e,t,n,s,r,o,a,i,c){return e=Zc(n,s,!0,e,r,o,a,i,c),e.context=k0(null),n=e.current,s=Ht(),r=ds(n),o=Hn(s,r),o.callback=t??null,us(n,o,r),e.current.lanes=r,vr(e,r,s),Zt(e,s),e}function ol(e,t,n,s){var r=t.current,o=Ht(),a=ds(r);return n=k0(n),t.context===null?t.context=n:t.pendingContext=n,t=Hn(o,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=us(r,t,a),e!==null&&(Tn(e,r,a,o),ii(e,r,a)),a}function Fi(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Qc(e,t){hf(e,t),(e=e.alternate)&&hf(e,t)}function jx(){return null}var R0=typeof reportError=="function"?reportError:function(e){console.error(e)};function Jc(e){this._internalRoot=e}rl.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Se(409));ol(e,t,null,null)};rl.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ls(function(){ol(null,e,null,null)}),t[Xn]=null}};function rl(e){this._internalRoot=e}rl.prototype.unstable_scheduleHydration=function(e){if(e){var t=tp();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ns.length&&t!==0&&t<ns[n].priority;n++);ns.splice(n,0,e),n===0&&sp(e)}};function eu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function il(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function xf(){}function Tx(e,t,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Fi(a);o.call(u)}}var a=w0(t,s,e,0,null,!1,!1,"",xf);return e._reactRootContainer=a,e[Xn]=a.current,ar(e.nodeType===8?e.parentNode:e),Ls(),a}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var i=s;s=function(){var u=Fi(c);i.call(u)}}var c=Zc(e,0,!1,null,null,!1,!1,"",xf);return e._reactRootContainer=c,e[Xn]=c.current,ar(e.nodeType===8?e.parentNode:e),Ls(function(){ol(t,c,n,s)}),c}function ll(e,t,n,s,r){var o=n._reactRootContainer;if(o){var a=o;if(typeof r=="function"){var i=r;r=function(){var c=Fi(a);i.call(c)}}ol(t,a,e,r)}else a=Tx(n,t,e,r,s);return Fi(a)}Jd=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Go(t.pendingLanes);n!==0&&(vc(t,n|1),Zt(t,wt()),!(st&6)&&(mo=wt()+500,Cs()))}break;case 13:Ls(function(){var s=Vn(e,1);if(s!==null){var r=Ht();Tn(s,e,1,r)}}),Qc(e,1)}};Sc=function(e){if(e.tag===13){var t=Vn(e,134217728);if(t!==null){var n=Ht();Tn(t,e,134217728,n)}Qc(e,134217728)}};ep=function(e){if(e.tag===13){var t=ds(e),n=Vn(e,t);if(n!==null){var s=Ht();Tn(n,e,t,s)}Qc(e,t)}};tp=function(){return at};np=function(e,t){var n=at;try{return at=e,t()}finally{at=n}};Ca=function(e,t,n){switch(t){case"input":if(ha(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=Zi(s);if(!r)throw Error(Se(90));_d(s),ha(s,r)}}}break;case"textarea":Ld(e,n);break;case"select":t=n.value,t!=null&&oo(e,!!n.multiple,t,!1)}};zd=Xc;Yd=Ls;var bx={usingClientEntryPoint:!1,Events:[Cr,Ks,Zi,Gd,Bd,Xc]},Eo={findFiberByHostInstance:Ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Mx={bundleType:Eo.bundleType,version:Eo.version,rendererPackageName:Eo.rendererPackageName,rendererConfig:Eo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Kn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ud(e),e===null?null:e.stateNode},findFiberByHostInstance:Eo.findFiberByHostInstance||jx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fr.isDisabled&&Fr.supportsFiber)try{Xi=Fr.inject(Mx),On=Fr}catch{}}on.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bx;on.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!eu(t))throw Error(Se(200));return Px(e,t,null,n)};on.createRoot=function(e,t){if(!eu(e))throw Error(Se(299));var n=!1,s="",r=R0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Zc(e,1,!1,null,null,n,!1,s,r),e[Xn]=t.current,ar(e.nodeType===8?e.parentNode:e),new Jc(t)};on.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Se(188)):(e=Object.keys(e).join(","),Error(Se(268,e)));return e=Ud(t),e=e===null?null:e.stateNode,e};on.flushSync=function(e){return Ls(e)};on.hydrate=function(e,t,n){if(!il(t))throw Error(Se(200));return ll(null,e,t,!0,n)};on.hydrateRoot=function(e,t,n){if(!eu(e))throw Error(Se(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",a=R0;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=w0(t,null,e,1,n??null,r,!1,o,a),e[Xn]=t.current,ar(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new rl(t)};on.render=function(e,t,n){if(!il(t))throw Error(Se(200));return ll(null,e,t,!1,n)};on.unmountComponentAtNode=function(e){if(!il(e))throw Error(Se(40));return e._reactRootContainer?(Ls(function(){ll(null,null,e,!1,function(){e._reactRootContainer=null,e[Xn]=null})}),!0):!1};on.unstable_batchedUpdates=Xc;on.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!il(n))throw Error(Se(200));if(e==null||e._reactInternals===void 0)throw Error(Se(38));return ll(e,t,n,!1,s)};on.version="18.3.1-next-f1338f8080-20240426";function P0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(P0)}catch(e){console.error(e)}}P0(),Pd.exports=on;var Ax=Pd.exports,yf=Ax;la.createRoot=yf.createRoot,la.hydrateRoot=yf.hydrateRoot;var Ae=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e.T_I="T_I",e.T_L="T_L",e.T_T="T_T",e.T_S="T_S",e.T_O="T_O",e.T_I_C="T_I_C",e.T_L_C="T_L_C",e.T_T_C="T_T_C",e.T_S_C="T_S_C",e.T_O_C="T_O_C",e.P_I="P_I",e.P_L="P_L",e.P_X="P_X",e.P_U="P_U",e.P_L2="P_L2",e.P_Y="P_Y",e.P_T="P_T",e.P_S="P_S",e.P_P="P_P",e.P_Z="P_Z",e.P_W="P_W",e.P_I_C="P_I_C",e.P_L_C="P_L_C",e.P_X_C="P_X_C",e.P_U_C="P_U_C",e.P_L2_C="P_L2_C",e.P_Y_C="P_Y_C",e.P_T_C="P_T_C",e.P_S_C="P_S_C",e.P_P_C="P_P_C",e.P_Z_C="P_Z_C",e.P_W_C="P_W_C",e.H_I="H_I",e.H_L="H_L",e.H_X="H_X",e.H_U="H_U",e.H_L2="H_L2",e.H_Y="H_Y",e.H_T="H_T",e.H_S="H_S",e.H_P="H_P",e.H_Z="H_Z",e.H_W="H_W",e.H_I_C="H_I_C",e.H_L_C="H_L_C",e.H_X_C="H_X_C",e.H_U_C="H_U_C",e.H_L2_C="H_L2_C",e.H_Y_C="H_Y_C",e.H_T_C="H_T_C",e.H_S_C="H_S_C",e.H_P_C="H_P_C",e.H_Z_C="H_Z_C",e.H_W_C="H_W_C",e))(Ae||{}),Fn=(e=>(e.SPAWNED="SPAWNED",e.FALLING="FALLING",e.LOCKED="LOCKED",e))(Fn||{}),qe=(e=>(e.ConsoleScreen="CONSOLE",e.TankScreen="PERISCOPE",e.COMPLICATION_MINIGAME="COMPLICATION_MINIGAME",e.EndGameScreen="GAME_OVER",e))(qe||{}),Oe=(e=>(e.LIGHTS="LIGHTS",e.CONTROLS="CONTROLS",e.LASER="LASER",e))(Oe||{});const rt=12,je=30,Bt=21,De=24,nt=De-Bt,go=375,Io=75*1e3,Dl=.15,Ex=.5,Ix=30,_x=0,Ox=100,mf=15,Lx=10,Nx=250,Nn={CIRCUIT_STABILIZER:{id:"CIRCUIT_STABILIZER",name:"Circuit Stabilizer",desc:"Extends grace period before lights start dimming.",type:"passive",category:"complication",unlockRank:2,costPerLevel:1,maxLevel:4,effectPerLevel:.75,formatEffect:e=>`+${(e*.75).toFixed(2)}s Grace Period`,maxLevelBonus:"Easier Fixing Sequence"},AUTO_POPPER:{id:"AUTO_POPPER",name:"Auto-Popper",desc:"At end of game, remaining goop has a chance to auto-pop before penalty.",type:"passive",unlockRank:3,costPerLevel:1,maxLevel:4,effectPerLevel:.04,formatEffect:e=>`-${20-e*4}% decay per unit`,maxLevelBonus:void 0},CAPACITOR_EFFICIENCY:{id:"CAPACITOR_EFFICIENCY",name:"Capacitor Efficiency",desc:"Reduces laser capacitor drain rate when popping goop.",type:"passive",category:"complication",unlockRank:4,costPerLevel:1,maxLevel:4,effectPerLevel:.0625,formatEffect:e=>`-${(e*6.25).toFixed(2)}% Drain Rate`,maxLevelBonus:"Easier Fixing Sequence"},COOLDOWN_BOOSTER:{id:"COOLDOWN_BOOSTER",name:"Cooldown Booster",desc:"When activated, extends all active malfunction cooldowns.",type:"active",unlockRank:5,costPerLevel:1,maxLevel:3,chargeCost:8,effectPerLevel:0,formatEffect:e=>`+${[25,35,50][e-1]||25}% Cooldown Extension`,maxLevelBonus:"+50% Cooldown Extension"},GEAR_LUBRICATION:{id:"GEAR_LUBRICATION",name:"Gear Lubrication",desc:"Increases heat dissipation rate when idle.",type:"passive",category:"complication",unlockRank:6,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Heat Dissipation`,maxLevelBonus:"Easier Fixing Sequence"},FOCUS_MODE:{id:"FOCUS_MODE",name:"Focus Mode",desc:"Time slows while at the console viewing minigames.",type:"passive",unlockRank:7,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`-${e*10}% Time Speed`,maxLevelBonus:void 0},DENSE_GOOP:{id:"DENSE_GOOP",name:"Dense Goop",desc:"Goop falls faster. Can add or remove scraps via respec.",type:"passive",unlockRank:8,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Fall Speed`,maxLevelBonus:void 0},PRESSURE_CONTROL:{id:"PRESSURE_CONTROL",name:"Pressure Control",desc:"Extends time before pressure reaches 100%.",type:"passive",unlockRank:9,costPerLevel:1,maxLevel:8,effectPerLevel:5,formatEffect:e=>`+${e*5}s Game Time`,maxLevelBonus:void 0},JUNK_UNIFORMER:{id:"JUNK_UNIFORMER",name:"Junk Uniformer",desc:"Starting junk is more likely to be the same color.",type:"passive",unlockRank:10,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`+${e*10}% Same Color`,maxLevelBonus:void 0},GOOP_SWAP:{id:"GOOP_SWAP",name:"Goop Swap",desc:"Swap falling goop with stored goop faster.",type:"passive",unlockRank:12,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${(1.5-e*.25).toFixed(2)}s Swap Time`,maxLevelBonus:void 0},GOOP_DUMP:{id:"GOOP_DUMP",name:"Goop Dump",desc:"When activated, rains same-color junk from the sky. Higher levels add more waves.",type:"active",unlockRank:15,costPerLevel:1,maxLevel:3,chargeCost:12,effectPerLevel:1,formatEffect:e=>`${e} wave${e>1?"s":""} of junk`,maxLevelBonus:"3 waves of matching junk"},SEALING_BONUS:{id:"SEALING_BONUS",name:"Sealing Bonus",desc:"Sealing cracks reduces active cooldowns more.",type:"passive",unlockRank:18,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`${10+e*5}% Cooldown per Seal`,maxLevelBonus:void 0},ACTIVE_EXPANSION_SLOT:{id:"ACTIVE_EXPANSION_SLOT",name:"Active Expansion Slot",desc:"Allows equipping a second active ability simultaneously.",type:"feature",unlockRank:20,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"2 Active Slots",maxLevelBonus:void 0},GOOP_HOLD_VIEWER:{id:"GOOP_HOLD_VIEWER",name:"Goop Hold Viewer",desc:"Shows the goop currently held.",type:"feature",unlockRank:22,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"View Held Goop",maxLevelBonus:void 0},GOOP_COLORIZER:{id:"GOOP_COLORIZER",name:"Goop Colorizer",desc:"When activated, upcoming goop matches your current color.",type:"active",unlockRank:25,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:1,formatEffect:e=>`Next ${5+e} goop match`,maxLevelBonus:"Next 8 goop match"},GOOP_WINDOW:{id:"GOOP_WINDOW",name:"Goop Window",desc:"Shows you the next goop piece.",type:"feature",unlockRank:28,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"Preview Next Goop",maxLevelBonus:void 0},SLOW_CRACKS:{id:"SLOW_CRACKS",name:"Slow Cracks",desc:"Cracks grow slower over time.",type:"passive",unlockRank:30,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`-${e*5}% Growth Chance`,maxLevelBonus:void 0},CRACK_MATCHER:{id:"CRACK_MATCHER",name:"Crack Matcher",desc:"Falling goop color biased toward the lowest crack.",type:"passive",unlockRank:32,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${e*25}% Match Chance`,maxLevelBonus:void 0},CRACK_DOWN:{id:"CRACK_DOWN",name:"Crack Down",desc:"When activated, next cracks form in the bottom 4 rows.",type:"active",unlockRank:35,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:2,formatEffect:e=>`Next ${1+e*2} cracks spawn low`,maxLevelBonus:"Next 7 cracks spawn low"},ACTIVE_EXPANSION_SLOT_2:{id:"ACTIVE_EXPANSION_SLOT_2",name:"Active Expansion Slot",desc:"Allows equipping a third active ability simultaneously.",type:"feature",unlockRank:38,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"3 Active Slots",maxLevelBonus:void 0}},tt={RED:"#ef4444",BLUE:"#3b82f6",GREEN:"#22c55e",YELLOW:"#eab308",PURPLE:"#a855f7",WHITE:"#f8fafc",BLACK:"#1a1a2e",WILD:"wild",ORANGE:"#f97316",TEAL:"#14b8a6",GRID_BG:"#020617",GRID_EMPTY:"#1e293b"},Le=(e,t)=>({type:e,color:tt.RED,cells:t.map(([n,s])=>({x:n,y:s}))}),gf=[Le(Ae.I,[[-1,0],[0,0],[1,0],[2,0]]),Le(Ae.J,[[-1,-1],[-1,0],[0,0],[1,0]]),Le(Ae.L,[[1,-1],[-1,0],[0,0],[1,0]]),Le(Ae.O,[[0,0],[1,0],[0,1],[1,1]]),Le(Ae.S,[[0,0],[1,0],[0,1],[-1,1]]),Le(Ae.T,[[0,-1],[-1,0],[0,0],[1,1]]),Le(Ae.Z,[[-1,0],[0,0],[0,1],[1,1]])],Dx=Le(Ae.T_I,[[0,-1],[0,0],[0,1],[0,2]]),$x=Le(Ae.T_L,[[0,0],[0,1],[0,2],[1,0]]),Fx=Le(Ae.T_T,[[0,0],[0,1],[0,2],[1,1]]),Gx=Le(Ae.T_S,[[0,0],[0,1],[1,1],[1,2]]),Bx=Le(Ae.T_O,[[0,0],[0,1],[1,0],[1,1]]),zx=Le(Ae.T_I_C,[[0,2],[0,3],[1,0],[1,1]]),Yx=Le(Ae.T_L_C,[[0,0],[0,1],[1,0],[1,2]]),Hx=Le(Ae.T_T_C,[[0,0],[0,2],[1,1],[2,1]]),Wx=Le(Ae.T_S_C,[[0,2],[1,0],[1,1],[2,1]]),Ux=Le(Ae.T_O_C,[[0,0],[0,2],[1,1],[1,2]]),bs=[Dx,$x,Fx,Gx,Bx],Jo=[zx,Yx,Hx,Wx,Ux];[...bs,...Jo];const Xx=Le(Ae.P_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2]]),Vx=Le(Ae.P_L,[[0,0],[0,1],[1,1],[1,2],[2,1]]),qx=Le(Ae.P_X,[[0,1],[1,0],[1,1],[1,2],[2,1]]),Kx=Le(Ae.P_U,[[0,0],[1,0],[1,1],[1,2],[2,0]]),Zx=Le(Ae.P_L2,[[0,0],[0,1],[1,0],[1,1],[1,2]]),Qx=Le(Ae.P_Y,[[0,0],[0,1],[1,1],[1,2],[2,2]]),Jx=Le(Ae.P_T,[[0,0],[0,1],[0,2],[0,3],[1,1]]),ey=Le(Ae.P_S,[[0,0],[0,1],[0,2],[0,3],[1,3]]),ty=Le(Ae.P_P,[[0,0],[0,1],[0,3],[1,0],[1,2]]),ny=Le(Ae.P_Z,[[0,0],[0,1],[0,2],[0,3],[1,1]]),sy=Le(Ae.P_W,[[0,0],[0,2],[1,1],[1,2],[2,2]]),oy=Le(Ae.P_I_C,[[0,0],[0,2],[0,4],[1,1],[1,3]]),ry=Le(Ae.P_L_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),iy=Le(Ae.P_X_C,[[0,0],[1,1],[1,2],[2,0],[2,2]]),ly=Le(Ae.P_U_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),ay=Le(Ae.P_L2_C,[[0,0],[0,2],[1,1],[1,2],[2,2]]),cy=Le(Ae.P_Y_C,[[0,0],[0,1],[1,1],[2,0],[2,2]]),uy=Le(Ae.P_T_C,[[0,0],[0,1],[0,3],[1,2],[1,3]]),fy=Le(Ae.P_S_C,[[0,0],[0,1],[1,0],[1,2],[2,1]]),dy=Le(Ae.P_P_C,[[0,0],[0,2],[1,0],[1,1],[1,3]]),py=Le(Ae.P_Z_C,[[0,0],[0,2],[1,1],[1,3],[2,0]]),hy=Le(Ae.P_W_C,[[0,0],[0,2],[1,1],[2,0],[2,2]]),al=[Xx,Vx,qx,Kx,Zx,Qx,Jx,ey,ty,ny,sy],tu=[oy,ry,iy,ly,ay,cy,uy,fy,dy,py,hy];[...al,...tu];const xy=Le(Ae.H_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2],[0,3]]),yy=Le(Ae.H_L,[[0,0],[0,1],[0,2],[0,3],[1,1],[2,1]]),my=Le(Ae.H_X,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,3]]),gy=Le(Ae.H_U,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,0]]),vy=Le(Ae.H_L2,[[0,0],[0,1],[1,0],[1,1],[1,2],[1,3]]),Sy=Le(Ae.H_Y,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2]]),Cy=Le(Ae.H_T,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,2]]),ky=Le(Ae.H_S,[[0,0],[0,1],[1,0],[1,1],[2,1],[2,2]]),wy=Le(Ae.H_P,[[0,0],[0,1],[0,2],[0,3],[1,2],[1,3]]),Ry=Le(Ae.H_Z,[[0,0],[0,1],[0,2],[0,3],[1,0],[1,3]]),Py=Le(Ae.H_W,[[0,0],[0,3],[1,1],[1,2],[1,3],[2,3]]),jy=Le(Ae.H_I_C,[[0,0],[0,3],[0,5],[1,1],[1,2],[1,4]]),Ty=Le(Ae.H_L_C,[[0,0],[0,2],[1,1],[1,2],[1,3],[2,0]]),by=Le(Ae.H_X_C,[[0,0],[0,2],[0,3],[1,1],[1,3],[2,0]]),My=Le(Ae.H_U_C,[[0,0],[0,3],[1,1],[1,2],[1,4],[2,0]]),Ay=Le(Ae.H_L2_C,[[0,0],[0,1],[1,1],[1,2],[1,3],[2,0]]),Ey=Le(Ae.H_Y_C,[[0,0],[0,2],[1,0],[1,2],[1,3],[2,1]]),Iy=Le(Ae.H_T_C,[[0,0],[0,1],[0,3],[1,1],[1,2],[1,4]]),_y=Le(Ae.H_S_C,[[0,0],[0,2],[1,1],[1,3],[2,0],[2,2]]),Oy=Le(Ae.H_P_C,[[0,0],[0,2],[0,4],[1,1],[1,2],[1,3]]),Ly=Le(Ae.H_Z_C,[[0,0],[0,1],[0,3],[1,0],[1,2],[2,3]]),Ny=Le(Ae.H_W_C,[[0,0],[0,3],[1,1],[1,2],[2,0],[2,3]]),cl=[xy,yy,my,gy,vy,Sy,Cy,ky,wy,Ry,Py],nu=[jy,Ty,by,My,Ay,Ey,Iy,_y,Oy,Ly,Ny];[...cl,...nu];const Ve=e=>(e%je+je)%je,ec=(e,t)=>Ve(Math.round(e)+t),Dy=(e,t)=>{let n=e-t;for(;n>je/2;)n-=je;for(;n<=-je/2;)n+=je;return n},j0=(e,t,n)=>{const s=n?n.x:Math.round(e.reduce((o,a)=>o+a.x,0)/e.length),r=n?n.y:Math.round(e.reduce((o,a)=>o+a.y,0)/e.length);return e.map(({x:o,y:a})=>{const i=o-s,c=a-r;return t?{x:-c+s,y:i+r}:{x:c+s,y:-i+r}})},Rn=e=>{const t=[tt.RED,tt.BLUE,tt.GREEN,tt.YELLOW];return e>=10&&t.push(tt.PURPLE),e>=30&&t.push(tt.WHITE),e>=50&&t.push(tt.BLACK),t},$y=(e,t=1)=>{const n=e||gf[Math.floor(Math.random()*gf.length)],s=Rn(t),o=(e==null?void 0:e.color)&&s.includes(e.color)?e.color:s[Math.floor(Math.random()*s.length)],a=Math.round(n.cells.reduce((c,u)=>c+u.x,0)/n.cells.length),i=Math.round(n.cells.reduce((c,u)=>c+u.y,0)/n.cells.length);return{definition:{...n,color:o},x:0,y:0,screenX:0,rotation:0,cells:[...n.cells],rotationCenter:{x:a,y:i},spawnTimestamp:Date.now(),startSpawnY:0,state:Fn.SPAWNED}},vf=(e,t)=>{const n=Array(De).fill(null).map(()=>Array(je).fill(null));let s=0;if(e>=9?s=11:e>=6?s=8:e>=3&&(s=5),s>0){const r=Rn(e),o=Array.from({length:je},(d,p)=>p);for(let d=o.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[o[d],o[p]]=[o[p],o[d]]}const a=o.slice(0,s),i=De-1,u=((t==null?void 0:t.JUNK_UNIFORMER)||0)*.1;let f=null;a.forEach(d=>{let p;f===null?(p=r[Math.floor(Math.random()*r.length)],f=p):p=Math.random()<u?f:r[Math.floor(Math.random()*r.length)];const y=Math.random().toString(36).substr(2,9);n[i][d]={id:Math.random().toString(36).substr(2,9),goopGroupId:y,timestamp:Date.now(),color:p,groupMinY:i,groupMaxY:i,groupSize:1}})}return n},ms=(e,t,n)=>{for(const s of t.cells){const r=Ve(t.x+s.x),o=t.y+s.y;if(o+1>De)return!0;const a=Math.floor(o),i=Math.floor(o+1-1e-4);for(let c=a;c<=i;c++)if(c>=0&&c<De&&e[c][r]!==null)return!0}return!1},T0=(e,t,n)=>{let s=Math.floor(t.y);for(;s>-5&&ms(e,{...t,y:s});)s-=1;let r=s;for(;r<De&&!ms(e,{...t,y:r+1});)r+=1;return Math.max(s,r)},Fy=(e,t,n)=>{const s=e[n][t];if(!s)return[];const r=[],o=new Set,a=[{x:t,y:n}],i=s.goopGroupId;for(;a.length>0;){const{x:c,y:u}=a.shift(),f=`${c},${u}`;if(o.has(f))continue;o.add(f),r.push({x:c,y:u});const d=[{x:Ve(c+1),y:u},{x:Ve(c-1),y:u},{x:c,y:u+1},{x:c,y:u-1}];for(const p of d)if(p.y>=0&&p.y<De){const y=e[p.y][p.x];y&&y.goopGroupId===i&&(o.has(`${p.x},${p.y}`)||a.push(p))}}return r},Gi=e=>{const t=e.map(r=>[...r]),n=new Set,s=(r,o,a,i)=>{const c=[],u=[{x:r,y:o}],f=new Set;for(;u.length>0;){const d=u.shift(),p=`${d.x},${d.y}`;if(f.has(p))continue;f.add(p),c.push(d);const y=[{x:Ve(d.x+1),y:d.y},{x:Ve(d.x-1),y:d.y},{x:d.x,y:d.y+1},{x:d.x,y:d.y-1}];for(const v of y)if(v.y>=0&&v.y<De){const k=t[v.y][v.x];if(!k||f.has(`${v.x},${v.y}`))continue;(i?k.isWild:k.color===a&&!k.isWild)&&u.push(v)}}return c};for(let r=0;r<De;r++)for(let o=0;o<je;o++){const a=t[r][o];if(a&&!n.has(`${o},${r}`)){const i=s(o,r,a.color,!!a.isWild);let c=De,u=-1;i.forEach(w=>{w.y<c&&(c=w.y),w.y>u&&(u=w.y)});const f=i.length;let d=!0;const p=a.goopGroupId,y=a.groupSize;if(y!==f)d=!1;else for(const w of i){const m=t[w.y][w.x];if(!m||m.goopGroupId!==p||m.groupSize!==y){d=!1;break}}const v=d?p:Math.random().toString(36).substr(2,9),k=d?a.timestamp:Date.now();i.forEach(w=>{n.add(`${w.x},${w.y}`);const m=t[w.y][w.x];t[w.y][w.x]={...m,goopGroupId:v,timestamp:k,groupMinY:c,groupMaxY:u,groupSize:f}})}}return t},Gy=(e,t,n)=>{const s=e.map(p=>[...p]),r=Math.random().toString(36).substr(2,9),o=Date.now();let a=De,i=-1;const c=[],u=[];t.cells.forEach(p=>{const y=Math.floor(t.y+p.y);y<a&&(a=y),y>i&&(i=y)});const f=t.cells.length,d=t.definition.isWild;return t.cells.forEach((p,y)=>{var m;const v=Ve(t.x+p.x),k=Math.floor(t.y+p.y),w=((m=t.definition.cellColors)==null?void 0:m[y])??t.definition.color;if(k>=0&&k<De){const h=n.find(C=>C.x===v&&C.y===k);let x=!1;h&&(h.color===w||d)&&(c.push(h.id),x=!0),s[k][v]={id:Math.random().toString(36).substr(2,9),goopGroupId:r,timestamp:o,color:w,groupMinY:a,groupMaxY:i,groupSize:f,isSealingGoop:x,isWild:d}}}),{grid:Gi(s),consumedGoals:c,destroyedGoals:u}},By=(e,t)=>{const n=e.map(i=>[...i]),s=t.definition.isWild,r=t.definition.color,o=[];t.cells.forEach(i=>{const c=Ve(t.x+i.x),u=Math.floor(t.y+i.y);u>=0&&u<De&&o.push({x:c,y:u})});const a=new Set;if(o.forEach(({x:i,y:c})=>{[{x:Ve(i+1),y:c},{x:Ve(i-1),y:c},{x:i,y:c+1},{x:i,y:c-1}].forEach(f=>{if(f.y>=0&&f.y<De){const d=n[f.y][f.x];if(!d||o.some(y=>y.x===f.x&&y.y===f.y))return;s?d.isWild||a.add(d.goopGroupId):d.isWild&&a.add(d.goopGroupId)}})}),a.size>0)for(let i=0;i<De;i++)for(let c=0;c<je;c++){const u=n[i][c];u&&a.has(u.goopGroupId)&&(s?n[i][c]={...u,isWild:!0}:n[i][c]={...u,color:r,isWild:!1})}return Gi(n)},b0=(e,t)=>{const n=e.map(c=>[...c]),s=[],r=new Map;for(let c=0;c<De;c++)for(let u=0;u<je;u++){const f=n[c][u];f&&(r.has(f.goopGroupId)||r.set(f.goopGroupId,[]),r.get(f.goopGroupId).push({x:u,y:c}))}let o;if(t&&t.length>0){const c=new Map;for(const u of t){const f=c.get(u.x);(f===void 0||u.y<f)&&c.set(u.x,u.y)}o=new Set;for(const[u,f]of r)for(const d of f){const p=c.get(d.x);if(p!==void 0&&d.y<p){o.add(u);break}}}else o=new Set(r.keys());const a=new Set;for(const[c,u]of r)for(const f of u)if(f.y===De-1){a.add(c);break}let i=!0;for(;i;){i=!1;for(const[c,u]of r)if(!a.has(c))for(const f of u){const d=f.y+1;if(d<De){const p=n[d][f.x];if(p&&p.goopGroupId!==c&&a.has(p.goopGroupId)){a.add(c),i=!0;break}}}}for(const c of o)if(!a.has(c)){const u=r.get(c);for(const f of u)s.push({data:n[f.y][f.x],x:f.x,y:f.y,velocity:0}),n[f.y][f.x]=null}return{grid:n,looseGoop:s}},zy=(e,t,n,s)=>{const r=[],o=[],a=.012*n,i=[...e].sort((c,u)=>u.y-c.y);for(const c of i){const u=c.y+a;if(u>=De-1){o.push({...c,y:De-1});continue}const f=Math.floor(u+1),d=c.x;t[f]&&t[f][d]?o.push({...c,y:Math.floor(u)}):r.push({...c,y:u})}return{active:r,landed:o}},Yy=e=>Math.max(0,(De-e)*10),Hy=(e,t)=>{const n=Ve(t+rt/2);let s=Math.abs(e-n);return s>je/2&&(s=je-s),s>rt/2?50:0},Wy=e=>1+e*.1,Uy=(e,t)=>{let n=0;const s=new Set(t.map(r=>`${r.x},${r.y}`));return t.forEach(({x:r,y:o})=>{[{x:Ve(r+1),y:o},{x:Ve(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}].forEach(i=>{i.y>=0&&i.y<De&&e[i.y][i.x]&&!s.has(`${i.x},${i.y}`)&&n++})}),n*5},Sf=(e,t,n,s,r,o=!1)=>{const a=Rn(n),i=new Set(t.map(d=>d.color)),c=a.filter(d=>!i.has(d));if(c.length===0)return null;const u=c[Math.floor(Math.random()*c.length)];let f;if(o){const d=De-4,p=De-1;f=d+Math.floor(Math.random()*(p-d+1))}else{const p=1+Math.max(0,1-s/r)*(Bt-1),y=Math.floor(De-p);f=Math.max(nt,Math.min(De-1,y))}for(let d=0;d<20;d++){const p=Math.floor(Math.random()*je),y=f;if(!e[y][p]&&!t.some(v=>v.x===p&&v.y===y))return{id:Math.random().toString(36).substr(2,9),x:p,y,color:u,spawnTime:Date.now()}}return null},Xy=(e,t,n,s,r)=>{const o=Rn(n),a=[],i=[...t],u=1+Math.max(0,1-s/r)*(Bt-1),f=Math.floor(De-u);let d=nt,p=Math.max(nt,f-1);for(const y of o)for(let v=0;v<20;v++){const k=Math.floor(Math.random()*je),w=Math.floor(d+Math.random()*(p-d+1));if(w<nt||w>=De)continue;const m=e[w][k]!==null,h=i.some(C=>C.x===k&&C.y===w),x=a.some(C=>C.x===k&&C.y===w);if(!m&&!h&&!x){const C={id:Math.random().toString(36).substr(2,9),x:k,y:w,color:y,spawnTime:Date.now()};a.push(C);break}}return a},vn=typeof navigator<"u"&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Vy=(e,t)=>{const n=Math.max(0,Math.min(100,e))/100;if(t==="drain")if(n>.5){const s=(n-.5)*2,r=Math.round(234+(59-234)*s),o=Math.round(179+(130-179)*s),a=Math.round(8+(246-8)*s);return`rgb(${r}, ${o}, ${a})`}else{const s=n*2,r=Math.round(220+(234-220)*s),o=Math.round(38+(179-38)*s),a=Math.round(38+(8-38)*s);return`rgb(${r}, ${o}, ${a})`}else if(n<.5){const s=n*2,r=Math.round(34+(234-34)*s),o=Math.round(197+(179-197)*s),a=Math.round(94+(8-94)*s);return`rgb(${r}, ${o}, ${a})`}else{const s=(n-.5)*2,r=Math.round(234+(220-234)*s),o=Math.round(179+(38-179)*s),a=Math.round(8+(38-8)*s);return`rgb(${r}, ${o}, ${a})`}},Cf=({value:e,maxValue:t=100,colorMode:n,x:s,y:r,height:o=200,width:a=16})=>{const c=Math.max(0,Math.min(t,e))/t*(o-4),u=Vy(e,n),f="#1f2937",d="#111827";return l.jsxs("g",{transform:`translate(${s}, ${r})`,children:[l.jsx("rect",{x:0,y:0,width:a,height:o,rx:3,ry:3,fill:d,stroke:f,strokeWidth:1}),l.jsx("rect",{x:2,y:o-2-c,width:a-4,height:c,rx:2,ry:2,fill:u}),[.25,.5,.75].map(p=>l.jsx("line",{x1:0,y1:o-p*(o-4)-2,x2:4,y2:o-p*(o-4)-2,stroke:f,strokeWidth:1,opacity:.5},p))]})},Ue=30,zs={x:-(rt/2)*Ue,y:0,w:rt*Ue,h:Bt*Ue};function Ct(e){return(e-rt/2)*Ue}function qy(e){return e/Ue+rt/2}class Ky{constructor(){Ye(this,"handlers",new Map)}on(t,n){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(n),()=>this.off(t,n)}off(t,n){var s;(s=this.handlers.get(t))==null||s.delete(n)}emit(t,n){var s;(s=this.handlers.get(t))==null||s.forEach(r=>r(n))}}const xe=new Ky;var ae=(e=>(e.PIECE_MOVED="PIECE_MOVED",e.PIECE_ROTATED="PIECE_ROTATED",e.PIECE_DROPPED="PIECE_DROPPED",e.GOOP_POPPED="GOOP_POPPED",e.ACTION_REJECTED="ACTION_REJECTED",e.GAME_OVER="GAME_OVER",e.GOAL_CAPTURED="GOAL_CAPTURED",e.COMPLICATION_SPAWNED="COMPLICATION_SPAWNED",e.COMPLICATION_RESOLVED="COMPLICATION_RESOLVED",e.LIGHTS_FLICKER="LIGHTS_FLICKER",e.ABILITY_ACTIVATED="ABILITY_ACTIVATED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.GAME_START="GAME_START",e.GAME_PAUSED="GAME_PAUSED",e.GAME_RESUMED="GAME_RESUMED",e.GAME_EXITED="GAME_EXITED",e.MUSIC_START="MUSIC_START",e.MUSIC_STOP="MUSIC_STOP",e.INPUT_ROTATE="INPUT_ROTATE",e.INPUT_DRAG="INPUT_DRAG",e.INPUT_SWIPE_UP="INPUT_SWIPE_UP",e.INPUT_FAST_DROP="INPUT_FAST_DROP",e.INPUT_SWAP="INPUT_SWAP",e.INPUT_BLOCK_TAP="INPUT_BLOCK_TAP",e.INPUT_SWAP_HOLD="INPUT_SWAP_HOLD",e.TUTORIAL_STEP_TRIGGERED="TUTORIAL_STEP_TRIGGERED",e.TUTORIAL_STEP_COMPLETED="TUTORIAL_STEP_COMPLETED",e.TUTORIAL_STEP_DISMISSED="TUTORIAL_STEP_DISMISSED",e.TRAINING_SCENARIO_COMPLETE="TRAINING_SCENARIO_COMPLETE",e))(ae||{});const Zy=1500,Fs=250,Gr=10,_o=20;function Qy({callbacks:e,tankRotation:t,grid:n,tankPressure:s,powerUps:r,trainingHighlightColor:o,disableSwap:a,disablePop:i}){const{onBlockTap:c,onRotate:u,onDragInput:f,onSwipeUp:d,onFastDrop:p,onSwap:y}=e,v=(r==null?void 0:r.GOOP_SWAP)||0,k=Zy-v*250,[w,m]=g.useState(null),[h,x]=g.useState(null),[C,j]=g.useState(0),[P,R]=g.useState(null),S=g.useRef(null),T=g.useRef(null),E=g.useRef(null),M=g.useRef(null),{x:U,y:ee,w:te,h:N}=zs,z=g.useCallback((A,Y,H)=>{const W=H,me=W.getBoundingClientRect(),ie=W.clientLeft||0,le=W.clientTop||0,V=A-me.left-ie,we=Y-me.top-le,Ce=W.clientWidth,be=W.clientHeight,$e=Ce/te,Fe=be/N,Ee=Math.min($e,Fe),Re=te*Ee,Pe=(Ce-Re)/2,I=U+(V-Pe)/Ee,F=ee+we/Ee,ye=qy(I),ue=F/Ue+nt;return{vx:ye,vy:ue,svgX:I,svgY:F,relX:V,contentW:Ce,relY:we}},[U,ee,te,N]),Q=g.useCallback((A,Y)=>{if(A>=0&&A<rt){const H=Math.floor(A),W=Ve(H+t),me=Math.floor(Y);if(me>=0&&me<De){const ie=n[me][W];if(ie)return{type:"BLOCK",x:W,y:me,cell:ie}}}return{type:"EMPTY"}},[t,n]),B=g.useCallback(()=>{T.current&&(clearInterval(T.current),T.current=null),j(0),R(null)},[]);g.useEffect(()=>()=>{T.current&&clearInterval(T.current)},[]);const Z=g.useCallback(A=>{if(S.current)return;A.currentTarget.setPointerCapture(A.pointerId);const{relX:Y,relY:H,vx:W,vy:me}=z(A.clientX,A.clientY,A.currentTarget);if(S.current={startX:A.clientX,startY:A.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:A.pointerId,actionConsumed:!1},!a){R({x:Y,y:H}),j(0);const le=Date.now();T.current=window.setInterval(()=>{const we=Date.now()-le;if(we<Fs)return;const Ce=we-Fs,be=Math.min(100,Ce/k*100);j(be),be>=100&&(S.current&&(S.current.actionConsumed=!0),xe.emit(ae.INPUT_SWAP),y==null||y(),B(),navigator.vibrate&&navigator.vibrate(50))},16)}const ie=Q(W,me);if(ie.type==="BLOCK"&&ie.cell){const le=ie.cell.groupSize*go,V=Date.now()-ie.cell.timestamp,we=De-1-s*(Bt-1);i?(x(ie.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):o&&ie.cell.color!==o?(x(ie.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):ie.cell.groupMinY<we?(x(ie.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):V<le?(x(ie.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):m(ie.cell.goopGroupId)}},[z,Q,s,B,k,o,i,a]),q=g.useCallback(A=>{if(!S.current||S.current.activePointerId!==A.pointerId)return;const{startX:Y,startY:H,isDragLocked:W}=S.current,me=A.clientX-Y,ie=A.clientY-H,le=Math.abs(me),V=Math.abs(ie);if(W||(le>Gr||V>Gr)&&(B(),S.current.isDragLocked=!0,m(null),le>V?S.current.lockedAxis="H":(S.current.lockedAxis="V",ie>0&&(xe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)))),S.current.isDragLocked){const we=S.current.lockedAxis;if(we==="H")me<-_o?(xe.emit(ae.INPUT_DRAG,{direction:1}),f==null||f(1)):me>_o?(xe.emit(ae.INPUT_DRAG,{direction:-1}),f==null||f(-1)):(xe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0));else if(we==="V"){const Ce=ie>0;xe.emit(ae.INPUT_FAST_DROP,{active:Ce}),p==null||p(Ce)}}},[B]),oe=g.useCallback(A=>{if(!S.current||S.current.activePointerId!==A.pointerId)return;const{startTime:Y,isDragLocked:H,actionConsumed:W,startX:me,startY:ie}=S.current,le=Date.now()-Y,V=A.clientX-me,we=A.clientY-ie;if(B(),xe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1),xe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0),m(null),S.current=null,A.currentTarget.releasePointerCapture(A.pointerId),!W&&!(le>=Fs))if(H)le<300&&Math.abs(we)>Math.abs(V)&&Math.abs(we)>50&&(we<0?(xe.emit(ae.INPUT_SWIPE_UP),d==null||d()):(xe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0),setTimeout(()=>{xe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)},150)));else{const{vx:Ce,vy:be,relX:$e,contentW:Fe}=z(A.clientX,A.clientY,A.currentTarget),Ee=Q(Ce,be);Ee.type==="BLOCK"&&Ee.cell?(xe.emit(ae.INPUT_BLOCK_TAP,{x:Ee.x,y:Ee.y}),c==null||c(Ee.x,Ee.y)):$e<Fe/2?(xe.emit(ae.INPUT_ROTATE,{clockwise:!1}),u==null||u(-1)):(xe.emit(ae.INPUT_ROTATE,{clockwise:!0}),u==null||u(1))}},[B,z,Q]),ne=g.useCallback(()=>{M.current&&(window.removeEventListener("touchmove",M.current.move),window.removeEventListener("touchend",M.current.end),window.removeEventListener("touchcancel",M.current.end),M.current=null)},[]),ve=g.useCallback(A=>{if(A.touches.length!==1||S.current)return;A.preventDefault();const Y=A.touches[0],H=A.currentTarget;E.current=H;const{relX:W,relY:me,vx:ie,vy:le}=z(Y.clientX,Y.clientY,H);if(S.current={startX:Y.clientX,startY:Y.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:Y.identifier,actionConsumed:!1},!a){R({x:W,y:me}),j(0);const be=Date.now();T.current=window.setInterval(()=>{const Fe=Date.now()-be;if(Fe<Fs)return;const Ee=Fe-Fs,Re=Math.min(100,Ee/k*100);j(Re),Re>=100&&(S.current&&(S.current.actionConsumed=!0),xe.emit(ae.INPUT_SWAP),y==null||y(),B(),navigator.vibrate&&navigator.vibrate(50))},16)}const V=Q(ie,le);if(V.type==="BLOCK"&&V.cell){const be=V.cell.groupSize*go,$e=Date.now()-V.cell.timestamp,Fe=De-1-s*(Bt-1);i?(x(V.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ee=>Ee===V.cell.goopGroupId?null:Ee),300)):o&&V.cell.color!==o?(x(V.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ee=>Ee===V.cell.goopGroupId?null:Ee),300)):V.cell.groupMinY<Fe?(x(V.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ee=>Ee===V.cell.goopGroupId?null:Ee),300)):$e<be?(x(V.cell.goopGroupId),xe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ee=>Ee===V.cell.goopGroupId?null:Ee),300)):m(V.cell.goopGroupId)}const we=be=>{if(!S.current||be.touches.length!==1)return;be.preventDefault();const $e=be.touches[0];if($e.identifier!==S.current.activePointerId)return;const{startX:Fe,startY:Ee,isDragLocked:Re}=S.current,Pe=$e.clientX-Fe,I=$e.clientY-Ee,F=Math.abs(Pe),ye=Math.abs(I);if(Re||(F>Gr||ye>Gr)&&(B(),S.current.isDragLocked=!0,m(null),F>ye?S.current.lockedAxis="H":(S.current.lockedAxis="V",I>0&&(xe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)))),S.current.isDragLocked){const ue=S.current.lockedAxis;ue==="H"?Pe<-_o?(xe.emit(ae.INPUT_DRAG,{direction:1}),f==null||f(1)):Pe>_o?(xe.emit(ae.INPUT_DRAG,{direction:-1}),f==null||f(-1)):(xe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0)):ue==="V"&&(I>_o?(xe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)):(xe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)))}},Ce=be=>{const $e=be.changedTouches[0];if(!S.current||!$e||$e.identifier!==S.current.activePointerId)return;const{startTime:Fe,isDragLocked:Ee,actionConsumed:Re,startX:Pe,startY:I}=S.current,F=Date.now()-Fe,ye=$e.clientX-Pe,ue=$e.clientY-I;B(),xe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1),xe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0),m(null);const D=E.current;if(S.current=null,E.current=null,ne(),!Re&&!(F>=Fs))if(!Ee&&D){const{vx:L,vy:G,relX:X,contentW:re}=z($e.clientX,$e.clientY,D),ke=Q(L,G);ke.type==="BLOCK"&&ke.cell?(xe.emit(ae.INPUT_BLOCK_TAP,{x:ke.x,y:ke.y}),c==null||c(ke.x,ke.y)):X<re/2?(xe.emit(ae.INPUT_ROTATE,{clockwise:!1}),u==null||u(-1)):(xe.emit(ae.INPUT_ROTATE,{clockwise:!0}),u==null||u(1))}else Ee&&F<300&&Math.abs(ue)>Math.abs(ye)&&Math.abs(ue)>50&&(ue<0?(xe.emit(ae.INPUT_SWIPE_UP),d==null||d()):(xe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0),setTimeout(()=>{xe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)},150)))};M.current={move:we,end:Ce},window.addEventListener("touchmove",we,{passive:!1}),window.addEventListener("touchend",Ce),window.addEventListener("touchcancel",Ce)},[z,Q,s,B,k,y,p,f,c,u,d,ne,o,i,a]);g.useEffect(()=>()=>ne(),[ne]);const Te=g.useCallback(A=>{A.preventDefault()},[]),pe=g.useCallback(A=>{A.preventDefault()},[]);return{handlers:{onPointerDown:Z,onPointerMove:q,onPointerUp:oe,onTouchStart:ve,onTouchMove:Te,onTouchEnd:pe,onTouchCancel:pe},holdState:{progress:C,position:P},highlightedGroupId:w,shakingGroupId:h,setHighlightedGroupId:m,setShakingGroupId:x}}const M0=8;function Jy(e,t,n,s,r,o=M0){let a="";return!r.t&&!r.l?a+=`M ${e} ${t+o} Q ${e} ${t} ${e+o} ${t} `:a+=`M ${e} ${t} `,!r.t&&!r.r?a+=`L ${e+n-o} ${t} Q ${e+n} ${t} ${e+n} ${t+o} `:a+=`L ${e+n} ${t} `,!r.b&&!r.r?a+=`L ${e+n} ${t+s-o} Q ${e+n} ${t+s} ${e+n-o} ${t+s} `:a+=`L ${e+n} ${t+s} `,!r.b&&!r.l?a+=`L ${e+o} ${t+s} Q ${e} ${t+s} ${e} ${t+s-o} `:a+=`L ${e} ${t+s} `,a+="Z",a}function Br(e,t,n,s,r,o=M0){const a=o;let i="";if(!r.t){const c=r.l?e:e+a,u=r.r?e+n:e+n-a;i+=`M ${c} ${t} L ${u} ${t} `}if(!r.r){const c=r.t?t:t+a,u=r.b?t+s:t+s-a;i+=`M ${e+n} ${c} L ${e+n} ${u} `}if(!r.b){const c=r.l?e:e+a,u=r.r?e+n:e+n-a;i+=`M ${u} ${t+s} L ${c} ${t+s} `}if(!r.l){const c=r.t?t:t+a,u=r.b?t+s:t+s-a;i+=`M ${e} ${u} L ${e} ${c} `}return!r.t&&!r.l&&(i+=`M ${e} ${t+a} Q ${e} ${t} ${e+a} ${t} `),!r.t&&!r.r&&(i+=`M ${e+n-a} ${t} Q ${e+n} ${t} ${e+n} ${t+a} `),!r.b&&!r.r&&(i+=`M ${e+n} ${t+s-a} Q ${e+n} ${t+s} ${e+n-a} ${t+s} `),!r.b&&!r.l&&(i+=`M ${e+a} ${t+s} Q ${e} ${t+s} ${e} ${t+s-a} `),i}function em(e,t,n){var o,a,i,c;const s=new Map;for(let u=nt;u<nt+Bt;u++)for(let f=0;f<rt;f++){const d=Ve(f+t),p=e[u][d];if(!p)continue;const y=Ct(f),k=Ct(f+1)-y;if(k<=0)continue;const w=(u-nt)*Ue,m={t:u>0&&((o=e[u-1][d])==null?void 0:o.goopGroupId)===p.goopGroupId,b:u<De-1&&((a=e[u+1][d])==null?void 0:a.goopGroupId)===p.goopGroupId,l:((i=e[u][Ve(d-1)])==null?void 0:i.goopGroupId)===p.goopGroupId,r:((c=e[u][Ve(d+1)])==null?void 0:c.goopGroupId)===p.goopGroupId};s.has(p.goopGroupId)||s.set(p.goopGroupId,[]),s.get(p.goopGroupId).push({visX:f,y:u,screenX:y,screenY:w,width:k,cell:p,color:p.color,neighbors:m})}const r=new Map;return n.forEach(u=>{r.has(u.data.goopGroupId)||r.set(u.data.goopGroupId,[]),r.get(u.data.goopGroupId).push(u)}),r.forEach((u,f)=>{const d=new Set;u.forEach(p=>d.add(`${Math.round(p.x)},${Math.round(p.y)}`)),u.forEach(p=>{if(p.y<nt-1)return;let y=p.x-t;if(y>je/2&&(y-=je),y<-je/2&&(y+=je),y>=0&&y<rt){const v=Ct(y),w=Ct(y+1)-v,m=(p.y-nt)*Ue,h=Math.round(p.x),x=Math.round(p.y),C={t:d.has(`${h},${x-1}`),r:d.has(`${Ve(h+1)},${x}`),b:d.has(`${h},${x+1}`),l:d.has(`${Ve(h-1)},${x}`)};s.has(f)||s.set(f,[]),s.get(f).push({visX:y,y:p.y,screenX:v,screenY:m,width:w,cell:p.data,color:p.data.color,neighbors:C,isFalling:!0})}})}),s}const tm=e=>{switch(e){case"COOLDOWN_BOOSTER":return"CB";case"GOOP_DUMP":return"GD";case"GOOP_COLORIZER":return"GC";case"CRACK_DOWN":return"CD";default:return e.charAt(0)}},nm=e=>{switch(e){case"COOLDOWN_BOOSTER":return"#5bbc70";case"GOOP_DUMP":return"#f97316";case"GOOP_COLORIZER":return"#a855f7";case"CRACK_DOWN":return"#ef4444";default:return"#6acbda"}},sm=({upgradeId:e,name:t,charge:n,isReady:s,x:r,y:o,size:a,onClick:i})=>{const[c,u]=g.useState(!1),f=g.useCallback(x=>{x.stopPropagation(),x.preventDefault(),s?i==null||i():(u(!0),setTimeout(()=>u(!1),300))},[s,i]),d=nm(e),p=tm(e),y=a/2,v=2,k=n/100,w=y*2,m=k*w,h=y-m;return l.jsx("g",{transform:`translate(${r}, ${o})`,children:l.jsxs("g",{className:c?"shake-anim":"",style:{cursor:"pointer"},onPointerDown:f,children:[l.jsx("defs",{children:l.jsx("clipPath",{id:`clip-${e}`,children:l.jsx("circle",{cx:0,cy:0,r:y-v})})}),l.jsx("circle",{cx:0,cy:0,r:y-v,fill:d,fillOpacity:.25}),!s&&l.jsx("rect",{x:-(y-v),y:h,width:(y-v)*2,height:m,fill:d,fillOpacity:.75,clipPath:`url(#clip-${e})`}),s&&l.jsx("circle",{cx:0,cy:0,r:y-v,fill:d,fillOpacity:.85}),l.jsx("circle",{cx:0,cy:0,r:y-v,fill:"none",stroke:d,strokeWidth:v}),s&&l.jsx("circle",{cx:0,cy:0,r:y,fill:"none",stroke:d,strokeWidth:2,opacity:.5,className:"animate-pulse"}),l.jsx("text",{x:0,y:0,textAnchor:"middle",dominantBaseline:"central",fill:s?"white":"#e2e8f0",fontSize:a*.3,fontWeight:"bold",fontFamily:"monospace",children:p})]})})},Gs=48,Bs=12,kf=({piece:e,label:t,visible:n,rank:s=0})=>{const[r,o]=g.useState(Date.now());if(g.useEffect(()=>{if(!(e!=null&&e.isWild))return;const c=setInterval(()=>o(Date.now()),50);return()=>clearInterval(c)},[e==null?void 0:e.isWild]),!n)return null;const a=c=>{const u=Rn(s),f=400,d=.15,p=r%(u.length*f)/f,y=c*d,v=(p+y)%u.length,k=Math.floor(v),w=(k+1)%u.length,m=v-k,h=u[k],x=u[w],C=parseInt(h.slice(1,3),16),j=parseInt(h.slice(3,5),16),P=parseInt(h.slice(5,7),16),R=parseInt(x.slice(1,3),16),S=parseInt(x.slice(3,5),16),T=parseInt(x.slice(5,7),16),E=Math.round(C+(R-C)*m),M=Math.round(j+(S-j)*m),U=Math.round(P+(T-P)*m);return`rgb(${E}, ${M}, ${U})`};let i=null;if(e){const c=e.isWild,u=Math.min(...e.cells.map(m=>m.x)),f=Math.max(...e.cells.map(m=>m.x)),d=Math.min(...e.cells.map(m=>m.y)),p=Math.max(...e.cells.map(m=>m.y)),y=f-u+1,v=p-d+1,k=(Gs-y*Bs)/2,w=(Gs-v*Bs)/2;i=e.cells.map((m,h)=>{var C;const x=k+(m.x-u)*Bs;return l.jsx("rect",{x,y:w+(m.y-d)*Bs,width:Bs-1,height:Bs-1,fill:c?a(x):((C=e.cellColors)==null?void 0:C[h])??e.color,rx:2},h)})}return l.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",border:"2px solid #475569",borderRadius:"6px",padding:"4px 6px",display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("div",{className:"t-body",style:{color:"#94a3b8",textAlign:"center",marginBottom:"2px",fontFamily:"monospace",letterSpacing:"1px"},children:t}),l.jsxs("svg",{width:Gs,height:Gs,style:{display:"block"},children:[l.jsx("rect",{x:0,y:0,width:Gs,height:Gs,fill:"rgba(30, 41, 59, 0.5)",rx:4}),i]})]})};function om(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function su(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=om(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function rm(e){return su(e.map(t=>t.pos))}function wf(e){if(!e.loopStarts||e.loopStarts.length<=1)return rm(e.vertices);let t="";for(let n=0;n<e.loopStarts.length;n++){const s=e.loopStarts[n],r=n+1<e.loopStarts.length?e.loopStarts[n+1]:e.vertices.length,o=e.vertices.slice(s,r);o.length>=3&&(t+=su(o.map(a=>a.pos))+" ")}return t.trim()}function im(e){let t=1/0,n=-1/0,s=1/0,r=-1/0;for(const o of e)o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y);return{minX:t,maxX:n,minY:s,maxY:r}}function lm(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?100:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<1e-4||v<1e-4){r.push({...i});continue}const k=-f/y,w=u/y,m=-p/v,h=d/v;let x=k+m,C=w+h;const j=Math.sqrt(x*x+C*C);j<1e-4?(x=k,C=w):(x/=j,C/=j);const P=k*x+w*C,R=P>.1?1/P:1,S=s[o]*.4,T=Math.min(t,S)*Math.min(R,2);r.push({x:i.x+x*T,y:i.y+C*T})}return r}function Rf(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function Pf(e,t){const n=t*Math.PI/180,s=Math.cos(n),r=Math.sin(n);return{x:e.x*s-e.y*r,y:e.x*r+e.y*s}}const Bi={damping:.98,stiffness:10,pressure:20,iterations:3,homeStiffness:.35,innerHomeStiffness:.64,returnSpeed:.8,viscosity:.7,gravity:10,fallingHomeStiffness:.35,fallingReturnSpeed:.8,fallingViscosity:.7,fallingGravity:10,attractionRadius:30,attractionRestLength:1,attractionStiffness:.037,goopiness:36,tendrilEndRadius:1,tendrilSkinniness:.2,wallThickness:8,fallingGoopiness:36,fallingTendrilEndRadius:1,fallingTendrilSkinniness:.2,dropletCount:30,dropletSpeed:60,dropletLifetime:3,dropletSize:9,dropletGravity:180},Et=30,Pn={x:-(rt/2)*Et,y:0},zo=je*Et;function am(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function cm(e){if(e.length===0)return[];const t=new Map;for(const a of e){const i=`${a.x1},${a.y1}`,c=`${a.x2},${a.y2}`;t.has(i)||t.set(i,[]),t.has(c)||t.set(c,[]),t.get(i).push(a),t.get(c).push(a)}const n=(a,i)=>{const c=i.x===a.x1&&i.y===a.y1?a.x2:a.x1,u=i.x===a.x1&&i.y===a.y1?a.y2:a.y1;return Math.atan2(u-i.y,c-i.x)},s=(a,i)=>{let c=i-a;for(;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;return c},r=new Set,o=[];for(;r.size<e.length;){const a=e.find(y=>!r.has(y));if(!a)break;const i=[];let c=a,u={x:c.x1,y:c.y1};const f={x:u.x,y:u.y};let d=n(c,u)+Math.PI,p=!0;for(;;){r.add(c),i.push({x:u.x,y:u.y});const y=u.x===c.x1&&u.y===c.y1?{x:c.x2,y:c.y2}:{x:c.x1,y:c.y1};if(!p&&y.x===f.x&&y.y===f.y)break;p=!1,d=Math.atan2(y.y-u.y,y.x-u.x)+Math.PI;const k=`${y.x},${y.y}`,m=(t.get(k)||[]).filter(C=>!r.has(C));if(m.length===0)break;let h=m[0],x=-1/0;for(const C of m){const j=n(C,y),P=s(d,j);P>x&&(x=P,h=C)}c=h,u=y}i.length>=3&&o.push(i)}return o}function um(e){return e.map(t=>({x:Pn.x+t.x*Et,y:Pn.y+t.y*Et}))}function jf(e){let t=0,n=0;for(const s of e){const r=Pn.x+(s.x+.5)*Et,o=Pn.y+(s.y+.5)*Et;t+=r,n+=o}return{x:t/e.length,y:n/e.length}}function fm(e,t,n,s,r=0){const o=am(e),i=cm(o).map(S=>um(S)),c=S=>{let T=0;for(let E=0;E<S.length;E++){const M=(E+1)%S.length;T+=S[E].x*S[M].y-S[M].x*S[E].y}return T/2};i.sort((S,T)=>Math.abs(c(T))-Math.abs(c(S)));const u=i.map((S,T)=>{const E=c(S);return T===0?E>0?S:[...S].reverse():E<0?S:[...S].reverse()});let f=[];const d=[];for(const S of u)d.push(f.length),f=f.concat(S);if(f.length<3){const S=jf(e),T=Et*.4;f=[{x:S.x-T,y:S.y-T},{x:S.x+T,y:S.y-T},{x:S.x+T,y:S.y+T},{x:S.x-T,y:S.y+T}],d.length=0,d.push(0)}const p=jf(e),y=p.x,v=p.y,k=f.map(S=>({pos:{x:S.x,y:S.y},oldPos:{x:S.x,y:S.y},homeOffset:{x:S.x-y,y:S.y-v},mass:1,attractionRadius:.8+Math.random()*.4})),w=k.length,m=[];for(let S=0;S<d.length;S++){const T=d[S],E=S+1<d.length?d[S+1]:w;for(let M=T;M<E;M++){const U=M+1<E?M+1:T;m.push({a:M,b:U,restLength:Rf(k[M].pos,k[U].pos)})}}const h=new Set;for(const S of m)h.add(`${Math.min(S.a,S.b)}-${Math.max(S.a,S.b)}`);const x=[],C=Et*1.5,j=new Set;for(let S=0;S<w;S++)for(let T=S+1;T<w;T++){const E=`${S}-${T}`;if(h.has(E))continue;const M=Rf(k[S].pos,k[T].pos);M<C&&(j.has(E)||(j.add(E),x.push({a:S,b:T,restLength:M})))}let P=0;for(let S=0;S<d.length;S++){const T=d[S],E=S+1<d.length?d[S+1]:f.length;let M=0;for(let U=T;U<E;U++){const ee=U+1<E?U+1:T;M+=f[U].x*f[ee].y-f[ee].x*f[U].y}P+=M}return P=Math.abs(P)/2,{id:n,color:t,vertices:k,innerVertices:[{pos:{x:y,y:v},oldPos:{x:y,y:v},homeOffset:{x:0,y:0},mass:1,attractionRadius:1}],loopStarts:d,ringsprings:m,crossSprings:x,restArea:P,gridCells:e.map(S=>({x:S.x,y:S.y})),isColliding:!1,isLocked:s,isFalling:!s,isLoose:!1,looseTime:0,fillAmount:s?0:1,wasFullLastFrame:!s,rotation:0,targetX:y,targetY:v,visualOffsetY:0,createdAtRotation:r}}function vo(e,t){let n=t-e;return n>zo/2&&(n-=zo),n<-zo/2&&(n+=zo),n}function dm(e,t,n){const s=Math.min(t,.033);for(const r of e){const o=n.damping;let a=r.isLocked?n.gravity:n.fallingGravity;if(r.isLoose){r.looseTime+=s;const i=.6,c=Math.min(1,r.looseTime/i);a*=c*c*c}else r.looseTime=0;for(const i of r.vertices){const c=(i.pos.x-i.oldPos.x)*o,u=(i.pos.y-i.oldPos.y)*o;i.oldPos.x=i.pos.x,i.oldPos.y=i.pos.y,i.pos.x+=c,i.pos.y+=u+a*s*s}for(const i of r.innerVertices){const c=(i.pos.x-i.oldPos.x)*o,u=(i.pos.y-i.oldPos.y)*o;i.oldPos.x=i.pos.x,i.oldPos.y=i.pos.y,i.pos.x+=c,i.pos.y+=u+a*s*s}}}function pm(e,t){for(const n of e){const s=n.isLocked?t.returnSpeed:t.fallingReturnSpeed,r=s*s,o=n.isLocked?t.viscosity:t.fallingViscosity,a=Math.max(0,1-o),i=o>0?.03/Math.max(1,o):0,c=n.isLocked?t.homeStiffness:t.fallingHomeStiffness;for(const u of n.vertices){const f=Pf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,v=p-u.pos.y,k=y*c*r,w=v*c*r;u.pos.x+=k*a,u.pos.y+=w*a,o>0&&(u.oldPos.x-=k*i,u.oldPos.y-=w*i)}for(const u of n.innerVertices){const f=Pf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,v=p-u.pos.y,k=y*t.innerHomeStiffness*r,w=v*t.innerHomeStiffness*r;u.pos.x+=k*a,u.pos.y+=w*a,o>0&&(u.oldPos.x-=k*i,u.oldPos.y-=w*i)}}}function Tf(e,t,n){const s=e[t.a],r=e[t.b],o=vo(s.pos.x,r.pos.x),a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)return;const u=(i-t.restLength)/i*n*.5;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}function hm(e,t){for(let n=0;n<t.iterations;n++)for(const s of e){for(const r of s.ringsprings)Tf(s.vertices,r,t.stiffness*.01);for(const r of s.crossSprings)Tf(s.vertices,r,t.stiffness*.005)}}function xm(e,t){for(const n of e){if(!n.isLocked)continue;const s=n.targetX,r=n.targetY,o=t.pressure*.002;for(const a of n.vertices){const i=a.pos.x-s,c=a.pos.y-r,u=Math.sqrt(i*i+c*c),f=Math.sqrt(a.homeOffset.x*a.homeOffset.x+a.homeOffset.y*a.homeOffset.y);if(u>1e-4&&f>1e-4){const p=(f-u)*o;a.pos.x+=i/u*p,a.pos.y+=c/u*p}}}}function ym(e,t){for(const r of e){for(const o of r.vertices){if(o.pos.y<t.minY+2){o.pos.y=t.minY+2;const a=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-a*.3}if(o.pos.y>t.maxY-2){o.pos.y=t.maxY-2;const a=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-a*.3}}for(const o of r.innerVertices)o.pos.y<t.minY+2&&(o.pos.y=t.minY+2),o.pos.y>t.maxY-2&&(o.pos.y=t.maxY-2)}}function mm(e,t,n,s){dm(e,t,n),pm(e,n),hm(e,n),xm(e,n),ym(e,s)}function gm(e,t){const n=e.vertices,s=n.length;for(let r=0;r<s;r++){const o=n[(r-1+s)%s],a=n[r],i=n[(r+1)%s],c=a.pos.x-o.pos.x,u=a.pos.y-o.pos.y,f=i.pos.x-a.pos.x,d=i.pos.y-a.pos.y,p=Math.sqrt(c*c+u*u),y=Math.sqrt(f*f+d*d);if(p<1e-4||y<1e-4)continue;const v=u/p,k=-c/p,w=d/y,m=-f/y;let h=v+w,x=k+m;const C=Math.sqrt(h*h+x*x);C<1e-4||(h/=C,x/=C,n[r].oldPos.x-=h*t,n[r].oldPos.y-=x*t)}}function vm(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertexA],u=i.vertices[o.vertexB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertexA}-${o.blobB}-${o.vertexB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=vo(c.targetX,i.targetX),f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++){const y=i.vertices[p],v=n.attractionRadius*y.attractionRadius;for(let k=0;k<c.vertices.length;k++){const w=c.vertices[k],m=n.attractionRadius*w.attractionRadius,h=(v+m)/2,x=vo(y.pos.x,w.pos.x),C=w.pos.y-y.pos.y,j=Math.sqrt(x*x+C*C),P=`${o}-${p}-${a}-${k}`;r.has(P)||j>h||(s.push({blobA:o,blobB:a,vertexA:p,vertexB:k,restLength:n.attractionRestLength}),r.add(P))}}}return s}function Sm(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertexA],u=i.vertices[o.vertexB];if(!c||!u)continue;const f=vo(c.pos.x,u.pos.x),d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=Math.max(0,Math.min(1,1-p/n.goopiness)),v=s+y*(r-s),w=(p-o.restLength)*v,m=f/p*w,h=d/p*w;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function Cm(e,t=30){for(let o=0;o<3;o++)for(let a=0;a<e.length;a++)for(let i=a+1;i<e.length;i++){const c=e[a],u=e[i];if(c.color===u.color)continue;const f=c.isFalling||c.isLoose,d=u.isFalling||u.isLoose;if(!f&&!d)continue;const p=c.targetX-u.targetX,y=c.targetY-u.targetY;if(!(Math.sqrt(p*p+y*y)>t*4))for(const k of c.vertices)for(const w of u.vertices){const m=w.pos.x-k.pos.x,h=w.pos.y-k.pos.y,x=Math.sqrt(m*m+h*h);if(x<2.5&&x>.01){const C=2.5-x,j=m/x,P=h/x,R=C*.8;k.pos.x-=j*R*.5,k.pos.y-=P*R*.5,w.pos.x+=j*R*.5,w.pos.y+=P*R*.5,k.oldPos.x-=j*R*.3,k.oldPos.y-=P*R*.3,w.oldPos.x+=j*R*.3,w.oldPos.y+=P*R*.3}}}}function km(e,t,n,s,r,o=0){var d;if(e.isLocked||e.isLoose)return;let a=!0;for(const p of e.gridCells){const y=p.y+1;if(y>=r){a=!1;break}const v=Math.floor(y)+nt;let k=Math.floor(p.x)+o;for(;k<0;)k+=je;for(;k>=je;)k-=je;const w=(d=s[v])==null?void 0:d[k];if(w&&w.goopGroupId!==void 0){a=!1;break}}if(e.isColliding=!a,a){const p=n*t;for(e.visualOffsetY+=p;e.visualOffsetY>=Et;){for(const y of e.gridCells)y.y+=1;e.visualOffsetY-=Et}}let i=0,c=0;for(const p of e.gridCells)i+=p.x,c+=p.y;const u=i/e.gridCells.length,f=c/e.gridCells.length;e.targetX=Pn.x+(u+.5)*Et,e.targetY=Pn.y+(f+.5)*Et+e.visualOffsetY}function $l(e){if(e.vertices.length<3)return[0];const t=e.vertices.map(c=>c.pos.x),n=Math.min(...t),s=Math.max(...t),r=-180,o=180,a=[],i=zo;for(const c of[0,i,-i]){const u=n+c;s+c>=r&&u<=o&&a.push(c)}return a.length>1&&console.log(`Blob ${e.id} straddles seam, rendering at offsets:`,a,`(X range: ${n.toFixed(0)} to ${s.toFixed(0)})`),a.length>0?a:[0]}const wm=({state:e,rank:t,maxTime:n,lightsBrightness:s=100,laserCharge:r=100,controlsHeat:o=0,complicationCooldowns:a,equippedActives:i=[],activeCharges:c={},onActivateAbility:u,powerUps:f,storedGoop:d,nextGoop:p,softBodyPhysics:y,normalGoopOpacity:v=1,showVertexDebug:k=!1,gooStdDev:w=8,gooAlphaMul:m=24,gooAlphaOff:h=-13,fallingGooStdDev:x,fallingGooAlphaMul:C,fallingGooAlphaOff:j,trainingHighlightColor:P,disableSwap:R,disablePop:S})=>{const{grid:T,tankRotation:E,activeGoop:M,looseGoop:U,floatingTexts:ee,shiftTime:te,goalMarks:N,crackCells:z,dumpPieces:Q}=e,B=g.useMemo(()=>Rn(t),[t]),Z=g.useMemo(()=>te<=0?1:Math.max(0,1-te/n),[te,n]),oe=`hsla(${Math.max(0,120*(1-Z))}, 100%, 50%, 0.15)`,ne=1+Z*(Bt-1),{x:ve,y:Te,w:pe,h:A}=zs,Y=ne*Ue,H=A-Y,{handlers:W,holdState:me,highlightedGroupId:ie,shakingGroupId:le}=Qy({callbacks:{},tankRotation:E,grid:T,tankPressure:Z,powerUps:f,trainingHighlightColor:P,disableSwap:R,disablePop:S}),[V,we]=g.useState(-1),[Ce,be]=g.useState(0);g.useEffect(()=>xe.on(ae.INPUT_SWAP_HOLD,L=>{we((L==null?void 0:L.progress)??-1)}),[]),g.useEffect(()=>{var b,_;if(!y)return;const D=new Set;for(let O=nt;O<De;O++)for(let $=0;$<je;$++){const K=(b=T[O])==null?void 0:b[$];K!=null&&K.goopGroupId&&D.add(K.goopGroupId)}const L=new Map;for(let O=0;O<Bt;O++){const $=O+nt;for(let K=0;K<rt;K++){const se=(E+K)%je,de=(_=T[$])==null?void 0:_[se];if(de!=null&&de.goopGroupId){const ge=de.goopGroupId;L.has(ge)||L.set(ge,{cells:[],color:de.color}),L.get(ge).cells.push({x:K,y:O})}}}const G=new Set(y.blobs.map(O=>O.id));let X=!1;for(const[O,$]of L)G.has(O)||(y.createBlob($.cells,$.color,O,!0,E),X=!0);y.shiftBlobsForRotation(E);const re=new Map;for(const O of U){const $=O.data.goopGroupId;re.has($)||re.set($,{avgY:0,cells:[]}),re.get($).cells.push({x:O.x,y:O.y})}for(const[O,$]of re){const K=$.cells.reduce((se,de)=>se+de.y,0)/$.cells.length;$.avgY=K}for(const O of y.blobs){const $=re.get(O.id);if($){O.isLoose=!0,O.isLocked=!1;const K=($.avgY-nt)*Et;O.targetY=K}else O.isLoose&&(O.isLoose=!1,O.isLocked=!0,O.fillAmount=0)}const ke=new Set(U.map(O=>O.data.goopGroupId));for(const O of y.blobs)O.id.startsWith("active-")||!D.has(O.id)&&!ke.has(O.id)&&(e.poppedGoopGroupIds.has(O.id)&&(y.createDropletsForPop(O),e.poppedGoopGroupIds.delete(O.id)),y.removeBlob(O.id),X=!0);X&&be(O=>O+1)},[T,E,y]);const $e=g.useRef(null);g.useEffect(()=>{var G;if(!y||!M||M.state!==Fn.FALLING)return;const D=`active-${M.spawnTimestamp}`;if(!y.getBlob(D)){const X=M.cells.map(_=>({x:_.x,y:_.y}));let re=M.x-E;re>je/2&&(re-=je),re<-je/2&&(re+=je);const ke=X.map(_=>({x:re+_.x,y:M.y+_.y-nt})),b=((G=M.definition.cellColors)==null?void 0:G[0])??M.definition.color;y.createBlob(ke,b,D,!1,E),be(_=>_+1)}},[M==null?void 0:M.spawnTimestamp,y,E]);const Fe=g.useRef(null),Ee=g.useRef(0);g.useEffect(()=>{if(!y||!M||M.state!==Fn.FALLING)return;const D=`active-${M.spawnTimestamp}`,L=y.getBlob(D);if(!L)return;let G=M.x-E;G>je/2&&(G-=je),G<-je/2&&(G+=je);const X=M.rotation,re=Fe.current!==null&&Fe.current!==X,ke=Ee.current!==E;if(re){let b=L.gridCells.length>0?L.gridCells[0].y:0;for(const $ of L.gridCells)$.y<b&&(b=$.y);let _=M.cells.length>0?M.cells[0].y:0;for(const $ of M.cells)$.y<_&&(_=$.y);const O=M.cells.map($=>({x:G+$.x,y:b+($.y-_)}));L.gridCells=O,L.rotation=X*90}if(ke||re){for(let $=0;$<L.gridCells.length&&$<M.cells.length;$++)L.gridCells[$].x=G+M.cells[$].x;let b=0;for(const $ of L.gridCells)b+=$.x;const _=b/L.gridCells.length,O=Pn.x+(_+.5)*Et;if(ke){const $=O-L.targetX;for(const K of L.vertices)K.pos.x+=$,K.oldPos.x+=$;for(const K of L.innerVertices)K.pos.x+=$,K.oldPos.x+=$}L.targetX=O}Fe.current=X,Ee.current=E},[M==null?void 0:M.x,M==null?void 0:M.rotation,M==null?void 0:M.state,y,E]),g.useEffect(()=>{if(!y)return;const D=$e.current,L=M;if(D&&D.state===Fn.FALLING&&(!L||L.spawnTimestamp!==D.spawnTimestamp)){const G=`active-${D.spawnTimestamp}`;y.removeBlob(G),be(X=>X+1)}$e.current=L},[M,y]);const Re=Date.now(),Pe=g.useMemo(()=>em(T,E,U),[T,E,U]),I=g.useCallback(D=>{if(B.length===0)return"#a855f7";const L=400,G=.02,X=Re%(B.length*L)/L,re=Math.abs(D)*G;let ke=(X+re)%B.length;ke<0&&(ke+=B.length);const b=Math.floor(ke),_=(b+1)%B.length,O=ke-b,$=B[b],K=B[_];if(!$||!K)return"#a855f7";const se=parseInt($.slice(1,3),16),de=parseInt($.slice(3,5),16),ge=parseInt($.slice(5,7),16),J=parseInt(K.slice(1,3),16),Ne=parseInt(K.slice(3,5),16),Me=parseInt(K.slice(5,7),16),Ge=Math.round(se+(J-se)*O),He=Math.round(de+(Ne-de)*O),Be=Math.round(ge+(Me-ge)*O);return`rgb(${Ge}, ${He}, ${Be})`},[Re,B]),F=g.useMemo(()=>vn?null:l.jsx("defs",{children:Array.from(Pe.entries()).map(([D,L])=>l.jsx("mask",{id:`mask-${D}`,children:L.map((G,X)=>l.jsx("path",{d:Jy(G.screenX,G.screenY,G.width,Ue,G.neighbors),fill:"white",stroke:"white",strokeWidth:"1.5"},G.cell.id+"-"+X))},`mask-${D}`))}),[Pe]);g.useMemo(()=>new Set(N.map(D=>D.color)),[N]);const ye=((f==null?void 0:f.GOOP_HOLD_VIEWER)||0)>=1,ue=((f==null?void 0:f.GOOP_WINDOW)||0)>=1;return l.jsxs("div",{className:"w-full h-full bg-slate-950 relative shadow-2xl border-x-4 border-slate-900 overflow-hidden select-none touch-none",style:{touchAction:"manipulation",contain:"strict"},onPointerDown:W.onPointerDown,onPointerMove:W.onPointerMove,onPointerUp:W.onPointerUp,onPointerLeave:W.onPointerUp,onTouchStart:W.onTouchStart,onTouchMove:W.onTouchMove,onTouchEnd:W.onTouchEnd,onTouchCancel:W.onTouchCancel,children:[!vn&&l.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] hidden md:block",style:{backgroundSize:"100% 2px, 3px 100%"}}),l.jsxs("svg",{width:"100%",height:"100%",viewBox:`${ve} ${Te} ${pe} ${A}`,preserveAspectRatio:"xMidYMin meet",className:"touch-none",style:{pointerEvents:"none",willChange:"transform",filter:s<100?`brightness(${s/100}) grayscale(${Math.max(0,(50-s)/50)})`:s>100?`brightness(${s/100})`:void 0,transition:"filter 0.05s linear"},children:[F,l.jsxs("defs",{children:[l.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:w,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${m} ${h}`,result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),l.jsxs("filter",{id:"goo-filter-falling",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:x??w,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${C??m} ${j??h}`,result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),l.jsx("clipPath",{id:"tank-viewport-clip",children:l.jsx("rect",{x:zs.x,y:zs.y,width:zs.w,height:zs.h})})]}),l.jsx("rect",{x:ve,y:H,width:pe,height:Y,fill:oe}),l.jsx("line",{x1:ve,y1:H,x2:ve+pe,y2:H,stroke:oe.replace("0.15","0.6"),strokeWidth:"2",strokeDasharray:"4 4"}),!vn&&Array.from({length:Bt}).map((D,L)=>{const G=L*Ue;return Array.from({length:rt}).map((X,re)=>{const ke=Ct(re),b=Ct(re+1)-ke;return l.jsxs("g",{children:[l.jsx("line",{x1:ke,y1:G,x2:ke+b,y2:G,stroke:tt.GRID_EMPTY,strokeWidth:"1",opacity:.2}),l.jsx("line",{x1:ke,y1:G,x2:ke,y2:G+Ue,stroke:tt.GRID_EMPTY,strokeWidth:"1",opacity:.2})]},`bg-${L}-${re}`)})}),z&&z.filter(D=>Re-D.spawnTime>=500).map(D=>D.branchCrackIds.map(L=>{const G=z.find(ge=>ge.id===L);if(!G||Re-G.spawnTime<500)return null;let X=D.x-E;X>je/2&&(X-=je),X<-je/2&&(X+=je);let re=G.x-E;if(re>je/2&&(re-=je),re<-je/2&&(re+=je),X<-1||X>rt||re<-1||re>rt)return null;const ke=Ct(X),b=Ct(X+1)-ke,_=ke+b/2,O=(D.y-nt)*Ue+Ue/2,$=Ct(re),K=Ct(re+1)-$,se=$+K/2,de=(G.y-nt)*Ue+Ue/2;return l.jsx("line",{x1:_,y1:O,x2:se,y2:de,stroke:D.color,strokeWidth:"2",strokeOpacity:.7},`crack-line-${D.id}-${L}`)})),z&&z.filter(D=>Re-D.spawnTime>=500).map(D=>{let L=D.x-E;if(L>je/2&&(L-=je),L<-je/2&&(L+=je),L>=0&&L<rt){const G=Ct(L),X=Ct(L+1)-G,re=(D.y-nt)*Ue,ke=G+X/2,b=re+Ue/2;return l.jsx("circle",{cx:ke,cy:b,r:Ue/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`crack-${D.id}`)}return null}),N.filter(D=>Re-D.spawnTime>=500).map(D=>{let L=D.x-E;if(L>je/2&&(L-=je),L<-je/2&&(L+=je),L>=0&&L<rt){const G=Ct(L),X=Ct(L+1)-G,re=(D.y-nt)*Ue,ke=G+X/2,b=re+Ue/2;return l.jsx("circle",{cx:ke,cy:b,r:Ue/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`goal-${D.id}`)}return null}),N.map(D=>{let L=D.x-E;if(L>je/2&&(L-=je),L<-je/2&&(L+=je),L<0||L>=rt){const G=L>=rt,X=(D.y-nt)*Ue+Ue/2,re=G?ve+pe-5:ve+5;return l.jsx("g",{opacity:.7,children:l.jsx("path",{d:G?`M ${re} ${X-10} L ${re+10} ${X} L ${re} ${X+10} Z`:`M ${re} ${X-10} L ${re-10} ${X} L ${re} ${X+10} Z`,fill:D.color,stroke:"white",strokeWidth:"1"})},`off-${D.id}`)}return null}),l.jsx("g",{opacity:v,children:Array.from(Pe.entries()).map(([D,L])=>{if(L.length===0)return null;const X=L[0].color,re=D===ie,ke=D===le||e.prePoppedGoopGroups.has(D),b=L.some(J=>J.cell.isSealingGoop),_=e.prePoppedGoopGroups.has(D),O=L.some(J=>J.cell.isWild);let $=1/0,K=1/0,se=-1/0,de=-1/0;L.forEach(J=>{$=Math.min($,J.screenX),K=Math.min(K,J.screenY),se=Math.max(se,J.screenX+J.width),de=Math.max(de,J.screenY+Ue)});const ge=O?I($):X;if(vn){const J=L[0].cell.groupSize*go,Ne=Re-L[0].cell.timestamp,Me=Math.min(1,Ne/J),Ge=Me>=1,He=de-K,Be=de-Me*He;return l.jsxs("g",{className:ke?"shake-anim":"",children:[L.map(_e=>l.jsx("rect",{x:_e.screenX-.5,y:_e.screenY,width:_e.width+1,height:Ue,fill:_e.cell.isWild?I(_e.screenX):X,fillOpacity:.25},`bg-${_e.cell.id}`)),!Ge&&L.map(_e=>{const Je=_e.screenY+Ue,ce=_e.screenY;if(Je<=Be)return null;const it=Math.max(ce,Be),lt=Je-it;return l.jsx("rect",{x:_e.screenX-.5,y:it,width:_e.width+1,height:lt,fill:_e.cell.isWild?I(_e.screenX):X,fillOpacity:.75},`fill-${_e.cell.id}`)}),Ge&&L.map(_e=>l.jsx("rect",{x:_e.screenX-.5,y:_e.screenY,width:_e.width+1,height:Ue,fill:_e.cell.isWild?I(_e.screenX):X,fillOpacity:.85},`full-${_e.cell.id}`)),L.map(_e=>l.jsx("path",{d:Br(_e.screenX,_e.screenY,_e.width,Ue,_e.neighbors),fill:"none",stroke:_?"#ff6b6b":b?"white":_e.cell.isWild?I(_e.screenX):X,strokeWidth:_||b?3:2,strokeDasharray:_?"4 2":void 0,className:_e.cell.isWild&&!_&&!b?"wild-stroke":void 0},`cnt-${_e.cell.id}`)),re&&l.jsx("rect",{x:$,y:K,width:se-$,height:de-K,fill:"white",fillOpacity:.3})]},`group-${D}`)}return l.jsxs("g",{className:ke?"shake-anim":"",children:[l.jsx("rect",{x:$,y:K,width:se-$,height:de-K,fill:ge,fillOpacity:.2,mask:`url(#mask-${D})`}),l.jsx("g",{opacity:.9,mask:`url(#mask-${D})`,children:L.map((J,Ne)=>{const Me=J.cell.isWild?I(J.screenX):X;if(!J.cell||J.isFalling)return l.jsx("rect",{x:J.screenX-.5,y:J.screenY,width:J.width+1,height:Ue,fill:Me},`liq-${J.cell.id}`);const Ge=J.cell.groupSize*go,He=J.cell.groupMaxY-J.cell.groupMinY+1,Be=Ge/Math.max(1,He),Je=(J.cell.groupMaxY-J.y)*Be,ce=Re-J.cell.timestamp-Je;let it=ce>=Be?Ue:ce>0?ce/Be*Ue:0;return l.jsx("rect",{x:J.screenX-.5,y:J.screenY+(Ue-it),width:J.width+1,height:it,fill:Me},`liq-${J.cell.id}`)})}),re&&l.jsx("rect",{x:$,y:K,width:se-$,height:de-K,fill:"white",fillOpacity:.3,mask:`url(#mask-${D})`}),L.map((J,Ne)=>l.jsx("path",{d:Br(J.screenX,J.screenY,J.width,Ue,J.neighbors),fill:"none",stroke:_?"#ff6b6b":b?"white":J.cell.isWild?I(J.screenX):X,strokeWidth:_||b?"3":"2",strokeDasharray:_?"4 2":void 0,className:!vn&&!_?J.cell.isWild?"wild-stroke":b?"super-glowing-stroke":"glow-stroke":void 0,style:!vn&&!_&&!J.cell.isWild?{color:b?"white":X}:void 0},`cnt-${J.cell.id}`))]},`group-${D}`)})}),y&&y.blobs.length>0&&(()=>{const D=new Map;for(const X of y.blobs){if(X.isFalling)continue;const re=D.get(X.color)||[];re.push(X),D.set(X.color,re)}const L=y.attractionSprings,G=y.params;return l.jsx(l.Fragment,{children:Array.from(D.entries()).map(([X,re])=>{const ke=P!=null&&X===P;return l.jsxs("g",{className:ke?"training-pulse":void 0,children:[l.jsxs("g",{filter:"url(#goo-filter)",clipPath:"url(#tank-viewport-clip)",children:[L.map((b,_)=>{const O=y.blobs[b.blobA],$=y.blobs[b.blobB];if(!O||!$||O.color!==X)return null;const K=O.vertices[b.vertexA],se=$.vertices[b.vertexB];if(!K||!se)return null;const de=vo(K.pos.x,se.pos.x),ge=se.pos.y-K.pos.y,J=Math.sqrt(de*de+ge*ge),Ne=Math.min(1,J/G.goopiness),Me=G.tendrilEndRadius;if(Me<1)return null;const Ge=1-G.tendrilSkinniness,He=1-G.tendrilSkinniness*.3,Be=He-(He-Ge)*Ne,_e=Me*Be,Je=Me*1.4,ce=Math.max(2,Math.ceil(J/Je)),it=[];for(let lt=0;lt<=ce;lt++){const Rt=lt/ce,he=Math.sin(Rt*Math.PI),fe=Me-(Me-_e)*he;it.push({cx:K.pos.x+de*Rt,cy:K.pos.y+ge*Rt,r:Math.max(2,fe)})}return l.jsx("g",{children:it.map((lt,Rt)=>l.jsx("circle",{cx:lt.cx,cy:lt.cy,r:lt.r,fill:O.color},Rt))},`tendril-${_}`)}),re.map(b=>{const _=b.id===le||e.prePoppedGoopGroups.has(b.id),O=wf(b),K=$l(b).map(se=>se===0?"":`translate(${se}, 0)`);return l.jsx("g",{className:_?"shake-anim":void 0,children:K.map((se,de)=>l.jsx("path",{d:O,fill:b.color,fillRule:"evenodd",transform:se},`soft-${b.id}-${de}`))},`soft-${b.id}`)})]}),l.jsx("g",{clipPath:"url(#tank-viewport-clip)",children:re.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const _=b.id===le||e.prePoppedGoopGroups.has(b.id),O=b.vertices.map(Be=>Be.pos),$=G.wallThickness,K=lm(O,$),se=su(K),de=im(K),ge=de.maxY-de.minY,J=de.maxY-ge*b.fillAmount,Ne=`fill-clip-${b.id}`,Me=50,He=$l(b).map(Be=>Be===0?"":`translate(${Be}, 0)`);return l.jsx("g",{className:_?"shake-anim":void 0,children:He.map((Be,_e)=>l.jsxs("g",{transform:Be,children:[l.jsx("defs",{children:l.jsx("clipPath",{id:`${Ne}-${_e}`,children:l.jsx("rect",{x:de.minX-Me,y:de.minY-Me,width:de.maxX-de.minX+Me*2,height:J-de.minY+Me})})}),l.jsx("path",{d:se,fill:"#1e293b",clipPath:`url(#${Ne}-${_e})`})]},`cutout-${b.id}-${_e}`))},`cutout-${b.id}`)})})]},`color-group-${X}`)})})})(),y&&(()=>{const D=y.blobs.filter(X=>X.isFalling&&!X.isLocked);if(D.length===0)return null;const L=y.attractionSprings,G=y.params;return l.jsxs("g",{filter:"url(#goo-filter-falling)",clipPath:"url(#tank-viewport-clip)",children:[L.map((X,re)=>{const ke=y.blobs[X.blobA],b=y.blobs[X.blobB];if(!ke||!b||!ke.isFalling&&!b.isFalling)return null;const _=ke.vertices[X.vertexA],O=b.vertices[X.vertexB];if(!_||!O)return null;const $=vo(_.pos.x,O.pos.x),K=O.pos.y-_.pos.y,se=Math.sqrt($*$+K*K),de=Math.min(1,se/G.fallingGoopiness),ge=G.fallingTendrilEndRadius;if(ge<1)return null;const J=1-G.fallingTendrilSkinniness,Ne=1-G.fallingTendrilSkinniness*.3,Me=Ne-(Ne-J)*de,Ge=ge*Me,He=ge*1.4,Be=Math.max(2,Math.ceil(se/He)),_e=[];for(let Je=0;Je<=Be;Je++){const ce=Je/Be,it=Math.sin(ce*Math.PI),lt=ge-(ge-Ge)*it;_e.push({cx:_.pos.x+$*ce,cy:_.pos.y+K*ce,r:Math.max(2,lt)})}return l.jsx("g",{children:_e.map((Je,ce)=>l.jsx("circle",{cx:Je.cx,cy:Je.cy,r:Je.r,fill:ke.color},ce))},`falling-tendril-${re}`)}),D.map(X=>$l(X).map((ke,b)=>{const _=wf(X);if(!_)return null;const O=ke===0?void 0:`translate(${ke}, 0)`,$=M==null?void 0:M.definition.isWild,K=$?I(X.targetX):X.color;return l.jsx("path",{d:_,fill:K,fillRule:"evenodd",fillOpacity:.8,transform:O,className:$?"wild-stroke wild-fill":void 0},`falling-${X.id}-${b}`)}))]})})(),y&&y.droplets.length>0&&l.jsx("g",{children:y.droplets.map(D=>l.jsx("circle",{cx:D.pos.x,cy:D.pos.y,r:D.radius,fill:D.color,opacity:D.opacity},D.id))}),k&&y&&y.blobs.length>0&&l.jsx("g",{children:y.blobs.map(D=>l.jsxs("g",{children:[l.jsx("circle",{cx:D.targetX,cy:D.targetY,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),D.vertices.map((L,G)=>{const X=D.vertices[(G+1)%D.vertices.length];return l.jsx("line",{x1:L.pos.x,y1:L.pos.y,x2:X.pos.x,y2:X.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${D.id}-${G}`)}),D.vertices.map((L,G)=>l.jsxs("g",{children:[l.jsx("circle",{cx:L.pos.x,cy:L.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),l.jsx("text",{x:L.pos.x+6,y:L.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:G})]},`v-${D.id}-${G}`)),D.innerVertices.map((L,G)=>l.jsx("circle",{cx:L.pos.x,cy:L.pos.y,r:3,fill:"gray",stroke:"white",strokeWidth:1},`iv-${D.id}-${G}`)),l.jsx("text",{x:D.targetX,y:D.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:D.isLocked?`${Math.round(D.fillAmount*100)}%`:"falling"})]},`debug-${D.id}`))}),M&&M.state===Fn.FALLING&&(()=>{const D=T0(T,M),L=M.definition.isWild;return M.cells.map((G,X)=>{var O;const re=((O=M.definition.cellColors)==null?void 0:O[X])??M.definition.color,ke=Ve(M.x+G.x),b=D+G.y;if(b<nt)return null;let _=ke-E;if(_>je/2&&(_-=je),_<-je/2&&(_+=je),_>=-2&&_<rt+2){const $=Ct(_),K=Ct(_+1)-$,se=(b-nt)*Ue,de={t:M.cells.some(ge=>ge.x===G.x&&ge.y===G.y-1),r:M.cells.some(ge=>ge.x===G.x+1&&ge.y===G.y),b:M.cells.some(ge=>ge.x===G.x&&ge.y===G.y+1),l:M.cells.some(ge=>ge.x===G.x-1&&ge.y===G.y)};return l.jsxs("g",{children:[l.jsx("rect",{x:$,y:se,width:K,height:Ue,fill:L?I($):re,fillOpacity:.2,rx:4,ry:4}),l.jsx("path",{d:Br($,se,K,Ue,de),fill:"none",stroke:L?I($):re,strokeWidth:"1",strokeDasharray:"4 2",opacity:"0.75",className:L?"wild-stroke":void 0})]},`ghost-${X}`)}return null})})(),Q&&Q.map(D=>{let L=D.x-E;if(L>je/2&&(L-=je),L<-je/2&&(L+=je),L<-1||L>rt)return null;const G=Ct(L),X=Ct(L+1)-G,re=(D.y-nt)*Ue;return re<-Ue?null:l.jsxs("g",{children:[l.jsx("rect",{x:G,y:re,width:X,height:Ue,fill:D.color,fillOpacity:.3,rx:4,ry:4}),l.jsx("rect",{x:G,y:re,width:X,height:Ue,fill:"none",stroke:D.color,strokeWidth:"2",strokeDasharray:"4 2",rx:4,ry:4})]},`dump-${D.id}`)}),M&&M.state===Fn.FALLING&&(()=>{if(y){const G=`active-${M.spawnTimestamp}`,X=y.getBlob(G);if(X&&X.isFalling&&!X.isLocked&&X.gridCells.some(ke=>ke.y>=0))return null}const D=M.definition.isWild,L=M.cells.map((G,X)=>{var O;const re=((O=M.definition.cellColors)==null?void 0:O[X])??M.definition.color,ke=Ve(M.x+G.x),b=M.y+G.y;let _=ke-E;if(_>je/2&&(_-=je),_<-je/2&&(_+=je),_>=-2&&_<rt+2){const $=Ct(_),K=Ct(_+1)-$,se=(b-nt)*Ue,de={t:M.cells.some(ge=>ge.x===G.x&&ge.y===G.y-1),r:M.cells.some(ge=>ge.x===G.x+1&&ge.y===G.y),b:M.cells.some(ge=>ge.x===G.x&&ge.y===G.y+1),l:M.cells.some(ge=>ge.x===G.x-1&&ge.y===G.y)};return{screenX:$,screenY:se,width:K,neighbors:de,color:re}}return null}).filter(Boolean);return L.length===0?null:l.jsxs("g",{children:[l.jsx("g",{opacity:.8,children:L.map((G,X)=>l.jsx("rect",{x:G.screenX,y:G.screenY,width:G.width,height:Ue,fill:D?I(G.screenX):G.color,rx:4,ry:4},X))}),L.map((G,X)=>l.jsx("path",{d:Br(G.screenX,G.screenY,G.width,Ue,G.neighbors),fill:"none",stroke:"white",strokeWidth:"2",className:D?"wild-stroke":void 0},`outline-${X}`))]})})(),ee.map(D=>{let L=D.x-E;if(L>je/2&&(L-=je),L<-je/2&&(L+=je),L>=-2&&L<rt+2){const G=Ct(L),X=Ct(L+1)-G,re=(D.y-nt)*Ue;return l.jsx("text",{x:G+X/2,y:re+Ue/2,fill:D.color,textAnchor:"middle",className:"floating-score",fontSize:"24",children:D.text},D.id)}return null}),e.phase===qe.TankScreen&&l.jsxs(l.Fragment,{children:[t>=1&&l.jsxs("g",{children:[a&&a[Oe.LASER]>Date.now()&&l.jsxs("text",{x:ve+8+6,y:A*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((a[Oe.LASER]-Date.now())/1e3),"s"]}),l.jsx(Cf,{value:r,colorMode:"drain",x:ve+8,y:A*.04,height:A*.2,width:12})]}),t>=3&&l.jsxs("g",{children:[a&&a[Oe.CONTROLS]>Date.now()&&l.jsxs("text",{x:ve+pe-20+6,y:A*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((a[Oe.CONTROLS]-Date.now())/1e3),"s"]}),l.jsx(Cf,{value:o,colorMode:"heat",x:ve+pe-20,y:A*.04,height:A*.2,width:12})]}),i.length>0&&i.map((D,L)=>{const G=Nn[D];if(!G)return null;const X=c[D]||0,re=X>=100,ke=36,b=ve+pe-26,_=A*.3+L*(ke+8);return l.jsx(sm,{upgradeId:D,name:G.name,charge:X,isReady:re,x:b,y:_,size:ke,onClick:()=>re&&(u==null?void 0:u(D))},D)})]})]}),me.position&&me.progress>0&&l.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:me.position.x,top:me.position.y,transform:"translate(-50%, -50%)"},children:l.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${me.progress/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),V>=0&&l.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:"50%",bottom:"15%",transform:"translate(-50%, 0)"},children:l.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${V/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),e.complications.length>0&&l.jsx("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none",style:{gap:"1.5rem"},children:[...e.complications].sort((D,L)=>D.startTime-L.startTime).map(D=>{const G={[Oe.LIGHTS]:"Lights",[Oe.CONTROLS]:"Controls",[Oe.LASER]:"Laser"}[D.type]||D.type;return l.jsxs("div",{className:"malfunction-pulse text-center",style:{textShadow:"0 0 20px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.5)"},children:[l.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:G}),l.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:"Malfunction"}),l.jsx("div",{className:"text-red-400 mt-2",style:{fontFamily:"'Amazon Ember', sans-serif",fontSize:"clamp(0.875rem, 3vw, 1.25rem)"},children:"Fix at Console"})]},D.id)})}),e.phase===qe.TankScreen&&(ye||ue)&&l.jsxs("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:10,display:"flex",gap:"8px"},children:[l.jsx(kf,{piece:d??null,label:"STORED",visible:ye,rank:t}),l.jsx(kf,{piece:p??null,label:"NEXT",visible:ue,rank:t})]})]})};var Rm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Pm=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jm=(e,t)=>{const n=g.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:a,children:i,...c},u)=>g.createElement("svg",{ref:u,...Rm,width:r,height:r,stroke:s,strokeWidth:a?Number(o)*24/Number(r):o,className:`lucide lucide-${Pm(e)}`,...c},[...t.map(([f,d])=>g.createElement(f,d)),...(Array.isArray(i)?i:[i])||[]]));return n.displayName=`${e}`,n};var _t=jm;const Tm=_t("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),bm=_t("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Mm=_t("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Am=_t("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ul=_t("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Em=_t("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Im=_t("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),_m=_t("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),ou=_t("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Om=_t("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Lm=_t("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Nm=_t("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),Dm=_t("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),$m=_t("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["line",{x1:"12",x2:"12.01",y1:"6",y2:"6",key:"16cbga"}]]),Fm=_t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Gm=_t("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Bm=_t("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),zm=_t("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ym=({state:e,maxTime:t})=>{const{shiftScore:n,gameOver:s,popStreak:r,shiftTime:o}=e,a=Math.max(0,Math.min(1,1-o/t)),i=a>.8,c=a>.9;return l.jsxs(l.Fragment,{children:[c&&!s&&l.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_40%,rgba(100,0,0,0.4)_100%)] animate-pulse"}),l.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 px-1 pt-4 pointer-events-none z-50 flex justify-between items-start",style:{width:"min(100%, 100dvh * 0.75)"},children:[l.jsxs("div",{className:"flex flex-col items-start drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[l.jsx("span",{className:"t-body uppercase font-bold tracking-widest mb-0.5 text-slate-400/90",children:"Pressure"}),l.jsxs("div",{className:`flex items-baseline gap-1 ${i?"text-red-500 animate-pulse":"text-slate-200"}`,children:[l.jsx(Tm,{className:"w-5 h-5 opacity-90"}),l.jsxs("span",{className:"t-display font-mono font-black leading-none tracking-tighter",children:[(a*100).toFixed(0),"%"]})]})]}),l.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-16 flex flex-col items-center",children:r>1&&l.jsxs("div",{className:"t-heading text-yellow-400 animate-bounce font-black tracking-wider whitespace-nowrap drop-shadow-[0_4px_4px_rgba(0,0,0,0.9)] stroke-black",children:["x",r," SURGE"]})}),l.jsxs("div",{className:"flex flex-col items-end drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[l.jsx("span",{className:"t-body text-green-500/90 uppercase font-bold tracking-widest mb-0.5",children:"Shift Score"}),l.jsx("span",{className:"t-display font-mono text-green-400 font-black leading-none tracking-tighter shadow-green-500/10",children:n.toLocaleString()})]})]}),l.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center text-slate-500 t-body pointer-events-none hidden md:block opacity-30 z-50 font-mono",children:"ARROWS / WASD to Rotate Cylinder  SPACE to Drop  CLICK Masses to Purge"})]})},hs=50,en=e=>e<=0?0:e*(3375+125*e),Hm=e=>{if(e<=0)return 0;if(e>=hs)return en(hs);const t=en(e),n=en(e+1);return Math.floor(t+(n-t)*.5)},Wm=()=>{const e=[];for(let t=10;t<=hs;t+=10)e.push(t);return e},Um=(e,t)=>{if(t<=e)return[];const n=[],s=Wm();for(const r of s)r>e&&r<=t&&n.push(r);return n},gt=e=>{if(e<en(1))return{rank:0,progress:Math.max(0,e),toNextRank:3500,careerScore:Math.max(0,e),isMaxRank:!1};let t=1;for(;t<hs&&e>=en(t+1);)t++;const n=en(t),s=en(t+1),r=e-n,o=s-n;return{rank:t,progress:r,toNextRank:o,careerScore:e,isMaxRank:t>=hs}},A0=(e,t,n)=>{const s=gt(e).rank,r=s+2,o=e+t,a=gt(o),i=a.rank-s;let c,u;return n?i===0?(c=s+1,u=en(c)+100):i===1?(c=s+2,u=en(c)+100):(c=r,u=en(c)+100):i<=2?(u=o,c=a.rank):(c=r,u=en(c)+100),c>hs&&(c=hs,u=en(hs)),{newCareerScore:u,ranksGained:c-s}},gs={[Oe.LASER]:{unlockRank:4,capacitorMax:100,drainPerUnit:4,drainUpgradeEffect:Nn.CAPACITOR_EFFICIENCY.effectPerLevel},[Oe.LIGHTS]:{unlockRank:2,graceBaseSec:5,gracePerLevel:.75,dimDurationSec:5,recoverRate:400,overflarePeak:110,overflareUpMs:50,overflareDownMs:100,dimThreshold:10,failedBrightness:5,snapToFailMs:100,flickerDipBrightness:70,flickerDipMs:80,flickerRecoverMs:120},[Oe.CONTROLS]:{unlockRank:6,heatMax:100,heatPerRotation:5,dissipationBase:50,dissipationUpgradeEffect:Nn.GEAR_LUBRICATION.effectPerLevel,idleThresholdMs:200}},bf={minSeconds:8,maxSeconds:20};function Xm(e,t){const n=gs[e].unlockRank;return Math.max(bf.minSeconds,bf.maxSeconds-(t-n))*1e3}function Wn(e,t){return t>=gs[e].unlockRank}class Vm{constructor(){Ye(this,"ctx",null);Ye(this,"masterGain",null);Ye(this,"musicGain",null);Ye(this,"sfxGain",null);Ye(this,"droneOsc",null);Ye(this,"droneLfo",null);Ye(this,"settings",{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1});Ye(this,"isInitialized",!1)}init(t){if(this.isInitialized){this.updateSettings(t);return}this.settings=t;try{const n=window.AudioContext||window.webkitAudioContext;this.ctx=new n,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.updateVolumes(),this.isInitialized=!0}catch(n){console.error("Audio init failed",n)}}updateSettings(t){this.settings=t,this.updateVolumes()}updateVolumes(){if(!this.masterGain||!this.musicGain||!this.sfxGain||!this.ctx)return;const t=this.ctx.currentTime,n=this.settings.masterVolume/100*.5,s=this.settings.musicVolume/100,r=this.settings.sfxVolume/100;this.masterGain.gain.setTargetAtTime(n,t,.1),this.musicGain.gain.setTargetAtTime(s,t,.1),this.sfxGain.gain.setTargetAtTime(r,t,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}startMusic(){this.stopMusic()}stopMusic(){if(this.droneOsc){try{this.droneOsc.stop()}catch{}this.droneOsc=null}if(this.droneLfo){try{this.droneLfo.stop()}catch{}this.droneLfo=null}}setPressure(t){}playPop(t){if(!this.ctx||!this.sfxGain)return;const n=this.ctx.currentTime,s=this.ctx.createOscillator(),r=this.ctx.createGain();s.connect(r),r.connect(this.sfxGain);const o=400+t*50;s.frequency.setValueAtTime(o,n),s.frequency.exponentialRampToValueAtTime(o*2,n+.1),r.gain.setValueAtTime(.5,n),r.gain.exponentialRampToValueAtTime(.01,n+.15),s.start(n),s.stop(n+.15)}playReject(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(150,t),n.frequency.linearRampToValueAtTime(100,t+.15),s.gain.setValueAtTime(.3,t),s.gain.linearRampToValueAtTime(0,t+.15),n.start(t),n.stop(t+.15)}playMove(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="triangle";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(800,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),n.start(t),n.stop(t+.05)}playRotate(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="square";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(600,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),n.start(t),n.stop(t+.08)}playDrop(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sine",n.frequency.setValueAtTime(350,t),n.frequency.exponentialRampToValueAtTime(60,t+.15);const s=this.ctx.createGain();s.gain.setValueAtTime(.4,t),s.gain.exponentialRampToValueAtTime(.01,t+.15),n.connect(s),s.connect(this.sfxGain),n.start(t),n.stop(t+.15);const r=this.ctx.sampleRate*.2,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),a=o.getChannelData(0);for(let f=0;f<r;f++)a[f]=Math.random()*2-1;const i=this.ctx.createBufferSource();i.buffer=o;const c=this.ctx.createBiquadFilter();c.type="lowpass",c.Q.value=8,c.frequency.setValueAtTime(800,t),c.frequency.exponentialRampToValueAtTime(200,t+.15);const u=this.ctx.createGain();u.gain.setValueAtTime(.3,t),u.gain.exponentialRampToValueAtTime(.01,t+.15),i.connect(c),c.connect(u),u.connect(this.sfxGain),i.start(t)}playGameOver(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(400,t),n.frequency.linearRampToValueAtTime(50,t+1.5),s.gain.setValueAtTime(.5,t),s.gain.linearRampToValueAtTime(0,t+1.5),n.start(t),n.stop(t+1.5)}}const Tt=new Vm,qm=1e3;class Km{checkComplications(t,n,s){const r=Date.now();if(r-s<qm)return{spawned:null,newLastCheckTime:s};const o=f=>t.complications.some(d=>d.type===f),a=f=>r<t.complicationCooldowns[f],i=gt(n).rank,c=gs[Oe.CONTROLS];let u=null;return!o(Oe.LASER)&&!a(Oe.LASER)&&Wn(Oe.LASER,i)&&t.laserCharge<=0?u=Oe.LASER:!o(Oe.CONTROLS)&&!a(Oe.CONTROLS)&&Wn(Oe.CONTROLS,i)&&t.controlsHeat>=c.heatMax&&(u=Oe.CONTROLS),{spawned:u,newLastCheckTime:r}}spawnComplication(t,n){const r={id:Math.random().toString(36).substr(2,9),type:n,startTime:Date.now(),severity:1};return t.complications=[...t.complications,r],xe.emit(ae.COMPLICATION_SPAWNED,{type:n}),r}resolveComplication(t,n,s,r){const o=t.complications.find(a=>a.id===n);if(o){switch(o.type){case Oe.LASER:t.laserCharge=gs[Oe.LASER].capacitorMax,t.prePoppedGoopGroups.clear();break;case Oe.CONTROLS:t.controlsHeat=0,t.rotationTimestamps=[];break;case Oe.LIGHTS:t.lightsBrightness=100,t.lightsGraceStart=Date.now(),t.lightsFlickered=!1;break}const a=gt(s+t.shiftScore).rank,i=Xm(o.type,a);t.complicationCooldowns[o.type]=Date.now()+i}t.complications=t.complications.filter(a=>a.id!==n),t.activeComplicationId=null,xe.emit(ae.COMPLICATION_RESOLVED),Tt.playPop(5)}extendAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Oe)){const o=t.complicationCooldowns[r];if(o>s){const i=(o-s)*n;t.complicationCooldowns[r]=o+i}}}reduceAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Oe)){const o=t.complicationCooldowns[r];if(o>s){const i=(o-s)*n;t.complicationCooldowns[r]=Math.max(s,o-i)}}}}const Ys=new Km;class zr{constructor(t){Ye(this,"type","SPIN_TANK");this.dir=t}execute(t){if(t.state.gameOver||t.state.isPaused||t.trainingAllowedControls&&t.trainingAllowedControls.tankRotate===!1)return;const n=Ve(t.state.tankRotation+this.dir);let s=t.state.activeGoop;if(t.state.activeGoop){const c=ec(t.state.activeGoop.screenX,n);s={...t.state.activeGoop,x:c};const u=Math.round(s.y),f={...s,y:u};if(ms(t.state.grid,f)){xe.emit(ae.ACTION_REJECTED);return}ms(t.state.grid,s)&&(s=f)}t.state.tankRotation=n,s&&(t.state.activeGoop=s),t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++);const r=Date.now();t.state.rotationTimestamps.push(r),t.state.rotationTimestamps.length>Ix&&t.state.rotationTimestamps.shift();const o=gt(t.initialTotalScore).rank,a=gs[Oe.CONTROLS],i=Date.now()<t.state.complicationCooldowns[Oe.CONTROLS];Wn(Oe.CONTROLS,o)&&!i&&(t.state.controlsHeat=Math.min(a.heatMax,t.state.controlsHeat+a.heatPerRotation)),xe.emit(ae.PIECE_MOVED),t.emitChange()}}class Oo{constructor(t){Ye(this,"type","ROTATE_GOOP");this.clockwise=t}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop||t.trainingAllowedControls&&t.trainingAllowedControls.rotate===!1)return;const n=t.state.activeGoop,s=(n.rotation+(this.clockwise?1:-1)+4)%4;if(n.definition.type===Ae.O||n.definition.type===Ae.T_O){const i=n.definition.cellColors,c=i&&i.length===4?this.clockwise?[i[2],i[0],i[3],i[1]]:[i[1],i[3],i[0],i[2]]:i;xe.emit(ae.PIECE_ROTATED),t.state.activeGoop={...n,rotation:s,definition:{...n.definition,cellColors:c}},t.emitChange();return}const r=j0(n.cells,this.clockwise,n.rotationCenter),o={...n,cells:r,rotation:s},a=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:0,y:-2},{x:1,y:-2},{x:-1,y:-2},{x:2,y:0},{x:-2,y:0}];for(const i of a){const c=Ve(o.x+i.x),u=Dy(c,t.state.tankRotation),f={...o,x:c,y:o.y+i.y,screenX:u};if(!ms(t.state.grid,f,t.state.tankRotation)){xe.emit(ae.PIECE_ROTATED),t.state.activeGoop=f,t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++),t.emitChange();return}}}}class Fl{constructor(t){Ye(this,"type","SET_FAST_DROP");this.active=t}execute(t){t.trainingAllowedControls&&t.trainingAllowedControls.fastDrop===!1||(t.isFastDropping=this.active)}}class Zm{constructor(){Ye(this,"type","SWAP_PIECE")}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=n.definition,r=t.state.storedGoop;if(r){const o=Math.round(r.cells.reduce((c,u)=>c+u.x,0)/r.cells.length),a=Math.round(r.cells.reduce((c,u)=>c+u.y,0)/r.cells.length),i={definition:r,cells:[...r.cells],rotation:0,rotationCenter:{x:o,y:a},spawnTimestamp:Date.now(),startSpawnY:n.y,screenX:n.screenX,x:n.x,y:n.y,state:Fn.FALLING};if(ms(t.state.grid,i,t.state.tankRotation)){xe.emit(ae.ACTION_REJECTED);return}xe.emit(ae.PIECE_ROTATED),t.state.storedGoop=s,t.state.activeGoop=i,t.lockStartTime=null,t.lockResetCount=0,t.state.canSwap=!0}else xe.emit(ae.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.spawnNewPiece();t.emitChange()}}class Qm{constructor(t,n){Ye(this,"type","POP_GOOP");this.x=t,this.y=n}execute(t){var u;if(t.state.gameOver||t.state.isPaused||((u=t.trainingAllowedControls)==null?void 0:u.pop)===!1)return;const n=t.state.grid[this.y][this.x];if(!n)return;if(t.trainingHighlightColor&&n.color!==t.trainingHighlightColor){xe.emit(ae.ACTION_REJECTED);return}const s=Math.max(0,1-t.state.shiftTime/t.maxTime),r=De-1-s*(Bt-1);if(n.groupMinY<r){xe.emit(ae.ACTION_REJECTED);return}const o=Date.now(),a=n.groupSize*go;if(o-(n.timestamp||0)<a){xe.emit(ae.ACTION_REJECTED);return}const c=Fy(t.state.grid,this.x,this.y);if(c.length>0){if(t.state.complications.find(z=>z.type===Oe.LASER)){const z=n.goopGroupId;if(!t.state.prePoppedGoopGroups.has(z)){t.state.prePoppedGoopGroups.add(z);const Q=Date.now();c.forEach(B=>{const Z=t.state.grid[B.y][B.x];Z&&(Z.timestamp=Q)}),xe.emit(ae.ACTION_REJECTED),t.emitChange();return}t.state.prePoppedGoopGroups.delete(z)}xe.emit(ae.GOOP_POPPED,{popStreak:t.state.popStreak,count:c.length}),t.state.cellsCleared++,t.state.totalUnitsPopped+=c.length;const d=gt(t.initialTotalScore).rank,p=gs[Oe.LASER];if(Wn(Oe.LASER,d)){const z=t.powerUps.CAPACITOR_EFFICIENCY||0,Q=1-p.drainUpgradeEffect*z,B=c.length*p.drainPerUnit*Q;t.state.laserCharge=Math.max(0,t.state.laserCharge-B)}const y=c.length;t.state.gameStats.maxGroupSize=Math.max(t.state.gameStats.maxGroupSize,y);const v=_x,k=y*Ox;let w=0;y>=mf&&(w=(Math.floor((y-mf)/Lx)+1)*Nx);let m=0;c.forEach(z=>{var Q;(Q=t.state.grid[z.y][z.x])!=null&&Q.isSealingGoop&&m++});const h=m*3e3;if(m>0){t.state.goalsCleared+=m,xe.emit(ae.GOAL_CAPTURED,{count:m}),t.chargeActiveAbilities(m*25);const z=t.powerUps.SEALING_BONUS||0;if(z>0){const Z=.1+z*.05;for(let q=0;q<m;q++)Ys.reduceAllCooldowns(t.state,Z)}}const x=v+k+w+h;t.state.shiftTime=Math.min(t.maxTime,t.state.shiftTime+x),t.state.gameStats.totalBonusTime+=x;let C=0,j=t.state.popStreak+1,P={base:0,height:0,offscreen:0,adjacency:0,speed:0};const R=Uy(t.state.grid,c);C+=R,P.adjacency+=R,c.forEach(z=>{let Q=10,B=Yy(z.y),Z=Hy(z.x,t.state.tankRotation);const q=Wy(j),oe=(Q+B+Z)*q;C+=oe,P.base+=Q*q,P.height+=B*q,P.offscreen+=Z*q});const S=Math.floor(C);t.updateScoreAndStats(S,P),t.state.popStreak=j;const T=Math.random().toString(36).substr(2,9),E=[{id:T,text:`+${S}`,x:this.x,y:this.y,life:1,color:"#fbbf24"},{id:T+"_time",text:"Vented",x:this.x,y:this.y-1,life:1,color:"#4ade80"}];m>0&&E.push({id:T+"_bonus",text:"SEALED!",x:this.x,y:this.y-2,life:1.5,color:"#fff"}),t.state.floatingTexts.push(...E),setTimeout(()=>{t.state.floatingTexts=t.state.floatingTexts.filter(z=>!z.id.startsWith(T)),t.emitChange()},1e3);const M=n.goopGroupId;M&&t.state.poppedGoopGroupIds.add(M);let U=t.state.grid.map(z=>[...z]);const ee=[];c.forEach(z=>{U[z.y][z.x]=null,ee.push({x:z.x,y:z.y})});const{grid:te,looseGoop:N}=b0(U,ee);if(m>0&&!t.isTrainingMode&&t.state.goalsCleared>=t.state.goalsTarget){const z=Math.max(0,1-t.state.shiftTime/t.maxTime),Q=gt(t.initialTotalScore+t.state.shiftScore).rank;if(z<.9){const B=Xy(te,t.state.goalMarks,Q,t.state.shiftTime,t.maxTime);t.state.goalMarks.push(...B),xe.emit(ae.GOAL_CAPTURED,{count:1})}else t.state.goalMarks=[]}t.state.grid=te,t.state.looseGoop.push(...N),t.emitChange()}}}class Jm{constructor(){Ye(this,"type","START_RUN")}execute(t){t.startRun()}}class Hs{constructor(t){Ye(this,"type","SET_PHASE");this.phase=t}execute(t){this.phase===qe.ConsoleScreen&&t.isTrainingMode&&t.trainingAllowedControls||(this.phase===qe.TankScreen?t.enterPeriscope():this.phase===qe.ConsoleScreen?t.enterConsole():(t.state.phase=this.phase,t.emitChange()))}}class eg{constructor(t){Ye(this,"type","RESOLVE_COMPLICATION");this.id=t}execute(t){t.resolveComplication(this.id)}}class tg{constructor(t){Ye(this,"type","ACTIVATE_ABILITY");this.upgradeId=t}execute(t){t.state.gameOver||t.state.isPaused||(t.state.activeCharges[this.upgradeId]||0)<100||(t.state.activeCharges[this.upgradeId]=0,t.activateAbility(this.upgradeId),xe.emit(ae.ABILITY_ACTIVATED,{upgradeId:this.upgradeId}),t.emitChange())}}const ng=(e,t,n,s,r,o,a)=>{if(!e)return"FAILURE";const i=n>0?Math.min(100,t/n*100):100,c=Math.max(0,100-s*2),u=Math.max(0,100-s*3),f=o>0?Math.min(100,r/o*100):50,d=Math.min(100,a/100),p=(i+c+u+f+d)/5;return p>=80?"A":p>=60?"B":p>=40?"C":"FAILURE"},sg=({shiftScore:e,rank:t,xpCurrent:n,xpNext:s,cracksFilled:r,cracksTarget:o,pressureVented:a,maxTime:i,massPurged:c,leftoverPenalty:u,unspentPower:f,isWin:d})=>{const y=Math.min(1,Math.max(0,n/s))*366.31,v=ng(d,r,o,u,a,i,e),k=v==="A"?"#5bbc70":v==="B"?"#6acbda":v==="C"?"#ffd92b":"#d82727",w=i>0?Math.round(a/i*100):0;return l.jsxs("g",{id:"End_Game_Monitor_Group",children:[l.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),l.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),l.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),l.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'From Where You Are'",fontSize:"42",transform:"translate(291.5 122.96)",textAnchor:"middle",children:"SHIFT OVER"}),l.jsxs("text",{fill:k,fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"24",letterSpacing:"0.1em",transform:"translate(291.5 155)",textAnchor:"middle",children:["GRADE: ",v]}),l.jsx("path",{fill:"#5bbc70",d:"M525.21,243.36H58.95c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM58.95,223.59c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H58.95Z"}),l.jsx("path",{fill:"#5bbc70",d:`M57.75,223.09h${y}v19.77H57.75c-4.79,0-8.68-3.89-8.68-8.68v-2.4c0-4.79,3.89-8.68,8.68-8.68Z`}),l.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(530 237)",children:[Math.floor(n).toLocaleString()," / ",Math.floor(s).toLocaleString()]}),l.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(530 213)",children:"PROMOTION THRESHOLD"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(49.87 209.32)",children:l.jsx("tspan",{x:"0",y:"0",children:"OPERATOR RANK"})}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(230 210.8)",textAnchor:"start",children:t}),l.jsx("path",{fill:"#fff",d:"M268.4,808.13v-1.02l.33-1.02c6.23-8.15,13.08-15.87,19.51-23.87,1.65-2.11,4.36-2.41,6.29-.46l20.02,23c.62.7,1,1.44,1.2,2.36-.03.33.04.7,0,1.02-.21,1.7-1.77,3.25-3.47,3.42h-40.15c-1.85-.05-3.51-1.61-3.74-3.42ZM271.73,793.93c1.56-1.89,3.12-3.76,4.65-5.6,2.57-3.07,5.23-6.25,7.76-9.4,1.83-2.35,4.56-3.73,7.45-3.73,2.47,0,4.83,1.01,6.66,2.85l.12.12,13.75,15.8h.16c1.7-.17,3.26-1.72,3.47-3.42.04-.32-.03-.69,0-1.02-.2-.92-.58-1.66-1.21-2.36l-20.02-23c-1.94-1.95-4.65-1.65-6.29.46-6.44,8.01-13.29,15.72-19.51,23.87l-.33,1.02v1.02c.21,1.67,1.66,3.12,3.33,3.37Z"}),l.jsx("text",{fill:"#d82727",fontFamily:"'From Where You Are'",fontSize:"24",transform:"translate(291.5 860.65)",textAnchor:"middle",children:"DRAG UP TO END SHIFT"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(165.69 321.1)",textAnchor:"middle",children:"SHIFT SCORE"}),l.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(165.69 390.05)",textAnchor:"middle",children:e.toLocaleString()}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M261.87,585.41H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 503.38)",textAnchor:"middle",children:"CRACKS FILLED"}),l.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 557.36)",textAnchor:"middle",children:[r," / ",o]})]}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M514.25,585.41h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 503.38)",textAnchor:"middle",children:"PRESSURE VENTED"}),l.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 557.36)",textAnchor:"middle",children:[w,"%"]})]}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M261.87,731.68H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 649.64)",textAnchor:"middle",children:"MAX POP"}),l.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 703.63)",textAnchor:"middle",children:c})]}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M514.25,731.68h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 649.64)",textAnchor:"middle",children:"RESIDUAL GOOP"}),l.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 703.63)",textAnchor:"middle",children:["-",u]})]}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(418.08 321.1)",textAnchor:"middle",children:"SCRAPS"}),l.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(418.08 390.05)",textAnchor:"middle",children:f})]})},og="#14b8a6",rg="#ffffff",ig="#22c55e",Yr="#231f20",Hr="#d8672b";function lg({complications:e,isLaserMaxed:t,onResolveComplication:n}){const[s,r]=g.useState({active:!1,solved:!1,targets:[0,0,0,0]}),[o,a]=g.useState([0,0,0,0]),[i,c]=g.useState(null),[u,f]=g.useState(!1),d=g.useRef([]),p=g.useRef(null),y=g.useRef(null),v=g.useCallback(()=>e.some(h=>h.type===Oe.LASER),[e]);g.useEffect(()=>{const h=d.current.some(C=>C.type===Oe.LASER),x=v();h&&!x&&(f(!0),y.current=setTimeout(()=>{f(!1)},2500)),d.current=e},[e,v]),g.useEffect(()=>{if(!v()&&(s.active||s.solved)&&(r({active:!1,solved:!1,targets:[0,0,0,0]}),a([0,0,0,0])),v()&&!s.active&&!s.solved){const h=t?[-1,1]:[-1,0,1],x=[0,1,2,3].map(()=>h[Math.floor(Math.random()*h.length)]),C=x.map(j=>{const P=h.filter(R=>R!==j);return P[Math.floor(Math.random()*P.length)]});a(C),r({active:!0,solved:!1,targets:x})}},[e,s.active,s.solved,t,v]),g.useEffect(()=>()=>{p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]);const k=g.useCallback((h,x)=>{a(j=>{const P=[...j];return P[h]=x,e.find(S=>S.type===Oe.LASER),P});const C=e.find(j=>j.type===Oe.LASER);if(C&&!s.solved){const j=s.targets[h];if(x!==j)c(h),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>c(null),300);else{const P=[...o];P[h]=x,P.every((S,T)=>S===s.targets[T])&&(r(S=>({...S,solved:!0})),a([0,0,0,0]),n&&n(C.id))}}},[e,s.solved,s.targets,o,n]),w=g.useCallback(h=>{if(!v())return{left:Yr,right:Yr};const x=s.targets[h];return x===-1?{left:Hr,right:Yr}:x===1?{left:Yr,right:Hr}:{left:Hr,right:Hr}},[v,s.targets]),m=g.useCallback(()=>v()?{text:"REPAIR LASER",color:rg}:u?{text:"LASER FIXED",color:ig}:{text:"REPAIR LASER",color:og},[v,u]);return{laserSliders:o,updateLaserSlider:k,shakingSlider:i,getLaserLightColors:w,getLaserTextState:m,recentlyFixed:u,isComplicationActive:v()}}const Mf={0:"#96d7dd",1:"#f6f081",2:"#cb8abc"},ag=[45,315,225,135],Af=[45,135,225,315],cg="#14b8a6",ug="#ffffff",fg="#22c55e",Qt="#231f20",Wr="#d8672b";function dg({complications:e,isLightsMaxed:t,pressedBtn:n,onResolveComplication:s}){const[r,o]=g.useState({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),[a,i]=g.useState(0),[c,u]=g.useState(!1),[f,d]=g.useState(!1),p=g.useRef([]),y=g.useRef(null),v=g.useRef(null),k=g.useRef([]),w=g.useCallback(()=>e.some(S=>S.type===Oe.LIGHTS),[e]),m=g.useCallback(()=>{const S=[],T=[0,0,0],E=t?3:4;for(let M=0;M<E;M++){const U=[];T[0]<2&&U.push(0),T[1]<2&&U.push(1),T[2]<2&&U.push(2);const ee=U[Math.floor(Math.random()*U.length)];S.push(ee),T[ee]++}return S},[t]),h=g.useCallback(S=>{k.current.forEach(te=>clearTimeout(te)),k.current=[];let U=300;S.forEach(te=>{const N=setTimeout(()=>{o(Q=>({...Q,showingIndex:te}))},U);k.current.push(N);const z=setTimeout(()=>{o(Q=>({...Q,showingIndex:-1}))},U+200);k.current.push(z),U+=200+100});const ee=setTimeout(()=>{o(te=>({...te,phase:"input",showingIndex:-1,inputIndex:0}))},U+100);k.current.push(ee)},[]);g.useEffect(()=>{const S=p.current.some(E=>E.type===Oe.LIGHTS),T=w();S&&!T&&(d(!0),v.current=setTimeout(()=>{d(!1)},2500)),p.current=e},[e,w]),g.useEffect(()=>{if(!w()&&r.phase!=="inactive"&&(o({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),i(0)),w()&&r.phase==="inactive"){const S=m();o({phase:"slider1",slider1Target:Math.random()>.5?1:-1,sequence:S,inputIndex:0,showingIndex:-1}),i(0)}},[e,r.phase,w,m]),g.useEffect(()=>()=>{y.current&&clearTimeout(y.current),v.current&&clearTimeout(v.current),k.current.forEach(S=>clearTimeout(S))},[]);const x=g.useCallback(S=>{if(r.phase!=="input")return;const T=r.sequence[r.inputIndex];if(S===T){const E=r.inputIndex+1;E>=r.sequence.length?o(M=>({...M,phase:"slider2",inputIndex:0})):o(M=>({...M,inputIndex:E}))}else{o(M=>({...M,phase:"showing",inputIndex:0,showingIndex:-1}));const E=setTimeout(()=>{h(r.sequence)},300);k.current.push(E)}},[r.phase,r.sequence,r.inputIndex,h]),C=g.useCallback(S=>{const{phase:T,slider1Target:E,sequence:M}=r;if(T==="slider1")S===E?(i(S),o(U=>({...U,phase:"showing"})),h(M)):S!==0?(u(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),i(0)},400)):i(S);else if(T==="slider2"){const U=E===1?-1:1;if(i(S),S===U){o(te=>({...te,phase:"solved"})),i(0);const ee=e.find(te=>te.type===Oe.LIGHTS);ee&&s&&s(ee.id)}}else i(S)},[e,r,s,h]),j=g.useCallback(S=>!w()||r.phase==="inactive"?Qt:r.phase==="showing"&&r.showingIndex===S||r.phase==="input"&&n===["blue","green","purple"][S]?Mf[S]:Qt,[w,r.phase,r.showingIndex,n]),P=g.useCallback(()=>{const{phase:S,slider1Target:T}=r;return w()?S==="inactive"?{top:Qt,bottom:Qt}:S==="slider1"?T===1?{top:Qt,bottom:Wr}:{top:Wr,bottom:Qt}:S==="slider2"?T===1?{top:Wr,bottom:Qt}:{top:Qt,bottom:Wr}:{top:Qt,bottom:Qt}:{top:Qt,bottom:Qt}},[w,r]),R=g.useCallback(()=>w()?{text:"REPAIR LIGHTS",color:ug}:f?{text:"LIGHTS FIXED",color:fg}:{text:"REPAIR LIGHTS",color:cg},[w,f]);return{lightsComplication:r,lightSlider:a,handleLightsButton:x,handleLightsSliderChange:C,lightsSliderShaking:c,getLightsButtonLightColor:j,getLightsSliderLightColors:P,getLightsTextState:R,recentlyFixed:f,isComplicationActive:w()}}const pg="#14b8a6",hg="#ffffff",xg="#22c55e",Gl="#231f20",yg="#d8672b",Ef=194.32,If=1586.66,mg=86.84,gg=mg*1.3;function vg({complications:e,isControlsMaxed:t,onResolveComplication:n}){const[s,r]=g.useState({active:!1,solved:!1,targetCorner:null,completedCorners:0}),[o,a]=g.useState(0),[i,c]=g.useState(!1),[u,f]=g.useState(!1),[d,p]=g.useState(!1),[y,v]=g.useState(!1),k=g.useRef([]),w=g.useRef(null),m=g.useRef(null),h=g.useRef(null),x=g.useRef(null),C=g.useRef(!1),j=g.useRef(0),P=g.useRef(0),R=g.useRef(0),S=g.useRef(!1),T=g.useRef(!1),E=g.useCallback(()=>e.some(q=>q.type===Oe.CONTROLS),[e]),M=g.useCallback((q,oe)=>{try{const ne=document.getElementById("coord-reference");if(!ne)return null;const ve=ne.ownerSVGElement;if(!ve)return null;const Te=ve.createSVGPoint();Te.x=q,Te.y=oe;const pe=ne.getScreenCTM();if(!pe)return null;const A=Te.matrixTransform(pe.inverse());return{x:A.x,y:A.y}}catch{return null}},[]);g.useEffect(()=>{const q=k.current.some(ne=>ne.type===Oe.CONTROLS),oe=E();q&&!oe&&(v(!0),m.current=setTimeout(()=>{v(!1)},2500)),k.current=e},[e,E]),g.useEffect(()=>{if(!E()&&(s.active||s.solved)&&r({active:!1,solved:!1,targetCorner:null,completedCorners:0}),E()&&!s.active&&!s.solved){const q=Math.floor(Math.random()*4);r({active:!0,solved:!1,targetCorner:q,completedCorners:0})}},[e,s.active,s.solved,E]),g.useEffect(()=>()=>{w.current&&clearTimeout(w.current),m.current&&clearTimeout(m.current),h.current&&clearTimeout(h.current),x.current&&clearTimeout(x.current)},[]);const U=g.useCallback((q,oe)=>{const ne=M(q,oe);if(!ne)return;const ve=ne.x-Ef,Te=ne.y-If;Math.sqrt(ve*ve+Te*Te)>gg||(j.current=Math.atan2(Te,ve)*(180/Math.PI),P.current=o,C.current=!0,S.current=!1,c(!0))},[o,M]),ee=g.useCallback((q,oe)=>{if(!C.current)return;const ne=M(q,oe);if(!ne)return;const ve=ne.x-Ef,Te=ne.y-If,A=Math.atan2(Te,ve)*(180/Math.PI)-j.current+P.current;R.current=A,S.current=!0,a(A)},[M]),te=g.useCallback(()=>{if(!C.current||(C.current=!1,c(!1),S.current&&(T.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{T.current=!1},100)),!S.current))return;const q=R.current;let oe=q%360;oe<0&&(oe+=360);let ne=Af[0],ve=1/0;for(const H of Af){const W=Math.min(Math.abs(oe-H),Math.abs(oe-H+360),Math.abs(oe-H-360));W<ve&&(ve=W,ne=H)}const Te=Math.floor(q/360)*360,pe=[Te+ne-360,Te+ne,Te+ne+360];let A=pe[0],Y=Math.abs(q-pe[0]);for(const H of pe){const W=Math.abs(q-H);W<Y&&(Y=W,A=H)}R.current=A,a(A)},[]);g.useEffect(()=>{if(!i)return;const q=Te=>{ee(Te.clientX,Te.clientY)},oe=()=>{te()},ne=Te=>{Te.touches.length>0&&ee(Te.touches[0].clientX,Te.touches[0].clientY)},ve=()=>{te()};return window.addEventListener("mousemove",q),window.addEventListener("mouseup",oe),window.addEventListener("touchmove",ne),window.addEventListener("touchend",ve),()=>{window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",oe),window.removeEventListener("touchmove",ne),window.removeEventListener("touchend",ve)}},[i,ee,te]);const N=g.useCallback(()=>{if(s.targetCorner===null)return!1;const q=ag[s.targetCorner],oe=(o%360+360)%360,ne=Math.abs(oe-q);return Math.min(ne,360-ne)<15},[s.targetCorner,o]),z=g.useCallback(()=>{f(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>f(!1),300)},[]),Q=g.useCallback(()=>{if(!(!E()||s.solved)&&!i&&!T.current)if(p(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>p(!1),150),N()){const q=s.completedCorners+1;if(q>=(t?3:4)){r(ve=>({...ve,solved:!0,targetCorner:null,completedCorners:4}));const ne=e.find(ve=>ve.type===Oe.CONTROLS);ne&&n&&n(ne.id)}else{const ne=[0,1,2,3].filter(Te=>Te!==s.targetCorner),ve=ne[Math.floor(Math.random()*ne.length)];r(Te=>({...Te,targetCorner:ve,completedCorners:q}))}}else z()},[E,s.solved,s.completedCorners,s.targetCorner,i,N,t,e,n,z]),B=g.useCallback(q=>!E()||s.solved?Gl:s.targetCorner===q?yg:Gl,[E,s.solved,s.targetCorner]),Z=g.useCallback(()=>E()?{text:"REPAIR CONTROLS",color:hg}:y?{text:"CONTROLS FIXED",color:xg}:{text:"REPAIR CONTROLS",color:pg},[E,y]);return{localDialRotation:o,isDialDragging:i,dialShaking:u,dialPressed:d,handleDialStart:U,handleDialMove:ee,handleDialEnd:te,handleDialPress:Q,getControlsCornerLightColor:B,getControlsTextState:Z,recentlyFixed:y,isDialAligned:N,isComplicationActive:E()&&!s.solved}}const Yo=({x:e,y:t,rotation:n=0,length:s=176,width:r=50,handleSize:o=50,value:a=0,onChange:i,trackColor:c="#eebfc5",handleColor:u="#d36b28",arrowColor:f="#ffffff",className:d=""})=>{const[p,y]=g.useState(!1),[v,k]=g.useState(0),w=g.useRef(null),m=g.useRef(0),h=(s-o)/2,x={"-1":-h,0:0,1:h},C=p?v:x[`${a}`]||0,j=S=>{S.stopPropagation(),S.currentTarget.setPointerCapture(S.pointerId),w.current={x:S.clientX,y:S.clientY},m.current=C,k(C),y(!0)},P=S=>{if(!p||!w.current)return;S.stopPropagation();const T=S.clientX-w.current.x,E=S.clientY-w.current.y,M=n*Math.PI/180,U=T*Math.cos(M)+E*Math.sin(M),ee=m.current+U,te=Math.max(-h,Math.min(h,ee));k(te)},R=S=>{if(!p)return;S.stopPropagation(),S.currentTarget.releasePointerCapture(S.pointerId),y(!1);const T=Math.abs(v-x[-1]),E=Math.abs(v-x[0]),M=Math.abs(v-x[1]);let U=0;T<E&&T<M?U=-1:M<E&&M<T?U=1:U=0,i&&U!==a&&i(U)};return l.jsx("g",{transform:`translate(${e}, ${t}) rotate(${n})`,children:l.jsxs("g",{className:d,children:[l.jsx("rect",{x:-s/2,y:-r/2,width:s,height:r,rx:6.92,ry:6.92,fill:c}),l.jsx("g",{transform:`translate(${C}, 0)`,style:{transition:p?"none":"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:l.jsx("rect",{x:-o/2,y:-o/2,width:o,height:o,rx:3.69,ry:3.69,fill:u})}),l.jsx("rect",{x:-s/2-20,y:-r/2-20,width:s+40,height:r+40,fill:"transparent",style:{cursor:"grab",touchAction:"none"},onPointerDown:j,onPointerMove:P,onPointerUp:R,onPointerLeave:R})]})})},Sg=({laserSliders:e,shakingSlider:t,onSliderChange:n,getLaserLightColors:s,textState:r,isComplicationActive:o=!1,isUnlocked:a=!0})=>l.jsxs("g",{id:"Reset_Laser_Top",className:a?"minigame-active":"minigame-inactive",children:[l.jsxs("g",{pointerEvents:"none",children:[l.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M157.91,233.16h-4.24l-18.69-18.69c-3.62-3.62-3.62-9.52,0-13.14l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0-8.89l20.81,20.81ZM111.51,212.35c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-1.75,1.75-2.72,4.09-2.72,6.57s.97,4.81,2.72,6.57l18.69,18.69h4.24l-20.81-20.81ZM107.64,182.65h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM235.4,214.47c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,233.16h4.24l18.69-18.69c1.75-1.75,2.72-4.09,2.72-6.57s-.97-4.81-2.72-6.57l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM260.08,214.47c.17-.17.33-.36.49-.54v-12.05c-.16-.19-.32-.37-.49-.54l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"}),l.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M132.32,324.04h-4.24l-18.69-18.69c-1.75-1.75-2.72-4.09-2.72-6.57s.97-4.81,2.72-6.57l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0,8.89l20.81,20.81ZM137.1,303.23c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-3.62,3.62-3.62-9.52,0,13.14l18.69,18.69h4.24l-20.81-20.81ZM107.64,273.53h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM260.08,305.35c.18-.18.34-.36.49-.55v-12.04c-.16-.19-.32-.37-.49-.55l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,324.04h4.24l18.69-18.69c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c1.19,1.19,1.84,2.77,1.84,4.45s-.65,3.26-1.84,4.45l-20.81,20.81ZM235.4,305.35c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"})]}),l.jsx(Yo,{x:172.65,y:207.9,value:e[0],onChange:i=>n(0,i),className:t===0?"shake-anim":""}),l.jsx(Yo,{x:172.65,y:298.78,value:e[1],onChange:i=>n(1,i),className:t===1?"shake-anim":""}),l.jsx(Yo,{x:445.24,y:207.9,value:e[2],onChange:i=>n(2,i),className:t===2?"shake-anim":""}),l.jsx(Yo,{x:445.24,y:298.78,value:e[3],onChange:i=>n(3,i),className:t===3?"shake-anim":""}),l.jsxs("g",{children:[l.jsx("path",{fill:s(0).right,fillRule:"evenodd",d:"M280.92,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(0).left,fillRule:"evenodd",d:"M63.6,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:s(1).right,fillRule:"evenodd",d:"M280.92,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(1).left,fillRule:"evenodd",d:"M63.6,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:s(2).left,fillRule:"evenodd",d:"M336.96,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(2).right,fillRule:"evenodd",d:"M554.28,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:s(3).left,fillRule:"evenodd",d:"M336.96,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(3).right,fillRule:"evenodd",d:"M554.28,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsx("text",{fill:r.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(245.29 261.57)",children:r.text})]}),Bl=({x:e,y:t,colorBody:n,colorTop:s,isPressed:r,onPress:o,onRelease:a})=>{const i="M42.31,73.62C18.58,73.62,0,59.79,0,42.13S18.58,10.65,42.31,10.65s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",c="M74.5,41.03c0,11.84-14.45,21.44-32.27,21.44S9.97,52.87,9.97,41.03c0-8.74.25-20.68.25-20.68h64.43s-.15,13.21-.15,20.68Z",f="M42.31,62.97C18.58,62.97,0,49.14,0,31.48S18.58,0,42.31,0s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",d="M74.5,30.38c0,11.84-14.45,21.44-32.27,21.44S9.97,42.22,9.97,30.38c0-8.74.25-8.47.25-8.47h64.43s-.15.99-.15,8.47Z";return l.jsx("g",{transform:`translate(${e}, ${t})`,style:{cursor:"pointer"},onMouseDown:v=>{v.stopPropagation(),o()},onMouseUp:v=>{v.stopPropagation(),a()},onMouseLeave:()=>{r&&a()},onTouchStart:v=>{v.stopPropagation(),o()},onTouchEnd:v=>{v.stopPropagation(),a()},children:r?l.jsxs("g",{transform:`translate(0, ${10.65})`,children:[l.jsx("path",{fill:"#0d1a19",d:f}),l.jsx("path",{fill:n,fillRule:"evenodd",d}),l.jsx("ellipse",{fill:s,cx:"42.31",cy:23.01,rx:"32.27",ry:"21.44"})]}):l.jsxs("g",{children:[l.jsx("path",{fill:"#0d1a19",d:i}),l.jsx("path",{fill:n,fillRule:"evenodd",d:c}),l.jsx("ellipse",{fill:s,cx:"42.31",cy:21.44,rx:"32.27",ry:"21.44"})]})})},Cg=({lightsComplication:e,lightSlider:t,onSliderChange:n,onButtonPress:s,onButtonRelease:r,getLightsButtonLightColor:o,getLightsSliderLightColors:a,textState:i,pressedBtn:c,sliderShaking:u,onBlueClick:f,onGreenClick:d,onPurpleClick:p,isComplicationActive:y=!1,recentlyFixed:v=!1,isUnlocked:k=!0})=>{const w=a(),m=e.phase==="slider1"||e.phase==="showing";return l.jsxs("g",{id:"Reset_Lights",className:k?"minigame-active":"minigame-inactive",children:[l.jsx("polygon",{fill:"#45486c",points:"608.7 1720.12 341.17 1720.12 341.17 1452.22 564.14 1452.22 608.7 1720.12",className:y?"minigame-active-pulse":v?"minigame-solved-fade":""}),l.jsx("text",{fill:i.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(414.68 1480.38)",children:i.text}),l.jsx("g",{clipPath:"url(#reset-lights-slider-clip)",children:l.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M417.83,1530.35l-30.21-30.21c-3.04-3.04-7.97-3.04-11.02,0l-30.21,30.21M346.4,1555.03l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M346.4,1580.62l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M417.83,1643.18l-30.21,30.21c-3.04,3.04-7.97,3.04-11.02,0l-30.21-30.21M346.4,1618.5l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21M346.4,1592.91l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21"})}),l.jsx(Yo,{x:382.11,y:1587.01,rotation:90,value:t,onChange:n,className:u?"shake":""}),l.jsxs("g",{children:[l.jsx("path",{fill:w.bottom,d:"M382.12,1706.83c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M382.12,1685.25c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1682.25c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.04-13.03-13.04h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:w.top,d:"M382.12,1489.51c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M382.12,1467.94c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1464.94c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsx(Bl,{x:431.19,y:1495,colorBody:"#3d8380",colorTop:"#96d7dd",isPressed:c==="blue"||m,onPress:()=>s("blue"),onRelease:()=>r("blue",f)}),l.jsxs("g",{children:[l.jsx("path",{fill:o(0),d:"M546.19,1547c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M546.19,1525.42c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M546.19,1522.42c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),l.jsx(Bl,{x:437.5,y:1565,colorBody:"#4c833c",colorTop:"#f6f081",isPressed:c==="green"||m,onPress:()=>s("green"),onRelease:()=>r("green",d)}),l.jsxs("g",{children:[l.jsx("path",{fill:o(1),d:"M554.61,1616.4c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M554.61,1594.82c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M554.61,1591.82c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),l.jsx(Bl,{x:444.51,y:1635,colorBody:"#803d83",colorTop:"#cb8abc",isPressed:c==="purple"||m,onPress:()=>s("purple"),onRelease:()=>r("purple",p)}),l.jsxs("g",{children:[l.jsx("path",{fill:o(2),d:"M565.12,1689.3c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M565.12,1667.73c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.04h0M565.12,1664.73c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]})]})},_f=194.32,Of=1586.66,kg=({localDialRotation:e,isDialDragging:t,dialShaking:n,dialPressed:s,onDialStart:r,onDialPress:o,getControlsCornerLightColor:a,textState:i,isDialAligned:c,isComplicationActive:u,recentlyFixed:f=!1,isUnlocked:d=!0})=>l.jsxs("g",{id:"Reset_Controls",className:d?"minigame-active":"minigame-inactive",children:[l.jsx("path",{fill:"#45486c",d:"M290.21,1663.73c10.78-17.3,17.01-37.73,17.01-59.61,0-23.97-7.48-46.2-20.22-64.48,7.77-.06,15.53-3.05,21.46-8.98,11.98-11.98,11.98-31.4,0-43.37-1.9-1.9-3.99-3.5-6.21-4.8-.5-17.51-14.85-31.56-32.48-31.56H121.34c-17.78,0-32.22,14.28-32.49,32-1.95,1.22-3.81,2.66-5.5,4.36-11.98,11.98-11.98,31.4,0,43.37,5.16,5.16,11.69,8.09,18.42,8.8-12.82,18.31-20.34,40.6-20.34,64.65,0,22.08,6.34,42.67,17.3,60.07-5.63,1.18-11,3.95-15.38,8.32-11.98,11.98-11.98,31.4,0,43.37,11.98,11.98,31.4,11.98,43.37,0,4.44-4.44,7.23-9.91,8.38-15.64,17.22,10.63,37.5,16.77,59.22,16.77,22.93,0,44.26-6.84,62.07-18.59.88,6.39,3.78,12.55,8.69,17.46,11.98,11.98,31.4,11.98,43.37,0,11.98-11.98,11.98-31.4,0-43.37-5.11-5.11-11.58-8.03-18.24-8.78Z",className:u?"minigame-active-pulse":f?"minigame-solved-fade":""}),l.jsx("circle",{fill:"#0d1a19",cx:"194.32",cy:"1604.12",r:"97.6",opacity:"0.3"}),l.jsxs("g",{children:[l.jsx("path",{fill:a(1),d:"M103.94,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M103.94,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:a(0),d:"M288.3,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M288.3,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:a(2),d:"M103.94,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M103.94,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:a(3),d:"M288.3,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.53,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M288.3,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsx("text",{fill:i.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(108.17 1480.38)",children:i.text}),l.jsx("g",{transform:`translate(0 ${s?4:0}) rotate(${Math.round(e)} ${_f} ${Of})`,style:{cursor:t?"grabbing":"grab"},onMouseDown:p=>r(p.clientX,p.clientY),onTouchStart:p=>{p.touches.length>0&&r(p.touches[0].clientX,p.touches[0].clientY)},onClick:o,children:l.jsxs("g",{className:n?"shake":"",children:[l.jsx("circle",{fill:"#d36b28",cx:"194.32",cy:"1586.66",r:"86.84"}),l.jsx("path",{fill:"none",stroke:"#fff",strokeWidth:"6",strokeMiterlimit:"10",d:"M238.98,1629.6c-11.27,11.72-27.11,19.01-44.65,19.01s-32.11-6.72-43.27-17.62"}),l.jsx("g",{transform:"translate(170.65 1623.1) rotate(135) scale(1.74)",children:l.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),l.jsx("g",{transform:"translate(219.09 1623.1) rotate(45) scale(1.74 -1.74)",children:l.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),l.jsx("path",{fill:"#fff",d:"M169.51,1524.47l20.43-20.43c1.99-1.99,5.23-1.99,7.22,0l20.43,20.43c3.22,3.22.94,8.72-3.61,8.72h-40.86c-4.55,0-6.83-5.5-3.61-8.72Z"})]})}),u&&c&&l.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"24",fontWeight:"bold",textAnchor:"middle",x:_f,y:Of+8,style:{pointerEvents:"none"},children:"PRESS"})]}),wg=194.32,Rg=1586.66,Pg=({dialRotation:e,monitorOffset:t,periscopeY:n,dragHandlers:s,monitorDragHandlers:r,isMonitorDragging:o,isPeriscopeDragging:a=!1,isSnapping:i=!1,onDialClick:c,onBlueClick:u,onGreenClick:f,onPurpleClick:d,onUpgradesClick:p,onSettingsClick:y,onHelpClick:v,onSetRank:k,onAbortClick:w,upgradeCount:m,screenContent:h,isGameOver:x=!1,isSessionActive:C=!1,rank:j,currentXP:P,nextRankXP:R,shiftScore:S=0,gameStats:T={startTime:0,totalBonusTime:0,maxGroupSize:0,penalty:0},goalsCleared:E=0,goalsTarget:M=0,unspentPower:U=0,maxTime:ee=75e3,complications:te=[],onResolveComplication:N,upgradeLevels:z={},pulsePeriscope:Q=!1})=>{const B=(z.CAPACITOR_EFFICIENCY||0)>=Nn.CAPACITOR_EFFICIENCY.maxLevel,Z=(z.CIRCUIT_STABILIZER||0)>=Nn.CIRCUIT_STABILIZER.maxLevel,q=(z.GEAR_LUBRICATION||0)>=Nn.GEAR_LUBRICATION.maxLevel,oe=Wn(Oe.LASER,j),ne=Wn(Oe.LIGHTS,j),ve=Wn(Oe.CONTROLS,j),[Te,pe]=g.useState(null),[A,Y]=g.useState(!1),[H,W]=g.useState(!1),{laserSliders:me,updateLaserSlider:ie,shakingSlider:le,getLaserLightColors:V,getLaserTextState:we,recentlyFixed:Ce,isComplicationActive:be}=lg({complications:te,isLaserMaxed:B,onResolveComplication:N}),{lightsComplication:$e,lightSlider:Fe,handleLightsButton:Ee,handleLightsSliderChange:Re,lightsSliderShaking:Pe,getLightsButtonLightColor:I,getLightsSliderLightColors:F,getLightsTextState:ye,recentlyFixed:ue,isComplicationActive:D}=dg({complications:te,isLightsMaxed:Z,pressedBtn:Te,onResolveComplication:N}),{localDialRotation:L,isDialDragging:G,dialShaking:X,dialPressed:re,handleDialStart:ke,handleDialMove:b,handleDialEnd:_,handleDialPress:O,getControlsCornerLightColor:$,getControlsTextState:K,recentlyFixed:se,isDialAligned:de,isComplicationActive:ge}=vg({complications:te,isControlsMaxed:q,onResolveComplication:N});g.useEffect(()=>{if(!G)return;const fe=Ze=>{b(Ze.clientX,Ze.clientY)},Xe=()=>{_()},We=Ze=>{Ze.touches.length>0&&b(Ze.touches[0].clientX,Ze.touches[0].clientY)},ze=()=>{_()};return window.addEventListener("mousemove",fe),window.addEventListener("mouseup",Xe),window.addEventListener("touchmove",We),window.addEventListener("touchend",ze),()=>{window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",Xe),window.removeEventListener("touchmove",We),window.removeEventListener("touchend",ze)}},[G]),g.useEffect(()=>{C||W(!1)},[C]);const J=fe=>{pe(fe)},Ne=(fe,Xe)=>{Te===fe?(pe(null),fe==="blue"?Ee(0):fe==="green"?Ee(1):fe==="purple"&&Ee(2),Xe&&Xe()):pe(null)},Me=fe=>{fe.stopPropagation(),Y(Xe=>!Xe)},Ge=fe=>{k&&k(fe),Y(!1)},He=fe=>{fe.stopPropagation(),H?(w&&w(),W(!1)):(W(!0),setTimeout(()=>W(!1),3e3))},Be={transition:o?"none":"transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},_e={transition:o?"none":"opacity 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},ce=363.9*Math.min(1,Math.max(0,P/R)),it=Math.min(1,Math.max(0,(t+400)/920)),lt=Math.min(1,Math.max(0,n/300)),Rt=Math.max(it,lt)*.85,he="translate(31.92, 399.44)";return l.jsxs("svg",{viewBox:"0 827.84 648 1152",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{overflow:"hidden"},onClick:()=>{A&&Y(!1)},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"console-gradient",x1:"324",y1:"1979.84",x2:"324",y2:"827.84",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{offset:"0",stopColor:"#363b5e"}),l.jsx("stop",{offset:"1",stopColor:"#0b1c3f"})]}),l.jsx("clipPath",{id:"reset-lights-slider-clip",children:l.jsx("rect",{x:"356.86",y:"1499.08",width:"50.51",height:"175.86",rx:"6.92",ry:"6.92"})})]}),l.jsxs("g",{id:"Console_Base",children:[l.jsx("polygon",{fill:"#0f1829",points:"42.37 1807.1 54.73 1865.36 592.78 1865.36 605.14 1807.1 42.37 1807.1"}),l.jsx("path",{fill:"#616a79",d:"M615.77,1807.1l14.87-84.85c.65-3.69-2.19-7.08-5.94-7.08H22.81c-3.75,0-6.59,3.38-5.94,7.08l14.87,84.85h584.04Z"}),l.jsx("path",{fill:"#59acae",d:"M583.65,1441.46H63.86l-47.08,283.09c-.6,3.61,2,6.92,5.44,6.92h603.07c3.44,0,6.04-3.31,5.44-6.92l-47.08-283.09Z"}),l.jsxs("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",transform:"translate(55 1855.15)",children:[l.jsx("tspan",{letterSpacing:"-0.04em",children:"V"}),l.jsxs("tspan",{x:"9.49",children:["ersion 1.1.13.",280]})]}),l.jsx("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",textAnchor:"end",transform:"translate(592.5 1855.15)",children:"MuzzyMade @ 2026"}),l.jsx("g",{id:"RankSelector",className:x?"pointer-events-none":"cursor-pointer hover:brightness-125 active:brightness-90 transition-all origin-center",onClick:x?void 0:Me,children:l.jsx("text",{fill:A?"#5bbc70":"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:A?"bold":"normal",textAnchor:"middle",transform:"translate(323.75 1855.99)",children:"RANK SELECT"})})]}),l.jsxs("g",{transform:"translate(17.28, 1057.14)",children:[l.jsx("path",{fill:"#616a79",fillRule:"evenodd",d:"M597.13,32.56H15.82C6.56,32.56-.51,40.11.03,49.42l18.54,321.98c.39,6.78,5.81,12.28,12.11,12.28h551.59c6.3,0,11.72-5.5,12.11-12.28l18.54-321.98c.54-9.31-6.53-16.86-15.79-16.86Z"}),l.jsx("path",{fill:"#aad9d9",fillRule:"evenodd",d:"M604.74,37.21H8.21c-3.37,0-5.34-4.05-3.17-6.52L23.09,10.16C28.83,3.68,37.14,0,46.03,0h520.89c8.89,0,17.2,3.68,22.94,10.16l18.06,20.52c2.17,2.47.19,6.52-3.17,6.52Z"}),l.jsx("path",{fill:"#1d1d3a",d:"M536.44,362.92H76.51c-21.64,0-40.25-18.8-41.48-41.9l-11.76-220.89c-.6-11.35,3.24-22,10.81-29.99,7.45-7.85,17.63-12.18,28.67-12.18h487.46c11.04,0,21.22,4.33,28.67,12.18,7.58,7.99,11.41,18.64,10.81,29.99l-11.76,220.89c-1.23,23.1-19.84,41.9-41.48,41.9ZM62.75,62.96c-9.65,0-18.55,3.77-25.04,10.62-6.62,6.98-9.98,16.32-9.45,26.28l11.76,220.89c1.09,20.49,17.46,37.17,36.49,37.17h459.93c19.03,0,35.4-16.67,36.49-37.17l11.76-220.89c.53-9.96-2.82-19.3-9.45-26.28-6.49-6.85-15.39-10.62-25.04-10.62H62.75Z"}),l.jsx("path",{fill:"#35385b",fillRule:"evenodd",d:"M550.2,60.46H62.75c-21.59,0-38.15,17.7-36.98,39.53l11.76,220.89c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.76-220.89c1.16-21.83-15.4-39.53-36.98-39.53Z"}),l.jsx("path",{fill:"#474871",fillRule:"evenodd",d:"M549.56,74.42H63.39c-21.53,0-38.04,17.7-36.88,39.53l11.02,206.94c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.02-206.94c1.16-21.83-15.35-39.53-36.88-39.53Z",className:be?"minigame-active-pulse-laser":Ce?"minigame-solved-fade-laser":""}),l.jsxs("g",{id:"Operator_Rank_-_meter",children:[l.jsx("path",{fill:"#5bbc70",d:"M540.77,147.84H74.51c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM74.51,128.07c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H74.51Z"}),l.jsx("path",{fill:"#5bbc70",d:`M74.51,127.57h${ce}c.66,0,1.2.54,1.2,1.2v17.36c0,.66-.54,1.2-1.2,1.2H74.51c-5.45,0-9.88-4.43-9.88-9.88h0c0-5.45,4.43-9.88,9.88-9.88Z`}),l.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(545 142)",children:[Math.floor(P).toLocaleString()," / ",Math.floor(R).toLocaleString()]}),l.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(545 118)",children:"PROMOTION THRESHOLD"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(239.35 115.28)",children:j}),l.jsxs("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(65.42 113.79)",children:[l.jsx("tspan",{x:"0",y:"0",children:"OPE"}),l.jsx("tspan",{letterSpacing:".02em",x:"40.54",y:"0",children:"R"}),l.jsx("tspan",{letterSpacing:"-.05em",x:"53.68",y:"0",children:"A"}),l.jsx("tspan",{letterSpacing:"-.03em",x:"66.07",y:"0",children:"T"}),l.jsx("tspan",{x:"77.45",y:"0",children:"OR "}),l.jsx("tspan",{letterSpacing:".02em",x:"112.01",y:"0",children:"R"}),l.jsx("tspan",{x:"125.16",y:"0",children:"ANK"})]})]}),l.jsx(Sg,{laserSliders:me,shakingSlider:le,onSliderChange:ie,getLaserLightColors:V,textState:we(),isComplicationActive:be,recentlyFixed:Ce,isUnlocked:oe})]}),l.jsx(Cg,{lightsComplication:$e,lightSlider:Fe,onSliderChange:Re,onButtonPress:J,onButtonRelease:Ne,getLightsButtonLightColor:I,getLightsSliderLightColors:F,textState:ye(),pressedBtn:Te,sliderShaking:Pe,onBlueClick:u,onGreenClick:f,onPurpleClick:d,isComplicationActive:D,recentlyFixed:ue,isUnlocked:ne}),l.jsx(kg,{localDialRotation:L,isDialDragging:G,dialShaking:X,dialPressed:re,onDialStart:ke,onDialPress:O,getControlsCornerLightColor:$,textState:K(),isDialAligned:de(),isComplicationActive:ge,recentlyFixed:se,isUnlocked:ve}),l.jsx("circle",{id:"coord-reference",cx:wg,cy:Rg,r:"1",fill:"transparent",style:{pointerEvents:"none"}}),(C||j>0)&&l.jsx("g",{id:"System_Upgrades",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:C?He:p,children:C?l.jsxs(l.Fragment,{children:[l.jsx("rect",{fill:"#ef4444",x:"123.18",y:"1748.67",width:"342.8",height:"44.19",rx:"12.37",ry:"12.37"}),l.jsx("rect",{fill:"none",stroke:"#ef4444",strokeMiterlimit:"10",x:"123.45",y:"1748.67",width:"420.29",height:"44.19",rx:"9.43",ry:"9.43"}),l.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"294.58",y:"1778.17",children:H?"ARE YOU SURE?":"END SHIFT EARLY"}),l.jsx("text",{fill:"#ef4444",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",transform:"translate(492.79 1783.33)",children:"X"})]}):l.jsxs(l.Fragment,{children:[l.jsx("rect",{fill:"#ffd92b",x:"205",y:"1748.67",width:"160",height:"44.19",rx:"12.37",ry:"12.37"}),l.jsx("rect",{fill:"none",stroke:"#ffd92b",strokeMiterlimit:"10",x:"205",y:"1748.67",width:"238",height:"44.19",rx:"9.43",ry:"9.43"}),l.jsx("text",{fill:"#45486c",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"285",y:"1778.17",children:"UPGRADES"}),l.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",textAnchor:"middle",x:"404",y:"1783.33",children:m})]})}),l.jsxs("text",{fill:"#5bbc70",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(210.86 1947.47)",children:[l.jsx("tspan",{letterSpacing:".01em",children:"G"}),l.jsx("tspan",{x:"50.77",children:"O"}),l.jsx("tspan",{letterSpacing:".01em",x:"94.43",children:"O"}),l.jsx("tspan",{letterSpacing:".03em",x:"138.94",children:"P"}),l.jsx("tspan",{x:"182.79",children:"S"})]}),l.jsxs("g",{id:"How_to_Play",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:v,children:[l.jsx("circle",{fill:"#5bbc70",cx:"60.02",cy:"1920.16",r:"42.65"}),l.jsx("text",{fill:"#0f1528",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(43.23 1951.29)",children:"?"})]}),l.jsxs("g",{id:"Settings",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:y,children:[l.jsx("circle",{fill:"#5bbc70",cx:"586.51",cy:"1921.29",r:"42.65"}),l.jsx("path",{fill:"#0f1528",d:"M575.34,1888.9c1.31-.22,2.74.1,3.77.94.53.43.76,1.11,1.28,1.57,3.07,2.69,6.81,3.17,10.41,1.27,2.93-1.54,3.23-4.63,7.35-3.65,2.47.59,8.3,3.99,10.15,5.79,3.3,3.22.52,5.23.71,8.67.17,3.07,2.34,6.18,5.12,7.42,2.12.95,4.78.73,5.84,3.27s.95,10.11.24,12.77c-1.23,4.62-4.11,3.02-7.31,4.93-2.36,1.42-4.2,4.72-4.2,7.5s1.94,4.09.64,6.88c-1.06,2.28-8.15,6.41-10.64,7.02-3.9.96-4.47-2.07-6.97-3.74-2.65-1.77-6.22-1.75-9.02-.28-3.07,1.61-3.15,5.19-7.61,4.38-2.27-.42-8.91-4.29-10.53-5.98-2.69-2.79-.66-4.28-.3-6.87.55-3.94-1.21-8.15-4.99-9.77-2.48-1.06-5.42-.37-6.52-3.73-.83-2.52-.68-11.58.66-13.88,1.2-2.06,3.02-1.68,4.85-2.27,4.19-1.36,6.81-5.14,6.29-9.6-.29-2.49-1.96-4.37.32-6.86,1.42-1.56,8.41-5.43,10.46-5.77ZM586.19,1909.97c-14.67.42-14.14,22.83.44,22.69,14.84-.14,14.53-23.12-.44-22.69Z"})]}),l.jsx("rect",{x:"0",y:"827.84",width:"648",height:"1152",fill:"#000",style:{opacity:Rt,..._e,pointerEvents:"none"}}),l.jsxs("g",{id:"Periscope",className:Q?"periscope-pulse":"",transform:`translate(0, ${n})`,style:{transition:a||i?"none":"transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"grab"},...s,children:[l.jsx("rect",{fill:"#087962",x:"22.36",y:"978.45",width:"603.66",height:"51.13",rx:"11.03",ry:"11.03"}),l.jsx("path",{fill:"#087962",d:"M 390.17 -1000 V 1111.98 c 0 13.74 -11.16 24.9 -24.9 24.9 h -88.54 c -13.74 0 -24.9 -11.16 -24.9 -24.9 V -1000 H 390.17 Z"}),l.jsxs("g",{children:[l.jsx("path",{fill:"#5bbc70",fillRule:"evenodd",d:"M252.54,1089.77c-23.25,0-45.07-9.09-61.45-25.59-16.38-16.5-25.3-38.39-25.13-61.64.35-47.38,39.59-85.92,87.47-85.92h138.58c23.99,0,46.29,9.59,62.81,26.99,16.51,17.4,24.9,40.21,23.64,64.23-2.4,45.72-40.19,81.7-86.02,81.93h-.44c-24.04,0-47.19-10.12-63.53-27.77-2.19-2.36-4.86-2.71-6.27-2.71s-3.96.34-6.05,2.61c-16.35,17.72-39.54,27.87-63.63,27.87Z"}),l.jsx("path",{fill:"#0b1c3f",fillRule:"evenodd",d:"M392.01,931.91h-138.58c-39.31,0-71.89,31.44-72.18,70.75-.29,39.62,31.74,71.83,71.29,71.83,20.72,0,39.37-8.84,52.39-22.95,9.32-10.1,25.43-10,34.77.09,13.09,14.14,31.85,22.97,52.67,22.87,37.55-.18,68.86-29.95,70.83-67.44,2.16-41.12-30.54-75.13-71.19-75.13Z"}),l.jsx("path",{fill:"#373a60",fillRule:"evenodd",d:"M392.02,1054.51c-14.46,0-27.83-5.85-37.66-16.46-8.25-8.91-19.96-14.02-32.14-14.02s-23.79,5.09-31.97,13.96c-9.83,10.66-23.23,16.53-37.71,16.53s-26.71-5.39-36.42-15.17c-9.71-9.78-15-22.76-14.89-36.54.21-28.08,23.63-50.92,52.21-50.92h138.58c14.22,0,27.44,5.68,37.23,16,9.78,10.31,14.76,23.84,14.01,38.11-1.42,27.07-23.82,48.38-50.98,48.52h-.26Z"})]}),l.jsx("g",{transform:"translate(303.67 1091.18) scale(1.74)",children:l.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})})]}),l.jsx("g",{transform:`translate(0, ${t})`,style:{...Be,cursor:x?"grab":"default",pointerEvents:x?"auto":"none",touchAction:x?"none":"auto"},...x&&o!==void 0?r:{},children:x?l.jsx("g",{transform:he,children:l.jsx(sg,{shiftScore:S,rank:j,xpCurrent:P,xpNext:R,cracksFilled:E,cracksTarget:M,pressureVented:T.totalBonusTime||0,maxTime:ee,massPurged:T.maxGroupSize||0,leftoverPenalty:T.penalty||0,unspentPower:U,isWin:E>=M})}):l.jsxs(l.Fragment,{children:[l.jsx("path",{fill:"#f2a743",d:"M48.78,432h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H44.2c-6.78,0-12.28-5.5-12.28-12.28V448.86c0-9.31,7.55-16.86,16.86-16.86Z"}),l.jsx("path",{fill:"#d36b28",d:"M606.65,436.65H40.86c-3.39,0-5.14-4.05-2.82-6.52l19.25-20.52c6.08-6.49,14.58-10.16,23.47-10.16h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),l.jsx("path",{fill:"none",stroke:"#1d1d3a",strokeWidth:"5",strokeMiterlimit:"10",d:"M592.34,1246.25c0,21.83-17.7,39.53-39.53,39.53H94.71c-21.83,0-39.53-17.7-39.53-39.53V499.44c0-21.83,17.7-39.53,39.53-39.53h458.1c21.83,0,39.53,17.7,39.53,39.53v746.81Z"}),l.jsx("rect",{fill:"#1f1f38",x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),l.jsx("foreignObject",{x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53",children:l.jsx("div",{className:"w-full h-full overflow-hidden rounded-[39px]",children:h})}),l.jsx("g",{pointerEvents:"none",children:l.jsx("path",{fill:"none",stroke:"#5bbc70",strokeWidth:"1",strokeOpacity:"0.2",d:"M94.71,474.42h458.1c21.82,0,39.53,17.71,39.53,39.53v732.85c0,21.82-17.71,39.53-39.53,39.53H94.71c-21.82,0-39.53-17.71-39.53-39.53V513.95c0-21.82,17.71-39.53,39.53-39.53Z"})})]})}),A&&!x&&l.jsx("foreignObject",{x:"200",y:"1550",width:"250",height:"300",children:l.jsxs("div",{onClick:fe=>fe.stopPropagation(),style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1d1d3a 0%, #0f1829 100%)",border:"2px solid #5bbc70",borderRadius:"8px",overflow:"hidden"},children:[l.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #5bbc70",color:"#5bbc70",fontFamily:"Amazon Ember, sans-serif",fontWeight:"bold",fontSize:"14px",textAlign:"center"},children:"SELECT RANK"}),l.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px"},children:Array.from({length:51},(fe,Xe)=>l.jsx("div",{onClick:()=>Ge(Xe),style:{padding:"8px 12px",color:Xe===0?"#f87171":Xe===j?"#5bbc70":"#aad9d9",fontFamily:"Amazon Ember, sans-serif",fontSize:"14px",cursor:"pointer",borderRadius:"4px",background:Xe===j?"rgba(91, 188, 112, 0.2)":"transparent",fontWeight:Xe===j?"bold":"normal",transition:"background 0.15s"},onMouseEnter:We=>{Xe!==j&&(We.currentTarget.style.background="rgba(170, 217, 217, 0.1)")},onMouseLeave:We=>{Xe!==j&&(We.currentTarget.style.background="transparent")},children:Xe===0?"0 - WIPE DATA":`Rank ${Xe}`},Xe))})]})})]})},jg=[{id:"actives",label:"TOOLS",unlockRank:5,color:"#fbbf24"},{id:"features",label:"FEATURES",unlockRank:20,color:"#a78bfa"},{id:"complications",label:"SYSTEMS",unlockRank:2,color:"#f97316"},{id:"passives",label:"UTILITY",unlockRank:3,color:"#5bbc70"}],Tg=(e,t)=>t==="active"?{accent:"#b45309",text:"#fbbf24"}:t==="feature"?{accent:"#7c3aed",text:"#a78bfa"}:e==="CAPACITOR_EFFICIENCY"?{accent:"#d82727",text:"#ff6b6b"}:e==="CIRCUIT_STABILIZER"?{accent:"#d36b28",text:"#ffa94d"}:e==="GEAR_LUBRICATION"?{accent:"#2d5a87",text:"#74c0fc"}:{accent:"#2d7a4d",text:"#5bbc70"},bg=({scraps:e,upgrades:t,rank:n,onPurchase:s,onRefund:r,onClose:o,equippedActives:a=[],onToggleEquip:i,maxActiveSlots:c=1})=>{var S;const u=jg.filter(T=>T.unlockRank<=n),[f,d]=g.useState(((S=u[0])==null?void 0:S.id)||"complications"),[p,y]=g.useState(!1),v=g.useRef(0),k=g.useRef(0),w=50,m=(T,E)=>{y(!0),v.current=T,k.current=E},h=(T,E)=>{if(!p)return;y(!1);const M=T-v.current,U=E-k.current;if(Math.abs(M)>Math.abs(U)&&Math.abs(M)>w){const ee=u.findIndex(te=>te.id===f);M>0&&ee<u.length-1?d(u[ee+1].id):M<0&&ee>0&&d(u[ee-1].id)}};g.useEffect(()=>{const T=M=>{p&&h(M.clientX,M.clientY)},E=M=>{p&&M.changedTouches[0]&&h(M.changedTouches[0].clientX,M.changedTouches[0].clientY)};return p&&(window.addEventListener("mouseup",T),window.addEventListener("touchend",E)),()=>{window.removeEventListener("mouseup",T),window.removeEventListener("touchend",E)}},[p,f,u]);const C=(()=>{const T=Object.values(Nn).filter(E=>E.unlockRank<=n);switch(f){case"actives":return T.filter(E=>E.type==="active").sort((E,M)=>E.unlockRank-M.unlockRank);case"features":return T.filter(E=>E.type==="feature").sort((E,M)=>E.unlockRank-M.unlockRank);case"complications":return T.filter(E=>E.category==="complication").sort((E,M)=>E.unlockRank-M.unlockRank);case"passives":return T.filter(E=>E.type==="passive"&&E.category!=="complication").sort((E,M)=>E.unlockRank-M.unlockRank);default:return[]}})(),j=u.length>0,P=T=>{const E=t[T.id]||0,M=E>=T.maxLevel,ee=e>=T.costPerLevel&&!M,te=E>0,N=Tg(T.id,T.type),z=T.type==="active",Q=a.includes(T.id);return l.jsxs("div",{className:"rounded-xl p-4 border",style:{backgroundColor:"#0c0f19",borderColor:z&&Q?"#5bbc70":"#ffffff40"},children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-bold tracking-wide t-body",style:{color:N.text},children:T.name}),l.jsx("p",{style:{color:"#59acae"},className:"mt-1 t-body",children:T.desc})]}),z&&E>0&&i&&l.jsx("button",{onClick:()=>i(T.id),disabled:!Q&&a.length>=c,className:"ml-2 px-3 py-1 rounded-lg font-bold t-body border-2 transition-all",style:{borderColor:Q?"#5bbc70":"#59acae60",color:Q?"#5bbc70":"#59acae",backgroundColor:Q?"#5bbc7020":"transparent",cursor:!Q&&a.length>=c?"not-allowed":"pointer",opacity:!Q&&a.length>=c?.5:1},children:Q?"ON":"OFF"})]}),l.jsxs("div",{className:"flex items-center gap-3 my-3",children:[l.jsx("button",{onClick:()=>te&&(r==null?void 0:r(T.id)),disabled:!te,className:"w-8 h-8 rounded-lg font-bold t-heading border-2 transition-all flex items-center justify-center",style:{borderColor:te?N.accent:"#59acae30",color:te?N.text:"#59acae40",backgroundColor:te?N.accent+"20":"transparent",cursor:te?"pointer":"not-allowed"},children:""}),l.jsx("div",{className:"flex gap-1 flex-1 justify-center",children:Array.from({length:T.maxLevel}).map((B,Z)=>l.jsx("div",{className:"h-4 rounded-sm border flex-1 max-w-8",style:{borderColor:Z<E?N.accent:"#59acae40",backgroundColor:Z<E?N.accent:"transparent"}},Z))}),l.jsx("button",{onClick:()=>ee&&s(T.id),disabled:!ee,className:"w-8 h-8 rounded-lg font-bold t-heading border-2 transition-all flex items-center justify-center",style:{borderColor:ee?N.accent:"#59acae30",color:ee?N.text:"#59acae40",backgroundColor:ee?N.accent+"20":"transparent",cursor:ee?"pointer":"not-allowed"},children:"+"}),l.jsxs("span",{className:"font-bold w-12 text-right t-body",style:{color:N.text},children:[E,"/",T.maxLevel]})]}),l.jsxs("div",{className:"flex justify-between items-start t-body",children:[l.jsx("div",{style:{color:"#ffffff"},children:z?l.jsxs(l.Fragment,{children:["Effect: ",T.formatEffect(1)]}):E>0?l.jsxs(l.Fragment,{children:["Current: ",T.formatEffect(E)]}):l.jsx("span",{style:{color:"#59acae"},children:"Current: Spend points to upgrade"})}),M&&T.maxLevelBonus&&l.jsxs("div",{className:"italic text-right ml-2",style:{color:"#5bbc70"},children:["Max: ",T.maxLevelBonus]})]})]},T.id)},R=()=>u.length===0?null:l.jsx("div",{className:"flex w-full mb-3",style:{height:"36px"},children:u.map(T=>{const E=f===T.id;return l.jsx("button",{onClick:()=>d(T.id),className:"font-bold text-center transition-all t-body",style:{width:"25%",backgroundColor:E?T.color+"30":"transparent",color:E?T.color:"#59acae",borderBottom:E?`3px solid ${T.color}`:"3px solid transparent",padding:"8px 4px",fontFamily:"'From Where You Are', sans-serif",letterSpacing:"0.05em"},children:T.label},T.id)})});return l.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:l.jsxs("div",{className:"relative",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:[l.jsxs("svg",{viewBox:"0 0 583.67 910",className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[l.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),l.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),l.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),l.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),l.jsx("text",{fill:"#f2a743",fontFamily:"'From Where You Are'",fontSize:"28",transform:"translate(50 105)",children:"UPGRADES"}),l.jsxs("text",{fill:"#5bbc70",fontFamily:"'Amazon Ember'",transform:"translate(530 105)",textAnchor:"end",children:[l.jsx("tspan",{fontSize:"16",fontWeight:"600",children:"SCRAPS: "}),l.jsx("tspan",{fontSize:"32",fontWeight:"800",children:e})]}),l.jsxs("foreignObject",{x:"40",y:"125",width:"503",height:"720",children:[l.jsx("style",{children:".upgrade-scroll::-webkit-scrollbar { display: none; }"}),l.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"upgrade-scroll w-full h-full overflow-y-auto",style:{fontFamily:"'Amazon Ember', sans-serif",scrollbarWidth:"none",msOverflowStyle:"none"},onMouseDown:T=>m(T.clientX,T.clientY),onTouchStart:T=>m(T.touches[0].clientX,T.touches[0].clientY),children:j?l.jsxs("div",{className:"pb-20",children:[l.jsx("div",{className:"t-body mb-3 text-center",style:{color:"#fbbf24",fontFamily:"'Amazon Ember', sans-serif"},children:"Earn Scraps by Increasing your Operator Rank"}),R(),l.jsx("div",{className:"space-y-3",children:C.length>0?C.map(P):l.jsx("div",{className:"text-center py-8 t-body",style:{color:"#59acae"},children:"No upgrades available in this category yet."})})]}):l.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[l.jsx("p",{className:"t-heading tracking-wide mb-3",style:{color:"#6acbda",fontFamily:"'From Where You Are', sans-serif"},children:"NO UPGRADES AVAILABLE"}),l.jsx("p",{className:"t-body",style:{color:"#59acae"},children:"Reach Rank 2 to unlock your first upgrade"})]})})]})]}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:o,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(ul,{className:"w-1/2 h-1/2 stroke-[3]"})})})]})})},Mg=({engine:e,state:t,careerScore:n,scraps:s,powerUps:r={},onOpenSettings:o,onOpenHelp:a,onOpenUpgrades:i,onSetRank:c,onPurchaseUpgrade:u,onRefundUpgrade:f,onDismissGameOver:d,equippedActives:p=[],onToggleEquip:y,pulsePeriscope:v=!1})=>{const k=t.shiftScore>0||t.gameOver;let w;if(k){const le=t.goalsCleared>=t.goalsTarget,{newCareerScore:V}=A0(e.initialTotalScore,t.shiftScore,le);w=gt(V)}else w=gt(n);const[m,h]=g.useState(!1),x=g.useRef(null),[C,j]=g.useState(0),[P,R]=g.useState(!1),[S,T]=g.useState(!1),E=g.useRef(0),M=200,U=300,[ee,te]=g.useState(0),[N,z]=g.useState(!1),Q=g.useRef(0),B=150,[Z,q]=g.useState(0);g.useEffect(()=>{if(!t.gameOver){const le=setInterval(()=>{q(V=>(V+1)%2)},2e3);return()=>clearInterval(le)}},[t.gameOver]),g.useEffect(()=>{t.phase===qe.ConsoleScreen&&!t.gameOver&&(j(U),T(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{T(!1),j(0)})}))},[t.phase,t.gameOver]);const oe=le=>{t.gameOver||(R(!0),E.current=le-C)},ne=le=>{if(!P)return;const V=le-E.current,we=Math.max(0,Math.min(U,V));j(we)},ve=()=>{P&&(R(!1),C>M?(e.execute(new Hs(qe.TankScreen)),setTimeout(()=>j(0),1e3)):j(0))},Te=le=>{t.gameOver&&(z(!0),Q.current=le-ee)},pe=le=>{if(!N)return;const V=le-Q.current,we=Math.min(0,V);te(we)},A=()=>{N&&(z(!1),ee<-B&&d&&d(),te(0))};g.useEffect(()=>{const le=be=>{P&&ne(be.clientY),N&&pe(be.clientY)},V=()=>{P&&ve(),N&&A()},we=be=>{P&&ne(be.touches[0].clientY),N&&pe(be.touches[0].clientY)},Ce=()=>{P&&ve(),N&&A()};return(P||N)&&(window.addEventListener("mousemove",le),window.addEventListener("mouseup",V),window.addEventListener("touchmove",we),window.addEventListener("touchend",Ce)),()=>{window.removeEventListener("mousemove",le),window.removeEventListener("mouseup",V),window.removeEventListener("touchmove",we),window.removeEventListener("touchend",Ce)}},[P,C,N,ee]);const Y=()=>{e.abortRun()},H=e.isSessionActive&&!t.gameOver,me=(t.gameOver?520:-400)+ee,ie=()=>l.jsx("div",{className:"w-full h-full flex flex-col items-center pt-24 font-mono overflow-hidden text-center select-none",children:l.jsx("div",{className:"mt-auto mb-4 flex flex-col items-center",children:H?Z===0?l.jsx("div",{className:"text-[#5bbc70] t-display font-black tracking-widest font-['From_Where_You_Are'] animate-pulse",children:"CLEANING..."}):l.jsxs("div",{className:"text-[#f1a941] t-display font-black tracking-widest font-['From_Where_You_Are']",children:[Math.floor((1-t.shiftTime/e.maxTime)*100),"% PSI"]}):Z===0?l.jsx("div",{className:"text-[#f1a941] t-heading font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"TO START SHIFT"}):l.jsx("div",{className:"text-[#f1a941] t-heading font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"PULL DOWN PERISCOPE"})})});return l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{ref:x,className:"relative z-10 select-none flex items-center justify-center",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsx("div",{className:"w-full h-full shadow-2xl relative",children:l.jsx(Pg,{dialRotation:0,monitorOffset:me,periscopeY:C,dragHandlers:{onMouseDown:le=>oe(le.clientY),onTouchStart:le=>oe(le.touches[0].clientY)},monitorDragHandlers:{onMouseDown:le=>Te(le.clientY),onTouchStart:le=>Te(le.touches[0].clientY)},isMonitorDragging:N,isPeriscopeDragging:P,isSnapping:S,onSettingsClick:o,onHelpClick:a,onUpgradesClick:()=>h(!0),onSetRank:c,onAbortClick:Y,upgradeCount:s,screenContent:t.gameOver?null:l.jsx(ie,{}),isGameOver:t.gameOver,isSessionActive:e.isSessionActive,rank:w.rank,currentXP:w.progress,nextRankXP:w.toNextRank,shiftScore:t.shiftScore,gameStats:t.gameStats,goalsCleared:t.goalsCleared,goalsTarget:t.goalsTarget,unspentPower:s,maxTime:e.maxTime,complications:t.complications,onResolveComplication:le=>e.execute(new eg(le)),upgradeLevels:r,pulsePeriscope:v})})}),m&&l.jsx(bg,{scraps:s,upgrades:r,rank:w.rank,onPurchase:le=>u==null?void 0:u(le),onRefund:le=>f==null?void 0:f(le),onClose:()=>h(!1),equippedActives:p,onToggleEquip:y,maxActiveSlots:1+(r.ACTIVE_EXPANSION_SLOT||0)+(r.ACTIVE_EXPANSION_SLOT_2||0)})]})};function zl(e){return`${e.x},${e.y}`}function Lf(e){if(e.length<=1)return!0;const t=new Set(e.map(zl)),n=new Set,s=[e[0]];for(;s.length>0;){const r=s.shift(),o=zl(r);if(n.has(o))continue;n.add(o);const a=[{x:r.x,y:r.y+1},{x:r.x,y:r.y-1},{x:r.x+1,y:r.y},{x:r.x-1,y:r.y}];for(const i of a){const c=zl(i);t.has(c)&&!n.has(c)&&s.push(i)}}return n.size===e.length}function Ag(e){const t=e.length;if(t<2)return null;let n=null,s=1/0;for(let r=1;r<(1<<t)-1;r++){const o=[],a=[];for(let f=0;f<t;f++)r&1<<f?o.push(f):a.push(f);const i=o.map(f=>e[f]),c=a.map(f=>e[f]);if(!Lf(i)||!Lf(c))continue;const u=Math.abs(o.length-a.length);if(u<s&&(s=u,n=[o,a],u===0))break}return n}function Nf(e,t,n){const s=Ag(e.cells);if(!s)return{...e,color:t};const[r]=s,o=new Set(r),a=e.cells.map((i,c)=>o.has(c)?t:n);return{...e,color:t,cellColors:a}}const Df=5e3;class Eg{trySpawnGoal(t,n,s,r,o,a){if(t.goalsCleared>=t.goalsTarget)return{goal:null,newLastSpawnTime:a};const i=Date.now();if(i-a<=Df)return{goal:null,newLastSpawnTime:a};const c=gt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=Sf(n,t.goalMarks,c,r,o,u);return f?(u&&t.crackDownRemaining--,Tt.playPop(1),{goal:f,newLastSpawnTime:i}):{goal:null,newLastSpawnTime:i}}trySpawnCrack(t,n,s,r,o,a){if(t.goalsCleared>=t.goalsTarget)return{crack:null,newLastSpawnTime:a};const i=Date.now();if(i-a<=Df)return{crack:null,newLastSpawnTime:a};const c=gt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=t.crackCells.map(p=>({id:p.id,x:p.x,y:p.y,color:p.color,spawnTime:p.spawnTime})),d=Sf(n,f,c,r,o,u);if(d){console.log(`[CRACK] SPAWN via GoalManager at (${d.x}, ${d.y}) color=${d.color} source="GoalManager-trySpawnCrack" time=${new Date().toLocaleTimeString()}`);const p={id:d.id,x:d.x,y:d.y,color:d.color,originCrackId:[],branchCrackIds:[],lastGrowthCheck:i,crackBranchInterval:7e3+Math.random()*5e3,spawnTime:d.spawnTime};return u&&t.crackDownRemaining--,Tt.playPop(1),{crack:p,newLastSpawnTime:i}}return{crack:null,newLastSpawnTime:i}}handleGoals(t,n,s,r,o){t.goalMarks=t.goalMarks.filter(i=>!n.includes(i.id));const a=new Set(n);n.forEach(i=>{const c=t.crackCells.find(u=>u.id===i);c&&(c.originCrackId.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.branchCrackIds=f.branchCrackIds.filter(d=>d!==i))}),c.branchCrackIds.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.originCrackId=f.originCrackId.filter(d=>d!==i))}))}),t.crackCells=t.crackCells.filter(i=>!a.has(i.id)),n.forEach(i=>{const c=Ve(r.x),u=Math.floor(r.y),f=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:f,text:"Laser to Seal",x:c,y:u,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(d=>d.id!==f),o()},1e3),xe.emit(ae.GOAL_CAPTURED,{count:1})})}handleCrackConsumption(t,n,s,r){if(n.length===0)return;const o=new Set(n);if(n.forEach(a=>{const i=t.crackCells.find(c=>c.id===a);i&&(i.originCrackId.forEach(c=>{const u=t.crackCells.find(f=>f.id===c);u&&(u.branchCrackIds=u.branchCrackIds.filter(f=>f!==a))}),i.branchCrackIds.forEach(c=>{const u=t.crackCells.find(f=>f.id===c);u&&(u.originCrackId=u.originCrackId.filter(f=>f!==a))}))}),t.crackCells=t.crackCells.filter(a=>!o.has(a.id)),t.goalMarks=t.goalMarks.filter(a=>!o.has(a.id)),n.length>0){const a=Ve(s.x),i=Math.floor(s.y),c=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:c,text:n.length>1?`Sealed ${n.length}`:"Sealed",x:a,y:i,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(u=>u.id!==c),r()},1e3),xe.emit(ae.GOAL_CAPTURED,{count:n.length})}}countCracks(t){if(t.length===0)return 0;const n=new Set;let s=0;for(const r of t){if(n.has(r.id))continue;const o=[r.id];for(;o.length>0;){const a=o.shift();if(n.has(a))continue;n.add(a);const i=t.find(c=>c.id===a);i&&(i.originCrackId.forEach(c=>{n.has(c)||o.push(c)}),i.branchCrackIds.forEach(c=>{n.has(c)||o.push(c)}))}s++}return s}getConnectedComponent(t,n){const s=new Set,r=[],o=[t];for(;o.length>0;){const a=o.shift();if(s.has(a))continue;s.add(a);const i=n.find(c=>c.id===a);i&&(r.push(i),i.originCrackId.forEach(c=>{s.has(c)||o.push(c)}),i.branchCrackIds.forEach(c=>{s.has(c)||o.push(c)}))}return r}isLeafCell(t,n){const s=n.find(r=>r.id===t);return s?s.branchCrackIds.length===0:!0}}const tc=new Eg,Ig=8;class _g{tickGrowth(t,n,s,r){var i;if(gt(n).rank<30||t.phase===qe.ConsoleScreen||t.phase===qe.COMPLICATION_MINIGAME)return;const a=Date.now();for(const c of t.crackCells){if((i=t.grid[c.y])!=null&&i[c.x]||a-c.lastGrowthCheck<c.crackBranchInterval)continue;c.lastGrowthCheck=a,c.crackBranchInterval=5e3+Math.random()*5e3;const u=Math.max(0,1-t.shiftTime/r),f=Math.min(1,.1+u),p=(s.SLOW_CRACKS||0)*.05;let y=Math.max(0,f-p);c.branchCrackIds.length===0&&(y*=.5);const k=this.getDistanceFromRoot(c,t.crackCells),w=Math.max(.1,1-k*.25);if(y*=w,Math.random()>y)continue;const m=[{x:Ve(c.x+1),y:c.y},{x:Ve(c.x-1),y:c.y},{x:c.x,y:c.y+1},{x:c.x,y:c.y-1},{x:Ve(c.x+1),y:c.y-1},{x:Ve(c.x-1),y:c.y-1},{x:Ve(c.x+1),y:c.y+1},{x:Ve(c.x-1),y:c.y+1}],h=[];for(const C of m){if(C.y<nt||C.y>=De)continue;const j=t.crackCells.find(R=>R.x===C.x&&R.y===C.y&&R.color===c.color);if(j){!c.branchCrackIds.includes(j.id)&&!c.originCrackId.includes(j.id)&&h.push({...C,existingCrack:j});continue}t.crackCells.find(R=>R.x===C.x&&R.y===C.y)||t.grid[C.y][C.x]||h.push(C)}if(h.length===0)continue;const x=h[Math.floor(Math.random()*h.length)];if(x.existingCrack)x.existingCrack.originCrackId.push(c.id),c.branchCrackIds.push(x.existingCrack.id);else{if(tc.countCracks(t.crackCells)>=Ig)continue;const j={id:Math.random().toString(36).substr(2,9),x:x.x,y:x.y,color:c.color,originCrackId:[c.id],branchCrackIds:[],lastGrowthCheck:a,crackBranchInterval:5e3+Math.random()*5e3,spawnTime:a};c.branchCrackIds.push(j.id),console.log(`[CRACK] SPAWN id=${j.id} at (${j.x}, ${j.y}) color=${j.color} source="CrackManager-branch" time=${new Date().toLocaleTimeString()} totalCracks=${t.crackCells.length+1}`),t.crackCells.push(j),t.goalMarks.push({id:j.id,x:j.x,y:j.y,color:j.color,spawnTime:j.spawnTime})}}}getDistanceFromRoot(t,n){if(t.originCrackId.length===0)return 0;let s=0,r=t.id;const o=new Set;for(;!o.has(r);){o.add(r);const a=n.find(i=>i.id===r);if(!a||a.originCrackId.length===0||(s++,r=a.originCrackId[0],s>20))break}return s}}const $f=780,Ff=8,Gf=500,Og=80,Lg=.03;class Ng{constructor(t,n={},s=[]){Ye(this,"state");Ye(this,"listeners",new Set);Ye(this,"maxTime",Io);Ye(this,"lockStartTime",null);Ye(this,"lockResetCount",0);Ye(this,"usePhysicsForFalling",!1);Ye(this,"freezeTimer",!1);Ye(this,"freezeFalling",!1);Ye(this,"devOverrideNextGoop",null);Ye(this,"lastGoalSpawnTime",0);Ye(this,"lastComplicationCheckTime",0);Ye(this,"isFastDropping",!1);Ye(this,"wasFastDropping",!1);Ye(this,"lightsOverflarePhase","none");Ye(this,"lightsOverflareTime",0);Ye(this,"lightsFlickerTime",0);Ye(this,"lightsFlickerActive",!1);Ye(this,"lightsGracePausedAt",null);Ye(this,"initialTotalScore",0);Ye(this,"powerUps",{});Ye(this,"isSessionActive",!1);Ye(this,"isTrainingMode",!1);Ye(this,"maxPieceSize",null);Ye(this,"pendingTrainingPalette",null);Ye(this,"trainingAllowedControls",null);Ye(this,"trainingPressureRate",0);Ye(this,"trainingHighlightColor",null);Ye(this,"trainingPopLowersPressure",!1);Ye(this,"equippedActives",[]);Ye(this,"crackManager");Ye(this,"pendingTotalScore",null);this.initialTotalScore=t,this.powerUps=n,this.equippedActives=s;const r=gt(t).rank,a=Rn(r).length+r;this.state={grid:vf(r,n),tankRotation:0,activeGoop:null,storedGoop:null,nextGoop:null,shiftScore:0,gameOver:!1,isPaused:!1,canSwap:!0,level:1,cellsCleared:0,popStreak:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:Io,scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},gameStats:{startTime:0,totalBonusTime:0,maxGroupSize:0},floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:a,phase:qe.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Oe.LIGHTS]:0,[Oe.CONTROLS]:0,[Oe.LASER]:0},activeCharges:{},crackGoopPopped:0,colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.applyUpgrades(),this.crackManager=new _g}randomThreshold(){return Math.floor(Math.random()*13)+12}hasAdjacentWild(t,n){for(const s of n.cells){const r=Ve(n.x+s.x),o=Math.floor(n.y+s.y);if(o<0||o>=De)continue;const a=[{x:Ve(r+1),y:o},{x:Ve(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}];for(const i of a)if(i.y>=0&&i.y<De){const c=t[i.y][i.x];if(c!=null&&c.isWild)return!0}}return!1}execute(t){t.execute(this)}applyUpgrades(){let t=Io;const n=this.powerUps.PRESSURE_CONTROL||0;if(n>0){const s=n*5*1e3;t+=s}this.maxTime=t,this.state.gameStats.startTime===0&&(this.state.shiftTime=this.maxTime)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emitChange(){this.listeners.forEach(t=>t())}syncTotalScore(t){this.state.gameOver?this.pendingTotalScore=t:(this.initialTotalScore=t,this.pendingTotalScore=null)}startRun(){this.isTrainingMode=!1,this.maxPieceSize=null;const t=gt(this.initialTotalScore).rank,n=Rn(t),s=n.length+t,r=n[Math.floor(Math.random()*n.length)],o=Math.random()<Dl,a=o?Jo:bs,i=Math.floor(Math.random()*a.length),c=this.maybeApplyMirror({...a[i]}),u=!o&&t>=20&&Math.random()<.25;let f;if(u){const w=n.filter(x=>x!==r),m=w[Math.floor(Math.random()*w.length)],h={...c,color:r};f=Nf(h,r,m)}else f={...c,color:r,isCorrupted:o||void 0};const d=Math.random()<Dl,p=d?Jo:bs,y=Math.floor(Math.random()*p.length),v=this.maybeApplyMirror({...p[y]});this.state={...this.state,grid:vf(t,this.powerUps),tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...v,color:n[Math.floor(Math.random()*n.length)],isCorrupted:d||void 0},nextGoop:f,canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:this.maxTime,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:s,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:qe.TankScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Oe.LIGHTS]:0,[Oe.CONTROLS]:0,[Oe.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0;const k={};this.equippedActives.forEach(w=>{k[w]=0}),this.state.activeCharges=k,this.spawnNewPiece(),xe.emit(ae.GAME_START),xe.emit(ae.MUSIC_START),this.emitChange()}startTraining(t){this.isTrainingMode=!0,this.maxTime=Io,this.maxPieceSize=null;const n=Array(De).fill(null).map(()=>Array(je).fill(null)),s=t[Math.floor(Math.random()*t.length)],r=bs,o=Math.floor(Math.random()*r.length),a=this.maybeApplyMirror({...r[o]}),i=t[Math.floor(Math.random()*t.length)],c=Math.floor(Math.random()*r.length),u=this.maybeApplyMirror({...r[c]});this.state={...this.state,grid:n,tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...u,color:i},nextGoop:{...a,color:s},canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:Io,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:0,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:qe.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Oe.LIGHTS]:0,[Oe.CONTROLS]:0,[Oe.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0,this.state.activeCharges={},xe.emit(ae.GAME_START),this.emitChange()}resetSession(){this.state.gameOver=!1,this.isSessionActive=!1,this.state.phase=qe.ConsoleScreen,this.state.shiftScore=0,this.state.activeGoop=null,this.pendingTotalScore!==null&&(this.initialTotalScore=this.pendingTotalScore,this.pendingTotalScore=null),this.emitChange()}abortRun(){!this.isSessionActive||this.state.gameOver||(this.state.shiftScore=0,this.state.goalsCleared=0,this.finalizeGame())}enterConsole(){this.state.phase=qe.ConsoleScreen,this.emitChange()}enterPeriscope(){this.pendingTrainingPalette&&this.state.isPaused||(this.state.gameOver?this.pendingTrainingPalette?(this.startTraining(this.pendingTrainingPalette),this.state.phase=qe.TankScreen):this.startRun():(this.state.phase=qe.TankScreen,this.isSessionActive||(this.pendingTrainingPalette?(this.startTraining(this.pendingTrainingPalette),this.state.phase=qe.TankScreen):this.startRun())),this.emitChange())}resolveComplication(t){this.state.gameOver||(Ys.resolveComplication(this.state,t,this.initialTotalScore,this.powerUps),this.state.phase=qe.ConsoleScreen,this.emitChange())}activateAbility(t){var s,r;if(this.state.gameOver)return;const n=Nn[t];if(!(!n||n.type!=="active"))switch(t){case"COOLDOWN_BOOSTER":{const o=this.powerUps[t]||1,i=[.25,.35,.5][Math.min(o,3)-1];Ys.extendAllCooldowns(this.state,i),console.log(`COOLDOWN_BOOSTER activated: +${i*100}% cooldown extension`);break}case"GOOP_DUMP":{const o=Rn(gt(this.initialTotalScore).rank),a=((s=this.state.activeGoop)==null?void 0:s.definition.color)||o[Math.floor(Math.random()*o.length)],i=this.powerUps[t]||1,c=Math.min(i,3),u=18,f=600,d=[];for(let p=0;p<c;p++)for(let y=0;y<u;y++)d.push({id:Math.random().toString(36).substr(2,9),color:a,x:Math.floor(Math.random()*je),y:-1,spawnDelay:p*f+y*Og});this.state.dumpQueue.push(...d),console.log(`GOOP_DUMP activated: ${c} wave(s), ${d.length} total ${a} pieces`);break}case"GOOP_COLORIZER":{const o=(r=this.state.activeGoop)==null?void 0:r.definition.color;if(!o){console.log("GOOP_COLORIZER: No active piece to match color");break}const a=this.powerUps[t]||1,c=[6,7,8][Math.min(a,3)-1];this.state.colorizerColor=o,this.state.colorizerRemaining=c,console.log(`GOOP_COLORIZER activated: next ${c} pieces will be ${o}`);break}case"CRACK_DOWN":{const a=1+(this.powerUps[t]||1)*2;this.state.crackDownRemaining=a;break}}}chargeActiveAbilities(t){Object.keys(this.state.activeCharges).forEach(n=>{const s=this.state.activeCharges[n]||0;this.state.activeCharges[n]=Math.min(100,s+t)})}checkComplications(t){const{spawned:n,newLastCheckTime:s}=Ys.checkComplications(this.state,this.initialTotalScore,this.lastComplicationCheckTime);this.lastComplicationCheckTime=s,n&&(Ys.spawnComplication(this.state,n),this.emitChange())}finalizeGame(){if(this.state.gameOver)return;this.state.gameOver=!0,this.isSessionActive=!1,this.state.phase=qe.ConsoleScreen;let t=0;for(let a=0;a<De;a++)for(let i=0;i<je;i++)this.state.grid[a][i]&&t++;const n=this.powerUps.AUTO_POPPER||0;if(n>0){const a=t,i=.2-n*.04;let c=0;for(let u=0;u<a;u++)Math.random()>i&&c++;t-=c,console.log(`AUTO_POPPER: ${c} of ${a} goop auto-popped (${t} remaining)`)}const s=t*50;this.state.gameStats.penalty=s,this.state.shiftScore=Math.max(0,this.state.shiftScore-s);const o=100*gt(this.initialTotalScore).rank;this.state.shiftScore=Math.max(o,this.state.shiftScore),this.state.complications=[],this.state.activeComplicationId=null,this.state.prePoppedGoopGroups.clear(),xe.emit(ae.GAME_OVER),this.emitChange()}getPiecePoolByZone(t){const s=(this.maxTime-this.state.shiftTime)/1e3,r=this.maxTime/3/1e3,o=!t&&Math.random()<Dl;return s<r?{pool:o?Jo:bs,isCorrupted:o}:s<r*2?{pool:o?tu:al,isCorrupted:o}:{pool:o?nu:cl,isCorrupted:o}}maybeApplyMirror(t){return Math.random()>=Ex||t.cells.every(s=>t.cells.some(r=>r.x===-s.x&&r.y===s.y))?t:{...t,cells:t.cells.map(s=>({x:-s.x,y:s.y}))}}spawnNewPiece(t,n,s){const r=n||this.state.grid,o=s!==void 0?s:this.state.tankRotation,a=this.initialTotalScore+this.state.shiftScore,i=gt(a).rank,c=Rn(i);let u=t;if(!u&&this.state.nextGoop){u=this.state.nextGoop;let y=c[Math.floor(Math.random()*c.length)];const v=this.powerUps.CRACK_MATCHER||0,k=this.state.crackCells.length>0?this.state.crackCells:this.state.goalMarks;if(v>0&&k.length>0){const P=k.reduce((S,T)=>T.y>S.y?T:S),R=v*.25;Math.random()<R&&(y=P.color)}let{pool:w,isCorrupted:m}=this.getPiecePoolByZone();if(this.maxPieceSize!==null){const P=w.filter(R=>R.cells.length<=this.maxPieceSize);P.length>0&&(w=P)}const h=Math.floor(Math.random()*w.length),x=this.maybeApplyMirror({...w[h]}),C=!m&&i>=20&&Math.random()<.25;let j;if(C){const P=c.filter(T=>T!==y),R=P[Math.floor(Math.random()*P.length)],S={...x,color:y};j=Nf(S,y,R)}else j={...x,color:y,isCorrupted:m||void 0};if(!m&&i>=40&&Math.random()<.15){const{pool:P}=this.getPiecePoolByZone(!0),R=Math.floor(Math.random()*P.length);j={...this.maybeApplyMirror({...P[R]}),color:tt.WILD,isWild:!0},console.log("Wild piece queued for next spawn")}this.state.nextGoop=j,this.devOverrideNextGoop&&(this.state.nextGoop={...this.devOverrideNextGoop})}const f=$y(u,i);this.state.colorizerRemaining>0&&this.state.colorizerColor&&(f.definition={...f.definition,color:this.state.colorizerColor,cellColors:void 0},this.state.colorizerRemaining--,this.state.nextGoop&&this.state.colorizerRemaining>0&&(this.state.nextGoop={...this.state.nextGoop,color:this.state.colorizerColor,cellColors:void 0}),console.log(`GOOP_COLORIZER: Spawned ${this.state.colorizerColor} piece (${this.state.colorizerRemaining} remaining)`),this.state.colorizerRemaining===0&&(this.state.colorizerColor=null));const d=Math.floor((rt-1)/2),p=this.isTrainingMode?nt-1:0;if(f.screenX=d,f.x=ec(d,o),f.y=p,f.startSpawnY=p,f.state=Fn.FALLING,this.lockStartTime=null,this.lockResetCount=0,ms(r,f)){if(this.isTrainingMode){xe.emit(ae.GAME_OVER);return}this.finalizeGame();return}this.state.activeGoop=f,this.state.canSwap=!0,this.emitChange()}updateScoreAndStats(t,n){this.state.shiftScore+=t,n&&(this.state.scoreBreakdown.base+=n.base||0,this.state.scoreBreakdown.height+=n.height||0,this.state.scoreBreakdown.offscreen+=n.offscreen||0,this.state.scoreBreakdown.adjacency+=n.adjacency||0,this.state.scoreBreakdown.speed+=n.speed||0)}handleGoals(t,n,s){tc.handleGoals(this.state,t,n,s,()=>this.emitChange())}tickTimer(t){if(this.isTrainingMode)return!this.freezeTimer&&this.trainingPressureRate>0&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*this.trainingPressureRate)),!0;const n=this.powerUps.FOCUS_MODE||0,r=this.state.phase===qe.COMPLICATION_MINIGAME&&n>0?1-n*.1:1;return!this.freezeTimer&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*r),this.state.shiftTime<=0)?(this.finalizeGame(),!1):!0}tickGoals(){const{crack:t,newLastSpawnTime:n}=tc.trySpawnCrack(this.state,this.state.grid,this.initialTotalScore,this.state.shiftTime,this.maxTime,this.lastGoalSpawnTime);this.lastGoalSpawnTime=n,t&&(console.log(`[CRACK] SPAWN id=${t.id} at (${t.x}, ${t.y}) color=${t.color} source="ENGINE-tickGoals" time=${new Date().toLocaleTimeString()} totalCracks=${this.state.crackCells.length+1} isTraining=${this.isTrainingMode}`),this.state.crackCells.push(t),this.state.goalMarks.push({id:t.id,x:t.x,y:t.y,color:t.color,spawnTime:t.spawnTime}))}tickHeat(t){const n=gt(this.initialTotalScore).rank,s=gs[Oe.CONTROLS];if(Wn(Oe.CONTROLS,n)&&this.state.controlsHeat>0){const r=Date.now(),o=this.state.rotationTimestamps.length>0?this.state.rotationTimestamps[this.state.rotationTimestamps.length-1]:0;if(r-o>s.idleThresholdMs){const i=this.powerUps.GEAR_LUBRICATION||0,c=s.dissipationBase*(1+s.dissipationUpgradeEffect*i);this.state.controlsHeat=Math.max(0,this.state.controlsHeat-c*t/1e3)}}}tickLightsBrightness(t){const n=gt(this.initialTotalScore).rank,s=gs[Oe.LIGHTS];if(!Wn(Oe.LIGHTS,n))return;if(this.state.phase!==qe.TankScreen){this.state.lightsGraceStart!==null&&this.lightsGracePausedAt===null&&(this.lightsGracePausedAt=Date.now());return}if(this.lightsGracePausedAt!==null&&this.state.lightsGraceStart!==null){const c=Date.now()-this.lightsGracePausedAt;this.state.lightsGraceStart+=c,this.lightsGracePausedAt=null}if(this.state.complications.some(c=>c.type===Oe.LIGHTS)){this.state.lightsBrightness=s.failedBrightness;return}const o=Date.now();this.isFastDropping&&!this.wasFastDropping&&(this.state.lightsGraceStart=null,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),!this.isFastDropping&&this.wasFastDropping&&(this.state.lightsGraceStart=o,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),this.wasFastDropping=this.isFastDropping;const a=this.powerUps.CIRCUIT_STABILIZER||0,i=(s.graceBaseSec+s.gracePerLevel*a)*1e3;if(this.isFastDropping){if(this.state.lightsBrightness<100){const c=s.recoverRate*t/1e3;this.state.lightsBrightness=Math.min(100,this.state.lightsBrightness+c),this.state.lightsBrightness>=100&&(this.lightsOverflarePhase="rising",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="rising"){this.lightsOverflareTime+=t;const c=Math.min(1,this.lightsOverflareTime/s.overflareUpMs);this.state.lightsBrightness=100+(s.overflarePeak-100)*c,c>=1&&(this.lightsOverflarePhase="falling",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="falling"){this.lightsOverflareTime+=t;const c=Math.min(1,this.lightsOverflareTime/s.overflareDownMs);this.state.lightsBrightness=s.overflarePeak-(s.overflarePeak-100)*c,c>=1&&(this.lightsOverflarePhase="none",this.state.lightsBrightness=100)}}else{this.state.lightsGraceStart===null&&(this.state.lightsGraceStart=o);const c=o-this.state.lightsGraceStart;if(c<i){if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1,this.state.lightsBrightness=100}}else if(c>=i&&!this.state.lightsFlickered)this.state.lightsFlickered=!0,this.lightsFlickerActive=!0,this.lightsFlickerTime=0,xe.emit(ae.LIGHTS_FLICKER,{});else if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1}else{const u=c-i,f=s.dimDurationSec*1e3,d=Math.min(1,u/f);this.state.lightsBrightness=100-(100-s.dimThreshold)*d,this.state.lightsBrightness<=s.dimThreshold&&(this.state.lightsBrightness=s.failedBrightness,Ys.spawnComplication(this.state,Oe.LIGHTS))}}}tickLooseGoop(t){if(this.state.looseGoop.length===0)return;const{active:n,landed:s}=zy(this.state.looseGoop,this.state.grid,t);if(s.length>0){xe.emit(ae.PIECE_DROPPED);const r=this.state.grid.map(i=>[...i]);let o=!1;const a=[];if(s.forEach(i=>{if(i.y>=0&&i.y<De){const c=Math.floor(i.y),u=this.state.goalMarks.find(d=>d.x===i.x&&d.y===c);let f=!1;u&&u.color===i.data.color&&(a.push(u.id),f=!0),r[c][i.x]={...i.data,timestamp:Date.now(),isSealingGoop:f},o=!0}}),o&&(this.state.grid=Gi(r)),a.length>0){const i=new Set(a);a.forEach(c=>{const u=this.state.crackCells.find(f=>f.id===c);u&&(u.originCrackId.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.branchCrackIds=d.branchCrackIds.filter(p=>p!==c))}),u.branchCrackIds.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.originCrackId=d.originCrackId.filter(p=>p!==c))}))}),this.state.crackCells=this.state.crackCells.filter(c=>!i.has(c.id)),this.state.goalMarks=this.state.goalMarks.filter(c=>!i.has(c.id)),xe.emit(ae.GOAL_CAPTURED,{count:a.length})}this.state.looseGoop=n}else this.state.looseGoop=n}tickDumpPieces(t){var a;const n=[];for(const i of this.state.dumpQueue)i.spawnDelay-=t,i.spawnDelay<=0?this.state.dumpPieces.push(i):n.push(i);if(this.state.dumpQueue=n,this.state.dumpPieces.length===0)return;const s=[],r=this.state.grid.map(i=>[...i]);let o=!1;for(const i of this.state.dumpPieces){i.y+=Lg*t;const c=Math.floor(i.y),u=i.x;let f=!1;(c>=De-1||c>=0&&((a=r[c+1])!=null&&a[u]))&&(f=!0),f&&c>=0&&c<De?(r[c][u]={id:i.id,goopGroupId:Math.random().toString(36).substr(2,9),timestamp:Date.now(),color:i.color,groupMinY:c,groupMaxY:c,groupSize:1},o=!0):f||s.push(i)}this.state.dumpPieces=s,o&&(this.state.grid=Gi(r))}tickActivePiece(t){if(!this.state.activeGoop||this.usePhysicsForFalling)return;const s=1+(this.powerUps.DENSE_GOOP||0)*.125,r=$f/s,o=this.isFastDropping?r/Ff:r,a=t/o,i=this.state.activeGoop.y+a,c=ec(this.state.activeGoop.screenX,this.state.tankRotation),u={...this.state.activeGoop,y:i,x:c};if(ms(this.state.grid,u,this.state.tankRotation)){this.lockStartTime===null&&(this.lockStartTime=Date.now());const f=Date.now()-this.lockStartTime,d=this.isFastDropping?50:Gf;(f>d||this.lockResetCount>=10)&&this.lockActivePiece()}else this.state.activeGoop=u,this.lockStartTime=null}lockActivePiece(){if(!this.state.activeGoop||this.state.gameOver)return;const t=T0(this.state.grid,this.state.activeGoop,this.state.tankRotation),n={...this.state.activeGoop,y:t};let{grid:s,consumedGoals:r,destroyedGoals:o}=Gy(this.state.grid,n,this.state.goalMarks);(n.definition.isWild||this.hasAdjacentWild(s,n))&&(s=By(s,n)),(r.length>0||o.length>0)&&this.handleGoals(r,o,n),this.state.complications.some(u=>u.type===Oe.LASER)||(this.state.laserCharge=Math.min(100,this.state.laserCharge+10)),xe.emit(ae.PIECE_DROPPED);const{grid:i,looseGoop:c}=b0(s);c.length>0&&this.state.looseGoop.push(...c),this.state.grid=i,this.isTrainingMode?(this.state.activeGoop=null,this.state.isPaused=!0,this.freezeFalling=!0,this.emitChange()):this.spawnNewPiece(void 0,i),this.state.popStreak=0,this.isFastDropping=!1}tickActiveCharges(t){Object.keys(this.state.activeCharges).length===0&&this.equippedActives.length>0&&this.equippedActives.forEach(s=>{this.state.activeCharges[s]=this.state.activeCharges[s]??0});const n={COOLDOWN_BOOSTER:100/20,GOOP_DUMP:100/15,GOOP_COLORIZER:100/25,CRACK_DOWN:100/30};Object.keys(this.state.activeCharges).forEach(s=>{const r=this.state.activeCharges[s]||0;if(r<100){const o=n[s]||3,a=t/1e3*o,i=Math.min(100,r+a);this.state.activeCharges[s]=i}})}getFallSpeed(){const n=1+(this.powerUps.DENSE_GOOP||0)*.125,s=30/$f*1e3*n;return this.isFastDropping?s*Ff:s}syncActivePieceFromPhysics(t,n){if(!(!this.state.activeGoop||this.state.gameOver))if(this.state.activeGoop.y=n,t){this.lockStartTime===null&&(this.lockStartTime=Date.now());const s=Date.now()-this.lockStartTime,r=this.isFastDropping?50:Gf;(s>r||this.lockResetCount>=10)&&this.lockActivePiece()}else this.lockStartTime=null}tick(t){!this.isSessionActive||this.state.gameOver||this.state.isPaused||this.tickTimer(t)&&(this.isTrainingMode||(this.tickGoals(),this.crackManager.tickGrowth(this.state,this.initialTotalScore,this.powerUps,this.maxTime),this.checkComplications(t),this.tickHeat(t),this.tickLightsBrightness(t),this.tickDumpPieces(t),this.tickActiveCharges(t)),this.tickLooseGoop(t),this.tickActivePiece(t),this.emitChange())}}const Bf=vn?25:16,Dg=(e,t,n,s=[],r)=>{const o=g.useRef(null);o.current||(o.current=new Ng(e,t,s));const a=o.current;if(a.equippedActives.length!==s.length||!a.equippedActives.every((p,y)=>p===s[y])){a.equippedActives=s;const p=a.state.activeCharges||{},y={};s.forEach(v=>{y[v]=p[v]??0}),a.state.activeCharges=y}const[,c]=g.useReducer(p=>p+1,0),u=g.useRef(0),f=g.useRef(0),d=g.useRef(0);return g.useEffect(()=>{a.syncTotalScore(e)},[e,a]),g.useEffect(()=>a.subscribe(()=>{if(a.state.gameOver){c();return}const y=performance.now();y-f.current>=Bf&&(f.current=y,c())}),[a]),g.useEffect(()=>{const p=y=>{u.current||(u.current=y);const v=y-u.current;if(vn&&v<Bf){d.current=requestAnimationFrame(p);return}u.current=y,a.tick(v),r&&r(v/1e3,a),d.current=requestAnimationFrame(p)};return d.current=requestAnimationFrame(p),()=>cancelAnimationFrame(d.current)},[a]),{engine:a,gameState:a.state}},$g=2.4;function Fg(){return{minX:Pn.x,maxX:Pn.x+rt*Et,minY:Pn.y,maxY:Pn.y+Bt*Et}}function Gg(e){const{enabled:t,params:n,bounds:s}=e,r=g.useRef([]),o=g.useRef([]),a=g.useRef([]),i=g.useRef(0),c=g.useRef({...Bi,...n}),u=g.useRef(s??Fg());g.useEffect(()=>{n&&(c.current={...Bi,...n})},[n==null?void 0:n.damping,n==null?void 0:n.stiffness,n==null?void 0:n.pressure,n==null?void 0:n.iterations,n==null?void 0:n.homeStiffness,n==null?void 0:n.innerHomeStiffness,n==null?void 0:n.returnSpeed,n==null?void 0:n.viscosity,n==null?void 0:n.gravity,n==null?void 0:n.fallingHomeStiffness,n==null?void 0:n.fallingReturnSpeed,n==null?void 0:n.fallingViscosity,n==null?void 0:n.fallingGravity,n==null?void 0:n.attractionRadius,n==null?void 0:n.attractionRestLength,n==null?void 0:n.attractionStiffness,n==null?void 0:n.goopiness,n==null?void 0:n.tendrilEndRadius,n==null?void 0:n.tendrilSkinniness,n==null?void 0:n.wallThickness,n==null?void 0:n.fallingGoopiness,n==null?void 0:n.fallingTendrilEndRadius,n==null?void 0:n.fallingTendrilSkinniness,n==null?void 0:n.dropletCount,n==null?void 0:n.dropletSpeed,n==null?void 0:n.dropletLifetime,n==null?void 0:n.dropletSize,n==null?void 0:n.dropletGravity]),g.useEffect(()=>{s&&(u.current=s)},[s]);const f=g.useCallback((C,j,P,R,S=0)=>{const T=fm(C,j,P,R,S);return r.current=[...r.current,T],T},[]),d=g.useCallback(C=>{r.current=r.current.filter(j=>j.id!==C)},[]),p=g.useCallback((C,j,P)=>{const R=r.current.find(S=>S.id===C);R&&(R.targetX=j,R.targetY=P)},[]),y=g.useCallback(C=>{const j=r.current.find(P=>P.id===C);j&&(j.isLocked=!0,j.isFalling=!1,j.isLoose=!1,j.fillAmount=0)},[]),v=g.useCallback((C,j)=>{if(!t)return;const P=r.current,R=c.current,S=P.length>0;if(j&&S)for(const M of P)M.isFalling&&!M.isLocked&&km(M,C,j.fallSpeed,j.grid,Bt,j.tankRotation);if(S){mm(P,C,R,u.current);for(const M of P)if(M.isLocked&&M.fillAmount<1&&!(j!=null&&j.isPaused)){const ee=1/(M.gridCells.length*go/1e3);M.fillAmount=Math.min(1,M.fillAmount+ee*C);const te=M.fillAmount>=1;te&&!M.wasFullLastFrame&&gm(M,$g),M.wasFullLastFrame=te}o.current=vm(P,o.current,R),Sm(P,o.current,R),Cm(P,Et)}const T=R.dropletGravity,E=u.current;for(const M of a.current)M.vel.y+=T*C,M.pos.x+=M.vel.x*C,M.pos.y+=M.vel.y*C,(M.pos.x+M.radius<E.minX||M.pos.x-M.radius>E.maxX)&&(M.lifetime=0),M.pos.y+M.radius<E.minY&&(M.lifetime=0),M.pos.y+M.radius>E.maxY&&(M.pos.y=E.maxY-M.radius,M.vel.y*=-.3),M.lifetime-=C,M.opacity=Math.max(0,M.lifetime/M.maxLifetime),M.radius*=.995;a.current=a.current.filter(M=>M.lifetime>0&&M.opacity>.01)},[t]),k=g.useCallback(()=>{r.current=[],o.current=[],a.current=[]},[]),w=g.useCallback(C=>{const j=c.current,P=C.targetX,R=C.targetY;for(let S=0;S<j.dropletCount;S++){const T=Math.floor(Math.random()*C.vertices.length),E=C.vertices[T],M=E.pos.x-P,U=E.pos.y-R,ee=Math.atan2(U,M)+(Math.random()-.5)*.8,te=j.dropletSpeed*(.5+Math.random()*.8),N={id:`droplet-${i.current++}`,pos:{x:E.pos.x,y:E.pos.y},vel:{x:Math.cos(ee)*te,y:Math.sin(ee)*te-50},radius:j.dropletSize*(.5+Math.random()*.7),color:C.color,opacity:1,lifetime:j.dropletLifetime*(.7+Math.random()*.6),maxLifetime:j.dropletLifetime};a.current.push(N)}},[]),m=g.useCallback(C=>r.current.find(j=>j.id===C),[]),h=g.useCallback(C=>{for(const j of r.current){const R=-(C-j.createdAtRotation)*Et;for(const S of j.vertices)S.pos.x+=R,S.oldPos.x+=R;for(const S of j.innerVertices)S.pos.x+=R,S.oldPos.x+=R;j.targetX+=R,j.createdAtRotation=C}},[]),x=g.useCallback(()=>{var R;const C=r.current.find(S=>S.isFalling&&!S.isLocked);if(!C)return null;let j=((R=C.gridCells[0])==null?void 0:R.y)??0;for(const S of C.gridCells)S.y<j&&(j=S.y);return{gridY:j+nt,isColliding:C.isColliding}},[]);return{blobs:r.current,attractionSprings:o.current,params:c.current,createBlob:f,removeBlob:d,updateBlobTarget:p,lockBlob:y,step:v,clearBlobs:k,getBlob:m,shiftBlobsForRotation:h,droplets:a.current,createDropletsForPop:w,getActivePieceState:x}}const Ur="";function zf(e){let t=e;return()=>(t=t*1664525+1013904223&4294967295,(t>>>0)/4294967295)}function Yf(e){return e.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")}function Hf(e){const t=e.match(/[^a-zA-Z0-9]+$/);return t?t[0]:""}function Wf(e){const t=e.match(/^[^a-zA-Z0-9]+/);return t?t[0]:""}const Bg=({fullText:e,keywords:t,revealed:n=!1,className:s="",visibleChars:r})=>{const o=g.useMemo(()=>{const u=t.map(y=>y.toLowerCase());if(e.includes("[")){const y=[],v=e.split(/\[([^\]]*)\]/);let k=0;for(let w=0;w<v.length;w++){const m=w%2===1,h=v[w];if(!h)continue;const x=h.split(/(\s+)/);for(const C of x){if(!C)continue;if(/^\s+$/.test(C)){y.push({isKeyword:!1,display:C,original:C,garbleLevel:"none"});continue}const j=Yf(C),P=Wf(C),R=Hf(C),S=!m&&u.includes(j.toLowerCase()),T=k++;if(n||S||!m){y.push({isKeyword:S,display:C,original:C,garbleLevel:"none"});continue}const E=zf(T*7919+31),M=j.split("").map(()=>Ur[Math.floor(E()*Ur.length)]).join("");y.push({isKeyword:!1,display:P+M+R,original:C,garbleLevel:"garbled"})}}return y}const d=e.split(/(\s+)/);let p=0;return d.map(y=>{if(/^\s+$/.test(y))return{isKeyword:!1,display:y,original:y,garbleLevel:"none"};const v=Yf(y),k=Wf(y),w=Hf(y),m=u.includes(v.toLowerCase()),h=p++;if(n||m)return{isKeyword:m,display:y,original:y,garbleLevel:"none"};const x=zf(h*7919+31),C=v.split("").map(()=>Ur[Math.floor(x()*Ur.length)]).join("");return{isKeyword:!1,display:k+C+w,original:y,garbleLevel:"garbled"}})},[e,t,n]),a=o.map(u=>u.display).join(""),i=r===void 0||r>=a.length;let c=0;return l.jsx("p",{className:`leading-relaxed ${s}`,children:o.map((u,f)=>{if(!i&&c>=r)return null;let d=u.display;if(!i){const y=r-c;d.length>y&&(d=d.slice(0,y))}if(c+=u.display.length,/^\s+$/.test(u.original))return l.jsx("span",{children:d},f);if(u.isKeyword)return l.jsx("span",{className:"text-green-400 font-semibold",children:d},f);const p=u.garbleLevel!=="none"?"text-slate-600":"text-slate-300";return l.jsx("span",{className:p,children:d},f)})})};const zg=1,Yg=35,Hg=({message:e,onDismiss:t,onComplete:n,position:s="top",className:r="",advanceType:o,canDismiss:a=!0,trainingProgress:i})=>{const[c,u]=g.useState(0),[f,d]=g.useState(!1),p=g.useRef(null),y=e.fullText.length;g.useEffect(()=>(p.current=setInterval(()=>{u(m=>{const h=m+zg;return h>=y?(p.current&&clearInterval(p.current),y):h})},Yg),()=>{p.current&&clearInterval(p.current)}),[y]),g.useEffect(()=>{c>=y&&d(!0)},[c,y]);const v=g.useCallback(()=>{f||(p.current&&clearInterval(p.current),u(y),d(!0))},[f,y]),k={top:"left-1/2 -translate-x-1/2",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",bottom:"bottom-12 left-1/2 -translate-x-1/2"},w=s==="top"?{top:"33%"}:{};return l.jsx("div",{className:`absolute ${k[s]} z-[90] ${r}`,style:{width:"min(calc(100vw - 24px), calc(100dvh * 0.5625 - 24px))",...w},onClick:v,onTouchStart:v,children:l.jsxs("div",{className:"bg-slate-900/95 border border-slate-700 rounded-sm shadow-lg shadow-black/50 overflow-hidden intercom-enter",children:[l.jsx("div",{className:"px-3 py-1.5 border-b border-slate-800 bg-slate-950/60",children:i?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"t-caption text-slate-400 leading-tight truncate",children:i.phaseName}),l.jsx("span",{className:"t-caption text-slate-500 leading-tight flex-shrink-0 ml-2",children:i.stepProgress})]}),l.jsx("div",{className:"flex items-center justify-center gap-1.5 mt-1",children:i.phaseDots.map(m=>l.jsx("span",{className:`intercom-phase-dot intercom-phase-dot--${m.status}`,title:`Phase ${m.phase}`},m.phase))})]}):l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"t-body text-slate-500 uppercase tracking-widest font-mono",children:"Intercom"}),l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 intercom-blink"})]})}),l.jsx("div",{className:"px-3 py-2.5 t-display text-slate-300",children:l.jsx(Bg,{fullText:e.fullText,keywords:e.keywords,visibleChars:c})}),f&&a&&l.jsx("div",{className:"px-3 py-3 border-t border-slate-800",children:o!=="tap"?l.jsx("button",{onClick:m=>{m.stopPropagation(),t()},className:"w-full h-12 flex items-center justify-center t-heading font-mono text-green-400 hover:text-green-300 border border-green-900 hover:border-green-700 rounded-sm transition-colors",children:""}):l.jsx("button",{onClick:m=>{m.stopPropagation(),n()},className:"w-full h-12 flex items-center justify-center t-heading font-mono text-green-400 hover:text-green-300 border border-green-900 hover:border-green-700 rounded-sm transition-colors",children:""})})]})})},Wg={},Ug=({activeStep:e,onComplete:t,onDismiss:n,highlightElement:s,messagePosition:r="center",advanceType:o,blockInteraction:a=!1,trainingProgress:i,canDismiss:c=!0})=>{const[u,f]=g.useState(null),[d,p]=g.useState(!1),y=g.useRef(null);if(g.useEffect(()=>(y.current&&(clearTimeout(y.current),y.current=null),e?(f(e),requestAnimationFrame(()=>p(!0))):u&&(p(!1),y.current=setTimeout(()=>{f(null)},150)),()=>{y.current&&clearTimeout(y.current)}),[e]),!u)return null;const v=s?Wg[s]??null:null,k=v?{clipPath:`polygon(
          0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%,
          ${v.left}% ${v.top}%,
          ${v.left}% ${v.bottom}%,
          ${v.right}% ${v.bottom}%,
          ${v.right}% ${v.top}%,
          ${v.left}% ${v.top}%
        )`}:void 0;return l.jsxs("div",{className:`absolute inset-0 z-[90] ${a?"pointer-events-auto":"pointer-events-none"}`,style:{transition:"opacity 150ms ease-out, background-color 150ms ease-out",opacity:d?1:0,backgroundColor:a?"rgba(0, 0, 0, 0.35)":"transparent"},children:[v&&l.jsx("div",{className:"absolute inset-0",style:{backgroundColor:"rgba(0, 0, 0, 0.4)",...k,transition:"clip-path 300ms ease-out"}}),l.jsx("div",{className:"pointer-events-auto",children:l.jsx(Hg,{message:u.message,onDismiss:n,onComplete:t,position:r,advanceType:o,trainingProgress:i,canDismiss:c})})]})},Xr=[{id:"WELCOME",rank:0,trigger:{type:"ON_GAME_START",rank:0},message:{keywords:["Welcome","operator"],fullText:"Welcome aboard, operator."},autoAdvanceMs:4e3},{id:"ROTATE_INTRO",rank:0,trigger:{type:"ON_GAME_START",rank:0},message:{keywords:["Swipe","rotate","tank"],fullText:"Swipe left or right to rotate the tank."},requiresAction:"ROTATE"}],Uf={A1_WELCOME:{keywords:["Operator","training","periscope"],fullText:"[Your] Operator training [begins now]. Drag [the] periscope down [to] start."},B1_GOOP_FALLS:{keywords:["goop","tank"],fullText:"[The] extruder drops goop into [the] tank."},B2_FAST_DROP:{keywords:["slow","Swipe","S","fast-drop"],fullText:"[Yeah.] It's slow. Swipe down or [press] S [to] fast-drop."},B3_ROTATION:{keywords:["Rotate","Q/E","tap","left/right","tank"],fullText:"Rotate [with] Q/E or tap [the] left/right [side of the] tank."},B4_PRACTICE:{keywords:[],fullText:"[Do it] again."},C1_PRESSURE:{keywords:["Pressure"],fullText:"Pressure [builds] over time."},C2_POP:{keywords:["Tap","goop","pressure","pop"],fullText:"Tap goop below [the] pressure [line] to pop [it]."},C3_MERGE_SOLIDIFY:{keywords:["goop","merges","Bigger","vent","set"],fullText:"Same-color goop merges. Bigger [blobs] vent more. [Fresh goop] needs a moment to set."},C4_PRACTICE_POP:{keywords:["Pop"],fullText:"Pop [it]."},D1_CRACK:{keywords:["Cracks","tank","goop","seal"],fullText:"Cracks [form in the] tank [wall]. Drop matching [color] goop [on them] to seal."},D2_TANK_ROTATION:{keywords:["Swipe","left/right","A/D","spin","tank"],fullText:"Swipe left/right [or] A/D [to] spin [the] tank."},D3_OFFSCREEN:{keywords:["tank","Cracks"],fullText:"[You] only see 1/3 [of the] tank. Cracks [can] spawn anywhere."},E1_SCAFFOLDING:{keywords:["Cracks","pressure","goop","reach"],fullText:"Cracks [spawn] higher as [the] pressure builds. Stack goop [to] reach [them]."},F1_GRADUATION:{keywords:["basics","goop","high"],fullText:"[That] covers [the] basics. Don't [let the] goop [pile] too high."}},Yl={PRESSURE_CAP:{keywords:["Swipe up","leave training"],fullText:"[I've] stopped [the] pressure [so you can] practice. Swipe up [to] leave training."},OVERFLOW:{keywords:["Swipe up","end"],fullText:"[You] overflowed [the] tank! Training [is] over. Swipe up [to] end."}},Xg={D2_RETRY:{keywords:["tank","goop","crack","Spin"],fullText:"Try again! Spin [the] tank [to] align [the] goop with [the] crack."}},Vg={A:"Enter the Tank",B:"Goop Basics",C:"Pressure & Popping",D:"Cracks & Sealing",E:"Scaffolding",F:"Graduation"},mr=[{id:"A1_WELCOME",phase:"A",name:"Welcome",teaches:"premise-and-entry",setup:{view:"console",pressureRate:0,highlightElement:"periscope",messagePosition:"top"},pauseGame:!0,advance:{type:"action",action:"drag-periscope"},markComplete:"WELCOME"},{id:"B1_GOOP_FALLS",phase:"B",name:"Goop Falls",teaches:"what-goop-is",setup:{view:"tank",spawnPiece:{color:tt.BLUE,shape:Ae.T_I,rotation:1,autoFall:!0},pressureRate:0,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1,pop:!1},advanceAtRow:8},pauseGame:!1,advance:{type:"event",event:"piece-landed"}},{id:"B2_FAST_DROP",phase:"B",name:"Fast-Drop",teaches:"fast-drop-input",setup:{pressureRate:0,allowedControls:{fastDrop:!0,rotate:!1,tankRotate:!1,pop:!1}},pauseGame:!1,advance:{type:"event",event:"piece-landed"}},{id:"B3_ROTATION",phase:"B",name:"Rotation",teaches:"piece-rotation-input",setup:{spawnPiece:{color:tt.YELLOW,shape:Ae.T_T},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:1200},pauseGame:!0,advance:{type:"event",event:"piece-landed"},markComplete:"DROP_INTRO"},{id:"B4_PRACTICE",phase:"B",name:"Practice",teaches:"practice-basics",setup:{spawnPiece:{color:tt.BLUE,shape:Ae.T_O},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1}},pauseGame:!0,advance:{type:"event",event:"piece-landed"}},{id:"C1_PRESSURE",phase:"C",name:"Pressure Rises",teaches:"pressure-concept",setup:{pressureRate:2.5,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1,pop:!1},advanceWhenPressureAbovePieces:!0,advancePressureAboveColor:tt.YELLOW,autoSkipMs:1e4},pauseGame:!0,advance:{type:"auto",delayMs:6e4}},{id:"C2_POP",phase:"C",name:"Pop",teaches:"how-to-pop",setup:{pressureRate:0,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1},highlightGoopColor:tt.YELLOW,reshowAfterMs:3e3,reshowNonDismissible:!0,popLowersPressure:!0},pauseGame:!1,advance:{type:"action",action:"pop-goop"}},{id:"C3_MERGE_SOLIDIFY",phase:"C",name:"Merge & Solidify",teaches:"merge-and-fill-timing",setup:{pressureRate:.3125,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:1500},pauseGame:!0,advance:{type:"tap"},markComplete:"POP_TIMING"},{id:"C4_PRACTICE_POP",phase:"C",name:"Practice Pop",teaches:"second-pop-rep",setup:{pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1},highlightGoopColor:tt.BLUE,messageDelay:2e3,popLowersPressure:!0},pauseGame:!1,advance:{type:"action",action:"pop-goop"}},{id:"D1_CRACK",phase:"D",name:"Crack Appears",teaches:"crack-sealing",setup:{spawnCrack:{color:tt.GREEN,placement:"near-stack",row:22},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:2500},pauseGame:!0,advance:{type:"tap"},markComplete:"CRACK_INTRO"},{id:"D2_TANK_ROTATION",phase:"D",name:"Tank Rotation",teaches:"tank-rotation-input",setup:{spawnPiece:{color:tt.GREEN,shape:Ae.T_O},pressureRate:.46875,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},showWhenPieceBelow:8,retryOnPieceLand:{retryMessageId:"D2_RETRY",spawnExtraCrack:{color:tt.GREEN,placement:"near-stack"}},popLowersPressure:!0},pauseGame:!0,advance:{type:"event",event:"crack-sealed"},markComplete:"ROTATE_INTRO"},{id:"D3_OFFSCREEN",phase:"D",name:"Offscreen Cracks",teaches:"cylindrical-awareness",setup:{spawnCrack:{color:tt.GREEN,placement:"near-stack"},pressureRate:.46875,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},showWhenCracksOffscreen:!0,autoSkipMs:15e3,popLowersPressure:!0},pauseGame:!0,advance:{type:"tap"},markComplete:"WRAP_INTRO"},{id:"E1_SCAFFOLDING",phase:"E",name:"Build Scaffolding",teaches:"scaffolding-strategy",setup:{spawnCrack:{color:tt.GREEN,placement:"at-pressure-line"},pressureRate:.46875,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},messagePosition:"top",continuousSpawn:!0,autoSkipMs:9e4,popLowersPressure:!0},pauseGame:!0,advance:{type:"event",event:"crack-sealed"}},{id:"F1_GRADUATION",phase:"F",name:"Graduation",teaches:"free-play",setup:{pressureRate:.5,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},messagePosition:"top",continuousSpawn:!0,pressureCap:.95,periodicCrackIntervalMs:2e4,popLowersPressure:!0},pauseGame:!0,advance:{type:"action",action:"swipe-up"},markComplete:"FIRST_SHIFT"}];function qg(e){return mr.find(t=>!e.includes(t.id))??null}function nc(e){return mr.every(t=>e.includes(t.id))}function Kg(e){return mr.filter(t=>t.phase===e)}const Zg=({rank:e,isSessionActive:t,saveData:n,setSaveData:s})=>{var y;const[r,o]=g.useState(()=>{var v;return{activeStep:null,completedSteps:((v=n.tutorialProgress)==null?void 0:v.completedSteps)??[],dismissed:!1}}),a=g.useRef(r.completedSteps);a.current=r.completedSteps;const i=r.activeStep?Xr.find(v=>v.id===r.activeStep)??null:null,c=g.useCallback(v=>r.completedSteps.includes(v),[r.completedSteps]),u=g.useCallback(v=>{a.current.includes(v.id)||o(k=>k.activeStep!==null||k.completedSteps.includes(v.id)?k:(xe.emit(ae.TUTORIAL_STEP_TRIGGERED,{stepId:v.id,message:v.message}),{...k,activeStep:v.id,dismissed:!1}))},[]),f=g.useCallback(()=>{o(v=>{if(!v.activeStep)return v;const k=v.activeStep,w=[...v.completedSteps,k];return xe.emit(ae.TUTORIAL_STEP_COMPLETED,{stepId:k}),s(m=>({...m,tutorialProgress:{completedSteps:w}})),{activeStep:null,completedSteps:w,dismissed:!1}})},[s]),d=g.useCallback(()=>{o(v=>v.activeStep?(xe.emit(ae.TUTORIAL_STEP_DISMISSED,{stepId:v.activeStep}),{...v,activeStep:null,dismissed:!0}):v)},[]),p=e===0&&!nc(((y=n.tutorialProgress)==null?void 0:y.completedSteps)??[]);return g.useEffect(()=>{if(p)return;const v=Xr.filter(k=>k.trigger.type==="ON_RANK_REACH"&&k.trigger.rank===e);for(const k of v)u(k)},[e,u,p]),g.useEffect(()=>{if(p||!t)return;const v=Xr.filter(k=>k.trigger.type==="ON_GAME_START"&&k.trigger.rank===e);for(const k of v)u(k)},[t,e,u,p]),g.useEffect(()=>{if(p)return;const k=Xr.filter(w=>w.trigger.type==="ON_EVENT").map(w=>{const m=w.trigger.event;return xe.on(m,()=>{u(w)})});return()=>{k.forEach(w=>w())}},[u,p]),{activeStep:i,completeStep:f,dismissStep:d,isStepCompleted:c,tutorialState:r}},Xf={"fast-fall":[ae.INPUT_FAST_DROP],"rotate-piece":[ae.PIECE_ROTATED],"pop-goop":[ae.GOOP_POPPED],"rotate-tank":[ae.INPUT_DRAG],"swipe-up":[ae.INPUT_SWIPE_UP],"piece-landed":[ae.PIECE_DROPPED],"goop-merged":[ae.PIECE_DROPPED],"crack-sealed":[ae.GOAL_CAPTURED],"game-over":[ae.GAME_OVER]},Qg=4e3,sc=[tt.BLUE,tt.YELLOW,tt.GREEN,tt.RED];function oc(e,t,n,s,r){const o=Date.now(),a=Math.random().toString(36).substr(2,9);console.log(`[CRACK] SPAWN id=${a} at (${t}, ${n}) color=${s} source="${r}" time=${new Date(o).toLocaleTimeString()} totalCracks=${e.state.crackCells.length+1}`),e.state.crackCells.push({id:a,x:t,y:n,color:s,originCrackId:[],branchCrackIds:[],lastGrowthCheck:o,crackBranchInterval:999999,spawnTime:o}),e.state.goalMarks.push({id:a,x:t,y:n,color:s,spawnTime:o})}function Jg(e,t){var r,o,a;const n=e.state.grid,s=e.state.tankRotation;if(t.placement==="near-stack"){const i=rt-3,c=Ve(s+i),u=t.row??De-2;return{x:c,y:u}}if(t.placement==="high"||t.placement==="at-pressure-line"){const i=e.maxTime??1,u=1+Math.max(0,1-e.state.shiftTime/i)*(Bt-1),f=Math.floor(De-u),d=1+Math.floor(Math.random()*3),p=Math.max(nt,Math.min(De-1,f+d));for(let y=0;y<30;y++){const v=2+Math.floor(Math.random()*(rt-4)),k=Ve(s+v);if(((r=n[p])==null?void 0:r[k])===null)return{x:k,y:p}}return null}if(t.placement==="offscreen"||t.placement==="high-offscreen"){const i=[];for(let c=0;c<je;c++)((c-s)%je+je)%je>=rt&&i.push(c);if(i.length>0){const c=t.placement==="high-offscreen"?{min:nt,max:nt+4}:{min:De-6,max:De-1};for(let u=0;u<30;u++){const f=i[Math.floor(Math.random()*i.length)],d=c.min+Math.floor(Math.random()*(c.max-c.min+1));if(((o=n[d])==null?void 0:o[f])===null)return{x:f,y:d}}}return null}for(let i=0;i<30;i++){const c=Math.floor(Math.random()*rt),u=Ve(s+c),f=De-5+Math.floor(Math.random()*3);if(f>=nt&&f<De&&((a=n[f])==null?void 0:a[u])===null)return{x:u,y:f}}return null}function Vf(e,t){const s=[...bs,...al,...cl].find(a=>a.type===t.shape);if(!s)return;let r=s.cells.map(a=>({...a}));if(t.rotation&&t.rotation>0)for(let a=0;a<t.rotation;a++)r=j0(r,!0);const o={type:t.shape,cells:r,color:t.color};e.spawnNewPiece(o)}function ev(e){var u;const t=e.state.tankRotation,n=sc[Math.floor(Math.random()*sc.length)],s=e.maxTime??1,r=Math.max(0,1-e.state.shiftTime/s),o=1+r*(Bt-1),a=Math.floor(De-o),i=1+Math.floor(Math.random()*3),c=Math.max(nt,Math.min(De-1,a+i));console.log(`[CRACK] PRESSURE DEBUG: psi=${(r*100).toFixed(1)}% shiftTime=${e.state.shiftTime.toFixed(1)} maxTime=${s} waterHeight=${o.toFixed(1)} pressureLine=row${a} offset=${i} spawnY=row${c}`);for(let f=0;f<20;f++){const d=Math.floor(Math.random()*rt),p=Ve(t+d),y=(u=e.state.grid[c])==null?void 0:u[p],v=e.state.crackCells.some(k=>k.x===p&&k.y===c);if(y===null&&!v){oc(e,p,c,n,"periodic-F1"),e.emitChange();return}}}function qf(e){const t=e.state.crackCells;if(t.length===0)return!1;const n=e.state.tankRotation;return t.some(s=>{let r=s.x-n;return r>je/2&&(r-=je),r<-je/2&&(r+=je),r<0||r>=rt})}const tv=({saveData:e,setSaveData:t,gameEngine:n,rank:s})=>{var ne,ve,Te;const r=((ne=e.tutorialProgress)==null?void 0:ne.completedSteps)??[],o=nc(r),a=s===0&&!o,i=a?qg(r):null,[c,u]=g.useState(!0),[f,d]=g.useState(!0),[p,y]=g.useState(null),v=g.useRef(!0),k=g.useRef(null),w=g.useRef(null),m=g.useRef(null),h=g.useRef(!1),x=g.useRef(null),C=g.useRef(null),j=g.useRef(null),P=g.useRef(null),R=g.useRef(!1),S=g.useRef(!1),T=g.useRef(!1),E=g.useRef(!1),M=g.useRef("none"),U=g.useRef(null),ee=g.useRef(r);ee.current=r,g.useEffect(()=>{var Y,H,W,me,ie,le,V,we,Ce,be,$e;if(console.log(`[STEP] === STEP CHANGE === ${(i==null?void 0:i.id)??"null"} (${(i==null?void 0:i.name)??""}) at ${new Date().toLocaleTimeString()}`),w.current&&(clearTimeout(w.current),w.current=null),x.current&&(clearInterval(x.current),x.current=null),k.current&&(clearTimeout(k.current),k.current=null),C.current&&(clearTimeout(C.current),C.current=null),j.current&&(j.current(),j.current=null),P.current&&(clearInterval(P.current),P.current=null),U.current&&(clearInterval(U.current),U.current=null),h.current=!1,d(!0),y(null),R.current=!1,E.current=!1,T.current=!1,M.current="none",!i)return;const pe=i.pauseGame!==!1&&(((Y=i.setup)==null?void 0:Y.pauseDelay)!=null||((H=i.setup)==null?void 0:H.showWhenPieceBelow)!=null||((W=i.setup)==null?void 0:W.showWhenCracksOffscreen));if(v.current=i.pauseGame===!1&&!pe,n&&n.isSessionActive&&(pe?(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange()):i.pauseGame!==!1?(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()):(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange()),(me=i.setup)!=null&&me.spawnPiece&&Vf(n,i.setup.spawnPiece),(ie=i.setup)!=null&&ie.spawnCrack)){n.state.crackCells.length>0&&console.log(`[CRACK] CLEAR ALL  ${n.state.crackCells.length} cracks removed before spawning for ${i.id}`),n.state.crackCells=[],n.state.goalMarks=[];const Fe=Jg(n,i.setup.spawnCrack);Fe&&(oc(n,Fe.x,Fe.y,i.setup.spawnCrack.color,`step-setup[${i.id}]`),n.emitChange())}const A=(le=i.setup)==null?void 0:le.showWhenPieceBelow;return A!=null&&n?(u(!1),x.current=setInterval(()=>{var Ee;(((Ee=n.state.activeGoop)==null?void 0:Ee.y)??0)>=A&&(u(!0),x.current&&(clearInterval(x.current),x.current=null),i.pauseGame!==!1&&(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()))},200)):(V=i.setup)!=null&&V.showWhenCracksOffscreen&&n?(u(!1),P.current=setInterval(()=>{qf(n)&&(P.current&&(clearInterval(P.current),P.current=null),T.current=!0,u(!0),i.pauseGame!==!1&&(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()))},200)):((we=i.setup)==null?void 0:we.pauseDelay)!=null?(u(!1),w.current=setTimeout(()=>{n&&n.isSessionActive&&(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()),u(!0),w.current=null},i.setup.pauseDelay)):i.pauseGame===!1?(Ce=i.setup)!=null&&Ce.messageDelay&&((be=i.setup)!=null&&be.showOnInput)?(u(!1),h.current=!0,w.current=setTimeout(()=>{h.current&&(u(!0),h.current=!1),w.current=null},i.setup.messageDelay)):($e=i.setup)!=null&&$e.messageDelay?(u(!1),w.current=setTimeout(()=>{u(!0),w.current=null},i.setup.messageDelay)):u(!0):(u(!1),w.current=setTimeout(()=>{u(!0),w.current=null},400)),()=>{w.current&&(clearTimeout(w.current),w.current=null),x.current&&(clearInterval(x.current),x.current=null),k.current&&(clearTimeout(k.current),k.current=null),C.current&&(clearTimeout(C.current),C.current=null),j.current&&(j.current(),j.current=null),P.current&&(clearInterval(P.current),P.current=null),U.current&&(clearInterval(U.current),U.current=null)}},[i==null?void 0:i.id]),g.useEffect(()=>{n&&(a?n.pendingTrainingPalette=sc:n.pendingTrainingPalette=null)},[n,a]);const te=g.useCallback(()=>{if(!i)return;const pe=i.id;t(A=>{var W;const Y=((W=A.tutorialProgress)==null?void 0:W.completedSteps)??[];if(Y.includes(pe))return A;const H=[...Y,pe];return i.markComplete&&!Y.includes(i.markComplete)&&H.push(i.markComplete),{...A,tutorialProgress:{completedSteps:H}}})},[i,t]),N=g.useCallback(()=>{if(n&&m.current){const pe=Date.now()-m.current,A=n.state.grid;for(let Y=0;Y<A.length;Y++)for(let H=0;H<A[Y].length;H++){const W=A[Y][H];W&&W.timestamp&&(W.timestamp+=pe)}m.current=null}},[n]),z=g.useCallback(()=>{if(!i)return;v.current=!1,N(),te(),n&&n.isSessionActive&&(n.state.isPaused=!0,n.freezeFalling=!0,n.emitChange());const pe=[...ee.current,i.id];i.markComplete&&pe.push(i.markComplete),nc(pe)&&(xe.emit(ae.TRAINING_SCENARIO_COMPLETE),n&&(n.pendingTrainingPalette=null))},[N,te,i,n]),Q=g.useRef(z);Q.current=z;const B=g.useCallback(()=>{var pe,A,Y,H,W,me;if(M.current==="pressure-cap"&&!E.current){if(u(!1),y(null),M.current="none",N(),n&&n.isSessionActive){n.state.isPaused=!1,n.freezeFalling=!1,((pe=i==null?void 0:i.setup)==null?void 0:pe.pressureRate)!=null&&(n.trainingPressureRate=i.setup.pressureRate),n.emitChange(),n.state.activeGoop||setTimeout(()=>{n.isSessionActive&&M.current==="none"&&(n.spawnNewPiece(),n.emitChange())},300);const ie=((A=i==null?void 0:i.setup)==null?void 0:A.pressureCap)??.95,le=setInterval(()=>{if(M.current!=="none"){clearInterval(le);return}const V=n.maxTime??1;(V>0?Math.max(0,1-n.state.shiftTime/V):0)>=ie&&(clearInterval(le),n.trainingPressureRate=0,n.emitChange(),M.current="pressure-cap",y(Yl.PRESSURE_CAP),u(!0),d(!0),v.current=!0,n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange())},250)}return}if(E.current){E.current=!1,y(null),u(!1),N(),n&&n.isSessionActive&&(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),(Y=i==null?void 0:i.setup)!=null&&Y.continuousSpawn&&!n.state.activeGoop&&setTimeout(()=>{n.isSessionActive&&!n.state.isPaused&&(n.spawnNewPiece(),n.emitChange())},300));return}if(u(!1),N(),n&&n.isSessionActive&&(n.state.isPaused=!1,n.freezeFalling=!1,((H=i==null?void 0:i.setup)==null?void 0:H.pressureRate)!=null&&(n.trainingPressureRate=i.setup.pressureRate),n.emitChange()),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{v.current=!0,k.current=null},150),(W=i==null?void 0:i.setup)!=null&&W.continuousSpawn&&n&&(setTimeout(()=>{n.isSessionActive&&M.current==="none"&&(n.spawnNewPiece(),n.emitChange())},300),i.setup.periodicCrackIntervalMs&&(console.log(`[CRACK] PERIODIC TIMER STARTED  interval=${i.setup.periodicCrackIntervalMs}ms step=${i.id}`),U.current&&clearInterval(U.current),U.current=setInterval(()=>{if(M.current!=="none"){console.log(`[CRACK] PERIODIC SKIPPED  f1Ending=${M.current}`);return}n.isSessionActive&&(console.log("[CRACK] PERIODIC TICK  spawning random crack"),ev(n))},i.setup.periodicCrackIntervalMs))),C.current&&clearTimeout(C.current),(me=i==null?void 0:i.setup)!=null&&me.reshowAfterMs){const ie=!!i.setup.reshowNonDismissible,le=i.setup.reshowAfterMs;C.current=setTimeout(()=>{v.current&&n&&n.isSessionActive&&(ie?(n.trainingPressureRate=0,n.emitChange(),u(!0),d(!1)):(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange(),u(!0),v.current=!1)),C.current=null},le)}},[N,n,i]);g.useEffect(()=>{var me,ie,le,V,we,Ce,be,$e,Fe,Ee;if(!i||!a)return;const{advance:pe}=i,A=[];if((me=i.setup)!=null&&me.showOnInput){const Re=()=>{h.current&&(u(!0),h.current=!1)};document.addEventListener("pointerdown",Re,!0),document.addEventListener("touchstart",Re,!0),document.addEventListener("keydown",Re,!0),A.push(()=>{document.removeEventListener("pointerdown",Re,!0),document.removeEventListener("touchstart",Re,!0),document.removeEventListener("keydown",Re,!0)})}if(((ie=i.setup)==null?void 0:ie.advanceAtRow)!=null&&n){const Re=i.setup.advanceAtRow,Pe=setInterval(()=>{var F;(((F=n.state.activeGoop)==null?void 0:F.y)??0)>=Re&&v.current&&(clearInterval(Pe),Q.current())},150);A.push(()=>clearInterval(Pe))}if(((le=i.setup)==null?void 0:le.reshowAtRow)!=null&&n){const Re=i.setup.reshowAtRow,Pe={current:!1};if(i.setup.reshowUntilAction){const F=Xf[i.setup.reshowUntilAction];if(F){const ye=F.map(ue=>xe.on(ue,()=>{Pe.current=!0}));A.push(()=>ye.forEach(ue=>ue()))}}const I=setInterval(()=>{if(Pe.current||n.isFastDropping){clearInterval(I);return}if(!n.state.activeGoop){clearInterval(I);return}(n.state.activeGoop.y??0)>=Re&&(clearInterval(I),n.state.isPaused=!0,n.freezeFalling=!0,n.emitChange(),u(!0),v.current=!1)},150);A.push(()=>clearInterval(I))}if(((V=i.setup)==null?void 0:V.advanceAtPressure)!=null&&n){const Re=i.setup.advanceAtPressure/100,Pe=setInterval(()=>{if(!v.current)return;const I=n.maxTime??1;(I>0?Math.max(0,1-n.state.shiftTime/I):0)>=Re&&(clearInterval(Pe),Q.current())},250);A.push(()=>clearInterval(Pe))}if((we=i.setup)!=null&&we.advanceWhenPressureAbovePieces&&n){const Re=setInterval(()=>{var D;if(!v.current)return;const Pe=n.maxTime??1,I=Pe>0?Math.max(0,1-n.state.shiftTime/Pe):0,F=De-1-I*(Bt-1),ye=((D=i.setup)==null?void 0:D.advancePressureAboveColor)??null;let ue=De;for(let L=0;L<De;L++){for(let G=0;G<n.state.grid[L].length;G++){const X=n.state.grid[L][G];if(X!==null&&(ye===null||X.color===ye)){ue=L;break}}if(ue<De)break}F<ue&&(clearInterval(Re),Q.current())},250);A.push(()=>clearInterval(Re))}if((Ce=i.setup)!=null&&Ce.retryOnPieceLand&&n){const Re=i.setup.retryOnPieceLand,Pe=xe.on(ae.GOAL_CAPTURED,()=>{R.current=!0});A.push(Pe);const I=xe.on(ae.PIECE_DROPPED,()=>{if(R.current){R.current=!1;return}setTimeout(()=>{n.state.activeGoop||(n.state.isPaused=!1,n.freezeFalling=!1,n.trainingPressureRate=0,n.emitChange(),setTimeout(()=>{n.freezeFalling=!0;const F=n.state.grid;for(let ye=0;ye<F.length;ye++)for(let ue=0;ue<F[ye].length;ue++){const D=F[ye][ue];D&&(n.state.poppedGoopGroupIds.add(D.goopGroupId),F[ye][ue]=null)}n.emitChange(),setTimeout(()=>{var ue;if(Re.spawnExtraCrack){const D=Re.spawnExtraCrack.color,L=n.state.tankRotation;for(let G=0;G<30;G++){const X=Math.floor(Math.random()*rt),re=Ve(L+X),ke=De-1-Math.floor(Math.random()*2);if(!n.state.crackCells.some(_=>_.x===re&&_.y===ke)){oc(n,re,ke,D,"retry-extra-crack");break}}}n.state.isPaused=!0,m.current=Date.now();const ye=Xg[Re.retryMessageId];ye&&y(ye),u(!0),v.current=!1,(ue=i.setup)!=null&&ue.spawnPiece&&Vf(n,i.setup.spawnPiece),n.emitChange(),R.current=!1},2e3)},2e3))},0)});A.push(I)}if((be=i.setup)!=null&&be.autoSkipMs){const Re=setTimeout(()=>{i.id==="D3_OFFSCREEN"&&!T.current&&(S.current=!0),Q.current()},i.setup.autoSkipMs);A.push(()=>clearTimeout(Re))}if(($e=i.setup)!=null&&$e.continuousSpawn&&n){const Re=xe.on(ae.PIECE_DROPPED,()=>{M.current==="none"&&setTimeout(()=>{n.state.activeGoop||(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),setTimeout(()=>{n.isSessionActive&&!n.state.isPaused&&!n.state.activeGoop&&(n.spawnNewPiece(),n.emitChange())},300))},0)});A.push(Re)}if(((Fe=i.setup)==null?void 0:Fe.pressureCap)!=null&&n){const Re=i.setup.pressureCap,Pe=setInterval(()=>{const I=n.maxTime??1,F=I>0?Math.max(0,1-n.state.shiftTime/I):0;F>=Re&&(clearInterval(Pe),n.trainingPressureRate=0,n.emitChange(),i.id==="F1_GRADUATION"&&M.current==="none"&&(console.log(`[F1] PRESSURE CAP reached (${(F*100).toFixed(1)}%)  showing ending message`),M.current="pressure-cap",y(Yl.PRESSURE_CAP),u(!0),d(!0),v.current=!0))},250);A.push(()=>clearInterval(Pe))}if(i.id==="F1_GRADUATION"&&n){const Re=()=>{M.current==="none"&&(console.log("[F1] OVERFLOW detected  showing ending message"),M.current="overflow",n.state.isPaused=!0,n.freezeFalling=!0,n.trainingPressureRate=0,n.emitChange(),y(Yl.OVERFLOW),u(!0),d(!1),v.current=!0)},Pe=xe.on(ae.GAME_OVER,Re);A.push(Pe)}const Y=["D2_TANK_ROTATION","E1_SCAFFOLDING","F1_GRADUATION"];if(!T.current&&n&&i.id!=="D3_OFFSCREEN"&&Y.includes(i.id)&&n.state.crackCells.length>0){const Re=setInterval(()=>{E.current||M.current==="none"&&(n.state.isPaused||qf(n)&&(clearInterval(Re),T.current=!0,S.current=!1,E.current=!0,y(Uf.D3_OFFSCREEN),u(!0),n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange(),t(Pe=>{var ye;const I=((ye=Pe.tutorialProgress)==null?void 0:ye.completedSteps)??[];if(I.includes("D3_OFFSCREEN"))return Pe;const F=[...I,"D3_OFFSCREEN"];return I.includes("WRAP_INTRO")||F.push("WRAP_INTRO"),{...Pe,tutorialProgress:{completedSteps:F}}})))},200);A.push(()=>clearInterval(Re))}if(pe.type==="tap")return A.length>0?()=>A.forEach(Re=>Re()):void 0;if(pe.type==="auto"){const Re=setTimeout(()=>{Q.current()},pe.delayMs);return A.push(()=>clearTimeout(Re)),()=>A.forEach(Pe=>Pe())}let H;if(pe.type==="action"){if(pe.action==="drag-periscope"){const Re=xe.on(ae.GAME_START,()=>{v.current&&Q.current()});return A.push(Re),()=>A.forEach(Pe=>Pe())}if(pe.action==="swipe-up"){const Re=xe.on(ae.INPUT_SWIPE_UP,()=>{v.current&&M.current!=="none"&&Q.current()});return A.push(Re),()=>A.forEach(Pe=>Pe())}H=pe.action}else pe.type==="event"&&(H=pe.event);const W=H?Xf[H]:void 0;if(W&&W.length>0){const Re=W.map(Pe=>xe.on(Pe,()=>{v.current&&Q.current()}));A.push(()=>Re.forEach(Pe=>Pe()))}else if(!((Ee=i.setup)!=null&&Ee.advanceAtRow)){const Re=setTimeout(()=>{Q.current()},Qg);A.push(()=>clearTimeout(Re))}return()=>A.forEach(Re=>Re())},[i==null?void 0:i.id,a]),g.useEffect(()=>{var pe;n&&(a&&((pe=i==null?void 0:i.setup)!=null&&pe.allowedControls)?n.trainingAllowedControls=i.setup.allowedControls:n.trainingAllowedControls=null)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>{var pe;n&&(a&&((pe=i==null?void 0:i.setup)==null?void 0:pe.pressureRate)!=null?n.trainingPressureRate=i.setup.pressureRate:n.trainingPressureRate=0)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>{var pe;n&&(a&&((pe=i==null?void 0:i.setup)!=null&&pe.highlightGoopColor)?n.trainingHighlightColor=i.setup.highlightGoopColor:n.trainingHighlightColor=null)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>{var pe;n&&(a&&((pe=i==null?void 0:i.setup)!=null&&pe.popLowersPressure)?n.trainingPopLowersPressure=!0:n.trainingPopLowersPressure=!1)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>xe.on(ae.TRAINING_SCENARIO_COMPLETE,()=>{n&&(n.isTrainingMode=!1,n.pendingTrainingPalette=null,n.trainingAllowedControls=null,n.trainingPressureRate=0,n.trainingHighlightColor=null,n.freezeFalling=!1,n.trainingPopLowersPressure=!1,n.state.crackCells=[],n.state.goalMarks=[],n.state.isPaused=!1,n.isSessionActive=!1,n.state.phase=qe.ConsoleScreen,n.emitChange(),t(A=>({...A,careerRank:1,careerScore:en(1)})))}),[n,t]);const Z=i&&c?{message:p??Uf[i.id]??{keywords:[],fullText:i.name}}:null,q=((ve=i==null?void 0:i.setup)==null?void 0:ve.messagePosition)??"center",oe=a&&((Te=i==null?void 0:i.setup)==null?void 0:Te.highlightGoopColor)||null;return{currentStep:i,isInTraining:a,isTrainingDone:o,completedStepIds:r,advanceStep:z,dismissMessage:B,trainingDisplayStep:Z,messagePosition:q,highlightColor:oe,canDismiss:f}},nv=({onExit:e,onRunComplete:t,initialTotalScore:n,powerUps:s={},scraps:r,settings:o,onOpenSettings:a,onOpenHelp:i,onOpenUpgrades:c,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,equippedActives:p=[],onToggleEquip:y,saveData:v,setSaveData:k})=>{var ce,it,lt,Rt;const[w,m]=g.useState(!1),[h,x]=g.useState(!1),[C,j]=g.useState(tt.RED),[P,R]=g.useState(!0),[S,T]=g.useState({...Bi}),[E,M]=g.useState(.2),[U,ee]=g.useState(!1),[te,N]=g.useState(5),[z,Q]=g.useState(40),[B,Z]=g.useState(-11),[q,oe]=g.useState(5),[ne,ve]=g.useState(40),[Te,pe]=g.useState(-11),A=Gg({enabled:!0,params:S}),Y=g.useCallback((he,fe)=>{if(fe.state.gameOver||!fe.isSessionActive)return;const Xe={grid:fe.state.grid,tankRotation:fe.state.tankRotation,fallSpeed:fe.freezeFalling?0:fe.getFallSpeed(),isPaused:fe.state.isPaused};A.step(he,Xe);const We=fe.state.activeGoop;if(We){const ze=`active-${We.spawnTimestamp}`,Ze=A.getBlob(ze);if(Ze&&Ze.isFalling&&!Ze.isLocked){const Qe=A.getActivePieceState();Qe&&fe.syncActivePieceFromPhysics(Qe.isColliding,Qe.gridY)}}},[A]),{engine:H,gameState:W}=Dg(n,s,t,p,Y);g.useEffect(()=>{H.usePhysicsForFalling=!vn},[H]);const me=g.useCallback(he=>{H.execute(new tg(he))},[H]),ie=g.useRef(new Set),le=g.useRef(0),V=g.useRef(0),we=g.useRef(null),Ce=g.useRef(!1),be=g.useRef(null),$e=g.useRef(null),Fe=250,Re=1500-((s==null?void 0:s.GOOP_SWAP)||0)*250,Pe=W.complications.find(he=>he.type===Oe.CONTROLS),I=g.useRef(0);g.useEffect(()=>{Pe||(I.current=0)},[Pe==null?void 0:Pe.id]);const F=o.invertRotation?-1:1;g.useEffect(()=>{if(W.gameOver&&W.phase===qe.ConsoleScreen){const he=W.goalsCleared>=W.goalsTarget;t({score:W.shiftScore,won:he})}},[W.gameOver]);const ye=g.useCallback(()=>{Ce.current=!1,we.current&&(cancelAnimationFrame(we.current),we.current=null)},[]),ue=g.useCallback(()=>{$e.current&&(clearInterval($e.current),$e.current=null),be.current=null,xe.emit(ae.INPUT_SWAP_HOLD,{progress:-1})},[]),D=g.useCallback(()=>{$e.current||(be.current=Date.now(),xe.emit(ae.INPUT_SWAP_HOLD,{progress:0}),$e.current=window.setInterval(()=>{if(!be.current)return;const he=Date.now()-be.current;if(he<Fe)return;const fe=he-Fe,Xe=Math.min(100,fe/Re*100);xe.emit(ae.INPUT_SWAP_HOLD,{progress:Xe}),Xe>=100&&(xe.emit(ae.INPUT_SWAP),ue())},16))},[ue]),L=g.useCallback(()=>{if(Ce.current)return;Ce.current=!0;const he=()=>{if(!Ce.current)return;const fe=Date.now(),Xe=Pe?200:100;if(fe>=V.current){let ze=0;(ie.current.has("ArrowLeft")||ie.current.has("KeyA"))&&(ze=1*F),(ie.current.has("ArrowRight")||ie.current.has("KeyD"))&&(ze=-1*F),le.current!==0&&(ze=le.current*F),ze!==0&&(Pe?(I.current++,I.current>=2&&(H.execute(new zr(ze)),I.current=0)):H.execute(new zr(ze)),V.current=fe+Xe)}(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||le.current!==0)&&W.phase===qe.TankScreen&&!H.state.isPaused&&H.isSessionActive?we.current=requestAnimationFrame(he):ye()};we.current=requestAnimationFrame(he)},[H,W.phase,ye,F,Pe]);g.useEffect(()=>{const he=We=>{if(!We.repeat){if(ie.current.add(We.code),We.key==="`"){We.preventDefault(),m(ze=>!ze);return}if(We.key==="~"){We.preventDefault(),x(ze=>!ze);return}if(We.key==="Backspace"&&W.phase===qe.TankScreen&&H.execute(new Hs(qe.ConsoleScreen)),W.gameOver){We.key==="Enter"&&H.resetSession();return}if(W.phase===qe.TankScreen&&!H.state.isPaused&&H.isSessionActive)switch(We.code){case"ArrowLeft":case"KeyA":H.execute(new zr(1*F)),V.current=Date.now()+250,L();break;case"ArrowRight":case"KeyD":H.execute(new zr(-1*F)),V.current=Date.now()+250,L();break;case"KeyQ":H.execute(new Oo(!1));break;case"KeyE":H.execute(new Oo(!0));break;case"KeyS":H.execute(new Fl(!0));break;case"Space":H.execute(new Hs(qe.ConsoleScreen));break;case"KeyW":H.execute(new Hs(qe.ConsoleScreen));break;case"KeyR":D();break}}},fe=We=>{if(ie.current.delete(We.code),W.phase===qe.TankScreen)switch(We.code){case"KeyS":H.execute(new Fl(!1));break;case"KeyR":ue();break;case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":!(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD"))&&le.current===0&&ye();break}},Xe=We=>{W.phase===qe.TankScreen&&!H.state.isPaused&&!W.gameOver&&H.isSessionActive&&(We.deltaY>0?H.execute(new Oo(!0)):H.execute(new Oo(!1)))};return window.addEventListener("keydown",he),window.addEventListener("keyup",fe),window.addEventListener("wheel",Xe),()=>{window.removeEventListener("keydown",he),window.removeEventListener("keyup",fe),window.removeEventListener("wheel",Xe),ye(),ue()}},[H,W.phase,W.gameOver,L,ye,D,ue,F]),g.useEffect(()=>{const he=xe.on(ae.INPUT_ROTATE,Qe=>{H.execute(new Oo((Qe==null?void 0:Qe.clockwise)??!0))}),fe=xe.on(ae.INPUT_DRAG,Qe=>{le.current=(Qe==null?void 0:Qe.direction)??0,(Qe==null?void 0:Qe.direction)!==0?L():ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||ye()}),Xe=xe.on(ae.INPUT_SWIPE_UP,()=>{H.execute(new Hs(qe.ConsoleScreen))}),We=xe.on(ae.INPUT_FAST_DROP,Qe=>{H.execute(new Fl((Qe==null?void 0:Qe.active)??!1))}),ze=xe.on(ae.INPUT_SWAP,()=>{H.execute(new Zm)}),Ze=xe.on(ae.INPUT_BLOCK_TAP,Qe=>{Qe&&H.execute(new Qm(Qe.x,Qe.y))});return()=>{he(),fe(),Xe(),We(),ze(),Ze()}},[H,L,ye]);const G=gt(n).rank,{activeStep:X,completeStep:re,dismissStep:ke}=Zg({rank:G,isSessionActive:H.isSessionActive,saveData:v,setSaveData:k}),{isInTraining:b,currentStep:_,completedStepIds:O,advanceStep:$,dismissMessage:K,trainingDisplayStep:se,messagePosition:de,highlightColor:ge,canDismiss:J}=tv({saveData:v,setSaveData:k,gameEngine:H,rank:G}),Ne=["A","B","C","D","E","F"],Me=b&&_?(()=>{const he=mr.findIndex(Xe=>Xe.id===_.id),fe=Ne.map(Xe=>{const ze=Kg(Xe).every(Qe=>O.includes(Qe.id)),Ze=_.phase===Xe;return{phase:Xe,status:ze?"complete":Ze?"current":"upcoming"}});return{phaseName:`Phase ${_.id.split("_")[0]}: ${Vg[_.phase]}`,stepProgress:`Step ${he+1} of ${mr.length}`,phaseDots:fe}})():void 0,Ge=(_==null?void 0:_.advance.type)==="tap",He=b?se:X,Be=()=>{},_e=b?J?Ge?$:K:Be:re,Je=b?J?Ge?$:K:Be:ke;return l.jsxs("div",{className:"w-full h-full relative touch-none bg-slate-950 overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0",children:l.jsx(wm,{state:W,rank:G,maxTime:H.maxTime,lightsBrightness:W.phase===qe.TankScreen?W.lightsBrightness:100,laserCharge:W.laserCharge,controlsHeat:W.controlsHeat,complicationCooldowns:W.complicationCooldowns,equippedActives:p,activeCharges:W.activeCharges,onActivateAbility:me,powerUps:s,storedGoop:H.state.storedGoop,nextGoop:H.state.nextGoop,softBodyPhysics:A,normalGoopOpacity:E,showVertexDebug:U,gooStdDev:te,gooAlphaMul:z,gooAlphaOff:B,fallingGooStdDev:q,fallingGooAlphaMul:ne,fallingGooAlphaOff:Te,trainingHighlightColor:ge,disableSwap:b,disablePop:b&&((it=(ce=_==null?void 0:_.setup)==null?void 0:ce.allowedControls)==null?void 0:it.pop)===!1})}),l.jsx("div",{className:`absolute inset-0 z-50 transition-opacity duration-500 ${W.phase===qe.ConsoleScreen?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:l.jsx(Mg,{engine:H,state:W,careerScore:n,scraps:r,powerUps:s,onOpenSettings:a,onOpenHelp:i,onOpenUpgrades:c,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,onDismissGameOver:()=>H.resetSession(),equippedActives:p,onToggleEquip:y,pulsePeriscope:((lt=_==null?void 0:_.setup)==null?void 0:lt.highlightElement)==="periscope"})}),l.jsx("div",{className:`absolute inset-0 z-20 pointer-events-none transition-opacity duration-500 ${W.phase===qe.TankScreen?"opacity-100":"opacity-0"}`,children:l.jsx(Ym,{state:W,onRestart:()=>H.execute(new Jm),onExit:()=>{xe.emit(ae.GAME_EXITED),H.execute(new Hs(qe.ConsoleScreen))},initialTotalScore:H.initialTotalScore,maxTime:H.maxTime})}),w&&!vn&&l.jsxs("div",{className:"absolute top-2 right-2 z-[100] bg-black/90 text-white p-3 rounded-lg t-meta font-mono pointer-events-auto overflow-y-auto",style:{minWidth:460,maxHeight:"95vh"},children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("span",{className:"font-bold",children:"Physics Debug"}),l.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-white",children:""})]}),l.jsxs("div",{className:"space-y-2 mb-2",children:[l.jsx("div",{className:"text-gray-400 t-meta uppercase tracking-wider",children:"Shared"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Damping: ",S.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:S.damping,onChange:he=>T(fe=>({...fe,damping:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Stiffness: ",S.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:S.stiffness,onChange:he=>T(fe=>({...fe,stiffness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Pressure: ",S.pressure]}),l.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:S.pressure,onChange:he=>T(fe=>({...fe,pressure:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Inner Home Stiffness: ",S.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:S.innerHomeStiffness,onChange:he=>T(fe=>({...fe,innerHomeStiffness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Iterations: ",S.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:S.iterations,onChange:he=>T(fe=>({...fe,iterations:Number(he.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-600",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-yellow-400 t-meta uppercase tracking-wider",children:"Locked"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Home Stiffness: ",S.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.homeStiffness,onChange:he=>T(fe=>({...fe,homeStiffness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Return Speed: ",S.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.returnSpeed,onChange:he=>T(fe=>({...fe,returnSpeed:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Viscosity: ",S.viscosity.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:S.viscosity,onChange:he=>T(fe=>({...fe,viscosity:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Gravity: ",S.gravity]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.gravity,onChange:he=>T(fe=>({...fe,gravity:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[l.jsx("div",{className:"text-gray-500 t-meta",children:"Goo Filter"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Blur: ",te]}),l.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:te,onChange:he=>N(Number(he.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Mul: ",z]}),l.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:z,onChange:he=>Q(Number(he.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Off: ",B]}),l.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:B,onChange:he=>Z(Number(he.target.value)),className:"w-full"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-cyan-400 t-meta uppercase tracking-wider",children:"Falling"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Home Stiffness: ",S.fallingHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingHomeStiffness,onChange:he=>T(fe=>({...fe,fallingHomeStiffness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Return Speed: ",S.fallingReturnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingReturnSpeed,onChange:he=>T(fe=>({...fe,fallingReturnSpeed:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Viscosity: ",S.fallingViscosity.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:S.fallingViscosity,onChange:he=>T(fe=>({...fe,fallingViscosity:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Gravity: ",S.fallingGravity]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.fallingGravity,onChange:he=>T(fe=>({...fe,fallingGravity:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[l.jsx("div",{className:"text-gray-500 t-meta",children:"Tendrils"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Goopiness: ",S.fallingGoopiness]}),l.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:S.fallingGoopiness,onChange:he=>T(fe=>({...fe,fallingGoopiness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["End Radius: ",S.fallingTendrilEndRadius]}),l.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:S.fallingTendrilEndRadius,onChange:he=>T(fe=>({...fe,fallingTendrilEndRadius:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Skinniness: ",S.fallingTendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingTendrilSkinniness,onChange:he=>T(fe=>({...fe,fallingTendrilSkinniness:Number(he.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[l.jsx("div",{className:"text-gray-500 t-meta",children:"Goo Filter"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Blur: ",q]}),l.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:q,onChange:he=>oe(Number(he.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Mul: ",ne]}),l.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:ne,onChange:he=>ve(Number(he.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Off: ",Te]}),l.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:Te,onChange:he=>pe(Number(he.target.value)),className:"w-full"})]})]})]})]}),l.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600 mt-2",children:[l.jsxs("div",{className:"pt-0",children:[l.jsx("div",{className:"text-gray-400 mb-1",children:"Attraction"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Radius: ",S.attractionRadius]}),l.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:S.attractionRadius,onChange:he=>T(fe=>({...fe,attractionRadius:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Rest Length: ",S.attractionRestLength]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.attractionRestLength,onChange:he=>T(fe=>({...fe,attractionRestLength:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Stiffness: ",S.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",value:S.attractionStiffness,onChange:he=>T(fe=>({...fe,attractionStiffness:Number(he.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[l.jsx("div",{className:"text-gray-400 mb-1",children:"Rendering"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Goopiness: ",S.goopiness]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.goopiness,onChange:he=>T(fe=>({...fe,goopiness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Tendril End Radius: ",S.tendrilEndRadius]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:S.tendrilEndRadius,onChange:he=>T(fe=>({...fe,tendrilEndRadius:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Tendril Skinniness: ",S.tendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.tendrilSkinniness,onChange:he=>T(fe=>({...fe,tendrilSkinniness:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Wall Thickness: ",S.wallThickness]}),l.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:S.wallThickness,onChange:he=>T(fe=>({...fe,wallThickness:Number(he.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[l.jsx("div",{className:"text-gray-400 mb-1",children:"Droplets (Pop Effect)"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Count: ",S.dropletCount]}),l.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:S.dropletCount,onChange:he=>T(fe=>({...fe,dropletCount:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Speed: ",S.dropletSpeed]}),l.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:S.dropletSpeed,onChange:he=>T(fe=>({...fe,dropletSpeed:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Lifetime: ",S.dropletLifetime,"s"]}),l.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:S.dropletLifetime,onChange:he=>T(fe=>({...fe,dropletLifetime:Number(he.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Size: ",S.dropletSize]}),l.jsx("input",{type:"range",min:"2",max:"30",step:"1",value:S.dropletSize,onChange:he=>T(fe=>({...fe,dropletSize:Number(he.target.value)})),className:"w-full"})]})]}),l.jsx("div",{className:"pt-2 border-t border-gray-600",children:l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Normal Goop Opacity: ",E.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:E,onChange:he=>M(Number(he.target.value)),className:"w-full"})]})}),l.jsxs("div",{className:"pt-2 border-t border-gray-600 text-gray-400",children:[l.jsxs("div",{children:["Blobs: ",A.blobs.length]}),l.jsxs("div",{className:"flex gap-1 mt-1",children:[l.jsx("button",{onClick:()=>{T({...Bi}),M(.25),ee(!1),N(8),Q(24),Z(-13),oe(8),ve(24),pe(-13)},className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded t-meta",children:"Reset to Defaults"}),l.jsx("button",{onClick:()=>{const he={...S,gooStdDev:te,gooAlphaMul:z,gooAlphaOff:B,fallingGooStdDev:q,fallingGooAlphaMul:ne,fallingGooAlphaOff:Te,normalGoopOpacity:E};console.log("=== DEBUG PARAMS SNAPSHOT ==="),console.log(JSON.stringify(he,null,2)),console.log("============================")},className:"px-2 py-1 bg-blue-700 hover:bg-blue-600 rounded t-meta",children:"Save"})]})]})]})]}),!1,h&&!vn&&(()=>{var ks,wo;const he=gt(n).rank,fe=Rn(he),Xe=[{key:"RED",hex:tt.RED},{key:"BLUE",hex:tt.BLUE},{key:"GREEN",hex:tt.GREEN},{key:"YELLOW",hex:tt.YELLOW},{key:"PURPLE",hex:tt.PURPLE},{key:"WHITE",hex:tt.WHITE},{key:"BLACK",hex:tt.BLACK}],We=36,ze=7,Ze=(ot,hn)=>{const Zn=Math.min(...ot.cells.map(Ot=>Ot.x)),V0=Math.max(...ot.cells.map(Ot=>Ot.x)),iu=Math.min(...ot.cells.map(Ot=>Ot.y)),q0=Math.max(...ot.cells.map(Ot=>Ot.y)),K0=V0-Zn+1,Z0=q0-iu+1,Q0=(We-K0*ze)/2,J0=(We-Z0*ze)/2;return l.jsx("div",{onClick:()=>{const Ot={...ot,color:C};H.state.nextGoop=Ot,P||(H.devOverrideNextGoop=Ot),H.emitChange()},style:{cursor:"pointer",borderRadius:4,border:"1px solid #334155",background:"rgba(30, 41, 59, 0.5)"},title:ot.type,onMouseEnter:Ot=>Ot.currentTarget.style.background="rgba(51, 65, 85, 0.8)",onMouseLeave:Ot=>Ot.currentTarget.style.background="rgba(30, 41, 59, 0.5)",children:l.jsx("svg",{width:We,height:We,children:ot.cells.map((Ot,eh)=>l.jsx("rect",{x:Q0+(Ot.x-Zn)*ze,y:J0+(Ot.y-iu)*ze,width:ze-1,height:ze-1,fill:C,rx:1},eh))})},hn)},Qe=[{label:"TETRA",normal:bs,corrupted:Jo},{label:"PENTA",normal:al,corrupted:tu},{label:"HEXA",normal:cl,corrupted:nu}];return l.jsxs("div",{className:"absolute top-2 left-2 z-[100] bg-black/90 text-white p-3 rounded-lg t-meta font-mono pointer-events-auto overflow-y-auto",style:{minWidth:280,maxHeight:"95vh"},children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("span",{className:"font-bold",children:"Piece Picker"}),l.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-white px-1",children:""})]}),l.jsxs("div",{className:"flex gap-3 mb-2 pb-2 border-b border-gray-700",children:[l.jsxs("div",{className:"text-gray-400",children:[l.jsx("span",{className:"t-meta uppercase tracking-wider",children:"Next:"})," ",l.jsx("span",{className:"text-gray-200",children:((ks=W.nextGoop)==null?void 0:ks.type)??""})]}),l.jsxs("div",{className:"text-gray-400",children:[l.jsx("span",{className:"t-meta uppercase tracking-wider",children:"Hold:"})," ",l.jsx("span",{className:"text-gray-200",children:((wo=W.storedGoop)==null?void 0:wo.type)??""})]})]}),l.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700",children:[l.jsx("div",{className:"t-meta uppercase tracking-wider text-gray-400 mb-1",children:"Color"}),l.jsx("div",{className:"flex gap-1.5",children:Xe.map(ot=>{const hn=fe.includes(ot.hex),Zn=C===ot.hex;return l.jsx("div",{onClick:()=>hn&&j(ot.hex),style:{width:24,height:24,borderRadius:"50%",background:ot.hex,opacity:hn?1:.3,cursor:hn?"pointer":"not-allowed",border:Zn?"3px solid #facc15":hn?"2px solid #475569":"2px dashed #334155",boxSizing:"border-box"},title:`${ot.key}${hn?"":" (locked)"}`},ot.key)})})]}),l.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700 space-y-1",children:[l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:P,onChange:ot=>{R(ot.target.checked),ot.target.checked&&(H.devOverrideNextGoop=null)}}),l.jsx("span",{children:"Random Pieces"})]}),l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:U,onChange:ot=>ee(ot.target.checked)}),l.jsx("span",{children:"Show Vertices"})]}),l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:H.freezeTimer,onChange:ot=>{H.freezeTimer=ot.target.checked}}),l.jsx("span",{children:"Freeze Timer"})]}),l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:H.freezeFalling,onChange:ot=>{H.freezeFalling=ot.target.checked}}),l.jsx("span",{children:"Freeze Falling"})]})]}),Qe.map(ot=>l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"t-meta uppercase tracking-wider text-cyan-400 mb-1",children:[ot.label,"  Normal"]}),l.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:ot.normal.map((hn,Zn)=>Ze(hn,Zn))}),l.jsxs("div",{className:"t-meta uppercase tracking-wider text-orange-400 mb-1",children:[ot.label,"  Corrupted"]}),l.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:ot.corrupted.map((hn,Zn)=>Ze(hn,Zn))})]},ot.label))]})})(),l.jsx(Ug,{activeStep:He,onComplete:_e,onDismiss:Je,highlightElement:(Rt=_==null?void 0:_.setup)==null?void 0:Rt.highlightElement,messagePosition:b?de:void 0,advanceType:b?Ge?"tap":"dismiss":void 0,blockInteraction:b&&(_==null?void 0:_.pauseGame)!==!1&&!!se&&J,trainingProgress:Me,canDismiss:b?J:!0})]})},sv=({onBack:e})=>l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[l.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[l.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-4",children:l.jsx("h2",{className:"t-title font-bold text-yellow-400 tracking-wider",children:"UPGRADES"})}),l.jsx("div",{className:"w-full max-w-md space-y-4 opacity-50 pointer-events-none",children:[1,2,3].map(t=>l.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center",children:l.jsx(ou,{className:"w-6 h-6 text-slate-600"})}),l.jsxs("div",{children:[l.jsxs("div",{className:"font-bold text-slate-300 t-body",children:["Locked Upgrade ",t]}),l.jsxs("div",{className:"t-body text-slate-500",children:["Requires Rank ",t*5]})]})]}),l.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded text-slate-500 t-body font-bold",children:"LOCKED"})]},t))}),l.jsx("div",{className:"mt-8 text-center text-slate-500 t-body",children:"Play more to unlock system upgrades."})]}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(ul,{className:"w-1/2 h-1/2 stroke-[3]"})})}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),ov=({settings:e,onUpdate:t,onBack:n})=>{g.useEffect(()=>{Tt.init(e)},[]);const s=(a,i)=>{t({...e,[a]:i})},r=({label:a,value:i,onChange:c,icon:u,colorClass:f})=>l.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex flex-col gap-3 transition-colors hover:border-slate-700",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(u,{className:`w-5 h-5 ${f}`}),l.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase t-body",children:a})]}),l.jsxs("span",{className:`font-bold t-body ${f}`,children:[i,"%"]})]}),l.jsxs("div",{className:"relative w-full h-6 flex items-center",children:[l.jsx("input",{type:"range",min:"0",max:"100",value:i,onChange:d=>c(Number(d.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-cyan-500 z-10",style:{background:`linear-gradient(to right, currentColor 0%, currentColor ${i}%, rgba(30, 41, 59, 1) ${i}%, rgba(30, 41, 59, 1) 100%)`}}),l.jsx("style",{children:`
              input[type=range]::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  height: 16px;
                  width: 16px;
                  border-radius: 50%;
                  background: #f1f5f9;
                  margin-top: -2px; /* align center */
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
              input[type=range]::-moz-range-thumb {
                  height: 16px;
                  width: 16px;
                  border: none;
                  border-radius: 50%;
                  background: #f1f5f9;
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
           `})]})]}),o=({label:a,value:i,onChange:c,icon:u,colorClass:f})=>l.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex items-center justify-between transition-colors hover:border-slate-700 cursor-pointer",onClick:()=>c(!i),children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(u,{className:`w-5 h-5 ${f}`}),l.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase t-body",children:a})]}),l.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${i?"bg-cyan-600":"bg-slate-700"}`,children:l.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform duration-300 ${i?"translate-x-6":"translate-x-0"}`})})]});return l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[l.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[l.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6",children:l.jsx("h2",{className:"t-title text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Config"})}),l.jsxs("div",{className:"w-full max-w-md space-y-4",children:[l.jsx(r,{label:"Master Output",value:e.masterVolume,onChange:a=>s("masterVolume",a),icon:Gm,colorClass:"text-cyan-400"}),l.jsx(r,{label:"Music Level",value:e.musicVolume,onChange:a=>s("musicVolume",a),icon:Om,colorClass:"text-purple-400"}),l.jsx(r,{label:"SFX Level",value:e.sfxVolume,onChange:a=>{s("sfxVolume",a)},icon:$m,colorClass:"text-green-400"}),l.jsx("div",{className:"h-px bg-slate-800 my-2"}),l.jsx(o,{label:"Invert Rotation",value:e.invertRotation||!1,onChange:a=>s("invertRotation",a),icon:Nm,colorClass:"text-yellow-400"})]}),l.jsx("div",{className:"mt-8 text-center text-slate-700 t-body uppercase tracking-widest font-bold",children:"Audio System v2.1  Initialized"})]}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:n,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(ul,{className:"w-1/2 h-1/2 stroke-[3]"})})}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},Hl=[{id:"BASICS",title:"THE OBJECTIVE",icon:"Gauge",unlockedBy:"ALWAYS",sections:[{heading:"PRESSURE SYSTEM",body:"The tank pressure climbs as goop accumulates. If pressure hits 100%, the system fails. Pop goop to vent pressure and buy time."},{heading:"POPPING BASICS",body:"Click or tap solid goop below the pressure line to pop it. Bigger groups vent more pressure. Keep the tank clear."},{heading:"YOUR OBJECTIVE",body:"Seal all cracks before the shift timer runs out. Cracks appear in the tank walls. Place matching-color goop on a crack, then pop it to seal."}]},{id:"CONTROLS",title:"CONTROLS",icon:"Keyboard",unlockedBy:"ROTATE_INTRO",sections:[{heading:"TANK ROTATION",body:"Swipe left/right or A/D keys to rotate the tank. The tank is a cylinder  it wraps all the way around."},{heading:"PIECE ROTATION",body:"Q / E keys or tap screen edges to rotate the falling piece."},{heading:"SOFT DROP",body:"S key or swipe down to make the piece fall faster."},{heading:"HOLD & SWAP",body:"R key to swap the falling piece with your held piece. One swap per drop."},{heading:"CONSOLE RETURN",body:"W or Space to return to the console view. Use this to fix complications."},{heading:"CLICK TO POP",body:"Click or tap solid goop below the pressure line. Groups of same-color goop pop together."}]},{id:"POPPING",title:"PURGING",icon:"Target",unlockedBy:"POP_TIMING",sections:[{heading:"WHAT CAN BE POPPED",body:"Only fully solid goop below the pressure line can be popped. Fresh goop needs time to solidify  watch it fill in."},{heading:"TIMING TENSION",body:"Let goop accumulate for bigger group pops and more points. But wait too long and pressure overwhelms you. Find the balance."},{heading:"MERGING",body:"Same-color goop touching each other merges into bigger blobs. Bigger pops vent more pressure and score more points."}]},{id:"SCORING",title:"SCORING",icon:"ArrowUpCircle",unlockedBy:"FIRST_SHIFT",sections:[{heading:"GROUP SIZE BONUS",body:"Larger groups of connected same-color goop score exponentially more. Two cells is good. Ten cells is great."},{heading:"ELEVATION BONUS",body:"Goop popped higher in the tank scores more. Build up, then pop from the top for maximum points."},{heading:"SHIFTS",body:"Each shift lasts 75 seconds. Seal all assigned cracks before time runs out."}]},{id:"CRACKS",title:"STRUCTURAL DAMAGE",icon:"AlertTriangle",unlockedBy:"CRACK_INTRO",sections:[{heading:"CRACKS SPREAD",body:"Cracks appear in the tank walls and grow over time. Left unchecked, they branch and spread across the surface."},{heading:"SEALING CRACKS",body:"Place matching-color goop on a crack and pop it. Sealed cracks give a massive pressure drop. This is the core of your job."}]},{id:"WRAPPING",title:"CYLINDER WRAP",icon:"RefreshCw",unlockedBy:"WRAP_INTRO",sections:[{heading:"THE TANK WRAPS",body:"The tank is a full cylinder. Goop on the left edge connects to goop on the right edge. Rotate all the way around to see everything."},{heading:"CROSS-SEAM CONNECTIONS",body:"Same-color goop touching across the seam forms one group. Plan wrapping pops for massive combos."}]},{id:"COMPLICATIONS_LIGHTS",title:"LIGHTS FAILURE",icon:"Lightbulb",unlockedBy:"COMPLICATION_LIGHTS",sections:[{heading:"LIGHTS SYSTEM",body:"Details on the lights complication system. (Operator notes pending.)"}]},{id:"COMPLICATIONS_LASER",title:"LASER MALFUNCTION",icon:"Zap",unlockedBy:"COMPLICATION_LASER",sections:[{heading:"LASER SYSTEM",body:"Details on the laser complication system. (Operator notes pending.)"}]},{id:"COMPLICATIONS_CONTROLS",title:"CONTROLS LOCKOUT",icon:"Lock",unlockedBy:"COMPLICATION_CONTROLS",sections:[{heading:"CONTROLS SYSTEM",body:"Details on the controls complication system. (Operator notes pending.)"}]},{id:"UPGRADES",title:"UPGRADES",icon:"Wrench",unlockedBy:"UPGRADE_INTRO",sections:[{heading:"UPGRADE SYSTEM",body:"Details on the upgrade system. (Operator notes pending.)"}]},{id:"ABILITIES",title:"ACTIVE ABILITIES",icon:"Sparkles",unlockedBy:"ABILITY_INTRO",sections:[{heading:"ABILITIES",body:"Details on active abilities. (Operator notes pending.)"}]}];const rv={Gauge:Em,Keyboard:Im,Target:Fm,ArrowUpCircle:Mm,AlertTriangle:bm,RefreshCw:Lm,Lightbulb:_m,Zap:zm,Lock:ou,Wrench:Bm,Sparkles:Dm},iv=({completedSteps:e,onBack:t})=>{const n=g.useMemo(()=>{const i=new Set;for(const c of Hl)(c.unlockedBy==="ALWAYS"||e.includes(c.unlockedBy))&&i.add(c.id);return i},[e]),s=g.useMemo(()=>{const i=Hl.find(c=>n.has(c.id));return(i==null?void 0:i.id)??null},[n]),[r,o]=g.useState(s),a=i=>{n.has(i)&&o(c=>c===i?null:i)};return l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[l.jsx("div",{className:"w-full flex items-center justify-center pt-5 pb-3 flex-shrink-0",children:l.jsx("h2",{className:"t-title text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Operator Journal"})}),l.jsx("div",{className:"w-full flex-1 overflow-y-auto pb-28 px-3 space-y-1.5",children:Hl.map(i=>{const c=n.has(i.id),u=r===i.id,f=rv[i.icon];return l.jsxs("div",{children:[l.jsxs("button",{onClick:()=>a(i.id),disabled:!c,className:`
                      w-full flex items-center gap-3 px-4 py-3
                      rounded-lg border text-left transition-all
                      ${u?"bg-slate-800 border-green-600 text-slate-100":c?"bg-slate-900 border-slate-700 text-slate-400 hover:bg-slate-800 hover:text-slate-300":"bg-slate-900/50 border-slate-800 text-slate-600 cursor-not-allowed opacity-50"}
                    `,style:{minHeight:"48px"},children:[l.jsxs("div",{className:"relative flex-shrink-0",children:[f&&l.jsx(f,{className:`w-5 h-5 ${u?"text-green-400":c?"text-slate-500":"text-slate-700"}`}),!c&&l.jsx(ou,{className:"w-3 h-3 text-slate-600 absolute -bottom-1 -right-1"})]}),l.jsx("span",{className:"t-body flex-1 font-bold uppercase tracking-wider",children:c?i.title:"???"}),c&&l.jsx(Am,{className:`w-5 h-5 flex-shrink-0 transition-transform duration-200 ${u?"rotate-180 text-green-400":"text-slate-600"}`})]}),u&&c&&l.jsx("div",{className:"journal-page-enter mt-1.5 mb-2 space-y-3 pl-2 pr-1",children:i.sections.map((d,p)=>l.jsxs("div",{className:"bg-slate-900/80 p-4 rounded-xl border border-slate-800 backdrop-blur-sm",children:[l.jsx("h4",{className:"t-heading font-bold text-slate-200 uppercase tracking-wider mb-2",children:d.heading}),l.jsx("p",{className:"t-body text-slate-400 leading-relaxed",children:d.body})]},p))})]},i.id)})}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:t,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(ul,{className:"w-1/2 h-1/2 stroke-[3]"})})}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},zi="gooptris_save_v3",Kf="gooptris_save_v2",rc=()=>({careerRank:1,careerScore:0,scraps:0,powerUps:{},equippedActives:[],unlockedUpgrades:[],firstRunComplete:!1,milestonesReached:[],tutorialProgress:{completedSteps:[]},settings:{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1}}),lv=e=>{const t={...e};return"operatorXP"in t&&(t.careerScore=t.operatorXP,delete t.operatorXP),"operatorRank"in t&&(t.careerRank=t.operatorRank,delete t.operatorRank),t},av=()=>{try{let e=localStorage.getItem(zi);const t=rc();if(!e){const s=localStorage.getItem(Kf);if(s){const r=JSON.parse(s),o=lv(r);localStorage.setItem(zi,JSON.stringify(o)),localStorage.removeItem(Kf),e=JSON.stringify(o)}}if(!e)return t;const n=JSON.parse(e);return{...t,...n,settings:{...t.settings,...n.settings||{}},powerUps:{...t.powerUps,...n.powerUps||{}},tutorialProgress:{...t.tutorialProgress,...n.tutorialProgress||{}},equippedActives:n.equippedActives||t.equippedActives,unlockedUpgrades:n.unlockedUpgrades||t.unlockedUpgrades,milestonesReached:n.milestonesReached||t.milestonesReached}}catch(e){return console.error("Failed to load save data",e),rc()}},cv=e=>{try{localStorage.setItem(zi,JSON.stringify(e))}catch(t){console.error("Failed to save data",t)}},uv=()=>{const e=rc();try{localStorage.setItem(zi,JSON.stringify(e))}catch(t){console.error("Failed to wipe save data",t)}return e},fv=()=>{g.useEffect(()=>{const e=xe.on(ae.PIECE_MOVED,()=>Tt.playMove()),t=xe.on(ae.PIECE_ROTATED,()=>Tt.playRotate()),n=xe.on(ae.PIECE_DROPPED,()=>Tt.playDrop()),s=xe.on(ae.GOOP_POPPED,f=>{Tt.playPop((f==null?void 0:f.popStreak)||0)}),r=xe.on(ae.ACTION_REJECTED,()=>Tt.playReject()),o=xe.on(ae.GOAL_CAPTURED,f=>{Tt.playPop(10)}),a=xe.on(ae.GAME_OVER,()=>{Tt.playGameOver(),Tt.stopMusic()}),i=xe.on(ae.MUSIC_START,()=>Tt.startMusic()),c=xe.on(ae.MUSIC_STOP,()=>Tt.stopMusic()),u=xe.on(ae.GAME_RESUMED,()=>{Tt.resume(),Tt.startMusic()});return()=>{e(),t(),n(),s(),r(),o(),a(),i(),c(),u()}},[])},Zf={damping:.975,gravity:30,stiffness:20,pressure:2.5,iterations:3},Qf=40;function Jf(e,t){const n=[],s=[],r=[],o=Qf,a=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of a)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=E0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,centerX:e,centerY:t,radius:Qf*1.5}}function E0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function I0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function dv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function pv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function hv(e,t){const n=E0(e.vertices);if(n<1)return;const s=e.restArea/n,r=I0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function xv(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5)}function yv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function mv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=yv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=I0(s),i=e.createRadialGradient(a.x-20,a.y-20,0,a.x,a.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill(),e.fillStyle="#fff",e.font="10px monospace",e.fillText(String(c),u.pos.x-3,u.pos.y+3)}e.strokeStyle="rgba(52, 152, 219, 0.5)",e.lineWidth=1;for(const c of t.ringsprings)e.beginPath(),e.moveTo(s[c.a].pos.x,s[c.a].pos.y),e.lineTo(s[c.b].pos.x,s[c.b].pos.y),e.stroke();e.strokeStyle="rgba(155, 89, 182, 0.3)";for(const c of t.crossSprings)e.beginPath(),e.moveTo(s[c.a].pos.x,s[c.a].pos.y),e.lineTo(s[c.b].pos.x,s[c.b].pos.y),e.stroke();e.beginPath(),e.arc(a.x,a.y,5,0,Math.PI*2),e.fillStyle="#f39c12",e.fill()}}const Wl=500,Ul=400;function gv(){const e=g.useRef(null),t=g.useRef(Jf(Wl/2,Ul/3)),n=g.useRef(0),s=g.useRef(-1),r=g.useRef({active:!1,vertexIndex:-1}),[o,a]=g.useState(Zf),[i,c]=g.useState(!0),[u,f]=g.useState(0);g.useEffect(()=>{const m=e.current;if(!m)return;const h=m.getContext("2d");if(!h)return;let x=0,C=performance.now();const j=P=>{x++,P-C>1e3&&(f(x),x=0,C=P);const R=t.current;if(s.current>=0){const S=Math.min((P-s.current)/1e3,.033);dv(R,S,o);for(let T=0;T<o.iterations;T++)pv(R,o),hv(R,o);xv(R,m.width,m.height)}s.current=P,r.current.active&&r.current.vertexIndex>=0,h.fillStyle="#2c3e50",h.fillRect(0,0,m.width,m.height),h.fillStyle="#34495e",h.fillRect(0,m.height-10,m.width,10),mv(h,R,i),n.current=requestAnimationFrame(j)};return n.current=requestAnimationFrame(j),()=>{cancelAnimationFrame(n.current)}},[o,i]);const d=g.useCallback((m,h)=>{const x=t.current;if(!x)return-1;let C=1/0,j=-1;for(let P=0;P<x.vertices.length;P++){const R=x.vertices[P],S=R.pos.x-m,T=R.pos.y-h,E=Math.sqrt(S*S+T*T);E<C&&E<50&&(C=E,j=P)}return j},[]),p=g.useCallback(m=>{const h=e.current;if(!h)return;const x=h.getBoundingClientRect(),C=m.clientX-x.left,j=m.clientY-x.top,P=d(C,j);P>=0&&(r.current={active:!0,vertexIndex:P})},[d]),y=g.useCallback(m=>{if(!r.current.active)return;const h=e.current;if(!h)return;const x=t.current,C=h.getBoundingClientRect(),j=m.clientX-C.left,P=m.clientY-C.top,R=x.vertices[r.current.vertexIndex];R.pos.x=j,R.pos.y=P,R.oldPos.x=j,R.oldPos.y=P},[]),v=g.useCallback(()=>{r.current={active:!1,vertexIndex:-1}},[]),k=g.useCallback(()=>{t.current=Jf(Wl/2,Ul/3),s.current=-1},[]),w=g.useCallback(()=>{const m=t.current;for(const h of m.vertices)h.oldPos.x=h.pos.x+(Math.random()-.5)*30,h.oldPos.y=h.pos.y+(Math.random()-.5)*30},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-1: Soft Body Blob"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Click and drag vertices to poke the blob"}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Wl,height:Ul,onMouseDown:p,onMouseMove:y,onMouseUp:v,onMouseLeave:v,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"pointer"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[l.jsxs("span",{children:["FPS: ",u]}),l.jsx("span",{children:"Vertices: 10"})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Damping (velocity): ",o.damping.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.001",value:o.damping,onChange:m=>a(h=>({...h,damping:parseFloat(m.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Gravity: ",o.gravity]}),l.jsx("input",{type:"range",min:"-25",max:"50",step:"5",value:o.gravity,onChange:m=>a(h=>({...h,gravity:parseFloat(m.target.value)}))}),l.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"-25 = floats up, 0 = zero-g, 50 = gentle fall"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Stiffness (k): ",o.stiffness]}),l.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:o.stiffness,onChange:m=>a(h=>({...h,stiffness:parseFloat(m.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Pressure: ",o.pressure.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:o.pressure,onChange:m=>a(h=>({...h,pressure:parseFloat(m.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Constraint Iterations: ",o.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:o.iterations,onChange:m=>a(h=>({...h,iterations:parseInt(m.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:i,onChange:m=>c(m.target.checked)}),l.jsx("span",{children:"Show Debug (vertices, springs)"})]}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:w,style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Poke!"}),l.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset"})]}),l.jsx("button",{onClick:()=>a(Zf),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset Parameters"})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-1 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:"Verlet integration with position-based constraints"}),l.jsx("li",{children:"T-tetromino shape with 10 perimeter vertices"}),l.jsx("li",{children:"Ring springs (perimeter) + cross springs (structural)"}),l.jsx("li",{children:"Pressure force for volume preservation"}),l.jsx("li",{children:"Catmull-Rom to Bezier for smooth rendering"})]})]})]})}const ed={damping:.92,gravity:0,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.03},vv=40,Xl=500,Vl=400;function td(e,t){const n=[],s=[],r=[],o=vv,a=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of a)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=_0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t}}function _0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function O0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Sv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function Cv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,a=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=a*t.homeStiffness}}function kv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function wv(e,t){const n=_0(e.vertices);if(n<1)return;const s=e.restArea/n,r=O0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function Rv(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3)}function Pv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function jv(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let c=0;c<r;c++){const u=t.targetX+s[c].homeOffset.x,f=t.targetY+s[c].homeOffset.y;c===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Pv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=O0(s),i=e.createRadialGradient(a.x-20,a.y-20,0,a.x,a.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}e.strokeStyle="#f39c12",e.lineWidth=2,e.beginPath(),e.moveTo(t.targetX-10,t.targetY),e.lineTo(t.targetX+10,t.targetY),e.moveTo(t.targetX,t.targetY-10),e.lineTo(t.targetX,t.targetY+10),e.stroke()}}function Tv(){const e=g.useRef(null),t=g.useRef(td(Xl/2,Vl/2)),n=g.useRef(0),s=g.useRef(-1),[r,o]=g.useState(ed),[a,i]=g.useState(!0),[c,u]=g.useState(0),[f,d]=g.useState("cursor");g.useEffect(()=>{const w=e.current;if(!w)return;const m=w.getContext("2d");if(!m)return;let h=0,x=performance.now();const C=j=>{h++,j-x>1e3&&(u(h),h=0,x=j);const P=t.current;if(s.current>=0){const R=Math.min((j-s.current)/1e3,.033);Sv(P,R,r),Cv(P,r);for(let S=0;S<r.iterations;S++)kv(P,r),wv(P,r);Rv(P,w.width,w.height)}s.current=j,m.fillStyle="#2c3e50",m.fillRect(0,0,w.width,w.height),jv(m,P,a),m.fillStyle="rgba(255,255,255,0.5)",m.font="12px system-ui",m.fillText(f==="cursor"?"Move mouse to guide blob":"Click to set target",10,20),n.current=requestAnimationFrame(C)};return n.current=requestAnimationFrame(C),()=>cancelAnimationFrame(n.current)},[r,a,f]);const p=g.useCallback(w=>{if(f!=="cursor")return;const m=e.current;if(!m)return;const h=m.getBoundingClientRect(),x=w.clientX-h.left,C=w.clientY-h.top;t.current.targetX=x,t.current.targetY=C},[f]),y=g.useCallback(w=>{if(f!=="click")return;const m=e.current;if(!m)return;const h=m.getBoundingClientRect();t.current.targetX=w.clientX-h.left,t.current.targetY=w.clientY-h.top},[f]),v=g.useCallback(()=>{t.current=td(Xl/2,Vl/2),s.current=-1},[]),k=g.useCallback(()=>{const w=t.current;for(const m of w.vertices){const h=m.homeOffset.x,x=m.homeOffset.y;m.homeOffset.x=x,m.homeOffset.y=-h}},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-2: Blob Follows Cursor"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Testing two-layer architecture: render follows data"}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Xl,height:Vl,onMouseMove:p,onClick:y,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"crosshair"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[l.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:l.jsxs("span",{children:["FPS: ",c]})}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:()=>d("cursor"),style:{flex:1,padding:"8px",backgroundColor:f==="cursor"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Follow Cursor"}),l.jsx("button",{onClick:()=>d("click"),style:{flex:1,padding:"8px",backgroundColor:f==="click"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Click Target"})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Home Stiffness: ",r.homeStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.5",step:"0.01",value:r.homeStiffness,onChange:w=>o(m=>({...m,homeStiffness:parseFloat(w.target.value)}))}),l.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"Low = laggy/stretchy, High = snappy"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Damping: ",r.damping.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.005",value:r.damping,onChange:w=>o(m=>({...m,damping:parseFloat(w.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Stiffness: ",r.stiffness]}),l.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:r.stiffness,onChange:w=>o(m=>({...m,stiffness:parseFloat(w.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Iterations: ",r.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:r.iterations,onChange:w=>o(m=>({...m,iterations:parseInt(w.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:a,onChange:w=>i(w.target.checked)}),l.jsx("span",{children:"Show Debug (target, ghost)"})]}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Rotate 90"}),l.jsx("button",{onClick:v,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]}),l.jsx("button",{onClick:()=>o(ed),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Parameters"})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-2 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:"Test two-layer architecture (data layer drives render layer)"}),l.jsx("li",{children:"Blob follows cursor/click target with springy physics"}),l.jsx("li",{children:"Slow moves = smooth follow"}),l.jsx("li",{children:"Fast/jump moves = overshoot, bounce, settle"}),l.jsx("li",{children:"Tune homeStiffness for responsive but physical feel"})]})]})]})}const bv={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.18},Mv=40,ql=500,Kl=400;function nd(e,t){const n=[],s=[],r=[],o=Mv,a=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of a)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=L0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t,rotationCount:0}}function L0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function N0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Av(e){let t=0;for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=n.pos.x-s,a=n.pos.y-r;t+=Math.sqrt(o*o+a*a)}return t/e.vertices.length}function Ev(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Iv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,a=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=a*t.homeStiffness}}function _v(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function Ov(e,t){const n=L0(e.vertices);if(n<1)return;const s=e.restArea/n,r=N0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function Lv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Nv(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let c=0;c<r;c++){const u=t.targetX+s[c].homeOffset.x,f=t.targetY+s[c].homeOffset.y;c===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Lv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=N0(s),i=e.createRadialGradient(a.x-20,a.y-20,0,a.x,a.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n)for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Dv(){const e=g.useRef(null),t=g.useRef(nd(ql/2,Kl/2)),n=g.useRef(0),s=g.useRef(-1),r=g.useRef(0),[o,a]=g.useState(bv),[i,c]=g.useState(!0),[u,f]=g.useState(0),[d,p]=g.useState(0),[y,v]=g.useState(0),[k,w]=g.useState(!1),[m,h]=g.useState(500),[x,C]=g.useState(0);g.useEffect(()=>{const R=e.current;if(!R)return;const S=R.getContext("2d");if(!S)return;let T=0,E=performance.now();const M=U=>{T++,U-E>1e3&&(f(T),T=0,E=U);const ee=t.current;if(k&&U-r.current>m){for(const oe of ee.vertices){const ne=oe.homeOffset.x,ve=oe.homeOffset.y;oe.homeOffset.x=ve,oe.homeOffset.y=-ne}ee.rotationCount++,v(ee.rotationCount),r.current=U}if(s.current>=0){const oe=Math.min((U-s.current)/1e3,.033);Ev(ee,oe,o),Iv(ee,o);for(let ne=0;ne<o.iterations;ne++)_v(ee,o),Ov(ee,o)}s.current=U;const te=Av(ee);p(te),te>x&&C(te),S.fillStyle="#2c3e50",S.fillRect(0,0,R.width,R.height),Nv(S,ee,i);const N=150,z=20,Q=10,B=R.height-30;S.fillStyle="#34495e",S.fillRect(Q,B,N,z);const Z=Math.min(te/50,1),q=Z<.3?"#27ae60":Z<.7?"#f39c12":"#e74c3c";S.fillStyle=q,S.fillRect(Q,B,N*Z,z),S.strokeStyle="#fff",S.strokeRect(Q,B,N,z),S.fillStyle="#fff",S.font="12px system-ui",S.fillText(`Deviation: ${te.toFixed(1)}px`,Q+5,B+14),n.current=requestAnimationFrame(M)};return n.current=requestAnimationFrame(M),()=>cancelAnimationFrame(n.current)},[o,i,k,m,x]);const j=g.useCallback(()=>{const R=t.current;for(const S of R.vertices){const T=S.homeOffset.x,E=S.homeOffset.y;S.homeOffset.x=E,S.homeOffset.y=-T}R.rotationCount++,v(R.rotationCount)},[]),P=g.useCallback(()=>{t.current=nd(ql/2,Kl/2),s.current=-1,v(0),C(0)},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-3: Rotation Stress Test"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Spam rotate - does lag accumulate?"}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:ql,height:Kl,style:{border:"2px solid #34495e",borderRadius:"8px"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[l.jsxs("span",{children:["FPS: ",u]}),l.jsxs("span",{children:["Rotations: ",y]})]}),l.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c3e50",borderRadius:"4px",textAlign:"center"},children:[l.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[d.toFixed(1),"px"]}),l.jsx("div",{style:{fontSize:"12px",opacity:.7},children:"Current Deviation"}),l.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"5px"},children:["Peak: ",x.toFixed(1),"px"]})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsx("button",{onClick:j,style:{padding:"15px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"18px",fontWeight:"bold"},children:"ROTATE 90"}),l.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:k,onChange:R=>w(R.target.checked)}),l.jsx("span",{children:"Auto-rotate"})]}),l.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:m,onChange:R=>h(parseInt(R.target.value)),style:{flex:1},disabled:!k}),l.jsxs("span",{style:{fontSize:"12px",width:"50px"},children:[m,"ms"]})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Home Stiffness: ",o.homeStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.005",value:o.homeStiffness,onChange:R=>a(S=>({...S,homeStiffness:parseFloat(R.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Damping: ",o.damping.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:o.damping,onChange:R=>a(S=>({...S,damping:parseFloat(R.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:i,onChange:R=>c(R.target.checked)}),l.jsx("span",{children:"Show Debug"})]}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:()=>C(0),style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Peak"}),l.jsx("button",{onClick:P,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset All"})]})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-3 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:"Spam rotate button - observe deviation meter"}),l.jsx("li",{children:"Enable auto-rotate at various speeds"}),l.jsx("li",{children:"Watch for lag accumulation (peak deviation climbing)"}),l.jsx("li",{children:"Target: deviation stays bounded, recovers between rotations"}),l.jsx("li",{children:"Success = peak deviation stays under ~40px even with spam"})]})]})]})}const D0=30,Lo=600,No=450,$v={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.05,attractionRadius:D0,attractionRestLength:0,attractionStiffness:.02,breakDistance:60};function Vr(e,t,n,s){const r=[],o=[],a=[],i=[],c=D0;let u,f,d,p;const y=1.5,v=.3;s==="T"?(u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],p=[y,y,y,y,y,v,y,y,v,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]],d=[{center:{x:-1*c,y:-.5*c},vertices:[0,1,9]},{center:{x:0*c,y:-.5*c},vertices:[1,2,5,8]},{center:{x:1*c,y:-.5*c},vertices:[2,3,4,5]},{center:{x:0*c,y:.5*c},vertices:[5,6,7,8]}]):(u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],p=[y,y,v,v,y,y,y,y,y,y,y,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]],d=[{center:{x:-1*c,y:-.5*c},vertices:[0,1,2,11]},{center:{x:1*c,y:-.5*c},vertices:[3,4,5,6]},{center:{x:-1*c,y:.5*c},vertices:[9,10,11,2]},{center:{x:0*c,y:.5*c},vertices:[2,3,8,9]},{center:{x:1*c,y:.5*c},vertices:[3,6,7,8]}]);for(let m=0;m<u.length;m++){const h=u[m];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:p[m]})}const k=r.length;for(let m=0;m<k;m++){const h=(m+1)%k,x=r[h].pos.x-r[m].pos.x,C=r[h].pos.y-r[m].pos.y,j=Math.sqrt(x*x+C*C);o.push({a:m,b:h,restLength:j})}for(const[m,h]of f)if(m<k&&h<k){const x=r[h].pos.x-r[m].pos.x,C=r[h].pos.y-r[m].pos.y,j=Math.sqrt(x*x+C*C);a.push({a:m,b:h,restLength:j})}const w=$0(r);for(const m of d)i.push({center:m.center,vertexIndices:m.vertices});return{vertices:r,ringsprings:o,crossSprings:a,restArea:w,targetX:e,targetY:t,color:n,blocks:i}}function $0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function ru(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Fv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Gv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,a=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=a*t.homeStiffness}}function Bv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function zv(e,t){const n=$0(e.vertices);if(n<1)return;const s=e.restArea/n,r=ru(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function sd(e,t){return{x:e.targetX+t.center.x,y:e.targetY+t.center.y}}function Yv(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.breakDistance&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];for(const u of i.blocks)for(const f of c.blocks){const d=sd(i,u),p=sd(c,f),y=p.x-d.x,v=p.y-d.y;if(Math.sqrt(y*y+v*v)<n.attractionRadius*4)for(const w of u.vertexIndices)for(const m of f.vertexIndices){const h=`${o}-${w}-${a}-${m}`;if(r.has(h))continue;const x=i.vertices[w],C=c.vertices[m],j=C.pos.x-x.pos.x,P=C.pos.y-x.pos.y,R=Math.sqrt(j*j+P*P),S=n.attractionRadius*x.attractionRadius,T=n.attractionRadius*C.attractionRadius,E=S+T;R<E&&(s.push({blobA:o,vertA:w,blobB:a,vertB:m,restLength:n.attractionRestLength}),r.add(h))}}}return s}function Hv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),k=(f-o.restLength)*y*.5,w=c/f*k,m=u/f*k;a.pos.x+=w,a.pos.y+=m,i.pos.x-=w,i.pos.y-=m}}function Wv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Uv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Wv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=ru(s),i=e.createRadialGradient(a.x-15,a.y-15,0,a.x,a.y,60);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=2,e.stroke(),n)for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Xv(e,t,n){e.strokeStyle="#f39c12",e.lineWidth=2,e.setLineDash([4,4]);for(const s of n){const r=t[s.blobA].vertices[s.vertA],o=t[s.blobB].vertices[s.vertB];e.beginPath(),e.moveTo(r.pos.x,r.pos.y),e.lineTo(o.pos.x,o.pos.y),e.stroke()}e.setLineDash([])}function Vv(){const e=g.useRef(null),t=g.useRef([Vr(Lo/3,No/2,"#27ae60","T"),Vr(Lo*2/3,No/2,"#27ae60","U")]),n=g.useRef([]),s=g.useRef(0),r=g.useRef(-1),o=g.useRef(null),[a,i]=g.useState($v),[c,u]=g.useState(!0),[f,d]=g.useState(0),[p,y]=g.useState(0);g.useEffect(()=>{const x=e.current;if(!x)return;const C=x.getContext("2d");if(!C)return;let j=0,P=performance.now();const R=S=>{j++,S-P>1e3&&(d(j),j=0,P=S);const T=t.current;if(r.current>=0){const E=Math.min((S-r.current)/1e3,.033);n.current=Yv(T,n.current,a),y(n.current.length);for(let M=0;M<T.length;M++){const U=T[M];Fv(U,E,a);const ee=M===0?{...a,homeStiffness:.3}:a;Gv(U,ee);for(let te=0;te<a.iterations;te++)Bv(U,a),zv(U,a)}Hv(T,n.current,a)}if(r.current=S,C.fillStyle="#2c3e50",C.fillRect(0,0,x.width,x.height),c){C.lineWidth=1;for(const E of T)for(const M of E.vertices){const U=a.attractionRadius*M.attractionRadius,ee=M.attractionRadius>1;C.strokeStyle=ee?"rgba(243, 156, 18, 0.3)":"rgba(52, 152, 219, 0.3)",C.beginPath(),C.arc(M.pos.x,M.pos.y,U,0,Math.PI*2),C.stroke()}}c&&Xv(C,T,n.current);for(const E of T)Uv(C,E,c);C.fillStyle="rgba(255,255,255,0.5)",C.font="12px system-ui",C.fillText("Drag blobs to test attraction",10,20),s.current=requestAnimationFrame(R)};return s.current=requestAnimationFrame(R),()=>cancelAnimationFrame(s.current)},[a,c]);const v=g.useCallback(x=>{const C=e.current;if(!C)return;const j=C.getBoundingClientRect(),P=C.width/j.width,R=C.height/j.height,S=(x.clientX-j.left)*P,T=(x.clientY-j.top)*R,E=t.current[1],M=ru(E.vertices),U=S-M.x,ee=T-M.y;Math.sqrt(U*U+ee*ee)<150&&(o.current={blobIndex:1,offsetX:E.targetX-S,offsetY:E.targetY-T})},[]),k=g.useCallback(x=>{if(!o.current)return;const C=e.current;if(!C)return;const j=C.getBoundingClientRect(),P=C.width/j.width,R=C.height/j.height,S=(x.clientX-j.left)*P,T=(x.clientY-j.top)*R,E=t.current[o.current.blobIndex];E.targetX=S+o.current.offsetX,E.targetY=T+o.current.offsetY},[]),w=g.useCallback(()=>{o.current=null},[]),m=g.useCallback(()=>{t.current=[Vr(Lo/3,No/2,"#27ae60","T"),Vr(Lo*2/3,No/2,"#27ae60","U")],n.current=[],r.current=-1},[]),h=g.useCallback(x=>{const C=t.current[x];for(const j of C.vertices){const P=j.homeOffset.x,R=j.homeOffset.y;j.homeOffset.x=R,j.homeOffset.y=-P}for(const j of C.blocks){const P=j.center.x,R=j.center.y;j.center.x=R,j.center.y=-P}},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-4: Two Blobs Attraction"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:'Do vertex springs create the "reaching" effect?'}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Lo,height:No,onMouseDown:v,onMouseMove:k,onMouseUp:w,onMouseLeave:w,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"grab"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"280px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[l.jsxs("span",{children:["FPS: ",f]}),l.jsxs("span",{children:["Springs: ",p]})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsx("div",{style:{fontWeight:"bold",color:"#f39c12"},children:"Attraction Settings"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Attraction Radius: ",a.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:a.attractionRadius,onChange:x=>i(C=>({...C,attractionRadius:parseInt(x.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Rest Length: ",a.attractionRestLength,"px"]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:a.attractionRestLength,onChange:x=>i(C=>({...C,attractionRestLength:parseInt(x.target.value)}))}),l.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"0 = vertices touch"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Attraction Stiffness: ",a.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.1",step:"0.005",value:a.attractionStiffness,onChange:x=>i(C=>({...C,attractionStiffness:parseFloat(x.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Break Distance: ",a.breakDistance,"px"]}),l.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:a.breakDistance,onChange:x=>i(C=>({...C,breakDistance:parseInt(x.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsx("div",{style:{fontWeight:"bold",color:"#3498db"},children:"Blob Physics"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Home Stiffness: ",a.homeStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.01",value:a.homeStiffness,onChange:x=>i(C=>({...C,homeStiffness:parseFloat(x.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Damping: ",a.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:a.damping,onChange:x=>i(C=>({...C,damping:parseFloat(x.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:c,onChange:x=>u(x.target.checked)}),l.jsx("span",{children:"Show Debug (springs, radius)"})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:()=>h(0),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate T"}),l.jsx("button",{onClick:()=>h(1),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate U"})]}),l.jsx("button",{onClick:m,style:{padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"860px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-4 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:'Drag blobs close together - watch for "reaching" effect'}),l.jsx("li",{children:"Vertices should stretch toward each other before touching"}),l.jsx("li",{children:"Orange dashed lines = attraction springs forming"}),l.jsx("li",{children:"Drag apart - springs should break cleanly"}),l.jsx("li",{children:"Success = gummy/stretchy feel, NOT magnetic snap"})]})]})]})}const F0=30,qv=600,Kv=450,Zv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08},Zl={none:{enabled:!1,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6},subtle:{enabled:!0,stdDeviation:10,alphaMultiplier:20,alphaOffset:-8},medium:{enabled:!0,stdDeviation:15,alphaMultiplier:24,alphaOffset:-7},aggressive:{enabled:!0,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6}};function Qv(e,t){const n=[],s=[],r=F0*.45,o=8,a=12,i=[{x:-r,y:-r},{x:r,y:-r},{x:r,y:r},{x:-r,y:r}];for(let u=0;u<4;u++){const f=i[u],d={x:-Math.sign(f.x),y:-Math.sign(f.y)},p=f.x+d.x*o,y=f.y,v=f.x,k=f.y+d.y*o;u===0?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):u===1?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1}):u===2?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1})}for(let u=0;u<a;u++){const f=(u+1)%a,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:f,restLength:Math.sqrt(d*d+p*p)})}for(let u=0;u<a/2;u++){const f=(u+a/2)%a,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:Math.floor(f),restLength:Math.sqrt(d*d+p*p)})}let c=0;for(let u=0;u<a;u++){const f=(u+1)%a;c+=n[u].homeOffset.x*n[f].homeOffset.y,c-=n[f].homeOffset.x*n[u].homeOffset.y}return{vertices:n,springs:s,restArea:Math.abs(c)/2,centerOffset:{x:e,y:t}}}function od(e,t,n,s){const r=[],o=F0;let a;n==="T"?a=[{x:-o,y:-o*.5},{x:0,y:-o*.5},{x:o,y:-o*.5},{x:0,y:o*.5}]:a=[{x:-o,y:-o*.5},{x:o,y:-o*.5},{x:-o,y:o*.5},{x:0,y:o*.5},{x:o,y:o*.5}];for(const c of a){const u=Qv(c.x,c.y);r.push(u)}const i={blocks:r,targetX:e,targetY:t,rotation:0,color:s};return Jv(i),i}function Yi(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Jv(e){for(const t of e.blocks){const n=Yi(t.centerOffset.x,t.centerOffset.y,e.rotation),s=e.targetX+n.x,r=e.targetY+n.y;for(const o of t.vertices){const a=Yi(o.homeOffset.x,o.homeOffset.y,e.rotation),i=s+a.x,c=r+a.y;o.pos.x===0&&o.pos.y===0&&(o.pos={x:i,y:c},o.oldPos={x:i,y:c})}}}function e2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function t2(e,t,n){const s=Yi(t.centerOffset.x,t.centerOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const a of t.vertices){const i=Yi(a.homeOffset.x,a.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-a.pos.x,d=u-a.pos.y;a.pos.x+=f*n.homeStiffness,a.pos.y+=d*n.homeStiffness}}function n2(e,t){for(const n of e.springs){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function s2(e,t){const n=e.vertices.length;let s=0;for(let c=0;c<n;c++){const u=(c+1)%n;s+=e.vertices[c].pos.x*e.vertices[u].pos.y,s-=e.vertices[u].pos.x*e.vertices[c].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;let a=0,i=0;for(const c of e.vertices)a+=c.pos.x,i+=c.pos.y;a/=n,i/=n;for(const c of e.vertices){const u=c.pos.x-a,f=c.pos.y-i,d=Math.sqrt(u*u+f*f);d>1e-4&&(c.pos.x+=u/d*o,c.pos.y+=f/d*o)}}function o2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function r2(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],a=n[r],i=n[(r+1)%t],c=n[(r+2)%t],{cp1:u,cp2:f}=o2(o,a,i,c);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${i.x} ${i.y}`}return s+" Z"}function i2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef(null),o=g.useRef({x:0,y:0}),[a]=g.useState(Zv),[i,c]=g.useState(Zl.aggressive),[u,f]=g.useState("aggressive"),[,d]=g.useState({});g.useEffect(()=>{const h=[od(180,250,"T","#e74c3c"),od(380,250,"U","#e74c3c")];s.current=h},[]),g.useEffect(()=>{let h=!0;const x=C=>{if(h){n.current=C,h=!1,t.current=requestAnimationFrame(x);return}const j=Math.min((C-n.current)/1e3,.033);n.current=C;for(const P of s.current)for(const R of P.blocks){e2(R,a,j),t2(P,R,a);for(let S=0;S<a.iterations;S++)n2(R,a);s2(R,a)}d({}),t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[a]);const p=g.useCallback(h=>{const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),j=h.clientX-C.left,P=h.clientY-C.top;for(let R=0;R<s.current.length;R++){const S=s.current[R],T=j-S.targetX,E=P-S.targetY;if(T*T+E*E<80*80){r.current=R,o.current={x:T,y:E},h.target.setPointerCapture(h.pointerId);break}}},[]),y=g.useCallback(h=>{if(r.current===null)return;const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),j=h.clientX-C.left-o.current.x,P=h.clientY-C.top-o.current.y;s.current[r.current].targetX=j,s.current[r.current].targetY=P},[]),v=g.useCallback(()=>{r.current=null},[]),k=h=>{const x=s.current[h];x.rotation=(x.rotation+90)%360},w=h=>{const x=Zl[h];x&&(c(x),f(h))},m=()=>{const{alphaMultiplier:h,alphaOffset:x}=i;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${h} ${x}`};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5: Goo Filter Variations"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Drag pieces to overlap. Use Rotate buttons. Both pieces are same color for merge test."}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Zl).map(h=>l.jsx("button",{onClick:()=>w(h),style:{padding:"8px 16px",background:u===h?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:u===h?"bold":"normal"},children:h.charAt(0).toUpperCase()+h.slice(1)},h))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",i.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:i.stdDeviation,onChange:h=>{c(x=>({...x,stdDeviation:Number(h.target.value)})),f("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",i.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:i.alphaMultiplier,onChange:h=>{c(x=>({...x,alphaMultiplier:Number(h.target.value)})),f("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",i.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:i.alphaOffset,onChange:h=>{c(x=>({...x,alphaOffset:Number(h.target.value)})),f("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:i.enabled,onChange:h=>{c(x=>({...x,enabled:h.target.checked})),f(h.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>k(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>k(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"})]})]}),l.jsxs("svg",{ref:e,width:qv,height:Kv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:p,onPointerMove:y,onPointerUp:v,onPointerLeave:v,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:i.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:m(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:180,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T-tetromino"}),l.jsx("text",{x:380,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U-pentomino"}),l.jsx("g",{filter:i.enabled?"url(#goo-filter)":void 0,children:s.current.map((h,x)=>h.blocks.map((C,j)=>l.jsx("path",{d:r2(C.vertices),fill:h.color,stroke:h.color,strokeWidth:2},`${x}-${j}`)))}),s.current.map((h,x)=>l.jsx("circle",{cx:h.targetX,cy:h.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${x}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Goal:"})," Find filter settings where blocks within a piece merge smoothly, AND where two pieces overlap their blocks also merge into one membrane.",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Test:"})," Drag the T into the U's alcove. Rotate pieces. Watch how blocks merge visually."]})]})}const l2=30,a2=600,c2=450,u2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25},Ql={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function Jl(e,t,n,s){const r=[],o=[],a=[],i=l2;let c,u;const f=1.5,d=.3,p=1;let y;if(n==="T")c=[{x:-1.5*i,y:-1*i},{x:-.5*i,y:-1*i},{x:.5*i,y:-1*i},{x:1.5*i,y:-1*i},{x:1.5*i,y:0*i},{x:.5*i,y:0*i},{x:.5*i,y:1*i},{x:-.5*i,y:1*i},{x:-.5*i,y:0*i},{x:-1.5*i,y:0*i}],y=[f,p,p,f,p,d,f,f,d,p],u=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")c=[{x:-1.5*i,y:-1*i},{x:-.5*i,y:-1*i},{x:-.5*i,y:0*i},{x:.5*i,y:0*i},{x:.5*i,y:-1*i},{x:1.5*i,y:-1*i},{x:1.5*i,y:0*i},{x:1.5*i,y:1*i},{x:.5*i,y:1*i},{x:-.5*i,y:1*i},{x:-1.5*i,y:1*i},{x:-1.5*i,y:0*i}],y=[f,f,d,d,f,f,p,f,p,p,f,p],u=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else{const m=.08*i;c=[{x:-1.5*i,y:-1.5*i},{x:-.5*i,y:-1.5*i},{x:-.5*i,y:-.5*i},{x:-m,y:-.5*i},{x:-m,y:-.5*i+m},{x:-.5*i,y:-.5*i+m},{x:-.5*i,y:1.5*i},{x:.5*i,y:1.5*i},{x:.5*i,y:-.5*i+m},{x:m,y:-.5*i+m},{x:m,y:-.5*i},{x:.5*i,y:-.5*i},{x:.5*i,y:-1.5*i},{x:1.5*i,y:-1.5*i},{x:1.5*i,y:-.5*i},{x:.5*i+m,y:-.5*i},{x:.5*i+m,y:-.5*i-m},{x:-.5*i-m,y:-.5*i-m},{x:-.5*i-m,y:-.5*i},{x:-1.5*i,y:-.5*i}],y=[f,p,f,d,d,f,f,f,f,d,d,f,p,f,f,d,d,d,d,p],u=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}for(let m=0;m<c.length;m++){const h=c[m];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:y[m]})}const v=r.length;for(let m=0;m<v;m++){const h=(m+1)%v,x=r[h].homeOffset.x-r[m].homeOffset.x,C=r[h].homeOffset.y-r[m].homeOffset.y;o.push({a:m,b:h,restLength:Math.sqrt(x*x+C*C)})}for(const[m,h]of u){const x=r[h].homeOffset.x-r[m].homeOffset.x,C=r[h].homeOffset.y-r[m].homeOffset.y;a.push({a:m,b:h,restLength:Math.sqrt(x*x+C*C)})}let k=0;for(let m=0;m<v;m++){const h=(m+1)%v;k+=r[m].homeOffset.x*r[h].homeOffset.y,k-=r[h].homeOffset.x*r[m].homeOffset.y}const w=Math.abs(k)/2;return{vertices:r,ringsprings:o,crossSprings:a,restArea:w,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function f2(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function d2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function p2(e,t){for(const n of e.vertices){const s=f2(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.homeStiffness,n.pos.y+=i*t.homeStiffness}}function h2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function x2(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function y2(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function m2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;a.pos.x+=k,a.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function g2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function v2(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],a=n[r],i=n[(r+1)%t],c=n[(r+2)%t],{cp1:u,cp2:f}=g2(o,a,i,c);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${i.x} ${i.y}`}return s+" Z"}function S2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),a=g.useRef({x:0,y:0}),[i,c]=g.useState(u2),[u,f]=g.useState(Ql.medium),[d,p]=g.useState("medium"),[y,v]=g.useState(!1),[,k]=g.useState({});g.useEffect(()=>{const P=[Jl(120,250,"T","#e74c3c"),Jl(300,250,"U","#e74c3c"),Jl(480,250,"Corrupt","#e74c3c")];s.current=P},[]),g.useEffect(()=>{let P=!0;const R=S=>{if(P){n.current=S,P=!1,t.current=requestAnimationFrame(R);return}const T=Math.min((S-n.current)/1e3,.033);n.current=S;for(const E of s.current){d2(E,i,T),p2(E,i);for(let M=0;M<i.iterations;M++)h2(E,i);E.usePressure&&x2(E,i)}r.current=y2(s.current,r.current,i),m2(s.current,r.current,i),k({}),t.current=requestAnimationFrame(R)};return t.current=requestAnimationFrame(R),()=>cancelAnimationFrame(t.current)},[i]);const w=g.useCallback(P=>{const R=e.current;if(!R)return;const S=R.getBoundingClientRect(),T=P.clientX-S.left,E=P.clientY-S.top;for(let M=0;M<s.current.length;M++){const U=s.current[M],ee=T-U.targetX,te=E-U.targetY;if(ee*ee+te*te<80*80){o.current=M,a.current={x:ee,y:te},P.target.setPointerCapture(P.pointerId);break}}},[]),m=g.useCallback(P=>{if(o.current===null)return;const R=e.current;if(!R)return;const S=R.getBoundingClientRect(),T=P.clientX-S.left-a.current.x,E=P.clientY-S.top-a.current.y;s.current[o.current].targetX=T,s.current[o.current].targetY=E},[]),h=g.useCallback(()=>{o.current=null},[]),x=P=>{s.current[P].rotation=(s.current[P].rotation+90)%360},C=P=>{const R=Ql[P];R&&(f(R),p(P))},j=()=>{const{alphaMultiplier:P,alphaOffset:R}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${P} ${R}`};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5b: Single Perimeter Shapes"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Each shape is ONE continuous soft body (not composed of blocks). Same color for merge test."}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Ql).map(P=>l.jsx("button",{onClick:()=>C(P),style:{padding:"8px 16px",background:d===P?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===P?"bold":"normal"},children:P.charAt(0).toUpperCase()+P.slice(1)},P))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",u.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:P=>{f(R=>({...R,stdDeviation:Number(P.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:P=>{f(R=>({...R,alphaMultiplier:Number(P.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:P=>{f(R=>({...R,alphaOffset:Number(P.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:u.enabled,onChange:P=>{f(R=>({...R,enabled:P.target.checked})),p(P.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),l.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),l.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:P=>c(R=>({...R,goopiness:Number(P.target.value)})),style:{width:120}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance (mozzarella)"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:P=>c(R=>({...R,attractionRadius:Number(P.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"How close to connect"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:P=>c(R=>({...R,attractionStiffness:Number(P.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Pull force (10%-100%)"})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:l.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:y,onChange:P=>v(P.target.checked)}),l.jsx("span",{children:"Show Springs"})]})]}),l.jsxs("svg",{ref:e,width:a2,height:c2,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:w,onPointerMove:m,onPointerUp:h,onPointerLeave:h,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-5b",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),l.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),l.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),l.jsxs("g",{filter:u.enabled?"url(#goo-filter-5b)":void 0,children:[r.current.map((P,R)=>{var q,oe;const S=(q=s.current[P.blobA])==null?void 0:q.vertices[P.vertA],T=(oe=s.current[P.blobB])==null?void 0:oe.vertices[P.vertB];if(!S||!T)return null;const E=T.pos.x-S.pos.x,M=T.pos.y-S.pos.y,U=Math.sqrt(E*E+M*M),ee=Math.min(1,U/i.goopiness),te=8,N=4,z=te-(te-N)*ee,Q=z*1.5,B=Math.max(2,Math.ceil(U/Q)),Z=[];for(let ne=0;ne<=B;ne++){const ve=ne/B,Te=1-.3*Math.sin(ve*Math.PI),pe=z*Te;Z.push({cx:S.pos.x+E*ve,cy:S.pos.y+M*ve,r:Math.max(N*.5,pe)})}return l.jsx("g",{children:Z.map((ne,ve)=>l.jsx("circle",{cx:ne.cx,cy:ne.cy,r:ne.r,fill:"#e74c3c"},ve))},`tendril-${R}`)}),s.current.map((P,R)=>l.jsx("path",{d:v2(P.vertices),fill:P.color,stroke:P.color,strokeWidth:2},R))]}),y&&r.current.map((P,R)=>{var z,Q;const S=(z=s.current[P.blobA])==null?void 0:z.vertices[P.vertA],T=(Q=s.current[P.blobB])==null?void 0:Q.vertices[P.vertB];if(!S||!T)return null;const E=T.pos.x-S.pos.x,M=T.pos.y-S.pos.y,ee=Math.sqrt(E*E+M*M)/i.goopiness,te=Math.min(255,Math.floor(ee*255)),N=Math.max(0,255-Math.floor(ee*255));return l.jsx("line",{x1:S.pos.x,y1:S.pos.y,x2:T.pos.x,y2:T.pos.y,stroke:`rgb(${te},${N},100)`,strokeWidth:2,opacity:.7},`spring-${R}`)}),s.current.map((P,R)=>l.jsx("circle",{cx:P.targetX,cy:P.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${R}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-5b + Attraction:"}),' Single-perimeter shapes with physics-based attraction springs. When pieces get close, springs form. Pull them apart to see the "mozzarella pull" effect  they stretch until breaking at the Goopiness distance.',l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Goopiness:"}),' Controls how far the "mozzarella strings" stretch before snapping. Higher = longer stretchy connections when pulling apart.',l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Stiffness Ramp:"})," Attraction is weak (10%) at max distance (reaching effect) and strong (100%) when close (solid merge). This creates natural-looking goop behavior.",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Test:"})," Drag T into U's notch, let them merge, then slowly pull apart to see the stretching effect."]})]})}const C2=30,k2=600,w2=450,R2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ea={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function ta(e,t,n,s){const r=[],o=[],a=[],i=[],c=C2;let u,f;const d=1.5,p=.3,y=1;let v;if(n==="T")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],v=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],v=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*c;u=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-x,y:-.5*c},{x:-x,y:-.5*c+x},{x:-.5*c,y:-.5*c+x},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+x},{x,y:-.5*c+x},{x,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+x,y:-.5*c},{x:.5*c+x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c},{x:-1.5*c,y:-.5*c}],v=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*c,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:.5*c},{x:-.5*c,y:.5*c}],v=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c}],v=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:v[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const k=r.length;for(let x=0;x<k;x++){const C=(x+1)%k,j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;a.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}for(const[x,C]of f){const j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;i.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}let w=0;for(let x=0;x<k;x++){const C=(x+1)%k;w+=r[x].homeOffset.x*r[C].homeOffset.y,w-=r[C].homeOffset.x*r[x].homeOffset.y}const m=Math.abs(w)/2;let h;if(n==="Corrupt"){const x=.5*c;h=[{offsetX:-c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-c},{x,y:-c},{x,y:c},{x:-x,y:c}],outerVertexIndices:[5,8,7,6]}].map(j=>{const P=j.points.map(R=>{const S=e+j.offsetX+R.x,T=t+j.offsetY+R.y;return{pos:{x:S,y:T},oldPos:{x:S,y:T},homeOffset:{x:R.x,y:R.y}}});return{...j,vertices:P,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:a,crossSprings:i,restArea:m,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function qr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function P2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,a=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=a+10*n*n}}function j2(e,t){for(const n of e.vertices){const s=qr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.homeStiffness,n.pos.y+=i*t.homeStiffness}for(const n of e.innerVertices){const s=qr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.innerHomeStiffness,n.pos.y+=i*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=qr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const a of n.vertices){const i=qr(a.homeOffset.x,a.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-a.pos.x,d=u-a.pos.y;a.pos.x+=f*t.innerHomeStiffness,a.pos.y+=d*t.innerHomeStiffness}}}function T2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function b2(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function M2(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function A2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;a.pos.x+=k,a.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function E2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function ic(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=E2(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function I2(e){return ic(e.map(t=>t.pos))}function rd(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,ee=s[o]*.4,te=Math.min(t,ee);r.push({x:i.x+R*te*Math.min(U,3),y:i.y+S*te*Math.min(U,3)})}return r}function _2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),a=g.useRef({x:0,y:0}),[i,c]=g.useState(R2),[u,f]=g.useState(ea.medium),[d,p]=g.useState("medium"),[y,v]=g.useState(!1),[,k]=g.useState({});g.useEffect(()=>{const R=[ta(120,250,"T","#e74c3c"),ta(300,250,"U","#e74c3c"),ta(480,250,"Corrupt","#e74c3c")];s.current=R},[]),g.useEffect(()=>{let R=!0;const S=T=>{if(R){n.current=T,R=!1,t.current=requestAnimationFrame(S);return}const E=Math.min((T-n.current)/1e3,.033);n.current=T;for(const M of s.current){P2(M,i,E),j2(M,i);for(let U=0;U<i.iterations;U++)T2(M,i);M.usePressure&&b2(M,i)}r.current=M2(s.current,r.current,i),A2(s.current,r.current,i),k({}),t.current=requestAnimationFrame(S)};return t.current=requestAnimationFrame(S),()=>cancelAnimationFrame(t.current)},[i]);const w=g.useCallback(R=>{const S=e.current;if(!S)return;const T=S.getBoundingClientRect(),E=R.clientX-T.left,M=R.clientY-T.top;for(let U=0;U<s.current.length;U++){const ee=s.current[U],te=E-ee.targetX,N=M-ee.targetY;if(te*te+N*N<80*80){o.current=U,a.current={x:te,y:N},R.target.setPointerCapture(R.pointerId);break}}},[]),m=g.useCallback(R=>{if(o.current===null)return;const S=e.current;if(!S)return;const T=S.getBoundingClientRect(),E=R.clientX-T.left-a.current.x,M=R.clientY-T.top-a.current.y;s.current[o.current].targetX=E,s.current[o.current].targetY=M},[]),h=g.useCallback(()=>{o.current=null},[]),x=R=>{s.current[R].rotation=(s.current[R].rotation+90)%360},C=R=>{const S=ea[R];S&&(f(S),p(R))},j=()=>{const{alphaMultiplier:R,alphaOffset:S}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${R} ${S}`},P="#2c3e50";return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5c: Cell Wall (Outer - Inner)"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Outer gooey silhouette + stable inner core = visible cell wall ring"}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ea).map(R=>l.jsx("button",{onClick:()=>C(R),style:{padding:"8px 16px",background:d===R?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===R?"bold":"normal"},children:R.charAt(0).toUpperCase()+R.slice(1)},R))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",u.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:R=>{f(S=>({...S,stdDeviation:Number(R.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:R=>{f(S=>({...S,alphaMultiplier:Number(R.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:R=>{f(S=>({...S,alphaOffset:Number(R.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:u.enabled,onChange:R=>{f(S=>({...S,enabled:R.target.checked})),p(R.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),l.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",i.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i.innerHomeStiffness,onChange:R=>c(S=>({...S,innerHomeStiffness:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),l.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:R=>c(S=>({...S,goopiness:Number(R.target.value)})),style:{width:120}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:R=>c(S=>({...S,attractionRadius:Number(R.target.value)})),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:R=>c(S=>({...S,attractionStiffness:Number(R.target.value)})),style:{width:100}})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:l.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:y,onChange:R=>v(R.target.checked)}),l.jsx("span",{children:"Show Springs"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",i.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:i.tendrilEndRadius,onChange:R=>c(S=>({...S,tendrilEndRadius:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",i.tendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:i.tendrilSkinniness,onChange:R=>c(S=>({...S,tendrilSkinniness:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",i.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:i.wallThickness,onChange:R=>c(S=>({...S,wallThickness:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),l.jsxs("svg",{ref:e,width:k2,height:w2,style:{background:P,borderRadius:8,cursor:"grab"},onPointerDown:w,onPointerMove:m,onPointerUp:h,onPointerLeave:h,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-5c",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),l.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),l.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),l.jsxs("g",{filter:u.enabled?"url(#goo-filter-5c)":void 0,children:[r.current.map((R,S)=>{var ve,Te;const T=(ve=s.current[R.blobA])==null?void 0:ve.vertices[R.vertA],E=(Te=s.current[R.blobB])==null?void 0:Te.vertices[R.vertB];if(!T||!E)return null;const M=E.pos.x-T.pos.x,U=E.pos.y-T.pos.y,ee=Math.sqrt(M*M+U*U),te=Math.min(1,ee/i.goopiness),N=i.tendrilEndRadius,z=1-i.tendrilSkinniness,Q=1-i.tendrilSkinniness*.3,B=Q-(Q-z)*te,Z=N*B,q=N*1.4,oe=Math.max(2,Math.ceil(ee/q)),ne=[];for(let pe=0;pe<=oe;pe++){const A=pe/oe,Y=Math.sin(A*Math.PI),H=N-(N-Z)*Y;ne.push({cx:T.pos.x+M*A,cy:T.pos.y+U*A,r:Math.max(2,H)})}return l.jsx("g",{children:ne.map((pe,A)=>l.jsx("circle",{cx:pe.cx,cy:pe.cy,r:pe.r,fill:"#e74c3c"},A))},`tendril-${S}`)}),s.current.map((R,S)=>l.jsx("path",{d:I2(R.vertices),fill:R.color,stroke:R.color,strokeWidth:2},S))]}),s.current.map((R,S)=>{if(R.innerRegions)return R.innerRegions.map((T,E)=>{let M;T.outerVertexIndices?M=T.outerVertexIndices.map(ee=>R.vertices[ee].pos):M=T.vertices.map(ee=>ee.pos);const U=rd(M,i.wallThickness);return l.jsx("path",{d:ic(U),fill:P},`inner-${S}-${E}`)});{const T=R.vertices.map(M=>M.pos),E=rd(T,i.wallThickness);return l.jsx("path",{d:ic(E),fill:P},`inner-${S}`)}}),y&&r.current.map((R,S)=>{var Q,B;const T=(Q=s.current[R.blobA])==null?void 0:Q.vertices[R.vertA],E=(B=s.current[R.blobB])==null?void 0:B.vertices[R.vertB];if(!T||!E)return null;const M=E.pos.x-T.pos.x,U=E.pos.y-T.pos.y,te=Math.sqrt(M*M+U*U)/i.goopiness,N=Math.min(255,Math.floor(te*255)),z=Math.max(0,255-Math.floor(te*255));return l.jsx("line",{x1:T.pos.x,y1:T.pos.y,x2:E.pos.x,y2:E.pos.y,stroke:`rgb(${N},${z},100)`,strokeWidth:2,opacity:.7},`spring-${S}`)}),s.current.map((R,S)=>l.jsx("circle",{cx:R.targetX,cy:R.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${S}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-5c: Cell Wall Model"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Two layers:"}),l.jsx("br",{})," ",l.jsx("strong",{children:"Outer"})," (gooey): Stretches, merges with filter effect",l.jsx("br",{})," ",l.jsx("strong",{children:"Inner"})," (stable): Barely moves, cuts out the center",l.jsx("br",{})," ",l.jsx("strong",{children:"Cell Wall"}),": The visible ring between them",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Inner Stiffness:"})," Controls how stable the core is (higher = more rigid)",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Next:"})," Dynamic rebuilding when pieces lock (merge walls) or become loose goop (amputate)"]})]})}const O2=30,L2=600,N2=450,D2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},na={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},$2={autoFill:!0,fillRate:.15},id=1.15,F2=200;function sa(e,t,n,s){const r=[],o=[],a=[],i=[],c=O2;let u,f;const d=1.5,p=.3,y=1;let v;if(n==="T")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],v=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],v=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*c;u=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-x,y:-.5*c},{x:-x,y:-.5*c+x},{x:-.5*c,y:-.5*c+x},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+x},{x,y:-.5*c+x},{x,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+x,y:-.5*c},{x:.5*c+x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c},{x:-1.5*c,y:-.5*c}],v=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*c,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:.5*c},{x:-.5*c,y:.5*c}],v=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c}],v=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:v[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const k=r.length;for(let x=0;x<k;x++){const C=(x+1)%k,j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;a.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}for(const[x,C]of f){const j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;i.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}let w=0;for(let x=0;x<k;x++){const C=(x+1)%k;w+=r[x].homeOffset.x*r[C].homeOffset.y,w-=r[C].homeOffset.x*r[x].homeOffset.y}const m=Math.abs(w)/2;let h;if(n==="Corrupt"){const x=.5*c;h=[{offsetX:-c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-c},{x,y:-c},{x,y:c},{x:-x,y:c}],outerVertexIndices:[5,8,7,6]}].map(j=>{const P=j.points.map(R=>{const S=e+j.offsetX+R.x,T=t+j.offsetY+R.y;return{pos:{x:S,y:T},oldPos:{x:S,y:T},homeOffset:{x:R.x,y:R.y}}});return{...j,vertices:P,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:a,crossSprings:i,restArea:m,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt",fillAmount:0,isShaking:!1,boopScale:1,wasFullLastFrame:!1}}function Kr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function G2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,a=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=a+10*n*n}}function B2(e,t){for(const n of e.vertices){const s=Kr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.homeStiffness,n.pos.y+=i*t.homeStiffness}for(const n of e.innerVertices){const s=Kr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.innerHomeStiffness,n.pos.y+=i*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Kr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const a of n.vertices){const i=Kr(a.homeOffset.x,a.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-a.pos.x,d=u-a.pos.y;a.pos.x+=f*t.innerHomeStiffness,a.pos.y+=d*t.innerHomeStiffness}}}function z2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function Y2(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function H2(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function W2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;a.pos.x+=k,a.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function U2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function G0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=U2(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function X2(e){return G0(e.map(t=>t.pos))}function ld(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,ee=s[o]*.4,te=Math.min(t,ee);r.push({x:i.x+R*te*Math.min(U,3),y:i.y+S*te*Math.min(U,3)})}return r}function V2(){var U,ee,te;const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),a=g.useRef({x:0,y:0}),[i,c]=g.useState(D2),[u,f]=g.useState($2),[d,p]=g.useState(na.medium),[y,v]=g.useState("medium"),[k,w]=g.useState(!1),[,m]=g.useState({});g.useEffect(()=>{const N=[sa(120,250,"T","#e74c3c"),sa(300,250,"U","#e74c3c"),sa(480,250,"Corrupt","#e74c3c")];s.current=N},[]),g.useEffect(()=>{let N=!0;const z=Q=>{if(N){n.current=Q,N=!1,t.current=requestAnimationFrame(z);return}const B=Math.min((Q-n.current)/1e3,.033);n.current=Q;for(const Z of s.current){G2(Z,i,B),B2(Z,i);for(let oe=0;oe<i.iterations;oe++)z2(Z,i);Z.usePressure&&Y2(Z,i),u.autoFill&&Z.fillAmount<1&&(Z.fillAmount=Math.min(1,Z.fillAmount+u.fillRate*B));const q=Z.fillAmount>=1;if(q&&!Z.wasFullLastFrame&&(Z.boopScale=id),Z.wasFullLastFrame=q,Z.boopScale>1){const oe=(id-1)/(F2/1e3);Z.boopScale=Math.max(1,Z.boopScale-oe*B)}}r.current=H2(s.current,r.current,i),W2(s.current,r.current,i),m({}),t.current=requestAnimationFrame(z)};return t.current=requestAnimationFrame(z),()=>cancelAnimationFrame(t.current)},[i,u]);const h=g.useCallback(N=>{const z=e.current;if(!z)return;const Q=z.getBoundingClientRect(),B=N.clientX-Q.left,Z=N.clientY-Q.top;for(let q=0;q<s.current.length;q++){const oe=s.current[q],ne=B-oe.targetX,ve=Z-oe.targetY;if(ne*ne+ve*ve<80*80){oe.fillAmount<1&&(oe.isShaking=!0,setTimeout(()=>{oe.isShaking=!1,m({})},300)),o.current=q,a.current={x:ne,y:ve},N.target.setPointerCapture(N.pointerId);break}}},[]),x=g.useCallback(N=>{if(o.current===null)return;const z=e.current;if(!z)return;const Q=z.getBoundingClientRect(),B=N.clientX-Q.left-a.current.x,Z=N.clientY-Q.top-a.current.y;s.current[o.current].targetX=B,s.current[o.current].targetY=Z},[]),C=g.useCallback(()=>{o.current=null},[]),j=N=>{s.current[N].rotation=(s.current[N].rotation+90)%360},P=()=>{for(const N of s.current)N.fillAmount=0,N.wasFullLastFrame=!1,N.boopScale=1},R=N=>{const z=na[N];z&&(p(z),v(N))},S=()=>{const{alphaMultiplier:N,alphaOffset:z}=d;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${N} ${z}`},T="#2c3e50",E=N=>{let z=1/0,Q=-1/0,B=1/0,Z=-1/0;for(const q of N)q.x<z&&(z=q.x),q.x>Q&&(Q=q.x),q.y<B&&(B=q.y),q.y>Z&&(Z=q.y);return{minX:z,maxX:Q,minY:B,maxY:Z}},M=`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  `;return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("style",{children:M}),l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-6: Fill / Pour"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:'Goop fills the cell wall container over time  visual "time to pop" mechanic'}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(na).map(N=>l.jsx("button",{onClick:()=>R(N),style:{padding:"8px 16px",background:y===N?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:y===N?"bold":"normal"},children:N.charAt(0).toUpperCase()+N.slice(1)},N))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:"bold"},children:[l.jsx("input",{type:"checkbox",checked:u.autoFill,onChange:N=>f(z=>({...z,autoFill:N.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Fill Rate: ",u.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:u.fillRate,onChange:N=>f(z=>({...z,fillRate:Number(N.target.value)})),style:{width:120}})]}),l.jsx("button",{onClick:P,style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Fill"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:12},children:[l.jsxs("span",{children:["T: ",Math.round(((U=s.current[0])==null?void 0:U.fillAmount)*100||0),"%"]}),l.jsxs("span",{children:["U: ",Math.round(((ee=s.current[1])==null?void 0:ee.fillAmount)*100||0),"%"]}),l.jsxs("span",{children:["C: ",Math.round(((te=s.current[2])==null?void 0:te.fillAmount)*100||0),"%"]})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",d.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:d.stdDeviation,onChange:N=>{p(z=>({...z,stdDeviation:Number(N.target.value)})),v("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",d.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:d.alphaMultiplier,onChange:N=>{p(z=>({...z,alphaMultiplier:Number(N.target.value)})),v("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",d.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:d.alphaOffset,onChange:N=>{p(z=>({...z,alphaOffset:Number(N.target.value)})),v("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:d.enabled,onChange:N=>{p(z=>({...z,enabled:N.target.checked})),v(N.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>j(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>j(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),l.jsx("button",{onClick:()=>j(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",i.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i.innerHomeStiffness,onChange:N=>c(z=>({...z,innerHomeStiffness:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),l.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:N=>c(z=>({...z,goopiness:Number(N.target.value)})),style:{width:120}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:N=>c(z=>({...z,attractionRadius:Number(N.target.value)})),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:N=>c(z=>({...z,attractionStiffness:Number(N.target.value)})),style:{width:100}})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:l.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:k,onChange:N=>w(N.target.checked)}),l.jsx("span",{children:"Show Springs"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",i.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:i.tendrilEndRadius,onChange:N=>c(z=>({...z,tendrilEndRadius:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",i.tendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:i.tendrilSkinniness,onChange:N=>c(z=>({...z,tendrilSkinniness:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",i.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:i.wallThickness,onChange:N=>c(z=>({...z,wallThickness:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),l.jsxs("svg",{ref:e,width:L2,height:N2,style:{background:T,borderRadius:8,cursor:"grab"},onPointerDown:h,onPointerMove:x,onPointerUp:C,onPointerLeave:C,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-6",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:d.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:S(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),l.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),l.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),l.jsxs("g",{filter:d.enabled?"url(#goo-filter-6)":void 0,children:[r.current.map((N,z)=>{var ie,le;const Q=(ie=s.current[N.blobA])==null?void 0:ie.vertices[N.vertA],B=(le=s.current[N.blobB])==null?void 0:le.vertices[N.vertB];if(!Q||!B)return null;const Z=B.pos.x-Q.pos.x,q=B.pos.y-Q.pos.y,oe=Math.sqrt(Z*Z+q*q),ne=Math.min(1,oe/i.goopiness),ve=i.tendrilEndRadius,Te=1-i.tendrilSkinniness,pe=1-i.tendrilSkinniness*.3,A=pe-(pe-Te)*ne,Y=ve*A,H=ve*1.4,W=Math.max(2,Math.ceil(oe/H)),me=[];for(let V=0;V<=W;V++){const we=V/W,Ce=Math.sin(we*Math.PI),be=ve-(ve-Y)*Ce;me.push({cx:Q.pos.x+Z*we,cy:Q.pos.y+q*we,r:Math.max(2,be)})}return l.jsx("g",{children:me.map((V,we)=>l.jsx("circle",{cx:V.cx,cy:V.cy,r:V.r,fill:"#e74c3c"},we))},`tendril-${z}`)}),s.current.map((N,z)=>{const Q=N.boopScale!==1?`translate(${N.targetX}, ${N.targetY}) scale(${N.boopScale}) translate(${-N.targetX}, ${-N.targetY})`:void 0;return l.jsx("g",{transform:Q,style:N.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,children:l.jsx("path",{d:X2(N.vertices),fill:N.color,stroke:N.color,strokeWidth:2})},z)})]}),s.current.map((N,z)=>{const Q=N.boopScale!==1?`translate(${N.targetX}, ${N.targetY}) scale(${N.boopScale}) translate(${-N.targetX}, ${-N.targetY})`:void 0,B=N.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,Z=(q,oe)=>{const ne=E(q),ve=ne.maxY-ne.minY,Te=ne.maxY-ve*N.fillAmount,pe=50;return N.fillAmount>=1?null:l.jsxs("g",{children:[l.jsx("defs",{children:l.jsx("clipPath",{id:oe,children:l.jsx("rect",{x:ne.minX-pe,y:ne.minY-pe,width:ne.maxX-ne.minX+pe*2,height:Te-ne.minY+pe})})}),l.jsx("path",{d:G0(q),fill:T,clipPath:`url(#${oe})`})]},oe)};if(N.innerRegions)return l.jsx("g",{transform:Q,style:B,children:N.innerRegions.map((q,oe)=>{let ne;q.outerVertexIndices?ne=q.outerVertexIndices.map(Te=>N.vertices[Te].pos):ne=q.vertices.map(Te=>Te.pos);const ve=ld(ne,i.wallThickness);return Z(ve,`unfilled-clip-${z}-${oe}`)})},`inner-group-${z}`);{const q=N.vertices.map(ne=>ne.pos),oe=ld(q,i.wallThickness);return l.jsx("g",{transform:Q,style:B,children:Z(oe,`unfilled-clip-${z}`)},`inner-group-${z}`)}}),k&&r.current.map((N,z)=>{var pe,A;const Q=(pe=s.current[N.blobA])==null?void 0:pe.vertices[N.vertA],B=(A=s.current[N.blobB])==null?void 0:A.vertices[N.vertB];if(!Q||!B)return null;const Z=B.pos.x-Q.pos.x,q=B.pos.y-Q.pos.y,ne=Math.sqrt(Z*Z+q*q)/i.goopiness,ve=Math.min(255,Math.floor(ne*255)),Te=Math.max(0,255-Math.floor(ne*255));return l.jsx("line",{x1:Q.pos.x,y1:Q.pos.y,x2:B.pos.x,y2:B.pos.y,stroke:`rgb(${ve},${Te},100)`,strokeWidth:2,opacity:.7},`spring-${z}`)}),s.current.map((N,z)=>l.jsx("circle",{cx:N.targetX,cy:N.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${z}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-6: Fill / Pour"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"New mechanics:"}),l.jsx("br",{})," ",l.jsx("strong",{children:"Fill Amount"}),": Each blob has 0-100% fill level (same color as outer goop)",l.jsx("br",{})," ",l.jsx("strong",{children:"Auto-Fill"}),": Fill rises over time (adjustable rate)",l.jsx("br",{})," ",l.jsx("strong",{children:"Shake on early click"}),": Click before 100% and the goop shakes",l.jsx("br",{})," ",l.jsx("strong",{children:"Boop at 100%"}),": Scale pulse from center when fill completes",l.jsx("br",{})," ",l.jsx("strong",{children:"Reset"}),": Empty all containers to start over",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Game implication:"})," Player must clear goop before it fills to 100% (pop!)",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Next:"})," Proto-7 (Pop)  what happens when fill reaches 100%?"]})]})}const En=6,ht=8,Pt=50,zn=50,Yn=50,q2=En*Pt+zn*2,K2=ht*Pt+Yn*2,Z2={damping:.97,stiffness:1,pressure:5,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},oa={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},Q2={autoFill:!0,fillRate:.15},ad=1.15,J2=200,e3=200,Zr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function t3(e,t){return{x:zn+(e+.5)*Pt,y:Yn+(t+.5)*Pt}}function pi(e,t){return{x:zn+e*Pt,y:Yn+t*Pt}}function Hi(e){let t=0,n=0;for(const s of e){const r=t3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function n3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function s3(e){if(e.length===0)return[];const t=new Map;for(const a of e){const i=`${a.x1},${a.y1}`,c=`${a.x2},${a.y2}`;t.has(i)||t.set(i,[]),t.has(c)||t.set(c,[]),t.get(i).push(a),t.get(c).push(a)}const n=new Set,s=[];let r=e[0],o={x:r.x1,y:r.y1};for(;n.size<e.length;){n.add(r),s.push(pi(o.x,o.y));const a=o.x===r.x1&&o.y===r.y1?{x:r.x2,y:r.y2}:{x:r.x1,y:r.y1},i=`${a.x},${a.y}`,u=(t.get(i)||[]).find(f=>!n.has(f));if(!u)break;r=u,o=a}return s}let B0=0;function Qr(e,t,n){const s=`blob-${B0++}`,r=n3(e),o=s3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const w=Hi(e),m=Pt*.4;o.push({x:w.x-m,y:w.y-m},{x:w.x+m,y:w.y-m},{x:w.x+m,y:w.y+m},{x:w.x-m,y:w.y+m})}const a=Hi(e),i=o.map(w=>({pos:{x:w.x,y:w.y},oldPos:{x:w.x,y:w.y},homeOffset:{x:w.x-a.x,y:w.y-a.y},mass:1,attractionRadius:1})),c=o.map(w=>({pos:{x:w.x,y:w.y},oldPos:{x:w.x,y:w.y},homeOffset:{x:w.x-a.x,y:w.y-a.y}})),u=[],f=i.length;for(let w=0;w<f;w++){const m=(w+1)%f,h=i[m].homeOffset.x-i[w].homeOffset.x,x=i[m].homeOffset.y-i[w].homeOffset.y;u.push({a:w,b:m,restLength:Math.sqrt(h*h+x*x)})}const d=[],p=Pt*1.5,y=new Set;for(let w=0;w<f;w++)for(let m=w+2;m<f;m++){if(m===f-1&&w===0)continue;const h=i[m].homeOffset.x-i[w].homeOffset.x,x=i[m].homeOffset.y-i[w].homeOffset.y,C=Math.sqrt(h*h+x*x);if(C<p){const j=`${Math.min(w,m)}-${Math.max(w,m)}`;y.has(j)||(y.add(j),d.push({a:w,b:m,restLength:C}))}}let v=0;for(let w=0;w<f;w++){const m=(w+1)%f;v+=i[w].homeOffset.x*i[m].homeOffset.y,v-=i[m].homeOffset.x*i[w].homeOffset.y}const k=Math.abs(v)/2;return{id:s,vertices:i,innerVertices:c,ringsprings:u,crossSprings:d,restArea:k,targetX:a.x,targetY:a.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,boopScale:1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function o3(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,a={x:0,y:0};for(const i of n){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,a={x:0,y:0};for(const i of s){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}}const r3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function cd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function i3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function l3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const a of e.vertices){const i=cd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}for(const a of e.innerVertices){const i=cd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}}function a3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function c3(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function u3(e){const t=zn,n=zn+En*Pt,s=Yn,r=Yn+ht*Pt,o=2,a=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}}function f3(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function d3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function p3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function z0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=p3(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function h3(e){return z0(e.map(t=>t.pos))}function x3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,ee=s[o]*.4,te=Math.min(t,ee);r.push({x:i.x+R*te*Math.min(U,3),y:i.y+S*te*Math.min(U,3)})}return r}function y3(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),a=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(e3),[f,d]=g.useState(Z2),[p,y]=g.useState(Q2),[v,k]=g.useState(oa.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Zr[0]),[P,R]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState(5),[M,U]=g.useState(1.5),ee=g.useRef(T),te=g.useRef(M);ee.current=T,te.current=M,g.useEffect(()=>{const A=[];for(let le=0;le<ht;le++){A[le]=[];for(let V=0;V<En;V++)A[le][V]=null}r.current=A;const Y=[],H=[{x:0,y:ht-1},{x:1,y:ht-1},{x:2,y:ht-1},{x:1,y:ht-2}],W=Qr(H,Zr[0],!0);Y.push(W);for(const le of H)A[le.y][le.x]={blobId:W.id,color:W.color};const me=[{x:4,y:ht-1},{x:5,y:ht-1},{x:4,y:ht-2},{x:5,y:ht-2}],ie=Qr(me,Zr[1],!0);Y.push(ie);for(const le of me)A[le.y][le.x]={blobId:ie.id,color:ie.color};s.current=Y},[]),g.useEffect(()=>{let A=!0;const Y=H=>{var me,ie,le;if(A){n.current=H,A=!1,t.current=requestAnimationFrame(Y);return}const W=Math.min((H-n.current)/1e3,.033);n.current=H;for(const V of s.current){i3(V,f,W),l3(V,f);for(let Ce=0;Ce<f.iterations;Ce++)a3(V,f);V.usePressure&&c3(V,f),u3(V),V.isLocked&&p.autoFill&&V.fillAmount<1&&(V.fillAmount=Math.min(1,V.fillAmount+p.fillRate*W));const we=V.fillAmount>=1;if(we&&!V.wasFullLastFrame&&(V.boopScale=ad),V.wasFullLastFrame=we,V.boopScale>1){const Ce=(ad-1)/(J2/1e3);V.boopScale=Math.max(1,V.boopScale-Ce*W)}}if(a.current!==null){const V=s.current[a.current];if(V&&!V.isLocked){let we=ht-1;for(const Pe of V.gridCells){let I=Pe.y;for(;I<ht-1;){const ue=I+1,D=(me=r.current[ue])==null?void 0:me[Pe.x];if(D&&D.blobId!==V.id)break;I=ue}I-Pe.y+V.gridCells[0].y;const F=I-Pe.y;Pe.y+F-Pe.y<we-V.gridCells[0].y}let Ce=ht;for(const Pe of V.gridCells){let I=0;for(;Pe.y+I+1<ht;){const F=Pe.y+I+1,ye=(ie=r.current[F])==null?void 0:ie[Pe.x];if(ye&&ye.blobId!==V.id)break;I++}Ce=Math.min(Ce,I)}const be=Ce*Pt,$e=c*W,Fe=Math.min(V.visualOffsetY+$e,be);for(V.visualOffsetY=Fe;V.visualOffsetY>=Pt;){for(const Pe of V.gridCells)Pe.y+=1;V.visualOffsetY-=Pt}const Ee=Hi(V.gridCells);V.targetY=Ee.y+V.visualOffsetY;let Re=!0;for(const Pe of V.gridCells){const I=Pe.y+1;if(I>=ht){Re=!1;break}const F=(le=r.current[I])==null?void 0:le[Pe.x];if(F&&F.blobId!==V.id){Re=!1;break}}!Re&&V.visualOffsetY<.1&&(V.visualOffsetY=0,V.targetY=Ee.y,i.current=!0)}}o.current=f3(s.current,o.current,f),d3(s.current,o.current,f),i.current&&a.current!==null&&(i.current=!1,B()),S({}),t.current=requestAnimationFrame(Y)};return t.current=requestAnimationFrame(Y),()=>cancelAnimationFrame(t.current)},[f,p,c]);const N=g.useCallback((A,Y)=>{var H;return Y<0||Y>=ht||A<0||A>=En?!0:((H=r.current[Y])==null?void 0:H[A])!==null},[]),z=g.useCallback((A,Y)=>{const H=new Set,W=r.current;for(const me of A){const ie=[{x:me.x-1,y:me.y},{x:me.x+1,y:me.y},{x:me.x,y:me.y-1},{x:me.x,y:me.y+1}];for(const le of ie)if(le.y>=0&&le.y<ht&&le.x>=0&&le.x<En){const V=W[le.y][le.x];V&&V.color===Y&&H.add(V.blobId)}}return H},[]),Q=g.useCallback(A=>{var ie,le,V;const Y=ee.current,H=te.current,W=[];for(const we of A.gridCells){const Ce=we.y+1;Ce<ht&&((ie=r.current[Ce])!=null&&ie[we.x])&&W.push(pi(we.x+.5,we.y+1)),we.x>0&&((le=r.current[we.y])!=null&&le[we.x-1])&&W.push(pi(we.x,we.y+.5)),we.x<En-1&&((V=r.current[we.y])!=null&&V[we.x+1])&&W.push(pi(we.x+1,we.y+.5))}if(W.length===0)return;const me=Pt*H;for(const we of s.current)if(we.id!==A.id){for(const Ce of we.vertices){let be=1/0,$e=null;for(const Fe of W){const Ee=Ce.pos.x-Fe.x,Re=Ce.pos.y-Fe.y,Pe=Math.sqrt(Ee*Ee+Re*Re);Pe<be&&(be=Pe,$e=Fe)}if(be<me&&$e){const Fe=1-be/me,Ee=Y*Fe*Fe,Re=(Ce.pos.x-$e.x)/(be+.1),Pe=(Ce.pos.y-$e.y)/(be+.1);Ce.oldPos.x-=Re*Ee,Ce.oldPos.y-=Pe*Ee*.5}}for(const Ce of we.innerVertices){let be=1/0,$e=null;for(const Fe of W){const Ee=Ce.pos.x-Fe.x,Re=Ce.pos.y-Fe.y,Pe=Math.sqrt(Ee*Ee+Re*Re);Pe<be&&(be=Pe,$e=Fe)}if(be<me&&$e){const Fe=1-be/me,Ee=Y*Fe*Fe*.3,Re=(Ce.pos.x-$e.x)/(be+.1),Pe=(Ce.pos.y-$e.y)/(be+.1);Ce.oldPos.x-=Re*Ee,Ce.oldPos.y-=Pe*Ee*.5}}}},[]),B=g.useCallback(()=>{if(a.current===null)return;const A=s.current[a.current];if(!A)return;Q(A),A.visualOffsetY=0;const Y=Hi(A.gridCells);A.targetY=Y.y;const H=z(A.gridCells,A.color);if(H.size>0){const W=[...A.gridCells],me=[A],ie=[A.id];for(const V of H){const we=s.current.find(Ce=>Ce.id===V);we&&(W.push(...we.gridCells),me.push(we),ie.push(V))}const le=Qr(W,A.color,!0);o3(le,me);for(const V of W)r.current[V.y][V.x]={blobId:le.id,color:le.color};s.current=s.current.filter(V=>!ie.includes(V.id)),s.current.push(le),console.log(`Merged ${ie.length} blobs into one with ${W.length} cells`)}else{A.isLocked=!0,A.fillAmount=0,A.wasFullLastFrame=!1;for(const W of A.gridCells)r.current[W.y][W.x]={blobId:A.id,color:A.color};console.log("Locked piece (no same-color neighbors)")}a.current=null},[z,Q]),Z=g.useCallback(()=>{if(a.current!==null)return;const A=r3[P],Y=Math.floor((En-4)/2),H=0,W=A.map(ie=>({x:ie.x+Y,y:ie.y+H}));for(const ie of W)if(N(ie.x,ie.y)){console.log("Cannot spawn - space occupied");return}const me=Qr(W,C,!1);me.visualOffsetY=0,s.current.push(me),a.current=s.current.length-1},[P,C,N]),q=g.useCallback(()=>{var Y;if(a.current===null)return;const A=s.current[a.current];if(A){for(;;){let H=!0;for(const W of A.gridCells){const me=W.y+1;if(me>=ht){H=!1;break}const ie=(Y=r.current[me])==null?void 0:Y[W.x];if(ie&&ie.blobId!==A.id){H=!1;break}}if(!H)break;for(const W of A.gridCells)W.y+=1}A.visualOffsetY=0,B()}},[B]),oe=g.useCallback(()=>{a.current=null,i.current=!1;for(let A=0;A<ht;A++)for(let Y=0;Y<En;Y++)r.current[A][Y]=null;s.current=[],B0=0,o.current=[]},[]),ne=A=>{const Y=oa[A];Y&&(k(Y),m(A))},ve=()=>{const{alphaMultiplier:A,alphaOffset:Y}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${A} ${Y}`},Te="#2c3e50",pe=A=>{let Y=1/0,H=-1/0,W=1/0,me=-1/0;for(const ie of A)ie.x<Y&&(Y=ie.x),ie.x>H&&(H=ie.x),ie.y<W&&(W=ie.y),ie.y>me&&(me=ie.y);return{minX:Y,maxX:H,minY:W,maxY:me}};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-7: Merge"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Dynamic blob generation when pieces lock  same-color merge with unified fill layer"}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Zr.map((A,Y)=>l.jsx("button",{onClick:()=>j(A),style:{width:30,height:30,background:A,border:C===A?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},A)),l.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(A=>l.jsx("button",{onClick:()=>R(A),style:{padding:"6px 12px",background:P===A?"#fff":"#2c3e50",color:P===A?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:A},A))]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("button",{onClick:Z,disabled:a.current!==null,style:{padding:"10px 20px",background:a.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),l.jsx("button",{onClick:q,disabled:a.current===null,style:{padding:"10px 20px",background:a.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:a.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),l.jsx("button",{onClick:oe,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[l.jsx("input",{type:"checkbox",checked:h,onChange:A=>x(A.target.checked)}),l.jsx("span",{children:"Show Grid"})]})]}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(oa).map(A=>l.jsx("button",{onClick:()=>ne(A),style:{padding:"6px 12px",background:w===A?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===A?"bold":"normal",fontSize:12},children:A.charAt(0).toUpperCase()+A.slice(1)},A))}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:A=>y(Y=>({...Y,fillRate:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),l.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:A=>u(Number(A.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:A=>d(Y=>({...Y,wallThickness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:A=>y(Y=>({...Y,autoFill:A.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:A=>d(Y=>({...Y,damping:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Stiffness: ",f.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:A=>d(Y=>({...Y,stiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:f.pressure,onChange:A=>d(Y=>({...Y,pressure:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:A=>d(Y=>({...Y,homeStiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:A=>d(Y=>({...Y,innerHomeStiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:A=>d(Y=>({...Y,returnSpeed:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:A=>d(Y=>({...Y,viscosity:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Iterations: ",f.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:A=>d(Y=>({...Y,iterations:Number(A.target.value)})),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Strength: ",T]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:A=>E(Number(A.target.value)),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Radius: ",M.toFixed(1)," cells"]}),l.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:M,onChange:A=>U(Number(A.target.value)),style:{width:100}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),l.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:A=>d(Y=>({...Y,goopiness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:A=>d(Y=>({...Y,attractionRadius:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:A=>d(Y=>({...Y,attractionStiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:A=>d(Y=>({...Y,tendrilEndRadius:Number(A.target.value)})),style:{width:80}})]})]}),l.jsxs("svg",{ref:e,width:q2,height:K2,style:{background:Te,borderRadius:8},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:ve(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&l.jsxs("g",{opacity:.2,children:[Array.from({length:En+1}).map((A,Y)=>l.jsx("line",{x1:zn+Y*Pt,y1:Yn,x2:zn+Y*Pt,y2:Yn+ht*Pt,stroke:"#fff",strokeWidth:1},`v${Y}`)),Array.from({length:ht+1}).map((A,Y)=>l.jsx("line",{x1:zn,y1:Yn+Y*Pt,x2:zn+En*Pt,y2:Yn+Y*Pt,stroke:"#fff",strokeWidth:1},`h${Y}`))]}),l.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((A,Y)=>{const H=s.current[A.blobA],W=s.current[A.blobB];if(!H||!W)return null;const me=H.vertices[A.vertA],ie=W.vertices[A.vertB];if(!me||!ie)return null;const le=ie.pos.x-me.pos.x,V=ie.pos.y-me.pos.y,we=Math.sqrt(le*le+V*V),Ce=Math.min(1,we/f.goopiness),be=f.tendrilEndRadius,$e=1-f.tendrilSkinniness,Fe=1-f.tendrilSkinniness*.3,Ee=Fe-(Fe-$e)*Ce,Re=be*Ee,Pe=be*1.4,I=Math.max(2,Math.ceil(we/Pe)),F=[];for(let ye=0;ye<=I;ye++){const ue=ye/I,D=Math.sin(ue*Math.PI),L=be-(be-Re)*D;F.push({cx:me.pos.x+le*ue,cy:me.pos.y+V*ue,r:Math.max(2,L)})}return l.jsx("g",{children:F.map((ye,ue)=>l.jsx("circle",{cx:ye.cx,cy:ye.cy,r:ye.r,fill:H.color},ue))},`tendril-${Y}`)}),s.current.map((A,Y)=>{const H=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0;return l.jsx("g",{transform:H,children:l.jsx("path",{d:h3(A.vertices),fill:A.color,stroke:A.color,strokeWidth:2})},A.id)})]}),s.current.map(A=>{if(!A.isLocked||A.fillAmount>=1)return null;const Y=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0,H=A.vertices.map(Ce=>Ce.pos),W=x3(H,f.wallThickness),me=pe(W),ie=me.maxY-me.minY,le=me.maxY-ie*A.fillAmount,V=50,we=`unfilled-clip-${A.id}`;return l.jsxs("g",{transform:Y,children:[l.jsx("defs",{children:l.jsx("clipPath",{id:we,children:l.jsx("rect",{x:me.minX-V,y:me.minY-V,width:me.maxX-me.minX+V*2,height:le-me.minY+V})})}),l.jsx("path",{d:z0(W),fill:Te,clipPath:`url(#${we})`})]},`inner-${A.id}`)}),s.current.map((A,Y)=>l.jsx("text",{x:A.targetX,y:A.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:A.isLocked?`${Math.round(A.fillAmount*100)}%`:"falling"},`info-${A.id}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-7: Merge"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Test scenarios:"}),l.jsx("br",{})," ",l.jsx("strong",{children:"Same color adjacent"}),": Blobs merge into one, unified fill restarts",l.jsx("br",{})," ",l.jsx("strong",{children:"Different color"}),": No merge, just neighbors",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Current pieces:"})," ",s.current.length," blobs",l.jsx("br",{}),l.jsx("strong",{children:"Attraction springs:"})," ",o.current.length]})]})}const In=6,xt=8,yt=50,Sn=50,Cn=50,m3=In*yt+Sn*2,g3=xt*yt+Cn*2,v3={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ra={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},S3={autoFill:!0,fillRate:.15},C3=4,k3=200,Jr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function w3(e,t){return{x:Sn+(e+.5)*yt,y:Cn+(t+.5)*yt}}function hi(e,t){return{x:Sn+e*yt,y:Cn+t*yt}}function Wi(e){let t=0,n=0;for(const s of e){const r=w3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function R3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function P3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let a=e[0],i={x:a.x1,y:a.y1},c=n(a,i)+Math.PI;for(;r.size<e.length;){r.add(a),o.push(hi(i.x,i.y));const u=i.x===a.x1&&i.y===a.y1?{x:a.x2,y:a.y2}:{x:a.x1,y:a.y1};c=Math.atan2(u.y-i.y,u.x-i.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(w=>!r.has(w));if(y.length===0)break;let v=y[0],k=1/0;for(const w of y){const m=n(w,u),h=s(c,m);(h>k||k===1/0)&&(k=h,v=w)}a=v,i=u}return o}let Y0=0;function ei(e,t,n){const s=`blob-${Y0++}`,r=R3(e),o=P3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Wi(e),x=yt*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let a=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;a+=o[h].x*o[x].y,a-=o[x].x*o[h].y}a<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const i=Wi(e),c=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y}})),f=[],d=c.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+j*j)})}const p=[],y=yt*1.5,v=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y,P=Math.sqrt(C*C+j*j);if(P<y){const R=`${Math.min(h,x)}-${Math.max(h,x)}`;v.has(R)||(v.add(R),p.push({a:h,b:x,restLength:P}))}}let k=0;for(let h=0;h<d;h++){const x=(h+1)%d;k+=c[h].homeOffset.x*c[x].homeOffset.y,k-=c[x].homeOffset.x*c[h].homeOffset.y}const w=k>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${k.toFixed(0)}, winding=${w}, cells=${e.length}`);const m=Math.abs(k)/2;return{id:s,vertices:c,innerVertices:u,ringsprings:f,crossSprings:p,restArea:m,targetX:i.x,targetY:i.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function j3(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,a={x:0,y:0};for(const i of n){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,a={x:0,y:0};for(const i of s){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}}const T3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function ud(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function b3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function M3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const a of e.vertices){const i=ud(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}for(const a of e.innerVertices){const i=ud(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}}function A3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function E3(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const a=o.pos.x-n,i=o.pos.y-s,c=Math.sqrt(a*a+i*i),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(c>1e-4&&u>1e-4){const d=(u-c)*r;o.pos.x+=a/c*d,o.pos.y+=i/c*d}}}function I3(e){const t=Sn,n=Sn+In*yt,s=Cn,r=Cn+xt*yt,o=2,a=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}}function _3(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color===c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>yt*4))for(const p of i.vertices)for(const y of c.vertices){const v=y.pos.x-p.pos.x,k=y.pos.y-p.pos.y,w=Math.sqrt(v*v+k*k);if(w<20&&w>.01){const m=20-w,h=v/w,x=k/w,C=m*.8;p.pos.x-=h*C*.5,p.pos.y-=x*C*.5,y.pos.x+=h*C*.5,y.pos.y+=x*C*.5,p.oldPos.x-=h*C*.3,p.oldPos.y-=x*C*.3,y.oldPos.x+=h*C*.3,y.oldPos.y+=x*C*.3}}}}function O3(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function L3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function N3(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,a=n[r].pos,i=n[(r+1)%s].pos,c=a.x-o.x,u=a.y-o.y,f=i.x-a.x,d=i.y-a.y,p=Math.sqrt(c*c+u*u)||1,y=Math.sqrt(f*f+d*d)||1,v=c/p,k=u/p,w=f/y,m=d/y,h=k,x=-v,C=m,j=-w;let P=h+C,R=x+j;const S=Math.sqrt(P*P+R*R)||1;P/=S,R/=S,n[r].oldPos.x-=P*t,n[r].oldPos.y-=R*t}}function D3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function H0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=D3(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function $3(e){return H0(e.map(t=>t.pos))}function F3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,ee=s[o]*.4,te=Math.min(t,ee);r.push({x:i.x+R*te*Math.min(U,3),y:i.y+S*te*Math.min(U,3)})}return r}function G3(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),a=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(k3),[f,d]=g.useState(v3),[p,y]=g.useState(S3),[v,k]=g.useState(ra.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Jr[0]),[P,R]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState(5),[M,U]=g.useState(1.5),ee=g.useRef(T),te=g.useRef(M);ee.current=T,te.current=M;const N=g.useRef([]),z=g.useRef(0),[Q,B]=g.useState(12),[Z,q]=g.useState(150),[oe,ne]=g.useState(1),[ve,Te]=g.useState(8),[pe,A]=g.useState(!1),Y="proto8-dev-settings";g.useEffect(()=>{const I=localStorage.getItem(Y);if(I)try{const F=JSON.parse(I);F.physics&&d(F.physics),F.fillParams&&y(F.fillParams),F.filterParams&&(k(F.filterParams),m("custom")),F.fallSpeed&&u(F.fallSpeed),F.impactStrength&&E(F.impactStrength),F.impactRadius&&U(F.impactRadius),F.dropletCount&&B(F.dropletCount),F.dropletSpeed&&q(F.dropletSpeed),F.dropletLifetime&&ne(F.dropletLifetime),F.dropletSize&&Te(F.dropletSize),console.log("Loaded dev settings from localStorage")}catch(F){console.warn("Failed to load dev settings:",F)}},[]),g.useEffect(()=>{const I=F=>{F.key==="`"&&(F.preventDefault(),A(ye=>!ye))};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[]);const H=g.useCallback(()=>{const I={physics:f,fillParams:p,filterParams:v,fallSpeed:c,impactStrength:T,impactRadius:M,dropletCount:Q,dropletSpeed:Z,dropletLifetime:oe,dropletSize:ve};localStorage.setItem(Y,JSON.stringify(I)),console.log("Saved dev settings to localStorage")},[f,p,v,c,T,M,Q,Z,oe,ve]),W=g.useCallback(()=>{const I=[];for(let G=0;G<xt;G++){I[G]=[];for(let X=0;X<In;X++)I[G][X]=null}r.current=I,Y0=0;const F=[],ye=[{x:0,y:xt-1},{x:1,y:xt-1},{x:2,y:xt-1},{x:1,y:xt-2}],ue=ei(ye,Jr[0],!0);F.push(ue);for(const G of ye)I[G.y][G.x]={blobId:ue.id,color:ue.color};const D=[{x:4,y:xt-1},{x:5,y:xt-1},{x:4,y:xt-2},{x:5,y:xt-2}],L=ei(D,Jr[1],!0);F.push(L);for(const G of D)I[G.y][G.x]={blobId:L.id,color:L.color};s.current=F,o.current=[],N.current=[],a.current=null,i.current=!1},[]);g.useEffect(()=>{W()},[W]),g.useEffect(()=>{let I=!0;const F=ye=>{var ke,b,_;if(I){n.current=ye,I=!1,t.current=requestAnimationFrame(F);return}const ue=Math.min((ye-n.current)/1e3,.033);n.current=ye;for(const O of s.current){b3(O,f,ue),M3(O,f);for(let $=0;$<f.iterations;$++)A3(O,f);O.usePressure&&E3(O,f),I3(O)}_3(s.current);for(const O of s.current){O.isLocked&&p.autoFill&&O.fillAmount<1&&(O.fillAmount=Math.min(1,O.fillAmount+p.fillRate*ue));const $=O.fillAmount>=1;$&&!O.wasFullLastFrame&&N3(O,C3),O.wasFullLastFrame=$}if(a.current!==null){const O=s.current[a.current];if(O&&!O.isLocked){let $=xt-1;for(const Me of O.gridCells){let Ge=Me.y;for(;Ge<xt-1;){const _e=Ge+1,Je=(ke=r.current[_e])==null?void 0:ke[Me.x];if(Je&&Je.blobId!==O.id)break;Ge=_e}Ge-Me.y+O.gridCells[0].y;const He=Ge-Me.y;Me.y+He-Me.y<$-O.gridCells[0].y}let K=xt;for(const Me of O.gridCells){let Ge=0;for(;Me.y+Ge+1<xt;){const He=Me.y+Ge+1,Be=(b=r.current[He])==null?void 0:b[Me.x];if(Be&&Be.blobId!==O.id)break;Ge++}K=Math.min(K,Ge)}const se=K*yt,de=c*ue,ge=Math.min(O.visualOffsetY+de,se);for(O.visualOffsetY=ge;O.visualOffsetY>=yt;){for(const Me of O.gridCells)Me.y+=1;O.visualOffsetY-=yt}const J=Wi(O.gridCells);O.targetY=J.y+O.visualOffsetY;let Ne=!0;for(const Me of O.gridCells){const Ge=Me.y+1;if(Ge>=xt){Ne=!1;break}const He=(_=r.current[Ge])==null?void 0:_[Me.x];if(He&&He.blobId!==O.id){Ne=!1;break}}!Ne&&O.visualOffsetY<.1&&(O.visualOffsetY=0,O.targetY=J.y,i.current=!0)}}o.current=O3(s.current,o.current,f),L3(s.current,o.current,f),i.current&&a.current!==null&&(i.current=!1,we());const D=300,L=Sn,G=Sn+In*yt,X=Cn,re=Cn+xt*yt;for(const O of N.current)O.vel.y+=D*ue,O.pos.x+=O.vel.x*ue,O.pos.y+=O.vel.y*ue,(O.pos.x+O.radius<L||O.pos.x-O.radius>G)&&(O.lifetime=0),O.pos.y+O.radius<X&&(O.lifetime=0),O.pos.y+O.radius>re&&(O.pos.y=re-O.radius,O.vel.y*=-.3),O.lifetime-=ue,O.opacity=Math.max(0,O.lifetime/O.maxLifetime),O.radius*=.995;N.current=N.current.filter(O=>O.lifetime>0&&O.opacity>.01),S({}),t.current=requestAnimationFrame(F)};return t.current=requestAnimationFrame(F),()=>cancelAnimationFrame(t.current)},[f,p,c]);const me=g.useCallback((I,F)=>{var ye;return F<0||F>=xt||I<0||I>=In?!0:((ye=r.current[F])==null?void 0:ye[I])!==null},[]),ie=g.useCallback((I,F)=>{const ye=new Set,ue=r.current;for(const D of I){const L=[{x:D.x-1,y:D.y},{x:D.x+1,y:D.y},{x:D.x,y:D.y-1},{x:D.x,y:D.y+1}];for(const G of L)if(G.y>=0&&G.y<xt&&G.x>=0&&G.x<In){const X=ue[G.y][G.x];X&&X.color===F&&ye.add(X.blobId)}}return ye},[]),le=g.useCallback(I=>{var L,G,X;const F=ee.current,ye=te.current,ue=[];for(const re of I.gridCells){const ke=re.y+1;ke<xt&&((L=r.current[ke])!=null&&L[re.x])&&ue.push(hi(re.x+.5,re.y+1)),re.x>0&&((G=r.current[re.y])!=null&&G[re.x-1])&&ue.push(hi(re.x,re.y+.5)),re.x<In-1&&((X=r.current[re.y])!=null&&X[re.x+1])&&ue.push(hi(re.x+1,re.y+.5))}if(ue.length===0)return;const D=yt*ye;for(const re of s.current)if(re.id!==I.id){for(const ke of re.vertices){let b=1/0,_=null;for(const O of ue){const $=ke.pos.x-O.x,K=ke.pos.y-O.y,se=Math.sqrt($*$+K*K);se<b&&(b=se,_=O)}if(b<D&&_){const O=1-b/D,$=F*O*O,K=(ke.pos.x-_.x)/(b+.1),se=(ke.pos.y-_.y)/(b+.1);ke.oldPos.x-=K*$,ke.oldPos.y-=se*$*.5}}for(const ke of re.innerVertices){let b=1/0,_=null;for(const O of ue){const $=ke.pos.x-O.x,K=ke.pos.y-O.y,se=Math.sqrt($*$+K*K);se<b&&(b=se,_=O)}if(b<D&&_){const O=1-b/D,$=F*O*O*.3,K=(ke.pos.x-_.x)/(b+.1),se=(ke.pos.y-_.y)/(b+.1);ke.oldPos.x-=K*$,ke.oldPos.y-=se*$*.5}}}},[]),V=g.useCallback(I=>{var ue,D;const F=I.targetX,ye=I.targetY;for(let L=0;L<Q;L++){const G=Math.floor(Math.random()*I.vertices.length),X=I.vertices[G],re=X.pos.x-F,ke=X.pos.y-ye,b=Math.atan2(ke,re)+(Math.random()-.5)*.8,_=Z*(.5+Math.random()*.8),O={id:`droplet-${z.current++}`,pos:{x:X.pos.x,y:X.pos.y},vel:{x:Math.cos(b)*_,y:Math.sin(b)*_-50},radius:ve*(.5+Math.random()*.7),color:I.color,opacity:1,lifetime:oe*(.7+Math.random()*.6),maxLifetime:oe};N.current.push(O),console.log("Created droplet:",O.pos,O.radius,O.color)}for(const L of I.gridCells)((D=(ue=r.current[L.y])==null?void 0:ue[L.x])==null?void 0:D.blobId)===I.id&&(r.current[L.y][L.x]=null);s.current=s.current.filter(L=>L.id!==I.id),console.log(`Popped blob with ${I.gridCells.length} cells, spawned ${N.current.length} droplets total`)},[Q,Z,oe,ve]),we=g.useCallback(()=>{if(a.current===null)return;const I=s.current[a.current];if(!I)return;le(I),I.visualOffsetY=0;const F=Wi(I.gridCells);I.targetY=F.y;const ye=ie(I.gridCells,I.color);if(ye.size>0){const ue=[...I.gridCells],D=[I],L=[I.id];for(const X of ye){const re=s.current.find(ke=>ke.id===X);re&&(ue.push(...re.gridCells),D.push(re),L.push(X))}const G=ei(ue,I.color,!0);j3(G,D);for(const X of ue)r.current[X.y][X.x]={blobId:G.id,color:G.color};s.current=s.current.filter(X=>!L.includes(X.id)),s.current.push(G),console.log(`Merged ${L.length} blobs into one with ${ue.length} cells`)}else{I.isLocked=!0,I.fillAmount=0,I.wasFullLastFrame=!1;for(const ue of I.gridCells)r.current[ue.y][ue.x]={blobId:I.id,color:I.color};console.log("Locked piece (no same-color neighbors)")}a.current=null},[ie,le]),Ce=g.useCallback(()=>{if(a.current!==null)return;const I=T3[P],F=Math.floor((In-4)/2),ye=0,ue=I.map(L=>({x:L.x+F,y:L.y+ye}));for(const L of ue)if(me(L.x,L.y)){console.log("Cannot spawn - space occupied");return}const D=ei(ue,C,!1);D.visualOffsetY=0,s.current.push(D),a.current=s.current.length-1},[P,C,me]),be=g.useCallback(()=>{var F;if(a.current===null)return;const I=s.current[a.current];if(I){for(;;){let ye=!0;for(const ue of I.gridCells){const D=ue.y+1;if(D>=xt){ye=!1;break}const L=(F=r.current[D])==null?void 0:F[ue.x];if(L&&L.blobId!==I.id){ye=!1;break}}if(!ye)break;for(const ue of I.gridCells)ue.y+=1}I.visualOffsetY=0,we()}},[we]),$e=g.useCallback(()=>{W()},[W]),Fe=I=>{const F=ra[I];F&&(k(F),m(I))},Ee=()=>{const{alphaMultiplier:I,alphaOffset:F}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${I} ${F}`},Re="#2c3e50",Pe=I=>{let F=1/0,ye=-1/0,ue=1/0,D=-1/0;for(const L of I)L.x<F&&(F=L.x),L.x>ye&&(ye=L.x),L.y<ue&&(ue=L.y),L.y>D&&(D=L.y);return{minX:F,maxX:ye,minY:ue,maxY:D}};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-8: Pop"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Pop with residue  click filled blobs to pop them, droplets scatter and fade"}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Jr.map((I,F)=>l.jsx("button",{onClick:()=>j(I),style:{width:30,height:30,background:I,border:C===I?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},I)),l.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(I=>l.jsx("button",{onClick:()=>R(I),style:{padding:"6px 12px",background:P===I?"#fff":"#2c3e50",color:P===I?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:I},I))]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("button",{onClick:Ce,disabled:a.current!==null,style:{padding:"10px 20px",background:a.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),l.jsx("button",{onClick:be,disabled:a.current===null,style:{padding:"10px 20px",background:a.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:a.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),l.jsx("button",{onClick:$e,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[l.jsx("input",{type:"checkbox",checked:h,onChange:I=>x(I.target.checked)}),l.jsx("span",{children:"Show Grid"})]}),l.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),pe&&l.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[l.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),l.jsxs("div",{style:{display:"flex",gap:10},children:[l.jsx("button",{onClick:H,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),l.jsx("button",{onClick:()=>A(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ra).map(I=>l.jsx("button",{onClick:()=>Fe(I),style:{padding:"6px 12px",background:w===I?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===I?"bold":"normal",fontSize:12},children:I.charAt(0).toUpperCase()+I.slice(1)},I))}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:I=>y(F=>({...F,fillRate:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),l.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:I=>u(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:I=>d(F=>({...F,wallThickness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:I=>y(F=>({...F,autoFill:I.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:I=>d(F=>({...F,damping:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Stiffness: ",f.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:I=>d(F=>({...F,stiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:I=>d(F=>({...F,pressure:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:I=>d(F=>({...F,homeStiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:I=>d(F=>({...F,innerHomeStiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:I=>d(F=>({...F,returnSpeed:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:I=>d(F=>({...F,viscosity:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Iterations: ",f.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:I=>d(F=>({...F,iterations:Number(I.target.value)})),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Strength: ",T]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:I=>E(Number(I.target.value)),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Radius: ",M.toFixed(1)," cells"]}),l.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:M,onChange:I=>U(Number(I.target.value)),style:{width:100}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Droplets: ",Q]}),l.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:Q,onChange:I=>B(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Speed: ",Z]}),l.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:Z,onChange:I=>q(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Lifetime: ",oe.toFixed(1),"s"]}),l.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:oe,onChange:I=>ne(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Size: ",ve,"px"]}),l.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:ve,onChange:I=>Te(Number(I.target.value)),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),l.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:I=>d(F=>({...F,goopiness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:I=>d(F=>({...F,attractionRadius:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:I=>d(F=>({...F,attractionStiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:I=>d(F=>({...F,tendrilEndRadius:Number(I.target.value)})),style:{width:80}})]})]})]}),l.jsxs("svg",{ref:e,width:m3,height:g3,style:{background:Re,borderRadius:8},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Ee(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&l.jsxs("g",{opacity:.2,children:[Array.from({length:In+1}).map((I,F)=>l.jsx("line",{x1:Sn+F*yt,y1:Cn,x2:Sn+F*yt,y2:Cn+xt*yt,stroke:"#fff",strokeWidth:1},`v${F}`)),Array.from({length:xt+1}).map((I,F)=>l.jsx("line",{x1:Sn,y1:Cn+F*yt,x2:Sn+In*yt,y2:Cn+F*yt,stroke:"#fff",strokeWidth:1},`h${F}`))]}),l.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((I,F)=>{const ye=s.current[I.blobA],ue=s.current[I.blobB];if(!ye||!ue)return null;const D=ye.vertices[I.vertA],L=ue.vertices[I.vertB];if(!D||!L)return null;const G=L.pos.x-D.pos.x,X=L.pos.y-D.pos.y,re=Math.sqrt(G*G+X*X),ke=Math.min(1,re/f.goopiness),b=f.tendrilEndRadius,_=1-f.tendrilSkinniness,O=1-f.tendrilSkinniness*.3,$=O-(O-_)*ke,K=b*$,se=b*1.4,de=Math.max(2,Math.ceil(re/se)),ge=[];for(let J=0;J<=de;J++){const Ne=J/de,Me=Math.sin(Ne*Math.PI),Ge=b-(b-K)*Me;ge.push({cx:D.pos.x+G*Ne,cy:D.pos.y+X*Ne,r:Math.max(2,Ge)})}return l.jsx("g",{children:ge.map((J,Ne)=>l.jsx("circle",{cx:J.cx,cy:J.cy,r:J.r,fill:ye.color},Ne))},`tendril-${F}`)}),s.current.map((I,F)=>{const ye=I.isLocked&&I.fillAmount>=1;return l.jsx("g",{style:{cursor:ye?"pointer":"default"},onClick:()=>ye&&V(I),children:l.jsx("path",{d:$3(I.vertices),fill:I.color,stroke:I.color,strokeWidth:2})},I.id)})]}),s.current.map(I=>{if(!I.isLocked||I.fillAmount>=1)return null;const F=I.vertices.map(re=>re.pos),ye=F3(F,f.wallThickness),ue=Pe(ye),D=ue.maxY-ue.minY,L=ue.maxY-D*I.fillAmount,G=50,X=`unfilled-clip-${I.id}`;return l.jsxs("g",{children:[l.jsx("defs",{children:l.jsx("clipPath",{id:X,children:l.jsx("rect",{x:ue.minX-G,y:ue.minY-G,width:ue.maxX-ue.minX+G*2,height:L-ue.minY+G})})}),l.jsx("path",{d:H0(ye),fill:Re,clipPath:`url(#${X})`})]},`inner-${I.id}`)}),l.jsx("g",{children:N.current.map(I=>l.jsx("circle",{cx:I.pos.x,cy:I.pos.y,r:I.radius,fill:I.color,opacity:I.opacity},I.id))}),s.current.filter(I=>I.gridCells.length>4).map(I=>l.jsxs("g",{children:[I.vertices.map((F,ye)=>l.jsxs("g",{children:[l.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),l.jsx("text",{x:F.pos.x+6,y:F.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:ye})]},`v-${ye}`)),I.vertices.map((F,ye)=>{const ue=I.vertices[(ye+1)%I.vertices.length];return l.jsx("line",{x1:F.pos.x,y1:F.pos.y,x2:ue.pos.x,y2:ue.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${ye}`)})]},`debug-verts-${I.id}`)),s.current.map((I,F)=>l.jsx("text",{x:I.targetX,y:I.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:I.isLocked?`${Math.round(I.fillAmount*100)}%`:"falling"},`info-${I.id}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-8: Pop"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"How to test:"}),l.jsx("br",{})," Wait for a blob to fill to 100%",l.jsx("br",{})," Click the filled blob to pop it",l.jsx("br",{})," Droplets scatter outward and fade",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",l.jsx("strong",{children:"Droplets:"})," ",N.current.length]})]})}const ln=6,et=8,ct=50,kn=50,wn=50,B3=ln*ct+kn*2,z3=et*ct+wn*2,Y3={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ia={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},H3={autoFill:!0,fillRate:.15},W3=4,U3=200,Do=["#e74c3c","#3498db","#2ecc71","#f39c12"],X3={T_I_C:[{x:0,y:2},{x:0,y:3},{x:1,y:0},{x:1,y:1}],T_L_C:[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:2}],T_T_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:2,y:1}],T_S_C:[{x:0,y:2},{x:1,y:0},{x:1,y:1},{x:2,y:1}],T_O_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:1,y:2}]};function V3(e,t){return{x:kn+(e+.5)*ct,y:wn+(t+.5)*ct}}function xi(e,t){return{x:kn+e*ct,y:wn+t*ct}}function so(e){let t=0,n=0;for(const s of e){const r=V3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function q3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function K3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let a=e[0],i={x:a.x1,y:a.y1},c=n(a,i)+Math.PI;for(;r.size<e.length;){r.add(a),o.push(xi(i.x,i.y));const u=i.x===a.x1&&i.y===a.y1?{x:a.x2,y:a.y2}:{x:a.x1,y:a.y1};c=Math.atan2(u.y-i.y,u.x-i.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(w=>!r.has(w));if(y.length===0)break;let v=y[0],k=1/0;for(const w of y){const m=n(w,u),h=s(c,m);(h>k||k===1/0)&&(k=h,v=w)}a=v,i=u}return o}let W0=0;function Jn(e,t,n){const s=`blob-${W0++}`,r=q3(e),o=K3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=so(e),x=ct*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let a=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;a+=o[h].x*o[x].y,a-=o[x].x*o[h].y}a<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const i=so(e),c=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y}})),f=[],d=c.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+j*j)})}const p=[],y=ct*1.5,v=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y,P=Math.sqrt(C*C+j*j);if(P<y){const R=`${Math.min(h,x)}-${Math.max(h,x)}`;v.has(R)||(v.add(R),p.push({a:h,b:x,restLength:P}))}}let k=0;for(let h=0;h<d;h++){const x=(h+1)%d;k+=c[h].homeOffset.x*c[x].homeOffset.y,k-=c[x].homeOffset.x*c[h].homeOffset.y}const w=k>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${k.toFixed(0)}, winding=${w}, cells=${e.length}`);const m=Math.abs(k)/2;return{id:s,vertices:c,innerVertices:u,ringsprings:f,crossSprings:p,restArea:m,targetX:i.x,targetY:i.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,isLoose:!1,visualOffsetY:0}}function fd(e,t,n=.3){const s=[];for(const o of t)for(const a of o.vertices)s.push({pos:{x:a.pos.x,y:a.pos.y},velocity:{x:a.pos.x-a.oldPos.x,y:a.pos.y-a.oldPos.y}});for(const o of e.vertices){let a=1/0,i={x:0,y:0};for(const c of s){const u=o.pos.x-c.pos.x,f=o.pos.y-c.pos.y,d=u*u+f*f;d<a&&(a=d,i=c.velocity)}o.oldPos.x=o.pos.x-i.x*n,o.oldPos.y=o.pos.y-i.y*n}const r=[];for(const o of t)for(const a of o.innerVertices)r.push({pos:{x:a.pos.x,y:a.pos.y},velocity:{x:a.pos.x-a.oldPos.x,y:a.pos.y-a.oldPos.y}});for(const o of e.innerVertices){let a=1/0,i={x:0,y:0};for(const c of r){const u=o.pos.x-c.pos.x,f=o.pos.y-c.pos.y,d=u*u+f*f;d<a&&(a=d,i=c.velocity)}o.oldPos.x=o.pos.x-i.x*n,o.oldPos.y=o.pos.y-i.y*n}}const Z3=ct*.02*1e3;function Q3(e){if(e.length===0)return[];if(e.length===1)return[[...e]];const t=new Set(e.map(r=>`${r.x},${r.y}`)),n=new Set,s=[];for(const r of e){const o=`${r.x},${r.y}`;if(n.has(o))continue;const a=[],i=[r];for(;i.length>0;){const c=i.shift(),u=`${c.x},${c.y}`;if(n.has(u))continue;n.add(u),a.push(c);const f=[{x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y}];for(const d of f){const p=`${d.x},${d.y}`;t.has(p)&&!n.has(p)&&i.push(d)}}a.length>0&&s.push(a)}return s}function J3(e,t,n){var s;for(const r of e.gridCells)if(r.y>=et-1)return!0;for(const r of e.gridCells){const o=r.y+1;if(o<et){const a=(s=t[o])==null?void 0:s[r.x];if(a&&a.blobId!==e.id&&n.has(a.blobId))return!0}}return!1}function dd(e,t){var i,c;const n=new Set;for(const u of e)if(!(!u.isLocked||u.isLoose)){for(const f of u.gridCells)if(f.y>=et-1){n.add(u.id);break}}let s=!0;for(;s;){s=!1;for(const u of e)n.has(u.id)||!u.isLocked||u.isLoose||J3(u,t,n)&&(n.add(u.id),s=!0)}const r=[],o=[],a=[];for(const u of e){if(!u.isLocked||u.isLoose||n.has(u.id))continue;for(const d of u.gridCells)((c=(i=t[d.y])==null?void 0:i[d.x])==null?void 0:c.blobId)===u.id&&(t[d.y][d.x]=null);const f=Q3(u.gridCells);if(f.length===1)u.isLocked=!1,u.isLoose=!0,u.visualOffsetY=0,r.push(u),console.log(`Blob ${u.id} became loose (lost support)`);else{console.log(`Blob ${u.id} splitting into ${f.length} disconnected pieces`),o.push(u.id);for(const d of f){const p=Jn(d,u.color,!1);p.isLocked=!1,p.isLoose=!0,p.visualOffsetY=0,p.fillAmount=u.fillAmount,a.push(p),r.push(p),console.log(`  - Created loose piece with ${d.length} cell(s)`)}}}if(o.length>0||a.length>0){const u=e.filter(f=>!o.includes(f.id));e.length=0,e.push(...u,...a)}return r}const e5={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function pd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function t5(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function n5(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const a of e.vertices){const i=pd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}for(const a of e.innerVertices){const i=pd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}}function s5(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function o5(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const a=o.pos.x-n,i=o.pos.y-s,c=Math.sqrt(a*a+i*i),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(c>1e-4&&u>1e-4){const d=(u-c)*r;o.pos.x+=a/c*d,o.pos.y+=i/c*d}}}function r5(e){const t=kn,n=kn+ln*ct,s=wn,r=wn+et*ct,o=2,a=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}}function i5(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color===c.color)continue;const u=i.isFalling||i.isLoose,f=c.isFalling||c.isLoose;if(!u&&!f)continue;const d=i.targetX-c.targetX,p=i.targetY-c.targetY;if(!(Math.sqrt(d*d+p*p)>ct*4))for(const v of i.vertices)for(const k of c.vertices){const w=k.pos.x-v.pos.x,m=k.pos.y-v.pos.y,h=Math.sqrt(w*w+m*m);if(h<20&&h>.01){const x=20-h,C=w/h,j=m/h,P=x*.8;v.pos.x-=C*P*.5,v.pos.y-=j*P*.5,k.pos.x+=C*P*.5,k.pos.y+=j*P*.5,v.oldPos.x-=C*P*.3,v.oldPos.y-=j*P*.3,k.oldPos.x+=C*P*.3,k.oldPos.y+=j*P*.3}}}}function l5(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function a5(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function c5(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,a=n[r].pos,i=n[(r+1)%s].pos,c=a.x-o.x,u=a.y-o.y,f=i.x-a.x,d=i.y-a.y,p=Math.sqrt(c*c+u*u)||1,y=Math.sqrt(f*f+d*d)||1,v=c/p,k=u/p,w=f/y,m=d/y,h=k,x=-v,C=m,j=-w;let P=h+C,R=x+j;const S=Math.sqrt(P*P+R*R)||1;P/=S,R/=S,n[r].oldPos.x-=P*t,n[r].oldPos.y-=R*t}}function u5(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function U0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=u5(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function f5(e){return U0(e.map(t=>t.pos))}function d5(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,ee=s[o]*.4,te=Math.min(t,ee);r.push({x:i.x+R*te*Math.min(U,3),y:i.y+S*te*Math.min(U,3)})}return r}function p5(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),a=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(U3),[f,d]=g.useState(Y3),[p,y]=g.useState(H3),[v,k]=g.useState(ia.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Do[0]),[P,R]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState("A"),[M,U]=g.useState("T_T_C"),[ee,te]=g.useState(0),[N,z]=g.useState(5),[Q,B]=g.useState(1.5),Z=g.useRef(N),q=g.useRef(Q);Z.current=N,q.current=Q;const oe=g.useRef([]),ne=g.useRef(0),[ve,Te]=g.useState(12),[pe,A]=g.useState(150),[Y,H]=g.useState(1),[W,me]=g.useState(8),[ie,le]=g.useState(!1),V="proto9-dev-settings";g.useEffect(()=>{const b=localStorage.getItem(V);if(b)try{const _=JSON.parse(b);_.physics&&d(_.physics),_.fillParams&&y(_.fillParams),_.filterParams&&(k(_.filterParams),m("custom")),_.fallSpeed&&u(_.fallSpeed),_.impactStrength&&z(_.impactStrength),_.impactRadius&&B(_.impactRadius),_.dropletCount&&Te(_.dropletCount),_.dropletSpeed&&A(_.dropletSpeed),_.dropletLifetime&&H(_.dropletLifetime),_.dropletSize&&me(_.dropletSize),console.log("Loaded dev settings from localStorage")}catch(_){console.warn("Failed to load dev settings:",_)}},[]),g.useEffect(()=>{const b=_=>{_.key==="`"&&(_.preventDefault(),le(O=>!O))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]);const we=g.useCallback(()=>{const b={physics:f,fillParams:p,filterParams:v,fallSpeed:c,impactStrength:N,impactRadius:Q,dropletCount:ve,dropletSpeed:pe,dropletLifetime:Y,dropletSize:W};localStorage.setItem(V,JSON.stringify(b)),console.log("Saved dev settings to localStorage")},[f,p,v,c,N,Q,ve,pe,Y,W]),Ce=g.useCallback(()=>{const b=[];for(let J=0;J<et;J++){b[J]=[];for(let Ne=0;Ne<ln;Ne++)b[J][Ne]=null}r.current=b,W0=0;const _=[],O=[{x:1,y:et-1},{x:2,y:et-1},{x:3,y:et-1},{x:4,y:et-1}],$=Jn(O,Do[1],!0);$.fillAmount=1,$.wasFullLastFrame=!0,_.push($);for(const J of O)b[J.y][J.x]={blobId:$.id,color:$.color};const K=[{x:1,y:et-2},{x:2,y:et-2},{x:3,y:et-2},{x:2,y:et-3}],se=Jn(K,Do[0],!0);se.fillAmount=1,se.wasFullLastFrame=!0,_.push(se);for(const J of K)b[J.y][J.x]={blobId:se.id,color:se.color};const de=[{x:1,y:et-5},{x:1,y:et-4},{x:2,y:et-4},{x:3,y:et-4}],ge=Jn(de,Do[1],!0);ge.fillAmount=1,ge.wasFullLastFrame=!0,_.push(ge);for(const J of de)b[J.y][J.x]={blobId:ge.id,color:ge.color};s.current=_,o.current=[],oe.current=[],a.current=null,i.current=!1,console.log("Test A initialized: 4x1 blue, T red, J blue")},[]);g.useEffect(()=>{Ce()},[Ce]);const be=g.useCallback(b=>{E(b),Ce()},[Ce]);g.useEffect(()=>{let b=!0;const _=O=>{var Ge,He,Be,_e,Je;if(b){n.current=O,b=!1,t.current=requestAnimationFrame(_);return}const $=Math.min((O-n.current)/1e3,.033);n.current=O;for(const ce of s.current){t5(ce,f,$),n5(ce,f);for(let it=0;it<f.iterations;it++)s5(ce,f);ce.usePressure&&o5(ce,f),r5(ce)}i5(s.current);for(const ce of s.current){ce.isLocked&&p.autoFill&&ce.fillAmount<1&&(ce.fillAmount=Math.min(1,ce.fillAmount+p.fillRate*$));const it=ce.fillAmount>=1;it&&!ce.wasFullLastFrame&&c5(ce,W3),ce.wasFullLastFrame=it}if(a.current!==null){const ce=s.current[a.current];if(ce&&!ce.isLocked){let it=et-1;for(const ze of ce.gridCells){let Ze=ze.y;for(;Ze<et-1;){const wo=Ze+1,ot=(Ge=r.current[wo])==null?void 0:Ge[ze.x];if(ot&&ot.blobId!==ce.id)break;Ze=wo}Ze-ze.y+ce.gridCells[0].y;const Qe=Ze-ze.y;ze.y+Qe-ze.y<it-ce.gridCells[0].y}let lt=et;for(const ze of ce.gridCells){let Ze=0;for(;ze.y+Ze+1<et;){const Qe=ze.y+Ze+1,ks=(He=r.current[Qe])==null?void 0:He[ze.x];if(ks&&ks.blobId!==ce.id)break;Ze++}lt=Math.min(lt,Ze)}const Rt=lt*ct,he=c*$,fe=Math.min(ce.visualOffsetY+he,Rt);for(ce.visualOffsetY=fe;ce.visualOffsetY>=ct;){for(const ze of ce.gridCells)ze.y+=1;ce.visualOffsetY-=ct}const Xe=so(ce.gridCells);ce.targetY=Xe.y+ce.visualOffsetY;let We=!0;for(const ze of ce.gridCells){const Ze=ze.y+1;if(Ze>=et){We=!1;break}const Qe=(Be=r.current[Ze])==null?void 0:Be[ze.x];if(Qe&&Qe.blobId!==ce.id){We=!1;break}}!We&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=Xe.y,i.current=!0)}}const K=s.current.filter(ce=>ce.isLoose),se=[];for(const ce of K){let it=et;for(const We of ce.gridCells){let ze=0;for(;We.y+ze+1<et;){const Ze=We.y+ze+1,Qe=(_e=r.current[Ze])==null?void 0:_e[We.x];if(Qe&&Qe.blobId!==ce.id)break;ze++}it=Math.min(it,ze)}const lt=it*ct,Rt=Z3*$,he=Math.min(ce.visualOffsetY+Rt,lt);for(ce.visualOffsetY=he;ce.visualOffsetY>=ct;){for(const We of ce.gridCells)We.y+=1;ce.visualOffsetY-=ct}const fe=so(ce.gridCells);ce.targetY=fe.y+ce.visualOffsetY;let Xe=!0;for(const We of ce.gridCells){const ze=We.y+1;if(ze>=et){Xe=!1;break}const Ze=(Je=r.current[ze])==null?void 0:Je[We.x];if(Ze&&Ze.blobId!==ce.id){Xe=!1;break}}!Xe&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=fe.y,se.push(ce))}for(const ce of se)Pe(ce);o.current=l5(s.current,o.current,f),a5(s.current,o.current,f),i.current&&a.current!==null&&(i.current=!1,I());const de=300,ge=kn,J=kn+ln*ct,Ne=wn,Me=wn+et*ct;for(const ce of oe.current)ce.vel.y+=de*$,ce.pos.x+=ce.vel.x*$,ce.pos.y+=ce.vel.y*$,(ce.pos.x+ce.radius<ge||ce.pos.x-ce.radius>J)&&(ce.lifetime=0),ce.pos.y+ce.radius<Ne&&(ce.lifetime=0),ce.pos.y+ce.radius>Me&&(ce.pos.y=Me-ce.radius,ce.vel.y*=-.3),ce.lifetime-=$,ce.opacity=Math.max(0,ce.lifetime/ce.maxLifetime),ce.radius*=.995;oe.current=oe.current.filter(ce=>ce.lifetime>0&&ce.opacity>.01),S({}),t.current=requestAnimationFrame(_)};return t.current=requestAnimationFrame(_),()=>cancelAnimationFrame(t.current)},[f,p,c]);const $e=g.useCallback((b,_)=>{var O;return _<0||_>=et||b<0||b>=ln?!0:((O=r.current[_])==null?void 0:O[b])!==null},[]),Fe=g.useCallback((b,_)=>{const O=new Set,$=r.current;for(const K of b){const se=[{x:K.x-1,y:K.y},{x:K.x+1,y:K.y},{x:K.x,y:K.y-1},{x:K.x,y:K.y+1}];for(const de of se)if(de.y>=0&&de.y<et&&de.x>=0&&de.x<ln){const ge=$[de.y][de.x];ge&&ge.color===_&&O.add(ge.blobId)}}return O},[]),Ee=g.useCallback(b=>{var se,de,ge;const _=Z.current,O=q.current,$=[];for(const J of b.gridCells){const Ne=J.y+1;Ne<et&&((se=r.current[Ne])!=null&&se[J.x])&&$.push(xi(J.x+.5,J.y+1)),J.x>0&&((de=r.current[J.y])!=null&&de[J.x-1])&&$.push(xi(J.x,J.y+.5)),J.x<ln-1&&((ge=r.current[J.y])!=null&&ge[J.x+1])&&$.push(xi(J.x+1,J.y+.5))}if($.length===0)return;const K=ct*O;for(const J of s.current)if(J.id!==b.id){for(const Ne of J.vertices){let Me=1/0,Ge=null;for(const He of $){const Be=Ne.pos.x-He.x,_e=Ne.pos.y-He.y,Je=Math.sqrt(Be*Be+_e*_e);Je<Me&&(Me=Je,Ge=He)}if(Me<K&&Ge){const He=1-Me/K,Be=_*He*He,_e=(Ne.pos.x-Ge.x)/(Me+.1),Je=(Ne.pos.y-Ge.y)/(Me+.1);Ne.oldPos.x-=_e*Be,Ne.oldPos.y-=Je*Be*.5}}for(const Ne of J.innerVertices){let Me=1/0,Ge=null;for(const He of $){const Be=Ne.pos.x-He.x,_e=Ne.pos.y-He.y,Je=Math.sqrt(Be*Be+_e*_e);Je<Me&&(Me=Je,Ge=He)}if(Me<K&&Ge){const He=1-Me/K,Be=_*He*He*.3,_e=(Ne.pos.x-Ge.x)/(Me+.1),Je=(Ne.pos.y-Ge.y)/(Me+.1);Ne.oldPos.x-=_e*Be,Ne.oldPos.y-=Je*Be*.5}}}},[]),Re=g.useCallback(b=>{var K,se;const _=b.targetX,O=b.targetY;for(let de=0;de<ve;de++){const ge=Math.floor(Math.random()*b.vertices.length),J=b.vertices[ge],Ne=J.pos.x-_,Me=J.pos.y-O,Ge=Math.atan2(Me,Ne)+(Math.random()-.5)*.8,He=pe*(.5+Math.random()*.8),Be={id:`droplet-${ne.current++}`,pos:{x:J.pos.x,y:J.pos.y},vel:{x:Math.cos(Ge)*He,y:Math.sin(Ge)*He-50},radius:W*(.5+Math.random()*.7),color:b.color,opacity:1,lifetime:Y*(.7+Math.random()*.6),maxLifetime:Y};oe.current.push(Be),console.log("Created droplet:",Be.pos,Be.radius,Be.color)}for(const de of b.gridCells)((se=(K=r.current[de.y])==null?void 0:K[de.x])==null?void 0:se.blobId)===b.id&&(r.current[de.y][de.x]=null);s.current=s.current.filter(de=>de.id!==b.id);const $=dd(s.current,r.current);$.length>0&&console.log(`Pop created ${$.length} loose goop blob(s)`),console.log(`Popped blob with ${b.gridCells.length} cells, spawned ${oe.current.length} droplets total`)},[ve,pe,Y,W]),Pe=g.useCallback(b=>{if(!b.isLoose)return;console.log(`Locking loose blob ${b.id}`),Ee(b),b.visualOffsetY=0;const _=so(b.gridCells);b.targetY=_.y;const O=Fe(b.gridCells,b.color);if(O.size>0){const K=[...b.gridCells],se=[b],de=[b.id];for(const J of O){const Ne=s.current.find(Me=>Me.id===J);Ne&&(K.push(...Ne.gridCells),se.push(Ne),de.push(J))}const ge=Jn(K,b.color,!0);fd(ge,se);for(const J of K)r.current[J.y][J.x]={blobId:ge.id,color:ge.color};s.current=s.current.filter(J=>!de.includes(J.id)),s.current.push(ge),console.log(`Loose blob merged with ${O.size} neighbor(s) into ${K.length} cells`)}else{b.isLocked=!0,b.isLoose=!1,b.fillAmount=0,b.wasFullLastFrame=!1;for(const K of b.gridCells)r.current[K.y][K.x]={blobId:b.id,color:b.color};console.log("Loose blob locked (no same-color neighbors)")}const $=dd(s.current,r.current);$.length>0&&console.log(`Landing created ${$.length} more loose goop blob(s)`)},[Fe,Ee]),I=g.useCallback(()=>{if(a.current===null)return;const b=s.current[a.current];if(!b)return;Ee(b),b.visualOffsetY=0;const _=so(b.gridCells);b.targetY=_.y;const O=Fe(b.gridCells,b.color);if(O.size>0){const $=[...b.gridCells],K=[b],se=[b.id];for(const ge of O){const J=s.current.find(Ne=>Ne.id===ge);J&&($.push(...J.gridCells),K.push(J),se.push(ge))}const de=Jn($,b.color,!0);fd(de,K);for(const ge of $)r.current[ge.y][ge.x]={blobId:de.id,color:de.color};s.current=s.current.filter(ge=>!se.includes(ge.id)),s.current.push(de),console.log(`Merged ${se.length} blobs into one with ${$.length} cells`)}else{b.isLocked=!0,b.fillAmount=0,b.wasFullLastFrame=!1;for(const $ of b.gridCells)r.current[$.y][$.x]={blobId:b.id,color:b.color};console.log("Locked piece (no same-color neighbors)")}a.current=null},[Fe,Ee]),F=g.useCallback(()=>{if(a.current!==null)return;const b=e5[P],_=Math.floor((ln-4)/2),O=0,$=b.map(se=>({x:se.x+_,y:se.y+O}));for(const se of $)if($e(se.x,se.y)){console.log("Cannot spawn - space occupied");return}const K=Jn($,C,!1);K.visualOffsetY=0,s.current.push(K),a.current=s.current.length-1},[P,C,$e]),ye=(b,_)=>{let O=b.map(se=>({...se}));for(let se=0;se<_%4;se++)O=O.map(({x:de,y:ge})=>({x:-ge,y:de}));const $=Math.min(...O.map(se=>se.x)),K=Math.min(...O.map(se=>se.y));return O.map(se=>({x:se.x-$,y:se.y-K}))},ue=g.useCallback(()=>{if(a.current!==null)return;const b=X3[M];if(!b)return;const _=ye(b,ee),O=Math.floor((ln-3)/2),$=0,K=_.map(de=>({x:de.x+O,y:de.y+$}));for(const de of K){if(de.x<0||de.x>=ln||de.y<0||de.y>=et){console.log("Cannot spawn - out of bounds");return}if($e(de.x,de.y)){console.log("Cannot spawn - space occupied");return}}const se=Jn(K,C,!1);se.visualOffsetY=0,s.current.push(se),a.current=s.current.length-1,console.log(`Spawned corrupted piece ${M} with rotation ${ee*90}`)},[M,ee,C,$e]),D=g.useCallback(()=>{var _;if(a.current===null)return;const b=s.current[a.current];if(b){for(;;){let O=!0;for(const $ of b.gridCells){const K=$.y+1;if(K>=et){O=!1;break}const se=(_=r.current[K])==null?void 0:_[$.x];if(se&&se.blobId!==b.id){O=!1;break}}if(!O)break;for(const $ of b.gridCells)$.y+=1}b.visualOffsetY=0,I()}},[I]),L=g.useCallback(()=>{Ce()},[Ce]),G=b=>{const _=ia[b];_&&(k(_),m(b))},X=()=>{const{alphaMultiplier:b,alphaOffset:_}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${b} ${_}`},re="#2c3e50",ke=b=>{let _=1/0,O=-1/0,$=1/0,K=-1/0;for(const se of b)se.x<_&&(_=se.x),se.x>O&&(O=se.x),se.y<$&&($=se.y),se.y>K&&(K=se.y);return{minX:_,maxX:O,minY:$,maxY:K}};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-9: Loose Goop"}),l.jsxs("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:[T==="A"&&"Test A: Click red blob to pop  top blue becomes loose  falls  merges with bottom blue",T==="B"&&"Test B: Spawn corrupted pieces, build stacks, pop middle pieces to test loose goop",T==="default"&&"Default: Original Proto-8 setup with T and square pieces"]}),l.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15,background:"#8e44ad",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold",marginRight:10},children:"Test Mode:"}),l.jsx("button",{onClick:()=>be("A"),style:{padding:"8px 16px",background:T==="A"?"#fff":"#2c3e50",color:T==="A"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test A: Stack Pop"}),l.jsx("button",{onClick:()=>be("B"),style:{padding:"8px 16px",background:T==="B"?"#fff":"#2c3e50",color:T==="B"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test B: Corrupted"}),l.jsx("button",{onClick:()=>be("default"),style:{padding:"8px 16px",background:T==="default"?"#fff":"#2c3e50",color:T==="default"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Default"})]}),T==="A"&&l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#e74c3c",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontSize:14},children:"Blue (floor)  Red (middle)  Blue (top)"}),l.jsx("button",{onClick:()=>Ce(),style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Stack"})]}),T==="B"&&l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#16a085",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Corrupted Shape:"}),l.jsxs("select",{value:M,onChange:b=>U(b.target.value),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#fff",cursor:"pointer"},children:[l.jsx("option",{value:"T_T_C",children:"T Corrupted (split T)"}),l.jsx("option",{value:"T_I_C",children:"I Corrupted (split I)"}),l.jsx("option",{value:"T_L_C",children:"L Corrupted (diagonal L)"}),l.jsx("option",{value:"T_S_C",children:"S Corrupted (diagonal S)"}),l.jsx("option",{value:"T_O_C",children:"O Corrupted (split O)"})]}),l.jsx("span",{style:{fontWeight:"bold",marginLeft:10},children:"Rotate:"}),l.jsx("button",{onClick:()=>te(b=>(b+3)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CCW"}),l.jsx("button",{onClick:()=>te(b=>(b+1)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CW"}),l.jsxs("span",{style:{opacity:.7},children:[ee*90,""]}),l.jsx("button",{onClick:ue,disabled:a.current!==null,style:{padding:"8px 16px",background:a.current!==null?"#7f8c8d":"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold",marginLeft:10},children:"Spawn Corrupted"})]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Do.map((b,_)=>l.jsx("button",{onClick:()=>j(b),style:{width:30,height:30,background:b,border:C===b?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},b)),l.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(b=>l.jsx("button",{onClick:()=>R(b),style:{padding:"6px 12px",background:P===b?"#fff":"#2c3e50",color:P===b?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:b},b))]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("button",{onClick:F,disabled:a.current!==null,style:{padding:"10px 20px",background:a.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),l.jsx("button",{onClick:D,disabled:a.current===null,style:{padding:"10px 20px",background:a.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:a.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),l.jsx("button",{onClick:L,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[l.jsx("input",{type:"checkbox",checked:h,onChange:b=>x(b.target.checked)}),l.jsx("span",{children:"Show Grid"})]}),l.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),ie&&l.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[l.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),l.jsxs("div",{style:{display:"flex",gap:10},children:[l.jsx("button",{onClick:we,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),l.jsx("button",{onClick:()=>le(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ia).map(b=>l.jsx("button",{onClick:()=>G(b),style:{padding:"6px 12px",background:w===b?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===b?"bold":"normal",fontSize:12},children:b.charAt(0).toUpperCase()+b.slice(1)},b))}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:b=>y(_=>({..._,fillRate:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),l.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:b=>u(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:b=>d(_=>({..._,wallThickness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:b=>y(_=>({..._,autoFill:b.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:b=>d(_=>({..._,damping:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Stiffness: ",f.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:b=>d(_=>({..._,stiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:b=>d(_=>({..._,pressure:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:b=>d(_=>({..._,homeStiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:b=>d(_=>({..._,innerHomeStiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:b=>d(_=>({..._,returnSpeed:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:b=>d(_=>({..._,viscosity:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Iterations: ",f.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:b=>d(_=>({..._,iterations:Number(b.target.value)})),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Strength: ",N]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:N,onChange:b=>z(Number(b.target.value)),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Radius: ",Q.toFixed(1)," cells"]}),l.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:Q,onChange:b=>B(Number(b.target.value)),style:{width:100}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Droplets: ",ve]}),l.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:ve,onChange:b=>Te(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Speed: ",pe]}),l.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:pe,onChange:b=>A(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Lifetime: ",Y.toFixed(1),"s"]}),l.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:Y,onChange:b=>H(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Size: ",W,"px"]}),l.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:W,onChange:b=>me(Number(b.target.value)),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),l.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:b=>d(_=>({..._,goopiness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:b=>d(_=>({..._,attractionRadius:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:b=>d(_=>({..._,attractionStiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:b=>d(_=>({..._,tendrilEndRadius:Number(b.target.value)})),style:{width:80}})]})]})]}),l.jsxs("svg",{ref:e,width:B3,height:z3,style:{background:re,borderRadius:8},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:X(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&l.jsxs("g",{opacity:.2,children:[Array.from({length:ln+1}).map((b,_)=>l.jsx("line",{x1:kn+_*ct,y1:wn,x2:kn+_*ct,y2:wn+et*ct,stroke:"#fff",strokeWidth:1},`v${_}`)),Array.from({length:et+1}).map((b,_)=>l.jsx("line",{x1:kn,y1:wn+_*ct,x2:kn+ln*ct,y2:wn+_*ct,stroke:"#fff",strokeWidth:1},`h${_}`))]}),l.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((b,_)=>{const O=s.current[b.blobA],$=s.current[b.blobB];if(!O||!$)return null;const K=O.vertices[b.vertA],se=$.vertices[b.vertB];if(!K||!se)return null;const de=se.pos.x-K.pos.x,ge=se.pos.y-K.pos.y,J=Math.sqrt(de*de+ge*ge),Ne=Math.min(1,J/f.goopiness),Me=f.tendrilEndRadius,Ge=1-f.tendrilSkinniness,He=1-f.tendrilSkinniness*.3,Be=He-(He-Ge)*Ne,_e=Me*Be,Je=Me*1.4,ce=Math.max(2,Math.ceil(J/Je)),it=[];for(let lt=0;lt<=ce;lt++){const Rt=lt/ce,he=Math.sin(Rt*Math.PI),fe=Me-(Me-_e)*he;it.push({cx:K.pos.x+de*Rt,cy:K.pos.y+ge*Rt,r:Math.max(2,fe)})}return l.jsx("g",{children:it.map((lt,Rt)=>l.jsx("circle",{cx:lt.cx,cy:lt.cy,r:lt.r,fill:O.color},Rt))},`tendril-${_}`)}),s.current.map((b,_)=>{const O=b.isLocked&&b.fillAmount>=1;return l.jsx("g",{style:{cursor:O?"pointer":"default"},onClick:()=>O&&Re(b),children:l.jsx("path",{d:f5(b.vertices),fill:b.color,stroke:b.color,strokeWidth:2})},b.id)})]}),s.current.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const _=b.vertices.map(J=>J.pos),O=d5(_,f.wallThickness),$=ke(O),K=$.maxY-$.minY,se=$.maxY-K*b.fillAmount,de=50,ge=`unfilled-clip-${b.id}`;return l.jsxs("g",{children:[l.jsx("defs",{children:l.jsx("clipPath",{id:ge,children:l.jsx("rect",{x:$.minX-de,y:$.minY-de,width:$.maxX-$.minX+de*2,height:se-$.minY+de})})}),l.jsx("path",{d:U0(O),fill:re,clipPath:`url(#${ge})`})]},`inner-${b.id}`)}),l.jsx("g",{children:oe.current.map(b=>l.jsx("circle",{cx:b.pos.x,cy:b.pos.y,r:b.radius,fill:b.color,opacity:b.opacity},b.id))}),s.current.filter(b=>b.gridCells.length>4).map(b=>l.jsxs("g",{children:[b.vertices.map((_,O)=>l.jsxs("g",{children:[l.jsx("circle",{cx:_.pos.x,cy:_.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),l.jsx("text",{x:_.pos.x+6,y:_.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:O})]},`v-${O}`)),b.vertices.map((_,O)=>{const $=b.vertices[(O+1)%b.vertices.length];return l.jsx("line",{x1:_.pos.x,y1:_.pos.y,x2:$.pos.x,y2:$.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${O}`)})]},`debug-verts-${b.id}`)),s.current.map((b,_)=>l.jsx("text",{x:b.targetX,y:b.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:b.isLocked?`${Math.round(b.fillAmount*100)}%`:"falling"},`info-${b.id}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-8: Pop"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"How to test:"}),l.jsx("br",{})," Wait for a blob to fill to 100%",l.jsx("br",{})," Click the filled blob to pop it",l.jsx("br",{})," Droplets scatter outward and fade",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",l.jsx("strong",{children:"Droplets:"})," ",oe.current.length]})]})}const h5=()=>new URLSearchParams(window.location.search).get("proto"),x5=()=>{var y;const[e,t]=g.useState("GAME"),[n,s]=g.useState(()=>av()),[r,o]=g.useState(0);fv(),g.useEffect(()=>{cv(n)},[n]),g.useEffect(()=>{Tt.init(n.settings)},[]);const a=g.useCallback(v=>{s(k=>{const w=gt(k.careerScore),{newCareerScore:m,ranksGained:h}=A0(k.careerScore,v.score,v.won),x=gt(m),C=h>0?h:0,P=Um(w.rank,x.rank).filter(R=>!k.milestonesReached.includes(R));return P.length>0&&xe.emit(ae.MILESTONE_REACHED,{milestones:P}),{...k,careerScore:m,careerRank:x.rank,scraps:k.scraps+C,milestonesReached:[...k.milestonesReached,...P],firstRunComplete:!0}})},[]),i=v=>{s(k=>({...k,settings:v})),Tt.updateSettings(v)},c=v=>{if(v===0){const k=uv();s(k),o(w=>w+1),Tt.init(k.settings)}else{const k=Hm(v);s(w=>({...w,careerScore:k,careerRank:v,scraps:v,powerUps:{}})),o(w=>w+1)}},u=g.useCallback(v=>{s(k=>{const w=k.powerUps[v]||0,m=Nn[v],h=(m==null?void 0:m.maxLevel)||4,x=(m==null?void 0:m.costPerLevel)||1;return k.scraps<x||w>=h?k:{...k,scraps:k.scraps-x,powerUps:{...k.powerUps,[v]:w+1}}})},[]),f=g.useCallback(v=>{s(k=>{const w=k.powerUps[v]||0,m=Nn[v],h=(m==null?void 0:m.costPerLevel)||1;if(w<=0)return k;let x=k.equippedActives;return w===1&&k.equippedActives.includes(v)&&(x=k.equippedActives.filter(C=>C!==v)),{...k,scraps:k.scraps+h,powerUps:{...k.powerUps,[v]:w-1},equippedActives:x}})},[]),d=g.useCallback(v=>{s(k=>{const w=k.equippedActives.includes(v);let m;if(w)m=k.equippedActives.filter(h=>h!==v);else{const x=1+((k.powerUps.ACTIVE_EXPANSION_SLOT||0)+(k.powerUps.ACTIVE_EXPANSION_SLOT_2||0));k.equippedActives.length>=x?m=[...k.equippedActives.slice(0,x-1),v]:m=[...k.equippedActives,v]}return{...k,equippedActives:m}})},[]),p=h5();return p==="1"?l.jsx(gv,{}):p==="2"?l.jsx(Tv,{}):p==="3"?l.jsx(Dv,{}):p==="4"?l.jsx(Vv,{}):p==="5"?l.jsx(i2,{}):p==="5b"?l.jsx(S2,{}):p==="5c"?l.jsx(_2,{}):p==="6"?l.jsx(V2,{}):p==="7"?l.jsx(y3,{}):p==="8"?l.jsx(G3,{}):p==="9"?l.jsx(p5,{}):l.jsxs("div",{className:"w-full h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[e==="GAME"&&l.jsx(nv,{onExit:()=>{},onRunComplete:a,initialTotalScore:n.careerScore,powerUps:n.powerUps,scraps:n.scraps,settings:n.settings,onOpenSettings:()=>t("SETTINGS"),onOpenHelp:()=>t("HOW_TO_PLAY"),onOpenUpgrades:()=>t("UPGRADES"),onSetRank:c,onPurchaseUpgrade:u,onRefundUpgrade:f,equippedActives:n.equippedActives,onToggleEquip:d,saveData:n,setSaveData:s},r),e==="UPGRADES"&&l.jsx(sv,{onBack:()=>t("GAME")}),e==="SETTINGS"&&l.jsx(ov,{settings:n.settings,onUpdate:i,onBack:()=>t("GAME")}),e==="HOW_TO_PLAY"&&l.jsx(iv,{completedSteps:((y=n.tutorialProgress)==null?void 0:y.completedSteps)??[],onBack:()=>t("GAME")})]})},X0=document.getElementById("root");if(!X0)throw new Error("Could not find root element to mount to");const y5=la.createRoot(X0);y5.render(l.jsx(vh.StrictMode,{children:l.jsx(x5,{})}));
