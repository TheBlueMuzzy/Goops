var bp=Object.defineProperty;var Mp=(e,t,n)=>t in e?bp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ze=(e,t,n)=>(Mp(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function Tp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Xf={exports:{}},Di={},Vf={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ur=Symbol.for("react.element"),Ep=Symbol.for("react.portal"),Ap=Symbol.for("react.fragment"),_p=Symbol.for("react.strict_mode"),Ip=Symbol.for("react.profiler"),Lp=Symbol.for("react.provider"),Np=Symbol.for("react.context"),Op=Symbol.for("react.forward_ref"),Dp=Symbol.for("react.suspense"),$p=Symbol.for("react.memo"),Fp=Symbol.for("react.lazy"),Xa=Symbol.iterator;function Bp(e){return e===null||typeof e!="object"?null:(e=Xa&&e[Xa]||e["@@iterator"],typeof e=="function"?e:null)}var qf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Zf=Object.assign,Kf={};function ho(e,t,n){this.props=e,this.context=t,this.refs=Kf,this.updater=n||qf}ho.prototype.isReactComponent={};ho.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ho.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Qf(){}Qf.prototype=ho.prototype;function Uc(e,t,n){this.props=e,this.context=t,this.refs=Kf,this.updater=n||qf}var Xc=Uc.prototype=new Qf;Xc.constructor=Uc;Zf(Xc,ho.prototype);Xc.isPureReactComponent=!0;var Va=Array.isArray,Jf=Object.prototype.hasOwnProperty,Vc={current:null},ed={key:!0,ref:!0,__self:!0,__source:!0};function td(e,t,n){var s,r={},o=null,l=null;if(t!=null)for(s in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)Jf.call(t,s)&&!ed.hasOwnProperty(s)&&(r[s]=t[s]);var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){for(var a=Array(c),u=0;u<c;u++)a[u]=arguments[u+2];r.children=a}if(e&&e.defaultProps)for(s in c=e.defaultProps,c)r[s]===void 0&&(r[s]=c[s]);return{$$typeof:ur,type:e,key:o,ref:l,props:r,_owner:Vc.current}}function zp(e,t){return{$$typeof:ur,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function qc(e){return typeof e=="object"&&e!==null&&e.$$typeof===ur}function Gp(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var qa=/\/+/g;function tl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Gp(""+e.key):t.toString(36)}function Wr(e,t,n,s,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case ur:case Ep:l=!0}}if(l)return l=e,r=r(l),e=s===""?"."+tl(l,0):s,Va(r)?(n="",e!=null&&(n=e.replace(qa,"$&/")+"/"),Wr(r,t,n,"",function(u){return u})):r!=null&&(qc(r)&&(r=zp(r,n+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(qa,"$&/")+"/")+e)),t.push(r)),1;if(l=0,s=s===""?".":s+":",Va(e))for(var c=0;c<e.length;c++){o=e[c];var a=s+tl(o,c);l+=Wr(o,t,n,a,r)}else if(a=Bp(e),typeof a=="function")for(e=a.call(e),c=0;!(o=e.next()).done;)o=o.value,a=s+tl(o,c++),l+=Wr(o,t,n,a,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function xr(e,t,n){if(e==null)return e;var s=[],r=0;return Wr(e,s,"","",function(o){return t.call(n,o,r++)}),s}function Yp(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Dt={current:null},Ur={transition:null},Hp={ReactCurrentDispatcher:Dt,ReactCurrentBatchConfig:Ur,ReactCurrentOwner:Vc};function nd(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:xr,forEach:function(e,t,n){xr(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return xr(e,function(){t++}),t},toArray:function(e){return xr(e,function(t){return t})||[]},only:function(e){if(!qc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};He.Component=ho;He.Fragment=Ap;He.Profiler=Ip;He.PureComponent=Uc;He.StrictMode=_p;He.Suspense=Dp;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hp;He.act=nd;He.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Zf({},e.props),r=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=Vc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(a in t)Jf.call(t,a)&&!ed.hasOwnProperty(a)&&(s[a]=t[a]===void 0&&c!==void 0?c[a]:t[a])}var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){c=Array(a);for(var u=0;u<a;u++)c[u]=arguments[u+2];s.children=c}return{$$typeof:ur,type:e.type,key:r,ref:o,props:s,_owner:l}};He.createContext=function(e){return e={$$typeof:Np,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Lp,_context:e},e.Consumer=e};He.createElement=td;He.createFactory=function(e){var t=td.bind(null,e);return t.type=e,t};He.createRef=function(){return{current:null}};He.forwardRef=function(e){return{$$typeof:Op,render:e}};He.isValidElement=qc;He.lazy=function(e){return{$$typeof:Fp,_payload:{_status:-1,_result:e},_init:Yp}};He.memo=function(e,t){return{$$typeof:$p,type:e,compare:t===void 0?null:t}};He.startTransition=function(e){var t=Ur.transition;Ur.transition={};try{e()}finally{Ur.transition=t}};He.unstable_act=nd;He.useCallback=function(e,t){return Dt.current.useCallback(e,t)};He.useContext=function(e){return Dt.current.useContext(e)};He.useDebugValue=function(){};He.useDeferredValue=function(e){return Dt.current.useDeferredValue(e)};He.useEffect=function(e,t){return Dt.current.useEffect(e,t)};He.useId=function(){return Dt.current.useId()};He.useImperativeHandle=function(e,t,n){return Dt.current.useImperativeHandle(e,t,n)};He.useInsertionEffect=function(e,t){return Dt.current.useInsertionEffect(e,t)};He.useLayoutEffect=function(e,t){return Dt.current.useLayoutEffect(e,t)};He.useMemo=function(e,t){return Dt.current.useMemo(e,t)};He.useReducer=function(e,t,n){return Dt.current.useReducer(e,t,n)};He.useRef=function(e){return Dt.current.useRef(e)};He.useState=function(e){return Dt.current.useState(e)};He.useSyncExternalStore=function(e,t,n){return Dt.current.useSyncExternalStore(e,t,n)};He.useTransition=function(){return Dt.current.useTransition()};He.version="18.3.1";Vf.exports=He;var v=Vf.exports;const Wp=Tp(v);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Up=v,Xp=Symbol.for("react.element"),Vp=Symbol.for("react.fragment"),qp=Object.prototype.hasOwnProperty,Zp=Up.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Kp={key:!0,ref:!0,__self:!0,__source:!0};function sd(e,t,n){var s,r={},o=null,l=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(s in t)qp.call(t,s)&&!Kp.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:Xp,type:e,key:o,ref:l,props:r,_owner:Zp.current}}Di.Fragment=Vp;Di.jsx=sd;Di.jsxs=sd;Xf.exports=Di;var i=Xf.exports,ql={},od={exports:{}},Kt={},rd={exports:{}},id={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(W,Q){var Y=W.length;W.push(Q);e:for(;0<Y;){var re=Y-1>>>1,te=W[re];if(0<r(te,Q))W[re]=Q,W[Y]=te,Y=re;else break e}}function n(W){return W.length===0?null:W[0]}function s(W){if(W.length===0)return null;var Q=W[0],Y=W.pop();if(Y!==Q){W[0]=Y;e:for(var re=0,te=W.length,q=te>>>1;re<q;){var pe=2*(re+1)-1,we=W[pe],E=pe+1,B=W[E];if(0>r(we,Y))E<te&&0>r(B,we)?(W[re]=B,W[E]=Y,re=E):(W[re]=we,W[pe]=Y,re=pe);else if(E<te&&0>r(B,Y))W[re]=B,W[E]=Y,re=E;else break e}}return Q}function r(W,Q){var Y=W.sortIndex-Q.sortIndex;return Y!==0?Y:W.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var a=[],u=[],f=1,d=null,p=3,y=!1,S=!1,R=!1,j=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(W){for(var Q=n(u);Q!==null;){if(Q.callback===null)s(u);else if(Q.startTime<=W)s(u),Q.sortIndex=Q.expirationTime,t(a,Q);else break;Q=n(u)}}function m(W){if(R=!1,x(W),!S)if(n(a)!==null)S=!0,J(P);else{var Q=n(u);Q!==null&&ae(m,Q.startTime-W)}}function P(W,Q){S=!1,R&&(R=!1,g(w),w=-1),y=!0;var Y=p;try{for(x(Q),d=n(a);d!==null&&(!(d.expirationTime>Q)||W&&!O());){var re=d.callback;if(typeof re=="function"){d.callback=null,p=d.priorityLevel;var te=re(d.expirationTime<=Q);Q=e.unstable_now(),typeof te=="function"?d.callback=te:d===n(a)&&s(a),x(Q)}else s(a);d=n(a)}if(d!==null)var q=!0;else{var pe=n(u);pe!==null&&ae(m,pe.startTime-Q),q=!1}return q}finally{d=null,p=Y,y=!1}}var k=!1,C=null,w=-1,T=5,L=-1;function O(){return!(e.unstable_now()-L<T)}function X(){if(C!==null){var W=e.unstable_now();L=W;var Q=!0;try{Q=C(!0,W)}finally{Q?K():(k=!1,C=null)}}else k=!1}var K;if(typeof h=="function")K=function(){h(X)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,I=ee.port2;ee.port1.onmessage=X,K=function(){I.postMessage(null)}}else K=function(){j(X,0)};function J(W){C=W,k||(k=!0,K())}function ae(W,Q){w=j(function(){W(e.unstable_now())},Q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){S||y||(S=!0,J(P))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(W){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var Y=p;p=Q;try{return W()}finally{p=Y}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,Q){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Y=p;p=W;try{return Q()}finally{p=Y}},e.unstable_scheduleCallback=function(W,Q,Y){var re=e.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,W){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Y+te,W={id:f++,callback:Q,priorityLevel:W,startTime:Y,expirationTime:te,sortIndex:-1},Y>re?(W.sortIndex=Y,t(u,W),n(a)===null&&W===n(u)&&(R?(g(w),w=-1):R=!0,ae(m,Y-re))):(W.sortIndex=te,t(a,W),S||y||(S=!0,J(P))),W},e.unstable_shouldYield=O,e.unstable_wrapCallback=function(W){var Q=p;return function(){var Y=p;p=Q;try{return W.apply(this,arguments)}finally{p=Y}}}})(id);rd.exports=id;var Qp=rd.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jp=v,Zt=Qp;function fe(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ld=new Set,Xo={};function Ms(e,t){oo(e,t),oo(e+"Capture",t)}function oo(e,t){for(Xo[e]=t,e=0;e<t.length;e++)ld.add(t[e])}var Bn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zl=Object.prototype.hasOwnProperty,eh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Za={},Ka={};function th(e){return Zl.call(Ka,e)?!0:Zl.call(Za,e)?!1:eh.test(e)?Ka[e]=!0:(Za[e]=!0,!1)}function nh(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function sh(e,t,n,s){if(t===null||typeof t>"u"||nh(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function $t(e,t,n,s,r,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var Et={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Et[e]=new $t(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Et[t]=new $t(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Et[e]=new $t(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Et[e]=new $t(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Et[e]=new $t(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Et[e]=new $t(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Et[e]=new $t(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Et[e]=new $t(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Et[e]=new $t(e,5,!1,e.toLowerCase(),null,!1,!1)});var Zc=/[\-:]([a-z])/g;function Kc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Zc,Kc);Et[t]=new $t(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Zc,Kc);Et[t]=new $t(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Zc,Kc);Et[t]=new $t(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Et[e]=new $t(e,1,!1,e.toLowerCase(),null,!1,!1)});Et.xlinkHref=new $t("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Et[e]=new $t(e,1,!1,e.toLowerCase(),null,!0,!0)});function Qc(e,t,n,s){var r=Et.hasOwnProperty(t)?Et[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(sh(t,n,r,s)&&(n=null),s||r===null?th(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Hn=Jp.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yr=Symbol.for("react.element"),Fs=Symbol.for("react.portal"),Bs=Symbol.for("react.fragment"),Jc=Symbol.for("react.strict_mode"),Kl=Symbol.for("react.profiler"),cd=Symbol.for("react.provider"),ad=Symbol.for("react.context"),ea=Symbol.for("react.forward_ref"),Ql=Symbol.for("react.suspense"),Jl=Symbol.for("react.suspense_list"),ta=Symbol.for("react.memo"),Vn=Symbol.for("react.lazy"),ud=Symbol.for("react.offscreen"),Qa=Symbol.iterator;function go(e){return e===null||typeof e!="object"?null:(e=Qa&&e[Qa]||e["@@iterator"],typeof e=="function"?e:null)}var ht=Object.assign,nl;function Eo(e){if(nl===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);nl=t&&t[1]||""}return`
`+nl+e}var sl=!1;function ol(e,t){if(!e||sl)return"";sl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),l=r.length-1,c=o.length-1;1<=l&&0<=c&&r[l]!==o[c];)c--;for(;1<=l&&0<=c;l--,c--)if(r[l]!==o[c]){if(l!==1||c!==1)do if(l--,c--,0>c||r[l]!==o[c]){var a=`
`+r[l].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=l&&0<=c);break}}}finally{sl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Eo(e):""}function oh(e){switch(e.tag){case 5:return Eo(e.type);case 16:return Eo("Lazy");case 13:return Eo("Suspense");case 19:return Eo("SuspenseList");case 0:case 2:case 15:return e=ol(e.type,!1),e;case 11:return e=ol(e.type.render,!1),e;case 1:return e=ol(e.type,!0),e;default:return""}}function ec(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Bs:return"Fragment";case Fs:return"Portal";case Kl:return"Profiler";case Jc:return"StrictMode";case Ql:return"Suspense";case Jl:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case ad:return(e.displayName||"Context")+".Consumer";case cd:return(e._context.displayName||"Context")+".Provider";case ea:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ta:return t=e.displayName||null,t!==null?t:ec(e.type)||"Memo";case Vn:t=e._payload,e=e._init;try{return ec(e(t))}catch{}}return null}function rh(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ec(t);case 8:return t===Jc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function as(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function fd(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ih(e){var t=fd(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(l){s=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(l){s=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function gr(e){e._valueTracker||(e._valueTracker=ih(e))}function dd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=fd(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function ii(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function tc(e,t){var n=t.checked;return ht({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Ja(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=as(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function pd(e,t){t=t.checked,t!=null&&Qc(e,"checked",t,!1)}function nc(e,t){pd(e,t);var n=as(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?sc(e,t.type,n):t.hasOwnProperty("defaultValue")&&sc(e,t.type,as(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function eu(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function sc(e,t,n){(t!=="number"||ii(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Ao=Array.isArray;function Qs(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+as(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function oc(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(fe(91));return ht({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function tu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(fe(92));if(Ao(n)){if(1<n.length)throw Error(fe(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:as(n)}}function hd(e,t){var n=as(t.value),s=as(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function nu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function xd(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rc(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?xd(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mr,yd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(mr=mr||document.createElement("div"),mr.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=mr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Vo(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Oo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},lh=["Webkit","ms","Moz","O"];Object.keys(Oo).forEach(function(e){lh.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Oo[t]=Oo[e]})});function gd(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Oo.hasOwnProperty(e)&&Oo[e]?(""+t).trim():t+"px"}function md(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=gd(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var ch=ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ic(e,t){if(t){if(ch[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(fe(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(fe(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(fe(61))}if(t.style!=null&&typeof t.style!="object")throw Error(fe(62))}}function lc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cc=null;function na(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ac=null,Js=null,eo=null;function su(e){if(e=pr(e)){if(typeof ac!="function")throw Error(fe(280));var t=e.stateNode;t&&(t=Gi(t),ac(e.stateNode,e.type,t))}}function vd(e){Js?eo?eo.push(e):eo=[e]:Js=e}function Sd(){if(Js){var e=Js,t=eo;if(eo=Js=null,su(e),t)for(e=0;e<t.length;e++)su(t[e])}}function Cd(e,t){return e(t)}function kd(){}var rl=!1;function wd(e,t,n){if(rl)return e(t,n);rl=!0;try{return Cd(e,t,n)}finally{rl=!1,(Js!==null||eo!==null)&&(kd(),Sd())}}function qo(e,t){var n=e.stateNode;if(n===null)return null;var s=Gi(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(fe(231,t,typeof n));return n}var uc=!1;if(Bn)try{var mo={};Object.defineProperty(mo,"passive",{get:function(){uc=!0}}),window.addEventListener("test",mo,mo),window.removeEventListener("test",mo,mo)}catch{uc=!1}function ah(e,t,n,s,r,o,l,c,a){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(f){this.onError(f)}}var Do=!1,li=null,ci=!1,fc=null,uh={onError:function(e){Do=!0,li=e}};function fh(e,t,n,s,r,o,l,c,a){Do=!1,li=null,ah.apply(uh,arguments)}function dh(e,t,n,s,r,o,l,c,a){if(fh.apply(this,arguments),Do){if(Do){var u=li;Do=!1,li=null}else throw Error(fe(198));ci||(ci=!0,fc=u)}}function Ts(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function jd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function ou(e){if(Ts(e)!==e)throw Error(fe(188))}function ph(e){var t=e.alternate;if(!t){if(t=Ts(e),t===null)throw Error(fe(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return ou(r),e;if(o===s)return ou(r),t;o=o.sibling}throw Error(fe(188))}if(n.return!==s.return)n=r,s=o;else{for(var l=!1,c=r.child;c;){if(c===n){l=!0,n=r,s=o;break}if(c===s){l=!0,s=r,n=o;break}c=c.sibling}if(!l){for(c=o.child;c;){if(c===n){l=!0,n=o,s=r;break}if(c===s){l=!0,s=o,n=r;break}c=c.sibling}if(!l)throw Error(fe(189))}}if(n.alternate!==s)throw Error(fe(190))}if(n.tag!==3)throw Error(fe(188));return n.stateNode.current===n?e:t}function Pd(e){return e=ph(e),e!==null?Rd(e):null}function Rd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Rd(e);if(t!==null)return t;e=e.sibling}return null}var bd=Zt.unstable_scheduleCallback,ru=Zt.unstable_cancelCallback,hh=Zt.unstable_shouldYield,xh=Zt.unstable_requestPaint,yt=Zt.unstable_now,yh=Zt.unstable_getCurrentPriorityLevel,sa=Zt.unstable_ImmediatePriority,Md=Zt.unstable_UserBlockingPriority,ai=Zt.unstable_NormalPriority,gh=Zt.unstable_LowPriority,Td=Zt.unstable_IdlePriority,$i=null,Mn=null;function mh(e){if(Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot($i,e,void 0,(e.current.flags&128)===128)}catch{}}var Sn=Math.clz32?Math.clz32:Ch,vh=Math.log,Sh=Math.LN2;function Ch(e){return e>>>=0,e===0?32:31-(vh(e)/Sh|0)|0}var vr=64,Sr=4194304;function _o(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ui(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes,l=n&268435455;if(l!==0){var c=l&~r;c!==0?s=_o(c):(o&=l,o!==0&&(s=_o(o)))}else l=n&~r,l!==0?s=_o(l):o!==0&&(s=_o(o));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-Sn(t),r=1<<n,s|=e[n],t&=~r;return s}function kh(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wh(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-Sn(o),c=1<<l,a=r[l];a===-1?(!(c&n)||c&s)&&(r[l]=kh(c,t)):a<=t&&(e.expiredLanes|=c),o&=~c}}function dc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Ed(){var e=vr;return vr<<=1,!(vr&4194240)&&(vr=64),e}function il(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function fr(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Sn(t),e[t]=n}function jh(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-Sn(n),o=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~o}}function oa(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Sn(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var Ke=0;function Ad(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var _d,ra,Id,Ld,Nd,pc=!1,Cr=[],es=null,ts=null,ns=null,Zo=new Map,Ko=new Map,Zn=[],Ph="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function iu(e,t){switch(e){case"focusin":case"focusout":es=null;break;case"dragenter":case"dragleave":ts=null;break;case"mouseover":case"mouseout":ns=null;break;case"pointerover":case"pointerout":Zo.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ko.delete(t.pointerId)}}function vo(e,t,n,s,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},t!==null&&(t=pr(t),t!==null&&ra(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function Rh(e,t,n,s,r){switch(t){case"focusin":return es=vo(es,e,t,n,s,r),!0;case"dragenter":return ts=vo(ts,e,t,n,s,r),!0;case"mouseover":return ns=vo(ns,e,t,n,s,r),!0;case"pointerover":var o=r.pointerId;return Zo.set(o,vo(Zo.get(o)||null,e,t,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,Ko.set(o,vo(Ko.get(o)||null,e,t,n,s,r)),!0}return!1}function Od(e){var t=ms(e.target);if(t!==null){var n=Ts(t);if(n!==null){if(t=n.tag,t===13){if(t=jd(n),t!==null){e.blockedOn=t,Nd(e.priority,function(){Id(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xr(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=hc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);cc=s,n.target.dispatchEvent(s),cc=null}else return t=pr(n),t!==null&&ra(t),e.blockedOn=n,!1;t.shift()}return!0}function lu(e,t,n){Xr(e)&&n.delete(t)}function bh(){pc=!1,es!==null&&Xr(es)&&(es=null),ts!==null&&Xr(ts)&&(ts=null),ns!==null&&Xr(ns)&&(ns=null),Zo.forEach(lu),Ko.forEach(lu)}function So(e,t){e.blockedOn===t&&(e.blockedOn=null,pc||(pc=!0,Zt.unstable_scheduleCallback(Zt.unstable_NormalPriority,bh)))}function Qo(e){function t(r){return So(r,e)}if(0<Cr.length){So(Cr[0],e);for(var n=1;n<Cr.length;n++){var s=Cr[n];s.blockedOn===e&&(s.blockedOn=null)}}for(es!==null&&So(es,e),ts!==null&&So(ts,e),ns!==null&&So(ns,e),Zo.forEach(t),Ko.forEach(t),n=0;n<Zn.length;n++)s=Zn[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<Zn.length&&(n=Zn[0],n.blockedOn===null);)Od(n),n.blockedOn===null&&Zn.shift()}var to=Hn.ReactCurrentBatchConfig,fi=!0;function Mh(e,t,n,s){var r=Ke,o=to.transition;to.transition=null;try{Ke=1,ia(e,t,n,s)}finally{Ke=r,to.transition=o}}function Th(e,t,n,s){var r=Ke,o=to.transition;to.transition=null;try{Ke=4,ia(e,t,n,s)}finally{Ke=r,to.transition=o}}function ia(e,t,n,s){if(fi){var r=hc(e,t,n,s);if(r===null)yl(e,t,s,di,n),iu(e,s);else if(Rh(r,e,t,n,s))s.stopPropagation();else if(iu(e,s),t&4&&-1<Ph.indexOf(e)){for(;r!==null;){var o=pr(r);if(o!==null&&_d(o),o=hc(e,t,n,s),o===null&&yl(e,t,s,di,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else yl(e,t,s,null,n)}}var di=null;function hc(e,t,n,s){if(di=null,e=na(s),e=ms(e),e!==null)if(t=Ts(e),t===null)e=null;else if(n=t.tag,n===13){if(e=jd(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return di=e,null}function Dd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yh()){case sa:return 1;case Md:return 4;case ai:case gh:return 16;case Td:return 536870912;default:return 16}default:return 16}}var Qn=null,la=null,Vr=null;function $d(){if(Vr)return Vr;var e,t=la,n=t.length,s,r="value"in Qn?Qn.value:Qn.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var l=n-e;for(s=1;s<=l&&t[n-s]===r[o-s];s++);return Vr=r.slice(e,1<s?1-s:void 0)}function qr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function kr(){return!0}function cu(){return!1}function Qt(e){function t(n,s,r,o,l){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(n=e[c],this[c]=n?n(o):o[c]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?kr:cu,this.isPropagationStopped=cu,this}return ht(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=kr)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=kr)},persist:function(){},isPersistent:kr}),t}var xo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ca=Qt(xo),dr=ht({},xo,{view:0,detail:0}),Eh=Qt(dr),ll,cl,Co,Fi=ht({},dr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:aa,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Co&&(Co&&e.type==="mousemove"?(ll=e.screenX-Co.screenX,cl=e.screenY-Co.screenY):cl=ll=0,Co=e),ll)},movementY:function(e){return"movementY"in e?e.movementY:cl}}),au=Qt(Fi),Ah=ht({},Fi,{dataTransfer:0}),_h=Qt(Ah),Ih=ht({},dr,{relatedTarget:0}),al=Qt(Ih),Lh=ht({},xo,{animationName:0,elapsedTime:0,pseudoElement:0}),Nh=Qt(Lh),Oh=ht({},xo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Dh=Qt(Oh),$h=ht({},xo,{data:0}),uu=Qt($h),Fh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zh[e])?!!t[e]:!1}function aa(){return Gh}var Yh=ht({},dr,{key:function(e){if(e.key){var t=Fh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=qr(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Bh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:aa,charCode:function(e){return e.type==="keypress"?qr(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?qr(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Hh=Qt(Yh),Wh=ht({},Fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fu=Qt(Wh),Uh=ht({},dr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:aa}),Xh=Qt(Uh),Vh=ht({},xo,{propertyName:0,elapsedTime:0,pseudoElement:0}),qh=Qt(Vh),Zh=ht({},Fi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Kh=Qt(Zh),Qh=[9,13,27,32],ua=Bn&&"CompositionEvent"in window,$o=null;Bn&&"documentMode"in document&&($o=document.documentMode);var Jh=Bn&&"TextEvent"in window&&!$o,Fd=Bn&&(!ua||$o&&8<$o&&11>=$o),du=String.fromCharCode(32),pu=!1;function Bd(e,t){switch(e){case"keyup":return Qh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zd(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var zs=!1;function e1(e,t){switch(e){case"compositionend":return zd(t);case"keypress":return t.which!==32?null:(pu=!0,du);case"textInput":return e=t.data,e===du&&pu?null:e;default:return null}}function t1(e,t){if(zs)return e==="compositionend"||!ua&&Bd(e,t)?(e=$d(),Vr=la=Qn=null,zs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fd&&t.locale!=="ko"?null:t.data;default:return null}}var n1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function hu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!n1[e.type]:t==="textarea"}function Gd(e,t,n,s){vd(s),t=pi(t,"onChange"),0<t.length&&(n=new ca("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Fo=null,Jo=null;function s1(e){Jd(e,0)}function Bi(e){var t=Hs(e);if(dd(t))return e}function o1(e,t){if(e==="change")return t}var Yd=!1;if(Bn){var ul;if(Bn){var fl="oninput"in document;if(!fl){var xu=document.createElement("div");xu.setAttribute("oninput","return;"),fl=typeof xu.oninput=="function"}ul=fl}else ul=!1;Yd=ul&&(!document.documentMode||9<document.documentMode)}function yu(){Fo&&(Fo.detachEvent("onpropertychange",Hd),Jo=Fo=null)}function Hd(e){if(e.propertyName==="value"&&Bi(Jo)){var t=[];Gd(t,Jo,e,na(e)),wd(s1,t)}}function r1(e,t,n){e==="focusin"?(yu(),Fo=t,Jo=n,Fo.attachEvent("onpropertychange",Hd)):e==="focusout"&&yu()}function i1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Bi(Jo)}function l1(e,t){if(e==="click")return Bi(t)}function c1(e,t){if(e==="input"||e==="change")return Bi(t)}function a1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var kn=typeof Object.is=="function"?Object.is:a1;function er(e,t){if(kn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Zl.call(t,r)||!kn(e[r],t[r]))return!1}return!0}function gu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function mu(e,t){var n=gu(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=gu(n)}}function Wd(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Wd(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ud(){for(var e=window,t=ii();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=ii(e.document)}return t}function fa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function u1(e){var t=Ud(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Wd(n.ownerDocument.documentElement,n)){if(s!==null&&fa(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!e.extend&&o>s&&(r=s,s=o,o=r),r=mu(n,o);var l=mu(n,s);r&&l&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>s?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var f1=Bn&&"documentMode"in document&&11>=document.documentMode,Gs=null,xc=null,Bo=null,yc=!1;function vu(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;yc||Gs==null||Gs!==ii(s)||(s=Gs,"selectionStart"in s&&fa(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Bo&&er(Bo,s)||(Bo=s,s=pi(xc,"onSelect"),0<s.length&&(t=new ca("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Gs)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ys={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},dl={},Xd={};Bn&&(Xd=document.createElement("div").style,"AnimationEvent"in window||(delete Ys.animationend.animation,delete Ys.animationiteration.animation,delete Ys.animationstart.animation),"TransitionEvent"in window||delete Ys.transitionend.transition);function zi(e){if(dl[e])return dl[e];if(!Ys[e])return e;var t=Ys[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Xd)return dl[e]=t[n];return e}var Vd=zi("animationend"),qd=zi("animationiteration"),Zd=zi("animationstart"),Kd=zi("transitionend"),Qd=new Map,Su="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ps(e,t){Qd.set(e,t),Ms(t,[e])}for(var pl=0;pl<Su.length;pl++){var hl=Su[pl],d1=hl.toLowerCase(),p1=hl[0].toUpperCase()+hl.slice(1);ps(d1,"on"+p1)}ps(Vd,"onAnimationEnd");ps(qd,"onAnimationIteration");ps(Zd,"onAnimationStart");ps("dblclick","onDoubleClick");ps("focusin","onFocus");ps("focusout","onBlur");ps(Kd,"onTransitionEnd");oo("onMouseEnter",["mouseout","mouseover"]);oo("onMouseLeave",["mouseout","mouseover"]);oo("onPointerEnter",["pointerout","pointerover"]);oo("onPointerLeave",["pointerout","pointerover"]);Ms("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ms("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ms("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ms("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ms("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Io="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),h1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Io));function Cu(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,dh(s,t,void 0,e),e.currentTarget=null}function Jd(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var l=s.length-1;0<=l;l--){var c=s[l],a=c.instance,u=c.currentTarget;if(c=c.listener,a!==o&&r.isPropagationStopped())break e;Cu(r,c,u),o=a}else for(l=0;l<s.length;l++){if(c=s[l],a=c.instance,u=c.currentTarget,c=c.listener,a!==o&&r.isPropagationStopped())break e;Cu(r,c,u),o=a}}}if(ci)throw e=fc,ci=!1,fc=null,e}function tt(e,t){var n=t[Cc];n===void 0&&(n=t[Cc]=new Set);var s=e+"__bubble";n.has(s)||(e0(t,e,2,!1),n.add(s))}function xl(e,t,n){var s=0;t&&(s|=4),e0(n,e,s,t)}var jr="_reactListening"+Math.random().toString(36).slice(2);function tr(e){if(!e[jr]){e[jr]=!0,ld.forEach(function(n){n!=="selectionchange"&&(h1.has(n)||xl(n,!1,e),xl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[jr]||(t[jr]=!0,xl("selectionchange",!1,t))}}function e0(e,t,n,s){switch(Dd(t)){case 1:var r=Mh;break;case 4:r=Th;break;default:r=ia}n=r.bind(null,t,n,e),r=void 0,!uc||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function yl(e,t,n,s,r){var o=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var l=s.tag;if(l===3||l===4){var c=s.stateNode.containerInfo;if(c===r||c.nodeType===8&&c.parentNode===r)break;if(l===4)for(l=s.return;l!==null;){var a=l.tag;if((a===3||a===4)&&(a=l.stateNode.containerInfo,a===r||a.nodeType===8&&a.parentNode===r))return;l=l.return}for(;c!==null;){if(l=ms(c),l===null)return;if(a=l.tag,a===5||a===6){s=o=l;continue e}c=c.parentNode}}s=s.return}wd(function(){var u=o,f=na(n),d=[];e:{var p=Qd.get(e);if(p!==void 0){var y=ca,S=e;switch(e){case"keypress":if(qr(n)===0)break e;case"keydown":case"keyup":y=Hh;break;case"focusin":S="focus",y=al;break;case"focusout":S="blur",y=al;break;case"beforeblur":case"afterblur":y=al;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=au;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=_h;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=Xh;break;case Vd:case qd:case Zd:y=Nh;break;case Kd:y=qh;break;case"scroll":y=Eh;break;case"wheel":y=Kh;break;case"copy":case"cut":case"paste":y=Dh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=fu}var R=(t&4)!==0,j=!R&&e==="scroll",g=R?p!==null?p+"Capture":null:p;R=[];for(var h=u,x;h!==null;){x=h;var m=x.stateNode;if(x.tag===5&&m!==null&&(x=m,g!==null&&(m=qo(h,g),m!=null&&R.push(nr(h,m,x)))),j)break;h=h.return}0<R.length&&(p=new y(p,S,null,n,f),d.push({event:p,listeners:R}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",p&&n!==cc&&(S=n.relatedTarget||n.fromElement)&&(ms(S)||S[zn]))break e;if((y||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,y?(S=n.relatedTarget||n.toElement,y=u,S=S?ms(S):null,S!==null&&(j=Ts(S),S!==j||S.tag!==5&&S.tag!==6)&&(S=null)):(y=null,S=u),y!==S)){if(R=au,m="onMouseLeave",g="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(R=fu,m="onPointerLeave",g="onPointerEnter",h="pointer"),j=y==null?p:Hs(y),x=S==null?p:Hs(S),p=new R(m,h+"leave",y,n,f),p.target=j,p.relatedTarget=x,m=null,ms(f)===u&&(R=new R(g,h+"enter",S,n,f),R.target=x,R.relatedTarget=j,m=R),j=m,y&&S)t:{for(R=y,g=S,h=0,x=R;x;x=As(x))h++;for(x=0,m=g;m;m=As(m))x++;for(;0<h-x;)R=As(R),h--;for(;0<x-h;)g=As(g),x--;for(;h--;){if(R===g||g!==null&&R===g.alternate)break t;R=As(R),g=As(g)}R=null}else R=null;y!==null&&ku(d,p,y,R,!1),S!==null&&j!==null&&ku(d,j,S,R,!0)}}e:{if(p=u?Hs(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var P=o1;else if(hu(p))if(Yd)P=c1;else{P=i1;var k=r1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(P=l1);if(P&&(P=P(e,u))){Gd(d,P,n,f);break e}k&&k(e,p,u),e==="focusout"&&(k=p._wrapperState)&&k.controlled&&p.type==="number"&&sc(p,"number",p.value)}switch(k=u?Hs(u):window,e){case"focusin":(hu(k)||k.contentEditable==="true")&&(Gs=k,xc=u,Bo=null);break;case"focusout":Bo=xc=Gs=null;break;case"mousedown":yc=!0;break;case"contextmenu":case"mouseup":case"dragend":yc=!1,vu(d,n,f);break;case"selectionchange":if(f1)break;case"keydown":case"keyup":vu(d,n,f)}var C;if(ua)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else zs?Bd(e,n)&&(w="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&(Fd&&n.locale!=="ko"&&(zs||w!=="onCompositionStart"?w==="onCompositionEnd"&&zs&&(C=$d()):(Qn=f,la="value"in Qn?Qn.value:Qn.textContent,zs=!0)),k=pi(u,w),0<k.length&&(w=new uu(w,e,null,n,f),d.push({event:w,listeners:k}),C?w.data=C:(C=zd(n),C!==null&&(w.data=C)))),(C=Jh?e1(e,n):t1(e,n))&&(u=pi(u,"onBeforeInput"),0<u.length&&(f=new uu("onBeforeInput","beforeinput",null,n,f),d.push({event:f,listeners:u}),f.data=C))}Jd(d,t)})}function nr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function pi(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=qo(e,n),o!=null&&s.unshift(nr(e,o,r)),o=qo(e,t),o!=null&&s.push(nr(e,o,r))),e=e.return}return s}function As(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ku(e,t,n,s,r){for(var o=t._reactName,l=[];n!==null&&n!==s;){var c=n,a=c.alternate,u=c.stateNode;if(a!==null&&a===s)break;c.tag===5&&u!==null&&(c=u,r?(a=qo(n,o),a!=null&&l.unshift(nr(n,a,c))):r||(a=qo(n,o),a!=null&&l.push(nr(n,a,c)))),n=n.return}l.length!==0&&e.push({event:t,listeners:l})}var x1=/\r\n?/g,y1=/\u0000|\uFFFD/g;function wu(e){return(typeof e=="string"?e:""+e).replace(x1,`
`).replace(y1,"")}function Pr(e,t,n){if(t=wu(t),wu(e)!==t&&n)throw Error(fe(425))}function hi(){}var gc=null,mc=null;function vc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sc=typeof setTimeout=="function"?setTimeout:void 0,g1=typeof clearTimeout=="function"?clearTimeout:void 0,ju=typeof Promise=="function"?Promise:void 0,m1=typeof queueMicrotask=="function"?queueMicrotask:typeof ju<"u"?function(e){return ju.resolve(null).then(e).catch(v1)}:Sc;function v1(e){setTimeout(function(){throw e})}function gl(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),Qo(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Qo(t)}function ss(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Pu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var yo=Math.random().toString(36).slice(2),bn="__reactFiber$"+yo,sr="__reactProps$"+yo,zn="__reactContainer$"+yo,Cc="__reactEvents$"+yo,S1="__reactListeners$"+yo,C1="__reactHandles$"+yo;function ms(e){var t=e[bn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[zn]||n[bn]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Pu(e);e!==null;){if(n=e[bn])return n;e=Pu(e)}return t}e=n,n=e.parentNode}return null}function pr(e){return e=e[bn]||e[zn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Hs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(fe(33))}function Gi(e){return e[sr]||null}var kc=[],Ws=-1;function hs(e){return{current:e}}function nt(e){0>Ws||(e.current=kc[Ws],kc[Ws]=null,Ws--)}function et(e,t){Ws++,kc[Ws]=e.current,e.current=t}var us={},Lt=hs(us),Gt=hs(!1),ws=us;function ro(e,t){var n=e.type.contextTypes;if(!n)return us;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Yt(e){return e=e.childContextTypes,e!=null}function xi(){nt(Gt),nt(Lt)}function Ru(e,t,n){if(Lt.current!==us)throw Error(fe(168));et(Lt,t),et(Gt,n)}function t0(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(fe(108,rh(e)||"Unknown",r));return ht({},n,s)}function yi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||us,ws=Lt.current,et(Lt,e),et(Gt,Gt.current),!0}function bu(e,t,n){var s=e.stateNode;if(!s)throw Error(fe(169));n?(e=t0(e,t,ws),s.__reactInternalMemoizedMergedChildContext=e,nt(Gt),nt(Lt),et(Lt,e)):nt(Gt),et(Gt,n)}var In=null,Yi=!1,ml=!1;function n0(e){In===null?In=[e]:In.push(e)}function k1(e){Yi=!0,n0(e)}function xs(){if(!ml&&In!==null){ml=!0;var e=0,t=Ke;try{var n=In;for(Ke=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}In=null,Yi=!1}catch(r){throw In!==null&&(In=In.slice(e+1)),bd(sa,xs),r}finally{Ke=t,ml=!1}}return null}var Us=[],Xs=0,gi=null,mi=0,tn=[],nn=0,js=null,Nn=1,On="";function ys(e,t){Us[Xs++]=mi,Us[Xs++]=gi,gi=e,mi=t}function s0(e,t,n){tn[nn++]=Nn,tn[nn++]=On,tn[nn++]=js,js=e;var s=Nn;e=On;var r=32-Sn(s)-1;s&=~(1<<r),n+=1;var o=32-Sn(t)+r;if(30<o){var l=r-r%5;o=(s&(1<<l)-1).toString(32),s>>=l,r-=l,Nn=1<<32-Sn(t)+r|n<<r|s,On=o+e}else Nn=1<<o|n<<r|s,On=e}function da(e){e.return!==null&&(ys(e,1),s0(e,1,0))}function pa(e){for(;e===gi;)gi=Us[--Xs],Us[Xs]=null,mi=Us[--Xs],Us[Xs]=null;for(;e===js;)js=tn[--nn],tn[nn]=null,On=tn[--nn],tn[nn]=null,Nn=tn[--nn],tn[nn]=null}var qt=null,Vt=null,st=!1,pn=null;function o0(e,t){var n=on(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Mu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,qt=e,Vt=ss(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,qt=e,Vt=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=js!==null?{id:Nn,overflow:On}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=on(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,qt=e,Vt=null,!0):!1;default:return!1}}function wc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function jc(e){if(st){var t=Vt;if(t){var n=t;if(!Mu(e,t)){if(wc(e))throw Error(fe(418));t=ss(n.nextSibling);var s=qt;t&&Mu(e,t)?o0(s,n):(e.flags=e.flags&-4097|2,st=!1,qt=e)}}else{if(wc(e))throw Error(fe(418));e.flags=e.flags&-4097|2,st=!1,qt=e}}}function Tu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;qt=e}function Rr(e){if(e!==qt)return!1;if(!st)return Tu(e),st=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!vc(e.type,e.memoizedProps)),t&&(t=Vt)){if(wc(e))throw r0(),Error(fe(418));for(;t;)o0(e,t),t=ss(t.nextSibling)}if(Tu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(fe(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Vt=ss(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Vt=null}}else Vt=qt?ss(e.stateNode.nextSibling):null;return!0}function r0(){for(var e=Vt;e;)e=ss(e.nextSibling)}function io(){Vt=qt=null,st=!1}function ha(e){pn===null?pn=[e]:pn.push(e)}var w1=Hn.ReactCurrentBatchConfig;function ko(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(fe(309));var s=n.stateNode}if(!s)throw Error(fe(147,e));var r=s,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var c=r.refs;l===null?delete c[o]:c[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(fe(284));if(!n._owner)throw Error(fe(290,e))}return e}function br(e,t){throw e=Object.prototype.toString.call(t),Error(fe(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Eu(e){var t=e._init;return t(e._payload)}function i0(e){function t(g,h){if(e){var x=g.deletions;x===null?(g.deletions=[h],g.flags|=16):x.push(h)}}function n(g,h){if(!e)return null;for(;h!==null;)t(g,h),h=h.sibling;return null}function s(g,h){for(g=new Map;h!==null;)h.key!==null?g.set(h.key,h):g.set(h.index,h),h=h.sibling;return g}function r(g,h){return g=ls(g,h),g.index=0,g.sibling=null,g}function o(g,h,x){return g.index=x,e?(x=g.alternate,x!==null?(x=x.index,x<h?(g.flags|=2,h):x):(g.flags|=2,h)):(g.flags|=1048576,h)}function l(g){return e&&g.alternate===null&&(g.flags|=2),g}function c(g,h,x,m){return h===null||h.tag!==6?(h=Pl(x,g.mode,m),h.return=g,h):(h=r(h,x),h.return=g,h)}function a(g,h,x,m){var P=x.type;return P===Bs?f(g,h,x.props.children,m,x.key):h!==null&&(h.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Vn&&Eu(P)===h.type)?(m=r(h,x.props),m.ref=ko(g,h,x),m.return=g,m):(m=ni(x.type,x.key,x.props,null,g.mode,m),m.ref=ko(g,h,x),m.return=g,m)}function u(g,h,x,m){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=Rl(x,g.mode,m),h.return=g,h):(h=r(h,x.children||[]),h.return=g,h)}function f(g,h,x,m,P){return h===null||h.tag!==7?(h=ks(x,g.mode,m,P),h.return=g,h):(h=r(h,x),h.return=g,h)}function d(g,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Pl(""+h,g.mode,x),h.return=g,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case yr:return x=ni(h.type,h.key,h.props,null,g.mode,x),x.ref=ko(g,null,h),x.return=g,x;case Fs:return h=Rl(h,g.mode,x),h.return=g,h;case Vn:var m=h._init;return d(g,m(h._payload),x)}if(Ao(h)||go(h))return h=ks(h,g.mode,x,null),h.return=g,h;br(g,h)}return null}function p(g,h,x,m){var P=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return P!==null?null:c(g,h,""+x,m);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case yr:return x.key===P?a(g,h,x,m):null;case Fs:return x.key===P?u(g,h,x,m):null;case Vn:return P=x._init,p(g,h,P(x._payload),m)}if(Ao(x)||go(x))return P!==null?null:f(g,h,x,m,null);br(g,x)}return null}function y(g,h,x,m,P){if(typeof m=="string"&&m!==""||typeof m=="number")return g=g.get(x)||null,c(h,g,""+m,P);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case yr:return g=g.get(m.key===null?x:m.key)||null,a(h,g,m,P);case Fs:return g=g.get(m.key===null?x:m.key)||null,u(h,g,m,P);case Vn:var k=m._init;return y(g,h,x,k(m._payload),P)}if(Ao(m)||go(m))return g=g.get(x)||null,f(h,g,m,P,null);br(h,m)}return null}function S(g,h,x,m){for(var P=null,k=null,C=h,w=h=0,T=null;C!==null&&w<x.length;w++){C.index>w?(T=C,C=null):T=C.sibling;var L=p(g,C,x[w],m);if(L===null){C===null&&(C=T);break}e&&C&&L.alternate===null&&t(g,C),h=o(L,h,w),k===null?P=L:k.sibling=L,k=L,C=T}if(w===x.length)return n(g,C),st&&ys(g,w),P;if(C===null){for(;w<x.length;w++)C=d(g,x[w],m),C!==null&&(h=o(C,h,w),k===null?P=C:k.sibling=C,k=C);return st&&ys(g,w),P}for(C=s(g,C);w<x.length;w++)T=y(C,g,w,x[w],m),T!==null&&(e&&T.alternate!==null&&C.delete(T.key===null?w:T.key),h=o(T,h,w),k===null?P=T:k.sibling=T,k=T);return e&&C.forEach(function(O){return t(g,O)}),st&&ys(g,w),P}function R(g,h,x,m){var P=go(x);if(typeof P!="function")throw Error(fe(150));if(x=P.call(x),x==null)throw Error(fe(151));for(var k=P=null,C=h,w=h=0,T=null,L=x.next();C!==null&&!L.done;w++,L=x.next()){C.index>w?(T=C,C=null):T=C.sibling;var O=p(g,C,L.value,m);if(O===null){C===null&&(C=T);break}e&&C&&O.alternate===null&&t(g,C),h=o(O,h,w),k===null?P=O:k.sibling=O,k=O,C=T}if(L.done)return n(g,C),st&&ys(g,w),P;if(C===null){for(;!L.done;w++,L=x.next())L=d(g,L.value,m),L!==null&&(h=o(L,h,w),k===null?P=L:k.sibling=L,k=L);return st&&ys(g,w),P}for(C=s(g,C);!L.done;w++,L=x.next())L=y(C,g,w,L.value,m),L!==null&&(e&&L.alternate!==null&&C.delete(L.key===null?w:L.key),h=o(L,h,w),k===null?P=L:k.sibling=L,k=L);return e&&C.forEach(function(X){return t(g,X)}),st&&ys(g,w),P}function j(g,h,x,m){if(typeof x=="object"&&x!==null&&x.type===Bs&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case yr:e:{for(var P=x.key,k=h;k!==null;){if(k.key===P){if(P=x.type,P===Bs){if(k.tag===7){n(g,k.sibling),h=r(k,x.props.children),h.return=g,g=h;break e}}else if(k.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Vn&&Eu(P)===k.type){n(g,k.sibling),h=r(k,x.props),h.ref=ko(g,k,x),h.return=g,g=h;break e}n(g,k);break}else t(g,k);k=k.sibling}x.type===Bs?(h=ks(x.props.children,g.mode,m,x.key),h.return=g,g=h):(m=ni(x.type,x.key,x.props,null,g.mode,m),m.ref=ko(g,h,x),m.return=g,g=m)}return l(g);case Fs:e:{for(k=x.key;h!==null;){if(h.key===k)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(g,h.sibling),h=r(h,x.children||[]),h.return=g,g=h;break e}else{n(g,h);break}else t(g,h);h=h.sibling}h=Rl(x,g.mode,m),h.return=g,g=h}return l(g);case Vn:return k=x._init,j(g,h,k(x._payload),m)}if(Ao(x))return S(g,h,x,m);if(go(x))return R(g,h,x,m);br(g,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(g,h.sibling),h=r(h,x),h.return=g,g=h):(n(g,h),h=Pl(x,g.mode,m),h.return=g,g=h),l(g)):n(g,h)}return j}var lo=i0(!0),l0=i0(!1),vi=hs(null),Si=null,Vs=null,xa=null;function ya(){xa=Vs=Si=null}function ga(e){var t=vi.current;nt(vi),e._currentValue=t}function Pc(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function no(e,t){Si=e,xa=Vs=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(zt=!0),e.firstContext=null)}function cn(e){var t=e._currentValue;if(xa!==e)if(e={context:e,memoizedValue:t,next:null},Vs===null){if(Si===null)throw Error(fe(308));Vs=e,Si.dependencies={lanes:0,firstContext:e}}else Vs=Vs.next=e;return t}var vs=null;function ma(e){vs===null?vs=[e]:vs.push(e)}function c0(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,ma(t)):(n.next=r.next,r.next=n),t.interleaved=n,Gn(e,s)}function Gn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var qn=!1;function va(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function a0(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function os(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,qe&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Gn(e,n)}return r=s.interleaved,r===null?(t.next=t,ma(s)):(t.next=r.next,r.next=t),s.interleaved=t,Gn(e,n)}function Zr(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,oa(e,n)}}function Au(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=l:o=o.next=l,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ci(e,t,n,s){var r=e.updateQueue;qn=!1;var o=r.firstBaseUpdate,l=r.lastBaseUpdate,c=r.shared.pending;if(c!==null){r.shared.pending=null;var a=c,u=a.next;a.next=null,l===null?o=u:l.next=u,l=a;var f=e.alternate;f!==null&&(f=f.updateQueue,c=f.lastBaseUpdate,c!==l&&(c===null?f.firstBaseUpdate=u:c.next=u,f.lastBaseUpdate=a))}if(o!==null){var d=r.baseState;l=0,f=u=a=null,c=o;do{var p=c.lane,y=c.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:y,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var S=e,R=c;switch(p=t,y=n,R.tag){case 1:if(S=R.payload,typeof S=="function"){d=S.call(y,d,p);break e}d=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=R.payload,p=typeof S=="function"?S.call(y,d,p):S,p==null)break e;d=ht({},d,p);break e;case 2:qn=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,p=r.effects,p===null?r.effects=[c]:p.push(c))}else y={eventTime:y,lane:p,tag:c.tag,payload:c.payload,callback:c.callback,next:null},f===null?(u=f=y,a=d):f=f.next=y,l|=p;if(c=c.next,c===null){if(c=r.shared.pending,c===null)break;p=c,c=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(f===null&&(a=d),r.baseState=a,r.firstBaseUpdate=u,r.lastBaseUpdate=f,t=r.shared.interleaved,t!==null){r=t;do l|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Rs|=l,e.lanes=l,e.memoizedState=d}}function _u(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(fe(191,r));r.call(s)}}}var hr={},Tn=hs(hr),or=hs(hr),rr=hs(hr);function Ss(e){if(e===hr)throw Error(fe(174));return e}function Sa(e,t){switch(et(rr,t),et(or,e),et(Tn,hr),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:rc(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=rc(t,e)}nt(Tn),et(Tn,t)}function co(){nt(Tn),nt(or),nt(rr)}function u0(e){Ss(rr.current);var t=Ss(Tn.current),n=rc(t,e.type);t!==n&&(et(or,e),et(Tn,n))}function Ca(e){or.current===e&&(nt(Tn),nt(or))}var ft=hs(0);function ki(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var vl=[];function ka(){for(var e=0;e<vl.length;e++)vl[e]._workInProgressVersionPrimary=null;vl.length=0}var Kr=Hn.ReactCurrentDispatcher,Sl=Hn.ReactCurrentBatchConfig,Ps=0,pt=null,St=null,Pt=null,wi=!1,zo=!1,ir=0,j1=0;function At(){throw Error(fe(321))}function wa(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!kn(e[n],t[n]))return!1;return!0}function ja(e,t,n,s,r,o){if(Ps=o,pt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Kr.current=e===null||e.memoizedState===null?M1:T1,e=n(s,r),zo){o=0;do{if(zo=!1,ir=0,25<=o)throw Error(fe(301));o+=1,Pt=St=null,t.updateQueue=null,Kr.current=E1,e=n(s,r)}while(zo)}if(Kr.current=ji,t=St!==null&&St.next!==null,Ps=0,Pt=St=pt=null,wi=!1,t)throw Error(fe(300));return e}function Pa(){var e=ir!==0;return ir=0,e}function jn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pt===null?pt.memoizedState=Pt=e:Pt=Pt.next=e,Pt}function an(){if(St===null){var e=pt.alternate;e=e!==null?e.memoizedState:null}else e=St.next;var t=Pt===null?pt.memoizedState:Pt.next;if(t!==null)Pt=t,St=e;else{if(e===null)throw Error(fe(310));St=e,e={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},Pt===null?pt.memoizedState=Pt=e:Pt=Pt.next=e}return Pt}function lr(e,t){return typeof t=="function"?t(e):t}function Cl(e){var t=an(),n=t.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=e;var s=St,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var l=r.next;r.next=o.next,o.next=l}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var c=l=null,a=null,u=o;do{var f=u.lane;if((Ps&f)===f)a!==null&&(a=a.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var d={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};a===null?(c=a=d,l=s):a=a.next=d,pt.lanes|=f,Rs|=f}u=u.next}while(u!==null&&u!==o);a===null?l=s:a.next=c,kn(s,t.memoizedState)||(zt=!0),t.memoizedState=s,t.baseState=l,t.baseQueue=a,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do o=r.lane,pt.lanes|=o,Rs|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function kl(e){var t=an(),n=t.queue;if(n===null)throw Error(fe(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var l=r=r.next;do o=e(o,l.action),l=l.next;while(l!==r);kn(o,t.memoizedState)||(zt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function f0(){}function d0(e,t){var n=pt,s=an(),r=t(),o=!kn(s.memoizedState,r);if(o&&(s.memoizedState=r,zt=!0),s=s.queue,Ra(x0.bind(null,n,s,e),[e]),s.getSnapshot!==t||o||Pt!==null&&Pt.memoizedState.tag&1){if(n.flags|=2048,cr(9,h0.bind(null,n,s,r,t),void 0,null),bt===null)throw Error(fe(349));Ps&30||p0(n,t,r)}return r}function p0(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=pt.updateQueue,t===null?(t={lastEffect:null,stores:null},pt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function h0(e,t,n,s){t.value=n,t.getSnapshot=s,y0(t)&&g0(e)}function x0(e,t,n){return n(function(){y0(t)&&g0(e)})}function y0(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!kn(e,n)}catch{return!0}}function g0(e){var t=Gn(e,1);t!==null&&Cn(t,e,1,-1)}function Iu(e){var t=jn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lr,lastRenderedState:e},t.queue=e,e=e.dispatch=b1.bind(null,pt,e),[t.memoizedState,e]}function cr(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=pt.updateQueue,t===null?(t={lastEffect:null,stores:null},pt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function m0(){return an().memoizedState}function Qr(e,t,n,s){var r=jn();pt.flags|=e,r.memoizedState=cr(1|t,n,void 0,s===void 0?null:s)}function Hi(e,t,n,s){var r=an();s=s===void 0?null:s;var o=void 0;if(St!==null){var l=St.memoizedState;if(o=l.destroy,s!==null&&wa(s,l.deps)){r.memoizedState=cr(t,n,o,s);return}}pt.flags|=e,r.memoizedState=cr(1|t,n,o,s)}function Lu(e,t){return Qr(8390656,8,e,t)}function Ra(e,t){return Hi(2048,8,e,t)}function v0(e,t){return Hi(4,2,e,t)}function S0(e,t){return Hi(4,4,e,t)}function C0(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function k0(e,t,n){return n=n!=null?n.concat([e]):null,Hi(4,4,C0.bind(null,t,e),n)}function ba(){}function w0(e,t){var n=an();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wa(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function j0(e,t){var n=an();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wa(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function P0(e,t,n){return Ps&21?(kn(n,t)||(n=Ed(),pt.lanes|=n,Rs|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,zt=!0),e.memoizedState=n)}function P1(e,t){var n=Ke;Ke=n!==0&&4>n?n:4,e(!0);var s=Sl.transition;Sl.transition={};try{e(!1),t()}finally{Ke=n,Sl.transition=s}}function R0(){return an().memoizedState}function R1(e,t,n){var s=is(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},b0(e))M0(t,n);else if(n=c0(e,t,n,s),n!==null){var r=Ot();Cn(n,e,s,r),T0(n,t,s)}}function b1(e,t,n){var s=is(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(b0(e))M0(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,c=o(l,n);if(r.hasEagerState=!0,r.eagerState=c,kn(c,l)){var a=t.interleaved;a===null?(r.next=r,ma(t)):(r.next=a.next,a.next=r),t.interleaved=r;return}}catch{}finally{}n=c0(e,t,r,s),n!==null&&(r=Ot(),Cn(n,e,s,r),T0(n,t,s))}}function b0(e){var t=e.alternate;return e===pt||t!==null&&t===pt}function M0(e,t){zo=wi=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function T0(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,oa(e,n)}}var ji={readContext:cn,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useInsertionEffect:At,useLayoutEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useMutableSource:At,useSyncExternalStore:At,useId:At,unstable_isNewReconciler:!1},M1={readContext:cn,useCallback:function(e,t){return jn().memoizedState=[e,t===void 0?null:t],e},useContext:cn,useEffect:Lu,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Qr(4194308,4,C0.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Qr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Qr(4,2,e,t)},useMemo:function(e,t){var n=jn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=jn();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=R1.bind(null,pt,e),[s.memoizedState,e]},useRef:function(e){var t=jn();return e={current:e},t.memoizedState=e},useState:Iu,useDebugValue:ba,useDeferredValue:function(e){return jn().memoizedState=e},useTransition:function(){var e=Iu(!1),t=e[0];return e=P1.bind(null,e[1]),jn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=pt,r=jn();if(st){if(n===void 0)throw Error(fe(407));n=n()}else{if(n=t(),bt===null)throw Error(fe(349));Ps&30||p0(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Lu(x0.bind(null,s,o,e),[e]),s.flags|=2048,cr(9,h0.bind(null,s,o,n,t),void 0,null),n},useId:function(){var e=jn(),t=bt.identifierPrefix;if(st){var n=On,s=Nn;n=(s&~(1<<32-Sn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=ir++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=j1++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},T1={readContext:cn,useCallback:w0,useContext:cn,useEffect:Ra,useImperativeHandle:k0,useInsertionEffect:v0,useLayoutEffect:S0,useMemo:j0,useReducer:Cl,useRef:m0,useState:function(){return Cl(lr)},useDebugValue:ba,useDeferredValue:function(e){var t=an();return P0(t,St.memoizedState,e)},useTransition:function(){var e=Cl(lr)[0],t=an().memoizedState;return[e,t]},useMutableSource:f0,useSyncExternalStore:d0,useId:R0,unstable_isNewReconciler:!1},E1={readContext:cn,useCallback:w0,useContext:cn,useEffect:Ra,useImperativeHandle:k0,useInsertionEffect:v0,useLayoutEffect:S0,useMemo:j0,useReducer:kl,useRef:m0,useState:function(){return kl(lr)},useDebugValue:ba,useDeferredValue:function(e){var t=an();return St===null?t.memoizedState=e:P0(t,St.memoizedState,e)},useTransition:function(){var e=kl(lr)[0],t=an().memoizedState;return[e,t]},useMutableSource:f0,useSyncExternalStore:d0,useId:R0,unstable_isNewReconciler:!1};function fn(e,t){if(e&&e.defaultProps){t=ht({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Rc(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:ht({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Wi={isMounted:function(e){return(e=e._reactInternals)?Ts(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Ot(),r=is(e),o=Fn(s,r);o.payload=t,n!=null&&(o.callback=n),t=os(e,o,r),t!==null&&(Cn(t,e,r,s),Zr(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Ot(),r=is(e),o=Fn(s,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=os(e,o,r),t!==null&&(Cn(t,e,r,s),Zr(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ot(),s=is(e),r=Fn(n,s);r.tag=2,t!=null&&(r.callback=t),t=os(e,r,s),t!==null&&(Cn(t,e,s,n),Zr(t,e,s))}};function Nu(e,t,n,s,r,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,o,l):t.prototype&&t.prototype.isPureReactComponent?!er(n,s)||!er(r,o):!0}function E0(e,t,n){var s=!1,r=us,o=t.contextType;return typeof o=="object"&&o!==null?o=cn(o):(r=Yt(t)?ws:Lt.current,s=t.contextTypes,o=(s=s!=null)?ro(e,r):us),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Wi,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Ou(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&Wi.enqueueReplaceState(t,t.state,null)}function bc(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},va(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=cn(o):(o=Yt(t)?ws:Lt.current,r.context=ro(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Rc(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&Wi.enqueueReplaceState(r,r.state,null),Ci(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function ao(e,t){try{var n="",s=t;do n+=oh(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function wl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Mc(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var A1=typeof WeakMap=="function"?WeakMap:Map;function A0(e,t,n){n=Fn(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Ri||(Ri=!0,$c=s),Mc(e,t)},n}function _0(e,t,n){n=Fn(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Mc(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Mc(e,t),typeof s!="function"&&(rs===null?rs=new Set([this]):rs.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),n}function Du(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new A1;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=W1.bind(null,e,t,n),t.then(e,e))}function $u(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Fu(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Fn(-1,1),t.tag=2,os(n,t,1))),n.lanes|=1),e)}var _1=Hn.ReactCurrentOwner,zt=!1;function Nt(e,t,n,s){t.child=e===null?l0(t,null,n,s):lo(t,e.child,n,s)}function Bu(e,t,n,s,r){n=n.render;var o=t.ref;return no(t,r),s=ja(e,t,n,s,o,r),n=Pa(),e!==null&&!zt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Yn(e,t,r)):(st&&n&&da(t),t.flags|=1,Nt(e,t,s,r),t.child)}function zu(e,t,n,s,r){if(e===null){var o=n.type;return typeof o=="function"&&!Na(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,I0(e,t,o,s,r)):(e=ni(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var l=o.memoizedProps;if(n=n.compare,n=n!==null?n:er,n(l,s)&&e.ref===t.ref)return Yn(e,t,r)}return t.flags|=1,e=ls(o,s),e.ref=t.ref,e.return=t,t.child=e}function I0(e,t,n,s,r){if(e!==null){var o=e.memoizedProps;if(er(o,s)&&e.ref===t.ref)if(zt=!1,t.pendingProps=s=o,(e.lanes&r)!==0)e.flags&131072&&(zt=!0);else return t.lanes=e.lanes,Yn(e,t,r)}return Tc(e,t,n,s,r)}function L0(e,t,n){var s=t.pendingProps,r=s.children,o=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Zs,Xt),Xt|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,et(Zs,Xt),Xt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,et(Zs,Xt),Xt|=s}else o!==null?(s=o.baseLanes|n,t.memoizedState=null):s=n,et(Zs,Xt),Xt|=s;return Nt(e,t,r,n),t.child}function N0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Tc(e,t,n,s,r){var o=Yt(n)?ws:Lt.current;return o=ro(t,o),no(t,r),n=ja(e,t,n,s,o,r),s=Pa(),e!==null&&!zt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Yn(e,t,r)):(st&&s&&da(t),t.flags|=1,Nt(e,t,n,r),t.child)}function Gu(e,t,n,s,r){if(Yt(n)){var o=!0;yi(t)}else o=!1;if(no(t,r),t.stateNode===null)Jr(e,t),E0(t,n,s),bc(t,n,s,r),s=!0;else if(e===null){var l=t.stateNode,c=t.memoizedProps;l.props=c;var a=l.context,u=n.contextType;typeof u=="object"&&u!==null?u=cn(u):(u=Yt(n)?ws:Lt.current,u=ro(t,u));var f=n.getDerivedStateFromProps,d=typeof f=="function"||typeof l.getSnapshotBeforeUpdate=="function";d||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==s||a!==u)&&Ou(t,l,s,u),qn=!1;var p=t.memoizedState;l.state=p,Ci(t,s,l,r),a=t.memoizedState,c!==s||p!==a||Gt.current||qn?(typeof f=="function"&&(Rc(t,n,f,s),a=t.memoizedState),(c=qn||Nu(t,n,c,s,p,a,u))?(d||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=a),l.props=s,l.state=a,l.context=u,s=c):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{l=t.stateNode,a0(e,t),c=t.memoizedProps,u=t.type===t.elementType?c:fn(t.type,c),l.props=u,d=t.pendingProps,p=l.context,a=n.contextType,typeof a=="object"&&a!==null?a=cn(a):(a=Yt(n)?ws:Lt.current,a=ro(t,a));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(c!==d||p!==a)&&Ou(t,l,s,a),qn=!1,p=t.memoizedState,l.state=p,Ci(t,s,l,r);var S=t.memoizedState;c!==d||p!==S||Gt.current||qn?(typeof y=="function"&&(Rc(t,n,y,s),S=t.memoizedState),(u=qn||Nu(t,n,u,s,p,S,a)||!1)?(f||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(s,S,a),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(s,S,a)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=S),l.props=s,l.state=S,l.context=a,s=u):(typeof l.componentDidUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return Ec(e,t,n,s,o,r)}function Ec(e,t,n,s,r,o){N0(e,t);var l=(t.flags&128)!==0;if(!s&&!l)return r&&bu(t,n,!1),Yn(e,t,o);s=t.stateNode,_1.current=t;var c=l&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&l?(t.child=lo(t,e.child,null,o),t.child=lo(t,null,c,o)):Nt(e,t,c,o),t.memoizedState=s.state,r&&bu(t,n,!0),t.child}function O0(e){var t=e.stateNode;t.pendingContext?Ru(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Ru(e,t.context,!1),Sa(e,t.containerInfo)}function Yu(e,t,n,s,r){return io(),ha(r),t.flags|=256,Nt(e,t,n,s),t.child}var Ac={dehydrated:null,treeContext:null,retryLane:0};function _c(e){return{baseLanes:e,cachePool:null,transitions:null}}function D0(e,t,n){var s=t.pendingProps,r=ft.current,o=!1,l=(t.flags&128)!==0,c;if((c=l)||(c=e!==null&&e.memoizedState===null?!1:(r&2)!==0),c?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),et(ft,r&1),e===null)return jc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=Vi(l,s,0,null),e=ks(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=_c(n),t.memoizedState=Ac,e):Ma(t,l));if(r=e.memoizedState,r!==null&&(c=r.dehydrated,c!==null))return I1(e,t,l,s,c,r,n);if(o){o=s.fallback,l=t.mode,r=e.child,c=r.sibling;var a={mode:"hidden",children:s.children};return!(l&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=a,t.deletions=null):(s=ls(r,a),s.subtreeFlags=r.subtreeFlags&14680064),c!==null?o=ls(c,o):(o=ks(o,l,n,null),o.flags|=2),o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=e.child.memoizedState,l=l===null?_c(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Ac,s}return o=e.child,e=o.sibling,s=ls(o,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Ma(e,t){return t=Vi({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Mr(e,t,n,s){return s!==null&&ha(s),lo(t,e.child,null,n),e=Ma(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function I1(e,t,n,s,r,o,l){if(n)return t.flags&256?(t.flags&=-257,s=wl(Error(fe(422))),Mr(e,t,l,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=s.fallback,r=t.mode,s=Vi({mode:"visible",children:s.children},r,0,null),o=ks(o,r,l,null),o.flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,t.mode&1&&lo(t,e.child,null,l),t.child.memoizedState=_c(l),t.memoizedState=Ac,o);if(!(t.mode&1))return Mr(e,t,l,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var c=s.dgst;return s=c,o=Error(fe(419)),s=wl(o,s,void 0),Mr(e,t,l,s)}if(c=(l&e.childLanes)!==0,zt||c){if(s=bt,s!==null){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|l)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Gn(e,r),Cn(s,e,r,-1))}return La(),s=wl(Error(fe(421))),Mr(e,t,l,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=U1.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,Vt=ss(r.nextSibling),qt=t,st=!0,pn=null,e!==null&&(tn[nn++]=Nn,tn[nn++]=On,tn[nn++]=js,Nn=e.id,On=e.overflow,js=t),t=Ma(t,s.children),t.flags|=4096,t)}function Hu(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Pc(e.return,t,n)}function jl(e,t,n,s,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function $0(e,t,n){var s=t.pendingProps,r=s.revealOrder,o=s.tail;if(Nt(e,t,s.children,n),s=ft.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Hu(e,n,t);else if(e.tag===19)Hu(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(et(ft,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&ki(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),jl(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&ki(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}jl(t,!0,n,null,o);break;case"together":jl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jr(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Yn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Rs|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(fe(153));if(t.child!==null){for(e=t.child,n=ls(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ls(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function L1(e,t,n){switch(t.tag){case 3:O0(t),io();break;case 5:u0(t);break;case 1:Yt(t.type)&&yi(t);break;case 4:Sa(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;et(vi,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(et(ft,ft.current&1),t.flags|=128,null):n&t.child.childLanes?D0(e,t,n):(et(ft,ft.current&1),e=Yn(e,t,n),e!==null?e.sibling:null);et(ft,ft.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return $0(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),et(ft,ft.current),s)break;return null;case 22:case 23:return t.lanes=0,L0(e,t,n)}return Yn(e,t,n)}var F0,Ic,B0,z0;F0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ic=function(){};B0=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Ss(Tn.current);var o=null;switch(n){case"input":r=tc(e,r),s=tc(e,s),o=[];break;case"select":r=ht({},r,{value:void 0}),s=ht({},s,{value:void 0}),o=[];break;case"textarea":r=oc(e,r),s=oc(e,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=hi)}ic(n,s);var l;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var c=r[u];for(l in c)c.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Xo.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var a=s[u];if(c=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&a!==c&&(a!=null||c!=null))if(u==="style")if(c){for(l in c)!c.hasOwnProperty(l)||a&&a.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in a)a.hasOwnProperty(l)&&c[l]!==a[l]&&(n||(n={}),n[l]=a[l])}else n||(o||(o=[]),o.push(u,n)),n=a;else u==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,c=c?c.__html:void 0,a!=null&&c!==a&&(o=o||[]).push(u,a)):u==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(u,""+a):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Xo.hasOwnProperty(u)?(a!=null&&u==="onScroll"&&tt("scroll",e),o||c===a||(o=[])):(o=o||[]).push(u,a))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};z0=function(e,t,n,s){n!==s&&(t.flags|=4)};function wo(e,t){if(!st)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function _t(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function N1(e,t,n){var s=t.pendingProps;switch(pa(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _t(t),null;case 1:return Yt(t.type)&&xi(),_t(t),null;case 3:return s=t.stateNode,co(),nt(Gt),nt(Lt),ka(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Rr(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,pn!==null&&(zc(pn),pn=null))),Ic(e,t),_t(t),null;case 5:Ca(t);var r=Ss(rr.current);if(n=t.type,e!==null&&t.stateNode!=null)B0(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(fe(166));return _t(t),null}if(e=Ss(Tn.current),Rr(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[bn]=t,s[sr]=o,e=(t.mode&1)!==0,n){case"dialog":tt("cancel",s),tt("close",s);break;case"iframe":case"object":case"embed":tt("load",s);break;case"video":case"audio":for(r=0;r<Io.length;r++)tt(Io[r],s);break;case"source":tt("error",s);break;case"img":case"image":case"link":tt("error",s),tt("load",s);break;case"details":tt("toggle",s);break;case"input":Ja(s,o),tt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},tt("invalid",s);break;case"textarea":tu(s,o),tt("invalid",s)}ic(n,o),r=null;for(var l in o)if(o.hasOwnProperty(l)){var c=o[l];l==="children"?typeof c=="string"?s.textContent!==c&&(o.suppressHydrationWarning!==!0&&Pr(s.textContent,c,e),r=["children",c]):typeof c=="number"&&s.textContent!==""+c&&(o.suppressHydrationWarning!==!0&&Pr(s.textContent,c,e),r=["children",""+c]):Xo.hasOwnProperty(l)&&c!=null&&l==="onScroll"&&tt("scroll",s)}switch(n){case"input":gr(s),eu(s,o,!0);break;case"textarea":gr(s),nu(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=hi)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{l=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=xd(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=l.createElement(n,{is:s.is}):(e=l.createElement(n),n==="select"&&(l=e,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):e=l.createElementNS(e,n),e[bn]=t,e[sr]=s,F0(e,t,!1,!1),t.stateNode=e;e:{switch(l=lc(n,s),n){case"dialog":tt("cancel",e),tt("close",e),r=s;break;case"iframe":case"object":case"embed":tt("load",e),r=s;break;case"video":case"audio":for(r=0;r<Io.length;r++)tt(Io[r],e);r=s;break;case"source":tt("error",e),r=s;break;case"img":case"image":case"link":tt("error",e),tt("load",e),r=s;break;case"details":tt("toggle",e),r=s;break;case"input":Ja(e,s),r=tc(e,s),tt("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=ht({},s,{value:void 0}),tt("invalid",e);break;case"textarea":tu(e,s),r=oc(e,s),tt("invalid",e);break;default:r=s}ic(n,r),c=r;for(o in c)if(c.hasOwnProperty(o)){var a=c[o];o==="style"?md(e,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&yd(e,a)):o==="children"?typeof a=="string"?(n!=="textarea"||a!=="")&&Vo(e,a):typeof a=="number"&&Vo(e,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Xo.hasOwnProperty(o)?a!=null&&o==="onScroll"&&tt("scroll",e):a!=null&&Qc(e,o,a,l))}switch(n){case"input":gr(e),eu(e,s,!1);break;case"textarea":gr(e),nu(e);break;case"option":s.value!=null&&e.setAttribute("value",""+as(s.value));break;case"select":e.multiple=!!s.multiple,o=s.value,o!=null?Qs(e,!!s.multiple,o,!1):s.defaultValue!=null&&Qs(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=hi)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return _t(t),null;case 6:if(e&&t.stateNode!=null)z0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(fe(166));if(n=Ss(rr.current),Ss(Tn.current),Rr(t)){if(s=t.stateNode,n=t.memoizedProps,s[bn]=t,(o=s.nodeValue!==n)&&(e=qt,e!==null))switch(e.tag){case 3:Pr(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Pr(s.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[bn]=t,t.stateNode=s}return _t(t),null;case 13:if(nt(ft),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(st&&Vt!==null&&t.mode&1&&!(t.flags&128))r0(),io(),t.flags|=98560,o=!1;else if(o=Rr(t),s!==null&&s.dehydrated!==null){if(e===null){if(!o)throw Error(fe(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(fe(317));o[bn]=t}else io(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;_t(t),o=!1}else pn!==null&&(zc(pn),pn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||ft.current&1?kt===0&&(kt=3):La())),t.updateQueue!==null&&(t.flags|=4),_t(t),null);case 4:return co(),Ic(e,t),e===null&&tr(t.stateNode.containerInfo),_t(t),null;case 10:return ga(t.type._context),_t(t),null;case 17:return Yt(t.type)&&xi(),_t(t),null;case 19:if(nt(ft),o=t.memoizedState,o===null)return _t(t),null;if(s=(t.flags&128)!==0,l=o.rendering,l===null)if(s)wo(o,!1);else{if(kt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=ki(e),l!==null){for(t.flags|=128,wo(o,!1),s=l.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)o=n,e=s,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return et(ft,ft.current&1|2),t.child}e=e.sibling}o.tail!==null&&yt()>uo&&(t.flags|=128,s=!0,wo(o,!1),t.lanes=4194304)}else{if(!s)if(e=ki(l),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),wo(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!st)return _t(t),null}else 2*yt()-o.renderingStartTime>uo&&n!==1073741824&&(t.flags|=128,s=!0,wo(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(n=o.last,n!==null?n.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=yt(),t.sibling=null,n=ft.current,et(ft,s?n&1|2:n&1),t):(_t(t),null);case 22:case 23:return Ia(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Xt&1073741824&&(_t(t),t.subtreeFlags&6&&(t.flags|=8192)):_t(t),null;case 24:return null;case 25:return null}throw Error(fe(156,t.tag))}function O1(e,t){switch(pa(t),t.tag){case 1:return Yt(t.type)&&xi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return co(),nt(Gt),nt(Lt),ka(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Ca(t),null;case 13:if(nt(ft),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(fe(340));io()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return nt(ft),null;case 4:return co(),null;case 10:return ga(t.type._context),null;case 22:case 23:return Ia(),null;case 24:return null;default:return null}}var Tr=!1,It=!1,D1=typeof WeakSet=="function"?WeakSet:Set,Pe=null;function qs(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){xt(e,t,s)}else n.current=null}function Lc(e,t,n){try{n()}catch(s){xt(e,t,s)}}var Wu=!1;function $1(e,t){if(gc=fi,e=Ud(),fa(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var l=0,c=-1,a=-1,u=0,f=0,d=e,p=null;t:for(;;){for(var y;d!==n||r!==0&&d.nodeType!==3||(c=l+r),d!==o||s!==0&&d.nodeType!==3||(a=l+s),d.nodeType===3&&(l+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===e)break t;if(p===n&&++u===r&&(c=l),p===o&&++f===s&&(a=l),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}n=c===-1||a===-1?null:{start:c,end:a}}else n=null}n=n||{start:0,end:0}}else n=null;for(mc={focusedElem:e,selectionRange:n},fi=!1,Pe=t;Pe!==null;)if(t=Pe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Pe=e;else for(;Pe!==null;){t=Pe;try{var S=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var R=S.memoizedProps,j=S.memoizedState,g=t.stateNode,h=g.getSnapshotBeforeUpdate(t.elementType===t.type?R:fn(t.type,R),j);g.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(m){xt(t,t.return,m)}if(e=t.sibling,e!==null){e.return=t.return,Pe=e;break}Pe=t.return}return S=Wu,Wu=!1,S}function Go(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Lc(t,n,o)}r=r.next}while(r!==s)}}function Ui(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Nc(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function G0(e){var t=e.alternate;t!==null&&(e.alternate=null,G0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[bn],delete t[sr],delete t[Cc],delete t[S1],delete t[C1])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Y0(e){return e.tag===5||e.tag===3||e.tag===4}function Uu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Y0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Oc(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=hi));else if(s!==4&&(e=e.child,e!==null))for(Oc(e,t,n),e=e.sibling;e!==null;)Oc(e,t,n),e=e.sibling}function Dc(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(Dc(e,t,n),e=e.sibling;e!==null;)Dc(e,t,n),e=e.sibling}var Mt=null,dn=!1;function Un(e,t,n){for(n=n.child;n!==null;)H0(e,t,n),n=n.sibling}function H0(e,t,n){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount($i,n)}catch{}switch(n.tag){case 5:It||qs(n,t);case 6:var s=Mt,r=dn;Mt=null,Un(e,t,n),Mt=s,dn=r,Mt!==null&&(dn?(e=Mt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Mt.removeChild(n.stateNode));break;case 18:Mt!==null&&(dn?(e=Mt,n=n.stateNode,e.nodeType===8?gl(e.parentNode,n):e.nodeType===1&&gl(e,n),Qo(e)):gl(Mt,n.stateNode));break;case 4:s=Mt,r=dn,Mt=n.stateNode.containerInfo,dn=!0,Un(e,t,n),Mt=s,dn=r;break;case 0:case 11:case 14:case 15:if(!It&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&Lc(n,t,l),r=r.next}while(r!==s)}Un(e,t,n);break;case 1:if(!It&&(qs(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(c){xt(n,t,c)}Un(e,t,n);break;case 21:Un(e,t,n);break;case 22:n.mode&1?(It=(s=It)||n.memoizedState!==null,Un(e,t,n),It=s):Un(e,t,n);break;default:Un(e,t,n)}}function Xu(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new D1),t.forEach(function(s){var r=X1.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function un(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=e,l=t,c=l;e:for(;c!==null;){switch(c.tag){case 5:Mt=c.stateNode,dn=!1;break e;case 3:Mt=c.stateNode.containerInfo,dn=!0;break e;case 4:Mt=c.stateNode.containerInfo,dn=!0;break e}c=c.return}if(Mt===null)throw Error(fe(160));H0(o,l,r),Mt=null,dn=!1;var a=r.alternate;a!==null&&(a.return=null),r.return=null}catch(u){xt(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)W0(t,e),t=t.sibling}function W0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(un(t,e),wn(e),s&4){try{Go(3,e,e.return),Ui(3,e)}catch(R){xt(e,e.return,R)}try{Go(5,e,e.return)}catch(R){xt(e,e.return,R)}}break;case 1:un(t,e),wn(e),s&512&&n!==null&&qs(n,n.return);break;case 5:if(un(t,e),wn(e),s&512&&n!==null&&qs(n,n.return),e.flags&32){var r=e.stateNode;try{Vo(r,"")}catch(R){xt(e,e.return,R)}}if(s&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,l=n!==null?n.memoizedProps:o,c=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{c==="input"&&o.type==="radio"&&o.name!=null&&pd(r,o),lc(c,l);var u=lc(c,o);for(l=0;l<a.length;l+=2){var f=a[l],d=a[l+1];f==="style"?md(r,d):f==="dangerouslySetInnerHTML"?yd(r,d):f==="children"?Vo(r,d):Qc(r,f,d,u)}switch(c){case"input":nc(r,o);break;case"textarea":hd(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?Qs(r,!!o.multiple,y,!1):p!==!!o.multiple&&(o.defaultValue!=null?Qs(r,!!o.multiple,o.defaultValue,!0):Qs(r,!!o.multiple,o.multiple?[]:"",!1))}r[sr]=o}catch(R){xt(e,e.return,R)}}break;case 6:if(un(t,e),wn(e),s&4){if(e.stateNode===null)throw Error(fe(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(R){xt(e,e.return,R)}}break;case 3:if(un(t,e),wn(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Qo(t.containerInfo)}catch(R){xt(e,e.return,R)}break;case 4:un(t,e),wn(e);break;case 13:un(t,e),wn(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Aa=yt())),s&4&&Xu(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(It=(u=It)||f,un(t,e),It=u):un(t,e),wn(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!f&&e.mode&1)for(Pe=e,f=e.child;f!==null;){for(d=Pe=f;Pe!==null;){switch(p=Pe,y=p.child,p.tag){case 0:case 11:case 14:case 15:Go(4,p,p.return);break;case 1:qs(p,p.return);var S=p.stateNode;if(typeof S.componentWillUnmount=="function"){s=p,n=p.return;try{t=s,S.props=t.memoizedProps,S.state=t.memoizedState,S.componentWillUnmount()}catch(R){xt(s,n,R)}}break;case 5:qs(p,p.return);break;case 22:if(p.memoizedState!==null){qu(d);continue}}y!==null?(y.return=p,Pe=y):qu(d)}f=f.sibling}e:for(f=null,d=e;;){if(d.tag===5){if(f===null){f=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(c=d.stateNode,a=d.memoizedProps.style,l=a!=null&&a.hasOwnProperty("display")?a.display:null,c.style.display=gd("display",l))}catch(R){xt(e,e.return,R)}}}else if(d.tag===6){if(f===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(R){xt(e,e.return,R)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:un(t,e),wn(e),s&4&&Xu(e);break;case 21:break;default:un(t,e),wn(e)}}function wn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Y0(n)){var s=n;break e}n=n.return}throw Error(fe(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Vo(r,""),s.flags&=-33);var o=Uu(e);Dc(e,o,r);break;case 3:case 4:var l=s.stateNode.containerInfo,c=Uu(e);Oc(e,c,l);break;default:throw Error(fe(161))}}catch(a){xt(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function F1(e,t,n){Pe=e,U0(e)}function U0(e,t,n){for(var s=(e.mode&1)!==0;Pe!==null;){var r=Pe,o=r.child;if(r.tag===22&&s){var l=r.memoizedState!==null||Tr;if(!l){var c=r.alternate,a=c!==null&&c.memoizedState!==null||It;c=Tr;var u=It;if(Tr=l,(It=a)&&!u)for(Pe=r;Pe!==null;)l=Pe,a=l.child,l.tag===22&&l.memoizedState!==null?Zu(r):a!==null?(a.return=l,Pe=a):Zu(r);for(;o!==null;)Pe=o,U0(o),o=o.sibling;Pe=r,Tr=c,It=u}Vu(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Pe=o):Vu(e)}}function Vu(e){for(;Pe!==null;){var t=Pe;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:It||Ui(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!It)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:fn(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&_u(t,o,s);break;case 3:var l=t.updateQueue;if(l!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}_u(t,l,n)}break;case 5:var c=t.stateNode;if(n===null&&t.flags&4){n=c;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break;case"img":a.src&&(n.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var d=f.dehydrated;d!==null&&Qo(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}It||t.flags&512&&Nc(t)}catch(p){xt(t,t.return,p)}}if(t===e){Pe=null;break}if(n=t.sibling,n!==null){n.return=t.return,Pe=n;break}Pe=t.return}}function qu(e){for(;Pe!==null;){var t=Pe;if(t===e){Pe=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Pe=n;break}Pe=t.return}}function Zu(e){for(;Pe!==null;){var t=Pe;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Ui(4,t)}catch(a){xt(t,n,a)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(a){xt(t,r,a)}}var o=t.return;try{Nc(t)}catch(a){xt(t,o,a)}break;case 5:var l=t.return;try{Nc(t)}catch(a){xt(t,l,a)}}}catch(a){xt(t,t.return,a)}if(t===e){Pe=null;break}var c=t.sibling;if(c!==null){c.return=t.return,Pe=c;break}Pe=t.return}}var B1=Math.ceil,Pi=Hn.ReactCurrentDispatcher,Ta=Hn.ReactCurrentOwner,rn=Hn.ReactCurrentBatchConfig,qe=0,bt=null,mt=null,Tt=0,Xt=0,Zs=hs(0),kt=0,ar=null,Rs=0,Xi=0,Ea=0,Yo=null,Bt=null,Aa=0,uo=1/0,_n=null,Ri=!1,$c=null,rs=null,Er=!1,Jn=null,bi=0,Ho=0,Fc=null,ei=-1,ti=0;function Ot(){return qe&6?yt():ei!==-1?ei:ei=yt()}function is(e){return e.mode&1?qe&2&&Tt!==0?Tt&-Tt:w1.transition!==null?(ti===0&&(ti=Ed()),ti):(e=Ke,e!==0||(e=window.event,e=e===void 0?16:Dd(e.type)),e):1}function Cn(e,t,n,s){if(50<Ho)throw Ho=0,Fc=null,Error(fe(185));fr(e,n,s),(!(qe&2)||e!==bt)&&(e===bt&&(!(qe&2)&&(Xi|=n),kt===4&&Kn(e,Tt)),Ht(e,s),n===1&&qe===0&&!(t.mode&1)&&(uo=yt()+500,Yi&&xs()))}function Ht(e,t){var n=e.callbackNode;wh(e,t);var s=ui(e,e===bt?Tt:0);if(s===0)n!==null&&ru(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&ru(n),t===1)e.tag===0?k1(Ku.bind(null,e)):n0(Ku.bind(null,e)),m1(function(){!(qe&6)&&xs()}),n=null;else{switch(Ad(s)){case 1:n=sa;break;case 4:n=Md;break;case 16:n=ai;break;case 536870912:n=Td;break;default:n=ai}n=ep(n,X0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function X0(e,t){if(ei=-1,ti=0,qe&6)throw Error(fe(327));var n=e.callbackNode;if(so()&&e.callbackNode!==n)return null;var s=ui(e,e===bt?Tt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=Mi(e,s);else{t=s;var r=qe;qe|=2;var o=q0();(bt!==e||Tt!==t)&&(_n=null,uo=yt()+500,Cs(e,t));do try{Y1();break}catch(c){V0(e,c)}while(1);ya(),Pi.current=o,qe=r,mt!==null?t=0:(bt=null,Tt=0,t=kt)}if(t!==0){if(t===2&&(r=dc(e),r!==0&&(s=r,t=Bc(e,r))),t===1)throw n=ar,Cs(e,0),Kn(e,s),Ht(e,yt()),n;if(t===6)Kn(e,s);else{if(r=e.current.alternate,!(s&30)&&!z1(r)&&(t=Mi(e,s),t===2&&(o=dc(e),o!==0&&(s=o,t=Bc(e,o))),t===1))throw n=ar,Cs(e,0),Kn(e,s),Ht(e,yt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(fe(345));case 2:gs(e,Bt,_n);break;case 3:if(Kn(e,s),(s&130023424)===s&&(t=Aa+500-yt(),10<t)){if(ui(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Ot(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Sc(gs.bind(null,e,Bt,_n),t);break}gs(e,Bt,_n);break;case 4:if(Kn(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var l=31-Sn(s);o=1<<l,l=t[l],l>r&&(r=l),s&=~o}if(s=r,s=yt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*B1(s/1960))-s,10<s){e.timeoutHandle=Sc(gs.bind(null,e,Bt,_n),s);break}gs(e,Bt,_n);break;case 5:gs(e,Bt,_n);break;default:throw Error(fe(329))}}}return Ht(e,yt()),e.callbackNode===n?X0.bind(null,e):null}function Bc(e,t){var n=Yo;return e.current.memoizedState.isDehydrated&&(Cs(e,t).flags|=256),e=Mi(e,t),e!==2&&(t=Bt,Bt=n,t!==null&&zc(t)),e}function zc(e){Bt===null?Bt=e:Bt.push.apply(Bt,e)}function z1(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!kn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Kn(e,t){for(t&=~Ea,t&=~Xi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Sn(t),s=1<<n;e[n]=-1,t&=~s}}function Ku(e){if(qe&6)throw Error(fe(327));so();var t=ui(e,0);if(!(t&1))return Ht(e,yt()),null;var n=Mi(e,t);if(e.tag!==0&&n===2){var s=dc(e);s!==0&&(t=s,n=Bc(e,s))}if(n===1)throw n=ar,Cs(e,0),Kn(e,t),Ht(e,yt()),n;if(n===6)throw Error(fe(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,gs(e,Bt,_n),Ht(e,yt()),null}function _a(e,t){var n=qe;qe|=1;try{return e(t)}finally{qe=n,qe===0&&(uo=yt()+500,Yi&&xs())}}function bs(e){Jn!==null&&Jn.tag===0&&!(qe&6)&&so();var t=qe;qe|=1;var n=rn.transition,s=Ke;try{if(rn.transition=null,Ke=1,e)return e()}finally{Ke=s,rn.transition=n,qe=t,!(qe&6)&&xs()}}function Ia(){Xt=Zs.current,nt(Zs)}function Cs(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,g1(n)),mt!==null)for(n=mt.return;n!==null;){var s=n;switch(pa(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&xi();break;case 3:co(),nt(Gt),nt(Lt),ka();break;case 5:Ca(s);break;case 4:co();break;case 13:nt(ft);break;case 19:nt(ft);break;case 10:ga(s.type._context);break;case 22:case 23:Ia()}n=n.return}if(bt=e,mt=e=ls(e.current,null),Tt=Xt=t,kt=0,ar=null,Ea=Xi=Rs=0,Bt=Yo=null,vs!==null){for(t=0;t<vs.length;t++)if(n=vs[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var l=o.next;o.next=r,s.next=l}n.pending=s}vs=null}return e}function V0(e,t){do{var n=mt;try{if(ya(),Kr.current=ji,wi){for(var s=pt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}wi=!1}if(Ps=0,Pt=St=pt=null,zo=!1,ir=0,Ta.current=null,n===null||n.return===null){kt=1,ar=t,mt=null;break}e:{var o=e,l=n.return,c=n,a=t;if(t=Tt,c.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var u=a,f=c,d=f.tag;if(!(f.mode&1)&&(d===0||d===11||d===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=$u(l);if(y!==null){y.flags&=-257,Fu(y,l,c,o,t),y.mode&1&&Du(o,u,t),t=y,a=u;var S=t.updateQueue;if(S===null){var R=new Set;R.add(a),t.updateQueue=R}else S.add(a);break e}else{if(!(t&1)){Du(o,u,t),La();break e}a=Error(fe(426))}}else if(st&&c.mode&1){var j=$u(l);if(j!==null){!(j.flags&65536)&&(j.flags|=256),Fu(j,l,c,o,t),ha(ao(a,c));break e}}o=a=ao(a,c),kt!==4&&(kt=2),Yo===null?Yo=[o]:Yo.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var g=A0(o,a,t);Au(o,g);break e;case 1:c=a;var h=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(rs===null||!rs.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var m=_0(o,c,t);Au(o,m);break e}}o=o.return}while(o!==null)}K0(n)}catch(P){t=P,mt===n&&n!==null&&(mt=n=n.return);continue}break}while(1)}function q0(){var e=Pi.current;return Pi.current=ji,e===null?ji:e}function La(){(kt===0||kt===3||kt===2)&&(kt=4),bt===null||!(Rs&268435455)&&!(Xi&268435455)||Kn(bt,Tt)}function Mi(e,t){var n=qe;qe|=2;var s=q0();(bt!==e||Tt!==t)&&(_n=null,Cs(e,t));do try{G1();break}catch(r){V0(e,r)}while(1);if(ya(),qe=n,Pi.current=s,mt!==null)throw Error(fe(261));return bt=null,Tt=0,kt}function G1(){for(;mt!==null;)Z0(mt)}function Y1(){for(;mt!==null&&!hh();)Z0(mt)}function Z0(e){var t=J0(e.alternate,e,Xt);e.memoizedProps=e.pendingProps,t===null?K0(e):mt=t,Ta.current=null}function K0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=O1(n,t),n!==null){n.flags&=32767,mt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{kt=6,mt=null;return}}else if(n=N1(n,t,Xt),n!==null){mt=n;return}if(t=t.sibling,t!==null){mt=t;return}mt=t=e}while(t!==null);kt===0&&(kt=5)}function gs(e,t,n){var s=Ke,r=rn.transition;try{rn.transition=null,Ke=1,H1(e,t,n,s)}finally{rn.transition=r,Ke=s}return null}function H1(e,t,n,s){do so();while(Jn!==null);if(qe&6)throw Error(fe(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(fe(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(jh(e,o),e===bt&&(mt=bt=null,Tt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Er||(Er=!0,ep(ai,function(){return so(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=rn.transition,rn.transition=null;var l=Ke;Ke=1;var c=qe;qe|=4,Ta.current=null,$1(e,n),W0(n,e),u1(mc),fi=!!gc,mc=gc=null,e.current=n,F1(n),xh(),qe=c,Ke=l,rn.transition=o}else e.current=n;if(Er&&(Er=!1,Jn=e,bi=r),o=e.pendingLanes,o===0&&(rs=null),mh(n.stateNode),Ht(e,yt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Ri)throw Ri=!1,e=$c,$c=null,e;return bi&1&&e.tag!==0&&so(),o=e.pendingLanes,o&1?e===Fc?Ho++:(Ho=0,Fc=e):Ho=0,xs(),null}function so(){if(Jn!==null){var e=Ad(bi),t=rn.transition,n=Ke;try{if(rn.transition=null,Ke=16>e?16:e,Jn===null)var s=!1;else{if(e=Jn,Jn=null,bi=0,qe&6)throw Error(fe(331));var r=qe;for(qe|=4,Pe=e.current;Pe!==null;){var o=Pe,l=o.child;if(Pe.flags&16){var c=o.deletions;if(c!==null){for(var a=0;a<c.length;a++){var u=c[a];for(Pe=u;Pe!==null;){var f=Pe;switch(f.tag){case 0:case 11:case 15:Go(8,f,o)}var d=f.child;if(d!==null)d.return=f,Pe=d;else for(;Pe!==null;){f=Pe;var p=f.sibling,y=f.return;if(G0(f),f===u){Pe=null;break}if(p!==null){p.return=y,Pe=p;break}Pe=y}}}var S=o.alternate;if(S!==null){var R=S.child;if(R!==null){S.child=null;do{var j=R.sibling;R.sibling=null,R=j}while(R!==null)}}Pe=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Pe=l;else e:for(;Pe!==null;){if(o=Pe,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Go(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,Pe=g;break e}Pe=o.return}}var h=e.current;for(Pe=h;Pe!==null;){l=Pe;var x=l.child;if(l.subtreeFlags&2064&&x!==null)x.return=l,Pe=x;else e:for(l=h;Pe!==null;){if(c=Pe,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Ui(9,c)}}catch(P){xt(c,c.return,P)}if(c===l){Pe=null;break e}var m=c.sibling;if(m!==null){m.return=c.return,Pe=m;break e}Pe=c.return}}if(qe=r,xs(),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot($i,e)}catch{}s=!0}return s}finally{Ke=n,rn.transition=t}}return!1}function Qu(e,t,n){t=ao(n,t),t=A0(e,t,1),e=os(e,t,1),t=Ot(),e!==null&&(fr(e,1,t),Ht(e,t))}function xt(e,t,n){if(e.tag===3)Qu(e,e,n);else for(;t!==null;){if(t.tag===3){Qu(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(rs===null||!rs.has(s))){e=ao(n,e),e=_0(t,e,1),t=os(t,e,1),e=Ot(),t!==null&&(fr(t,1,e),Ht(t,e));break}}t=t.return}}function W1(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Ot(),e.pingedLanes|=e.suspendedLanes&n,bt===e&&(Tt&n)===n&&(kt===4||kt===3&&(Tt&130023424)===Tt&&500>yt()-Aa?Cs(e,0):Ea|=n),Ht(e,t)}function Q0(e,t){t===0&&(e.mode&1?(t=Sr,Sr<<=1,!(Sr&130023424)&&(Sr=4194304)):t=1);var n=Ot();e=Gn(e,t),e!==null&&(fr(e,t,n),Ht(e,n))}function U1(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),Q0(e,n)}function X1(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(fe(314))}s!==null&&s.delete(t),Q0(e,n)}var J0;J0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Gt.current)zt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return zt=!1,L1(e,t,n);zt=!!(e.flags&131072)}else zt=!1,st&&t.flags&1048576&&s0(t,mi,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Jr(e,t),e=t.pendingProps;var r=ro(t,Lt.current);no(t,n),r=ja(null,t,s,e,r,n);var o=Pa();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Yt(s)?(o=!0,yi(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,va(t),r.updater=Wi,t.stateNode=r,r._reactInternals=t,bc(t,s,e,n),t=Ec(null,t,s,!0,o,n)):(t.tag=0,st&&o&&da(t),Nt(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Jr(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=q1(s),e=fn(s,e),r){case 0:t=Tc(null,t,s,e,n);break e;case 1:t=Gu(null,t,s,e,n);break e;case 11:t=Bu(null,t,s,e,n);break e;case 14:t=zu(null,t,s,fn(s.type,e),n);break e}throw Error(fe(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Tc(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Gu(e,t,s,r,n);case 3:e:{if(O0(t),e===null)throw Error(fe(387));s=t.pendingProps,o=t.memoizedState,r=o.element,a0(e,t),Ci(t,s,null,n);var l=t.memoizedState;if(s=l.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=ao(Error(fe(423)),t),t=Yu(e,t,s,n,r);break e}else if(s!==r){r=ao(Error(fe(424)),t),t=Yu(e,t,s,n,r);break e}else for(Vt=ss(t.stateNode.containerInfo.firstChild),qt=t,st=!0,pn=null,n=l0(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(io(),s===r){t=Yn(e,t,n);break e}Nt(e,t,s,n)}t=t.child}return t;case 5:return u0(t),e===null&&jc(t),s=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,l=r.children,vc(s,r)?l=null:o!==null&&vc(s,o)&&(t.flags|=32),N0(e,t),Nt(e,t,l,n),t.child;case 6:return e===null&&jc(t),null;case 13:return D0(e,t,n);case 4:return Sa(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=lo(t,null,s,n):Nt(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Bu(e,t,s,r,n);case 7:return Nt(e,t,t.pendingProps,n),t.child;case 8:return Nt(e,t,t.pendingProps.children,n),t.child;case 12:return Nt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,o=t.memoizedProps,l=r.value,et(vi,s._currentValue),s._currentValue=l,o!==null)if(kn(o.value,l)){if(o.children===r.children&&!Gt.current){t=Yn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var c=o.dependencies;if(c!==null){l=o.child;for(var a=c.firstContext;a!==null;){if(a.context===s){if(o.tag===1){a=Fn(-1,n&-n),a.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?a.next=a:(a.next=f.next,f.next=a),u.pending=a}}o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Pc(o.return,n,t),c.lanes|=n;break}a=a.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(fe(341));l.lanes|=n,c=l.alternate,c!==null&&(c.lanes|=n),Pc(l,n,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}Nt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,no(t,n),r=cn(r),s=s(r),t.flags|=1,Nt(e,t,s,n),t.child;case 14:return s=t.type,r=fn(s,t.pendingProps),r=fn(s.type,r),zu(e,t,s,r,n);case 15:return I0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:fn(s,r),Jr(e,t),t.tag=1,Yt(s)?(e=!0,yi(t)):e=!1,no(t,n),E0(t,s,r),bc(t,s,r,n),Ec(null,t,s,!0,e,n);case 19:return $0(e,t,n);case 22:return L0(e,t,n)}throw Error(fe(156,t.tag))};function ep(e,t){return bd(e,t)}function V1(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function on(e,t,n,s){return new V1(e,t,n,s)}function Na(e){return e=e.prototype,!(!e||!e.isReactComponent)}function q1(e){if(typeof e=="function")return Na(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ea)return 11;if(e===ta)return 14}return 2}function ls(e,t){var n=e.alternate;return n===null?(n=on(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ni(e,t,n,s,r,o){var l=2;if(s=e,typeof e=="function")Na(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Bs:return ks(n.children,r,o,t);case Jc:l=8,r|=8;break;case Kl:return e=on(12,n,t,r|2),e.elementType=Kl,e.lanes=o,e;case Ql:return e=on(13,n,t,r),e.elementType=Ql,e.lanes=o,e;case Jl:return e=on(19,n,t,r),e.elementType=Jl,e.lanes=o,e;case ud:return Vi(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case cd:l=10;break e;case ad:l=9;break e;case ea:l=11;break e;case ta:l=14;break e;case Vn:l=16,s=null;break e}throw Error(fe(130,e==null?e:typeof e,""))}return t=on(l,n,t,r),t.elementType=e,t.type=s,t.lanes=o,t}function ks(e,t,n,s){return e=on(7,e,s,t),e.lanes=n,e}function Vi(e,t,n,s){return e=on(22,e,s,t),e.elementType=ud,e.lanes=n,e.stateNode={isHidden:!1},e}function Pl(e,t,n){return e=on(6,e,null,t),e.lanes=n,e}function Rl(e,t,n){return t=on(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Z1(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=il(0),this.expirationTimes=il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=il(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Oa(e,t,n,s,r,o,l,c,a){return e=new Z1(e,t,n,c,a),t===1?(t=1,o===!0&&(t|=8)):t=0,o=on(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},va(o),e}function K1(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fs,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function tp(e){if(!e)return us;e=e._reactInternals;e:{if(Ts(e)!==e||e.tag!==1)throw Error(fe(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Yt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(fe(171))}if(e.tag===1){var n=e.type;if(Yt(n))return t0(e,n,t)}return t}function np(e,t,n,s,r,o,l,c,a){return e=Oa(n,s,!0,e,r,o,l,c,a),e.context=tp(null),n=e.current,s=Ot(),r=is(n),o=Fn(s,r),o.callback=t??null,os(n,o,r),e.current.lanes=r,fr(e,r,s),Ht(e,s),e}function qi(e,t,n,s){var r=t.current,o=Ot(),l=is(r);return n=tp(n),t.context===null?t.context=n:t.pendingContext=n,t=Fn(o,l),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=os(r,t,l),e!==null&&(Cn(e,r,l,o),Zr(e,r,l)),l}function Ti(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ju(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Da(e,t){Ju(e,t),(e=e.alternate)&&Ju(e,t)}function Q1(){return null}var sp=typeof reportError=="function"?reportError:function(e){console.error(e)};function $a(e){this._internalRoot=e}Zi.prototype.render=$a.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(fe(409));qi(e,t,null,null)};Zi.prototype.unmount=$a.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;bs(function(){qi(null,e,null,null)}),t[zn]=null}};function Zi(e){this._internalRoot=e}Zi.prototype.unstable_scheduleHydration=function(e){if(e){var t=Ld();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Zn.length&&t!==0&&t<Zn[n].priority;n++);Zn.splice(n,0,e),n===0&&Od(e)}};function Fa(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Ki(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ef(){}function J1(e,t,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Ti(l);o.call(u)}}var l=np(t,s,e,0,null,!1,!1,"",ef);return e._reactRootContainer=l,e[zn]=l.current,tr(e.nodeType===8?e.parentNode:e),bs(),l}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var c=s;s=function(){var u=Ti(a);c.call(u)}}var a=Oa(e,0,!1,null,null,!1,!1,"",ef);return e._reactRootContainer=a,e[zn]=a.current,tr(e.nodeType===8?e.parentNode:e),bs(function(){qi(t,a,n,s)}),a}function Qi(e,t,n,s,r){var o=n._reactRootContainer;if(o){var l=o;if(typeof r=="function"){var c=r;r=function(){var a=Ti(l);c.call(a)}}qi(t,l,e,r)}else l=J1(n,t,e,r,s);return Ti(l)}_d=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=_o(t.pendingLanes);n!==0&&(oa(t,n|1),Ht(t,yt()),!(qe&6)&&(uo=yt()+500,xs()))}break;case 13:bs(function(){var s=Gn(e,1);if(s!==null){var r=Ot();Cn(s,e,1,r)}}),Da(e,1)}};ra=function(e){if(e.tag===13){var t=Gn(e,134217728);if(t!==null){var n=Ot();Cn(t,e,134217728,n)}Da(e,134217728)}};Id=function(e){if(e.tag===13){var t=is(e),n=Gn(e,t);if(n!==null){var s=Ot();Cn(n,e,t,s)}Da(e,t)}};Ld=function(){return Ke};Nd=function(e,t){var n=Ke;try{return Ke=e,t()}finally{Ke=n}};ac=function(e,t,n){switch(t){case"input":if(nc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=Gi(s);if(!r)throw Error(fe(90));dd(s),nc(s,r)}}}break;case"textarea":hd(e,n);break;case"select":t=n.value,t!=null&&Qs(e,!!n.multiple,t,!1)}};Cd=_a;kd=bs;var ex={usingClientEntryPoint:!1,Events:[pr,Hs,Gi,vd,Sd,_a]},jo={findFiberByHostInstance:ms,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tx={bundleType:jo.bundleType,version:jo.version,rendererPackageName:jo.rendererPackageName,rendererConfig:jo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Pd(e),e===null?null:e.stateNode},findFiberByHostInstance:jo.findFiberByHostInstance||Q1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ar=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ar.isDisabled&&Ar.supportsFiber)try{$i=Ar.inject(tx),Mn=Ar}catch{}}Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ex;Kt.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fa(t))throw Error(fe(200));return K1(e,t,null,n)};Kt.createRoot=function(e,t){if(!Fa(e))throw Error(fe(299));var n=!1,s="",r=sp;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Oa(e,1,!1,null,null,n,!1,s,r),e[zn]=t.current,tr(e.nodeType===8?e.parentNode:e),new $a(t)};Kt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(fe(188)):(e=Object.keys(e).join(","),Error(fe(268,e)));return e=Pd(t),e=e===null?null:e.stateNode,e};Kt.flushSync=function(e){return bs(e)};Kt.hydrate=function(e,t,n){if(!Ki(t))throw Error(fe(200));return Qi(null,e,t,!0,n)};Kt.hydrateRoot=function(e,t,n){if(!Fa(e))throw Error(fe(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",l=sp;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),t=np(t,null,e,1,n??null,r,!1,o,l),e[zn]=t.current,tr(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Zi(t)};Kt.render=function(e,t,n){if(!Ki(t))throw Error(fe(200));return Qi(null,e,t,!1,n)};Kt.unmountComponentAtNode=function(e){if(!Ki(e))throw Error(fe(40));return e._reactRootContainer?(bs(function(){Qi(null,null,e,!1,function(){e._reactRootContainer=null,e[zn]=null})}),!0):!1};Kt.unstable_batchedUpdates=_a;Kt.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Ki(n))throw Error(fe(200));if(e==null||e._reactInternals===void 0)throw Error(fe(38));return Qi(e,t,n,!1,s)};Kt.version="18.3.1-next-f1338f8080-20240426";function op(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(op)}catch(e){console.error(e)}}op(),od.exports=Kt;var nx=od.exports,tf=nx;ql.createRoot=tf.createRoot,ql.hydrateRoot=tf.hydrateRoot;var Re=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e.T_I="T_I",e.T_L="T_L",e.T_T="T_T",e.T_S="T_S",e.T_O="T_O",e.T_I_C="T_I_C",e.T_L_C="T_L_C",e.T_T_C="T_T_C",e.T_S_C="T_S_C",e.T_O_C="T_O_C",e.P_I="P_I",e.P_L="P_L",e.P_X="P_X",e.P_U="P_U",e.P_L2="P_L2",e.P_Y="P_Y",e.P_T="P_T",e.P_S="P_S",e.P_P="P_P",e.P_Z="P_Z",e.P_W="P_W",e.P_I_C="P_I_C",e.P_L_C="P_L_C",e.P_X_C="P_X_C",e.P_U_C="P_U_C",e.P_L2_C="P_L2_C",e.P_Y_C="P_Y_C",e.P_T_C="P_T_C",e.P_S_C="P_S_C",e.P_P_C="P_P_C",e.P_Z_C="P_Z_C",e.P_W_C="P_W_C",e.H_I="H_I",e.H_L="H_L",e.H_X="H_X",e.H_U="H_U",e.H_L2="H_L2",e.H_Y="H_Y",e.H_T="H_T",e.H_S="H_S",e.H_P="H_P",e.H_Z="H_Z",e.H_W="H_W",e.H_I_C="H_I_C",e.H_L_C="H_L_C",e.H_X_C="H_X_C",e.H_U_C="H_U_C",e.H_L2_C="H_L2_C",e.H_Y_C="H_Y_C",e.H_T_C="H_T_C",e.H_S_C="H_S_C",e.H_P_C="H_P_C",e.H_Z_C="H_Z_C",e.H_W_C="H_W_C",e))(Re||{}),Ln=(e=>(e.SPAWNED="SPAWNED",e.FALLING="FALLING",e.LOCKED="LOCKED",e))(Ln||{}),Ze=(e=>(e.ConsoleScreen="CONSOLE",e.TankScreen="PERISCOPE",e.COMPLICATION_MINIGAME="COMPLICATION_MINIGAME",e.EndGameScreen="GAME_OVER",e))(Ze||{}),Ae=(e=>(e.LIGHTS="LIGHTS",e.CONTROLS="CONTROLS",e.LASER="LASER",e))(Ae||{});const at=12,Se=30,ln=16,Ye=19,Qe=Ye-ln,fo=375,bl=75*1e3,Ml=.15,sx=.5,ox=30,rx=0,ix=100,nf=15,lx=10,cx=250,En={CIRCUIT_STABILIZER:{id:"CIRCUIT_STABILIZER",name:"Circuit Stabilizer",desc:"Extends grace period before lights start dimming.",type:"passive",category:"complication",unlockRank:2,costPerLevel:1,maxLevel:4,effectPerLevel:.75,formatEffect:e=>`+${(e*.75).toFixed(2)}s Grace Period`,maxLevelBonus:"Easier Fixing Sequence"},AUTO_POPPER:{id:"AUTO_POPPER",name:"Auto-Popper",desc:"At end of game, remaining goop has a chance to auto-pop before penalty.",type:"passive",unlockRank:3,costPerLevel:1,maxLevel:4,effectPerLevel:.04,formatEffect:e=>`-${20-e*4}% decay per unit`,maxLevelBonus:void 0},CAPACITOR_EFFICIENCY:{id:"CAPACITOR_EFFICIENCY",name:"Capacitor Efficiency",desc:"Reduces laser capacitor drain rate when popping goop.",type:"passive",category:"complication",unlockRank:4,costPerLevel:1,maxLevel:4,effectPerLevel:.0625,formatEffect:e=>`-${(e*6.25).toFixed(2)}% Drain Rate`,maxLevelBonus:"Easier Fixing Sequence"},COOLDOWN_BOOSTER:{id:"COOLDOWN_BOOSTER",name:"Cooldown Booster",desc:"When activated, extends all active malfunction cooldowns.",type:"active",unlockRank:5,costPerLevel:1,maxLevel:3,chargeCost:8,effectPerLevel:0,formatEffect:e=>`+${[25,35,50][e-1]||25}% Cooldown Extension`,maxLevelBonus:"+50% Cooldown Extension"},GEAR_LUBRICATION:{id:"GEAR_LUBRICATION",name:"Gear Lubrication",desc:"Increases heat dissipation rate when idle.",type:"passive",category:"complication",unlockRank:6,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Heat Dissipation`,maxLevelBonus:"Easier Fixing Sequence"},FOCUS_MODE:{id:"FOCUS_MODE",name:"Focus Mode",desc:"Time slows while at the console viewing minigames.",type:"passive",unlockRank:7,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`-${e*10}% Time Speed`,maxLevelBonus:void 0},DENSE_GOOP:{id:"DENSE_GOOP",name:"Dense Goop",desc:"Goop falls faster. Can add or remove scraps via respec.",type:"passive",unlockRank:8,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Fall Speed`,maxLevelBonus:void 0},PRESSURE_CONTROL:{id:"PRESSURE_CONTROL",name:"Pressure Control",desc:"Extends time before pressure reaches 100%.",type:"passive",unlockRank:9,costPerLevel:1,maxLevel:8,effectPerLevel:5,formatEffect:e=>`+${e*5}s Game Time`,maxLevelBonus:void 0},JUNK_UNIFORMER:{id:"JUNK_UNIFORMER",name:"Junk Uniformer",desc:"Starting junk is more likely to be the same color.",type:"passive",unlockRank:10,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`+${e*10}% Same Color`,maxLevelBonus:void 0},GOOP_SWAP:{id:"GOOP_SWAP",name:"Goop Swap",desc:"Swap falling goop with stored goop faster.",type:"passive",unlockRank:12,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${(1.5-e*.25).toFixed(2)}s Swap Time`,maxLevelBonus:void 0},GOOP_DUMP:{id:"GOOP_DUMP",name:"Goop Dump",desc:"When activated, rains same-color junk from the sky. Higher levels add more waves.",type:"active",unlockRank:15,costPerLevel:1,maxLevel:3,chargeCost:12,effectPerLevel:1,formatEffect:e=>`${e} wave${e>1?"s":""} of junk`,maxLevelBonus:"3 waves of matching junk"},SEALING_BONUS:{id:"SEALING_BONUS",name:"Sealing Bonus",desc:"Sealing cracks reduces active cooldowns more.",type:"passive",unlockRank:18,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`${10+e*5}% Cooldown per Seal`,maxLevelBonus:void 0},ACTIVE_EXPANSION_SLOT:{id:"ACTIVE_EXPANSION_SLOT",name:"Active Expansion Slot",desc:"Allows equipping a second active ability simultaneously.",type:"feature",unlockRank:20,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"2 Active Slots",maxLevelBonus:void 0},GOOP_HOLD_VIEWER:{id:"GOOP_HOLD_VIEWER",name:"Goop Hold Viewer",desc:"Shows the goop currently held.",type:"feature",unlockRank:22,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"View Held Goop",maxLevelBonus:void 0},GOOP_COLORIZER:{id:"GOOP_COLORIZER",name:"Goop Colorizer",desc:"When activated, upcoming goop matches your current color.",type:"active",unlockRank:25,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:1,formatEffect:e=>`Next ${5+e} goop match`,maxLevelBonus:"Next 8 goop match"},GOOP_WINDOW:{id:"GOOP_WINDOW",name:"Goop Window",desc:"Shows you the next goop piece.",type:"feature",unlockRank:28,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"Preview Next Goop",maxLevelBonus:void 0},SLOW_CRACKS:{id:"SLOW_CRACKS",name:"Slow Cracks",desc:"Cracks grow slower over time.",type:"passive",unlockRank:30,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`-${e*5}% Growth Chance`,maxLevelBonus:void 0},CRACK_MATCHER:{id:"CRACK_MATCHER",name:"Crack Matcher",desc:"Falling goop color biased toward the lowest crack.",type:"passive",unlockRank:32,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${e*25}% Match Chance`,maxLevelBonus:void 0},CRACK_DOWN:{id:"CRACK_DOWN",name:"Crack Down",desc:"When activated, next cracks form in the bottom 4 rows.",type:"active",unlockRank:35,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:2,formatEffect:e=>`Next ${1+e*2} cracks spawn low`,maxLevelBonus:"Next 7 cracks spawn low"},ACTIVE_EXPANSION_SLOT_2:{id:"ACTIVE_EXPANSION_SLOT_2",name:"Active Expansion Slot",desc:"Allows equipping a third active ability simultaneously.",type:"feature",unlockRank:38,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"3 Active Slots",maxLevelBonus:void 0}},Ct={RED:"#ef4444",BLUE:"#3b82f6",GREEN:"#22c55e",YELLOW:"#eab308",PURPLE:"#a855f7",WHITE:"#f8fafc",BLACK:"#1a1a2e",WILD:"wild",ORANGE:"#f97316",TEAL:"#14b8a6",GRID_BG:"#020617",GRID_EMPTY:"#1e293b"},Me=(e,t)=>({type:e,color:Ct.RED,cells:t.map(([n,s])=>({x:n,y:s}))}),sf=[Me(Re.I,[[-1,0],[0,0],[1,0],[2,0]]),Me(Re.J,[[-1,-1],[-1,0],[0,0],[1,0]]),Me(Re.L,[[1,-1],[-1,0],[0,0],[1,0]]),Me(Re.O,[[0,0],[1,0],[0,1],[1,1]]),Me(Re.S,[[0,0],[1,0],[0,1],[-1,1]]),Me(Re.T,[[0,-1],[-1,0],[0,0],[1,1]]),Me(Re.Z,[[-1,0],[0,0],[0,1],[1,1]])],ax=Me(Re.T_I,[[0,-1],[0,0],[0,1],[0,2]]),ux=Me(Re.T_L,[[0,0],[0,1],[0,2],[1,0]]),fx=Me(Re.T_T,[[0,0],[0,1],[0,2],[1,1]]),dx=Me(Re.T_S,[[0,0],[0,1],[1,1],[1,2]]),px=Me(Re.T_O,[[0,0],[0,1],[1,0],[1,1]]),hx=Me(Re.T_I_C,[[0,2],[0,3],[1,0],[1,1]]),xx=Me(Re.T_L_C,[[0,0],[0,1],[1,0],[1,2]]),yx=Me(Re.T_T_C,[[0,0],[0,2],[1,1],[2,1]]),gx=Me(Re.T_S_C,[[0,2],[1,0],[1,1],[2,1]]),mx=Me(Re.T_O_C,[[0,0],[0,2],[1,1],[1,2]]),Wo=[ax,ux,fx,dx,px],Uo=[hx,xx,yx,gx,mx];[...Wo,...Uo];const vx=Me(Re.P_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2]]),Sx=Me(Re.P_L,[[0,0],[0,1],[1,1],[1,2],[2,1]]),Cx=Me(Re.P_X,[[0,1],[1,0],[1,1],[1,2],[2,1]]),kx=Me(Re.P_U,[[0,0],[1,0],[1,1],[1,2],[2,0]]),wx=Me(Re.P_L2,[[0,0],[0,1],[1,0],[1,1],[1,2]]),jx=Me(Re.P_Y,[[0,0],[0,1],[1,1],[1,2],[2,2]]),Px=Me(Re.P_T,[[0,0],[0,1],[0,2],[0,3],[1,1]]),Rx=Me(Re.P_S,[[0,0],[0,1],[0,2],[0,3],[1,3]]),bx=Me(Re.P_P,[[0,0],[0,1],[0,3],[1,0],[1,2]]),Mx=Me(Re.P_Z,[[0,0],[0,1],[0,2],[0,3],[1,1]]),Tx=Me(Re.P_W,[[0,0],[0,2],[1,1],[1,2],[2,2]]),Ex=Me(Re.P_I_C,[[0,0],[0,2],[0,4],[1,1],[1,3]]),Ax=Me(Re.P_L_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),_x=Me(Re.P_X_C,[[0,0],[1,1],[1,2],[2,0],[2,2]]),Ix=Me(Re.P_U_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),Lx=Me(Re.P_L2_C,[[0,0],[0,2],[1,1],[1,2],[2,2]]),Nx=Me(Re.P_Y_C,[[0,0],[0,1],[1,1],[2,0],[2,2]]),Ox=Me(Re.P_T_C,[[0,0],[0,1],[0,3],[1,2],[1,3]]),Dx=Me(Re.P_S_C,[[0,0],[0,1],[1,0],[1,2],[2,1]]),$x=Me(Re.P_P_C,[[0,0],[0,2],[1,0],[1,1],[1,3]]),Fx=Me(Re.P_Z_C,[[0,0],[0,2],[1,1],[1,3],[2,0]]),Bx=Me(Re.P_W_C,[[0,0],[0,2],[1,1],[2,0],[2,2]]),Ba=[vx,Sx,Cx,kx,wx,jx,Px,Rx,bx,Mx,Tx],za=[Ex,Ax,_x,Ix,Lx,Nx,Ox,Dx,$x,Fx,Bx];[...Ba,...za];const zx=Me(Re.H_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2],[0,3]]),Gx=Me(Re.H_L,[[0,0],[0,1],[0,2],[0,3],[1,1],[2,1]]),Yx=Me(Re.H_X,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,3]]),Hx=Me(Re.H_U,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,0]]),Wx=Me(Re.H_L2,[[0,0],[0,1],[1,0],[1,1],[1,2],[1,3]]),Ux=Me(Re.H_Y,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2]]),Xx=Me(Re.H_T,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,2]]),Vx=Me(Re.H_S,[[0,0],[0,1],[1,0],[1,1],[2,1],[2,2]]),qx=Me(Re.H_P,[[0,0],[0,1],[0,2],[0,3],[1,2],[1,3]]),Zx=Me(Re.H_Z,[[0,0],[0,1],[0,2],[0,3],[1,0],[1,3]]),Kx=Me(Re.H_W,[[0,0],[0,3],[1,1],[1,2],[1,3],[2,3]]),Qx=Me(Re.H_I_C,[[0,0],[0,3],[0,5],[1,1],[1,2],[1,4]]),Jx=Me(Re.H_L_C,[[0,0],[0,2],[1,1],[1,2],[1,3],[2,0]]),ey=Me(Re.H_X_C,[[0,0],[0,2],[0,3],[1,1],[1,3],[2,0]]),ty=Me(Re.H_U_C,[[0,0],[0,3],[1,1],[1,2],[1,4],[2,0]]),ny=Me(Re.H_L2_C,[[0,0],[0,1],[1,1],[1,2],[1,3],[2,0]]),sy=Me(Re.H_Y_C,[[0,0],[0,2],[1,0],[1,2],[1,3],[2,1]]),oy=Me(Re.H_T_C,[[0,0],[0,1],[0,3],[1,1],[1,2],[1,4]]),ry=Me(Re.H_S_C,[[0,0],[0,2],[1,1],[1,3],[2,0],[2,2]]),iy=Me(Re.H_P_C,[[0,0],[0,2],[0,4],[1,1],[1,2],[1,3]]),ly=Me(Re.H_Z_C,[[0,0],[0,1],[0,3],[1,0],[1,2],[2,3]]),cy=Me(Re.H_W_C,[[0,0],[0,3],[1,1],[1,2],[2,0],[2,3]]),Ga=[zx,Gx,Yx,Hx,Wx,Ux,Xx,Vx,qx,Zx,Kx],Ya=[Qx,Jx,ey,ty,ny,sy,oy,ry,iy,ly,cy];[...Ga,...Ya];const Ue=e=>(e%Se+Se)%Se,Gc=(e,t)=>Ue(Math.round(e)+t),ay=(e,t)=>{let n=e-t;for(;n>Se/2;)n-=Se;for(;n<=-Se/2;)n+=Se;return n},uy=(e,t,n)=>{const s=n?n.x:Math.round(e.reduce((o,l)=>o+l.x,0)/e.length),r=n?n.y:Math.round(e.reduce((o,l)=>o+l.y,0)/e.length);return e.map(({x:o,y:l})=>{const c=o-s,a=l-r;return t?{x:-a+s,y:c+r}:{x:a+s,y:-c+r}})},mn=e=>{const t=[Ct.RED,Ct.BLUE,Ct.GREEN,Ct.YELLOW];return e>=10&&t.push(Ct.PURPLE),e>=30&&t.push(Ct.WHITE),e>=50&&t.push(Ct.BLACK),t},fy=(e,t=1)=>{const n=e||sf[Math.floor(Math.random()*sf.length)],s=mn(t),o=(e==null?void 0:e.color)&&s.includes(e.color)?e.color:s[Math.floor(Math.random()*s.length)],l=Math.round(n.cells.reduce((a,u)=>a+u.x,0)/n.cells.length),c=Math.round(n.cells.reduce((a,u)=>a+u.y,0)/n.cells.length);return{definition:{...n,color:o},x:0,y:0,screenX:0,rotation:0,cells:[...n.cells],rotationCenter:{x:l,y:c},spawnTimestamp:Date.now(),startSpawnY:0,state:Ln.SPAWNED}},of=(e,t)=>{const n=Array(Ye).fill(null).map(()=>Array(Se).fill(null));let s=0;if(e>=9?s=11:e>=6?s=8:e>=3&&(s=5),s>0){const r=mn(e),o=Array.from({length:Se},(d,p)=>p);for(let d=o.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[o[d],o[p]]=[o[p],o[d]]}const l=o.slice(0,s),c=Ye-1,u=((t==null?void 0:t.JUNK_UNIFORMER)||0)*.1;let f=null;l.forEach(d=>{let p;f===null?(p=r[Math.floor(Math.random()*r.length)],f=p):p=Math.random()<u?f:r[Math.floor(Math.random()*r.length)];const y=Math.random().toString(36).substr(2,9);n[c][d]={id:Math.random().toString(36).substr(2,9),goopGroupId:y,timestamp:Date.now(),color:p,groupMinY:c,groupMaxY:c,groupSize:1}})}return n},fs=(e,t,n)=>{for(const s of t.cells){const r=Ue(t.x+s.x),o=t.y+s.y;if(o+1>Ye)return!0;const l=Math.floor(o),c=Math.floor(o+1-1e-4);for(let a=l;a<=c;a++)if(a>=0&&a<Ye&&e[a][r]!==null)return!0}return!1},rp=(e,t,n)=>{let s=Math.floor(t.y);for(;s>-5&&fs(e,{...t,y:s});)s-=1;let r=s;for(;r<Ye&&!fs(e,{...t,y:r+1});)r+=1;return Math.max(s,r)},dy=(e,t,n)=>{const s=e[n][t];if(!s)return[];const r=[],o=new Set,l=[{x:t,y:n}],c=s.goopGroupId;for(;l.length>0;){const{x:a,y:u}=l.shift(),f=`${a},${u}`;if(o.has(f))continue;o.add(f),r.push({x:a,y:u});const d=[{x:Ue(a+1),y:u},{x:Ue(a-1),y:u},{x:a,y:u+1},{x:a,y:u-1}];for(const p of d)if(p.y>=0&&p.y<Ye){const y=e[p.y][p.x];y&&y.goopGroupId===c&&(o.has(`${p.x},${p.y}`)||l.push(p))}}return r},Ei=e=>{const t=e.map(r=>[...r]),n=new Set,s=(r,o,l,c)=>{const a=[],u=[{x:r,y:o}],f=new Set;for(;u.length>0;){const d=u.shift(),p=`${d.x},${d.y}`;if(f.has(p))continue;f.add(p),a.push(d);const y=[{x:Ue(d.x+1),y:d.y},{x:Ue(d.x-1),y:d.y},{x:d.x,y:d.y+1},{x:d.x,y:d.y-1}];for(const S of y)if(S.y>=0&&S.y<Ye){const R=t[S.y][S.x];if(!R||f.has(`${S.x},${S.y}`))continue;(c?R.isWild:R.color===l&&!R.isWild)&&u.push(S)}}return a};for(let r=0;r<Ye;r++)for(let o=0;o<Se;o++){const l=t[r][o];if(l&&!n.has(`${o},${r}`)){const c=s(o,r,l.color,!!l.isWild);let a=Ye,u=-1;c.forEach(j=>{j.y<a&&(a=j.y),j.y>u&&(u=j.y)});const f=c.length;let d=!0;const p=l.goopGroupId,y=l.groupSize;if(y!==f)d=!1;else for(const j of c){const g=t[j.y][j.x];if(!g||g.goopGroupId!==p||g.groupSize!==y){d=!1;break}}const S=d?p:Math.random().toString(36).substr(2,9),R=d?l.timestamp:Date.now();c.forEach(j=>{n.add(`${j.x},${j.y}`);const g=t[j.y][j.x];t[j.y][j.x]={...g,goopGroupId:S,timestamp:R,groupMinY:a,groupMaxY:u,groupSize:f}})}}return t},py=(e,t,n)=>{const s=e.map(p=>[...p]),r=Math.random().toString(36).substr(2,9),o=Date.now();let l=Ye,c=-1;const a=[],u=[];t.cells.forEach(p=>{const y=Math.floor(t.y+p.y);y<l&&(l=y),y>c&&(c=y)});const f=t.cells.length,d=t.definition.isWild;return t.cells.forEach((p,y)=>{var g;const S=Ue(t.x+p.x),R=Math.floor(t.y+p.y),j=((g=t.definition.cellColors)==null?void 0:g[y])??t.definition.color;if(R>=0&&R<Ye){const h=n.find(m=>m.x===S&&m.y===R);let x=!1;h&&(h.color===j||d)&&(a.push(h.id),x=!0),s[R][S]={id:Math.random().toString(36).substr(2,9),goopGroupId:r,timestamp:o,color:j,groupMinY:l,groupMaxY:c,groupSize:f,isSealingGoop:x,isWild:d}}}),{grid:Ei(s),consumedGoals:a,destroyedGoals:u}},hy=(e,t)=>{const n=e.map(c=>[...c]),s=t.definition.isWild,r=t.definition.color,o=[];t.cells.forEach(c=>{const a=Ue(t.x+c.x),u=Math.floor(t.y+c.y);u>=0&&u<Ye&&o.push({x:a,y:u})});const l=new Set;if(o.forEach(({x:c,y:a})=>{[{x:Ue(c+1),y:a},{x:Ue(c-1),y:a},{x:c,y:a+1},{x:c,y:a-1}].forEach(f=>{if(f.y>=0&&f.y<Ye){const d=n[f.y][f.x];if(!d||o.some(y=>y.x===f.x&&y.y===f.y))return;s?d.isWild||l.add(d.goopGroupId):d.isWild&&l.add(d.goopGroupId)}})}),l.size>0)for(let c=0;c<Ye;c++)for(let a=0;a<Se;a++){const u=n[c][a];u&&l.has(u.goopGroupId)&&(s?n[c][a]={...u,isWild:!0}:n[c][a]={...u,color:r,isWild:!1})}return Ei(n)},ip=(e,t)=>{const n=e.map(a=>[...a]),s=[],r=new Map;for(let a=0;a<Ye;a++)for(let u=0;u<Se;u++){const f=n[a][u];f&&(r.has(f.goopGroupId)||r.set(f.goopGroupId,[]),r.get(f.goopGroupId).push({x:u,y:a}))}let o;if(t&&t.length>0){const a=new Map;for(const u of t){const f=a.get(u.x);(f===void 0||u.y<f)&&a.set(u.x,u.y)}o=new Set;for(const[u,f]of r)for(const d of f){const p=a.get(d.x);if(p!==void 0&&d.y<p){o.add(u);break}}}else o=new Set(r.keys());const l=new Set;for(const[a,u]of r)for(const f of u)if(f.y===Ye-1){l.add(a);break}let c=!0;for(;c;){c=!1;for(const[a,u]of r)if(!l.has(a))for(const f of u){const d=f.y+1;if(d<Ye){const p=n[d][f.x];if(p&&p.goopGroupId!==a&&l.has(p.goopGroupId)){l.add(a),c=!0;break}}}}for(const a of o)if(!l.has(a)){const u=r.get(a);for(const f of u)s.push({data:n[f.y][f.x],x:f.x,y:f.y,velocity:0}),n[f.y][f.x]=null}return{grid:n,looseGoop:s}},xy=(e,t,n,s)=>{const r=[],o=[],l=.012*n,c=[...e].sort((a,u)=>u.y-a.y);for(const a of c){const u=a.y+l;if(u>=Ye-1){o.push({...a,y:Ye-1});continue}const f=Math.floor(u+1),d=a.x;t[f]&&t[f][d]?o.push({...a,y:Math.floor(u)}):r.push({...a,y:u})}return{active:r,landed:o}},yy=e=>Math.max(0,(Ye-e)*10),gy=(e,t)=>{const n=Ue(t+at/2);let s=Math.abs(e-n);return s>Se/2&&(s=Se-s),s>at/2?50:0},my=e=>1+e*.1,vy=(e,t)=>{let n=0;const s=new Set(t.map(r=>`${r.x},${r.y}`));return t.forEach(({x:r,y:o})=>{[{x:Ue(r+1),y:o},{x:Ue(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}].forEach(c=>{c.y>=0&&c.y<Ye&&e[c.y][c.x]&&!s.has(`${c.x},${c.y}`)&&n++})}),n*5},rf=(e,t,n,s,r,o=!1)=>{const l=mn(n),c=new Set(t.map(d=>d.color)),a=l.filter(d=>!c.has(d));if(a.length===0)return null;const u=a[Math.floor(Math.random()*a.length)];let f;if(o){const d=Ye-4,p=Ye-1;f=d+Math.floor(Math.random()*(p-d+1))}else{const p=1+Math.max(0,1-s/r)*(ln-1),y=Math.floor(Ye-p);f=Math.max(Qe,Math.min(Ye-1,y))}for(let d=0;d<20;d++){const p=Math.floor(Math.random()*Se),y=f;if(!e[y][p]&&!t.some(S=>S.x===p&&S.y===y))return{id:Math.random().toString(36).substr(2,9),x:p,y,color:u,spawnTime:Date.now()}}return null},Sy=(e,t,n,s,r)=>{const o=mn(n),l=[],c=[...t],u=1+Math.max(0,1-s/r)*(ln-1),f=Math.floor(Ye-u);let d=Qe,p=Math.max(Qe,f-1);for(const y of o)for(let S=0;S<20;S++){const R=Math.floor(Math.random()*Se),j=Math.floor(d+Math.random()*(p-d+1));if(j<Qe||j>=Ye)continue;const g=e[j][R]!==null,h=c.some(m=>m.x===R&&m.y===j),x=l.some(m=>m.x===R&&m.y===j);if(!g&&!h&&!x){const m={id:Math.random().toString(36).substr(2,9),x:R,y:j,color:y,spawnTime:Date.now()};l.push(m);break}}return l},ct=typeof navigator<"u"&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Cy=(e,t)=>{const n=Math.max(0,Math.min(100,e))/100;if(t==="drain")if(n>.5){const s=(n-.5)*2,r=Math.round(234+(59-234)*s),o=Math.round(179+(130-179)*s),l=Math.round(8+(246-8)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=n*2,r=Math.round(220+(234-220)*s),o=Math.round(38+(179-38)*s),l=Math.round(38+(8-38)*s);return`rgb(${r}, ${o}, ${l})`}else if(n<.5){const s=n*2,r=Math.round(34+(234-34)*s),o=Math.round(197+(179-197)*s),l=Math.round(94+(8-94)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=(n-.5)*2,r=Math.round(234+(220-234)*s),o=Math.round(179+(38-179)*s),l=Math.round(8+(38-8)*s);return`rgb(${r}, ${o}, ${l})`}},lf=({value:e,maxValue:t=100,colorMode:n,x:s,y:r,height:o=200,width:l=16})=>{const a=Math.max(0,Math.min(t,e))/t*(o-4),u=Cy(e,n),f="#1f2937",d="#111827";return i.jsxs("g",{transform:`translate(${s}, ${r})`,children:[i.jsx("rect",{x:0,y:0,width:l,height:o,rx:3,ry:3,fill:d,stroke:f,strokeWidth:1}),i.jsx("rect",{x:2,y:o-2-a,width:l-4,height:a,rx:2,ry:2,fill:u}),[.25,.5,.75].map(p=>i.jsx("line",{x1:0,y1:o-p*(o-4)-2,x2:4,y2:o-p*(o-4)-2,stroke:f,strokeWidth:1,opacity:.5},p))]})},De=30,Os={x:-(at/2)*De,y:0,w:at*De,h:ln*De};function lt(e){return(e-at/2)*De}function ky(e){return e/De+at/2}class wy{constructor(){ze(this,"handlers",new Map)}on(t,n){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(n),()=>this.off(t,n)}off(t,n){var s;(s=this.handlers.get(t))==null||s.delete(n)}emit(t,n){var s;(s=this.handlers.get(t))==null||s.forEach(r=>r(n))}}const me=new wy;var xe=(e=>(e.PIECE_MOVED="PIECE_MOVED",e.PIECE_ROTATED="PIECE_ROTATED",e.PIECE_DROPPED="PIECE_DROPPED",e.GOOP_POPPED="GOOP_POPPED",e.ACTION_REJECTED="ACTION_REJECTED",e.GAME_OVER="GAME_OVER",e.GOAL_CAPTURED="GOAL_CAPTURED",e.COMPLICATION_SPAWNED="COMPLICATION_SPAWNED",e.COMPLICATION_RESOLVED="COMPLICATION_RESOLVED",e.LIGHTS_FLICKER="LIGHTS_FLICKER",e.ABILITY_ACTIVATED="ABILITY_ACTIVATED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.GAME_START="GAME_START",e.GAME_PAUSED="GAME_PAUSED",e.GAME_RESUMED="GAME_RESUMED",e.GAME_EXITED="GAME_EXITED",e.MUSIC_START="MUSIC_START",e.MUSIC_STOP="MUSIC_STOP",e.INPUT_ROTATE="INPUT_ROTATE",e.INPUT_DRAG="INPUT_DRAG",e.INPUT_SWIPE_UP="INPUT_SWIPE_UP",e.INPUT_FAST_DROP="INPUT_FAST_DROP",e.INPUT_SWAP="INPUT_SWAP",e.INPUT_BLOCK_TAP="INPUT_BLOCK_TAP",e.INPUT_SWAP_HOLD="INPUT_SWAP_HOLD",e))(xe||{});const jy=1500,_s=250,_r=10,Po=20;function Py({callbacks:e,tankRotation:t,grid:n,tankPressure:s,powerUps:r}){const{onBlockTap:o,onRotate:l,onDragInput:c,onSwipeUp:a,onFastDrop:u,onSwap:f}=e,d=(r==null?void 0:r.GOOP_SWAP)||0,p=jy-d*250,[y,S]=v.useState(null),[R,j]=v.useState(null),[g,h]=v.useState(0),[x,m]=v.useState(null),P=v.useRef(null),k=v.useRef(null),C=v.useRef(null),w=v.useRef(null),{x:T,y:L,w:O,h:X}=Os,K=v.useCallback((q,pe,we)=>{const E=we,B=E.getBoundingClientRect(),ve=E.clientLeft||0,ie=E.clientTop||0,ye=q-B.left-ve,se=pe-B.top-ie,ge=E.clientWidth,oe=E.clientHeight,ke=ge/O,he=oe/X,Ee=Math.min(ke,he),Ge=O*Ee,$e=(ge-Ge)/2,Fe=T+(ye-$e)/Ee,Oe=L+se/Ee,Ie=ky(Fe),N=Oe/De+Qe;return{vx:Ie,vy:N,svgX:Fe,svgY:Oe,relX:ye,contentW:ge,relY:se}},[T,L,O,X]),ee=v.useCallback((q,pe)=>{if(q>=0&&q<at){const we=Math.floor(q),E=Ue(we+t),B=Math.floor(pe);if(B>=0&&B<Ye){const ve=n[B][E];if(ve)return{type:"BLOCK",x:E,y:B,cell:ve}}}return{type:"EMPTY"}},[t,n]),I=v.useCallback(()=>{k.current&&(clearInterval(k.current),k.current=null),h(0),m(null)},[]);v.useEffect(()=>()=>{k.current&&clearInterval(k.current)},[]);const J=v.useCallback(q=>{if(P.current)return;q.currentTarget.setPointerCapture(q.pointerId);const{relX:pe,relY:we,vx:E,vy:B}=K(q.clientX,q.clientY,q.currentTarget);P.current={startX:q.clientX,startY:q.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:q.pointerId,actionConsumed:!1},m({x:pe,y:we}),h(0);const ve=Date.now();k.current=window.setInterval(()=>{const se=Date.now()-ve;if(se<_s)return;const ge=se-_s,oe=Math.min(100,ge/p*100);h(oe),oe>=100&&(P.current&&(P.current.actionConsumed=!0),me.emit(xe.INPUT_SWAP),f==null||f(),I(),navigator.vibrate&&navigator.vibrate(50))},16);const ie=ee(E,B);if(ie.type==="BLOCK"&&ie.cell){const ye=ie.cell.groupSize*fo,se=Date.now()-ie.cell.timestamp,ge=Ye-1-s*(ln-1);ie.cell.groupMinY<ge?(j(ie.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(oe=>oe===ie.cell.goopGroupId?null:oe),300)):se<ye?(j(ie.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(oe=>oe===ie.cell.goopGroupId?null:oe),300)):S(ie.cell.goopGroupId)}},[K,ee,s,I,p]),ae=v.useCallback(q=>{if(!P.current||P.current.activePointerId!==q.pointerId)return;const{startX:pe,startY:we,isDragLocked:E}=P.current,B=q.clientX-pe,ve=q.clientY-we,ie=Math.abs(B),ye=Math.abs(ve);if(E||(ie>_r||ye>_r)&&(I(),P.current.isDragLocked=!0,S(null),ie>ye?P.current.lockedAxis="H":(P.current.lockedAxis="V",ve>0&&(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)))),P.current.isDragLocked){const se=P.current.lockedAxis;if(se==="H")B<-Po?(me.emit(xe.INPUT_DRAG,{direction:1}),c==null||c(1)):B>Po?(me.emit(xe.INPUT_DRAG,{direction:-1}),c==null||c(-1)):(me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0));else if(se==="V"){const ge=ve>0;me.emit(xe.INPUT_FAST_DROP,{active:ge}),u==null||u(ge)}}},[I]),W=v.useCallback(q=>{if(!P.current||P.current.activePointerId!==q.pointerId)return;const{startTime:pe,isDragLocked:we,actionConsumed:E,startX:B,startY:ve}=P.current,ie=Date.now()-pe,ye=q.clientX-B,se=q.clientY-ve;if(I(),me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1),me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0),S(null),P.current=null,q.currentTarget.releasePointerCapture(q.pointerId),!E&&!(ie>=_s))if(we)ie<300&&Math.abs(se)>Math.abs(ye)&&Math.abs(se)>50&&(se<0?(me.emit(xe.INPUT_SWIPE_UP),a==null||a()):(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0),setTimeout(()=>{me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)},150)));else{const{vx:ge,vy:oe,relX:ke,contentW:he}=K(q.clientX,q.clientY,q.currentTarget),Ee=ee(ge,oe);Ee.type==="BLOCK"&&Ee.cell?(me.emit(xe.INPUT_BLOCK_TAP,{x:Ee.x,y:Ee.y}),o==null||o(Ee.x,Ee.y)):ke<he/2?(me.emit(xe.INPUT_ROTATE,{clockwise:!1}),l==null||l(-1)):(me.emit(xe.INPUT_ROTATE,{clockwise:!0}),l==null||l(1))}},[I,K,ee]),Q=v.useCallback(()=>{w.current&&(window.removeEventListener("touchmove",w.current.move),window.removeEventListener("touchend",w.current.end),window.removeEventListener("touchcancel",w.current.end),w.current=null)},[]),Y=v.useCallback(q=>{if(q.touches.length!==1||P.current)return;q.preventDefault();const pe=q.touches[0],we=q.currentTarget;C.current=we;const{relX:E,relY:B,vx:ve,vy:ie}=K(pe.clientX,pe.clientY,we);P.current={startX:pe.clientX,startY:pe.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:pe.identifier,actionConsumed:!1},m({x:E,y:B}),h(0);const ye=Date.now();k.current=window.setInterval(()=>{const he=Date.now()-ye;if(he<_s)return;const Ee=he-_s,Ge=Math.min(100,Ee/p*100);h(Ge),Ge>=100&&(P.current&&(P.current.actionConsumed=!0),me.emit(xe.INPUT_SWAP),f==null||f(),I(),navigator.vibrate&&navigator.vibrate(50))},16);const se=ee(ve,ie);if(se.type==="BLOCK"&&se.cell){const ke=se.cell.groupSize*fo,he=Date.now()-se.cell.timestamp,Ee=Ye-1-s*(ln-1);se.cell.groupMinY<Ee?(j(se.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(Ge=>Ge===se.cell.goopGroupId?null:Ge),300)):he<ke?(j(se.cell.goopGroupId),me.emit(xe.ACTION_REJECTED),setTimeout(()=>j(Ge=>Ge===se.cell.goopGroupId?null:Ge),300)):S(se.cell.goopGroupId)}const ge=ke=>{if(!P.current||ke.touches.length!==1)return;ke.preventDefault();const he=ke.touches[0];if(he.identifier!==P.current.activePointerId)return;const{startX:Ee,startY:Ge,isDragLocked:$e}=P.current,Fe=he.clientX-Ee,Oe=he.clientY-Ge,Ie=Math.abs(Fe),N=Math.abs(Oe);if($e||(Ie>_r||N>_r)&&(I(),P.current.isDragLocked=!0,S(null),Ie>N?P.current.lockedAxis="H":(P.current.lockedAxis="V",Oe>0&&(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)))),P.current.isDragLocked){const G=P.current.lockedAxis;G==="H"?Fe<-Po?(me.emit(xe.INPUT_DRAG,{direction:1}),c==null||c(1)):Fe>Po?(me.emit(xe.INPUT_DRAG,{direction:-1}),c==null||c(-1)):(me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0)):G==="V"&&(Oe>Po?(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0)):(me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)))}},oe=ke=>{const he=ke.changedTouches[0];if(!P.current||!he||he.identifier!==P.current.activePointerId)return;const{startTime:Ee,isDragLocked:Ge,actionConsumed:$e,startX:Fe,startY:Oe}=P.current,Ie=Date.now()-Ee,N=he.clientX-Fe,G=he.clientY-Oe;I(),me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1),me.emit(xe.INPUT_DRAG,{direction:0}),c==null||c(0),S(null);const Ce=C.current;if(P.current=null,C.current=null,Q(),!$e&&!(Ie>=_s))if(!Ge&&Ce){const{vx:D,vy:F,relX:M,contentW:$}=K(he.clientX,he.clientY,Ce),V=ee(D,F);V.type==="BLOCK"&&V.cell?(me.emit(xe.INPUT_BLOCK_TAP,{x:V.x,y:V.y}),o==null||o(V.x,V.y)):M<$/2?(me.emit(xe.INPUT_ROTATE,{clockwise:!1}),l==null||l(-1)):(me.emit(xe.INPUT_ROTATE,{clockwise:!0}),l==null||l(1))}else Ge&&Ie<300&&Math.abs(G)>Math.abs(N)&&Math.abs(G)>50&&(G<0?(me.emit(xe.INPUT_SWIPE_UP),a==null||a()):(me.emit(xe.INPUT_FAST_DROP,{active:!0}),u==null||u(!0),setTimeout(()=>{me.emit(xe.INPUT_FAST_DROP,{active:!1}),u==null||u(!1)},150)))};w.current={move:ge,end:oe},window.addEventListener("touchmove",ge,{passive:!1}),window.addEventListener("touchend",oe),window.addEventListener("touchcancel",oe)},[K,ee,s,I,p,f,u,c,o,l,a,Q]);v.useEffect(()=>()=>Q(),[Q]);const re=v.useCallback(q=>{q.preventDefault()},[]),te=v.useCallback(q=>{q.preventDefault()},[]);return{handlers:{onPointerDown:J,onPointerMove:ae,onPointerUp:W,onTouchStart:Y,onTouchMove:re,onTouchEnd:te,onTouchCancel:te},holdState:{progress:g,position:x},highlightedGroupId:y,shakingGroupId:R,setHighlightedGroupId:S,setShakingGroupId:j}}const lp=8;function Ry(e,t,n,s,r,o=lp){let l="";return!r.t&&!r.l?l+=`M ${e} ${t+o} Q ${e} ${t} ${e+o} ${t} `:l+=`M ${e} ${t} `,!r.t&&!r.r?l+=`L ${e+n-o} ${t} Q ${e+n} ${t} ${e+n} ${t+o} `:l+=`L ${e+n} ${t} `,!r.b&&!r.r?l+=`L ${e+n} ${t+s-o} Q ${e+n} ${t+s} ${e+n-o} ${t+s} `:l+=`L ${e+n} ${t+s} `,!r.b&&!r.l?l+=`L ${e+o} ${t+s} Q ${e} ${t+s} ${e} ${t+s-o} `:l+=`L ${e} ${t+s} `,l+="Z",l}function Ir(e,t,n,s,r,o=lp){const l=o;let c="";if(!r.t){const a=r.l?e:e+l,u=r.r?e+n:e+n-l;c+=`M ${a} ${t} L ${u} ${t} `}if(!r.r){const a=r.t?t:t+l,u=r.b?t+s:t+s-l;c+=`M ${e+n} ${a} L ${e+n} ${u} `}if(!r.b){const a=r.l?e:e+l,u=r.r?e+n:e+n-l;c+=`M ${u} ${t+s} L ${a} ${t+s} `}if(!r.l){const a=r.t?t:t+l,u=r.b?t+s:t+s-l;c+=`M ${e} ${u} L ${e} ${a} `}return!r.t&&!r.l&&(c+=`M ${e} ${t+l} Q ${e} ${t} ${e+l} ${t} `),!r.t&&!r.r&&(c+=`M ${e+n-l} ${t} Q ${e+n} ${t} ${e+n} ${t+l} `),!r.b&&!r.r&&(c+=`M ${e+n} ${t+s-l} Q ${e+n} ${t+s} ${e+n-l} ${t+s} `),!r.b&&!r.l&&(c+=`M ${e+l} ${t+s} Q ${e} ${t+s} ${e} ${t+s-l} `),c}function by(e,t,n){var o,l,c,a;const s=new Map;for(let u=Qe;u<Qe+ln;u++)for(let f=0;f<at;f++){const d=Ue(f+t),p=e[u][d];if(!p)continue;const y=lt(f),R=lt(f+1)-y;if(R<=0)continue;const j=(u-Qe)*De,g={t:u>0&&((o=e[u-1][d])==null?void 0:o.goopGroupId)===p.goopGroupId,b:u<Ye-1&&((l=e[u+1][d])==null?void 0:l.goopGroupId)===p.goopGroupId,l:((c=e[u][Ue(d-1)])==null?void 0:c.goopGroupId)===p.goopGroupId,r:((a=e[u][Ue(d+1)])==null?void 0:a.goopGroupId)===p.goopGroupId};s.has(p.goopGroupId)||s.set(p.goopGroupId,[]),s.get(p.goopGroupId).push({visX:f,y:u,screenX:y,screenY:j,width:R,cell:p,color:p.color,neighbors:g})}const r=new Map;return n.forEach(u=>{r.has(u.data.goopGroupId)||r.set(u.data.goopGroupId,[]),r.get(u.data.goopGroupId).push(u)}),r.forEach((u,f)=>{const d=new Set;u.forEach(p=>d.add(`${Math.round(p.x)},${Math.round(p.y)}`)),u.forEach(p=>{if(p.y<Qe-1)return;let y=p.x-t;if(y>Se/2&&(y-=Se),y<-Se/2&&(y+=Se),y>=0&&y<at){const S=lt(y),j=lt(y+1)-S,g=(p.y-Qe)*De,h=Math.round(p.x),x=Math.round(p.y),m={t:d.has(`${h},${x-1}`),r:d.has(`${Ue(h+1)},${x}`),b:d.has(`${h},${x+1}`),l:d.has(`${Ue(h-1)},${x}`)};s.has(f)||s.set(f,[]),s.get(f).push({visX:y,y:p.y,screenX:S,screenY:g,width:j,cell:p.data,color:p.data.color,neighbors:m,isFalling:!0})}})}),s}const My=e=>{switch(e){case"COOLDOWN_BOOSTER":return"CB";case"GOOP_DUMP":return"GD";case"GOOP_COLORIZER":return"GC";case"CRACK_DOWN":return"CD";default:return e.charAt(0)}},Ty=e=>{switch(e){case"COOLDOWN_BOOSTER":return"#5bbc70";case"GOOP_DUMP":return"#f97316";case"GOOP_COLORIZER":return"#a855f7";case"CRACK_DOWN":return"#ef4444";default:return"#6acbda"}},Ey=({upgradeId:e,name:t,charge:n,isReady:s,x:r,y:o,size:l,onClick:c})=>{const[a,u]=v.useState(!1),f=v.useCallback(x=>{x.stopPropagation(),x.preventDefault(),s?c==null||c():(u(!0),setTimeout(()=>u(!1),300))},[s,c]),d=Ty(e),p=My(e),y=l/2,S=2,R=n/100,j=y*2,g=R*j,h=y-g;return i.jsx("g",{transform:`translate(${r}, ${o})`,children:i.jsxs("g",{className:a?"shake-anim":"",style:{cursor:"pointer"},onPointerDown:f,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:`clip-${e}`,children:i.jsx("circle",{cx:0,cy:0,r:y-S})})}),i.jsx("circle",{cx:0,cy:0,r:y-S,fill:d,fillOpacity:.25}),!s&&i.jsx("rect",{x:-(y-S),y:h,width:(y-S)*2,height:g,fill:d,fillOpacity:.75,clipPath:`url(#clip-${e})`}),s&&i.jsx("circle",{cx:0,cy:0,r:y-S,fill:d,fillOpacity:.85}),i.jsx("circle",{cx:0,cy:0,r:y-S,fill:"none",stroke:d,strokeWidth:S}),s&&i.jsx("circle",{cx:0,cy:0,r:y,fill:"none",stroke:d,strokeWidth:2,opacity:.5,className:"animate-pulse"}),i.jsx("text",{x:0,y:0,textAnchor:"middle",dominantBaseline:"central",fill:s?"white":"#e2e8f0",fontSize:l*.3,fontWeight:"bold",fontFamily:"monospace",children:p})]})})},Is=48,Ls=12,cf=({piece:e,label:t,visible:n,rank:s=0})=>{const[r,o]=v.useState(Date.now());if(v.useEffect(()=>{if(!(e!=null&&e.isWild))return;const a=setInterval(()=>o(Date.now()),50);return()=>clearInterval(a)},[e==null?void 0:e.isWild]),!n)return null;const l=a=>{const u=mn(s),f=400,d=.15,p=r%(u.length*f)/f,y=a*d,S=(p+y)%u.length,R=Math.floor(S),j=(R+1)%u.length,g=S-R,h=u[R],x=u[j],m=parseInt(h.slice(1,3),16),P=parseInt(h.slice(3,5),16),k=parseInt(h.slice(5,7),16),C=parseInt(x.slice(1,3),16),w=parseInt(x.slice(3,5),16),T=parseInt(x.slice(5,7),16),L=Math.round(m+(C-m)*g),O=Math.round(P+(w-P)*g),X=Math.round(k+(T-k)*g);return`rgb(${L}, ${O}, ${X})`};let c=null;if(e){const a=e.isWild,u=Math.min(...e.cells.map(g=>g.x)),f=Math.max(...e.cells.map(g=>g.x)),d=Math.min(...e.cells.map(g=>g.y)),p=Math.max(...e.cells.map(g=>g.y)),y=f-u+1,S=p-d+1,R=(Is-y*Ls)/2,j=(Is-S*Ls)/2;c=e.cells.map((g,h)=>{var m;const x=R+(g.x-u)*Ls;return i.jsx("rect",{x,y:j+(g.y-d)*Ls,width:Ls-1,height:Ls-1,fill:a?l(x):((m=e.cellColors)==null?void 0:m[h])??e.color,rx:2},h)})}return i.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",border:"2px solid #475569",borderRadius:"6px",padding:"4px 6px",display:"flex",flexDirection:"column",alignItems:"center"},children:[i.jsx("div",{style:{fontSize:"9px",color:"#94a3b8",textAlign:"center",marginBottom:"2px",fontFamily:"monospace",letterSpacing:"1px"},children:t}),i.jsxs("svg",{width:Is,height:Is,style:{display:"block"},children:[i.jsx("rect",{x:0,y:0,width:Is,height:Is,fill:"rgba(30, 41, 59, 0.5)",rx:4}),c]})]})};function Ay(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function cp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=Ay(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function _y(e){return cp(e.map(t=>t.pos))}function af(e){return _y(e.vertices)}function Iy(e){let t=1/0,n=-1/0,s=1/0,r=-1/0;for(const o of e)o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y);return{minX:t,maxX:n,minY:s,maxY:r}}function Ly(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?100:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<1e-4||S<1e-4){r.push({...c});continue}const R=-f/y,j=u/y,g=-p/S,h=d/S;let x=R+g,m=j+h;const P=Math.sqrt(x*x+m*m);P<1e-4?(x=R,m=j):(x/=P,m/=P);const k=R*x+j*m,C=k>.1?1/k:1,w=s[o]*.4,T=Math.min(t,w)*Math.min(C,2);r.push({x:c.x+x*T,y:c.y+m*T})}return r}function uf(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function ff(e,t){const n=t*Math.PI/180,s=Math.cos(n),r=Math.sin(n);return{x:e.x*s-e.y*r,y:e.x*r+e.y*s}}const Ai={damping:.98,stiffness:15,pressure:20,iterations:3,homeStiffness:.35,innerHomeStiffness:.64,returnSpeed:.8,viscosity:.7,gravity:10,fallingHomeStiffness:.35,fallingReturnSpeed:.8,fallingViscosity:.7,fallingGravity:10,attractionRadius:30,attractionRestLength:1,attractionStiffness:.037,goopiness:36,tendrilEndRadius:1,tendrilSkinniness:.2,wallThickness:8,fallingGoopiness:36,fallingTendrilEndRadius:1,fallingTendrilSkinniness:.2,dropletCount:30,dropletSpeed:60,dropletLifetime:3,dropletSize:9,dropletGravity:180},Rt=30,vn={x:-(at/2)*Rt,y:0},Lo=Se*Rt;function Ny(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function Oy(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push({x:c.x,y:c.y});const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(j=>!r.has(j));if(y.length===0)break;let S=y[0],R=-1/0;for(const j of y){const g=n(j,u),h=s(a,g);h>R&&(R=h,S=j)}l=S,c=u}return o}function Dy(e){return e.map(t=>({x:vn.x+t.x*Rt,y:vn.y+t.y*Rt}))}function df(e){let t=0,n=0;for(const s of e){const r=vn.x+(s.x+.5)*Rt,o=vn.y+(s.y+.5)*Rt;t+=r,n+=o}return{x:t/e.length,y:n/e.length}}function $y(e){if(e.length<3)return e;let t=0;for(let n=0;n<e.length;n++){const s=(n+1)%e.length;t+=e[n].x*e[s].y,t-=e[s].x*e[n].y}return t/=2,t>0?e:[...e].reverse()}function Fy(e,t,n,s,r=0){const o=Ny(e),l=Oy(o),c=Dy(l);let a=$y(c);if(a.length<3){const m=df(e),P=Rt*.4;a=[{x:m.x-P,y:m.y-P},{x:m.x+P,y:m.y-P},{x:m.x+P,y:m.y+P},{x:m.x-P,y:m.y+P}]}const u=df(e),f=u.x,d=u.y,p=a.map(m=>({pos:{x:m.x,y:m.y},oldPos:{x:m.x,y:m.y},homeOffset:{x:m.x-f,y:m.y-d},mass:1,attractionRadius:.8+Math.random()*.4})),y=p.length,S=[];for(let m=0;m<y;m++){const P=(m+1)%y;S.push({a:m,b:P,restLength:uf(p[m].pos,p[P].pos)})}const R=[],j=Rt*1.5,g=new Set;for(let m=0;m<y;m++)for(let P=m+2;P<y;P++){if(P===y-1&&m===0)continue;const k=uf(p[m].pos,p[P].pos);if(k<j){const C=`${Math.min(m,P)}-${Math.max(m,P)}`;g.has(C)||(g.add(C),R.push({a:m,b:P,restLength:k}))}}let h=0;for(let m=0;m<a.length;m++){const P=(m+1)%a.length;h+=a[m].x*a[P].y-a[P].x*a[m].y}return h=Math.abs(h)/2,{id:n,color:t,vertices:p,innerVertices:[{pos:{x:f,y:d},oldPos:{x:f,y:d},homeOffset:{x:0,y:0},mass:1,attractionRadius:1}],ringsprings:S,crossSprings:R,restArea:h,gridCells:e.map(m=>({x:m.x,y:m.y})),isColliding:!1,isLocked:s,isFalling:!s,isLoose:!1,fillAmount:s?0:1,wasFullLastFrame:!s,rotation:0,targetX:f,targetY:d,visualOffsetY:0,createdAtRotation:r}}function pf(e){if(e.vertices.length<3)return[0];const t=e.vertices.map(a=>a.pos.x),n=Math.min(...t),s=Math.max(...t),r=-180,o=180,l=[],c=Lo;for(const a of[0,c,-c]){const u=n+a;s+a>=r&&u<=o&&l.push(a)}return l.length>1&&console.log(`Blob ${e.id} straddles seam, rendering at offsets:`,l,`(X range: ${n.toFixed(0)} to ${s.toFixed(0)})`),l.length>0?l:[0]}const By=({state:e,rank:t,maxTime:n,lightsBrightness:s=100,laserCharge:r=100,controlsHeat:o=0,complicationCooldowns:l,equippedActives:c=[],activeCharges:a={},onActivateAbility:u,powerUps:f,storedGoop:d,nextGoop:p,softBodyPhysics:y,normalGoopOpacity:S=1,showVertexDebug:R=!1,gooStdDev:j=8,gooAlphaMul:g=24,gooAlphaOff:h=-13,fallingGooStdDev:x,fallingGooAlphaMul:m,fallingGooAlphaOff:P})=>{const{grid:k,tankRotation:C,activeGoop:w,looseGoop:T,floatingTexts:L,shiftTime:O,goalMarks:X,crackCells:K,dumpPieces:ee}=e,I=v.useMemo(()=>mn(t),[t]),J=v.useMemo(()=>O<=0?1:Math.max(0,1-O/n),[O,n]),W=`hsla(${Math.max(0,120*(1-J))}, 100%, 50%, 0.15)`,Q=1+J*(ln-1),{x:Y,y:re,w:te,h:q}=Os,pe=Q*De,we=q-pe,E=v.useCallback((D,F)=>{let M=D-C;M>Se/2&&(M-=Se),M<-Se/2&&(M+=Se);const $=lt(M),V=(F-Qe)*De+De/2,U=($-Y)/te*100,le=(V-re)/q*100;return{x:U,y:le}},[C]),{handlers:B,holdState:ve,highlightedGroupId:ie,shakingGroupId:ye}=Py({callbacks:{},tankRotation:C,grid:k,tankPressure:J,powerUps:f}),[se,ge]=v.useState(-1),[oe,ke]=v.useState(0);v.useEffect(()=>me.on(xe.INPUT_SWAP_HOLD,F=>{ge((F==null?void 0:F.progress)??-1)}),[]),v.useEffect(()=>{var le,b;if(!y||ct)return;const D=new Set;for(let _=Qe;_<Ye;_++)for(let A=0;A<Se;A++){const z=(le=k[_])==null?void 0:le[A];z!=null&&z.goopGroupId&&D.add(z.goopGroupId)}const F=new Map;for(let _=0;_<ln;_++){const A=_+Qe;for(let z=0;z<at;z++){const H=(C+z)%Se,Z=(b=k[A])==null?void 0:b[H];if(Z!=null&&Z.goopGroupId){const ne=Z.goopGroupId;F.has(ne)||F.set(ne,{cells:[],color:Z.color}),F.get(ne).cells.push({x:z,y:_})}}}const M=new Set(y.blobs.map(_=>_.id));let $=!1;for(const[_,A]of F)M.has(_)||(y.createBlob(A.cells,A.color,_,!0,C),$=!0);y.shiftBlobsForRotation(C);const V=new Map;for(const _ of T){const A=_.data.goopGroupId;V.has(A)||V.set(A,{avgY:0,cells:[]}),V.get(A).cells.push({x:_.x,y:_.y})}for(const[_,A]of V){const z=A.cells.reduce((H,Z)=>H+Z.y,0)/A.cells.length;A.avgY=z}for(const _ of y.blobs){const A=V.get(_.id);if(A){_.isLoose=!0,_.isLocked=!1;const z=(A.avgY-Qe)*Rt;_.targetY=z}else _.isLoose&&(_.isLoose=!1,_.isLocked=!0,_.fillAmount=0)}const U=new Set(T.map(_=>_.data.goopGroupId));for(const _ of y.blobs)_.id.startsWith("active-")||!D.has(_.id)&&!U.has(_.id)&&(e.poppedGoopGroupIds.has(_.id)&&(y.createDropletsForPop(_),e.poppedGoopGroupIds.delete(_.id)),y.removeBlob(_.id),$=!0);$&&ke(_=>_+1)},[k,C,y]);const he=v.useRef(null);v.useEffect(()=>{var M;if(!y||ct||!w||w.state!==Ln.FALLING)return;const D=`active-${w.spawnTimestamp}`;if(!y.getBlob(D)&&w.y<=5){const $=w.cells.map(b=>({x:b.x,y:b.y}));let V=w.x-C;V>Se/2&&(V-=Se),V<-Se/2&&(V+=Se);const U=$.map(b=>({x:V+b.x,y:w.y+b.y-Qe})),le=((M=w.definition.cellColors)==null?void 0:M[0])??w.definition.color;y.createBlob(U,le,D,!1,C),ke(b=>b+1)}},[w==null?void 0:w.spawnTimestamp,y,C]);const Ee=v.useRef(null),Ge=v.useRef(0);v.useEffect(()=>{if(!y||ct||!w||w.state!==Ln.FALLING)return;const D=`active-${w.spawnTimestamp}`,F=y.getBlob(D);if(!F)return;let M=w.x-C;M>Se/2&&(M-=Se),M<-Se/2&&(M+=Se);const $=w.rotation,V=Ee.current!==null&&Ee.current!==$,U=Ge.current!==C;if(V){let le=F.gridCells.length>0?F.gridCells[0].y:0;for(const A of F.gridCells)A.y<le&&(le=A.y);let b=w.cells.length>0?w.cells[0].y:0;for(const A of w.cells)A.y<b&&(b=A.y);const _=w.cells.map(A=>({x:M+A.x,y:le+(A.y-b)}));F.gridCells=_,F.rotation=$*90}if(U||V){for(let A=0;A<F.gridCells.length&&A<w.cells.length;A++)F.gridCells[A].x=M+w.cells[A].x;let le=0;for(const A of F.gridCells)le+=A.x;const b=le/F.gridCells.length,_=vn.x+(b+.5)*Rt;if(U){const A=_-F.targetX;for(const z of F.vertices)z.pos.x+=A,z.oldPos.x+=A;for(const z of F.innerVertices)z.pos.x+=A,z.oldPos.x+=A}F.targetX=_}Ee.current=$,Ge.current=C},[w==null?void 0:w.x,w==null?void 0:w.rotation,w==null?void 0:w.state,y,C,ct]),v.useEffect(()=>{if(!y||ct)return;const D=he.current,F=w;if(D&&D.state===Ln.FALLING&&(!F||F.spawnTimestamp!==D.spawnTimestamp)){const M=`active-${D.spawnTimestamp}`;y.removeBlob(M),ke($=>$+1)}he.current=F},[w,y]);const $e=Date.now(),Fe=v.useMemo(()=>by(k,C,T),[k,C,T]),Oe=v.useCallback(D=>{if(I.length===0)return"#a855f7";const F=400,M=.02,$=$e%(I.length*F)/F,V=Math.abs(D)*M;let U=($+V)%I.length;U<0&&(U+=I.length);const le=Math.floor(U),b=(le+1)%I.length,_=U-le,A=I[le],z=I[b];if(!A||!z)return"#a855f7";const H=parseInt(A.slice(1,3),16),Z=parseInt(A.slice(3,5),16),ne=parseInt(A.slice(5,7),16),ue=parseInt(z.slice(1,3),16),de=parseInt(z.slice(3,5),16),Te=parseInt(z.slice(5,7),16),be=Math.round(H+(ue-H)*_),Le=Math.round(Z+(de-Z)*_),Ne=Math.round(ne+(Te-ne)*_);return`rgb(${be}, ${Le}, ${Ne})`},[$e,I]),Ie=v.useMemo(()=>ct?null:i.jsx("defs",{children:Array.from(Fe.entries()).map(([D,F])=>i.jsx("mask",{id:`mask-${D}`,children:F.map((M,$)=>i.jsx("path",{d:Ry(M.screenX,M.screenY,M.width,De,M.neighbors),fill:"white",stroke:"white",strokeWidth:"1.5"},M.cell.id+"-"+$))},`mask-${D}`))}),[Fe]);v.useMemo(()=>new Set(X.map(D=>D.color)),[X]);const N=X.filter(D=>$e-D.spawnTime<500),G=((f==null?void 0:f.GOOP_HOLD_VIEWER)||0)>=1,Ce=((f==null?void 0:f.GOOP_WINDOW)||0)>=1;return i.jsxs("div",{className:"w-full h-full bg-slate-950 relative shadow-2xl border-x-4 border-slate-900 overflow-hidden select-none touch-none",style:{touchAction:"manipulation",contain:"strict"},onPointerDown:B.onPointerDown,onPointerMove:B.onPointerMove,onPointerUp:B.onPointerUp,onPointerLeave:B.onPointerUp,onTouchStart:B.onTouchStart,onTouchMove:B.onTouchMove,onTouchEnd:B.onTouchEnd,onTouchCancel:B.onTouchCancel,children:[!ct&&i.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] hidden md:block",style:{backgroundSize:"100% 2px, 3px 100%"}}),i.jsxs("svg",{width:"100%",height:"100%",viewBox:`${Y} ${re} ${te} ${q}`,preserveAspectRatio:"xMidYMin meet",className:"touch-none",style:{pointerEvents:"none",willChange:"transform",filter:s<100?`brightness(${s/100}) grayscale(${Math.max(0,(50-s)/50)})`:s>100?`brightness(${s/100})`:void 0,transition:"filter 0.05s linear"},children:[Ie,i.jsxs("defs",{children:[i.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:j,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${g} ${h}`,result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),i.jsxs("filter",{id:"goo-filter-falling",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:x??j,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${m??g} ${P??h}`,result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),i.jsx("clipPath",{id:"tank-viewport-clip",children:i.jsx("rect",{x:Os.x,y:Os.y,width:Os.w,height:Os.h})})]}),i.jsx("rect",{x:Y,y:we,width:te,height:pe,fill:W}),i.jsx("line",{x1:Y,y1:we,x2:Y+te,y2:we,stroke:W.replace("0.15","0.6"),strokeWidth:"2",strokeDasharray:"4 4"}),!ct&&Array.from({length:ln}).map((D,F)=>{const M=F*De;return Array.from({length:at}).map(($,V)=>{const U=lt(V),le=lt(V+1)-U;return i.jsxs("g",{children:[i.jsx("line",{x1:U,y1:M,x2:U+le,y2:M,stroke:Ct.GRID_EMPTY,strokeWidth:"1",opacity:.2}),i.jsx("line",{x1:U,y1:M,x2:U,y2:M+De,stroke:Ct.GRID_EMPTY,strokeWidth:"1",opacity:.2})]},`bg-${F}-${V}`)})}),K&&K.filter(D=>$e-D.spawnTime>=500).map(D=>D.branchCrackIds.map(F=>{const M=K.find(ne=>ne.id===F);if(!M||$e-M.spawnTime<500)return null;let $=D.x-C;$>Se/2&&($-=Se),$<-Se/2&&($+=Se);let V=M.x-C;if(V>Se/2&&(V-=Se),V<-Se/2&&(V+=Se),$<-1||$>at||V<-1||V>at)return null;const U=lt($),le=lt($+1)-U,b=U+le/2,_=(D.y-Qe)*De+De/2,A=lt(V),z=lt(V+1)-A,H=A+z/2,Z=(M.y-Qe)*De+De/2;return i.jsx("line",{x1:b,y1:_,x2:H,y2:Z,stroke:D.color,strokeWidth:"2",strokeOpacity:.7},`crack-line-${D.id}-${F}`)})),K&&K.filter(D=>$e-D.spawnTime>=500).map(D=>{let F=D.x-C;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F>=0&&F<at){const M=lt(F),$=lt(F+1)-M,V=(D.y-Qe)*De,U=M+$/2,le=V+De/2;return i.jsx("circle",{cx:U,cy:le,r:De/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`crack-${D.id}`)}return null}),X.filter(D=>$e-D.spawnTime>=500).map(D=>{let F=D.x-C;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F>=0&&F<at){const M=lt(F),$=lt(F+1)-M,V=(D.y-Qe)*De,U=M+$/2,le=V+De/2;return i.jsx("circle",{cx:U,cy:le,r:De/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`goal-${D.id}`)}return null}),X.map(D=>{const F=Ue(C+at/2);let M=D.x-F;if(M>Se/2&&(M-=Se),M<-Se/2&&(M+=Se),Math.abs(M)>at/2){const $=M>0,V=(D.y-Qe)*De+De/2,U=$?Y+te-5:Y+5;return i.jsx("g",{opacity:.7,children:i.jsx("path",{d:$?`M ${U} ${V-10} L ${U+10} ${V} L ${U} ${V+10} Z`:`M ${U} ${V-10} L ${U-10} ${V} L ${U} ${V+10} Z`,fill:D.color,stroke:"white",strokeWidth:"1"})},`off-${D.id}`)}return null}),i.jsx("g",{opacity:S,children:Array.from(Fe.entries()).map(([D,F])=>{if(F.length===0)return null;const $=F[0].color,V=D===ie,U=D===ye||e.prePoppedGoopGroups.has(D),le=F.some(ue=>ue.cell.isSealingGoop),b=e.prePoppedGoopGroups.has(D),_=F.some(ue=>ue.cell.isWild);let A=1/0,z=1/0,H=-1/0,Z=-1/0;F.forEach(ue=>{A=Math.min(A,ue.screenX),z=Math.min(z,ue.screenY),H=Math.max(H,ue.screenX+ue.width),Z=Math.max(Z,ue.screenY+De)});const ne=_?Oe(A):$;if(ct){const ue=F[0].cell.groupSize*fo,de=$e-F[0].cell.timestamp,Te=Math.min(1,de/ue),be=Te>=1,Le=Z-z,Ne=Z-Te*Le;return i.jsxs("g",{className:U?"shake-anim":"",children:[F.map(je=>i.jsx("rect",{x:je.screenX-.5,y:je.screenY,width:je.width+1,height:De,fill:je.cell.isWild?Oe(je.screenX):$,fillOpacity:.25},`bg-${je.cell.id}`)),!be&&F.map(je=>{const _e=je.screenY+De,We=je.screenY;if(_e<=Ne)return null;const ce=Math.max(We,Ne),Be=_e-ce;return i.jsx("rect",{x:je.screenX-.5,y:ce,width:je.width+1,height:Be,fill:je.cell.isWild?Oe(je.screenX):$,fillOpacity:.75},`fill-${je.cell.id}`)}),be&&F.map(je=>i.jsx("rect",{x:je.screenX-.5,y:je.screenY,width:je.width+1,height:De,fill:je.cell.isWild?Oe(je.screenX):$,fillOpacity:.85},`full-${je.cell.id}`)),F.map(je=>i.jsx("path",{d:Ir(je.screenX,je.screenY,je.width,De,je.neighbors),fill:"none",stroke:b?"#ff6b6b":le?"white":je.cell.isWild?Oe(je.screenX):$,strokeWidth:b||le?3:2,strokeDasharray:b?"4 2":void 0,className:je.cell.isWild&&!b&&!le?"wild-stroke":void 0},`cnt-${je.cell.id}`)),V&&i.jsx("rect",{x:A,y:z,width:H-A,height:Z-z,fill:"white",fillOpacity:.3})]},`group-${D}`)}return i.jsxs("g",{className:U?"shake-anim":"",children:[i.jsx("rect",{x:A,y:z,width:H-A,height:Z-z,fill:ne,fillOpacity:.2,mask:`url(#mask-${D})`}),i.jsx("g",{opacity:.9,mask:`url(#mask-${D})`,children:F.map((ue,de)=>{const Te=ue.cell.isWild?Oe(ue.screenX):$;if(!ue.cell||ue.isFalling)return i.jsx("rect",{x:ue.screenX-.5,y:ue.screenY,width:ue.width+1,height:De,fill:Te},`liq-${ue.cell.id}`);const be=ue.cell.groupSize*fo,Le=ue.cell.groupMaxY-ue.cell.groupMinY+1,Ne=be/Math.max(1,Le),_e=(ue.cell.groupMaxY-ue.y)*Ne,We=$e-ue.cell.timestamp-_e;let ce=We>=Ne?De:We>0?We/Ne*De:0;return i.jsx("rect",{x:ue.screenX-.5,y:ue.screenY+(De-ce),width:ue.width+1,height:ce,fill:Te},`liq-${ue.cell.id}`)})}),V&&i.jsx("rect",{x:A,y:z,width:H-A,height:Z-z,fill:"white",fillOpacity:.3,mask:`url(#mask-${D})`}),F.map((ue,de)=>i.jsx("path",{d:Ir(ue.screenX,ue.screenY,ue.width,De,ue.neighbors),fill:"none",stroke:b?"#ff6b6b":le?"white":ue.cell.isWild?Oe(ue.screenX):$,strokeWidth:b||le?"3":"2",strokeDasharray:b?"4 2":void 0,className:!ct&&!b?ue.cell.isWild?"wild-stroke":le?"super-glowing-stroke":"glow-stroke":void 0,style:!ct&&!b&&!ue.cell.isWild?{color:le?"white":$}:void 0},`cnt-${ue.cell.id}`))]},`group-${D}`)})}),!ct&&y&&y.blobs.length>0&&(()=>{const D=new Map;for(const $ of y.blobs){if($.isFalling)continue;const V=D.get($.color)||[];V.push($),D.set($.color,V)}const F=y.attractionSprings,M=y.params;return i.jsx(i.Fragment,{children:Array.from(D.entries()).map(([$,V])=>i.jsxs("g",{filter:"url(#goo-filter)",clipPath:"url(#tank-viewport-clip)",children:[F.map((U,le)=>{const b=y.blobs[U.blobA],_=y.blobs[U.blobB];if(!b||!_||b.color!==$)return null;const A=b.vertices[U.vertexA],z=_.vertices[U.vertexB];if(!A||!z)return null;const H=z.pos.x-A.pos.x,Z=z.pos.y-A.pos.y,ne=Math.sqrt(H*H+Z*Z),ue=Math.min(1,ne/M.goopiness),de=M.tendrilEndRadius;if(de<1)return null;const Te=1-M.tendrilSkinniness,be=1-M.tendrilSkinniness*.3,Le=be-(be-Te)*ue,Ne=de*Le,je=de*1.4,_e=Math.max(2,Math.ceil(ne/je)),We=[];for(let ce=0;ce<=_e;ce++){const Be=ce/_e,Xe=Math.sin(Be*Math.PI),wt=de-(de-Ne)*Xe;We.push({cx:A.pos.x+H*Be,cy:A.pos.y+Z*Be,r:Math.max(2,wt)})}return i.jsx("g",{children:We.map((ce,Be)=>i.jsx("circle",{cx:ce.cx,cy:ce.cy,r:ce.r,fill:b.color},Be))},`tendril-${le}`)}),V.map(U=>{const le=af(U),b=U.vertices.map(H=>H.pos),A=pf(U).map(H=>H===0?"":`translate(${H}, 0)`);if(U.isLocked&&U.fillAmount<1){const H=M.wallThickness,Z=Ly(b,H),ne=cp(Z),ue=Iy(Z),de=ue.maxY-ue.minY,Te=ue.maxY-de*U.fillAmount,be=`fill-clip-${U.id}`,Le=50;return i.jsx("g",{children:A.map((Ne,je)=>i.jsxs("g",{transform:Ne,children:[i.jsx("path",{d:le,fill:U.color}),i.jsx("defs",{children:i.jsx("clipPath",{id:`${be}-${je}`,children:i.jsx("rect",{x:ue.minX-Le,y:ue.minY-Le,width:ue.maxX-ue.minX+Le*2,height:Te-ue.minY+Le})})}),i.jsx("path",{d:ne,fill:"#1e293b",clipPath:`url(#${be}-${je})`})]},`soft-${U.id}-${je}`))},`soft-${U.id}`)}return i.jsx("g",{children:A.map((H,Z)=>i.jsx("path",{d:le,fill:U.color,transform:H},`soft-${U.id}-${Z}`))},`soft-${U.id}`)})]},`color-group-${$}`))})})(),!ct&&y&&(()=>{const D=y.blobs.filter($=>$.isFalling&&!$.isLocked);if(D.length===0)return null;const F=y.attractionSprings,M=y.params;return i.jsxs("g",{filter:"url(#goo-filter-falling)",clipPath:"url(#tank-viewport-clip)",children:[F.map(($,V)=>{const U=y.blobs[$.blobA],le=y.blobs[$.blobB];if(!U||!le||!U.isFalling&&!le.isFalling)return null;const b=U.vertices[$.vertexA],_=le.vertices[$.vertexB];if(!b||!_)return null;const A=_.pos.x-b.pos.x,z=_.pos.y-b.pos.y,H=Math.sqrt(A*A+z*z),Z=Math.min(1,H/M.fallingGoopiness),ne=M.fallingTendrilEndRadius;if(ne<1)return null;const ue=1-M.fallingTendrilSkinniness,de=1-M.fallingTendrilSkinniness*.3,Te=de-(de-ue)*Z,be=ne*Te,Le=ne*1.4,Ne=Math.max(2,Math.ceil(H/Le)),je=[];for(let _e=0;_e<=Ne;_e++){const We=_e/Ne,ce=Math.sin(We*Math.PI),Be=ne-(ne-be)*ce;je.push({cx:b.pos.x+A*We,cy:b.pos.y+z*We,r:Math.max(2,Be)})}return i.jsx("g",{children:je.map((_e,We)=>i.jsx("circle",{cx:_e.cx,cy:_e.cy,r:_e.r,fill:U.color},We))},`falling-tendril-${V}`)}),D.map($=>pf($).map((U,le)=>{const b=af($);if(!b)return null;const _=U===0?void 0:`translate(${U}, 0)`,A=w==null?void 0:w.definition.isWild,z=A?Oe($.targetX):$.color;return i.jsx("path",{d:b,fill:z,fillOpacity:.8,transform:_,className:A?"wild-stroke wild-fill":void 0},`falling-${$.id}-${le}`)}))]})})(),!ct&&y&&y.droplets.length>0&&i.jsx("g",{children:y.droplets.map(D=>i.jsx("circle",{cx:D.pos.x,cy:D.pos.y,r:D.radius,fill:D.color,opacity:D.opacity},D.id))}),R&&!ct&&y&&y.blobs.length>0&&i.jsx("g",{children:y.blobs.map(D=>i.jsxs("g",{children:[i.jsx("circle",{cx:D.targetX,cy:D.targetY,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),D.vertices.map((F,M)=>{const $=D.vertices[(M+1)%D.vertices.length];return i.jsx("line",{x1:F.pos.x,y1:F.pos.y,x2:$.pos.x,y2:$.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${D.id}-${M}`)}),D.vertices.map((F,M)=>i.jsxs("g",{children:[i.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:F.pos.x+6,y:F.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:M})]},`v-${D.id}-${M}`)),D.innerVertices.map((F,M)=>i.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:3,fill:"gray",stroke:"white",strokeWidth:1},`iv-${D.id}-${M}`)),i.jsx("text",{x:D.targetX,y:D.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:D.isLocked?`${Math.round(D.fillAmount*100)}%`:"falling"})]},`debug-${D.id}`))}),w&&w.state===Ln.FALLING&&(()=>{const D=rp(k,w),F=w.definition.isWild;return w.cells.map((M,$)=>{var _;const V=((_=w.definition.cellColors)==null?void 0:_[$])??w.definition.color,U=Ue(w.x+M.x),le=D+M.y;if(le<Qe)return null;let b=U-C;if(b>Se/2&&(b-=Se),b<-Se/2&&(b+=Se),b>=-2&&b<at+2){const A=lt(b),z=lt(b+1)-A,H=(le-Qe)*De,Z={t:w.cells.some(ne=>ne.x===M.x&&ne.y===M.y-1),r:w.cells.some(ne=>ne.x===M.x+1&&ne.y===M.y),b:w.cells.some(ne=>ne.x===M.x&&ne.y===M.y+1),l:w.cells.some(ne=>ne.x===M.x-1&&ne.y===M.y)};return i.jsxs("g",{children:[i.jsx("rect",{x:A,y:H,width:z,height:De,fill:F?Oe(A):V,fillOpacity:.2,rx:4,ry:4}),i.jsx("path",{d:Ir(A,H,z,De,Z),fill:"none",stroke:F?Oe(A):V,strokeWidth:"1",strokeDasharray:"4 2",opacity:"0.75",className:F?"wild-stroke":void 0})]},`ghost-${$}`)}return null})})(),ee&&ee.map(D=>{let F=D.x-C;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F<-1||F>at)return null;const M=lt(F),$=lt(F+1)-M,V=(D.y-Qe)*De;return V<-De?null:i.jsxs("g",{children:[i.jsx("rect",{x:M,y:V,width:$,height:De,fill:D.color,fillOpacity:.3,rx:4,ry:4}),i.jsx("rect",{x:M,y:V,width:$,height:De,fill:"none",stroke:D.color,strokeWidth:"2",strokeDasharray:"4 2",rx:4,ry:4})]},`dump-${D.id}`)}),ct&&w&&w.state===Ln.FALLING&&(()=>{const D=w.definition.isWild,F=w.cells.map((M,$)=>{var _;const V=((_=w.definition.cellColors)==null?void 0:_[$])??w.definition.color,U=Ue(w.x+M.x),le=w.y+M.y;let b=U-C;if(b>Se/2&&(b-=Se),b<-Se/2&&(b+=Se),b>=-2&&b<at+2){const A=lt(b),z=lt(b+1)-A,H=(le-Qe)*De,Z={t:w.cells.some(ne=>ne.x===M.x&&ne.y===M.y-1),r:w.cells.some(ne=>ne.x===M.x+1&&ne.y===M.y),b:w.cells.some(ne=>ne.x===M.x&&ne.y===M.y+1),l:w.cells.some(ne=>ne.x===M.x-1&&ne.y===M.y)};return{screenX:A,screenY:H,width:z,neighbors:Z,color:V}}return null}).filter(Boolean);return F.length===0?null:i.jsxs("g",{children:[i.jsx("g",{opacity:.8,children:F.map((M,$)=>i.jsx("rect",{x:M.screenX,y:M.screenY,width:M.width,height:De,fill:D?Oe(M.screenX):M.color,rx:4,ry:4},$))}),F.map((M,$)=>i.jsx("path",{d:Ir(M.screenX,M.screenY,M.width,De,M.neighbors),fill:"none",stroke:"white",strokeWidth:"2",className:D?"wild-stroke":void 0},`outline-${$}`))]})})(),L.map(D=>{let F=D.x-C;if(F>Se/2&&(F-=Se),F<-Se/2&&(F+=Se),F>=-2&&F<at+2){const M=lt(F),$=lt(F+1)-M,V=(D.y-Qe)*De;return i.jsx("text",{x:M+$/2,y:V+De/2,fill:D.color,textAnchor:"middle",className:"floating-score",fontSize:"24",children:D.text},D.id)}return null}),e.phase===Ze.TankScreen&&i.jsxs(i.Fragment,{children:[t>=1&&i.jsxs("g",{children:[l&&l[Ae.LASER]>Date.now()&&i.jsxs("text",{x:Y+8+6,y:q*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[Ae.LASER]-Date.now())/1e3),"s"]}),i.jsx(lf,{value:r,colorMode:"drain",x:Y+8,y:q*.04,height:q*.2,width:12})]}),t>=3&&i.jsxs("g",{children:[l&&l[Ae.CONTROLS]>Date.now()&&i.jsxs("text",{x:Y+te-20+6,y:q*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[Ae.CONTROLS]-Date.now())/1e3),"s"]}),i.jsx(lf,{value:o,colorMode:"heat",x:Y+te-20,y:q*.04,height:q*.2,width:12})]}),c.length>0&&c.map((D,F)=>{const M=En[D];if(!M)return null;const $=a[D]||0,V=$>=100,U=36,le=Y+te-26,b=q*.3+F*(U+8);return i.jsx(Ey,{upgradeId:D,name:M.name,charge:$,isReady:V,x:le,y:b,size:U,onClick:()=>V&&(u==null?void 0:u(D))},D)})]})]}),ve.position&&ve.progress>0&&i.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:ve.position.x,top:ve.position.y,transform:"translate(-50%, -50%)"},children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${ve.progress/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),se>=0&&i.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:"50%",bottom:"15%",transform:"translate(-50%, 0)"},children:i.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),i.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${se/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),e.complications.length>0&&i.jsx("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none",style:{gap:"1.5rem"},children:[...e.complications].sort((D,F)=>D.startTime-F.startTime).map(D=>{const M={[Ae.LIGHTS]:"Lights",[Ae.CONTROLS]:"Controls",[Ae.LASER]:"Laser"}[D.type]||D.type;return i.jsxs("div",{className:"malfunction-pulse text-center",style:{textShadow:"0 0 20px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.5)"},children:[i.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:M}),i.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:"Malfunction"}),i.jsx("div",{className:"text-red-400 mt-2",style:{fontFamily:"'Amazon Ember', sans-serif",fontSize:"clamp(0.875rem, 3vw, 1.25rem)"},children:"Fix at Console"})]},D.id)})}),N.map(D=>{const F=$e-D.spawnTime,M=Math.min(1,F/500),$=1-(1-M)*(1-M),U=50+(I.indexOf(D.color)-(I.length-1)/2)*8,le=6,b=E(D.x,D.y),_=U+(b.x-U)*$,A=le+(b.y-le)*$;return i.jsx("div",{className:"absolute w-4 h-4 rounded-full shadow-lg border border-white/50 z-30",style:{backgroundColor:D.color,left:`${_}%`,top:`${A}%`,transform:"translate(-50%, -50%)",boxShadow:ct?`0 0 4px ${D.color}`:`0 0 10px ${D.color}`}},`fly-${D.id}`)}),e.phase===Ze.TankScreen&&(G||Ce)&&i.jsxs("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:10,display:"flex",gap:"8px"},children:[i.jsx(cf,{piece:d??null,label:"STORED",visible:G,rank:t}),i.jsx(cf,{piece:p??null,label:"NEXT",visible:Ce,rank:t})]})]})};var zy={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Gy=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Yy=(e,t)=>{const n=v.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:l,children:c,...a},u)=>v.createElement("svg",{ref:u,...zy,width:r,height:r,stroke:s,strokeWidth:l?Number(o)*24/Number(r):o,className:`lucide lucide-${Gy(e)}`,...a},[...t.map(([f,d])=>v.createElement(f,d)),...(Array.isArray(c)?c:[c])||[]]));return n.displayName=`${e}`,n};var Ft=Yy;const Hy=Ft("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Wy=Ft("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Ji=Ft("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Uy=Ft("Combine",[["rect",{width:"8",height:"8",x:"2",y:"2",rx:"2",key:"z1hh3n"}],["path",{d:"M14 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"83orz6"}],["path",{d:"M20 2c1.1 0 2 .9 2 2v4c0 1.1-.9 2-2 2",key:"k86dmt"}],["path",{d:"M10 18H5c-1.7 0-3-1.3-3-3v-1",key:"6vokjl"}],["polyline",{points:"7 21 10 18 7 15",key:"1k02g0"}],["rect",{width:"8",height:"8",x:"14",y:"14",rx:"2",key:"1fa9i4"}]]),Xy=Ft("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Vy=Ft("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),qy=Ft("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Zy=Ft("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),Ky=Ft("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Qy=Ft("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Jy=Ft("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),eg=Ft("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["line",{x1:"12",x2:"12.01",y1:"6",y2:"6",key:"16cbga"}]]),tg=Ft("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),ng=Ft("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),sg=Ft("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),og=({state:e,maxTime:t})=>{const{shiftScore:n,gameOver:s,popStreak:r,shiftTime:o}=e,l=Math.max(0,Math.min(1,1-o/t)),c=l>.8,a=l>.9;return i.jsxs(i.Fragment,{children:[a&&!s&&i.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_40%,rgba(100,0,0,0.4)_100%)] animate-pulse"}),i.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 px-1 pt-4 pointer-events-none z-50 flex justify-between items-start",style:{width:"min(100%, 100dvh * 0.75)"},children:[i.jsxs("div",{className:"flex flex-col items-start drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[i.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest mb-0.5 text-slate-400/90",children:"Pressure"}),i.jsxs("div",{className:`flex items-baseline gap-1 ${c?"text-red-500 animate-pulse":"text-slate-200"}`,children:[i.jsx(Hy,{className:"w-5 h-5 opacity-90"}),i.jsxs("span",{className:"text-4xl font-mono font-black leading-none tracking-tighter",children:[(l*100).toFixed(0),"%"]})]})]}),i.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-16 flex flex-col items-center",children:r>1&&i.jsxs("div",{className:"text-2xl text-yellow-400 animate-bounce font-black tracking-wider whitespace-nowrap drop-shadow-[0_4px_4px_rgba(0,0,0,0.9)] stroke-black",children:["x",r," SURGE"]})}),i.jsxs("div",{className:"flex flex-col items-end drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[i.jsx("span",{className:"text-[10px] text-green-500/90 uppercase font-bold tracking-widest mb-0.5",children:"Shift Score"}),i.jsx("span",{className:"text-4xl font-mono text-green-400 font-black leading-none tracking-tighter shadow-green-500/10",children:n.toLocaleString()})]})]}),i.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center text-slate-500 text-xs pointer-events-none hidden md:block opacity-30 z-50 font-mono",children:"ARROWS / WASD to Rotate Cylinder  SPACE to Drop  CLICK Masses to Purge"})]})},cs=50,sn=e=>e<=0?0:e*(3375+125*e),rg=e=>{if(e<=0)return 0;if(e>=cs)return sn(cs);const t=sn(e),n=sn(e+1);return Math.floor(t+(n-t)*.5)},ig=()=>{const e=[];for(let t=10;t<=cs;t+=10)e.push(t);return e},lg=(e,t)=>{if(t<=e)return[];const n=[],s=ig();for(const r of s)r>e&&r<=t&&n.push(r);return n},dt=e=>{if(e<sn(1))return{rank:0,progress:Math.max(0,e),toNextRank:3500,careerScore:Math.max(0,e),isMaxRank:!1};let t=1;for(;t<cs&&e>=sn(t+1);)t++;const n=sn(t),s=sn(t+1),r=e-n,o=s-n;return{rank:t,progress:r,toNextRank:o,careerScore:e,isMaxRank:t>=cs}},ap=(e,t,n)=>{const s=dt(e).rank,r=s+2,o=e+t,l=dt(o),c=l.rank-s;let a,u;return n?c===0?(a=s+1,u=sn(a)+100):c===1?(a=s+2,u=sn(a)+100):(a=r,u=sn(a)+100):c<=2?(u=o,a=l.rank):(a=r,u=sn(a)+100),a>cs&&(a=cs,u=sn(cs)),{newCareerScore:u,ranksGained:a-s}},ds={[Ae.LASER]:{unlockRank:4,capacitorMax:100,drainPerUnit:4,drainUpgradeEffect:En.CAPACITOR_EFFICIENCY.effectPerLevel},[Ae.LIGHTS]:{unlockRank:2,graceBaseSec:5,gracePerLevel:.75,dimDurationSec:5,recoverRate:400,overflarePeak:110,overflareUpMs:50,overflareDownMs:100,dimThreshold:10,failedBrightness:5,snapToFailMs:100,flickerDipBrightness:70,flickerDipMs:80,flickerRecoverMs:120},[Ae.CONTROLS]:{unlockRank:6,heatMax:100,heatPerRotation:5,dissipationBase:50,dissipationUpgradeEffect:En.GEAR_LUBRICATION.effectPerLevel,idleThresholdMs:200}},hf={minSeconds:8,maxSeconds:20};function cg(e,t){const n=ds[e].unlockRank;return Math.max(hf.minSeconds,hf.maxSeconds-(t-n))*1e3}function po(e,t){return t>=ds[e].unlockRank}class ag{constructor(){ze(this,"ctx",null);ze(this,"masterGain",null);ze(this,"musicGain",null);ze(this,"sfxGain",null);ze(this,"droneOsc",null);ze(this,"droneLfo",null);ze(this,"settings",{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1});ze(this,"isInitialized",!1)}init(t){if(this.isInitialized){this.updateSettings(t);return}this.settings=t;try{const n=window.AudioContext||window.webkitAudioContext;this.ctx=new n,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.updateVolumes(),this.isInitialized=!0}catch(n){console.error("Audio init failed",n)}}updateSettings(t){this.settings=t,this.updateVolumes()}updateVolumes(){if(!this.masterGain||!this.musicGain||!this.sfxGain||!this.ctx)return;const t=this.ctx.currentTime,n=this.settings.masterVolume/100*.5,s=this.settings.musicVolume/100,r=this.settings.sfxVolume/100;this.masterGain.gain.setTargetAtTime(n,t,.1),this.musicGain.gain.setTargetAtTime(s,t,.1),this.sfxGain.gain.setTargetAtTime(r,t,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}startMusic(){this.stopMusic()}stopMusic(){if(this.droneOsc){try{this.droneOsc.stop()}catch{}this.droneOsc=null}if(this.droneLfo){try{this.droneLfo.stop()}catch{}this.droneLfo=null}}setPressure(t){}playPop(t){if(!this.ctx||!this.sfxGain)return;const n=this.ctx.currentTime,s=this.ctx.createOscillator(),r=this.ctx.createGain();s.connect(r),r.connect(this.sfxGain);const o=400+t*50;s.frequency.setValueAtTime(o,n),s.frequency.exponentialRampToValueAtTime(o*2,n+.1),r.gain.setValueAtTime(.5,n),r.gain.exponentialRampToValueAtTime(.01,n+.15),s.start(n),s.stop(n+.15)}playReject(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(150,t),n.frequency.linearRampToValueAtTime(100,t+.15),s.gain.setValueAtTime(.3,t),s.gain.linearRampToValueAtTime(0,t+.15),n.start(t),n.stop(t+.15)}playMove(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="triangle";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(800,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),n.start(t),n.stop(t+.05)}playRotate(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="square";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(600,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),n.start(t),n.stop(t+.08)}playDrop(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sine",n.frequency.setValueAtTime(350,t),n.frequency.exponentialRampToValueAtTime(60,t+.15);const s=this.ctx.createGain();s.gain.setValueAtTime(.4,t),s.gain.exponentialRampToValueAtTime(.01,t+.15),n.connect(s),s.connect(this.sfxGain),n.start(t),n.stop(t+.15);const r=this.ctx.sampleRate*.2,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),l=o.getChannelData(0);for(let f=0;f<r;f++)l[f]=Math.random()*2-1;const c=this.ctx.createBufferSource();c.buffer=o;const a=this.ctx.createBiquadFilter();a.type="lowpass",a.Q.value=8,a.frequency.setValueAtTime(800,t),a.frequency.exponentialRampToValueAtTime(200,t+.15);const u=this.ctx.createGain();u.gain.setValueAtTime(.3,t),u.gain.exponentialRampToValueAtTime(.01,t+.15),c.connect(a),a.connect(u),u.connect(this.sfxGain),c.start(t)}playGameOver(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(400,t),n.frequency.linearRampToValueAtTime(50,t+1.5),s.gain.setValueAtTime(.5,t),s.gain.linearRampToValueAtTime(0,t+1.5),n.start(t),n.stop(t+1.5)}}const vt=new ag,ug=1e3;class fg{checkComplications(t,n,s){const r=Date.now();if(r-s<ug)return{spawned:null,newLastCheckTime:s};const o=f=>t.complications.some(d=>d.type===f),l=f=>r<t.complicationCooldowns[f],c=dt(n).rank,a=ds[Ae.CONTROLS];let u=null;return!o(Ae.LASER)&&!l(Ae.LASER)&&po(Ae.LASER,c)&&t.laserCharge<=0?u=Ae.LASER:!o(Ae.CONTROLS)&&!l(Ae.CONTROLS)&&po(Ae.CONTROLS,c)&&t.controlsHeat>=a.heatMax&&(u=Ae.CONTROLS),{spawned:u,newLastCheckTime:r}}spawnComplication(t,n){const r={id:Math.random().toString(36).substr(2,9),type:n,startTime:Date.now(),severity:1};return t.complications=[...t.complications,r],me.emit(xe.COMPLICATION_SPAWNED,{type:n}),r}resolveComplication(t,n,s,r){const o=t.complications.find(l=>l.id===n);if(o){switch(o.type){case Ae.LASER:t.laserCharge=ds[Ae.LASER].capacitorMax,t.prePoppedGoopGroups.clear();break;case Ae.CONTROLS:t.controlsHeat=0,t.rotationTimestamps=[];break;case Ae.LIGHTS:t.lightsBrightness=100,t.lightsGraceStart=Date.now(),t.lightsFlickered=!1;break}const l=dt(s+t.shiftScore).rank,c=cg(o.type,l);t.complicationCooldowns[o.type]=Date.now()+c}t.complications=t.complications.filter(l=>l.id!==n),t.activeComplicationId=null,me.emit(xe.COMPLICATION_RESOLVED),vt.playPop(5)}extendAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Ae)){const o=t.complicationCooldowns[r];if(o>s){const c=(o-s)*n;t.complicationCooldowns[r]=o+c}}}reduceAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Ae)){const o=t.complicationCooldowns[r];if(o>s){const c=(o-s)*n;t.complicationCooldowns[r]=Math.max(s,o-c)}}}}const Ds=new fg;class Lr{constructor(t){ze(this,"type","SPIN_TANK");this.dir=t}execute(t){if(t.state.gameOver||t.state.isPaused)return;const n=Ue(t.state.tankRotation+this.dir);let s=t.state.activeGoop;if(t.state.activeGoop){const a=Gc(t.state.activeGoop.screenX,n);s={...t.state.activeGoop,x:a};const u=Math.round(s.y),f={...s,y:u};if(fs(t.state.grid,f)){me.emit(xe.ACTION_REJECTED);return}fs(t.state.grid,s)&&(s=f)}t.state.tankRotation=n,s&&(t.state.activeGoop=s),t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++);const r=Date.now();t.state.rotationTimestamps.push(r),t.state.rotationTimestamps.length>ox&&t.state.rotationTimestamps.shift();const o=dt(t.initialTotalScore).rank,l=ds[Ae.CONTROLS],c=Date.now()<t.state.complicationCooldowns[Ae.CONTROLS];po(Ae.CONTROLS,o)&&!c&&(t.state.controlsHeat=Math.min(l.heatMax,t.state.controlsHeat+l.heatPerRotation)),me.emit(xe.PIECE_MOVED),t.emitChange()}}class Ro{constructor(t){ze(this,"type","ROTATE_GOOP");this.clockwise=t}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=(n.rotation+(this.clockwise?1:-1)+4)%4;if(n.definition.type===Re.O||n.definition.type===Re.T_O){const c=n.definition.cellColors,a=c&&c.length===4?this.clockwise?[c[2],c[0],c[3],c[1]]:[c[1],c[3],c[0],c[2]]:c;me.emit(xe.PIECE_ROTATED),t.state.activeGoop={...n,rotation:s,definition:{...n.definition,cellColors:a}},t.emitChange();return}const r=uy(n.cells,this.clockwise,n.rotationCenter),o={...n,cells:r,rotation:s},l=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:0,y:-2},{x:1,y:-2},{x:-1,y:-2},{x:2,y:0},{x:-2,y:0}];for(const c of l){const a=Ue(o.x+c.x),u=ay(a,t.state.tankRotation),f={...o,x:a,y:o.y+c.y,screenX:u};if(!fs(t.state.grid,f,t.state.tankRotation)){me.emit(xe.PIECE_ROTATED),t.state.activeGoop=f,t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++),t.emitChange();return}}}}class Tl{constructor(t){ze(this,"type","SET_FAST_DROP");this.active=t}execute(t){t.isFastDropping=this.active}}class dg{constructor(){ze(this,"type","SWAP_PIECE")}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=n.definition,r=t.state.storedGoop;if(r){const o=Math.round(r.cells.reduce((a,u)=>a+u.x,0)/r.cells.length),l=Math.round(r.cells.reduce((a,u)=>a+u.y,0)/r.cells.length),c={definition:r,cells:[...r.cells],rotation:0,rotationCenter:{x:o,y:l},spawnTimestamp:Date.now(),startSpawnY:n.y,screenX:n.screenX,x:n.x,y:n.y,state:Ln.FALLING};if(fs(t.state.grid,c,t.state.tankRotation)){me.emit(xe.ACTION_REJECTED);return}me.emit(xe.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.state.activeGoop=c}else me.emit(xe.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.spawnNewPiece();t.emitChange()}}class pg{constructor(t,n){ze(this,"type","POP_GOOP");this.x=t,this.y=n}execute(t){if(t.state.gameOver||t.state.isPaused)return;const n=t.state.grid[this.y][this.x];if(!n)return;const s=Math.max(0,1-t.state.shiftTime/t.maxTime),r=Ye-1-s*(ln-1);if(n.groupMinY<r){me.emit(xe.ACTION_REJECTED);return}const o=Date.now(),l=n.groupSize*fo;if(o-(n.timestamp||0)<l){me.emit(xe.ACTION_REJECTED);return}const a=dy(t.state.grid,this.x,this.y);if(a.length>0){if(t.state.complications.find(I=>I.type===Ae.LASER)){const I=n.goopGroupId;if(!t.state.prePoppedGoopGroups.has(I)){t.state.prePoppedGoopGroups.add(I);const J=Date.now();a.forEach(ae=>{const W=t.state.grid[ae.y][ae.x];W&&(W.timestamp=J)}),me.emit(xe.ACTION_REJECTED),t.emitChange();return}t.state.prePoppedGoopGroups.delete(I)}me.emit(xe.GOOP_POPPED,{popStreak:t.state.popStreak,count:a.length}),t.state.cellsCleared++,t.state.totalUnitsPopped+=a.length;const f=dt(t.initialTotalScore).rank,d=ds[Ae.LASER];if(po(Ae.LASER,f)){const I=t.powerUps.CAPACITOR_EFFICIENCY||0,J=1-d.drainUpgradeEffect*I,ae=a.length*d.drainPerUnit*J;t.state.laserCharge=Math.max(0,t.state.laserCharge-ae)}const p=a.length;t.state.gameStats.maxGroupSize=Math.max(t.state.gameStats.maxGroupSize,p);const y=rx,S=p*ix;let R=0;p>=nf&&(R=(Math.floor((p-nf)/lx)+1)*cx);let j=0;a.forEach(I=>{var J;(J=t.state.grid[I.y][I.x])!=null&&J.isSealingGoop&&j++});const g=j*3e3;if(j>0){t.state.goalsCleared+=j,me.emit(xe.GOAL_CAPTURED,{count:j}),t.chargeActiveAbilities(j*25);const I=t.powerUps.SEALING_BONUS||0;if(I>0){const W=.1+I*.05;for(let Q=0;Q<j;Q++)Ds.reduceAllCooldowns(t.state,W)}}const h=y+S+R+g;t.state.shiftTime=Math.min(t.maxTime,t.state.shiftTime+h),t.state.gameStats.totalBonusTime+=h;let x=0,m=t.state.popStreak+1,P={base:0,height:0,offscreen:0,adjacency:0,speed:0};const k=vy(t.state.grid,a);x+=k,P.adjacency+=k,a.forEach(I=>{let J=10,ae=yy(I.y),W=gy(I.x,t.state.tankRotation);const Q=my(m),Y=(J+ae+W)*Q;x+=Y,P.base+=J*Q,P.height+=ae*Q,P.offscreen+=W*Q});const C=Math.floor(x);t.updateScoreAndStats(C,P),t.state.popStreak=m;const w=Math.random().toString(36).substr(2,9),T=[{id:w,text:`+${C}`,x:this.x,y:this.y,life:1,color:"#fbbf24"},{id:w+"_time",text:"Vented",x:this.x,y:this.y-1,life:1,color:"#4ade80"}];j>0&&T.push({id:w+"_bonus",text:"SEALED!",x:this.x,y:this.y-2,life:1.5,color:"#fff"}),t.state.floatingTexts.push(...T),setTimeout(()=>{t.state.floatingTexts=t.state.floatingTexts.filter(I=>!I.id.startsWith(w)),t.emitChange()},1e3);const L=n.goopGroupId;L&&t.state.poppedGoopGroupIds.add(L);let O=t.state.grid.map(I=>[...I]);const X=[];a.forEach(I=>{O[I.y][I.x]=null,X.push({x:I.x,y:I.y})});const{grid:K,looseGoop:ee}=ip(O,X);if(j>0&&t.state.goalsCleared>=t.state.goalsTarget){const I=Math.max(0,1-t.state.shiftTime/t.maxTime),J=dt(t.initialTotalScore+t.state.shiftScore).rank;if(I<.9){const ae=Sy(K,t.state.goalMarks,J,t.state.shiftTime,t.maxTime);t.state.goalMarks.push(...ae),me.emit(xe.GOAL_CAPTURED,{count:1})}else t.state.goalMarks=[]}t.state.grid=K,t.state.looseGoop.push(...ee),t.emitChange()}}}class hg{constructor(){ze(this,"type","START_RUN")}execute(t){t.startRun()}}class $s{constructor(t){ze(this,"type","SET_PHASE");this.phase=t}execute(t){this.phase===Ze.TankScreen?t.enterPeriscope():this.phase===Ze.ConsoleScreen?t.enterConsole():(t.state.phase=this.phase,t.emitChange())}}class xg{constructor(t){ze(this,"type","RESOLVE_COMPLICATION");this.id=t}execute(t){t.resolveComplication(this.id)}}class yg{constructor(t){ze(this,"type","ACTIVATE_ABILITY");this.upgradeId=t}execute(t){t.state.gameOver||t.state.isPaused||(t.state.activeCharges[this.upgradeId]||0)<100||(t.state.activeCharges[this.upgradeId]=0,t.activateAbility(this.upgradeId),me.emit(xe.ABILITY_ACTIVATED,{upgradeId:this.upgradeId}),t.emitChange())}}const gg=(e,t,n,s,r,o,l)=>{if(!e)return"FAILURE";const c=n>0?Math.min(100,t/n*100):100,a=Math.max(0,100-s*2),u=Math.max(0,100-s*3),f=o>0?Math.min(100,r/o*100):50,d=Math.min(100,l/100),p=(c+a+u+f+d)/5;return p>=80?"A":p>=60?"B":p>=40?"C":"FAILURE"},mg=({shiftScore:e,rank:t,xpCurrent:n,xpNext:s,cracksFilled:r,cracksTarget:o,pressureVented:l,maxTime:c,massPurged:a,leftoverPenalty:u,unspentPower:f,isWin:d})=>{const y=Math.min(1,Math.max(0,n/s))*366.31,S=gg(d,r,o,u,l,c,e),R=S==="A"?"#5bbc70":S==="B"?"#6acbda":S==="C"?"#ffd92b":"#d82727",j=c>0?Math.round(l/c*100):0;return i.jsxs("g",{id:"End_Game_Monitor_Group",children:[i.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),i.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'From Where You Are'",fontSize:"42",transform:"translate(291.5 122.96)",textAnchor:"middle",children:"SHIFT OVER"}),i.jsxs("text",{fill:R,fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"24",letterSpacing:"0.1em",transform:"translate(291.5 155)",textAnchor:"middle",children:["GRADE: ",S]}),i.jsx("path",{fill:"#5bbc70",d:"M525.21,243.36H58.95c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM58.95,223.59c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H58.95Z"}),i.jsx("path",{fill:"#5bbc70",d:`M57.75,223.09h${y}v19.77H57.75c-4.79,0-8.68-3.89-8.68-8.68v-2.4c0-4.79,3.89-8.68,8.68-8.68Z`}),i.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(530 237)",children:[Math.floor(n).toLocaleString()," / ",Math.floor(s).toLocaleString()]}),i.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(530 213)",children:"PROMOTION THRESHOLD"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(49.87 209.32)",children:i.jsx("tspan",{x:"0",y:"0",children:"OPERATOR RANK"})}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(230 210.8)",textAnchor:"start",children:t}),i.jsx("path",{fill:"#fff",d:"M268.4,808.13v-1.02l.33-1.02c6.23-8.15,13.08-15.87,19.51-23.87,1.65-2.11,4.36-2.41,6.29-.46l20.02,23c.62.7,1,1.44,1.2,2.36-.03.33.04.7,0,1.02-.21,1.7-1.77,3.25-3.47,3.42h-40.15c-1.85-.05-3.51-1.61-3.74-3.42ZM271.73,793.93c1.56-1.89,3.12-3.76,4.65-5.6,2.57-3.07,5.23-6.25,7.76-9.4,1.83-2.35,4.56-3.73,7.45-3.73,2.47,0,4.83,1.01,6.66,2.85l.12.12,13.75,15.8h.16c1.7-.17,3.26-1.72,3.47-3.42.04-.32-.03-.69,0-1.02-.2-.92-.58-1.66-1.21-2.36l-20.02-23c-1.94-1.95-4.65-1.65-6.29.46-6.44,8.01-13.29,15.72-19.51,23.87l-.33,1.02v1.02c.21,1.67,1.66,3.12,3.33,3.37Z"}),i.jsx("text",{fill:"#d82727",fontFamily:"'From Where You Are'",fontSize:"24",transform:"translate(291.5 860.65)",textAnchor:"middle",children:"DRAG UP TO END SHIFT"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(165.69 321.1)",textAnchor:"middle",children:"SHIFT SCORE"}),i.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(165.69 390.05)",textAnchor:"middle",children:e.toLocaleString()}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M261.87,585.41H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 503.38)",textAnchor:"middle",children:"CRACKS FILLED"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 557.36)",textAnchor:"middle",children:[r," / ",o]})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M514.25,585.41h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 503.38)",textAnchor:"middle",children:"PRESSURE VENTED"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 557.36)",textAnchor:"middle",children:[j,"%"]})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M261.87,731.68H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 649.64)",textAnchor:"middle",children:"MAX POP"}),i.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 703.63)",textAnchor:"middle",children:a})]}),i.jsxs("g",{children:[i.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),i.jsx("path",{fill:"#fff",d:"M514.25,731.68h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 649.64)",textAnchor:"middle",children:"RESIDUAL GOOP"}),i.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 703.63)",textAnchor:"middle",children:["-",u]})]}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(418.08 321.1)",textAnchor:"middle",children:"SCRAPS"}),i.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(418.08 390.05)",textAnchor:"middle",children:f})]})},vg="#14b8a6",Sg="#ffffff",Cg="#22c55e",Nr="#231f20",Or="#d8672b";function kg({complications:e,isLaserMaxed:t,onResolveComplication:n}){const[s,r]=v.useState({active:!1,solved:!1,targets:[0,0,0,0]}),[o,l]=v.useState([0,0,0,0]),[c,a]=v.useState(null),[u,f]=v.useState(!1),d=v.useRef([]),p=v.useRef(null),y=v.useRef(null),S=v.useCallback(()=>e.some(h=>h.type===Ae.LASER),[e]);v.useEffect(()=>{const h=d.current.some(m=>m.type===Ae.LASER),x=S();h&&!x&&(f(!0),y.current=setTimeout(()=>{f(!1)},2500)),d.current=e},[e,S]),v.useEffect(()=>{if(!S()&&(s.active||s.solved)&&(r({active:!1,solved:!1,targets:[0,0,0,0]}),l([0,0,0,0])),S()&&!s.active&&!s.solved){const h=t?[-1,1]:[-1,0,1],x=[0,1,2,3].map(()=>h[Math.floor(Math.random()*h.length)]),m=x.map(P=>{const k=h.filter(C=>C!==P);return k[Math.floor(Math.random()*k.length)]});l(m),r({active:!0,solved:!1,targets:x})}},[e,s.active,s.solved,t,S]),v.useEffect(()=>()=>{p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]);const R=v.useCallback((h,x)=>{l(P=>{const k=[...P];return k[h]=x,e.find(w=>w.type===Ae.LASER),k});const m=e.find(P=>P.type===Ae.LASER);if(m&&!s.solved){const P=s.targets[h];if(x!==P)a(h),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>a(null),300);else{const k=[...o];k[h]=x,k.every((w,T)=>w===s.targets[T])&&(r(w=>({...w,solved:!0})),l([0,0,0,0]),n&&n(m.id))}}},[e,s.solved,s.targets,o,n]),j=v.useCallback(h=>{if(!S())return{left:Nr,right:Nr};const x=s.targets[h];return x===-1?{left:Or,right:Nr}:x===1?{left:Nr,right:Or}:{left:Or,right:Or}},[S,s.targets]),g=v.useCallback(()=>S()?{text:"REPAIR LASER",color:Sg}:u?{text:"LASER FIXED",color:Cg}:{text:"REPAIR LASER",color:vg},[S,u]);return{laserSliders:o,updateLaserSlider:R,shakingSlider:c,getLaserLightColors:j,getLaserTextState:g,recentlyFixed:u,isComplicationActive:S()}}const xf={0:"#96d7dd",1:"#f6f081",2:"#cb8abc"},wg=[45,315,225,135],yf=[45,135,225,315],jg="#14b8a6",Pg="#ffffff",Rg="#22c55e",Ut="#231f20",Dr="#d8672b";function bg({complications:e,isLightsMaxed:t,pressedBtn:n,onResolveComplication:s}){const[r,o]=v.useState({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),[l,c]=v.useState(0),[a,u]=v.useState(!1),[f,d]=v.useState(!1),p=v.useRef([]),y=v.useRef(null),S=v.useRef(null),R=v.useRef([]),j=v.useCallback(()=>e.some(w=>w.type===Ae.LIGHTS),[e]),g=v.useCallback(()=>{const w=[],T=[0,0,0],L=t?3:4;for(let O=0;O<L;O++){const X=[];T[0]<2&&X.push(0),T[1]<2&&X.push(1),T[2]<2&&X.push(2);const K=X[Math.floor(Math.random()*X.length)];w.push(K),T[K]++}return w},[t]),h=v.useCallback(w=>{R.current.forEach(ee=>clearTimeout(ee)),R.current=[];let X=300;w.forEach(ee=>{const I=setTimeout(()=>{o(ae=>({...ae,showingIndex:ee}))},X);R.current.push(I);const J=setTimeout(()=>{o(ae=>({...ae,showingIndex:-1}))},X+200);R.current.push(J),X+=200+100});const K=setTimeout(()=>{o(ee=>({...ee,phase:"input",showingIndex:-1,inputIndex:0}))},X+100);R.current.push(K)},[]);v.useEffect(()=>{const w=p.current.some(L=>L.type===Ae.LIGHTS),T=j();w&&!T&&(d(!0),S.current=setTimeout(()=>{d(!1)},2500)),p.current=e},[e,j]),v.useEffect(()=>{if(!j()&&r.phase!=="inactive"&&(o({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),c(0)),j()&&r.phase==="inactive"){const w=g();o({phase:"slider1",slider1Target:Math.random()>.5?1:-1,sequence:w,inputIndex:0,showingIndex:-1}),c(0)}},[e,r.phase,j,g]),v.useEffect(()=>()=>{y.current&&clearTimeout(y.current),S.current&&clearTimeout(S.current),R.current.forEach(w=>clearTimeout(w))},[]);const x=v.useCallback(w=>{if(r.phase!=="input")return;const T=r.sequence[r.inputIndex];if(w===T){const L=r.inputIndex+1;L>=r.sequence.length?o(O=>({...O,phase:"slider2",inputIndex:0})):o(O=>({...O,inputIndex:L}))}else{o(O=>({...O,phase:"showing",inputIndex:0,showingIndex:-1}));const L=setTimeout(()=>{h(r.sequence)},300);R.current.push(L)}},[r.phase,r.sequence,r.inputIndex,h]),m=v.useCallback(w=>{const{phase:T,slider1Target:L,sequence:O}=r;if(T==="slider1")w===L?(c(w),o(X=>({...X,phase:"showing"})),h(O)):w!==0?(u(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),c(0)},400)):c(w);else if(T==="slider2"){const X=L===1?-1:1;if(c(w),w===X){o(ee=>({...ee,phase:"solved"})),c(0);const K=e.find(ee=>ee.type===Ae.LIGHTS);K&&s&&s(K.id)}}else c(w)},[e,r,s,h]),P=v.useCallback(w=>!j()||r.phase==="inactive"?Ut:r.phase==="showing"&&r.showingIndex===w||r.phase==="input"&&n===["blue","green","purple"][w]?xf[w]:Ut,[j,r.phase,r.showingIndex,n]),k=v.useCallback(()=>{const{phase:w,slider1Target:T}=r;return j()?w==="inactive"?{top:Ut,bottom:Ut}:w==="slider1"?T===1?{top:Ut,bottom:Dr}:{top:Dr,bottom:Ut}:w==="slider2"?T===1?{top:Dr,bottom:Ut}:{top:Ut,bottom:Dr}:{top:Ut,bottom:Ut}:{top:Ut,bottom:Ut}},[j,r]),C=v.useCallback(()=>j()?{text:"REPAIR LIGHTS",color:Pg}:f?{text:"LIGHTS FIXED",color:Rg}:{text:"REPAIR LIGHTS",color:jg},[j,f]);return{lightsComplication:r,lightSlider:l,handleLightsButton:x,handleLightsSliderChange:m,lightsSliderShaking:a,getLightsButtonLightColor:P,getLightsSliderLightColors:k,getLightsTextState:C,recentlyFixed:f,isComplicationActive:j()}}const Mg="#14b8a6",Tg="#ffffff",Eg="#22c55e",El="#231f20",Ag="#d8672b",gf=194.32,mf=1586.66,_g=86.84,Ig=_g*1.3;function Lg({complications:e,isControlsMaxed:t,onResolveComplication:n}){const[s,r]=v.useState({active:!1,solved:!1,targetCorner:null,completedCorners:0}),[o,l]=v.useState(0),[c,a]=v.useState(!1),[u,f]=v.useState(!1),[d,p]=v.useState(!1),[y,S]=v.useState(!1),R=v.useRef([]),j=v.useRef(null),g=v.useRef(null),h=v.useRef(null),x=v.useRef(null),m=v.useRef(!1),P=v.useRef(0),k=v.useRef(0),C=v.useRef(0),w=v.useRef(!1),T=v.useRef(!1),L=v.useCallback(()=>e.some(Y=>Y.type===Ae.CONTROLS),[e]),O=v.useCallback((Y,re)=>{try{const te=document.getElementById("coord-reference");if(!te)return null;const q=te.ownerSVGElement;if(!q)return null;const pe=q.createSVGPoint();pe.x=Y,pe.y=re;const we=te.getScreenCTM();if(!we)return null;const E=pe.matrixTransform(we.inverse());return{x:E.x,y:E.y}}catch{return null}},[]);v.useEffect(()=>{const Y=R.current.some(te=>te.type===Ae.CONTROLS),re=L();Y&&!re&&(S(!0),g.current=setTimeout(()=>{S(!1)},2500)),R.current=e},[e,L]),v.useEffect(()=>{if(!L()&&(s.active||s.solved)&&r({active:!1,solved:!1,targetCorner:null,completedCorners:0}),L()&&!s.active&&!s.solved){const Y=Math.floor(Math.random()*4);r({active:!0,solved:!1,targetCorner:Y,completedCorners:0})}},[e,s.active,s.solved,L]),v.useEffect(()=>()=>{j.current&&clearTimeout(j.current),g.current&&clearTimeout(g.current),h.current&&clearTimeout(h.current),x.current&&clearTimeout(x.current)},[]);const X=v.useCallback((Y,re)=>{const te=O(Y,re);if(!te)return;const q=te.x-gf,pe=te.y-mf;Math.sqrt(q*q+pe*pe)>Ig||(P.current=Math.atan2(pe,q)*(180/Math.PI),k.current=o,m.current=!0,w.current=!1,a(!0))},[o,O]),K=v.useCallback((Y,re)=>{if(!m.current)return;const te=O(Y,re);if(!te)return;const q=te.x-gf,pe=te.y-mf,E=Math.atan2(pe,q)*(180/Math.PI)-P.current+k.current;C.current=E,w.current=!0,l(E)},[O]),ee=v.useCallback(()=>{if(!m.current||(m.current=!1,a(!1),w.current&&(T.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{T.current=!1},100)),!w.current))return;const Y=C.current;let re=Y%360;re<0&&(re+=360);let te=yf[0],q=1/0;for(const ve of yf){const ie=Math.min(Math.abs(re-ve),Math.abs(re-ve+360),Math.abs(re-ve-360));ie<q&&(q=ie,te=ve)}const pe=Math.floor(Y/360)*360,we=[pe+te-360,pe+te,pe+te+360];let E=we[0],B=Math.abs(Y-we[0]);for(const ve of we){const ie=Math.abs(Y-ve);ie<B&&(B=ie,E=ve)}C.current=E,l(E)},[]);v.useEffect(()=>{if(!c)return;const Y=pe=>{K(pe.clientX,pe.clientY)},re=()=>{ee()},te=pe=>{pe.touches.length>0&&K(pe.touches[0].clientX,pe.touches[0].clientY)},q=()=>{ee()};return window.addEventListener("mousemove",Y),window.addEventListener("mouseup",re),window.addEventListener("touchmove",te),window.addEventListener("touchend",q),()=>{window.removeEventListener("mousemove",Y),window.removeEventListener("mouseup",re),window.removeEventListener("touchmove",te),window.removeEventListener("touchend",q)}},[c,K,ee]);const I=v.useCallback(()=>{if(s.targetCorner===null)return!1;const Y=wg[s.targetCorner],re=(o%360+360)%360,te=Math.abs(re-Y);return Math.min(te,360-te)<15},[s.targetCorner,o]),J=v.useCallback(()=>{f(!0),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>f(!1),300)},[]),ae=v.useCallback(()=>{if(!(!L()||s.solved)&&!c&&!T.current)if(p(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>p(!1),150),I()){const Y=s.completedCorners+1;if(Y>=(t?3:4)){r(q=>({...q,solved:!0,targetCorner:null,completedCorners:4}));const te=e.find(q=>q.type===Ae.CONTROLS);te&&n&&n(te.id)}else{const te=[0,1,2,3].filter(pe=>pe!==s.targetCorner),q=te[Math.floor(Math.random()*te.length)];r(pe=>({...pe,targetCorner:q,completedCorners:Y}))}}else J()},[L,s.solved,s.completedCorners,s.targetCorner,c,I,t,e,n,J]),W=v.useCallback(Y=>!L()||s.solved?El:s.targetCorner===Y?Ag:El,[L,s.solved,s.targetCorner]),Q=v.useCallback(()=>L()?{text:"REPAIR CONTROLS",color:Tg}:y?{text:"CONTROLS FIXED",color:Eg}:{text:"REPAIR CONTROLS",color:Mg},[L,y]);return{localDialRotation:o,isDialDragging:c,dialShaking:u,dialPressed:d,handleDialStart:X,handleDialMove:K,handleDialEnd:ee,handleDialPress:ae,getControlsCornerLightColor:W,getControlsTextState:Q,recentlyFixed:y,isDialAligned:I,isComplicationActive:L()&&!s.solved}}const No=({x:e,y:t,rotation:n=0,length:s=176,width:r=50,handleSize:o=50,value:l=0,onChange:c,trackColor:a="#eebfc5",handleColor:u="#d36b28",arrowColor:f="#ffffff",className:d=""})=>{const[p,y]=v.useState(!1),[S,R]=v.useState(0),j=v.useRef(null),g=v.useRef(0),h=(s-o)/2,x={"-1":-h,0:0,1:h},m=p?S:x[`${l}`]||0,P=w=>{w.stopPropagation(),w.currentTarget.setPointerCapture(w.pointerId),j.current={x:w.clientX,y:w.clientY},g.current=m,R(m),y(!0)},k=w=>{if(!p||!j.current)return;w.stopPropagation();const T=w.clientX-j.current.x,L=w.clientY-j.current.y,O=n*Math.PI/180,X=T*Math.cos(O)+L*Math.sin(O),K=g.current+X,ee=Math.max(-h,Math.min(h,K));R(ee)},C=w=>{if(!p)return;w.stopPropagation(),w.currentTarget.releasePointerCapture(w.pointerId),y(!1);const T=Math.abs(S-x[-1]),L=Math.abs(S-x[0]),O=Math.abs(S-x[1]);let X=0;T<L&&T<O?X=-1:O<L&&O<T?X=1:X=0,c&&X!==l&&c(X)};return i.jsx("g",{transform:`translate(${e}, ${t}) rotate(${n})`,children:i.jsxs("g",{className:d,children:[i.jsx("rect",{x:-s/2,y:-r/2,width:s,height:r,rx:6.92,ry:6.92,fill:a}),i.jsx("g",{transform:`translate(${m}, 0)`,style:{transition:p?"none":"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:i.jsx("rect",{x:-o/2,y:-o/2,width:o,height:o,rx:3.69,ry:3.69,fill:u})}),i.jsx("rect",{x:-s/2-20,y:-r/2-20,width:s+40,height:r+40,fill:"transparent",style:{cursor:"grab",touchAction:"none"},onPointerDown:P,onPointerMove:k,onPointerUp:C,onPointerLeave:C})]})})},Ng=({laserSliders:e,shakingSlider:t,onSliderChange:n,getLaserLightColors:s,textState:r,isComplicationActive:o=!1})=>i.jsxs("g",{id:"Reset_Laser_Top",children:[i.jsxs("g",{pointerEvents:"none",children:[i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M157.91,233.16h-4.24l-18.69-18.69c-3.62-3.62-3.62-9.52,0-13.14l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0-8.89l20.81,20.81ZM111.51,212.35c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-1.75,1.75-2.72,4.09-2.72,6.57s.97,4.81,2.72,6.57l18.69,18.69h4.24l-20.81-20.81ZM107.64,182.65h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM235.4,214.47c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,233.16h4.24l18.69-18.69c1.75-1.75,2.72-4.09,2.72-6.57s-.97-4.81-2.72-6.57l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM260.08,214.47c.17-.17.33-.36.49-.54v-12.05c-.16-.19-.32-.37-.49-.54l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"}),i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M132.32,324.04h-4.24l-18.69-18.69c-1.75-1.75-2.72-4.09-2.72-6.57s.97-4.81,2.72-6.57l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0,8.89l20.81,20.81ZM137.1,303.23c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-3.62,3.62-3.62-9.52,0,13.14l18.69,18.69h4.24l-20.81-20.81ZM107.64,273.53h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM260.08,305.35c.18-.18.34-.36.49-.55v-12.04c-.16-.19-.32-.37-.49-.55l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,324.04h4.24l18.69-18.69c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c1.19,1.19,1.84,2.77,1.84,4.45s-.65,3.26-1.84,4.45l-20.81,20.81ZM235.4,305.35c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"})]}),i.jsx(No,{x:172.65,y:207.9,value:e[0],onChange:l=>n(0,l),className:t===0?"shake-anim":""}),i.jsx(No,{x:172.65,y:298.78,value:e[1],onChange:l=>n(1,l),className:t===1?"shake-anim":""}),i.jsx(No,{x:445.24,y:207.9,value:e[2],onChange:l=>n(2,l),className:t===2?"shake-anim":""}),i.jsx(No,{x:445.24,y:298.78,value:e[3],onChange:l=>n(3,l),className:t===3?"shake-anim":""}),i.jsxs("g",{children:[i.jsx("path",{fill:s(0).right,fillRule:"evenodd",d:"M280.92,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(0).left,fillRule:"evenodd",d:"M63.6,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(1).right,fillRule:"evenodd",d:"M280.92,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(1).left,fillRule:"evenodd",d:"M63.6,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(2).left,fillRule:"evenodd",d:"M336.96,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(2).right,fillRule:"evenodd",d:"M554.28,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:s(3).left,fillRule:"evenodd",d:"M336.96,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),i.jsx("path",{fill:s(3).right,fillRule:"evenodd",d:"M554.28,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),i.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsx("text",{fill:r.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(245.29 261.57)",children:r.text})]}),Al=({x:e,y:t,colorBody:n,colorTop:s,isPressed:r,onPress:o,onRelease:l})=>{const c="M42.31,73.62C18.58,73.62,0,59.79,0,42.13S18.58,10.65,42.31,10.65s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",a="M74.5,41.03c0,11.84-14.45,21.44-32.27,21.44S9.97,52.87,9.97,41.03c0-8.74.25-20.68.25-20.68h64.43s-.15,13.21-.15,20.68Z",f="M42.31,62.97C18.58,62.97,0,49.14,0,31.48S18.58,0,42.31,0s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",d="M74.5,30.38c0,11.84-14.45,21.44-32.27,21.44S9.97,42.22,9.97,30.38c0-8.74.25-8.47.25-8.47h64.43s-.15.99-.15,8.47Z";return i.jsx("g",{transform:`translate(${e}, ${t})`,style:{cursor:"pointer"},onMouseDown:S=>{S.stopPropagation(),o()},onMouseUp:S=>{S.stopPropagation(),l()},onMouseLeave:()=>{r&&l()},onTouchStart:S=>{S.stopPropagation(),o()},onTouchEnd:S=>{S.stopPropagation(),l()},children:r?i.jsxs("g",{transform:`translate(0, ${10.65})`,children:[i.jsx("path",{fill:"#0d1a19",d:f}),i.jsx("path",{fill:n,fillRule:"evenodd",d}),i.jsx("ellipse",{fill:s,cx:"42.31",cy:23.01,rx:"32.27",ry:"21.44"})]}):i.jsxs("g",{children:[i.jsx("path",{fill:"#0d1a19",d:c}),i.jsx("path",{fill:n,fillRule:"evenodd",d:a}),i.jsx("ellipse",{fill:s,cx:"42.31",cy:21.44,rx:"32.27",ry:"21.44"})]})})},Og=({lightsComplication:e,lightSlider:t,onSliderChange:n,onButtonPress:s,onButtonRelease:r,getLightsButtonLightColor:o,getLightsSliderLightColors:l,textState:c,pressedBtn:a,sliderShaking:u,onBlueClick:f,onGreenClick:d,onPurpleClick:p,isComplicationActive:y=!1,recentlyFixed:S=!1})=>{const R=l(),j=e.phase==="slider1"||e.phase==="showing";return i.jsxs("g",{id:"Reset_Lights",children:[i.jsx("polygon",{fill:"#45486c",points:"608.7 1720.12 341.17 1720.12 341.17 1452.22 564.14 1452.22 608.7 1720.12",className:y?"minigame-active-pulse":S?"minigame-solved-fade":""}),i.jsx("text",{fill:c.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(414.68 1480.38)",children:c.text}),i.jsx("g",{clipPath:"url(#reset-lights-slider-clip)",children:i.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M417.83,1530.35l-30.21-30.21c-3.04-3.04-7.97-3.04-11.02,0l-30.21,30.21M346.4,1555.03l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M346.4,1580.62l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M417.83,1643.18l-30.21,30.21c-3.04,3.04-7.97,3.04-11.02,0l-30.21-30.21M346.4,1618.5l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21M346.4,1592.91l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21"})}),i.jsx(No,{x:382.11,y:1587.01,rotation:90,value:t,onChange:n,className:u?"shake":""}),i.jsxs("g",{children:[i.jsx("path",{fill:R.bottom,d:"M382.12,1706.83c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M382.12,1685.25c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1682.25c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:R.top,d:"M382.12,1489.51c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M382.12,1467.94c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1464.94c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),i.jsx(Al,{x:431.19,y:1495,colorBody:"#3d8380",colorTop:"#96d7dd",isPressed:a==="blue"||j,onPress:()=>s("blue"),onRelease:()=>r("blue",f)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(0),d:"M546.19,1547c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M546.19,1525.42c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M546.19,1522.42c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsx(Al,{x:437.5,y:1565,colorBody:"#4c833c",colorTop:"#f6f081",isPressed:a==="green"||j,onPress:()=>s("green"),onRelease:()=>r("green",d)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(1),d:"M554.61,1616.4c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M554.61,1594.82c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M554.61,1591.82c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),i.jsx(Al,{x:444.51,y:1635,colorBody:"#803d83",colorTop:"#cb8abc",isPressed:a==="purple"||j,onPress:()=>s("purple"),onRelease:()=>r("purple",p)}),i.jsxs("g",{children:[i.jsx("path",{fill:o(2),d:"M565.12,1689.3c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M565.12,1667.73c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.04h0M565.12,1664.73c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]})]})},vf=194.32,Sf=1586.66,Dg=({localDialRotation:e,isDialDragging:t,dialShaking:n,dialPressed:s,onDialStart:r,onDialPress:o,getControlsCornerLightColor:l,textState:c,isDialAligned:a,isComplicationActive:u,recentlyFixed:f=!1})=>i.jsxs("g",{id:"Reset_Controls",children:[i.jsx("path",{fill:"#45486c",d:"M290.21,1663.73c10.78-17.3,17.01-37.73,17.01-59.61,0-23.97-7.48-46.2-20.22-64.48,7.77-.06,15.53-3.05,21.46-8.98,11.98-11.98,11.98-31.4,0-43.37-1.9-1.9-3.99-3.5-6.21-4.8-.5-17.51-14.85-31.56-32.48-31.56H121.34c-17.78,0-32.22,14.28-32.49,32-1.95,1.22-3.81,2.66-5.5,4.36-11.98,11.98-11.98,31.4,0,43.37,5.16,5.16,11.69,8.09,18.42,8.8-12.82,18.31-20.34,40.6-20.34,64.65,0,22.08,6.34,42.67,17.3,60.07-5.63,1.18-11,3.95-15.38,8.32-11.98,11.98-11.98,31.4,0,43.37,11.98,11.98,31.4,11.98,43.37,0,4.44-4.44,7.23-9.91,8.38-15.64,17.22,10.63,37.5,16.77,59.22,16.77,22.93,0,44.26-6.84,62.07-18.59.88,6.39,3.78,12.55,8.69,17.46,11.98,11.98,31.4,11.98,43.37,0,11.98-11.98,11.98-31.4,0-43.37-5.11-5.11-11.58-8.03-18.24-8.78Z",className:u?"minigame-active-pulse":f?"minigame-solved-fade":""}),i.jsx("circle",{fill:"#0d1a19",cx:"194.32",cy:"1604.12",r:"97.6",opacity:"0.3"}),i.jsxs("g",{children:[i.jsx("path",{fill:l(1),d:"M103.94,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M103.94,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(0),d:"M288.3,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M288.3,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(2),d:"M103.94,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M103.94,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsxs("g",{children:[i.jsx("path",{fill:l(3),d:"M288.3,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.53,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),i.jsx("path",{fill:"#1f1f38",d:"M288.3,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),i.jsx("text",{fill:c.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(108.17 1480.38)",children:c.text}),i.jsx("g",{transform:`translate(0 ${s?4:0}) rotate(${Math.round(e)} ${vf} ${Sf})`,style:{cursor:t?"grabbing":"grab"},onMouseDown:d=>r(d.clientX,d.clientY),onTouchStart:d=>{d.touches.length>0&&r(d.touches[0].clientX,d.touches[0].clientY)},onClick:o,children:i.jsxs("g",{className:n?"shake":"",children:[i.jsx("circle",{fill:"#d36b28",cx:"194.32",cy:"1586.66",r:"86.84"}),i.jsx("path",{fill:"none",stroke:"#fff",strokeWidth:"6",strokeMiterlimit:"10",d:"M238.98,1629.6c-11.27,11.72-27.11,19.01-44.65,19.01s-32.11-6.72-43.27-17.62"}),i.jsx("g",{transform:"translate(170.65 1623.1) rotate(135) scale(1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),i.jsx("g",{transform:"translate(219.09 1623.1) rotate(45) scale(1.74 -1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),i.jsx("path",{fill:"#fff",d:"M169.51,1524.47l20.43-20.43c1.99-1.99,5.23-1.99,7.22,0l20.43,20.43c3.22,3.22.94,8.72-3.61,8.72h-40.86c-4.55,0-6.83-5.5-3.61-8.72Z"})]})}),u&&a&&i.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"24",fontWeight:"bold",textAnchor:"middle",x:vf,y:Sf+8,style:{pointerEvents:"none"},children:"PRESS"})]}),$g=194.32,Fg=1586.66,Bg=({dialRotation:e,monitorOffset:t,periscopeY:n,dragHandlers:s,monitorDragHandlers:r,isMonitorDragging:o,isPeriscopeDragging:l=!1,isSnapping:c=!1,onDialClick:a,onBlueClick:u,onGreenClick:f,onPurpleClick:d,onUpgradesClick:p,onSettingsClick:y,onHelpClick:S,onSetRank:R,onAbortClick:j,upgradeCount:g,screenContent:h,isGameOver:x=!1,isSessionActive:m=!1,rank:P,currentXP:k,nextRankXP:C,shiftScore:w=0,gameStats:T={startTime:0,totalBonusTime:0,maxGroupSize:0,penalty:0},goalsCleared:L=0,goalsTarget:O=0,unspentPower:X=0,maxTime:K=75e3,complications:ee=[],onResolveComplication:I,upgradeLevels:J={}})=>{const ae=(J.CAPACITOR_EFFICIENCY||0)>=En.CAPACITOR_EFFICIENCY.maxLevel,W=(J.CIRCUIT_STABILIZER||0)>=En.CIRCUIT_STABILIZER.maxLevel,Q=(J.GEAR_LUBRICATION||0)>=En.GEAR_LUBRICATION.maxLevel,[Y,re]=v.useState(null),[te,q]=v.useState(!1),[pe,we]=v.useState(!1),{laserSliders:E,updateLaserSlider:B,shakingSlider:ve,getLaserLightColors:ie,getLaserTextState:ye,recentlyFixed:se,isComplicationActive:ge}=kg({complications:ee,isLaserMaxed:ae,onResolveComplication:I}),{lightsComplication:oe,lightSlider:ke,handleLightsButton:he,handleLightsSliderChange:Ee,lightsSliderShaking:Ge,getLightsButtonLightColor:$e,getLightsSliderLightColors:Fe,getLightsTextState:Oe,recentlyFixed:Ie,isComplicationActive:N}=bg({complications:ee,isLightsMaxed:W,pressedBtn:Y,onResolveComplication:I}),{localDialRotation:G,isDialDragging:Ce,dialShaking:D,dialPressed:F,handleDialStart:M,handleDialMove:$,handleDialEnd:V,handleDialPress:U,getControlsCornerLightColor:le,getControlsTextState:b,recentlyFixed:_,isDialAligned:A,isComplicationActive:z}=Lg({complications:ee,isControlsMaxed:Q,onResolveComplication:I});v.useEffect(()=>{if(!Ce)return;const Be=Wt=>{$(Wt.clientX,Wt.clientY)},Xe=()=>{V()},wt=Wt=>{Wt.touches.length>0&&$(Wt.touches[0].clientX,Wt.touches[0].clientY)},Wn=()=>{V()};return window.addEventListener("mousemove",Be),window.addEventListener("mouseup",Xe),window.addEventListener("touchmove",wt),window.addEventListener("touchend",Wn),()=>{window.removeEventListener("mousemove",Be),window.removeEventListener("mouseup",Xe),window.removeEventListener("touchmove",wt),window.removeEventListener("touchend",Wn)}},[Ce]),v.useEffect(()=>{m||we(!1)},[m]);const H=Be=>{re(Be)},Z=(Be,Xe)=>{Y===Be?(re(null),Be==="blue"?he(0):Be==="green"?he(1):Be==="purple"&&he(2),Xe&&Xe()):re(null)},ne=Be=>{Be.stopPropagation(),q(Xe=>!Xe)},ue=Be=>{R&&R(Be),q(!1)},de=Be=>{Be.stopPropagation(),pe?(j&&j(),we(!1)):(we(!0),setTimeout(()=>we(!1),3e3))},Te={transition:o?"none":"transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},be={transition:o?"none":"opacity 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},Ne=363.9*Math.min(1,Math.max(0,k/C)),je=Math.min(1,Math.max(0,(t+400)/920)),_e=Math.min(1,Math.max(0,n/300)),We=Math.max(je,_e)*.85,ce="translate(31.92, 399.44)";return i.jsxs("svg",{viewBox:"0 827.84 648 1152",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{overflow:"hidden"},onClick:()=>{te&&q(!1)},children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:"console-gradient",x1:"324",y1:"1979.84",x2:"324",y2:"827.84",gradientUnits:"userSpaceOnUse",children:[i.jsx("stop",{offset:"0",stopColor:"#363b5e"}),i.jsx("stop",{offset:"1",stopColor:"#0b1c3f"})]}),i.jsx("clipPath",{id:"reset-lights-slider-clip",children:i.jsx("rect",{x:"356.86",y:"1499.08",width:"50.51",height:"175.86",rx:"6.92",ry:"6.92"})})]}),i.jsxs("g",{id:"Console_Base",children:[i.jsx("polygon",{fill:"#0f1829",points:"42.37 1807.1 54.73 1865.36 592.78 1865.36 605.14 1807.1 42.37 1807.1"}),i.jsx("path",{fill:"#616a79",d:"M615.77,1807.1l14.87-84.85c.65-3.69-2.19-7.08-5.94-7.08H22.81c-3.75,0-6.59,3.38-5.94,7.08l14.87,84.85h584.04Z"}),i.jsx("path",{fill:"#59acae",d:"M583.65,1441.46H63.86l-47.08,283.09c-.6,3.61,2,6.92,5.44,6.92h603.07c3.44,0,6.04-3.31,5.44-6.92l-47.08-283.09Z"}),i.jsxs("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",transform:"translate(55 1855.15)",children:[i.jsx("tspan",{letterSpacing:"-0.04em",children:"V"}),i.jsxs("tspan",{x:"9.49",children:["ersion 1.1.13.",219]})]}),i.jsx("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",textAnchor:"end",transform:"translate(592.5 1855.15)",children:"MuzzyMade @ 2026"}),i.jsx("g",{id:"RankSelector",className:x?"pointer-events-none":"cursor-pointer hover:brightness-125 active:brightness-90 transition-all origin-center",onClick:x?void 0:ne,children:i.jsx("text",{fill:te?"#5bbc70":"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:te?"bold":"normal",textAnchor:"middle",transform:"translate(323.75 1855.99)",children:"RANK SELECT"})})]}),i.jsxs("g",{transform:"translate(17.28, 1057.14)",children:[i.jsx("path",{fill:"#616a79",fillRule:"evenodd",d:"M597.13,32.56H15.82C6.56,32.56-.51,40.11.03,49.42l18.54,321.98c.39,6.78,5.81,12.28,12.11,12.28h551.59c6.3,0,11.72-5.5,12.11-12.28l18.54-321.98c.54-9.31-6.53-16.86-15.79-16.86Z"}),i.jsx("path",{fill:"#aad9d9",fillRule:"evenodd",d:"M604.74,37.21H8.21c-3.37,0-5.34-4.05-3.17-6.52L23.09,10.16C28.83,3.68,37.14,0,46.03,0h520.89c8.89,0,17.2,3.68,22.94,10.16l18.06,20.52c2.17,2.47.19,6.52-3.17,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M536.44,362.92H76.51c-21.64,0-40.25-18.8-41.48-41.9l-11.76-220.89c-.6-11.35,3.24-22,10.81-29.99,7.45-7.85,17.63-12.18,28.67-12.18h487.46c11.04,0,21.22,4.33,28.67,12.18,7.58,7.99,11.41,18.64,10.81,29.99l-11.76,220.89c-1.23,23.1-19.84,41.9-41.48,41.9ZM62.75,62.96c-9.65,0-18.55,3.77-25.04,10.62-6.62,6.98-9.98,16.32-9.45,26.28l11.76,220.89c1.09,20.49,17.46,37.17,36.49,37.17h459.93c19.03,0,35.4-16.67,36.49-37.17l11.76-220.89c.53-9.96-2.82-19.3-9.45-26.28-6.49-6.85-15.39-10.62-25.04-10.62H62.75Z"}),i.jsx("path",{fill:"#35385b",fillRule:"evenodd",d:"M550.2,60.46H62.75c-21.59,0-38.15,17.7-36.98,39.53l11.76,220.89c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.76-220.89c1.16-21.83-15.4-39.53-36.98-39.53Z"}),i.jsx("path",{fill:"#474871",fillRule:"evenodd",d:"M549.56,74.42H63.39c-21.53,0-38.04,17.7-36.88,39.53l11.02,206.94c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.02-206.94c1.16-21.83-15.35-39.53-36.88-39.53Z",className:ge?"minigame-active-pulse-laser":se?"minigame-solved-fade-laser":""}),i.jsxs("g",{id:"Operator_Rank_-_meter",children:[i.jsx("path",{fill:"#5bbc70",d:"M540.77,147.84H74.51c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM74.51,128.07c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H74.51Z"}),i.jsx("path",{fill:"#5bbc70",d:`M74.51,127.57h${Ne}c.66,0,1.2.54,1.2,1.2v17.36c0,.66-.54,1.2-1.2,1.2H74.51c-5.45,0-9.88-4.43-9.88-9.88h0c0-5.45,4.43-9.88,9.88-9.88Z`}),i.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(545 142)",children:[Math.floor(k).toLocaleString()," / ",Math.floor(C).toLocaleString()]}),i.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(545 118)",children:"PROMOTION THRESHOLD"}),i.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(239.35 115.28)",children:P}),i.jsxs("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(65.42 113.79)",children:[i.jsx("tspan",{x:"0",y:"0",children:"OPE"}),i.jsx("tspan",{letterSpacing:".02em",x:"40.54",y:"0",children:"R"}),i.jsx("tspan",{letterSpacing:"-.05em",x:"53.68",y:"0",children:"A"}),i.jsx("tspan",{letterSpacing:"-.03em",x:"66.07",y:"0",children:"T"}),i.jsx("tspan",{x:"77.45",y:"0",children:"OR "}),i.jsx("tspan",{letterSpacing:".02em",x:"112.01",y:"0",children:"R"}),i.jsx("tspan",{x:"125.16",y:"0",children:"ANK"})]})]}),i.jsx(Ng,{laserSliders:E,shakingSlider:ve,onSliderChange:B,getLaserLightColors:ie,textState:ye(),isComplicationActive:ge,recentlyFixed:se})]}),i.jsx(Og,{lightsComplication:oe,lightSlider:ke,onSliderChange:Ee,onButtonPress:H,onButtonRelease:Z,getLightsButtonLightColor:$e,getLightsSliderLightColors:Fe,textState:Oe(),pressedBtn:Y,sliderShaking:Ge,onBlueClick:u,onGreenClick:f,onPurpleClick:d,isComplicationActive:N,recentlyFixed:Ie}),i.jsx(Dg,{localDialRotation:G,isDialDragging:Ce,dialShaking:D,dialPressed:F,onDialStart:M,onDialPress:U,getControlsCornerLightColor:le,textState:b(),isDialAligned:A(),isComplicationActive:z,recentlyFixed:_}),i.jsx("circle",{id:"coord-reference",cx:$g,cy:Fg,r:"1",fill:"transparent",style:{pointerEvents:"none"}}),(m||P>0)&&i.jsx("g",{id:"System_Upgrades",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:m?de:p,children:m?i.jsxs(i.Fragment,{children:[i.jsx("rect",{fill:"#ef4444",x:"123.18",y:"1748.67",width:"342.8",height:"44.19",rx:"12.37",ry:"12.37"}),i.jsx("rect",{fill:"none",stroke:"#ef4444",strokeMiterlimit:"10",x:"123.45",y:"1748.67",width:"420.29",height:"44.19",rx:"9.43",ry:"9.43"}),i.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"294.58",y:"1778.17",children:pe?"ARE YOU SURE?":"END SHIFT EARLY"}),i.jsx("text",{fill:"#ef4444",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",transform:"translate(492.79 1783.33)",children:"X"})]}):i.jsxs(i.Fragment,{children:[i.jsx("rect",{fill:"#ffd92b",x:"205",y:"1748.67",width:"160",height:"44.19",rx:"12.37",ry:"12.37"}),i.jsx("rect",{fill:"none",stroke:"#ffd92b",strokeMiterlimit:"10",x:"205",y:"1748.67",width:"238",height:"44.19",rx:"9.43",ry:"9.43"}),i.jsx("text",{fill:"#45486c",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"285",y:"1778.17",children:"UPGRADES"}),i.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",textAnchor:"middle",x:"404",y:"1783.33",children:g})]})}),i.jsxs("text",{fill:"#5bbc70",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(210.86 1947.47)",children:[i.jsx("tspan",{letterSpacing:".01em",children:"G"}),i.jsx("tspan",{x:"50.77",children:"O"}),i.jsx("tspan",{letterSpacing:".01em",x:"94.43",children:"O"}),i.jsx("tspan",{letterSpacing:".03em",x:"138.94",children:"P"}),i.jsx("tspan",{x:"182.79",children:"S"})]}),i.jsxs("g",{id:"How_to_Play",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:S,children:[i.jsx("circle",{fill:"#5bbc70",cx:"60.02",cy:"1920.16",r:"42.65"}),i.jsx("text",{fill:"#0f1528",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(43.23 1951.29)",children:"?"})]}),i.jsxs("g",{id:"Settings",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:y,children:[i.jsx("circle",{fill:"#5bbc70",cx:"586.51",cy:"1921.29",r:"42.65"}),i.jsx("path",{fill:"#0f1528",d:"M575.34,1888.9c1.31-.22,2.74.1,3.77.94.53.43.76,1.11,1.28,1.57,3.07,2.69,6.81,3.17,10.41,1.27,2.93-1.54,3.23-4.63,7.35-3.65,2.47.59,8.3,3.99,10.15,5.79,3.3,3.22.52,5.23.71,8.67.17,3.07,2.34,6.18,5.12,7.42,2.12.95,4.78.73,5.84,3.27s.95,10.11.24,12.77c-1.23,4.62-4.11,3.02-7.31,4.93-2.36,1.42-4.2,4.72-4.2,7.5s1.94,4.09.64,6.88c-1.06,2.28-8.15,6.41-10.64,7.02-3.9.96-4.47-2.07-6.97-3.74-2.65-1.77-6.22-1.75-9.02-.28-3.07,1.61-3.15,5.19-7.61,4.38-2.27-.42-8.91-4.29-10.53-5.98-2.69-2.79-.66-4.28-.3-6.87.55-3.94-1.21-8.15-4.99-9.77-2.48-1.06-5.42-.37-6.52-3.73-.83-2.52-.68-11.58.66-13.88,1.2-2.06,3.02-1.68,4.85-2.27,4.19-1.36,6.81-5.14,6.29-9.6-.29-2.49-1.96-4.37.32-6.86,1.42-1.56,8.41-5.43,10.46-5.77ZM586.19,1909.97c-14.67.42-14.14,22.83.44,22.69,14.84-.14,14.53-23.12-.44-22.69Z"})]}),i.jsx("rect",{x:"0",y:"827.84",width:"648",height:"1152",fill:"#000",style:{opacity:We,...be,pointerEvents:"none"}}),i.jsxs("g",{id:"Periscope",transform:`translate(0, ${n})`,style:{transition:l||c?"none":"transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"grab"},...s,children:[i.jsx("rect",{fill:"#087962",x:"22.36",y:"978.45",width:"603.66",height:"51.13",rx:"11.03",ry:"11.03"}),i.jsx("path",{fill:"#087962",d:"M 390.17 -1000 V 1111.98 c 0 13.74 -11.16 24.9 -24.9 24.9 h -88.54 c -13.74 0 -24.9 -11.16 -24.9 -24.9 V -1000 H 390.17 Z"}),i.jsxs("g",{children:[i.jsx("path",{fill:"#5bbc70",fillRule:"evenodd",d:"M252.54,1089.77c-23.25,0-45.07-9.09-61.45-25.59-16.38-16.5-25.3-38.39-25.13-61.64.35-47.38,39.59-85.92,87.47-85.92h138.58c23.99,0,46.29,9.59,62.81,26.99,16.51,17.4,24.9,40.21,23.64,64.23-2.4,45.72-40.19,81.7-86.02,81.93h-.44c-24.04,0-47.19-10.12-63.53-27.77-2.19-2.36-4.86-2.71-6.27-2.71s-3.96.34-6.05,2.61c-16.35,17.72-39.54,27.87-63.63,27.87Z"}),i.jsx("path",{fill:"#0b1c3f",fillRule:"evenodd",d:"M392.01,931.91h-138.58c-39.31,0-71.89,31.44-72.18,70.75-.29,39.62,31.74,71.83,71.29,71.83,20.72,0,39.37-8.84,52.39-22.95,9.32-10.1,25.43-10,34.77.09,13.09,14.14,31.85,22.97,52.67,22.87,37.55-.18,68.86-29.95,70.83-67.44,2.16-41.12-30.54-75.13-71.19-75.13Z"}),i.jsx("path",{fill:"#373a60",fillRule:"evenodd",d:"M392.02,1054.51c-14.46,0-27.83-5.85-37.66-16.46-8.25-8.91-19.96-14.02-32.14-14.02s-23.79,5.09-31.97,13.96c-9.83,10.66-23.23,16.53-37.71,16.53s-26.71-5.39-36.42-15.17c-9.71-9.78-15-22.76-14.89-36.54.21-28.08,23.63-50.92,52.21-50.92h138.58c14.22,0,27.44,5.68,37.23,16,9.78,10.31,14.76,23.84,14.01,38.11-1.42,27.07-23.82,48.38-50.98,48.52h-.26Z"})]}),i.jsx("g",{transform:"translate(303.67 1091.18) scale(1.74)",children:i.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})})]}),i.jsx("g",{transform:`translate(0, ${t})`,style:{...Te,cursor:x?"grab":"default",pointerEvents:x?"auto":"none",touchAction:x?"none":"auto"},...x&&o!==void 0?r:{},children:x?i.jsx("g",{transform:ce,children:i.jsx(mg,{shiftScore:w,rank:P,xpCurrent:k,xpNext:C,cracksFilled:L,cracksTarget:O,pressureVented:T.totalBonusTime||0,maxTime:K,massPurged:T.maxGroupSize||0,leftoverPenalty:T.penalty||0,unspentPower:X,isWin:L>=O})}):i.jsxs(i.Fragment,{children:[i.jsx("path",{fill:"#f2a743",d:"M48.78,432h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H44.2c-6.78,0-12.28-5.5-12.28-12.28V448.86c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M606.65,436.65H40.86c-3.39,0-5.14-4.05-2.82-6.52l19.25-20.52c6.08-6.49,14.58-10.16,23.47-10.16h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"none",stroke:"#1d1d3a",strokeWidth:"5",strokeMiterlimit:"10",d:"M592.34,1246.25c0,21.83-17.7,39.53-39.53,39.53H94.71c-21.83,0-39.53-17.7-39.53-39.53V499.44c0-21.83,17.7-39.53,39.53-39.53h458.1c21.83,0,39.53,17.7,39.53,39.53v746.81Z"}),i.jsx("rect",{fill:"#1f1f38",x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("foreignObject",{x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53",children:i.jsx("div",{className:"w-full h-full overflow-hidden rounded-[39px]",children:h})}),i.jsx("g",{pointerEvents:"none",children:i.jsx("path",{fill:"none",stroke:"#5bbc70",strokeWidth:"1",strokeOpacity:"0.2",d:"M94.71,474.42h458.1c21.82,0,39.53,17.71,39.53,39.53v732.85c0,21.82-17.71,39.53-39.53,39.53H94.71c-21.82,0-39.53-17.71-39.53-39.53V513.95c0-21.82,17.71-39.53,39.53-39.53Z"})})]})}),te&&!x&&i.jsx("foreignObject",{x:"200",y:"1550",width:"250",height:"300",children:i.jsxs("div",{onClick:Be=>Be.stopPropagation(),style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1d1d3a 0%, #0f1829 100%)",border:"2px solid #5bbc70",borderRadius:"8px",overflow:"hidden"},children:[i.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #5bbc70",color:"#5bbc70",fontFamily:"Amazon Ember, sans-serif",fontWeight:"bold",fontSize:"14px",textAlign:"center"},children:"SELECT RANK"}),i.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px"},children:Array.from({length:51},(Be,Xe)=>i.jsx("div",{onClick:()=>ue(Xe),style:{padding:"8px 12px",color:Xe===0?"#f87171":Xe===P?"#5bbc70":"#aad9d9",fontFamily:"Amazon Ember, sans-serif",fontSize:"14px",cursor:"pointer",borderRadius:"4px",background:Xe===P?"rgba(91, 188, 112, 0.2)":"transparent",fontWeight:Xe===P?"bold":"normal",transition:"background 0.15s"},onMouseEnter:wt=>{Xe!==P&&(wt.currentTarget.style.background="rgba(170, 217, 217, 0.1)")},onMouseLeave:wt=>{Xe!==P&&(wt.currentTarget.style.background="transparent")},children:Xe===0?"0 - WIPE DATA":`Rank ${Xe}`},Xe))})]})})]})},zg=[{id:"actives",label:"TOOLS",unlockRank:5,color:"#fbbf24"},{id:"features",label:"FEATURES",unlockRank:20,color:"#a78bfa"},{id:"complications",label:"SYSTEMS",unlockRank:2,color:"#f97316"},{id:"passives",label:"UTILITY",unlockRank:3,color:"#5bbc70"}],Gg=(e,t)=>t==="active"?{accent:"#b45309",text:"#fbbf24"}:t==="feature"?{accent:"#7c3aed",text:"#a78bfa"}:e==="CAPACITOR_EFFICIENCY"?{accent:"#d82727",text:"#ff6b6b"}:e==="CIRCUIT_STABILIZER"?{accent:"#d36b28",text:"#ffa94d"}:e==="GEAR_LUBRICATION"?{accent:"#2d5a87",text:"#74c0fc"}:{accent:"#2d7a4d",text:"#5bbc70"},Yg=({scraps:e,upgrades:t,rank:n,onPurchase:s,onRefund:r,onClose:o,equippedActives:l=[],onToggleEquip:c,maxActiveSlots:a=1})=>{var w;const u=zg.filter(T=>T.unlockRank<=n),[f,d]=v.useState(((w=u[0])==null?void 0:w.id)||"complications"),[p,y]=v.useState(!1),S=v.useRef(0),R=v.useRef(0),j=50,g=(T,L)=>{y(!0),S.current=T,R.current=L},h=(T,L)=>{if(!p)return;y(!1);const O=T-S.current,X=L-R.current;if(Math.abs(O)>Math.abs(X)&&Math.abs(O)>j){const K=u.findIndex(ee=>ee.id===f);O>0&&K<u.length-1?d(u[K+1].id):O<0&&K>0&&d(u[K-1].id)}};v.useEffect(()=>{const T=O=>{p&&h(O.clientX,O.clientY)},L=O=>{p&&O.changedTouches[0]&&h(O.changedTouches[0].clientX,O.changedTouches[0].clientY)};return p&&(window.addEventListener("mouseup",T),window.addEventListener("touchend",L)),()=>{window.removeEventListener("mouseup",T),window.removeEventListener("touchend",L)}},[p,f,u]);const m=(()=>{const T=Object.values(En).filter(L=>L.unlockRank<=n);switch(f){case"actives":return T.filter(L=>L.type==="active").sort((L,O)=>L.unlockRank-O.unlockRank);case"features":return T.filter(L=>L.type==="feature").sort((L,O)=>L.unlockRank-O.unlockRank);case"complications":return T.filter(L=>L.category==="complication").sort((L,O)=>L.unlockRank-O.unlockRank);case"passives":return T.filter(L=>L.type==="passive"&&L.category!=="complication").sort((L,O)=>L.unlockRank-O.unlockRank);default:return[]}})(),P=u.length>0,k=T=>{const L=t[T.id]||0,O=L>=T.maxLevel,K=e>=T.costPerLevel&&!O,ee=L>0,I=Gg(T.id,T.type),J=T.type==="active",ae=l.includes(T.id);return i.jsxs("div",{className:"rounded-xl p-4 border",style:{backgroundColor:"#0c0f19",borderColor:J&&ae?"#5bbc70":"#ffffff40"},children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-bold tracking-wide",style:{color:I.text,fontSize:"18px"},children:T.name}),i.jsx("p",{style:{color:"#59acae",fontSize:"13px"},className:"mt-1",children:T.desc})]}),J&&L>0&&c&&i.jsx("button",{onClick:()=>c(T.id),disabled:!ae&&l.length>=a,className:"ml-2 px-3 py-1 rounded-lg font-bold text-sm border-2 transition-all",style:{borderColor:ae?"#5bbc70":"#59acae60",color:ae?"#5bbc70":"#59acae",backgroundColor:ae?"#5bbc7020":"transparent",cursor:!ae&&l.length>=a?"not-allowed":"pointer",opacity:!ae&&l.length>=a?.5:1},children:ae?"ON":"OFF"})]}),i.jsxs("div",{className:"flex items-center gap-3 my-3",children:[i.jsx("button",{onClick:()=>ee&&(r==null?void 0:r(T.id)),disabled:!ee,className:"w-8 h-8 rounded-lg font-bold text-xl border-2 transition-all flex items-center justify-center",style:{borderColor:ee?I.accent:"#59acae30",color:ee?I.text:"#59acae40",backgroundColor:ee?I.accent+"20":"transparent",cursor:ee?"pointer":"not-allowed"},children:""}),i.jsx("div",{className:"flex gap-1 flex-1 justify-center",children:Array.from({length:T.maxLevel}).map((W,Q)=>i.jsx("div",{className:"h-4 rounded-sm border flex-1 max-w-8",style:{borderColor:Q<L?I.accent:"#59acae40",backgroundColor:Q<L?I.accent:"transparent"}},Q))}),i.jsx("button",{onClick:()=>K&&s(T.id),disabled:!K,className:"w-8 h-8 rounded-lg font-bold text-xl border-2 transition-all flex items-center justify-center",style:{borderColor:K?I.accent:"#59acae30",color:K?I.text:"#59acae40",backgroundColor:K?I.accent+"20":"transparent",cursor:K?"pointer":"not-allowed"},children:"+"}),i.jsxs("span",{className:"font-bold w-12 text-right",style:{color:I.text,fontSize:"16px"},children:[L,"/",T.maxLevel]})]}),i.jsxs("div",{className:"flex justify-between items-start",style:{fontSize:"14px"},children:[i.jsx("div",{style:{color:"#ffffff"},children:J?i.jsxs(i.Fragment,{children:["Effect: ",T.formatEffect(1)]}):L>0?i.jsxs(i.Fragment,{children:["Current: ",T.formatEffect(L)]}):i.jsx("span",{style:{color:"#59acae"},children:"Current: Spend points to upgrade"})}),O&&T.maxLevelBonus&&i.jsxs("div",{className:"italic text-right ml-2",style:{color:"#5bbc70"},children:["Max: ",T.maxLevelBonus]})]})]},T.id)},C=()=>u.length===0?null:i.jsx("div",{className:"flex w-full mb-3",style:{height:"36px"},children:u.map(T=>{const L=f===T.id;return i.jsx("button",{onClick:()=>d(T.id),className:"font-bold text-center transition-all",style:{width:"25%",backgroundColor:L?T.color+"30":"transparent",color:L?T.color:"#59acae",borderBottom:L?`3px solid ${T.color}`:"3px solid transparent",fontSize:"11px",padding:"8px 4px",fontFamily:"'From Where You Are', sans-serif",letterSpacing:"0.05em"},children:T.label},T.id)})});return i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:i.jsxs("div",{className:"relative",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:[i.jsxs("svg",{viewBox:"0 0 583.67 910",className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[i.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),i.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),i.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),i.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),i.jsx("text",{fill:"#f2a743",fontFamily:"'From Where You Are'",fontSize:"28",transform:"translate(50 105)",children:"UPGRADES"}),i.jsxs("text",{fill:"#5bbc70",fontFamily:"'Amazon Ember'",transform:"translate(530 105)",textAnchor:"end",children:[i.jsx("tspan",{fontSize:"16",fontWeight:"600",children:"SCRAPS: "}),i.jsx("tspan",{fontSize:"32",fontWeight:"800",children:e})]}),i.jsxs("foreignObject",{x:"40",y:"125",width:"503",height:"720",children:[i.jsx("style",{children:".upgrade-scroll::-webkit-scrollbar { display: none; }"}),i.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"upgrade-scroll w-full h-full overflow-y-auto",style:{fontFamily:"'Amazon Ember', sans-serif",scrollbarWidth:"none",msOverflowStyle:"none"},onMouseDown:T=>g(T.clientX,T.clientY),onTouchStart:T=>g(T.touches[0].clientX,T.touches[0].clientY),children:P?i.jsxs("div",{className:"pb-20",children:[i.jsx("div",{className:"text-lg mb-3 text-center",style:{color:"#fbbf24",fontFamily:"'Amazon Ember', sans-serif"},children:"Earn Scraps by Increasing your Operator Rank"}),C(),i.jsx("div",{className:"space-y-3",children:m.length>0?m.map(k):i.jsx("div",{className:"text-center py-8",style:{color:"#59acae"},children:"No upgrades available in this category yet."})})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[i.jsx("p",{className:"text-2xl tracking-wide mb-3",style:{color:"#6acbda",fontFamily:"'From Where You Are', sans-serif"},children:"NO UPGRADES AVAILABLE"}),i.jsx("p",{style:{color:"#59acae",fontSize:"16px"},children:"Reach Rank 2 to unlock your first upgrade"})]})})]})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:o,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})})]})})},Hg=({engine:e,state:t,careerScore:n,scraps:s,powerUps:r={},onOpenSettings:o,onOpenHelp:l,onOpenUpgrades:c,onSetRank:a,onPurchaseUpgrade:u,onRefundUpgrade:f,onDismissGameOver:d,equippedActives:p=[],onToggleEquip:y})=>{const S=t.shiftScore>0||t.gameOver;let R;if(S){const se=t.goalsCleared>=t.goalsTarget,{newCareerScore:ge}=ap(e.initialTotalScore,t.shiftScore,se);R=dt(ge)}else R=dt(n);const[j,g]=v.useState(!1),h=v.useRef(null),[x,m]=v.useState(0),[P,k]=v.useState(!1),[C,w]=v.useState(!1),T=v.useRef(0),L=200,O=300,[X,K]=v.useState(0),[ee,I]=v.useState(!1),J=v.useRef(0),ae=150,[W,Q]=v.useState(0);v.useEffect(()=>{if(!t.gameOver){const se=setInterval(()=>{Q(ge=>(ge+1)%2)},2e3);return()=>clearInterval(se)}},[t.gameOver]),v.useEffect(()=>{t.phase===Ze.ConsoleScreen&&!t.gameOver&&(m(O),w(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{w(!1),m(0)})}))},[t.phase,t.gameOver]);const Y=se=>{t.gameOver||(k(!0),T.current=se-x)},re=se=>{if(!P)return;const ge=se-T.current,oe=Math.max(0,Math.min(O,ge));m(oe)},te=()=>{P&&(k(!1),x>L?(e.execute(new $s(Ze.TankScreen)),setTimeout(()=>m(0),1e3)):m(0))},q=se=>{t.gameOver&&(I(!0),J.current=se-X)},pe=se=>{if(!ee)return;const ge=se-J.current,oe=Math.min(0,ge);K(oe)},we=()=>{ee&&(I(!1),X<-ae&&d&&d(),K(0))};v.useEffect(()=>{const se=he=>{P&&re(he.clientY),ee&&pe(he.clientY)},ge=()=>{P&&te(),ee&&we()},oe=he=>{P&&re(he.touches[0].clientY),ee&&pe(he.touches[0].clientY)},ke=()=>{P&&te(),ee&&we()};return(P||ee)&&(window.addEventListener("mousemove",se),window.addEventListener("mouseup",ge),window.addEventListener("touchmove",oe),window.addEventListener("touchend",ke)),()=>{window.removeEventListener("mousemove",se),window.removeEventListener("mouseup",ge),window.removeEventListener("touchmove",oe),window.removeEventListener("touchend",ke)}},[P,x,ee,X]);const E=()=>{e.abortRun()},B=e.isSessionActive&&!t.gameOver,ie=(t.gameOver?520:-400)+X,ye=()=>i.jsx("div",{className:"w-full h-full flex flex-col items-center pt-24 font-mono overflow-hidden text-center select-none",children:i.jsx("div",{className:"mt-auto mb-4 flex flex-col items-center",children:B?W===0?i.jsx("div",{className:"text-[#5bbc70] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse",children:"CLEANING..."}):i.jsxs("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are']",children:[Math.floor((1-t.shiftTime/e.maxTime)*100),"% PSI"]}):W===0?i.jsx("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"TO START SHIFT"}):i.jsx("div",{className:"text-[#f1a941] text-3xl font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"PULL DOWN PERISCOPE"})})});return i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{ref:h,className:"relative z-10 select-none flex items-center justify-center",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsx("div",{className:"w-full h-full shadow-2xl relative",children:i.jsx(Bg,{dialRotation:0,monitorOffset:ie,periscopeY:x,dragHandlers:{onMouseDown:se=>Y(se.clientY),onTouchStart:se=>Y(se.touches[0].clientY)},monitorDragHandlers:{onMouseDown:se=>q(se.clientY),onTouchStart:se=>q(se.touches[0].clientY)},isMonitorDragging:ee,isPeriscopeDragging:P,isSnapping:C,onSettingsClick:o,onHelpClick:l,onUpgradesClick:()=>g(!0),onSetRank:a,onAbortClick:E,upgradeCount:s,screenContent:t.gameOver?null:i.jsx(ye,{}),isGameOver:t.gameOver,isSessionActive:e.isSessionActive,rank:R.rank,currentXP:R.progress,nextRankXP:R.toNextRank,shiftScore:t.shiftScore,gameStats:t.gameStats,goalsCleared:t.goalsCleared,goalsTarget:t.goalsTarget,unspentPower:s,maxTime:e.maxTime,complications:t.complications,onResolveComplication:se=>e.execute(new xg(se)),upgradeLevels:r})})}),j&&i.jsx(Yg,{scraps:s,upgrades:r,rank:R.rank,onPurchase:se=>u==null?void 0:u(se),onRefund:se=>f==null?void 0:f(se),onClose:()=>g(!1),equippedActives:p,onToggleEquip:y,maxActiveSlots:1+(r.ACTIVE_EXPANSION_SLOT||0)+(r.ACTIVE_EXPANSION_SLOT_2||0)})]})};function _l(e){return`${e.x},${e.y}`}function Cf(e){if(e.length<=1)return!0;const t=new Set(e.map(_l)),n=new Set,s=[e[0]];for(;s.length>0;){const r=s.shift(),o=_l(r);if(n.has(o))continue;n.add(o);const l=[{x:r.x,y:r.y+1},{x:r.x,y:r.y-1},{x:r.x+1,y:r.y},{x:r.x-1,y:r.y}];for(const c of l){const a=_l(c);t.has(a)&&!n.has(a)&&s.push(c)}}return n.size===e.length}function Wg(e){const t=e.length;if(t<2)return null;let n=null,s=1/0;for(let r=1;r<(1<<t)-1;r++){const o=[],l=[];for(let f=0;f<t;f++)r&1<<f?o.push(f):l.push(f);const c=o.map(f=>e[f]),a=l.map(f=>e[f]);if(!Cf(c)||!Cf(a))continue;const u=Math.abs(o.length-l.length);if(u<s&&(s=u,n=[o,l],u===0))break}return n}function kf(e,t,n){const s=Wg(e.cells);if(!s)return{...e,color:t};const[r]=s,o=new Set(r),l=e.cells.map((c,a)=>o.has(a)?t:n);return{...e,color:t,cellColors:l}}const wf=5e3;class Ug{trySpawnGoal(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{goal:null,newLastSpawnTime:l};const c=Date.now();if(c-l<=wf)return{goal:null,newLastSpawnTime:l};const a=dt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=rf(n,t.goalMarks,a,r,o,u);return f?(u&&t.crackDownRemaining--,vt.playPop(1),{goal:f,newLastSpawnTime:c}):{goal:null,newLastSpawnTime:c}}trySpawnCrack(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{crack:null,newLastSpawnTime:l};const c=Date.now();if(c-l<=wf)return{crack:null,newLastSpawnTime:l};const a=dt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=t.crackCells.map(p=>({id:p.id,x:p.x,y:p.y,color:p.color,spawnTime:p.spawnTime})),d=rf(n,f,a,r,o,u);if(d){const p={id:d.id,x:d.x,y:d.y,color:d.color,originCrackId:[],branchCrackIds:[],lastGrowthCheck:c,crackBranchInterval:7e3+Math.random()*5e3,spawnTime:d.spawnTime};return u&&t.crackDownRemaining--,vt.playPop(1),{crack:p,newLastSpawnTime:c}}return{crack:null,newLastSpawnTime:c}}handleGoals(t,n,s,r,o){t.goalMarks=t.goalMarks.filter(c=>!n.includes(c.id));const l=new Set(n);n.forEach(c=>{const a=t.crackCells.find(u=>u.id===c);a&&(a.originCrackId.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.branchCrackIds=f.branchCrackIds.filter(d=>d!==c))}),a.branchCrackIds.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.originCrackId=f.originCrackId.filter(d=>d!==c))}))}),t.crackCells=t.crackCells.filter(c=>!l.has(c.id)),n.forEach(c=>{const a=Ue(r.x),u=Math.floor(r.y),f=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:f,text:"Laser to Seal",x:a,y:u,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(d=>d.id!==f),o()},1e3),me.emit(xe.GOAL_CAPTURED,{count:1})})}handleCrackConsumption(t,n,s,r){if(n.length===0)return;const o=new Set(n);if(n.forEach(l=>{const c=t.crackCells.find(a=>a.id===l);c&&(c.originCrackId.forEach(a=>{const u=t.crackCells.find(f=>f.id===a);u&&(u.branchCrackIds=u.branchCrackIds.filter(f=>f!==l))}),c.branchCrackIds.forEach(a=>{const u=t.crackCells.find(f=>f.id===a);u&&(u.originCrackId=u.originCrackId.filter(f=>f!==l))}))}),t.crackCells=t.crackCells.filter(l=>!o.has(l.id)),t.goalMarks=t.goalMarks.filter(l=>!o.has(l.id)),n.length>0){const l=Ue(s.x),c=Math.floor(s.y),a=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:a,text:n.length>1?`Sealed ${n.length}`:"Sealed",x:l,y:c,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(u=>u.id!==a),r()},1e3),me.emit(xe.GOAL_CAPTURED,{count:n.length})}}countCracks(t){if(t.length===0)return 0;const n=new Set;let s=0;for(const r of t){if(n.has(r.id))continue;const o=[r.id];for(;o.length>0;){const l=o.shift();if(n.has(l))continue;n.add(l);const c=t.find(a=>a.id===l);c&&(c.originCrackId.forEach(a=>{n.has(a)||o.push(a)}),c.branchCrackIds.forEach(a=>{n.has(a)||o.push(a)}))}s++}return s}getConnectedComponent(t,n){const s=new Set,r=[],o=[t];for(;o.length>0;){const l=o.shift();if(s.has(l))continue;s.add(l);const c=n.find(a=>a.id===l);c&&(r.push(c),c.originCrackId.forEach(a=>{s.has(a)||o.push(a)}),c.branchCrackIds.forEach(a=>{s.has(a)||o.push(a)}))}return r}isLeafCell(t,n){const s=n.find(r=>r.id===t);return s?s.branchCrackIds.length===0:!0}}const Yc=new Ug,Xg=8;class Vg{tickGrowth(t,n,s,r){var c;if(dt(n).rank<30||t.phase===Ze.ConsoleScreen||t.phase===Ze.COMPLICATION_MINIGAME)return;const l=Date.now();for(const a of t.crackCells){if((c=t.grid[a.y])!=null&&c[a.x]||l-a.lastGrowthCheck<a.crackBranchInterval)continue;a.lastGrowthCheck=l,a.crackBranchInterval=5e3+Math.random()*5e3;const u=Math.max(0,1-t.shiftTime/r),f=Math.min(1,.1+u),p=(s.SLOW_CRACKS||0)*.05;let y=Math.max(0,f-p);a.branchCrackIds.length===0&&(y*=.5);const R=this.getDistanceFromRoot(a,t.crackCells),j=Math.max(.1,1-R*.25);if(y*=j,Math.random()>y)continue;const g=[{x:Ue(a.x+1),y:a.y},{x:Ue(a.x-1),y:a.y},{x:a.x,y:a.y+1},{x:a.x,y:a.y-1},{x:Ue(a.x+1),y:a.y-1},{x:Ue(a.x-1),y:a.y-1},{x:Ue(a.x+1),y:a.y+1},{x:Ue(a.x-1),y:a.y+1}],h=[];for(const m of g){if(m.y<Qe||m.y>=Ye)continue;const P=t.crackCells.find(C=>C.x===m.x&&C.y===m.y&&C.color===a.color);if(P){!a.branchCrackIds.includes(P.id)&&!a.originCrackId.includes(P.id)&&h.push({...m,existingCrack:P});continue}t.crackCells.find(C=>C.x===m.x&&C.y===m.y)||t.grid[m.y][m.x]||h.push(m)}if(h.length===0)continue;const x=h[Math.floor(Math.random()*h.length)];if(x.existingCrack)x.existingCrack.originCrackId.push(a.id),a.branchCrackIds.push(x.existingCrack.id);else{if(Yc.countCracks(t.crackCells)>=Xg)continue;const P={id:Math.random().toString(36).substr(2,9),x:x.x,y:x.y,color:a.color,originCrackId:[a.id],branchCrackIds:[],lastGrowthCheck:l,crackBranchInterval:5e3+Math.random()*5e3,spawnTime:l};a.branchCrackIds.push(P.id),t.crackCells.push(P),t.goalMarks.push({id:P.id,x:P.x,y:P.y,color:P.color,spawnTime:P.spawnTime})}}}getDistanceFromRoot(t,n){if(t.originCrackId.length===0)return 0;let s=0,r=t.id;const o=new Set;for(;!o.has(r);){o.add(r);const l=n.find(c=>c.id===r);if(!l||l.originCrackId.length===0||(s++,r=l.originCrackId[0],s>20))break}return s}}const jf=780,Pf=8,Rf=500,qg=80,Zg=.03;class Kg{constructor(t,n={},s=[]){ze(this,"state");ze(this,"listeners",new Set);ze(this,"maxTime",bl);ze(this,"lockStartTime",null);ze(this,"lockResetCount",0);ze(this,"usePhysicsForFalling",!1);ze(this,"freezeTimer",!1);ze(this,"freezeFalling",!1);ze(this,"devOverrideNextGoop",null);ze(this,"lastGoalSpawnTime",0);ze(this,"lastComplicationCheckTime",0);ze(this,"isFastDropping",!1);ze(this,"wasFastDropping",!1);ze(this,"lightsOverflarePhase","none");ze(this,"lightsOverflareTime",0);ze(this,"lightsFlickerTime",0);ze(this,"lightsFlickerActive",!1);ze(this,"lightsGracePausedAt",null);ze(this,"initialTotalScore",0);ze(this,"powerUps",{});ze(this,"isSessionActive",!1);ze(this,"equippedActives",[]);ze(this,"crackManager");ze(this,"pendingTotalScore",null);this.initialTotalScore=t,this.powerUps=n,this.equippedActives=s;const r=dt(t).rank,l=mn(r).length+r;this.state={grid:of(r,n),tankRotation:0,activeGoop:null,storedGoop:null,nextGoop:null,shiftScore:0,gameOver:!1,isPaused:!1,canSwap:!0,level:1,cellsCleared:0,popStreak:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:bl,scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},gameStats:{startTime:0,totalBonusTime:0,maxGroupSize:0},floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:l,phase:Ze.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ae.LIGHTS]:0,[Ae.CONTROLS]:0,[Ae.LASER]:0},activeCharges:{},crackGoopPopped:0,colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.applyUpgrades(),this.crackManager=new Vg}randomThreshold(){return Math.floor(Math.random()*13)+12}hasAdjacentWild(t,n){for(const s of n.cells){const r=Ue(n.x+s.x),o=Math.floor(n.y+s.y);if(o<0||o>=Ye)continue;const l=[{x:Ue(r+1),y:o},{x:Ue(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}];for(const c of l)if(c.y>=0&&c.y<Ye){const a=t[c.y][c.x];if(a!=null&&a.isWild)return!0}}return!1}execute(t){t.execute(this)}applyUpgrades(){let t=bl;const n=this.powerUps.PRESSURE_CONTROL||0;if(n>0){const s=n*5*1e3;t+=s}this.maxTime=t,this.state.gameStats.startTime===0&&(this.state.shiftTime=this.maxTime)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emitChange(){this.listeners.forEach(t=>t())}syncTotalScore(t){this.state.gameOver?this.pendingTotalScore=t:(this.initialTotalScore=t,this.pendingTotalScore=null)}startRun(){const t=dt(this.initialTotalScore).rank,n=mn(t),s=n.length+t,r=n[Math.floor(Math.random()*n.length)],o=Math.random()<Ml,l=o?Uo:Wo,c=Math.floor(Math.random()*l.length),a=this.maybeApplyMirror({...l[c]}),u=!o&&t>=20&&Math.random()<.25;let f;if(u){const j=n.filter(x=>x!==r),g=j[Math.floor(Math.random()*j.length)],h={...a,color:r};f=kf(h,r,g)}else f={...a,color:r,isCorrupted:o||void 0};const d=Math.random()<Ml,p=d?Uo:Wo,y=Math.floor(Math.random()*p.length),S=this.maybeApplyMirror({...p[y]});this.state={...this.state,grid:of(t,this.powerUps),tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...S,color:n[Math.floor(Math.random()*n.length)],isCorrupted:d||void 0},nextGoop:f,canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:this.maxTime,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:s,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:Ze.TankScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ae.LIGHTS]:0,[Ae.CONTROLS]:0,[Ae.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0;const R={};this.equippedActives.forEach(j=>{R[j]=0}),this.state.activeCharges=R,this.spawnNewPiece(),me.emit(xe.GAME_START),me.emit(xe.MUSIC_START),this.emitChange()}resetSession(){this.state.gameOver=!1,this.isSessionActive=!1,this.state.phase=Ze.ConsoleScreen,this.state.shiftScore=0,this.state.activeGoop=null,this.pendingTotalScore!==null&&(this.initialTotalScore=this.pendingTotalScore,this.pendingTotalScore=null),this.emitChange()}abortRun(){!this.isSessionActive||this.state.gameOver||(this.state.shiftScore=0,this.state.goalsCleared=0,this.finalizeGame())}enterConsole(){this.state.phase=Ze.ConsoleScreen,this.emitChange()}enterPeriscope(){this.state.gameOver?this.startRun():(this.state.phase=Ze.TankScreen,this.isSessionActive||this.startRun()),this.emitChange()}resolveComplication(t){this.state.gameOver||(Ds.resolveComplication(this.state,t,this.initialTotalScore,this.powerUps),this.state.phase=Ze.ConsoleScreen,this.emitChange())}activateAbility(t){var s,r;if(this.state.gameOver)return;const n=En[t];if(!(!n||n.type!=="active"))switch(t){case"COOLDOWN_BOOSTER":{const o=this.powerUps[t]||1,c=[.25,.35,.5][Math.min(o,3)-1];Ds.extendAllCooldowns(this.state,c),console.log(`COOLDOWN_BOOSTER activated: +${c*100}% cooldown extension`);break}case"GOOP_DUMP":{const o=mn(dt(this.initialTotalScore).rank),l=((s=this.state.activeGoop)==null?void 0:s.definition.color)||o[Math.floor(Math.random()*o.length)],c=this.powerUps[t]||1,a=Math.min(c,3),u=18,f=600,d=[];for(let p=0;p<a;p++)for(let y=0;y<u;y++)d.push({id:Math.random().toString(36).substr(2,9),color:l,x:Math.floor(Math.random()*Se),y:-1,spawnDelay:p*f+y*qg});this.state.dumpQueue.push(...d),console.log(`GOOP_DUMP activated: ${a} wave(s), ${d.length} total ${l} pieces`);break}case"GOOP_COLORIZER":{const o=(r=this.state.activeGoop)==null?void 0:r.definition.color;if(!o){console.log("GOOP_COLORIZER: No active piece to match color");break}const l=this.powerUps[t]||1,a=[6,7,8][Math.min(l,3)-1];this.state.colorizerColor=o,this.state.colorizerRemaining=a,console.log(`GOOP_COLORIZER activated: next ${a} pieces will be ${o}`);break}case"CRACK_DOWN":{const l=1+(this.powerUps[t]||1)*2;this.state.crackDownRemaining=l;break}}}chargeActiveAbilities(t){Object.keys(this.state.activeCharges).forEach(n=>{const s=this.state.activeCharges[n]||0;this.state.activeCharges[n]=Math.min(100,s+t)})}checkComplications(t){const{spawned:n,newLastCheckTime:s}=Ds.checkComplications(this.state,this.initialTotalScore,this.lastComplicationCheckTime);this.lastComplicationCheckTime=s,n&&(Ds.spawnComplication(this.state,n),this.emitChange())}finalizeGame(){if(this.state.gameOver)return;this.state.gameOver=!0,this.isSessionActive=!1,this.state.phase=Ze.ConsoleScreen;let t=0;for(let l=0;l<Ye;l++)for(let c=0;c<Se;c++)this.state.grid[l][c]&&t++;const n=this.powerUps.AUTO_POPPER||0;if(n>0){const l=t,c=.2-n*.04;let a=0;for(let u=0;u<l;u++)Math.random()>c&&a++;t-=a,console.log(`AUTO_POPPER: ${a} of ${l} goop auto-popped (${t} remaining)`)}const s=t*50;this.state.gameStats.penalty=s,this.state.shiftScore=Math.max(0,this.state.shiftScore-s);const o=100*dt(this.initialTotalScore).rank;this.state.shiftScore=Math.max(o,this.state.shiftScore),this.state.complications=[],this.state.activeComplicationId=null,this.state.prePoppedGoopGroups.clear(),me.emit(xe.GAME_OVER),this.emitChange()}getPiecePoolByZone(t){const s=(this.maxTime-this.state.shiftTime)/1e3,r=this.maxTime/3/1e3,o=!t&&Math.random()<Ml;return s<r?{pool:o?Uo:Wo,isCorrupted:o}:s<r*2?{pool:o?za:Ba,isCorrupted:o}:{pool:o?Ya:Ga,isCorrupted:o}}maybeApplyMirror(t){return Math.random()>=sx||t.cells.every(s=>t.cells.some(r=>r.x===-s.x&&r.y===s.y))?t:{...t,cells:t.cells.map(s=>({x:-s.x,y:s.y}))}}spawnNewPiece(t,n,s){const r=n||this.state.grid,o=s!==void 0?s:this.state.tankRotation,l=this.initialTotalScore+this.state.shiftScore,c=dt(l).rank,a=mn(c);let u=t;if(!u&&this.state.nextGoop){u=this.state.nextGoop;let y=a[Math.floor(Math.random()*a.length)];const S=this.powerUps.CRACK_MATCHER||0,R=this.state.crackCells.length>0?this.state.crackCells:this.state.goalMarks;if(S>0&&R.length>0){const k=R.reduce((w,T)=>T.y>w.y?T:w),C=S*.25;Math.random()<C&&(y=k.color)}const{pool:j,isCorrupted:g}=this.getPiecePoolByZone(),h=Math.floor(Math.random()*j.length),x=this.maybeApplyMirror({...j[h]}),m=!g&&c>=20&&Math.random()<.25;let P;if(m){const k=a.filter(T=>T!==y),C=k[Math.floor(Math.random()*k.length)],w={...x,color:y};P=kf(w,y,C)}else P={...x,color:y,isCorrupted:g||void 0};if(!g&&c>=40&&Math.random()<.15){const{pool:k}=this.getPiecePoolByZone(!0),C=Math.floor(Math.random()*k.length);P={...this.maybeApplyMirror({...k[C]}),color:Ct.WILD,isWild:!0},console.log("Wild piece queued for next spawn")}this.state.nextGoop=P,this.devOverrideNextGoop&&(this.state.nextGoop={...this.devOverrideNextGoop})}const f=fy(u,c);this.state.colorizerRemaining>0&&this.state.colorizerColor&&(f.definition={...f.definition,color:this.state.colorizerColor,cellColors:void 0},this.state.colorizerRemaining--,this.state.nextGoop&&this.state.colorizerRemaining>0&&(this.state.nextGoop={...this.state.nextGoop,color:this.state.colorizerColor,cellColors:void 0}),console.log(`GOOP_COLORIZER: Spawned ${this.state.colorizerColor} piece (${this.state.colorizerRemaining} remaining)`),this.state.colorizerRemaining===0&&(this.state.colorizerColor=null));const d=Math.floor((at-1)/2),p=0;if(f.screenX=d,f.x=Gc(d,o),f.y=p,f.startSpawnY=p,f.state=Ln.FALLING,this.lockStartTime=null,this.lockResetCount=0,fs(r,f)){this.finalizeGame();return}this.state.activeGoop=f,this.state.canSwap=!0,this.emitChange()}updateScoreAndStats(t,n){this.state.shiftScore+=t,n&&(this.state.scoreBreakdown.base+=n.base||0,this.state.scoreBreakdown.height+=n.height||0,this.state.scoreBreakdown.offscreen+=n.offscreen||0,this.state.scoreBreakdown.adjacency+=n.adjacency||0,this.state.scoreBreakdown.speed+=n.speed||0)}handleGoals(t,n,s){Yc.handleGoals(this.state,t,n,s,()=>this.emitChange())}tickTimer(t){const n=this.powerUps.FOCUS_MODE||0,r=this.state.phase===Ze.COMPLICATION_MINIGAME&&n>0?1-n*.1:1;return!this.freezeTimer&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*r),this.state.shiftTime<=0)?(this.finalizeGame(),!1):!0}tickGoals(){const{crack:t,newLastSpawnTime:n}=Yc.trySpawnCrack(this.state,this.state.grid,this.initialTotalScore,this.state.shiftTime,this.maxTime,this.lastGoalSpawnTime);this.lastGoalSpawnTime=n,t&&(this.state.crackCells.push(t),this.state.goalMarks.push({id:t.id,x:t.x,y:t.y,color:t.color,spawnTime:t.spawnTime}))}tickHeat(t){const n=dt(this.initialTotalScore).rank,s=ds[Ae.CONTROLS];if(po(Ae.CONTROLS,n)&&this.state.controlsHeat>0){const r=Date.now(),o=this.state.rotationTimestamps.length>0?this.state.rotationTimestamps[this.state.rotationTimestamps.length-1]:0;if(r-o>s.idleThresholdMs){const c=this.powerUps.GEAR_LUBRICATION||0,a=s.dissipationBase*(1+s.dissipationUpgradeEffect*c);this.state.controlsHeat=Math.max(0,this.state.controlsHeat-a*t/1e3)}}}tickLightsBrightness(t){const n=dt(this.initialTotalScore).rank,s=ds[Ae.LIGHTS];if(!po(Ae.LIGHTS,n))return;if(this.state.phase!==Ze.TankScreen){this.state.lightsGraceStart!==null&&this.lightsGracePausedAt===null&&(this.lightsGracePausedAt=Date.now());return}if(this.lightsGracePausedAt!==null&&this.state.lightsGraceStart!==null){const a=Date.now()-this.lightsGracePausedAt;this.state.lightsGraceStart+=a,this.lightsGracePausedAt=null}if(this.state.complications.some(a=>a.type===Ae.LIGHTS)){this.state.lightsBrightness=s.failedBrightness;return}const o=Date.now();this.isFastDropping&&!this.wasFastDropping&&(this.state.lightsGraceStart=null,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),!this.isFastDropping&&this.wasFastDropping&&(this.state.lightsGraceStart=o,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),this.wasFastDropping=this.isFastDropping;const l=this.powerUps.CIRCUIT_STABILIZER||0,c=(s.graceBaseSec+s.gracePerLevel*l)*1e3;if(this.isFastDropping){if(this.state.lightsBrightness<100){const a=s.recoverRate*t/1e3;this.state.lightsBrightness=Math.min(100,this.state.lightsBrightness+a),this.state.lightsBrightness>=100&&(this.lightsOverflarePhase="rising",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="rising"){this.lightsOverflareTime+=t;const a=Math.min(1,this.lightsOverflareTime/s.overflareUpMs);this.state.lightsBrightness=100+(s.overflarePeak-100)*a,a>=1&&(this.lightsOverflarePhase="falling",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="falling"){this.lightsOverflareTime+=t;const a=Math.min(1,this.lightsOverflareTime/s.overflareDownMs);this.state.lightsBrightness=s.overflarePeak-(s.overflarePeak-100)*a,a>=1&&(this.lightsOverflarePhase="none",this.state.lightsBrightness=100)}}else{this.state.lightsGraceStart===null&&(this.state.lightsGraceStart=o);const a=o-this.state.lightsGraceStart;if(a<c){if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1,this.state.lightsBrightness=100}}else if(a>=c&&!this.state.lightsFlickered)this.state.lightsFlickered=!0,this.lightsFlickerActive=!0,this.lightsFlickerTime=0,me.emit(xe.LIGHTS_FLICKER,{});else if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1}else{const u=a-c,f=s.dimDurationSec*1e3,d=Math.min(1,u/f);this.state.lightsBrightness=100-(100-s.dimThreshold)*d,this.state.lightsBrightness<=s.dimThreshold&&(this.state.lightsBrightness=s.failedBrightness,Ds.spawnComplication(this.state,Ae.LIGHTS))}}}tickLooseGoop(t){if(this.state.looseGoop.length===0)return;const{active:n,landed:s}=xy(this.state.looseGoop,this.state.grid,t);if(s.length>0){me.emit(xe.PIECE_DROPPED);const r=this.state.grid.map(c=>[...c]);let o=!1;const l=[];if(s.forEach(c=>{if(c.y>=0&&c.y<Ye){const a=Math.floor(c.y),u=this.state.goalMarks.find(d=>d.x===c.x&&d.y===a);let f=!1;u&&u.color===c.data.color&&(l.push(u.id),f=!0),r[a][c.x]={...c.data,timestamp:Date.now(),isSealingGoop:f},o=!0}}),o&&(this.state.grid=Ei(r)),l.length>0){const c=new Set(l);l.forEach(a=>{const u=this.state.crackCells.find(f=>f.id===a);u&&(u.originCrackId.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.branchCrackIds=d.branchCrackIds.filter(p=>p!==a))}),u.branchCrackIds.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.originCrackId=d.originCrackId.filter(p=>p!==a))}))}),this.state.crackCells=this.state.crackCells.filter(a=>!c.has(a.id)),this.state.goalMarks=this.state.goalMarks.filter(a=>!c.has(a.id)),me.emit(xe.GOAL_CAPTURED,{count:l.length})}this.state.looseGoop=n}else this.state.looseGoop=n}tickDumpPieces(t){var l;const n=[];for(const c of this.state.dumpQueue)c.spawnDelay-=t,c.spawnDelay<=0?this.state.dumpPieces.push(c):n.push(c);if(this.state.dumpQueue=n,this.state.dumpPieces.length===0)return;const s=[],r=this.state.grid.map(c=>[...c]);let o=!1;for(const c of this.state.dumpPieces){c.y+=Zg*t;const a=Math.floor(c.y),u=c.x;let f=!1;(a>=Ye-1||a>=0&&((l=r[a+1])!=null&&l[u]))&&(f=!0),f&&a>=0&&a<Ye?(r[a][u]={id:c.id,goopGroupId:Math.random().toString(36).substr(2,9),timestamp:Date.now(),color:c.color,groupMinY:a,groupMaxY:a,groupSize:1},o=!0):f||s.push(c)}this.state.dumpPieces=s,o&&(this.state.grid=Ei(r))}tickActivePiece(t){if(!this.state.activeGoop||this.usePhysicsForFalling)return;const s=1+(this.powerUps.DENSE_GOOP||0)*.125,r=jf/s,o=this.isFastDropping?r/Pf:r,l=t/o,c=this.state.activeGoop.y+l,a=Gc(this.state.activeGoop.screenX,this.state.tankRotation),u={...this.state.activeGoop,y:c,x:a};if(fs(this.state.grid,u,this.state.tankRotation)){this.lockStartTime===null&&(this.lockStartTime=Date.now());const f=Date.now()-this.lockStartTime,d=this.isFastDropping?50:Rf;(f>d||this.lockResetCount>=10)&&this.lockActivePiece()}else this.state.activeGoop=u,this.lockStartTime=null}lockActivePiece(){if(!this.state.activeGoop||this.state.gameOver)return;const t=rp(this.state.grid,this.state.activeGoop,this.state.tankRotation),n={...this.state.activeGoop,y:t};let{grid:s,consumedGoals:r,destroyedGoals:o}=py(this.state.grid,n,this.state.goalMarks);(n.definition.isWild||this.hasAdjacentWild(s,n))&&(s=hy(s,n)),(r.length>0||o.length>0)&&this.handleGoals(r,o,n),this.state.complications.some(u=>u.type===Ae.LASER)||(this.state.laserCharge=Math.min(100,this.state.laserCharge+10)),me.emit(xe.PIECE_DROPPED);const{grid:c,looseGoop:a}=ip(s);a.length>0&&this.state.looseGoop.push(...a),this.state.grid=c,this.spawnNewPiece(void 0,c),this.state.popStreak=0,this.isFastDropping=!1}tickActiveCharges(t){Object.keys(this.state.activeCharges).length===0&&this.equippedActives.length>0&&this.equippedActives.forEach(s=>{this.state.activeCharges[s]=this.state.activeCharges[s]??0});const n={COOLDOWN_BOOSTER:100/20,GOOP_DUMP:100/15,GOOP_COLORIZER:100/25,CRACK_DOWN:100/30};Object.keys(this.state.activeCharges).forEach(s=>{const r=this.state.activeCharges[s]||0;if(r<100){const o=n[s]||3,l=t/1e3*o,c=Math.min(100,r+l);this.state.activeCharges[s]=c}})}getFallSpeed(){const n=1+(this.powerUps.DENSE_GOOP||0)*.125,s=30/jf*1e3*n;return this.isFastDropping?s*Pf:s}syncActivePieceFromPhysics(t,n){if(!(!this.state.activeGoop||this.state.gameOver))if(this.state.activeGoop.y=n,t){this.lockStartTime===null&&(this.lockStartTime=Date.now());const s=Date.now()-this.lockStartTime,r=this.isFastDropping?50:Rf;(s>r||this.lockResetCount>=10)&&this.lockActivePiece()}else this.lockStartTime=null}tick(t){!this.isSessionActive||this.state.gameOver||this.state.isPaused||this.tickTimer(t)&&(this.tickGoals(),this.crackManager.tickGrowth(this.state,this.initialTotalScore,this.powerUps,this.maxTime),this.checkComplications(t),this.tickHeat(t),this.tickLightsBrightness(t),this.tickLooseGoop(t),this.tickDumpPieces(t),this.tickActivePiece(t),this.tickActiveCharges(t),this.emitChange())}}const bf=ct?25:16,Qg=(e,t,n,s=[],r)=>{const o=v.useRef(null);o.current||(o.current=new Kg(e,t,s));const l=o.current;if(l.equippedActives.length!==s.length||!l.equippedActives.every((p,y)=>p===s[y])){l.equippedActives=s;const p=l.state.activeCharges||{},y={};s.forEach(S=>{y[S]=p[S]??0}),l.state.activeCharges=y}const[,a]=v.useReducer(p=>p+1,0),u=v.useRef(0),f=v.useRef(0),d=v.useRef(0);return v.useEffect(()=>{l.syncTotalScore(e)},[e,l]),v.useEffect(()=>l.subscribe(()=>{if(l.state.gameOver){a();return}const y=performance.now();y-f.current>=bf&&(f.current=y,a())}),[l]),v.useEffect(()=>{const p=y=>{u.current||(u.current=y);const S=y-u.current;if(ct&&S<bf){d.current=requestAnimationFrame(p);return}u.current=y,l.tick(S),r&&r(S/1e3,l),d.current=requestAnimationFrame(p)};return d.current=requestAnimationFrame(p),()=>cancelAnimationFrame(d.current)},[l]),{engine:l,gameState:l.state}};function _i(e,t){let n=t-e;return n>Lo/2&&(n-=Lo),n<-Lo/2&&(n+=Lo),n}function Jg(e,t,n){const s=Math.min(t,.033);for(const r of e){const o=n.damping,l=r.isLocked?n.gravity:n.fallingGravity;for(const c of r.vertices){const a=(c.pos.x-c.oldPos.x)*o,u=(c.pos.y-c.oldPos.y)*o;c.oldPos.x=c.pos.x,c.oldPos.y=c.pos.y,c.pos.x+=a,c.pos.y+=u+l*s*s}for(const c of r.innerVertices){const a=(c.pos.x-c.oldPos.x)*o,u=(c.pos.y-c.oldPos.y)*o;c.oldPos.x=c.pos.x,c.oldPos.y=c.pos.y,c.pos.x+=a,c.pos.y+=u+l*s*s}}}function em(e,t){for(const n of e){const s=n.isLocked?t.returnSpeed:t.fallingReturnSpeed,r=s*s,o=n.isLocked?t.viscosity:t.fallingViscosity,l=Math.max(0,1-o),c=o>0?.03/Math.max(1,o):0,a=n.isLocked?t.homeStiffness:t.fallingHomeStiffness;for(const u of n.vertices){const f=ff(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,S=p-u.pos.y,R=y*a*r,j=S*a*r;u.pos.x+=R*l,u.pos.y+=j*l,o>0&&(u.oldPos.x-=R*c,u.oldPos.y-=j*c)}for(const u of n.innerVertices){const f=ff(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,S=p-u.pos.y,R=y*t.innerHomeStiffness*r,j=S*t.innerHomeStiffness*r;u.pos.x+=R*l,u.pos.y+=j*l,o>0&&(u.oldPos.x-=R*c,u.oldPos.y-=j*c)}}}function Mf(e,t,n){const s=e[t.a],r=e[t.b],o=_i(s.pos.x,r.pos.x),l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)return;const u=(c-t.restLength)/c*n*.5;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}function tm(e,t){for(let n=0;n<t.iterations;n++)for(const s of e){for(const r of s.ringsprings)Mf(s.vertices,r,t.stiffness*.01);for(const r of s.crossSprings)Mf(s.vertices,r,t.stiffness*.005)}}function nm(e,t){for(const n of e){if(!n.isLocked)continue;const s=n.targetX,r=n.targetY,o=t.pressure*.002;for(const l of n.vertices){const c=l.pos.x-s,a=l.pos.y-r,u=Math.sqrt(c*c+a*a),f=Math.sqrt(l.homeOffset.x*l.homeOffset.x+l.homeOffset.y*l.homeOffset.y);if(u>1e-4&&f>1e-4){const p=(f-u)*o;l.pos.x+=c/u*p,l.pos.y+=a/u*p}}}}function sm(e,t){for(const r of e){for(const o of r.vertices){if(o.pos.y<t.minY+2){o.pos.y=t.minY+2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}if(o.pos.y>t.maxY-2){o.pos.y=t.maxY-2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}}for(const o of r.innerVertices)o.pos.y<t.minY+2&&(o.pos.y=t.minY+2),o.pos.y>t.maxY-2&&(o.pos.y=t.maxY-2)}}function om(e,t,n,s){Jg(e,t,n),em(e,n),tm(e,n),nm(e,n),sm(e,s)}function rm(e,t){const n=e.vertices,s=n.length;for(let r=0;r<s;r++){const o=n[(r-1+s)%s],l=n[r],c=n[(r+1)%s],a=l.pos.x-o.pos.x,u=l.pos.y-o.pos.y,f=c.pos.x-l.pos.x,d=c.pos.y-l.pos.y,p=Math.sqrt(a*a+u*u),y=Math.sqrt(f*f+d*d);if(p<1e-4||y<1e-4)continue;const S=u/p,R=-a/p,j=d/y,g=-f/y;let h=S+j,x=R+g;const m=Math.sqrt(h*h+x*x);m<1e-4||(h/=m,x/=m,n[r].oldPos.x-=h*t,n[r].oldPos.y-=x*t)}}function im(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertexA],u=c.vertices[o.vertexB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertexA}-${o.blobB}-${o.vertexB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=_i(a.targetX,c.targetX),f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++){const y=c.vertices[p],S=n.attractionRadius*y.attractionRadius;for(let R=0;R<a.vertices.length;R++){const j=a.vertices[R],g=n.attractionRadius*j.attractionRadius,h=(S+g)/2,x=_i(y.pos.x,j.pos.x),m=j.pos.y-y.pos.y,P=Math.sqrt(x*x+m*m),k=`${o}-${p}-${l}-${R}`;r.has(k)||P>h||(s.push({blobA:o,blobB:l,vertexA:p,vertexB:R,restLength:n.attractionRestLength}),r.add(k))}}}return s}function lm(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertexA],u=c.vertices[o.vertexB];if(!a||!u)continue;const f=_i(a.pos.x,u.pos.x),d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=Math.max(0,Math.min(1,1-p/n.goopiness)),S=s+y*(r-s),j=(p-o.restLength)*S,g=f/p*j,h=d/p*j;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function cm(e,t=30){for(let o=0;o<3;o++)for(let l=0;l<e.length;l++)for(let c=l+1;c<e.length;c++){const a=e[l],u=e[c];if(a.color===u.color)continue;const f=a.isFalling||a.isLoose,d=u.isFalling||u.isLoose;if(!f&&!d)continue;const p=a.targetX-u.targetX,y=a.targetY-u.targetY;if(!(Math.sqrt(p*p+y*y)>t*4))for(const R of a.vertices)for(const j of u.vertices){const g=j.pos.x-R.pos.x,h=j.pos.y-R.pos.y,x=Math.sqrt(g*g+h*h);if(x<2.5&&x>.01){const m=2.5-x,P=g/x,k=h/x,C=m*.8;R.pos.x-=P*C*.5,R.pos.y-=k*C*.5,j.pos.x+=P*C*.5,j.pos.y+=k*C*.5,R.oldPos.x-=P*C*.3,R.oldPos.y-=k*C*.3,j.oldPos.x+=P*C*.3,j.oldPos.y+=k*C*.3}}}}function am(e,t,n,s,r,o=0){var d;if(e.isLocked||e.isLoose)return;let l=!0;for(const p of e.gridCells){const y=p.y+1;if(y>=r){l=!1;break}const S=Math.floor(y)+Qe;let R=Math.floor(p.x)+o;for(;R<0;)R+=Se;for(;R>=Se;)R-=Se;const j=(d=s[S])==null?void 0:d[R];if(j&&j.goopGroupId!==void 0){l=!1;break}}if(e.isColliding=!l,l){const p=n*t;for(e.visualOffsetY+=p;e.visualOffsetY>=Rt;){for(const y of e.gridCells)y.y+=1;e.visualOffsetY-=Rt}}let c=0,a=0;for(const p of e.gridCells)c+=p.x,a+=p.y;const u=c/e.gridCells.length,f=a/e.gridCells.length;e.targetX=vn.x+(u+.5)*Rt,e.targetY=vn.y+(f+.5)*Rt+e.visualOffsetY}const um=2.4;function fm(){return{minX:vn.x,maxX:vn.x+12*Rt,minY:vn.y,maxY:vn.y+16*Rt}}function dm(e){const{enabled:t,params:n,bounds:s}=e,r=v.useRef([]),o=v.useRef([]),l=v.useRef([]),c=v.useRef(0),a=v.useRef({...Ai,...n}),u=v.useRef(s??fm());v.useEffect(()=>{n&&(a.current={...Ai,...n})},[n==null?void 0:n.damping,n==null?void 0:n.stiffness,n==null?void 0:n.pressure,n==null?void 0:n.iterations,n==null?void 0:n.homeStiffness,n==null?void 0:n.innerHomeStiffness,n==null?void 0:n.returnSpeed,n==null?void 0:n.viscosity,n==null?void 0:n.gravity,n==null?void 0:n.fallingHomeStiffness,n==null?void 0:n.fallingReturnSpeed,n==null?void 0:n.fallingViscosity,n==null?void 0:n.fallingGravity,n==null?void 0:n.attractionRadius,n==null?void 0:n.attractionRestLength,n==null?void 0:n.attractionStiffness,n==null?void 0:n.goopiness,n==null?void 0:n.tendrilEndRadius,n==null?void 0:n.tendrilSkinniness,n==null?void 0:n.wallThickness,n==null?void 0:n.fallingGoopiness,n==null?void 0:n.fallingTendrilEndRadius,n==null?void 0:n.fallingTendrilSkinniness,n==null?void 0:n.dropletCount,n==null?void 0:n.dropletSpeed,n==null?void 0:n.dropletLifetime,n==null?void 0:n.dropletSize,n==null?void 0:n.dropletGravity]),v.useEffect(()=>{s&&(u.current=s)},[s]);const f=v.useCallback((m,P,k,C,w=0)=>{const T=Fy(m,P,k,C,w);return r.current=[...r.current,T],T},[]),d=v.useCallback(m=>{r.current=r.current.filter(P=>P.id!==m)},[]),p=v.useCallback((m,P,k)=>{const C=r.current.find(w=>w.id===m);C&&(C.targetX=P,C.targetY=k)},[]),y=v.useCallback(m=>{const P=r.current.find(k=>k.id===m);P&&(P.isLocked=!0,P.isFalling=!1,P.isLoose=!1,P.fillAmount=0)},[]),S=v.useCallback((m,P)=>{if(!t)return;const k=r.current,C=a.current,w=k.length>0;if(P&&w)for(const O of k)O.isFalling&&!O.isLocked&&am(O,m,P.fallSpeed,P.grid,ln,P.tankRotation);if(w){om(k,m,C,u.current);for(const O of k)if(O.isLocked&&O.fillAmount<1){const K=1/(O.gridCells.length*fo/1e3);O.fillAmount=Math.min(1,O.fillAmount+K*m);const ee=O.fillAmount>=1;ee&&!O.wasFullLastFrame&&rm(O,um),O.wasFullLastFrame=ee}o.current=im(k,o.current,C),lm(k,o.current,C),cm(k,Rt)}const T=C.dropletGravity,L=u.current;for(const O of l.current)O.vel.y+=T*m,O.pos.x+=O.vel.x*m,O.pos.y+=O.vel.y*m,(O.pos.x+O.radius<L.minX||O.pos.x-O.radius>L.maxX)&&(O.lifetime=0),O.pos.y+O.radius<L.minY&&(O.lifetime=0),O.pos.y+O.radius>L.maxY&&(O.pos.y=L.maxY-O.radius,O.vel.y*=-.3),O.lifetime-=m,O.opacity=Math.max(0,O.lifetime/O.maxLifetime),O.radius*=.995;l.current=l.current.filter(O=>O.lifetime>0&&O.opacity>.01)},[t]),R=v.useCallback(()=>{r.current=[],o.current=[],l.current=[]},[]),j=v.useCallback(m=>{const P=a.current,k=m.targetX,C=m.targetY;for(let w=0;w<P.dropletCount;w++){const T=Math.floor(Math.random()*m.vertices.length),L=m.vertices[T],O=L.pos.x-k,X=L.pos.y-C,K=Math.atan2(X,O)+(Math.random()-.5)*.8,ee=P.dropletSpeed*(.5+Math.random()*.8),I={id:`droplet-${c.current++}`,pos:{x:L.pos.x,y:L.pos.y},vel:{x:Math.cos(K)*ee,y:Math.sin(K)*ee-50},radius:P.dropletSize*(.5+Math.random()*.7),color:m.color,opacity:1,lifetime:P.dropletLifetime*(.7+Math.random()*.6),maxLifetime:P.dropletLifetime};l.current.push(I)}},[]),g=v.useCallback(m=>r.current.find(P=>P.id===m),[]),h=v.useCallback(m=>{for(const P of r.current){const C=-(m-P.createdAtRotation)*Rt;for(const w of P.vertices)w.pos.x+=C,w.oldPos.x+=C;for(const w of P.innerVertices)w.pos.x+=C,w.oldPos.x+=C;P.targetX+=C,P.createdAtRotation=m}},[]),x=v.useCallback(()=>{var C;const m=r.current.find(w=>w.isFalling&&!w.isLocked);if(!m)return null;let P=((C=m.gridCells[0])==null?void 0:C.y)??0;for(const w of m.gridCells)w.y<P&&(P=w.y);return{gridY:P+Qe,isColliding:m.isColliding}},[]);return{blobs:r.current,attractionSprings:o.current,params:a.current,createBlob:f,removeBlob:d,updateBlobTarget:p,lockBlob:y,step:S,clearBlobs:R,getBlob:g,shiftBlobsForRotation:h,droplets:l.current,createDropletsForPop:j,getActivePieceState:x}}const pm=({onExit:e,onRunComplete:t,initialTotalScore:n,powerUps:s={},scraps:r,settings:o,onOpenSettings:l,onOpenHelp:c,onOpenUpgrades:a,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,equippedActives:p=[],onToggleEquip:y})=>{const[S,R]=v.useState(!1),[j,g]=v.useState(!1),[h,x]=v.useState(Ct.RED),[m,P]=v.useState(!0),[k,C]=v.useState({...Ai}),[w,T]=v.useState(.2),[L,O]=v.useState(!1),[X,K]=v.useState(5),[ee,I]=v.useState(40),[J,ae]=v.useState(-11),[W,Q]=v.useState(5),[Y,re]=v.useState(40),[te,q]=v.useState(-11),pe=dm({enabled:!ct,params:k}),we=v.useCallback((M,$)=>{if($.state.gameOver||!$.isSessionActive)return;const V={grid:$.state.grid,tankRotation:$.state.tankRotation,fallSpeed:$.freezeFalling?0:$.getFallSpeed()};pe.step(M,V);const U=$.state.activeGoop;if(U){const le=`active-${U.spawnTimestamp}`,b=pe.getBlob(le);if(b&&b.isFalling&&!b.isLocked){const _=pe.getActivePieceState();_&&$.syncActivePieceFromPhysics(_.isColliding,_.gridY)}}},[pe]),{engine:E,gameState:B}=Qg(n,s,t,p,we);v.useEffect(()=>{E.usePhysicsForFalling=!ct},[E]);const ve=v.useCallback(M=>{E.execute(new yg(M))},[E]),ie=v.useRef(new Set),ye=v.useRef(0),se=v.useRef(0),ge=v.useRef(null),oe=v.useRef(!1),ke=v.useRef(null),he=v.useRef(null),Ee=250,$e=1500-((s==null?void 0:s.GOOP_SWAP)||0)*250,Fe=B.complications.find(M=>M.type===Ae.CONTROLS),Oe=v.useRef(0);v.useEffect(()=>{Fe||(Oe.current=0)},[Fe==null?void 0:Fe.id]);const Ie=o.invertRotation?-1:1;v.useEffect(()=>{if(B.gameOver&&B.phase===Ze.ConsoleScreen){const M=B.goalsCleared>=B.goalsTarget;t({score:B.shiftScore,won:M})}},[B.gameOver]);const N=v.useCallback(()=>{oe.current=!1,ge.current&&(cancelAnimationFrame(ge.current),ge.current=null)},[]),G=v.useCallback(()=>{he.current&&(clearInterval(he.current),he.current=null),ke.current=null,me.emit(xe.INPUT_SWAP_HOLD,{progress:-1})},[]),Ce=v.useCallback(()=>{he.current||(ke.current=Date.now(),me.emit(xe.INPUT_SWAP_HOLD,{progress:0}),he.current=window.setInterval(()=>{if(!ke.current)return;const M=Date.now()-ke.current;if(M<Ee)return;const $=M-Ee,V=Math.min(100,$/$e*100);me.emit(xe.INPUT_SWAP_HOLD,{progress:V}),V>=100&&(me.emit(xe.INPUT_SWAP),G())},16))},[G]),D=v.useCallback(()=>{if(oe.current)return;oe.current=!0;const M=()=>{if(!oe.current)return;const $=Date.now(),V=Fe?200:100;if($>=se.current){let le=0;(ie.current.has("ArrowLeft")||ie.current.has("KeyA"))&&(le=1*Ie),(ie.current.has("ArrowRight")||ie.current.has("KeyD"))&&(le=-1*Ie),ye.current!==0&&(le=ye.current*Ie),le!==0&&(Fe?(Oe.current++,Oe.current>=2&&(E.execute(new Lr(le)),Oe.current=0)):E.execute(new Lr(le)),se.current=$+V)}(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||ye.current!==0)&&B.phase===Ze.TankScreen&&!E.state.isPaused&&E.isSessionActive?ge.current=requestAnimationFrame(M):N()};ge.current=requestAnimationFrame(M)},[E,B.phase,N,Ie,Fe]);v.useEffect(()=>{const M=U=>{if(!U.repeat){if(ie.current.add(U.code),U.key==="`"){U.preventDefault(),R(le=>!le);return}if(U.key==="~"){U.preventDefault(),g(le=>!le);return}if(U.key==="Backspace"&&B.phase===Ze.TankScreen&&E.execute(new $s(Ze.ConsoleScreen)),B.gameOver){U.key==="Enter"&&E.resetSession();return}if(B.phase===Ze.TankScreen&&!E.state.isPaused&&E.isSessionActive)switch(U.code){case"ArrowLeft":case"KeyA":E.execute(new Lr(1*Ie)),se.current=Date.now()+250,D();break;case"ArrowRight":case"KeyD":E.execute(new Lr(-1*Ie)),se.current=Date.now()+250,D();break;case"KeyQ":E.execute(new Ro(!1));break;case"KeyE":E.execute(new Ro(!0));break;case"KeyS":E.execute(new Tl(!0));break;case"Space":E.execute(new $s(Ze.ConsoleScreen));break;case"KeyW":E.execute(new $s(Ze.ConsoleScreen));break;case"KeyR":Ce();break}}},$=U=>{if(ie.current.delete(U.code),B.phase===Ze.TankScreen)switch(U.code){case"KeyS":E.execute(new Tl(!1));break;case"KeyR":G();break;case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":!(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD"))&&ye.current===0&&N();break}},V=U=>{B.phase===Ze.TankScreen&&!E.state.isPaused&&!B.gameOver&&E.isSessionActive&&(U.deltaY>0?E.execute(new Ro(!0)):E.execute(new Ro(!1)))};return window.addEventListener("keydown",M),window.addEventListener("keyup",$),window.addEventListener("wheel",V),()=>{window.removeEventListener("keydown",M),window.removeEventListener("keyup",$),window.removeEventListener("wheel",V),N(),G()}},[E,B.phase,B.gameOver,D,N,Ce,G,Ie]),v.useEffect(()=>{const M=me.on(xe.INPUT_ROTATE,_=>{E.execute(new Ro((_==null?void 0:_.clockwise)??!0))}),$=me.on(xe.INPUT_DRAG,_=>{ye.current=(_==null?void 0:_.direction)??0,(_==null?void 0:_.direction)!==0?D():ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||N()}),V=me.on(xe.INPUT_SWIPE_UP,()=>{E.execute(new $s(Ze.ConsoleScreen))}),U=me.on(xe.INPUT_FAST_DROP,_=>{E.execute(new Tl((_==null?void 0:_.active)??!1))}),le=me.on(xe.INPUT_SWAP,()=>{E.execute(new dg)}),b=me.on(xe.INPUT_BLOCK_TAP,_=>{_&&E.execute(new pg(_.x,_.y))});return()=>{M(),$(),V(),U(),le(),b()}},[E,D,N]);const F=dt(n).rank;return i.jsxs("div",{className:"w-full h-full relative touch-none bg-slate-950 overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0",children:i.jsx(By,{state:B,rank:F,maxTime:E.maxTime,lightsBrightness:B.phase===Ze.TankScreen?B.lightsBrightness:100,laserCharge:B.laserCharge,controlsHeat:B.controlsHeat,complicationCooldowns:B.complicationCooldowns,equippedActives:p,activeCharges:B.activeCharges,onActivateAbility:ve,powerUps:s,storedGoop:E.state.storedGoop,nextGoop:E.state.nextGoop,softBodyPhysics:pe,normalGoopOpacity:w,showVertexDebug:L,gooStdDev:X,gooAlphaMul:ee,gooAlphaOff:J,fallingGooStdDev:W,fallingGooAlphaMul:Y,fallingGooAlphaOff:te})}),i.jsx("div",{className:`absolute inset-0 z-50 transition-opacity duration-500 ${B.phase===Ze.ConsoleScreen?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:i.jsx(Hg,{engine:E,state:B,careerScore:n,scraps:r,powerUps:s,onOpenSettings:l,onOpenHelp:c,onOpenUpgrades:a,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,onDismissGameOver:()=>E.resetSession(),equippedActives:p,onToggleEquip:y})}),i.jsx("div",{className:`absolute inset-0 z-20 pointer-events-none transition-opacity duration-500 ${B.phase===Ze.TankScreen?"opacity-100":"opacity-0"}`,children:i.jsx(og,{state:B,onRestart:()=>E.execute(new hg),onExit:()=>{me.emit(xe.GAME_EXITED),E.execute(new $s(Ze.ConsoleScreen))},initialTotalScore:E.initialTotalScore,maxTime:E.maxTime})}),S&&!ct&&i.jsxs("div",{className:"absolute top-2 right-2 z-[100] bg-black/90 text-white p-3 rounded-lg text-xs font-mono pointer-events-auto overflow-y-auto",style:{minWidth:460,maxHeight:"95vh"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"font-bold",children:"Physics Debug"}),i.jsx("button",{onClick:()=>R(!1),className:"text-gray-400 hover:text-white",children:""})]}),i.jsxs("div",{className:"space-y-2 mb-2",children:[i.jsx("div",{className:"text-gray-400 text-[10px] uppercase tracking-wider",children:"Shared"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Damping: ",k.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:k.damping,onChange:M=>C($=>({...$,damping:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Stiffness: ",k.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:k.stiffness,onChange:M=>C($=>({...$,stiffness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Pressure: ",k.pressure]}),i.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:k.pressure,onChange:M=>C($=>({...$,pressure:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Inner Home Stiffness: ",k.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:k.innerHomeStiffness,onChange:M=>C($=>({...$,innerHomeStiffness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Iterations: ",k.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:k.iterations,onChange:M=>C($=>({...$,iterations:Number(M.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-600",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-yellow-400 text-[10px] uppercase tracking-wider",children:"Locked"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Home Stiffness: ",k.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.homeStiffness,onChange:M=>C($=>({...$,homeStiffness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Return Speed: ",k.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.returnSpeed,onChange:M=>C($=>({...$,returnSpeed:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Viscosity: ",k.viscosity.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:k.viscosity,onChange:M=>C($=>({...$,viscosity:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Gravity: ",k.gravity]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:k.gravity,onChange:M=>C($=>({...$,gravity:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Goo Filter"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Blur: ",X]}),i.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:X,onChange:M=>K(Number(M.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Mul: ",ee]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:ee,onChange:M=>I(Number(M.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Off: ",J]}),i.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:J,onChange:M=>ae(Number(M.target.value)),className:"w-full"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-cyan-400 text-[10px] uppercase tracking-wider",children:"Falling"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Home Stiffness: ",k.fallingHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.fallingHomeStiffness,onChange:M=>C($=>({...$,fallingHomeStiffness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Return Speed: ",k.fallingReturnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.fallingReturnSpeed,onChange:M=>C($=>({...$,fallingReturnSpeed:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Viscosity: ",k.fallingViscosity.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:k.fallingViscosity,onChange:M=>C($=>({...$,fallingViscosity:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Gravity: ",k.fallingGravity]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:k.fallingGravity,onChange:M=>C($=>({...$,fallingGravity:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Tendrils"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Goopiness: ",k.fallingGoopiness]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:k.fallingGoopiness,onChange:M=>C($=>({...$,fallingGoopiness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["End Radius: ",k.fallingTendrilEndRadius]}),i.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:k.fallingTendrilEndRadius,onChange:M=>C($=>({...$,fallingTendrilEndRadius:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Skinniness: ",k.fallingTendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.fallingTendrilSkinniness,onChange:M=>C($=>({...$,fallingTendrilSkinniness:Number(M.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[i.jsx("div",{className:"text-gray-500 text-[10px]",children:"Goo Filter"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Blur: ",W]}),i.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:W,onChange:M=>Q(Number(M.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Mul: ",Y]}),i.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:Y,onChange:M=>re(Number(M.target.value)),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Alpha Off: ",te]}),i.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:te,onChange:M=>q(Number(M.target.value)),className:"w-full"})]})]})]})]}),i.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600 mt-2",children:[i.jsxs("div",{className:"pt-0",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Attraction"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Radius: ",k.attractionRadius]}),i.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:k.attractionRadius,onChange:M=>C($=>({...$,attractionRadius:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Rest Length: ",k.attractionRestLength]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:k.attractionRestLength,onChange:M=>C($=>({...$,attractionRestLength:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Stiffness: ",k.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",value:k.attractionStiffness,onChange:M=>C($=>({...$,attractionStiffness:Number(M.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Rendering"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Goopiness: ",k.goopiness]}),i.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:k.goopiness,onChange:M=>C($=>({...$,goopiness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Tendril End Radius: ",k.tendrilEndRadius]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:k.tendrilEndRadius,onChange:M=>C($=>({...$,tendrilEndRadius:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Tendril Skinniness: ",k.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.tendrilSkinniness,onChange:M=>C($=>({...$,tendrilSkinniness:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Wall Thickness: ",k.wallThickness]}),i.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:k.wallThickness,onChange:M=>C($=>({...$,wallThickness:Number(M.target.value)})),className:"w-full"})]})]}),i.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[i.jsx("div",{className:"text-gray-400 mb-1",children:"Droplets (Pop Effect)"}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Count: ",k.dropletCount]}),i.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:k.dropletCount,onChange:M=>C($=>({...$,dropletCount:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Speed: ",k.dropletSpeed]}),i.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:k.dropletSpeed,onChange:M=>C($=>({...$,dropletSpeed:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Lifetime: ",k.dropletLifetime,"s"]}),i.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:k.dropletLifetime,onChange:M=>C($=>({...$,dropletLifetime:Number(M.target.value)})),className:"w-full"})]}),i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Size: ",k.dropletSize]}),i.jsx("input",{type:"range",min:"2",max:"30",step:"1",value:k.dropletSize,onChange:M=>C($=>({...$,dropletSize:Number(M.target.value)})),className:"w-full"})]})]}),i.jsx("div",{className:"pt-2 border-t border-gray-600",children:i.jsxs("label",{className:"block",children:[i.jsxs("span",{children:["Normal Goop Opacity: ",w.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:w,onChange:M=>T(Number(M.target.value)),className:"w-full"})]})}),i.jsxs("div",{className:"pt-2 border-t border-gray-600 text-gray-400",children:[i.jsxs("div",{children:["Blobs: ",pe.blobs.length]}),i.jsxs("div",{className:"flex gap-1 mt-1",children:[i.jsx("button",{onClick:()=>{C({...Ai}),T(.25),O(!1),K(8),I(24),ae(-13),Q(8),re(24),q(-13)},className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs",children:"Reset to Defaults"}),i.jsx("button",{onClick:()=>{const M={...k,gooStdDev:X,gooAlphaMul:ee,gooAlphaOff:J,fallingGooStdDev:W,fallingGooAlphaMul:Y,fallingGooAlphaOff:te,normalGoopOpacity:w};console.log("=== DEBUG PARAMS SNAPSHOT ==="),console.log(JSON.stringify(M,null,2)),console.log("============================")},className:"px-2 py-1 bg-blue-700 hover:bg-blue-600 rounded text-xs",children:"Save"})]})]})]})]}),j&&!ct&&(()=>{var A,z;const M=dt(n).rank,$=mn(M),V=[{key:"RED",hex:Ct.RED},{key:"BLUE",hex:Ct.BLUE},{key:"GREEN",hex:Ct.GREEN},{key:"YELLOW",hex:Ct.YELLOW},{key:"PURPLE",hex:Ct.PURPLE},{key:"WHITE",hex:Ct.WHITE},{key:"BLACK",hex:Ct.BLACK}],U=36,le=7,b=(H,Z)=>{const ne=Math.min(...H.cells.map(_e=>_e.x)),ue=Math.max(...H.cells.map(_e=>_e.x)),de=Math.min(...H.cells.map(_e=>_e.y)),Te=Math.max(...H.cells.map(_e=>_e.y)),be=ue-ne+1,Le=Te-de+1,Ne=(U-be*le)/2,je=(U-Le*le)/2;return i.jsx("div",{onClick:()=>{const _e={...H,color:h};E.state.nextGoop=_e,m||(E.devOverrideNextGoop=_e),E.emitChange()},style:{cursor:"pointer",borderRadius:4,border:"1px solid #334155",background:"rgba(30, 41, 59, 0.5)"},title:H.type,onMouseEnter:_e=>_e.currentTarget.style.background="rgba(51, 65, 85, 0.8)",onMouseLeave:_e=>_e.currentTarget.style.background="rgba(30, 41, 59, 0.5)",children:i.jsx("svg",{width:U,height:U,children:H.cells.map((_e,We)=>i.jsx("rect",{x:Ne+(_e.x-ne)*le,y:je+(_e.y-de)*le,width:le-1,height:le-1,fill:h,rx:1},We))})},Z)},_=[{label:"TETRA",normal:Wo,corrupted:Uo},{label:"PENTA",normal:Ba,corrupted:za},{label:"HEXA",normal:Ga,corrupted:Ya}];return i.jsxs("div",{className:"absolute top-2 left-2 z-[100] bg-black/90 text-white p-3 rounded-lg text-xs font-mono pointer-events-auto overflow-y-auto",style:{minWidth:280,maxHeight:"95vh"},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"font-bold",children:"Piece Picker"}),i.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-white px-1",children:""})]}),i.jsxs("div",{className:"flex gap-3 mb-2 pb-2 border-b border-gray-700",children:[i.jsxs("div",{className:"text-gray-400",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-wider",children:"Next:"})," ",i.jsx("span",{className:"text-gray-200",children:((A=B.nextGoop)==null?void 0:A.type)??""})]}),i.jsxs("div",{className:"text-gray-400",children:[i.jsx("span",{className:"text-[10px] uppercase tracking-wider",children:"Hold:"})," ",i.jsx("span",{className:"text-gray-200",children:((z=B.storedGoop)==null?void 0:z.type)??""})]})]}),i.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700",children:[i.jsx("div",{className:"text-[10px] uppercase tracking-wider text-gray-400 mb-1",children:"Color"}),i.jsx("div",{className:"flex gap-1.5",children:V.map(H=>{const Z=$.includes(H.hex),ne=h===H.hex;return i.jsx("div",{onClick:()=>Z&&x(H.hex),style:{width:24,height:24,borderRadius:"50%",background:H.hex,opacity:Z?1:.3,cursor:Z?"pointer":"not-allowed",border:ne?"3px solid #facc15":Z?"2px solid #475569":"2px dashed #334155",boxSizing:"border-box"},title:`${H.key}${Z?"":" (locked)"}`},H.key)})})]}),i.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700 space-y-1",children:[i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:m,onChange:H=>{P(H.target.checked),H.target.checked&&(E.devOverrideNextGoop=null)}}),i.jsx("span",{children:"Random Pieces"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:L,onChange:H=>O(H.target.checked)}),i.jsx("span",{children:"Show Vertices"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:E.freezeTimer,onChange:H=>{E.freezeTimer=H.target.checked}}),i.jsx("span",{children:"Freeze Timer"})]}),i.jsxs("label",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",checked:E.freezeFalling,onChange:H=>{E.freezeFalling=H.target.checked}}),i.jsx("span",{children:"Freeze Falling"})]})]}),_.map(H=>i.jsxs("div",{className:"mb-2",children:[i.jsxs("div",{className:"text-[10px] uppercase tracking-wider text-cyan-400 mb-1",children:[H.label,"  Normal"]}),i.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:H.normal.map((Z,ne)=>b(Z,ne))}),i.jsxs("div",{className:"text-[10px] uppercase tracking-wider text-orange-400 mb-1",children:[H.label,"  Corrupted"]}),i.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:H.corrupted.map((Z,ne)=>b(Z,ne))})]},H.label))]})})()]})},hm=({onBack:e})=>i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-4",children:i.jsx("h2",{className:"text-2xl font-bold text-yellow-400 tracking-wider",children:"UPGRADES"})}),i.jsx("div",{className:"w-full max-w-md space-y-4 opacity-50 pointer-events-none",children:[1,2,3].map(t=>i.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center",children:i.jsx(qy,{className:"w-6 h-6 text-slate-600"})}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-bold text-slate-300",children:["Locked Upgrade ",t]}),i.jsxs("div",{className:"text-xs text-slate-500",children:["Requires Rank ",t*5]})]})]}),i.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded text-slate-500 text-xs font-bold",children:"LOCKED"})]},t))}),i.jsx("div",{className:"mt-8 text-center text-slate-500 text-sm",children:"Play more to unlock system upgrades."})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),xm=({settings:e,onUpdate:t,onBack:n})=>{v.useEffect(()=>{vt.init(e)},[]);const s=(l,c)=>{t({...e,[l]:c})},r=({label:l,value:c,onChange:a,icon:u,colorClass:f})=>i.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex flex-col gap-3 transition-colors hover:border-slate-700",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{className:`w-5 h-5 ${f}`}),i.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase text-sm",children:l})]}),i.jsxs("span",{className:`font-bold text-sm ${f}`,children:[c,"%"]})]}),i.jsxs("div",{className:"relative w-full h-6 flex items-center",children:[i.jsx("input",{type:"range",min:"0",max:"100",value:c,onChange:d=>a(Number(d.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-cyan-500 z-10",style:{background:`linear-gradient(to right, currentColor 0%, currentColor ${c}%, rgba(30, 41, 59, 1) ${c}%, rgba(30, 41, 59, 1) 100%)`}}),i.jsx("style",{children:`
              input[type=range]::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  height: 16px;
                  width: 16px;
                  border-radius: 50%;
                  background: #f1f5f9;
                  margin-top: -2px; /* align center */
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
              input[type=range]::-moz-range-thumb {
                  height: 16px;
                  width: 16px;
                  border: none;
                  border-radius: 50%;
                  background: #f1f5f9;
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
           `})]})]}),o=({label:l,value:c,onChange:a,icon:u,colorClass:f})=>i.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex items-center justify-between transition-colors hover:border-slate-700 cursor-pointer",onClick:()=>a(!c),children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(u,{className:`w-5 h-5 ${f}`}),i.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase text-sm",children:l})]}),i.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${c?"bg-cyan-600":"bg-slate-700"}`,children:i.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform duration-300 ${c?"translate-x-6":"translate-x-0"}`})})]});return i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6",children:i.jsx("h2",{className:"text-3xl text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Config"})}),i.jsxs("div",{className:"w-full max-w-md space-y-4",children:[i.jsx(r,{label:"Master Output",value:e.masterVolume,onChange:l=>s("masterVolume",l),icon:ng,colorClass:"text-cyan-400"}),i.jsx(r,{label:"Music Level",value:e.musicVolume,onChange:l=>s("musicVolume",l),icon:Ky,colorClass:"text-purple-400"}),i.jsx(r,{label:"SFX Level",value:e.sfxVolume,onChange:l=>{s("sfxVolume",l)},icon:eg,colorClass:"text-green-400"}),i.jsx("div",{className:"h-px bg-slate-800 my-2"}),i.jsx(o,{label:"Invert Rotation",value:e.invertRotation||!1,onChange:l=>s("invertRotation",l),icon:Jy,colorClass:"text-yellow-400"})]}),i.jsx("div",{className:"mt-8 text-center text-slate-700 text-[10px] uppercase tracking-widest font-bold",children:"Audio System v2.1  Initialized"})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:n,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},ym=({onBack:e})=>i.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:i.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[i.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[i.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6 flex-shrink-0",children:i.jsx("h2",{className:"text-3xl text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Operator Manual"})}),i.jsxs("div",{className:"w-full max-w-md space-y-6",children:[i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[i.jsx(Xy,{className:"w-6 h-6 text-red-500"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"THE OBJECTIVE"})]}),i.jsxs("p",{className:"text-slate-400 leading-relaxed text-base",children:["The filtration system is clogging! Pop as much ooze as you can before the ",i.jsx("span",{className:"text-red-400 font-bold",children:"Pressure"})," reaches 100%.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("span",{className:"text-green-400 font-bold",children:"PRO TIP:"})," Popping larger groups of goop vents pressure, buying you more time to work."]})]}),i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsx(Vy,{className:"w-6 h-6 text-slate-400"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"CONTROLS"})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[i.jsx(Ns,{keyName:"A / D",action:"Rotate Tank View"}),i.jsx(Ns,{keyName:"Q / E",action:"Rotate Falling Goop"}),i.jsx(Ns,{keyName:"S",action:"Fall Faster"}),i.jsx(Ns,{keyName:"R",action:"Swap Held Goop"}),i.jsx(Ns,{keyName:"W / Space",action:"Return to Console"}),i.jsx(Ns,{keyName:"CLICK",action:"Pop Solid Goop"})]}),i.jsx("div",{className:"mt-4 text-center text-sm text-slate-500 italic",children:"* Touch controls: Drag to rotate tank, tap sides to rotate piece."})]}),i.jsxs("div",{className:"bg-slate-900/80 p-5 rounded-2xl border border-slate-800 backdrop-blur-sm space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[i.jsx(Uy,{className:"w-6 h-6 text-cyan-400"}),i.jsx("h3",{className:"text-xl font-bold text-white tracking-wide",children:"MECHANICS"})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(tg,{className:"w-5 h-5 text-red-500"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Priority Targets"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Sensors identify impurity hotspots with ",i.jsx("span",{className:"text-white font-bold",children:"colored markers"})," on the grid. Clear goop of the ",i.jsx("span",{className:"text-white font-bold",children:"matching color"})," at these coordinates to execute a localized flush protocol."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(Zy,{className:"w-5 h-5 text-yellow-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Purging (Clicking)"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["You can only pop goop that is ",i.jsx("span",{className:"text-white font-bold",children:"fully filled"})," (solid) and sitting ",i.jsx("span",{className:"text-white font-bold",children:"below the pressure line"})," (the water level)."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(Wy,{className:"w-5 h-5 text-green-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Scoring"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Goop combines with like colors.",i.jsx("br",{})," ",i.jsx("span",{className:"text-green-400",children:"Bigger Groups"})," = More XP.",i.jsx("br",{})," ",i.jsx("span",{className:"text-green-400",children:"Higher Elevation"})," = More XP."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(Qy,{className:"w-5 h-5 text-orange-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Console Maintenance"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Sometimes equipment fails! If controls lock up or lights go out, press ",i.jsx("span",{className:"text-white font-bold",children:"SPACE"})," or ",i.jsx("span",{className:"text-white font-bold",children:"W"})," to return to the Console and fix the issue manually."]})]})]}),i.jsxs("div",{className:"flex gap-4 items-start",children:[i.jsx("div",{className:"bg-slate-950 p-2 rounded-lg border border-slate-800 shrink-0 mt-1",children:i.jsx(sg,{className:"w-5 h-5 text-purple-400"})}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-bold text-slate-200 text-base",children:"Progression"}),i.jsxs("p",{className:"text-slate-400 text-sm mt-1",children:["Level up your Operator Rank to earn ",i.jsx("span",{className:"text-yellow-400",children:"Scraps"}),". Spend these in the Upgrades menu to enhance your efficiency!"]})]})]})]})]})]}),i.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:i.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:i.jsx(Ji,{className:"w-1/2 h-1/2 stroke-[3]"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),Ns=({keyName:e,action:t})=>i.jsxs("div",{className:"flex flex-col bg-slate-950 border border-slate-800 p-2 rounded-lg text-center",children:[i.jsx("span",{className:"text-cyan-400 font-black text-base mb-1",children:e}),i.jsx("span",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider",children:t})]}),Ii="gooptris_save_v3",Tf="gooptris_save_v2",Hc=()=>({careerRank:1,careerScore:0,scraps:0,powerUps:{},equippedActives:[],unlockedUpgrades:[],firstRunComplete:!1,milestonesReached:[],settings:{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1}}),gm=e=>{const t={...e};return"operatorXP"in t&&(t.careerScore=t.operatorXP,delete t.operatorXP),"operatorRank"in t&&(t.careerRank=t.operatorRank,delete t.operatorRank),t},mm=()=>{try{let e=localStorage.getItem(Ii);const t=Hc();if(!e){const s=localStorage.getItem(Tf);if(s){const r=JSON.parse(s),o=gm(r);localStorage.setItem(Ii,JSON.stringify(o)),localStorage.removeItem(Tf),e=JSON.stringify(o)}}if(!e)return t;const n=JSON.parse(e);return{...t,...n,settings:{...t.settings,...n.settings||{}},powerUps:{...t.powerUps,...n.powerUps||{}},equippedActives:n.equippedActives||t.equippedActives,unlockedUpgrades:n.unlockedUpgrades||t.unlockedUpgrades,milestonesReached:n.milestonesReached||t.milestonesReached}}catch(e){return console.error("Failed to load save data",e),Hc()}},vm=e=>{try{localStorage.setItem(Ii,JSON.stringify(e))}catch(t){console.error("Failed to save data",t)}},Sm=()=>{const e=Hc();try{localStorage.setItem(Ii,JSON.stringify(e))}catch(t){console.error("Failed to wipe save data",t)}return e},Cm=()=>{v.useEffect(()=>{const e=me.on(xe.PIECE_MOVED,()=>vt.playMove()),t=me.on(xe.PIECE_ROTATED,()=>vt.playRotate()),n=me.on(xe.PIECE_DROPPED,()=>vt.playDrop()),s=me.on(xe.GOOP_POPPED,f=>{vt.playPop((f==null?void 0:f.popStreak)||0)}),r=me.on(xe.ACTION_REJECTED,()=>vt.playReject()),o=me.on(xe.GOAL_CAPTURED,f=>{vt.playPop(10)}),l=me.on(xe.GAME_OVER,()=>{vt.playGameOver(),vt.stopMusic()}),c=me.on(xe.MUSIC_START,()=>vt.startMusic()),a=me.on(xe.MUSIC_STOP,()=>vt.stopMusic()),u=me.on(xe.GAME_RESUMED,()=>{vt.resume(),vt.startMusic()});return()=>{e(),t(),n(),s(),r(),o(),l(),c(),a(),u()}},[])},Ef={damping:.975,gravity:30,stiffness:20,pressure:2.5,iterations:3},Af=40;function _f(e,t){const n=[],s=[],r=[],o=Af,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=up(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,centerX:e,centerY:t,radius:Af*1.5}}function up(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function fp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function km(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function wm(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function jm(e,t){const n=up(e.vertices);if(n<1)return;const s=e.restArea/n,r=fp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Pm(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5)}function Rm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function bm(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Rm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=fp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill(),e.fillStyle="#fff",e.font="10px monospace",e.fillText(String(a),u.pos.x-3,u.pos.y+3)}e.strokeStyle="rgba(52, 152, 219, 0.5)",e.lineWidth=1;for(const a of t.ringsprings)e.beginPath(),e.moveTo(s[a.a].pos.x,s[a.a].pos.y),e.lineTo(s[a.b].pos.x,s[a.b].pos.y),e.stroke();e.strokeStyle="rgba(155, 89, 182, 0.3)";for(const a of t.crossSprings)e.beginPath(),e.moveTo(s[a.a].pos.x,s[a.a].pos.y),e.lineTo(s[a.b].pos.x,s[a.b].pos.y),e.stroke();e.beginPath(),e.arc(l.x,l.y,5,0,Math.PI*2),e.fillStyle="#f39c12",e.fill()}}const Il=500,Ll=400;function Mm(){const e=v.useRef(null),t=v.useRef(_f(Il/2,Ll/3)),n=v.useRef(0),s=v.useRef(-1),r=v.useRef({active:!1,vertexIndex:-1}),[o,l]=v.useState(Ef),[c,a]=v.useState(!0),[u,f]=v.useState(0);v.useEffect(()=>{const g=e.current;if(!g)return;const h=g.getContext("2d");if(!h)return;let x=0,m=performance.now();const P=k=>{x++,k-m>1e3&&(f(x),x=0,m=k);const C=t.current;if(s.current>=0){const w=Math.min((k-s.current)/1e3,.033);km(C,w,o);for(let T=0;T<o.iterations;T++)wm(C,o),jm(C,o);Pm(C,g.width,g.height)}s.current=k,r.current.active&&r.current.vertexIndex>=0,h.fillStyle="#2c3e50",h.fillRect(0,0,g.width,g.height),h.fillStyle="#34495e",h.fillRect(0,g.height-10,g.width,10),bm(h,C,c),n.current=requestAnimationFrame(P)};return n.current=requestAnimationFrame(P),()=>{cancelAnimationFrame(n.current)}},[o,c]);const d=v.useCallback((g,h)=>{const x=t.current;if(!x)return-1;let m=1/0,P=-1;for(let k=0;k<x.vertices.length;k++){const C=x.vertices[k],w=C.pos.x-g,T=C.pos.y-h,L=Math.sqrt(w*w+T*T);L<m&&L<50&&(m=L,P=k)}return P},[]),p=v.useCallback(g=>{const h=e.current;if(!h)return;const x=h.getBoundingClientRect(),m=g.clientX-x.left,P=g.clientY-x.top,k=d(m,P);k>=0&&(r.current={active:!0,vertexIndex:k})},[d]),y=v.useCallback(g=>{if(!r.current.active)return;const h=e.current;if(!h)return;const x=t.current,m=h.getBoundingClientRect(),P=g.clientX-m.left,k=g.clientY-m.top,C=x.vertices[r.current.vertexIndex];C.pos.x=P,C.pos.y=k,C.oldPos.x=P,C.oldPos.y=k},[]),S=v.useCallback(()=>{r.current={active:!1,vertexIndex:-1}},[]),R=v.useCallback(()=>{t.current=_f(Il/2,Ll/3),s.current=-1},[]),j=v.useCallback(()=>{const g=t.current;for(const h of g.vertices)h.oldPos.x=h.pos.x+(Math.random()-.5)*30,h.oldPos.y=h.pos.y+(Math.random()-.5)*30},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-1: Soft Body Blob"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Click and drag vertices to poke the blob"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Il,height:Ll,onMouseDown:p,onMouseMove:y,onMouseUp:S,onMouseLeave:S,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"pointer"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",u]}),i.jsx("span",{children:"Vertices: 10"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping (velocity): ",o.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.001",value:o.damping,onChange:g=>l(h=>({...h,damping:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Gravity: ",o.gravity]}),i.jsx("input",{type:"range",min:"-25",max:"50",step:"5",value:o.gravity,onChange:g=>l(h=>({...h,gravity:parseFloat(g.target.value)}))}),i.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"-25 = floats up, 0 = zero-g, 50 = gentle fall"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Stiffness (k): ",o.stiffness]}),i.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:o.stiffness,onChange:g=>l(h=>({...h,stiffness:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Pressure: ",o.pressure.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:o.pressure,onChange:g=>l(h=>({...h,pressure:parseFloat(g.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Constraint Iterations: ",o.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:o.iterations,onChange:g=>l(h=>({...h,iterations:parseInt(g.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:c,onChange:g=>a(g.target.checked)}),i.jsx("span",{children:"Show Debug (vertices, springs)"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:j,style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Poke!"}),i.jsx("button",{onClick:R,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset"})]}),i.jsx("button",{onClick:()=>l(Ef),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset Parameters"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-1 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Verlet integration with position-based constraints"}),i.jsx("li",{children:"T-tetromino shape with 10 perimeter vertices"}),i.jsx("li",{children:"Ring springs (perimeter) + cross springs (structural)"}),i.jsx("li",{children:"Pressure force for volume preservation"}),i.jsx("li",{children:"Catmull-Rom to Bezier for smooth rendering"})]})]})]})}const If={damping:.92,gravity:0,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.03},Tm=40,Nl=500,Ol=400;function Lf(e,t){const n=[],s=[],r=[],o=Tm,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=dp(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t}}function dp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function pp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Em(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function Am(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function _m(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Im(e,t){const n=dp(e.vertices);if(n<1)return;const s=e.restArea/n,r=pp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Lm(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3)}function Nm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Om(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let a=0;a<r;a++){const u=t.targetX+s[a].homeOffset.x,f=t.targetY+s[a].homeOffset.y;a===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Nm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=pp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}e.strokeStyle="#f39c12",e.lineWidth=2,e.beginPath(),e.moveTo(t.targetX-10,t.targetY),e.lineTo(t.targetX+10,t.targetY),e.moveTo(t.targetX,t.targetY-10),e.lineTo(t.targetX,t.targetY+10),e.stroke()}}function Dm(){const e=v.useRef(null),t=v.useRef(Lf(Nl/2,Ol/2)),n=v.useRef(0),s=v.useRef(-1),[r,o]=v.useState(If),[l,c]=v.useState(!0),[a,u]=v.useState(0),[f,d]=v.useState("cursor");v.useEffect(()=>{const j=e.current;if(!j)return;const g=j.getContext("2d");if(!g)return;let h=0,x=performance.now();const m=P=>{h++,P-x>1e3&&(u(h),h=0,x=P);const k=t.current;if(s.current>=0){const C=Math.min((P-s.current)/1e3,.033);Em(k,C,r),Am(k,r);for(let w=0;w<r.iterations;w++)_m(k,r),Im(k,r);Lm(k,j.width,j.height)}s.current=P,g.fillStyle="#2c3e50",g.fillRect(0,0,j.width,j.height),Om(g,k,l),g.fillStyle="rgba(255,255,255,0.5)",g.font="12px system-ui",g.fillText(f==="cursor"?"Move mouse to guide blob":"Click to set target",10,20),n.current=requestAnimationFrame(m)};return n.current=requestAnimationFrame(m),()=>cancelAnimationFrame(n.current)},[r,l,f]);const p=v.useCallback(j=>{if(f!=="cursor")return;const g=e.current;if(!g)return;const h=g.getBoundingClientRect(),x=j.clientX-h.left,m=j.clientY-h.top;t.current.targetX=x,t.current.targetY=m},[f]),y=v.useCallback(j=>{if(f!=="click")return;const g=e.current;if(!g)return;const h=g.getBoundingClientRect();t.current.targetX=j.clientX-h.left,t.current.targetY=j.clientY-h.top},[f]),S=v.useCallback(()=>{t.current=Lf(Nl/2,Ol/2),s.current=-1},[]),R=v.useCallback(()=>{const j=t.current;for(const g of j.vertices){const h=g.homeOffset.x,x=g.homeOffset.y;g.homeOffset.x=x,g.homeOffset.y=-h}},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-2: Blob Follows Cursor"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Testing two-layer architecture: render follows data"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Nl,height:Ol,onMouseMove:p,onClick:y,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"crosshair"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:i.jsxs("span",{children:["FPS: ",a]})}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>d("cursor"),style:{flex:1,padding:"8px",backgroundColor:f==="cursor"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Follow Cursor"}),i.jsx("button",{onClick:()=>d("click"),style:{flex:1,padding:"8px",backgroundColor:f==="click"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Click Target"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Home Stiffness: ",r.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.5",step:"0.01",value:r.homeStiffness,onChange:j=>o(g=>({...g,homeStiffness:parseFloat(j.target.value)}))}),i.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"Low = laggy/stretchy, High = snappy"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping: ",r.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.005",value:r.damping,onChange:j=>o(g=>({...g,damping:parseFloat(j.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Stiffness: ",r.stiffness]}),i.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:r.stiffness,onChange:j=>o(g=>({...g,stiffness:parseFloat(j.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Iterations: ",r.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:r.iterations,onChange:j=>o(g=>({...g,iterations:parseInt(j.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:l,onChange:j=>c(j.target.checked)}),i.jsx("span",{children:"Show Debug (target, ghost)"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:R,style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Rotate 90"}),i.jsx("button",{onClick:S,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]}),i.jsx("button",{onClick:()=>o(If),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Parameters"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-2 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Test two-layer architecture (data layer drives render layer)"}),i.jsx("li",{children:"Blob follows cursor/click target with springy physics"}),i.jsx("li",{children:"Slow moves = smooth follow"}),i.jsx("li",{children:"Fast/jump moves = overshoot, bounce, settle"}),i.jsx("li",{children:"Tune homeStiffness for responsive but physical feel"})]})]})]})}const $m={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.18},Fm=40,Dl=500,$l=400;function Nf(e,t){const n=[],s=[],r=[],o=Fm,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const c=n.length;for(let f=0;f<c;f++){const d=(f+1)%c,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:S})}const a=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of a){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,S=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:S})}const u=hp(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t,rotationCount:0}}function hp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function xp(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Bm(e){let t=0;for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=n.pos.x-s,l=n.pos.y-r;t+=Math.sqrt(o*o+l*l)}return t/e.vertices.length}function zm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Gm(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Ym(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Hm(e,t){const n=hp(e.vertices);if(n<1)return;const s=e.restArea/n,r=xp(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Wm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Um(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let a=0;a<r;a++){const u=t.targetX+s[a].homeOffset.x,f=t.targetY+s[a].homeOffset.y;a===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=Wm(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=xp(s),c=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n)for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Xm(){const e=v.useRef(null),t=v.useRef(Nf(Dl/2,$l/2)),n=v.useRef(0),s=v.useRef(-1),r=v.useRef(0),[o,l]=v.useState($m),[c,a]=v.useState(!0),[u,f]=v.useState(0),[d,p]=v.useState(0),[y,S]=v.useState(0),[R,j]=v.useState(!1),[g,h]=v.useState(500),[x,m]=v.useState(0);v.useEffect(()=>{const C=e.current;if(!C)return;const w=C.getContext("2d");if(!w)return;let T=0,L=performance.now();const O=X=>{T++,X-L>1e3&&(f(T),T=0,L=X);const K=t.current;if(R&&X-r.current>g){for(const re of K.vertices){const te=re.homeOffset.x,q=re.homeOffset.y;re.homeOffset.x=q,re.homeOffset.y=-te}K.rotationCount++,S(K.rotationCount),r.current=X}if(s.current>=0){const re=Math.min((X-s.current)/1e3,.033);zm(K,re,o),Gm(K,o);for(let te=0;te<o.iterations;te++)Ym(K,o),Hm(K,o)}s.current=X;const ee=Bm(K);p(ee),ee>x&&m(ee),w.fillStyle="#2c3e50",w.fillRect(0,0,C.width,C.height),Um(w,K,c);const I=150,J=20,ae=10,W=C.height-30;w.fillStyle="#34495e",w.fillRect(ae,W,I,J);const Q=Math.min(ee/50,1),Y=Q<.3?"#27ae60":Q<.7?"#f39c12":"#e74c3c";w.fillStyle=Y,w.fillRect(ae,W,I*Q,J),w.strokeStyle="#fff",w.strokeRect(ae,W,I,J),w.fillStyle="#fff",w.font="12px system-ui",w.fillText(`Deviation: ${ee.toFixed(1)}px`,ae+5,W+14),n.current=requestAnimationFrame(O)};return n.current=requestAnimationFrame(O),()=>cancelAnimationFrame(n.current)},[o,c,R,g,x]);const P=v.useCallback(()=>{const C=t.current;for(const w of C.vertices){const T=w.homeOffset.x,L=w.homeOffset.y;w.homeOffset.x=L,w.homeOffset.y=-T}C.rotationCount++,S(C.rotationCount)},[]),k=v.useCallback(()=>{t.current=Nf(Dl/2,$l/2),s.current=-1,S(0),m(0)},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-3: Rotation Stress Test"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Spam rotate - does lag accumulate?"}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:Dl,height:$l,style:{border:"2px solid #34495e",borderRadius:"8px"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",u]}),i.jsxs("span",{children:["Rotations: ",y]})]}),i.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c3e50",borderRadius:"4px",textAlign:"center"},children:[i.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[d.toFixed(1),"px"]}),i.jsx("div",{style:{fontSize:"12px",opacity:.7},children:"Current Deviation"}),i.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"5px"},children:["Peak: ",x.toFixed(1),"px"]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("button",{onClick:P,style:{padding:"15px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"18px",fontWeight:"bold"},children:"ROTATE 90"}),i.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:R,onChange:C=>j(C.target.checked)}),i.jsx("span",{children:"Auto-rotate"})]}),i.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:g,onChange:C=>h(parseInt(C.target.value)),style:{flex:1},disabled:!R}),i.jsxs("span",{style:{fontSize:"12px",width:"50px"},children:[g,"ms"]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Home Stiffness: ",o.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.005",value:o.homeStiffness,onChange:C=>l(w=>({...w,homeStiffness:parseFloat(C.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.jsxs("span",{children:["Damping: ",o.damping.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:o.damping,onChange:C=>l(w=>({...w,damping:parseFloat(C.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:c,onChange:C=>a(C.target.checked)}),i.jsx("span",{children:"Show Debug"})]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>m(0),style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Peak"}),i.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset All"})]})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-3 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:"Spam rotate button - observe deviation meter"}),i.jsx("li",{children:"Enable auto-rotate at various speeds"}),i.jsx("li",{children:"Watch for lag accumulation (peak deviation climbing)"}),i.jsx("li",{children:"Target: deviation stays bounded, recovers between rotations"}),i.jsx("li",{children:"Success = peak deviation stays under ~40px even with spam"})]})]})]})}const yp=30,bo=600,Mo=450,Vm={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.05,attractionRadius:yp,attractionRestLength:0,attractionStiffness:.02,breakDistance:60};function $r(e,t,n,s){const r=[],o=[],l=[],c=[],a=yp;let u,f,d,p;const y=1.5,S=.3;s==="T"?(u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],p=[y,y,y,y,y,S,y,y,S,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]],d=[{center:{x:-1*a,y:-.5*a},vertices:[0,1,9]},{center:{x:0*a,y:-.5*a},vertices:[1,2,5,8]},{center:{x:1*a,y:-.5*a},vertices:[2,3,4,5]},{center:{x:0*a,y:.5*a},vertices:[5,6,7,8]}]):(u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],p=[y,y,S,S,y,y,y,y,y,y,y,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]],d=[{center:{x:-1*a,y:-.5*a},vertices:[0,1,2,11]},{center:{x:1*a,y:-.5*a},vertices:[3,4,5,6]},{center:{x:-1*a,y:.5*a},vertices:[9,10,11,2]},{center:{x:0*a,y:.5*a},vertices:[2,3,8,9]},{center:{x:1*a,y:.5*a},vertices:[3,6,7,8]}]);for(let g=0;g<u.length;g++){const h=u[g];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:p[g]})}const R=r.length;for(let g=0;g<R;g++){const h=(g+1)%R,x=r[h].pos.x-r[g].pos.x,m=r[h].pos.y-r[g].pos.y,P=Math.sqrt(x*x+m*m);o.push({a:g,b:h,restLength:P})}for(const[g,h]of f)if(g<R&&h<R){const x=r[h].pos.x-r[g].pos.x,m=r[h].pos.y-r[g].pos.y,P=Math.sqrt(x*x+m*m);l.push({a:g,b:h,restLength:P})}const j=gp(r);for(const g of d)c.push({center:g.center,vertexIndices:g.vertices});return{vertices:r,ringsprings:o,crossSprings:l,restArea:j,targetX:e,targetY:t,color:n,blocks:c}}function gp(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function Ha(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function qm(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Zm(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Km(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],c=l.pos.x-o.pos.x,a=l.pos.y-o.pos.y,u=Math.sqrt(c*c+a*a);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=c*d,y=a*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function Qm(e,t){const n=gp(e.vertices);if(n<1)return;const s=e.restArea/n,r=Ha(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,c=o.pos.y-r.y,a=Math.sqrt(l*l+c*c);if(a<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/a*u,o.pos.y+=c/a*u}}function Of(e,t){return{x:e.targetX+t.center.x,y:e.targetY+t.center.y}}function Jm(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.breakDistance&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];for(const u of c.blocks)for(const f of a.blocks){const d=Of(c,u),p=Of(a,f),y=p.x-d.x,S=p.y-d.y;if(Math.sqrt(y*y+S*S)<n.attractionRadius*4)for(const j of u.vertexIndices)for(const g of f.vertexIndices){const h=`${o}-${j}-${l}-${g}`;if(r.has(h))continue;const x=c.vertices[j],m=a.vertices[g],P=m.pos.x-x.pos.x,k=m.pos.y-x.pos.y,C=Math.sqrt(P*P+k*k),w=n.attractionRadius*x.attractionRadius,T=n.attractionRadius*m.attractionRadius,L=w+T;C<L&&(s.push({blobA:o,vertA:j,blobB:l,vertB:g,restLength:n.attractionRestLength}),r.add(h))}}}return s}function ev(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),R=(f-o.restLength)*y*.5,j=a/f*R,g=u/f*R;l.pos.x+=j,l.pos.y+=g,c.pos.x-=j,c.pos.y-=g}}function tv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function nv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let a=0;a<r;a++){const u=s[(a-1+r)%r].pos,f=s[a].pos,d=s[(a+1)%r].pos,p=s[(a+2)%r].pos,{cp1:y,cp2:S}=tv(u,f,d,p);e.bezierCurveTo(y.x,y.y,S.x,S.y,d.x,d.y)}e.closePath();const l=Ha(s),c=e.createRadialGradient(l.x-15,l.y-15,0,l.x,l.y,60);if(c.addColorStop(0,"#6fcf97"),c.addColorStop(1,"#27ae60"),e.fillStyle=c,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=2,e.stroke(),n)for(let a=0;a<r;a++){const u=s[a];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function sv(e,t,n){e.strokeStyle="#f39c12",e.lineWidth=2,e.setLineDash([4,4]);for(const s of n){const r=t[s.blobA].vertices[s.vertA],o=t[s.blobB].vertices[s.vertB];e.beginPath(),e.moveTo(r.pos.x,r.pos.y),e.lineTo(o.pos.x,o.pos.y),e.stroke()}e.setLineDash([])}function ov(){const e=v.useRef(null),t=v.useRef([$r(bo/3,Mo/2,"#27ae60","T"),$r(bo*2/3,Mo/2,"#27ae60","U")]),n=v.useRef([]),s=v.useRef(0),r=v.useRef(-1),o=v.useRef(null),[l,c]=v.useState(Vm),[a,u]=v.useState(!0),[f,d]=v.useState(0),[p,y]=v.useState(0);v.useEffect(()=>{const x=e.current;if(!x)return;const m=x.getContext("2d");if(!m)return;let P=0,k=performance.now();const C=w=>{P++,w-k>1e3&&(d(P),P=0,k=w);const T=t.current;if(r.current>=0){const L=Math.min((w-r.current)/1e3,.033);n.current=Jm(T,n.current,l),y(n.current.length);for(let O=0;O<T.length;O++){const X=T[O];qm(X,L,l);const K=O===0?{...l,homeStiffness:.3}:l;Zm(X,K);for(let ee=0;ee<l.iterations;ee++)Km(X,l),Qm(X,l)}ev(T,n.current,l)}if(r.current=w,m.fillStyle="#2c3e50",m.fillRect(0,0,x.width,x.height),a){m.lineWidth=1;for(const L of T)for(const O of L.vertices){const X=l.attractionRadius*O.attractionRadius,K=O.attractionRadius>1;m.strokeStyle=K?"rgba(243, 156, 18, 0.3)":"rgba(52, 152, 219, 0.3)",m.beginPath(),m.arc(O.pos.x,O.pos.y,X,0,Math.PI*2),m.stroke()}}a&&sv(m,T,n.current);for(const L of T)nv(m,L,a);m.fillStyle="rgba(255,255,255,0.5)",m.font="12px system-ui",m.fillText("Drag blobs to test attraction",10,20),s.current=requestAnimationFrame(C)};return s.current=requestAnimationFrame(C),()=>cancelAnimationFrame(s.current)},[l,a]);const S=v.useCallback(x=>{const m=e.current;if(!m)return;const P=m.getBoundingClientRect(),k=m.width/P.width,C=m.height/P.height,w=(x.clientX-P.left)*k,T=(x.clientY-P.top)*C,L=t.current[1],O=Ha(L.vertices),X=w-O.x,K=T-O.y;Math.sqrt(X*X+K*K)<150&&(o.current={blobIndex:1,offsetX:L.targetX-w,offsetY:L.targetY-T})},[]),R=v.useCallback(x=>{if(!o.current)return;const m=e.current;if(!m)return;const P=m.getBoundingClientRect(),k=m.width/P.width,C=m.height/P.height,w=(x.clientX-P.left)*k,T=(x.clientY-P.top)*C,L=t.current[o.current.blobIndex];L.targetX=w+o.current.offsetX,L.targetY=T+o.current.offsetY},[]),j=v.useCallback(()=>{o.current=null},[]),g=v.useCallback(()=>{t.current=[$r(bo/3,Mo/2,"#27ae60","T"),$r(bo*2/3,Mo/2,"#27ae60","U")],n.current=[],r.current=-1},[]),h=v.useCallback(x=>{const m=t.current[x];for(const P of m.vertices){const k=P.homeOffset.x,C=P.homeOffset.y;P.homeOffset.x=C,P.homeOffset.y=-k}for(const P of m.blocks){const k=P.center.x,C=P.center.y;P.center.x=C,P.center.y=-k}},[]);return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-4: Two Blobs Attraction"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:'Do vertex springs create the "reaching" effect?'}),i.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("canvas",{ref:e,width:bo,height:Mo,onMouseDown:S,onMouseMove:R,onMouseUp:j,onMouseLeave:j,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"grab"}}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"280px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[i.jsxs("span",{children:["FPS: ",f]}),i.jsxs("span",{children:["Springs: ",p]})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("div",{style:{fontWeight:"bold",color:"#f39c12"},children:"Attraction Settings"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Attraction Radius: ",l.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:l.attractionRadius,onChange:x=>c(m=>({...m,attractionRadius:parseInt(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Rest Length: ",l.attractionRestLength,"px"]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:l.attractionRestLength,onChange:x=>c(m=>({...m,attractionRestLength:parseInt(x.target.value)}))}),i.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"0 = vertices touch"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Attraction Stiffness: ",l.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.1",step:"0.005",value:l.attractionStiffness,onChange:x=>c(m=>({...m,attractionStiffness:parseFloat(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Break Distance: ",l.breakDistance,"px"]}),i.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:l.breakDistance,onChange:x=>c(m=>({...m,breakDistance:parseInt(x.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsx("div",{style:{fontWeight:"bold",color:"#3498db"},children:"Blob Physics"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Home Stiffness: ",l.homeStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.01",value:l.homeStiffness,onChange:x=>c(m=>({...m,homeStiffness:parseFloat(x.target.value)}))})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[i.jsxs("span",{children:["Damping: ",l.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:l.damping,onChange:x=>c(m=>({...m,damping:parseFloat(x.target.value)}))})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[i.jsx("input",{type:"checkbox",checked:a,onChange:x=>u(x.target.checked)}),i.jsx("span",{children:"Show Debug (springs, radius)"})]}),i.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:()=>h(0),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate T"}),i.jsx("button",{onClick:()=>h(1),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate U"})]}),i.jsx("button",{onClick:g,style:{padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]})]}),i.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"860px"},children:[i.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-4 Goals:"}),i.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[i.jsx("li",{children:'Drag blobs close together - watch for "reaching" effect'}),i.jsx("li",{children:"Vertices should stretch toward each other before touching"}),i.jsx("li",{children:"Orange dashed lines = attraction springs forming"}),i.jsx("li",{children:"Drag apart - springs should break cleanly"}),i.jsx("li",{children:"Success = gummy/stretchy feel, NOT magnetic snap"})]})]})]})}const mp=30,rv=600,iv=450,lv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08},Fl={none:{enabled:!1,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6},subtle:{enabled:!0,stdDeviation:10,alphaMultiplier:20,alphaOffset:-8},medium:{enabled:!0,stdDeviation:15,alphaMultiplier:24,alphaOffset:-7},aggressive:{enabled:!0,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6}};function cv(e,t){const n=[],s=[],r=mp*.45,o=8,l=12,c=[{x:-r,y:-r},{x:r,y:-r},{x:r,y:r},{x:-r,y:r}];for(let u=0;u<4;u++){const f=c[u],d={x:-Math.sign(f.x),y:-Math.sign(f.y)},p=f.x+d.x*o,y=f.y,S=f.x,R=f.y+d.y*o;u===0?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:R},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):u===1?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:R},mass:1}):u===2?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:R},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:S,y:R},mass:1})}for(let u=0;u<l;u++){const f=(u+1)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:f,restLength:Math.sqrt(d*d+p*p)})}for(let u=0;u<l/2;u++){const f=(u+l/2)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:Math.floor(f),restLength:Math.sqrt(d*d+p*p)})}let a=0;for(let u=0;u<l;u++){const f=(u+1)%l;a+=n[u].homeOffset.x*n[f].homeOffset.y,a-=n[f].homeOffset.x*n[u].homeOffset.y}return{vertices:n,springs:s,restArea:Math.abs(a)/2,centerOffset:{x:e,y:t}}}function Df(e,t,n,s){const r=[],o=mp;let l;n==="T"?l=[{x:-o,y:-o*.5},{x:0,y:-o*.5},{x:o,y:-o*.5},{x:0,y:o*.5}]:l=[{x:-o,y:-o*.5},{x:o,y:-o*.5},{x:-o,y:o*.5},{x:0,y:o*.5},{x:o,y:o*.5}];for(const a of l){const u=cv(a.x,a.y);r.push(u)}const c={blocks:r,targetX:e,targetY:t,rotation:0,color:s};return av(c),c}function Li(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function av(e){for(const t of e.blocks){const n=Li(t.centerOffset.x,t.centerOffset.y,e.rotation),s=e.targetX+n.x,r=e.targetY+n.y;for(const o of t.vertices){const l=Li(o.homeOffset.x,o.homeOffset.y,e.rotation),c=s+l.x,a=r+l.y;o.pos.x===0&&o.pos.y===0&&(o.pos={x:c,y:a},o.oldPos={x:c,y:a})}}}function uv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function fv(e,t,n){const s=Li(t.centerOffset.x,t.centerOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of t.vertices){const c=Li(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*n.homeStiffness,l.pos.y+=d*n.homeStiffness}}function dv(e,t){for(const n of e.springs){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function pv(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const u=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[u].pos.y,s-=e.vertices[u].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;let l=0,c=0;for(const a of e.vertices)l+=a.pos.x,c+=a.pos.y;l/=n,c/=n;for(const a of e.vertices){const u=a.pos.x-l,f=a.pos.y-c,d=Math.sqrt(u*u+f*f);d>1e-4&&(a.pos.x+=u/d*o,a.pos.y+=f/d*o)}}function hv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function xv(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],c=n[(r+1)%t],a=n[(r+2)%t],{cp1:u,cp2:f}=hv(o,l,c,a);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`}return s+" Z"}function yv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef(null),o=v.useRef({x:0,y:0}),[l]=v.useState(lv),[c,a]=v.useState(Fl.aggressive),[u,f]=v.useState("aggressive"),[,d]=v.useState({});v.useEffect(()=>{const h=[Df(180,250,"T","#e74c3c"),Df(380,250,"U","#e74c3c")];s.current=h},[]),v.useEffect(()=>{let h=!0;const x=m=>{if(h){n.current=m,h=!1,t.current=requestAnimationFrame(x);return}const P=Math.min((m-n.current)/1e3,.033);n.current=m;for(const k of s.current)for(const C of k.blocks){uv(C,l,P),fv(k,C,l);for(let w=0;w<l.iterations;w++)dv(C,l);pv(C,l)}d({}),t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[l]);const p=v.useCallback(h=>{const x=e.current;if(!x)return;const m=x.getBoundingClientRect(),P=h.clientX-m.left,k=h.clientY-m.top;for(let C=0;C<s.current.length;C++){const w=s.current[C],T=P-w.targetX,L=k-w.targetY;if(T*T+L*L<80*80){r.current=C,o.current={x:T,y:L},h.target.setPointerCapture(h.pointerId);break}}},[]),y=v.useCallback(h=>{if(r.current===null)return;const x=e.current;if(!x)return;const m=x.getBoundingClientRect(),P=h.clientX-m.left-o.current.x,k=h.clientY-m.top-o.current.y;s.current[r.current].targetX=P,s.current[r.current].targetY=k},[]),S=v.useCallback(()=>{r.current=null},[]),R=h=>{const x=s.current[h];x.rotation=(x.rotation+90)%360},j=h=>{const x=Fl[h];x&&(a(x),f(h))},g=()=>{const{alphaMultiplier:h,alphaOffset:x}=c;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${h} ${x}`};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5: Goo Filter Variations"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Drag pieces to overlap. Use Rotate buttons. Both pieces are same color for merge test."}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Fl).map(h=>i.jsx("button",{onClick:()=>j(h),style:{padding:"8px 16px",background:u===h?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:u===h?"bold":"normal"},children:h.charAt(0).toUpperCase()+h.slice(1)},h))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",c.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:c.stdDeviation,onChange:h=>{a(x=>({...x,stdDeviation:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",c.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:c.alphaMultiplier,onChange:h=>{a(x=>({...x,alphaMultiplier:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",c.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:c.alphaOffset,onChange:h=>{a(x=>({...x,alphaOffset:Number(h.target.value)})),f("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:c.enabled,onChange:h=>{a(x=>({...x,enabled:h.target.checked})),f(h.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>R(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>R(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"})]})]}),i.jsxs("svg",{ref:e,width:rv,height:iv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:p,onPointerMove:y,onPointerUp:S,onPointerLeave:S,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:c.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:g(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:180,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T-tetromino"}),i.jsx("text",{x:380,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U-pentomino"}),i.jsx("g",{filter:c.enabled?"url(#goo-filter)":void 0,children:s.current.map((h,x)=>h.blocks.map((m,P)=>i.jsx("path",{d:xv(m.vertices),fill:h.color,stroke:h.color,strokeWidth:2},`${x}-${P}`)))}),s.current.map((h,x)=>i.jsx("circle",{cx:h.targetX,cy:h.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${x}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Goal:"})," Find filter settings where blocks within a piece merge smoothly, AND where two pieces overlap their blocks also merge into one membrane.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test:"})," Drag the T into the U's alcove. Rotate pieces. Watch how blocks merge visually."]})]})}const gv=30,mv=600,vv=450,Sv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25},Bl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function zl(e,t,n,s){const r=[],o=[],l=[],c=gv;let a,u;const f=1.5,d=.3,p=1;let y;if(n==="T")a=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],y=[f,p,p,f,p,d,f,f,d,p],u=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")a=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],y=[f,f,d,d,f,f,p,f,p,p,f,p],u=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else{const g=.08*c;a=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-g,y:-.5*c},{x:-g,y:-.5*c+g},{x:-.5*c,y:-.5*c+g},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+g},{x:g,y:-.5*c+g},{x:g,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+g,y:-.5*c},{x:.5*c+g,y:-.5*c-g},{x:-.5*c-g,y:-.5*c-g},{x:-.5*c-g,y:-.5*c},{x:-1.5*c,y:-.5*c}],y=[f,p,f,d,d,f,f,f,f,d,d,f,p,f,f,d,d,d,d,p],u=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}for(let g=0;g<a.length;g++){const h=a[g];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:y[g]})}const S=r.length;for(let g=0;g<S;g++){const h=(g+1)%S,x=r[h].homeOffset.x-r[g].homeOffset.x,m=r[h].homeOffset.y-r[g].homeOffset.y;o.push({a:g,b:h,restLength:Math.sqrt(x*x+m*m)})}for(const[g,h]of u){const x=r[h].homeOffset.x-r[g].homeOffset.x,m=r[h].homeOffset.y-r[g].homeOffset.y;l.push({a:g,b:h,restLength:Math.sqrt(x*x+m*m)})}let R=0;for(let g=0;g<S;g++){const h=(g+1)%S;R+=r[g].homeOffset.x*r[h].homeOffset.y,R-=r[h].homeOffset.x*r[g].homeOffset.y}const j=Math.abs(R)/2;return{vertices:r,ringsprings:o,crossSprings:l,restArea:j,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Cv(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function kv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function wv(e,t){for(const n of e.vertices){const s=Cv(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}}function jv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Pv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function Rv(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],R=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=R.pos.x-S.pos.x,h=R.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,P=n.attractionRadius*R.attractionRadius,k=m+P;x<k&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function bv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,R=a/f*S*y,j=u/f*S*y;l.pos.x+=R,l.pos.y+=j,c.pos.x-=R,c.pos.y-=j}}function Mv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Tv(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],c=n[(r+1)%t],a=n[(r+2)%t],{cp1:u,cp2:f}=Mv(o,l,c,a);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${c.x} ${c.y}`}return s+" Z"}function Ev(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Sv),[u,f]=v.useState(Bl.medium),[d,p]=v.useState("medium"),[y,S]=v.useState(!1),[,R]=v.useState({});v.useEffect(()=>{const k=[zl(120,250,"T","#e74c3c"),zl(300,250,"U","#e74c3c"),zl(480,250,"Corrupt","#e74c3c")];s.current=k},[]),v.useEffect(()=>{let k=!0;const C=w=>{if(k){n.current=w,k=!1,t.current=requestAnimationFrame(C);return}const T=Math.min((w-n.current)/1e3,.033);n.current=w;for(const L of s.current){kv(L,c,T),wv(L,c);for(let O=0;O<c.iterations;O++)jv(L,c);L.usePressure&&Pv(L,c)}r.current=Rv(s.current,r.current,c),bv(s.current,r.current,c),R({}),t.current=requestAnimationFrame(C)};return t.current=requestAnimationFrame(C),()=>cancelAnimationFrame(t.current)},[c]);const j=v.useCallback(k=>{const C=e.current;if(!C)return;const w=C.getBoundingClientRect(),T=k.clientX-w.left,L=k.clientY-w.top;for(let O=0;O<s.current.length;O++){const X=s.current[O],K=T-X.targetX,ee=L-X.targetY;if(K*K+ee*ee<80*80){o.current=O,l.current={x:K,y:ee},k.target.setPointerCapture(k.pointerId);break}}},[]),g=v.useCallback(k=>{if(o.current===null)return;const C=e.current;if(!C)return;const w=C.getBoundingClientRect(),T=k.clientX-w.left-l.current.x,L=k.clientY-w.top-l.current.y;s.current[o.current].targetX=T,s.current[o.current].targetY=L},[]),h=v.useCallback(()=>{o.current=null},[]),x=k=>{s.current[k].rotation=(s.current[k].rotation+90)%360},m=k=>{const C=Bl[k];C&&(f(C),p(k))},P=()=>{const{alphaMultiplier:k,alphaOffset:C}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${k} ${C}`};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5b: Single Perimeter Shapes"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Each shape is ONE continuous soft body (not composed of blocks). Same color for merge test."}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Bl).map(k=>i.jsx("button",{onClick:()=>m(k),style:{padding:"8px 16px",background:d===k?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===k?"bold":"normal"},children:k.charAt(0).toUpperCase()+k.slice(1)},k))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",u.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:k=>{f(C=>({...C,stdDeviation:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:k=>{f(C=>({...C,alphaMultiplier:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:k=>{f(C=>({...C,alphaOffset:Number(k.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:u.enabled,onChange:k=>{f(C=>({...C,enabled:k.target.checked})),p(k.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:k=>a(C=>({...C,goopiness:Number(k.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance (mozzarella)"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:k=>a(C=>({...C,attractionRadius:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How close to connect"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:k=>a(C=>({...C,attractionStiffness:Number(k.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Pull force (10%-100%)"})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:y,onChange:k=>S(k.target.checked)}),i.jsx("span",{children:"Show Springs"})]})]}),i.jsxs("svg",{ref:e,width:mv,height:vv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:j,onPointerMove:g,onPointerUp:h,onPointerLeave:h,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-5b",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:P(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:u.enabled?"url(#goo-filter-5b)":void 0,children:[r.current.map((k,C)=>{var Y,re;const w=(Y=s.current[k.blobA])==null?void 0:Y.vertices[k.vertA],T=(re=s.current[k.blobB])==null?void 0:re.vertices[k.vertB];if(!w||!T)return null;const L=T.pos.x-w.pos.x,O=T.pos.y-w.pos.y,X=Math.sqrt(L*L+O*O),K=Math.min(1,X/c.goopiness),ee=8,I=4,J=ee-(ee-I)*K,ae=J*1.5,W=Math.max(2,Math.ceil(X/ae)),Q=[];for(let te=0;te<=W;te++){const q=te/W,pe=1-.3*Math.sin(q*Math.PI),we=J*pe;Q.push({cx:w.pos.x+L*q,cy:w.pos.y+O*q,r:Math.max(I*.5,we)})}return i.jsx("g",{children:Q.map((te,q)=>i.jsx("circle",{cx:te.cx,cy:te.cy,r:te.r,fill:"#e74c3c"},q))},`tendril-${C}`)}),s.current.map((k,C)=>i.jsx("path",{d:Tv(k.vertices),fill:k.color,stroke:k.color,strokeWidth:2},C))]}),y&&r.current.map((k,C)=>{var J,ae;const w=(J=s.current[k.blobA])==null?void 0:J.vertices[k.vertA],T=(ae=s.current[k.blobB])==null?void 0:ae.vertices[k.vertB];if(!w||!T)return null;const L=T.pos.x-w.pos.x,O=T.pos.y-w.pos.y,K=Math.sqrt(L*L+O*O)/c.goopiness,ee=Math.min(255,Math.floor(K*255)),I=Math.max(0,255-Math.floor(K*255));return i.jsx("line",{x1:w.pos.x,y1:w.pos.y,x2:T.pos.x,y2:T.pos.y,stroke:`rgb(${ee},${I},100)`,strokeWidth:2,opacity:.7},`spring-${C}`)}),s.current.map((k,C)=>i.jsx("circle",{cx:k.targetX,cy:k.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${C}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-5b + Attraction:"}),' Single-perimeter shapes with physics-based attraction springs. When pieces get close, springs form. Pull them apart to see the "mozzarella pull" effect  they stretch until breaking at the Goopiness distance.',i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Goopiness:"}),' Controls how far the "mozzarella strings" stretch before snapping. Higher = longer stretchy connections when pulling apart.',i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Stiffness Ramp:"})," Attraction is weak (10%) at max distance (reaching effect) and strong (100%) when close (solid merge). This creates natural-looking goop behavior.",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test:"})," Drag T into U's notch, let them merge, then slowly pull apart to see the stretching effect."]})]})}const Av=30,_v=600,Iv=450,Lv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Gl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function Yl(e,t,n,s){const r=[],o=[],l=[],c=[],a=Av;let u,f;const d=1.5,p=.3,y=1;let S;if(n==="T")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],S=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],S=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*a;u=[{x:-1.5*a,y:-1.5*a},{x:-.5*a,y:-1.5*a},{x:-.5*a,y:-.5*a},{x:-x,y:-.5*a},{x:-x,y:-.5*a+x},{x:-.5*a,y:-.5*a+x},{x:-.5*a,y:1.5*a},{x:.5*a,y:1.5*a},{x:.5*a,y:-.5*a+x},{x,y:-.5*a+x},{x,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:-1.5*a},{x:1.5*a,y:-1.5*a},{x:1.5*a,y:-.5*a},{x:.5*a+x,y:-.5*a},{x:.5*a+x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a},{x:-1.5*a,y:-.5*a}],S=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*a,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:.5*a},{x:-.5*a,y:.5*a}],S=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a}],S=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const m=u[x];r.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y},mass:1,attractionRadius:S[x]}),o.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y}})}const R=r.length;for(let x=0;x<R;x++){const m=(x+1)%R,P=r[m].homeOffset.x-r[x].homeOffset.x,k=r[m].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:m,restLength:Math.sqrt(P*P+k*k)})}for(const[x,m]of f){const P=r[m].homeOffset.x-r[x].homeOffset.x,k=r[m].homeOffset.y-r[x].homeOffset.y;c.push({a:x,b:m,restLength:Math.sqrt(P*P+k*k)})}let j=0;for(let x=0;x<R;x++){const m=(x+1)%R;j+=r[x].homeOffset.x*r[m].homeOffset.y,j-=r[m].homeOffset.x*r[x].homeOffset.y}const g=Math.abs(j)/2;let h;if(n==="Corrupt"){const x=.5*a;h=[{offsetX:-a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-a},{x,y:-a},{x,y:a},{x:-x,y:a}],outerVertexIndices:[5,8,7,6]}].map(P=>{const k=P.points.map(C=>{const w=e+P.offsetX+C.x,T=t+P.offsetY+C.y;return{pos:{x:w,y:T},oldPos:{x:w,y:T},homeOffset:{x:C.x,y:C.y}}});return{...P,vertices:k,outerVertexIndices:P.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:c,restArea:g,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Fr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Nv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function Ov(e,t){for(const n of e.vertices){const s=Fr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}for(const n of e.innerVertices){const s=Fr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=c*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Fr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const c=Fr(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function Dv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function $v(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function Fv(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],R=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=R.pos.x-S.pos.x,h=R.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,P=n.attractionRadius*R.attractionRadius,k=m+P;x<k&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function Bv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,R=a/f*S*y,j=u/f*S*y;l.pos.x+=R,l.pos.y+=j,c.pos.x-=R,c.pos.y-=j}}function zv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Wc(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=zv(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function Gv(e){return Wc(e.map(t=>t.pos))}function $f(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const R=u/y,j=f/y,g=d/S,h=p/S,x=-j,m=R,P=-h,k=g;let C=x+P,w=m+k;const T=Math.sqrt(C*C+w*w);T<.001?(C=x,w=m):(C/=T,w/=T);const L=R*g+j*h,O=Math.sqrt((1+L)/2),X=O>.1?1/O:10,K=s[o]*.4,ee=Math.min(t,K);r.push({x:c.x+C*ee*Math.min(X,3),y:c.y+w*ee*Math.min(X,3)})}return r}function Yv(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Lv),[u,f]=v.useState(Gl.medium),[d,p]=v.useState("medium"),[y,S]=v.useState(!1),[,R]=v.useState({});v.useEffect(()=>{const C=[Yl(120,250,"T","#e74c3c"),Yl(300,250,"U","#e74c3c"),Yl(480,250,"Corrupt","#e74c3c")];s.current=C},[]),v.useEffect(()=>{let C=!0;const w=T=>{if(C){n.current=T,C=!1,t.current=requestAnimationFrame(w);return}const L=Math.min((T-n.current)/1e3,.033);n.current=T;for(const O of s.current){Nv(O,c,L),Ov(O,c);for(let X=0;X<c.iterations;X++)Dv(O,c);O.usePressure&&$v(O,c)}r.current=Fv(s.current,r.current,c),Bv(s.current,r.current,c),R({}),t.current=requestAnimationFrame(w)};return t.current=requestAnimationFrame(w),()=>cancelAnimationFrame(t.current)},[c]);const j=v.useCallback(C=>{const w=e.current;if(!w)return;const T=w.getBoundingClientRect(),L=C.clientX-T.left,O=C.clientY-T.top;for(let X=0;X<s.current.length;X++){const K=s.current[X],ee=L-K.targetX,I=O-K.targetY;if(ee*ee+I*I<80*80){o.current=X,l.current={x:ee,y:I},C.target.setPointerCapture(C.pointerId);break}}},[]),g=v.useCallback(C=>{if(o.current===null)return;const w=e.current;if(!w)return;const T=w.getBoundingClientRect(),L=C.clientX-T.left-l.current.x,O=C.clientY-T.top-l.current.y;s.current[o.current].targetX=L,s.current[o.current].targetY=O},[]),h=v.useCallback(()=>{o.current=null},[]),x=C=>{s.current[C].rotation=(s.current[C].rotation+90)%360},m=C=>{const w=Gl[C];w&&(f(w),p(C))},P=()=>{const{alphaMultiplier:C,alphaOffset:w}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${C} ${w}`},k="#2c3e50";return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5c: Cell Wall (Outer - Inner)"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Outer gooey silhouette + stable inner core = visible cell wall ring"}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Gl).map(C=>i.jsx("button",{onClick:()=>m(C),style:{padding:"8px 16px",background:d===C?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===C?"bold":"normal"},children:C.charAt(0).toUpperCase()+C.slice(1)},C))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",u.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:C=>{f(w=>({...w,stdDeviation:Number(C.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:C=>{f(w=>({...w,alphaMultiplier:Number(C.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:C=>{f(w=>({...w,alphaOffset:Number(C.target.value)})),p("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:u.enabled,onChange:C=>{f(w=>({...w,enabled:C.target.checked})),p(C.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",c.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:c.innerHomeStiffness,onChange:C=>a(w=>({...w,innerHomeStiffness:Number(C.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:C=>a(w=>({...w,goopiness:Number(C.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:C=>a(w=>({...w,attractionRadius:Number(C.target.value)})),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:C=>a(w=>({...w,attractionStiffness:Number(C.target.value)})),style:{width:100}})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:y,onChange:C=>S(C.target.checked)}),i.jsx("span",{children:"Show Springs"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",c.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:c.tendrilEndRadius,onChange:C=>a(w=>({...w,tendrilEndRadius:Number(C.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",c.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:c.tendrilSkinniness,onChange:C=>a(w=>({...w,tendrilSkinniness:Number(C.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",c.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:c.wallThickness,onChange:C=>a(w=>({...w,wallThickness:Number(C.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),i.jsxs("svg",{ref:e,width:_v,height:Iv,style:{background:k,borderRadius:8,cursor:"grab"},onPointerDown:j,onPointerMove:g,onPointerUp:h,onPointerLeave:h,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-5c",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:P(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:u.enabled?"url(#goo-filter-5c)":void 0,children:[r.current.map((C,w)=>{var q,pe;const T=(q=s.current[C.blobA])==null?void 0:q.vertices[C.vertA],L=(pe=s.current[C.blobB])==null?void 0:pe.vertices[C.vertB];if(!T||!L)return null;const O=L.pos.x-T.pos.x,X=L.pos.y-T.pos.y,K=Math.sqrt(O*O+X*X),ee=Math.min(1,K/c.goopiness),I=c.tendrilEndRadius,J=1-c.tendrilSkinniness,ae=1-c.tendrilSkinniness*.3,W=ae-(ae-J)*ee,Q=I*W,Y=I*1.4,re=Math.max(2,Math.ceil(K/Y)),te=[];for(let we=0;we<=re;we++){const E=we/re,B=Math.sin(E*Math.PI),ve=I-(I-Q)*B;te.push({cx:T.pos.x+O*E,cy:T.pos.y+X*E,r:Math.max(2,ve)})}return i.jsx("g",{children:te.map((we,E)=>i.jsx("circle",{cx:we.cx,cy:we.cy,r:we.r,fill:"#e74c3c"},E))},`tendril-${w}`)}),s.current.map((C,w)=>i.jsx("path",{d:Gv(C.vertices),fill:C.color,stroke:C.color,strokeWidth:2},w))]}),s.current.map((C,w)=>{if(C.innerRegions)return C.innerRegions.map((T,L)=>{let O;T.outerVertexIndices?O=T.outerVertexIndices.map(K=>C.vertices[K].pos):O=T.vertices.map(K=>K.pos);const X=$f(O,c.wallThickness);return i.jsx("path",{d:Wc(X),fill:k},`inner-${w}-${L}`)});{const T=C.vertices.map(O=>O.pos),L=$f(T,c.wallThickness);return i.jsx("path",{d:Wc(L),fill:k},`inner-${w}`)}}),y&&r.current.map((C,w)=>{var ae,W;const T=(ae=s.current[C.blobA])==null?void 0:ae.vertices[C.vertA],L=(W=s.current[C.blobB])==null?void 0:W.vertices[C.vertB];if(!T||!L)return null;const O=L.pos.x-T.pos.x,X=L.pos.y-T.pos.y,ee=Math.sqrt(O*O+X*X)/c.goopiness,I=Math.min(255,Math.floor(ee*255)),J=Math.max(0,255-Math.floor(ee*255));return i.jsx("line",{x1:T.pos.x,y1:T.pos.y,x2:L.pos.x,y2:L.pos.y,stroke:`rgb(${I},${J},100)`,strokeWidth:2,opacity:.7},`spring-${w}`)}),s.current.map((C,w)=>i.jsx("circle",{cx:C.targetX,cy:C.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${w}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-5c: Cell Wall Model"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Two layers:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Outer"})," (gooey): Stretches, merges with filter effect",i.jsx("br",{})," ",i.jsx("strong",{children:"Inner"})," (stable): Barely moves, cuts out the center",i.jsx("br",{})," ",i.jsx("strong",{children:"Cell Wall"}),": The visible ring between them",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Inner Stiffness:"})," Controls how stable the core is (higher = more rigid)",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Next:"})," Dynamic rebuilding when pieces lock (merge walls) or become loose goop (amputate)"]})]})}const Hv=30,Wv=600,Uv=450,Xv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Hl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},Vv={autoFill:!0,fillRate:.15},Ff=1.15,qv=200;function Wl(e,t,n,s){const r=[],o=[],l=[],c=[],a=Hv;let u,f;const d=1.5,p=.3,y=1;let S;if(n==="T")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-.5*a,y:0*a},{x:-1.5*a,y:0*a}],S=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*a,y:-1*a},{x:-.5*a,y:-1*a},{x:-.5*a,y:0*a},{x:.5*a,y:0*a},{x:.5*a,y:-1*a},{x:1.5*a,y:-1*a},{x:1.5*a,y:0*a},{x:1.5*a,y:1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a},{x:-1.5*a,y:1*a},{x:-1.5*a,y:0*a}],S=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*a;u=[{x:-1.5*a,y:-1.5*a},{x:-.5*a,y:-1.5*a},{x:-.5*a,y:-.5*a},{x:-x,y:-.5*a},{x:-x,y:-.5*a+x},{x:-.5*a,y:-.5*a+x},{x:-.5*a,y:1.5*a},{x:.5*a,y:1.5*a},{x:.5*a,y:-.5*a+x},{x,y:-.5*a+x},{x,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:-1.5*a},{x:1.5*a,y:-1.5*a},{x:1.5*a,y:-.5*a},{x:.5*a+x,y:-.5*a},{x:.5*a+x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a-x},{x:-.5*a-x,y:-.5*a},{x:-1.5*a,y:-.5*a}],S=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*a,y:-.5*a},{x:.5*a,y:-.5*a},{x:.5*a,y:.5*a},{x:-.5*a,y:.5*a}],S=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*a,y:-1*a},{x:.5*a,y:-1*a},{x:.5*a,y:1*a},{x:-.5*a,y:1*a}],S=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const m=u[x];r.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y},mass:1,attractionRadius:S[x]}),o.push({pos:{x:e+m.x,y:t+m.y},oldPos:{x:e+m.x,y:t+m.y},homeOffset:{x:m.x,y:m.y}})}const R=r.length;for(let x=0;x<R;x++){const m=(x+1)%R,P=r[m].homeOffset.x-r[x].homeOffset.x,k=r[m].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:m,restLength:Math.sqrt(P*P+k*k)})}for(const[x,m]of f){const P=r[m].homeOffset.x-r[x].homeOffset.x,k=r[m].homeOffset.y-r[x].homeOffset.y;c.push({a:x,b:m,restLength:Math.sqrt(P*P+k*k)})}let j=0;for(let x=0;x<R;x++){const m=(x+1)%R;j+=r[x].homeOffset.x*r[m].homeOffset.y,j-=r[m].homeOffset.x*r[x].homeOffset.y}const g=Math.abs(j)/2;let h;if(n==="Corrupt"){const x=.5*a;h=[{offsetX:-a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:a,offsetY:-a,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-a},{x,y:-a},{x,y:a},{x:-x,y:a}],outerVertexIndices:[5,8,7,6]}].map(P=>{const k=P.points.map(C=>{const w=e+P.offsetX+C.x,T=t+P.offsetY+C.y;return{pos:{x:w,y:T},oldPos:{x:w,y:T},homeOffset:{x:C.x,y:C.y}}});return{...P,vertices:k,outerVertexIndices:P.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:c,restArea:g,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt",fillAmount:0,isShaking:!1,boopScale:1,wasFullLastFrame:!1}}function Br(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Zv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function Kv(e,t){for(const n of e.vertices){const s=Br(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=c*t.homeStiffness}for(const n of e.innerVertices){const s=Br(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,c=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=c*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Br(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const c=Br(l.homeOffset.x,l.homeOffset.y,e.rotation),a=r+c.x,u=o+c.y,f=a-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function Qv(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Jv(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function e2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y;Math.sqrt(a*a+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l],u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],R=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=R.pos.x-S.pos.x,h=R.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,P=n.attractionRadius*R.attractionRadius,k=m+P;x<k&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function t2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],c=e[o.blobB].vertices[o.vertB],a=c.pos.x-l.pos.x,u=c.pos.y-l.pos.y,f=Math.sqrt(a*a+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+c.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),S=f-o.restLength,R=a/f*S*y,j=u/f*S*y;l.pos.x+=R,l.pos.y+=j,c.pos.x-=R,c.pos.y-=j}}function n2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function vp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=n2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function s2(e){return vp(e.map(t=>t.pos))}function Bf(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const R=u/y,j=f/y,g=d/S,h=p/S,x=-j,m=R,P=-h,k=g;let C=x+P,w=m+k;const T=Math.sqrt(C*C+w*w);T<.001?(C=x,w=m):(C/=T,w/=T);const L=R*g+j*h,O=Math.sqrt((1+L)/2),X=O>.1?1/O:10,K=s[o]*.4,ee=Math.min(t,K);r.push({x:c.x+C*ee*Math.min(X,3),y:c.y+w*ee*Math.min(X,3)})}return r}function o2(){var X,K,ee;const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef(null),l=v.useRef({x:0,y:0}),[c,a]=v.useState(Xv),[u,f]=v.useState(Vv),[d,p]=v.useState(Hl.medium),[y,S]=v.useState("medium"),[R,j]=v.useState(!1),[,g]=v.useState({});v.useEffect(()=>{const I=[Wl(120,250,"T","#e74c3c"),Wl(300,250,"U","#e74c3c"),Wl(480,250,"Corrupt","#e74c3c")];s.current=I},[]),v.useEffect(()=>{let I=!0;const J=ae=>{if(I){n.current=ae,I=!1,t.current=requestAnimationFrame(J);return}const W=Math.min((ae-n.current)/1e3,.033);n.current=ae;for(const Q of s.current){Zv(Q,c,W),Kv(Q,c);for(let re=0;re<c.iterations;re++)Qv(Q,c);Q.usePressure&&Jv(Q,c),u.autoFill&&Q.fillAmount<1&&(Q.fillAmount=Math.min(1,Q.fillAmount+u.fillRate*W));const Y=Q.fillAmount>=1;if(Y&&!Q.wasFullLastFrame&&(Q.boopScale=Ff),Q.wasFullLastFrame=Y,Q.boopScale>1){const re=(Ff-1)/(qv/1e3);Q.boopScale=Math.max(1,Q.boopScale-re*W)}}r.current=e2(s.current,r.current,c),t2(s.current,r.current,c),g({}),t.current=requestAnimationFrame(J)};return t.current=requestAnimationFrame(J),()=>cancelAnimationFrame(t.current)},[c,u]);const h=v.useCallback(I=>{const J=e.current;if(!J)return;const ae=J.getBoundingClientRect(),W=I.clientX-ae.left,Q=I.clientY-ae.top;for(let Y=0;Y<s.current.length;Y++){const re=s.current[Y],te=W-re.targetX,q=Q-re.targetY;if(te*te+q*q<80*80){re.fillAmount<1&&(re.isShaking=!0,setTimeout(()=>{re.isShaking=!1,g({})},300)),o.current=Y,l.current={x:te,y:q},I.target.setPointerCapture(I.pointerId);break}}},[]),x=v.useCallback(I=>{if(o.current===null)return;const J=e.current;if(!J)return;const ae=J.getBoundingClientRect(),W=I.clientX-ae.left-l.current.x,Q=I.clientY-ae.top-l.current.y;s.current[o.current].targetX=W,s.current[o.current].targetY=Q},[]),m=v.useCallback(()=>{o.current=null},[]),P=I=>{s.current[I].rotation=(s.current[I].rotation+90)%360},k=()=>{for(const I of s.current)I.fillAmount=0,I.wasFullLastFrame=!1,I.boopScale=1},C=I=>{const J=Hl[I];J&&(p(J),S(I))},w=()=>{const{alphaMultiplier:I,alphaOffset:J}=d;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${I} ${J}`},T="#2c3e50",L=I=>{let J=1/0,ae=-1/0,W=1/0,Q=-1/0;for(const Y of I)Y.x<J&&(J=Y.x),Y.x>ae&&(ae=Y.x),Y.y<W&&(W=Y.y),Y.y>Q&&(Q=Y.y);return{minX:J,maxX:ae,minY:W,maxY:Q}},O=`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  `;return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("style",{children:O}),i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-6: Fill / Pour"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:'Goop fills the cell wall container over time  visual "time to pop" mechanic'}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Hl).map(I=>i.jsx("button",{onClick:()=>C(I),style:{padding:"8px 16px",background:y===I?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:y===I?"bold":"normal"},children:I.charAt(0).toUpperCase()+I.slice(1)},I))}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:"bold"},children:[i.jsx("input",{type:"checkbox",checked:u.autoFill,onChange:I=>f(J=>({...J,autoFill:I.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Fill Rate: ",u.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:u.fillRate,onChange:I=>f(J=>({...J,fillRate:Number(I.target.value)})),style:{width:120}})]}),i.jsx("button",{onClick:k,style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Fill"}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:12},children:[i.jsxs("span",{children:["T: ",Math.round(((X=s.current[0])==null?void 0:X.fillAmount)*100||0),"%"]}),i.jsxs("span",{children:["U: ",Math.round(((K=s.current[1])==null?void 0:K.fillAmount)*100||0),"%"]}),i.jsxs("span",{children:["C: ",Math.round(((ee=s.current[2])==null?void 0:ee.fillAmount)*100||0),"%"]})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Blur: ",d.stdDeviation]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:d.stdDeviation,onChange:I=>{p(J=>({...J,stdDeviation:Number(I.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Mult: ",d.alphaMultiplier]}),i.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:d.alphaMultiplier,onChange:I=>{p(J=>({...J,alphaMultiplier:Number(I.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Alpha Offset: ",d.alphaOffset]}),i.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:d.alphaOffset,onChange:I=>{p(J=>({...J,alphaOffset:Number(I.target.value)})),S("custom")},style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:d.enabled,onChange:I=>{p(J=>({...J,enabled:I.target.checked})),S(I.target.checked?"custom":"none")}}),i.jsx("span",{children:"Filter On"})]}),i.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[i.jsx("button",{onClick:()=>P(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),i.jsx("button",{onClick:()=>P(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),i.jsx("button",{onClick:()=>P(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),i.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",c.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:c.innerHomeStiffness,onChange:I=>a(J=>({...J,innerHomeStiffness:Number(I.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",c.goopiness,"px"]}),i.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:c.goopiness,onChange:I=>a(J=>({...J,goopiness:Number(I.target.value)})),style:{width:120}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Radius: ",c.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:c.attractionRadius,onChange:I=>a(J=>({...J,attractionRadius:Number(I.target.value)})),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{children:["Attraction Strength: ",c.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:c.attractionStiffness,onChange:I=>a(J=>({...J,attractionStiffness:Number(I.target.value)})),style:{width:100}})]}),i.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:i.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[i.jsx("input",{type:"checkbox",checked:R,onChange:I=>j(I.target.checked)}),i.jsx("span",{children:"Show Springs"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",c.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:c.tendrilEndRadius,onChange:I=>a(J=>({...J,tendrilEndRadius:Number(I.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",c.tendrilSkinniness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:c.tendrilSkinniness,onChange:I=>a(J=>({...J,tendrilSkinniness:Number(I.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[i.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",c.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:c.wallThickness,onChange:I=>a(J=>({...J,wallThickness:Number(I.target.value)})),style:{width:100}}),i.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),i.jsxs("svg",{ref:e,width:Wv,height:Uv,style:{background:T,borderRadius:8,cursor:"grab"},onPointerDown:h,onPointerMove:x,onPointerUp:m,onPointerLeave:m,children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-6",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:d.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:w(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),i.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),i.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),i.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),i.jsxs("g",{filter:d.enabled?"url(#goo-filter-6)":void 0,children:[r.current.map((I,J)=>{var se,ge;const ae=(se=s.current[I.blobA])==null?void 0:se.vertices[I.vertA],W=(ge=s.current[I.blobB])==null?void 0:ge.vertices[I.vertB];if(!ae||!W)return null;const Q=W.pos.x-ae.pos.x,Y=W.pos.y-ae.pos.y,re=Math.sqrt(Q*Q+Y*Y),te=Math.min(1,re/c.goopiness),q=c.tendrilEndRadius,pe=1-c.tendrilSkinniness,we=1-c.tendrilSkinniness*.3,E=we-(we-pe)*te,B=q*E,ve=q*1.4,ie=Math.max(2,Math.ceil(re/ve)),ye=[];for(let oe=0;oe<=ie;oe++){const ke=oe/ie,he=Math.sin(ke*Math.PI),Ee=q-(q-B)*he;ye.push({cx:ae.pos.x+Q*ke,cy:ae.pos.y+Y*ke,r:Math.max(2,Ee)})}return i.jsx("g",{children:ye.map((oe,ke)=>i.jsx("circle",{cx:oe.cx,cy:oe.cy,r:oe.r,fill:"#e74c3c"},ke))},`tendril-${J}`)}),s.current.map((I,J)=>{const ae=I.boopScale!==1?`translate(${I.targetX}, ${I.targetY}) scale(${I.boopScale}) translate(${-I.targetX}, ${-I.targetY})`:void 0;return i.jsx("g",{transform:ae,style:I.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,children:i.jsx("path",{d:s2(I.vertices),fill:I.color,stroke:I.color,strokeWidth:2})},J)})]}),s.current.map((I,J)=>{const ae=I.boopScale!==1?`translate(${I.targetX}, ${I.targetY}) scale(${I.boopScale}) translate(${-I.targetX}, ${-I.targetY})`:void 0,W=I.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,Q=(Y,re)=>{const te=L(Y),q=te.maxY-te.minY,pe=te.maxY-q*I.fillAmount,we=50;return I.fillAmount>=1?null:i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:re,children:i.jsx("rect",{x:te.minX-we,y:te.minY-we,width:te.maxX-te.minX+we*2,height:pe-te.minY+we})})}),i.jsx("path",{d:vp(Y),fill:T,clipPath:`url(#${re})`})]},re)};if(I.innerRegions)return i.jsx("g",{transform:ae,style:W,children:I.innerRegions.map((Y,re)=>{let te;Y.outerVertexIndices?te=Y.outerVertexIndices.map(pe=>I.vertices[pe].pos):te=Y.vertices.map(pe=>pe.pos);const q=Bf(te,c.wallThickness);return Q(q,`unfilled-clip-${J}-${re}`)})},`inner-group-${J}`);{const Y=I.vertices.map(te=>te.pos),re=Bf(Y,c.wallThickness);return i.jsx("g",{transform:ae,style:W,children:Q(re,`unfilled-clip-${J}`)},`inner-group-${J}`)}}),R&&r.current.map((I,J)=>{var we,E;const ae=(we=s.current[I.blobA])==null?void 0:we.vertices[I.vertA],W=(E=s.current[I.blobB])==null?void 0:E.vertices[I.vertB];if(!ae||!W)return null;const Q=W.pos.x-ae.pos.x,Y=W.pos.y-ae.pos.y,te=Math.sqrt(Q*Q+Y*Y)/c.goopiness,q=Math.min(255,Math.floor(te*255)),pe=Math.max(0,255-Math.floor(te*255));return i.jsx("line",{x1:ae.pos.x,y1:ae.pos.y,x2:W.pos.x,y2:W.pos.y,stroke:`rgb(${q},${pe},100)`,strokeWidth:2,opacity:.7},`spring-${J}`)}),s.current.map((I,J)=>i.jsx("circle",{cx:I.targetX,cy:I.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${J}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-6: Fill / Pour"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"New mechanics:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Fill Amount"}),": Each blob has 0-100% fill level (same color as outer goop)",i.jsx("br",{})," ",i.jsx("strong",{children:"Auto-Fill"}),": Fill rises over time (adjustable rate)",i.jsx("br",{})," ",i.jsx("strong",{children:"Shake on early click"}),": Click before 100% and the goop shakes",i.jsx("br",{})," ",i.jsx("strong",{children:"Boop at 100%"}),": Scale pulse from center when fill completes",i.jsx("br",{})," ",i.jsx("strong",{children:"Reset"}),": Empty all containers to start over",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Game implication:"})," Player must clear goop before it fills to 100% (pop!)",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Next:"})," Proto-7 (Pop)  what happens when fill reaches 100%?"]})]})}const Pn=6,rt=8,gt=50,Dn=50,$n=50,r2=Pn*gt+Dn*2,i2=rt*gt+$n*2,l2={damping:.97,stiffness:1,pressure:5,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Ul={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},c2={autoFill:!0,fillRate:.15},zf=1.15,a2=200,u2=200,zr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function f2(e,t){return{x:Dn+(e+.5)*gt,y:$n+(t+.5)*gt}}function si(e,t){return{x:Dn+e*gt,y:$n+t*gt}}function Ni(e){let t=0,n=0;for(const s of e){const r=f2(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function d2(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function p2(e){if(e.length===0)return[];const t=new Map;for(const l of e){const c=`${l.x1},${l.y1}`,a=`${l.x2},${l.y2}`;t.has(c)||t.set(c,[]),t.has(a)||t.set(a,[]),t.get(c).push(l),t.get(a).push(l)}const n=new Set,s=[];let r=e[0],o={x:r.x1,y:r.y1};for(;n.size<e.length;){n.add(r),s.push(si(o.x,o.y));const l=o.x===r.x1&&o.y===r.y1?{x:r.x2,y:r.y2}:{x:r.x1,y:r.y1},c=`${l.x},${l.y}`,u=(t.get(c)||[]).find(f=>!n.has(f));if(!u)break;r=u,o=l}return s}let Sp=0;function Gr(e,t,n){const s=`blob-${Sp++}`,r=d2(e),o=p2(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const j=Ni(e),g=gt*.4;o.push({x:j.x-g,y:j.y-g},{x:j.x+g,y:j.y-g},{x:j.x+g,y:j.y+g},{x:j.x-g,y:j.y+g})}const l=Ni(e),c=o.map(j=>({pos:{x:j.x,y:j.y},oldPos:{x:j.x,y:j.y},homeOffset:{x:j.x-l.x,y:j.y-l.y},mass:1,attractionRadius:1})),a=o.map(j=>({pos:{x:j.x,y:j.y},oldPos:{x:j.x,y:j.y},homeOffset:{x:j.x-l.x,y:j.y-l.y}})),u=[],f=c.length;for(let j=0;j<f;j++){const g=(j+1)%f,h=c[g].homeOffset.x-c[j].homeOffset.x,x=c[g].homeOffset.y-c[j].homeOffset.y;u.push({a:j,b:g,restLength:Math.sqrt(h*h+x*x)})}const d=[],p=gt*1.5,y=new Set;for(let j=0;j<f;j++)for(let g=j+2;g<f;g++){if(g===f-1&&j===0)continue;const h=c[g].homeOffset.x-c[j].homeOffset.x,x=c[g].homeOffset.y-c[j].homeOffset.y,m=Math.sqrt(h*h+x*x);if(m<p){const P=`${Math.min(j,g)}-${Math.max(j,g)}`;y.has(P)||(y.add(P),d.push({a:j,b:g,restLength:m}))}}let S=0;for(let j=0;j<f;j++){const g=(j+1)%f;S+=c[j].homeOffset.x*c[g].homeOffset.y,S-=c[g].homeOffset.x*c[j].homeOffset.y}const R=Math.abs(S)/2;return{id:s,vertices:c,innerVertices:a,ringsprings:u,crossSprings:d,restArea:R,targetX:l.x,targetY:l.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,boopScale:1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function h2(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const c of n){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const c of s){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const x2={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Gf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function y2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function g2(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Gf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Gf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function m2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function v2(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const c=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[c].pos.y,s-=e.vertices[c].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const c=(l-1+n)%n,a=(l+1)%n,u=e.vertices[a].pos.x-e.vertices[c].pos.x,d=-(e.vertices[a].pos.y-e.vertices[c].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function S2(e){const t=Dn,n=Dn+Pn*gt,s=$n,r=$n+rt*gt,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function C2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],R=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=R.pos.x-S.pos.x,h=R.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,P=n.attractionRadius*R.attractionRadius,k=m+P;x<k&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function k2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),R=s+S*(r-s),j=p-o.restLength,g=f/p*j*R,h=d/p*j*R;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function w2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Cp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=w2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function j2(e){return Cp(e.map(t=>t.pos))}function P2(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const R=u/y,j=f/y,g=d/S,h=p/S,x=-j,m=R,P=-h,k=g;let C=x+P,w=m+k;const T=Math.sqrt(C*C+w*w);T<.001?(C=x,w=m):(C/=T,w/=T);const L=R*g+j*h,O=Math.sqrt((1+L)/2),X=O>.1?1/O:10,K=s[o]*.4,ee=Math.min(t,K);r.push({x:c.x+C*ee*Math.min(X,3),y:c.y+w*ee*Math.min(X,3)})}return r}function R2(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(u2),[f,d]=v.useState(l2),[p,y]=v.useState(c2),[S,R]=v.useState(Ul.medium),[j,g]=v.useState("medium"),[h,x]=v.useState(!0),[m,P]=v.useState(zr[0]),[k,C]=v.useState("T"),[,w]=v.useState({}),[T,L]=v.useState(5),[O,X]=v.useState(1.5),K=v.useRef(T),ee=v.useRef(O);K.current=T,ee.current=O,v.useEffect(()=>{const E=[];for(let ge=0;ge<rt;ge++){E[ge]=[];for(let oe=0;oe<Pn;oe++)E[ge][oe]=null}r.current=E;const B=[],ve=[{x:0,y:rt-1},{x:1,y:rt-1},{x:2,y:rt-1},{x:1,y:rt-2}],ie=Gr(ve,zr[0],!0);B.push(ie);for(const ge of ve)E[ge.y][ge.x]={blobId:ie.id,color:ie.color};const ye=[{x:4,y:rt-1},{x:5,y:rt-1},{x:4,y:rt-2},{x:5,y:rt-2}],se=Gr(ye,zr[1],!0);B.push(se);for(const ge of ye)E[ge.y][ge.x]={blobId:se.id,color:se.color};s.current=B},[]),v.useEffect(()=>{let E=!0;const B=ve=>{var ye,se,ge;if(E){n.current=ve,E=!1,t.current=requestAnimationFrame(B);return}const ie=Math.min((ve-n.current)/1e3,.033);n.current=ve;for(const oe of s.current){y2(oe,f,ie),g2(oe,f);for(let he=0;he<f.iterations;he++)m2(oe,f);oe.usePressure&&v2(oe,f),S2(oe),oe.isLocked&&p.autoFill&&oe.fillAmount<1&&(oe.fillAmount=Math.min(1,oe.fillAmount+p.fillRate*ie));const ke=oe.fillAmount>=1;if(ke&&!oe.wasFullLastFrame&&(oe.boopScale=zf),oe.wasFullLastFrame=ke,oe.boopScale>1){const he=(zf-1)/(a2/1e3);oe.boopScale=Math.max(1,oe.boopScale-he*ie)}}if(l.current!==null){const oe=s.current[l.current];if(oe&&!oe.isLocked){let ke=rt-1;for(const Ie of oe.gridCells){let N=Ie.y;for(;N<rt-1;){const D=N+1,F=(ye=r.current[D])==null?void 0:ye[Ie.x];if(F&&F.blobId!==oe.id)break;N=D}N-Ie.y+oe.gridCells[0].y;const G=N-Ie.y;Ie.y+G-Ie.y<ke-oe.gridCells[0].y}let he=rt;for(const Ie of oe.gridCells){let N=0;for(;Ie.y+N+1<rt;){const G=Ie.y+N+1,Ce=(se=r.current[G])==null?void 0:se[Ie.x];if(Ce&&Ce.blobId!==oe.id)break;N++}he=Math.min(he,N)}const Ee=he*gt,Ge=a*ie,$e=Math.min(oe.visualOffsetY+Ge,Ee);for(oe.visualOffsetY=$e;oe.visualOffsetY>=gt;){for(const Ie of oe.gridCells)Ie.y+=1;oe.visualOffsetY-=gt}const Fe=Ni(oe.gridCells);oe.targetY=Fe.y+oe.visualOffsetY;let Oe=!0;for(const Ie of oe.gridCells){const N=Ie.y+1;if(N>=rt){Oe=!1;break}const G=(ge=r.current[N])==null?void 0:ge[Ie.x];if(G&&G.blobId!==oe.id){Oe=!1;break}}!Oe&&oe.visualOffsetY<.1&&(oe.visualOffsetY=0,oe.targetY=Fe.y,c.current=!0)}}o.current=C2(s.current,o.current,f),k2(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,W()),w({}),t.current=requestAnimationFrame(B)};return t.current=requestAnimationFrame(B),()=>cancelAnimationFrame(t.current)},[f,p,a]);const I=v.useCallback((E,B)=>{var ve;return B<0||B>=rt||E<0||E>=Pn?!0:((ve=r.current[B])==null?void 0:ve[E])!==null},[]),J=v.useCallback((E,B)=>{const ve=new Set,ie=r.current;for(const ye of E){const se=[{x:ye.x-1,y:ye.y},{x:ye.x+1,y:ye.y},{x:ye.x,y:ye.y-1},{x:ye.x,y:ye.y+1}];for(const ge of se)if(ge.y>=0&&ge.y<rt&&ge.x>=0&&ge.x<Pn){const oe=ie[ge.y][ge.x];oe&&oe.color===B&&ve.add(oe.blobId)}}return ve},[]),ae=v.useCallback(E=>{var se,ge,oe;const B=K.current,ve=ee.current,ie=[];for(const ke of E.gridCells){const he=ke.y+1;he<rt&&((se=r.current[he])!=null&&se[ke.x])&&ie.push(si(ke.x+.5,ke.y+1)),ke.x>0&&((ge=r.current[ke.y])!=null&&ge[ke.x-1])&&ie.push(si(ke.x,ke.y+.5)),ke.x<Pn-1&&((oe=r.current[ke.y])!=null&&oe[ke.x+1])&&ie.push(si(ke.x+1,ke.y+.5))}if(ie.length===0)return;const ye=gt*ve;for(const ke of s.current)if(ke.id!==E.id){for(const he of ke.vertices){let Ee=1/0,Ge=null;for(const $e of ie){const Fe=he.pos.x-$e.x,Oe=he.pos.y-$e.y,Ie=Math.sqrt(Fe*Fe+Oe*Oe);Ie<Ee&&(Ee=Ie,Ge=$e)}if(Ee<ye&&Ge){const $e=1-Ee/ye,Fe=B*$e*$e,Oe=(he.pos.x-Ge.x)/(Ee+.1),Ie=(he.pos.y-Ge.y)/(Ee+.1);he.oldPos.x-=Oe*Fe,he.oldPos.y-=Ie*Fe*.5}}for(const he of ke.innerVertices){let Ee=1/0,Ge=null;for(const $e of ie){const Fe=he.pos.x-$e.x,Oe=he.pos.y-$e.y,Ie=Math.sqrt(Fe*Fe+Oe*Oe);Ie<Ee&&(Ee=Ie,Ge=$e)}if(Ee<ye&&Ge){const $e=1-Ee/ye,Fe=B*$e*$e*.3,Oe=(he.pos.x-Ge.x)/(Ee+.1),Ie=(he.pos.y-Ge.y)/(Ee+.1);he.oldPos.x-=Oe*Fe,he.oldPos.y-=Ie*Fe*.5}}}},[]),W=v.useCallback(()=>{if(l.current===null)return;const E=s.current[l.current];if(!E)return;ae(E),E.visualOffsetY=0;const B=Ni(E.gridCells);E.targetY=B.y;const ve=J(E.gridCells,E.color);if(ve.size>0){const ie=[...E.gridCells],ye=[E],se=[E.id];for(const oe of ve){const ke=s.current.find(he=>he.id===oe);ke&&(ie.push(...ke.gridCells),ye.push(ke),se.push(oe))}const ge=Gr(ie,E.color,!0);h2(ge,ye);for(const oe of ie)r.current[oe.y][oe.x]={blobId:ge.id,color:ge.color};s.current=s.current.filter(oe=>!se.includes(oe.id)),s.current.push(ge),console.log(`Merged ${se.length} blobs into one with ${ie.length} cells`)}else{E.isLocked=!0,E.fillAmount=0,E.wasFullLastFrame=!1;for(const ie of E.gridCells)r.current[ie.y][ie.x]={blobId:E.id,color:E.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[J,ae]),Q=v.useCallback(()=>{if(l.current!==null)return;const E=x2[k],B=Math.floor((Pn-4)/2),ve=0,ie=E.map(se=>({x:se.x+B,y:se.y+ve}));for(const se of ie)if(I(se.x,se.y)){console.log("Cannot spawn - space occupied");return}const ye=Gr(ie,m,!1);ye.visualOffsetY=0,s.current.push(ye),l.current=s.current.length-1},[k,m,I]),Y=v.useCallback(()=>{var B;if(l.current===null)return;const E=s.current[l.current];if(E){for(;;){let ve=!0;for(const ie of E.gridCells){const ye=ie.y+1;if(ye>=rt){ve=!1;break}const se=(B=r.current[ye])==null?void 0:B[ie.x];if(se&&se.blobId!==E.id){ve=!1;break}}if(!ve)break;for(const ie of E.gridCells)ie.y+=1}E.visualOffsetY=0,W()}},[W]),re=v.useCallback(()=>{l.current=null,c.current=!1;for(let E=0;E<rt;E++)for(let B=0;B<Pn;B++)r.current[E][B]=null;s.current=[],Sp=0,o.current=[]},[]),te=E=>{const B=Ul[E];B&&(R(B),g(E))},q=()=>{const{alphaMultiplier:E,alphaOffset:B}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${E} ${B}`},pe="#2c3e50",we=E=>{let B=1/0,ve=-1/0,ie=1/0,ye=-1/0;for(const se of E)se.x<B&&(B=se.x),se.x>ve&&(ve=se.x),se.y<ie&&(ie=se.y),se.y>ye&&(ye=se.y);return{minX:B,maxX:ve,minY:ie,maxY:ye}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-7: Merge"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Dynamic blob generation when pieces lock  same-color merge with unified fill layer"}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),zr.map((E,B)=>i.jsx("button",{onClick:()=>P(E),style:{width:30,height:30,background:E,border:m===E?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},E)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(E=>i.jsx("button",{onClick:()=>C(E),style:{padding:"6px 12px",background:k===E?"#fff":"#2c3e50",color:k===E?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:E},E))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:Q,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:Y,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:re,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:E=>x(E.target.checked)}),i.jsx("span",{children:"Show Grid"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Ul).map(E=>i.jsx("button",{onClick:()=>te(E),style:{padding:"6px 12px",background:j===E?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:j===E?"bold":"normal",fontSize:12},children:E.charAt(0).toUpperCase()+E.slice(1)},E))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:E=>y(B=>({...B,fillRate:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:E=>u(Number(E.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:E=>d(B=>({...B,wallThickness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:E=>y(B=>({...B,autoFill:E.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:E=>d(B=>({...B,damping:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:E=>d(B=>({...B,stiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:f.pressure,onChange:E=>d(B=>({...B,pressure:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:E=>d(B=>({...B,homeStiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:E=>d(B=>({...B,innerHomeStiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:E=>d(B=>({...B,returnSpeed:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:E=>d(B=>({...B,viscosity:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:E=>d(B=>({...B,iterations:Number(E.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",T]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:E=>L(Number(E.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",O.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:O,onChange:E=>X(Number(E.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:E=>d(B=>({...B,goopiness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:E=>d(B=>({...B,attractionRadius:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:E=>d(B=>({...B,attractionStiffness:Number(E.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:E=>d(B=>({...B,tendrilEndRadius:Number(E.target.value)})),style:{width:80}})]})]}),i.jsxs("svg",{ref:e,width:r2,height:i2,style:{background:pe,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:q(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:Pn+1}).map((E,B)=>i.jsx("line",{x1:Dn+B*gt,y1:$n,x2:Dn+B*gt,y2:$n+rt*gt,stroke:"#fff",strokeWidth:1},`v${B}`)),Array.from({length:rt+1}).map((E,B)=>i.jsx("line",{x1:Dn,y1:$n+B*gt,x2:Dn+Pn*gt,y2:$n+B*gt,stroke:"#fff",strokeWidth:1},`h${B}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((E,B)=>{const ve=s.current[E.blobA],ie=s.current[E.blobB];if(!ve||!ie)return null;const ye=ve.vertices[E.vertA],se=ie.vertices[E.vertB];if(!ye||!se)return null;const ge=se.pos.x-ye.pos.x,oe=se.pos.y-ye.pos.y,ke=Math.sqrt(ge*ge+oe*oe),he=Math.min(1,ke/f.goopiness),Ee=f.tendrilEndRadius,Ge=1-f.tendrilSkinniness,$e=1-f.tendrilSkinniness*.3,Fe=$e-($e-Ge)*he,Oe=Ee*Fe,Ie=Ee*1.4,N=Math.max(2,Math.ceil(ke/Ie)),G=[];for(let Ce=0;Ce<=N;Ce++){const D=Ce/N,F=Math.sin(D*Math.PI),M=Ee-(Ee-Oe)*F;G.push({cx:ye.pos.x+ge*D,cy:ye.pos.y+oe*D,r:Math.max(2,M)})}return i.jsx("g",{children:G.map((Ce,D)=>i.jsx("circle",{cx:Ce.cx,cy:Ce.cy,r:Ce.r,fill:ve.color},D))},`tendril-${B}`)}),s.current.map((E,B)=>{const ve=E.boopScale!==1?`translate(${E.targetX}, ${E.targetY}) scale(${E.boopScale}) translate(${-E.targetX}, ${-E.targetY})`:void 0;return i.jsx("g",{transform:ve,children:i.jsx("path",{d:j2(E.vertices),fill:E.color,stroke:E.color,strokeWidth:2})},E.id)})]}),s.current.map(E=>{if(!E.isLocked||E.fillAmount>=1)return null;const B=E.boopScale!==1?`translate(${E.targetX}, ${E.targetY}) scale(${E.boopScale}) translate(${-E.targetX}, ${-E.targetY})`:void 0,ve=E.vertices.map(he=>he.pos),ie=P2(ve,f.wallThickness),ye=we(ie),se=ye.maxY-ye.minY,ge=ye.maxY-se*E.fillAmount,oe=50,ke=`unfilled-clip-${E.id}`;return i.jsxs("g",{transform:B,children:[i.jsx("defs",{children:i.jsx("clipPath",{id:ke,children:i.jsx("rect",{x:ye.minX-oe,y:ye.minY-oe,width:ye.maxX-ye.minX+oe*2,height:ge-ye.minY+oe})})}),i.jsx("path",{d:Cp(ie),fill:pe,clipPath:`url(#${ke})`})]},`inner-${E.id}`)}),s.current.map((E,B)=>i.jsx("text",{x:E.targetX,y:E.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:E.isLocked?`${Math.round(E.fillAmount*100)}%`:"falling"},`info-${E.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-7: Merge"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Test scenarios:"}),i.jsx("br",{})," ",i.jsx("strong",{children:"Same color adjacent"}),": Blobs merge into one, unified fill restarts",i.jsx("br",{})," ",i.jsx("strong",{children:"Different color"}),": No merge, just neighbors",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Current pieces:"})," ",s.current.length," blobs",i.jsx("br",{}),i.jsx("strong",{children:"Attraction springs:"})," ",o.current.length]})]})}const Rn=6,it=8,ut=50,hn=50,xn=50,b2=Rn*ut+hn*2,M2=it*ut+xn*2,T2={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Xl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},E2={autoFill:!0,fillRate:.15},A2=4,_2=200,Yr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function I2(e,t){return{x:hn+(e+.5)*ut,y:xn+(t+.5)*ut}}function oi(e,t){return{x:hn+e*ut,y:xn+t*ut}}function Oi(e){let t=0,n=0;for(const s of e){const r=I2(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function L2(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function N2(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(oi(c.x,c.y));const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(j=>!r.has(j));if(y.length===0)break;let S=y[0],R=1/0;for(const j of y){const g=n(j,u),h=s(a,g);(h>R||R===1/0)&&(R=h,S=j)}l=S,c=u}return o}let kp=0;function Hr(e,t,n){const s=`blob-${kp++}`,r=L2(e),o=N2(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Oi(e),x=ut*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const c=Oi(e),a=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y}})),f=[],d=a.length;for(let h=0;h<d;h++){const x=(h+1)%d,m=a[x].homeOffset.x-a[h].homeOffset.x,P=a[x].homeOffset.y-a[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(m*m+P*P)})}const p=[],y=ut*1.5,S=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const m=a[x].homeOffset.x-a[h].homeOffset.x,P=a[x].homeOffset.y-a[h].homeOffset.y,k=Math.sqrt(m*m+P*P);if(k<y){const C=`${Math.min(h,x)}-${Math.max(h,x)}`;S.has(C)||(S.add(C),p.push({a:h,b:x,restLength:k}))}}let R=0;for(let h=0;h<d;h++){const x=(h+1)%d;R+=a[h].homeOffset.x*a[x].homeOffset.y,R-=a[x].homeOffset.x*a[h].homeOffset.y}const j=R>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${R.toFixed(0)}, winding=${j}, cells=${e.length}`);const g=Math.abs(R)/2;return{id:s,vertices:a,innerVertices:u,ringsprings:f,crossSprings:p,restArea:g,targetX:c.x,targetY:c.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function O2(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const c of n){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const c of s){const a=r.pos.x-c.pos.x,u=r.pos.y-c.pos.y,f=a*a+u*u;f<o&&(o=f,l=c.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const D2={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Yf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function $2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function F2(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Yf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Yf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function B2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function z2(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,c=o.pos.y-s,a=Math.sqrt(l*l+c*c),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(a>1e-4&&u>1e-4){const d=(u-a)*r;o.pos.x+=l/a*d,o.pos.y+=c/a*d}}}function G2(e){const t=hn,n=hn+Rn*ut,s=xn,r=xn+it*ut,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function Y2(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color===a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>ut*4))for(const p of c.vertices)for(const y of a.vertices){const S=y.pos.x-p.pos.x,R=y.pos.y-p.pos.y,j=Math.sqrt(S*S+R*R);if(j<20&&j>.01){const g=20-j,h=S/j,x=R/j,m=g*.8;p.pos.x-=h*m*.5,p.pos.y-=x*m*.5,y.pos.x+=h*m*.5,y.pos.y+=x*m*.5,p.oldPos.x-=h*m*.3,p.oldPos.y-=x*m*.3,y.oldPos.x+=h*m*.3,y.oldPos.y+=x*m*.3}}}}function H2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],R=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=R.pos.x-S.pos.x,h=R.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,P=n.attractionRadius*R.attractionRadius,k=m+P;x<k&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function W2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),R=s+S*(r-s),j=p-o.restLength,g=f/p*j*R,h=d/p*j*R;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function U2(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,c=n[(r+1)%s].pos,a=l.x-o.x,u=l.y-o.y,f=c.x-l.x,d=c.y-l.y,p=Math.sqrt(a*a+u*u)||1,y=Math.sqrt(f*f+d*d)||1,S=a/p,R=u/p,j=f/y,g=d/y,h=R,x=-S,m=g,P=-j;let k=h+m,C=x+P;const w=Math.sqrt(k*k+C*C)||1;k/=w,C/=w,n[r].oldPos.x-=k*t,n[r].oldPos.y-=C*t}}function X2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function wp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=X2(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function V2(e){return wp(e.map(t=>t.pos))}function q2(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const R=u/y,j=f/y,g=d/S,h=p/S,x=-j,m=R,P=-h,k=g;let C=x+P,w=m+k;const T=Math.sqrt(C*C+w*w);T<.001?(C=x,w=m):(C/=T,w/=T);const L=R*g+j*h,O=Math.sqrt((1+L)/2),X=O>.1?1/O:10,K=s[o]*.4,ee=Math.min(t,K);r.push({x:c.x+C*ee*Math.min(X,3),y:c.y+w*ee*Math.min(X,3)})}return r}function Z2(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(_2),[f,d]=v.useState(T2),[p,y]=v.useState(E2),[S,R]=v.useState(Xl.medium),[j,g]=v.useState("medium"),[h,x]=v.useState(!0),[m,P]=v.useState(Yr[0]),[k,C]=v.useState("T"),[,w]=v.useState({}),[T,L]=v.useState(5),[O,X]=v.useState(1.5),K=v.useRef(T),ee=v.useRef(O);K.current=T,ee.current=O;const I=v.useRef([]),J=v.useRef(0),[ae,W]=v.useState(12),[Q,Y]=v.useState(150),[re,te]=v.useState(1),[q,pe]=v.useState(8),[we,E]=v.useState(!1),B="proto8-dev-settings";v.useEffect(()=>{const N=localStorage.getItem(B);if(N)try{const G=JSON.parse(N);G.physics&&d(G.physics),G.fillParams&&y(G.fillParams),G.filterParams&&(R(G.filterParams),g("custom")),G.fallSpeed&&u(G.fallSpeed),G.impactStrength&&L(G.impactStrength),G.impactRadius&&X(G.impactRadius),G.dropletCount&&W(G.dropletCount),G.dropletSpeed&&Y(G.dropletSpeed),G.dropletLifetime&&te(G.dropletLifetime),G.dropletSize&&pe(G.dropletSize),console.log("Loaded dev settings from localStorage")}catch(G){console.warn("Failed to load dev settings:",G)}},[]),v.useEffect(()=>{const N=G=>{G.key==="`"&&(G.preventDefault(),E(Ce=>!Ce))};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[]);const ve=v.useCallback(()=>{const N={physics:f,fillParams:p,filterParams:S,fallSpeed:a,impactStrength:T,impactRadius:O,dropletCount:ae,dropletSpeed:Q,dropletLifetime:re,dropletSize:q};localStorage.setItem(B,JSON.stringify(N)),console.log("Saved dev settings to localStorage")},[f,p,S,a,T,O,ae,Q,re,q]),ie=v.useCallback(()=>{const N=[];for(let $=0;$<it;$++){N[$]=[];for(let V=0;V<Rn;V++)N[$][V]=null}r.current=N,kp=0;const G=[],Ce=[{x:0,y:it-1},{x:1,y:it-1},{x:2,y:it-1},{x:1,y:it-2}],D=Hr(Ce,Yr[0],!0);G.push(D);for(const $ of Ce)N[$.y][$.x]={blobId:D.id,color:D.color};const F=[{x:4,y:it-1},{x:5,y:it-1},{x:4,y:it-2},{x:5,y:it-2}],M=Hr(F,Yr[1],!0);G.push(M);for(const $ of F)N[$.y][$.x]={blobId:M.id,color:M.color};s.current=G,o.current=[],I.current=[],l.current=null,c.current=!1},[]);v.useEffect(()=>{ie()},[ie]),v.useEffect(()=>{let N=!0;const G=Ce=>{var le,b,_;if(N){n.current=Ce,N=!1,t.current=requestAnimationFrame(G);return}const D=Math.min((Ce-n.current)/1e3,.033);n.current=Ce;for(const A of s.current){$2(A,f,D),F2(A,f);for(let z=0;z<f.iterations;z++)B2(A,f);A.usePressure&&z2(A,f),G2(A)}Y2(s.current);for(const A of s.current){A.isLocked&&p.autoFill&&A.fillAmount<1&&(A.fillAmount=Math.min(1,A.fillAmount+p.fillRate*D));const z=A.fillAmount>=1;z&&!A.wasFullLastFrame&&U2(A,A2),A.wasFullLastFrame=z}if(l.current!==null){const A=s.current[l.current];if(A&&!A.isLocked){let z=it-1;for(const be of A.gridCells){let Le=be.y;for(;Le<it-1;){const _e=Le+1,We=(le=r.current[_e])==null?void 0:le[be.x];if(We&&We.blobId!==A.id)break;Le=_e}Le-be.y+A.gridCells[0].y;const Ne=Le-be.y;be.y+Ne-be.y<z-A.gridCells[0].y}let H=it;for(const be of A.gridCells){let Le=0;for(;be.y+Le+1<it;){const Ne=be.y+Le+1,je=(b=r.current[Ne])==null?void 0:b[be.x];if(je&&je.blobId!==A.id)break;Le++}H=Math.min(H,Le)}const Z=H*ut,ne=a*D,ue=Math.min(A.visualOffsetY+ne,Z);for(A.visualOffsetY=ue;A.visualOffsetY>=ut;){for(const be of A.gridCells)be.y+=1;A.visualOffsetY-=ut}const de=Oi(A.gridCells);A.targetY=de.y+A.visualOffsetY;let Te=!0;for(const be of A.gridCells){const Le=be.y+1;if(Le>=it){Te=!1;break}const Ne=(_=r.current[Le])==null?void 0:_[be.x];if(Ne&&Ne.blobId!==A.id){Te=!1;break}}!Te&&A.visualOffsetY<.1&&(A.visualOffsetY=0,A.targetY=de.y,c.current=!0)}}o.current=H2(s.current,o.current,f),W2(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,ke());const F=300,M=hn,$=hn+Rn*ut,V=xn,U=xn+it*ut;for(const A of I.current)A.vel.y+=F*D,A.pos.x+=A.vel.x*D,A.pos.y+=A.vel.y*D,(A.pos.x+A.radius<M||A.pos.x-A.radius>$)&&(A.lifetime=0),A.pos.y+A.radius<V&&(A.lifetime=0),A.pos.y+A.radius>U&&(A.pos.y=U-A.radius,A.vel.y*=-.3),A.lifetime-=D,A.opacity=Math.max(0,A.lifetime/A.maxLifetime),A.radius*=.995;I.current=I.current.filter(A=>A.lifetime>0&&A.opacity>.01),w({}),t.current=requestAnimationFrame(G)};return t.current=requestAnimationFrame(G),()=>cancelAnimationFrame(t.current)},[f,p,a]);const ye=v.useCallback((N,G)=>{var Ce;return G<0||G>=it||N<0||N>=Rn?!0:((Ce=r.current[G])==null?void 0:Ce[N])!==null},[]),se=v.useCallback((N,G)=>{const Ce=new Set,D=r.current;for(const F of N){const M=[{x:F.x-1,y:F.y},{x:F.x+1,y:F.y},{x:F.x,y:F.y-1},{x:F.x,y:F.y+1}];for(const $ of M)if($.y>=0&&$.y<it&&$.x>=0&&$.x<Rn){const V=D[$.y][$.x];V&&V.color===G&&Ce.add(V.blobId)}}return Ce},[]),ge=v.useCallback(N=>{var M,$,V;const G=K.current,Ce=ee.current,D=[];for(const U of N.gridCells){const le=U.y+1;le<it&&((M=r.current[le])!=null&&M[U.x])&&D.push(oi(U.x+.5,U.y+1)),U.x>0&&(($=r.current[U.y])!=null&&$[U.x-1])&&D.push(oi(U.x,U.y+.5)),U.x<Rn-1&&((V=r.current[U.y])!=null&&V[U.x+1])&&D.push(oi(U.x+1,U.y+.5))}if(D.length===0)return;const F=ut*Ce;for(const U of s.current)if(U.id!==N.id){for(const le of U.vertices){let b=1/0,_=null;for(const A of D){const z=le.pos.x-A.x,H=le.pos.y-A.y,Z=Math.sqrt(z*z+H*H);Z<b&&(b=Z,_=A)}if(b<F&&_){const A=1-b/F,z=G*A*A,H=(le.pos.x-_.x)/(b+.1),Z=(le.pos.y-_.y)/(b+.1);le.oldPos.x-=H*z,le.oldPos.y-=Z*z*.5}}for(const le of U.innerVertices){let b=1/0,_=null;for(const A of D){const z=le.pos.x-A.x,H=le.pos.y-A.y,Z=Math.sqrt(z*z+H*H);Z<b&&(b=Z,_=A)}if(b<F&&_){const A=1-b/F,z=G*A*A*.3,H=(le.pos.x-_.x)/(b+.1),Z=(le.pos.y-_.y)/(b+.1);le.oldPos.x-=H*z,le.oldPos.y-=Z*z*.5}}}},[]),oe=v.useCallback(N=>{var D,F;const G=N.targetX,Ce=N.targetY;for(let M=0;M<ae;M++){const $=Math.floor(Math.random()*N.vertices.length),V=N.vertices[$],U=V.pos.x-G,le=V.pos.y-Ce,b=Math.atan2(le,U)+(Math.random()-.5)*.8,_=Q*(.5+Math.random()*.8),A={id:`droplet-${J.current++}`,pos:{x:V.pos.x,y:V.pos.y},vel:{x:Math.cos(b)*_,y:Math.sin(b)*_-50},radius:q*(.5+Math.random()*.7),color:N.color,opacity:1,lifetime:re*(.7+Math.random()*.6),maxLifetime:re};I.current.push(A),console.log("Created droplet:",A.pos,A.radius,A.color)}for(const M of N.gridCells)((F=(D=r.current[M.y])==null?void 0:D[M.x])==null?void 0:F.blobId)===N.id&&(r.current[M.y][M.x]=null);s.current=s.current.filter(M=>M.id!==N.id),console.log(`Popped blob with ${N.gridCells.length} cells, spawned ${I.current.length} droplets total`)},[ae,Q,re,q]),ke=v.useCallback(()=>{if(l.current===null)return;const N=s.current[l.current];if(!N)return;ge(N),N.visualOffsetY=0;const G=Oi(N.gridCells);N.targetY=G.y;const Ce=se(N.gridCells,N.color);if(Ce.size>0){const D=[...N.gridCells],F=[N],M=[N.id];for(const V of Ce){const U=s.current.find(le=>le.id===V);U&&(D.push(...U.gridCells),F.push(U),M.push(V))}const $=Hr(D,N.color,!0);O2($,F);for(const V of D)r.current[V.y][V.x]={blobId:$.id,color:$.color};s.current=s.current.filter(V=>!M.includes(V.id)),s.current.push($),console.log(`Merged ${M.length} blobs into one with ${D.length} cells`)}else{N.isLocked=!0,N.fillAmount=0,N.wasFullLastFrame=!1;for(const D of N.gridCells)r.current[D.y][D.x]={blobId:N.id,color:N.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[se,ge]),he=v.useCallback(()=>{if(l.current!==null)return;const N=D2[k],G=Math.floor((Rn-4)/2),Ce=0,D=N.map(M=>({x:M.x+G,y:M.y+Ce}));for(const M of D)if(ye(M.x,M.y)){console.log("Cannot spawn - space occupied");return}const F=Hr(D,m,!1);F.visualOffsetY=0,s.current.push(F),l.current=s.current.length-1},[k,m,ye]),Ee=v.useCallback(()=>{var G;if(l.current===null)return;const N=s.current[l.current];if(N){for(;;){let Ce=!0;for(const D of N.gridCells){const F=D.y+1;if(F>=it){Ce=!1;break}const M=(G=r.current[F])==null?void 0:G[D.x];if(M&&M.blobId!==N.id){Ce=!1;break}}if(!Ce)break;for(const D of N.gridCells)D.y+=1}N.visualOffsetY=0,ke()}},[ke]),Ge=v.useCallback(()=>{ie()},[ie]),$e=N=>{const G=Xl[N];G&&(R(G),g(N))},Fe=()=>{const{alphaMultiplier:N,alphaOffset:G}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${N} ${G}`},Oe="#2c3e50",Ie=N=>{let G=1/0,Ce=-1/0,D=1/0,F=-1/0;for(const M of N)M.x<G&&(G=M.x),M.x>Ce&&(Ce=M.x),M.y<D&&(D=M.y),M.y>F&&(F=M.y);return{minX:G,maxX:Ce,minY:D,maxY:F}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-8: Pop"}),i.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Pop with residue  click filled blobs to pop them, droplets scatter and fade"}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Yr.map((N,G)=>i.jsx("button",{onClick:()=>P(N),style:{width:30,height:30,background:N,border:m===N?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},N)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(N=>i.jsx("button",{onClick:()=>C(N),style:{padding:"6px 12px",background:k===N?"#fff":"#2c3e50",color:k===N?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:N},N))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:he,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:Ee,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:Ge,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:N=>x(N.target.checked)}),i.jsx("span",{children:"Show Grid"})]}),i.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),we&&i.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[i.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),i.jsxs("div",{style:{display:"flex",gap:10},children:[i.jsx("button",{onClick:ve,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),i.jsx("button",{onClick:()=>E(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Xl).map(N=>i.jsx("button",{onClick:()=>$e(N),style:{padding:"6px 12px",background:j===N?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:j===N?"bold":"normal",fontSize:12},children:N.charAt(0).toUpperCase()+N.slice(1)},N))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:N=>y(G=>({...G,fillRate:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:N=>u(Number(N.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:N=>d(G=>({...G,wallThickness:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:N=>y(G=>({...G,autoFill:N.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:N=>d(G=>({...G,damping:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:N=>d(G=>({...G,stiffness:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:N=>d(G=>({...G,pressure:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:N=>d(G=>({...G,homeStiffness:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:N=>d(G=>({...G,innerHomeStiffness:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:N=>d(G=>({...G,returnSpeed:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:N=>d(G=>({...G,viscosity:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:N=>d(G=>({...G,iterations:Number(N.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",T]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:N=>L(Number(N.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",O.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:O,onChange:N=>X(Number(N.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Droplets: ",ae]}),i.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:ae,onChange:N=>W(Number(N.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Speed: ",Q]}),i.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:Q,onChange:N=>Y(Number(N.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Lifetime: ",re.toFixed(1),"s"]}),i.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:re,onChange:N=>te(Number(N.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Size: ",q,"px"]}),i.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:q,onChange:N=>pe(Number(N.target.value)),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:N=>d(G=>({...G,goopiness:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:N=>d(G=>({...G,attractionRadius:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:N=>d(G=>({...G,attractionStiffness:Number(N.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:N=>d(G=>({...G,tendrilEndRadius:Number(N.target.value)})),style:{width:80}})]})]})]}),i.jsxs("svg",{ref:e,width:b2,height:M2,style:{background:Oe,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Fe(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:Rn+1}).map((N,G)=>i.jsx("line",{x1:hn+G*ut,y1:xn,x2:hn+G*ut,y2:xn+it*ut,stroke:"#fff",strokeWidth:1},`v${G}`)),Array.from({length:it+1}).map((N,G)=>i.jsx("line",{x1:hn,y1:xn+G*ut,x2:hn+Rn*ut,y2:xn+G*ut,stroke:"#fff",strokeWidth:1},`h${G}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((N,G)=>{const Ce=s.current[N.blobA],D=s.current[N.blobB];if(!Ce||!D)return null;const F=Ce.vertices[N.vertA],M=D.vertices[N.vertB];if(!F||!M)return null;const $=M.pos.x-F.pos.x,V=M.pos.y-F.pos.y,U=Math.sqrt($*$+V*V),le=Math.min(1,U/f.goopiness),b=f.tendrilEndRadius,_=1-f.tendrilSkinniness,A=1-f.tendrilSkinniness*.3,z=A-(A-_)*le,H=b*z,Z=b*1.4,ne=Math.max(2,Math.ceil(U/Z)),ue=[];for(let de=0;de<=ne;de++){const Te=de/ne,be=Math.sin(Te*Math.PI),Le=b-(b-H)*be;ue.push({cx:F.pos.x+$*Te,cy:F.pos.y+V*Te,r:Math.max(2,Le)})}return i.jsx("g",{children:ue.map((de,Te)=>i.jsx("circle",{cx:de.cx,cy:de.cy,r:de.r,fill:Ce.color},Te))},`tendril-${G}`)}),s.current.map((N,G)=>{const Ce=N.isLocked&&N.fillAmount>=1;return i.jsx("g",{style:{cursor:Ce?"pointer":"default"},onClick:()=>Ce&&oe(N),children:i.jsx("path",{d:V2(N.vertices),fill:N.color,stroke:N.color,strokeWidth:2})},N.id)})]}),s.current.map(N=>{if(!N.isLocked||N.fillAmount>=1)return null;const G=N.vertices.map(U=>U.pos),Ce=q2(G,f.wallThickness),D=Ie(Ce),F=D.maxY-D.minY,M=D.maxY-F*N.fillAmount,$=50,V=`unfilled-clip-${N.id}`;return i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:V,children:i.jsx("rect",{x:D.minX-$,y:D.minY-$,width:D.maxX-D.minX+$*2,height:M-D.minY+$})})}),i.jsx("path",{d:wp(Ce),fill:Oe,clipPath:`url(#${V})`})]},`inner-${N.id}`)}),i.jsx("g",{children:I.current.map(N=>i.jsx("circle",{cx:N.pos.x,cy:N.pos.y,r:N.radius,fill:N.color,opacity:N.opacity},N.id))}),s.current.filter(N=>N.gridCells.length>4).map(N=>i.jsxs("g",{children:[N.vertices.map((G,Ce)=>i.jsxs("g",{children:[i.jsx("circle",{cx:G.pos.x,cy:G.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:G.pos.x+6,y:G.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:Ce})]},`v-${Ce}`)),N.vertices.map((G,Ce)=>{const D=N.vertices[(Ce+1)%N.vertices.length];return i.jsx("line",{x1:G.pos.x,y1:G.pos.y,x2:D.pos.x,y2:D.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${Ce}`)})]},`debug-verts-${N.id}`)),s.current.map((N,G)=>i.jsx("text",{x:N.targetX,y:N.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:N.isLocked?`${Math.round(N.fillAmount*100)}%`:"falling"},`info-${N.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-8: Pop"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"How to test:"}),i.jsx("br",{})," Wait for a blob to fill to 100%",i.jsx("br",{})," Click the filled blob to pop it",i.jsx("br",{})," Droplets scatter outward and fade",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",i.jsx("strong",{children:"Droplets:"})," ",I.current.length]})]})}const en=6,Ve=8,Je=50,yn=50,gn=50,K2=en*Je+yn*2,Q2=Ve*Je+gn*2,J2={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},Vl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},e3={autoFill:!0,fillRate:.15},t3=4,n3=200,To=["#e74c3c","#3498db","#2ecc71","#f39c12"],s3={T_I_C:[{x:0,y:2},{x:0,y:3},{x:1,y:0},{x:1,y:1}],T_L_C:[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:2}],T_T_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:2,y:1}],T_S_C:[{x:0,y:2},{x:1,y:0},{x:1,y:1},{x:2,y:1}],T_O_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:1,y:2}]};function o3(e,t){return{x:yn+(e+.5)*Je,y:gn+(t+.5)*Je}}function ri(e,t){return{x:yn+e*Je,y:gn+t*Je}}function Ks(e){let t=0,n=0;for(const s of e){const r=o3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function r3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function i3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],c={x:l.x1,y:l.y1},a=n(l,c)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(ri(c.x,c.y));const u=c.x===l.x1&&c.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};a=Math.atan2(u.y-c.y,u.x-c.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(j=>!r.has(j));if(y.length===0)break;let S=y[0],R=1/0;for(const j of y){const g=n(j,u),h=s(a,g);(h>R||R===1/0)&&(R=h,S=j)}l=S,c=u}return o}let jp=0;function Xn(e,t,n){const s=`blob-${jp++}`,r=r3(e),o=i3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Ks(e),x=Je*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const c=Ks(e),a=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-c.x,y:h.y-c.y}})),f=[],d=a.length;for(let h=0;h<d;h++){const x=(h+1)%d,m=a[x].homeOffset.x-a[h].homeOffset.x,P=a[x].homeOffset.y-a[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(m*m+P*P)})}const p=[],y=Je*1.5,S=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const m=a[x].homeOffset.x-a[h].homeOffset.x,P=a[x].homeOffset.y-a[h].homeOffset.y,k=Math.sqrt(m*m+P*P);if(k<y){const C=`${Math.min(h,x)}-${Math.max(h,x)}`;S.has(C)||(S.add(C),p.push({a:h,b:x,restLength:k}))}}let R=0;for(let h=0;h<d;h++){const x=(h+1)%d;R+=a[h].homeOffset.x*a[x].homeOffset.y,R-=a[x].homeOffset.x*a[h].homeOffset.y}const j=R>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${R.toFixed(0)}, winding=${j}, cells=${e.length}`);const g=Math.abs(R)/2;return{id:s,vertices:a,innerVertices:u,ringsprings:f,crossSprings:p,restArea:g,targetX:c.x,targetY:c.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,isLoose:!1,visualOffsetY:0}}function Hf(e,t,n=.3){const s=[];for(const o of t)for(const l of o.vertices)s.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.vertices){let l=1/0,c={x:0,y:0};for(const a of s){const u=o.pos.x-a.pos.x,f=o.pos.y-a.pos.y,d=u*u+f*f;d<l&&(l=d,c=a.velocity)}o.oldPos.x=o.pos.x-c.x*n,o.oldPos.y=o.pos.y-c.y*n}const r=[];for(const o of t)for(const l of o.innerVertices)r.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.innerVertices){let l=1/0,c={x:0,y:0};for(const a of r){const u=o.pos.x-a.pos.x,f=o.pos.y-a.pos.y,d=u*u+f*f;d<l&&(l=d,c=a.velocity)}o.oldPos.x=o.pos.x-c.x*n,o.oldPos.y=o.pos.y-c.y*n}}const l3=Je*.02*1e3;function c3(e){if(e.length===0)return[];if(e.length===1)return[[...e]];const t=new Set(e.map(r=>`${r.x},${r.y}`)),n=new Set,s=[];for(const r of e){const o=`${r.x},${r.y}`;if(n.has(o))continue;const l=[],c=[r];for(;c.length>0;){const a=c.shift(),u=`${a.x},${a.y}`;if(n.has(u))continue;n.add(u),l.push(a);const f=[{x:a.x,y:a.y-1},{x:a.x,y:a.y+1},{x:a.x-1,y:a.y},{x:a.x+1,y:a.y}];for(const d of f){const p=`${d.x},${d.y}`;t.has(p)&&!n.has(p)&&c.push(d)}}l.length>0&&s.push(l)}return s}function a3(e,t,n){var s;for(const r of e.gridCells)if(r.y>=Ve-1)return!0;for(const r of e.gridCells){const o=r.y+1;if(o<Ve){const l=(s=t[o])==null?void 0:s[r.x];if(l&&l.blobId!==e.id&&n.has(l.blobId))return!0}}return!1}function Wf(e,t){var c,a;const n=new Set;for(const u of e)if(!(!u.isLocked||u.isLoose)){for(const f of u.gridCells)if(f.y>=Ve-1){n.add(u.id);break}}let s=!0;for(;s;){s=!1;for(const u of e)n.has(u.id)||!u.isLocked||u.isLoose||a3(u,t,n)&&(n.add(u.id),s=!0)}const r=[],o=[],l=[];for(const u of e){if(!u.isLocked||u.isLoose||n.has(u.id))continue;for(const d of u.gridCells)((a=(c=t[d.y])==null?void 0:c[d.x])==null?void 0:a.blobId)===u.id&&(t[d.y][d.x]=null);const f=c3(u.gridCells);if(f.length===1)u.isLocked=!1,u.isLoose=!0,u.visualOffsetY=0,r.push(u),console.log(`Blob ${u.id} became loose (lost support)`);else{console.log(`Blob ${u.id} splitting into ${f.length} disconnected pieces`),o.push(u.id);for(const d of f){const p=Xn(d,u.color,!1);p.isLocked=!1,p.isLoose=!0,p.visualOffsetY=0,p.fillAmount=u.fillAmount,l.push(p),r.push(p),console.log(`  - Created loose piece with ${d.length} cell(s)`)}}}if(o.length>0||l.length>0){const u=e.filter(f=>!o.includes(f.id));e.length=0,e.push(...u,...l)}return r}const u3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function Uf(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function f3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function d3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const c=Uf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const c=Uf(l.homeOffset.x,l.homeOffset.y,e.rotation),a=e.targetX+c.x,u=e.targetY+c.y,f=a-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function p3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,c=Math.sqrt(o*o+l*l);if(c<1e-4)continue;const u=(c-n.restLength)/c*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function h3(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,c=o.pos.y-s,a=Math.sqrt(l*l+c*c),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(a>1e-4&&u>1e-4){const d=(u-a)*r;o.pos.x+=l/a*d,o.pos.y+=c/a*d}}}function x3(e){const t=yn,n=yn+en*Je,s=gn,r=gn+Ve*Je,o=2,l=.3;for(const c of e.vertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}for(const c of e.innerVertices){if(c.pos.x<t+o){c.pos.x=t+o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.x>n-o){c.pos.x=n-o;const a=c.pos.x-c.oldPos.x;c.oldPos.x=c.pos.x-a*l}if(c.pos.y<s+o){c.pos.y=s+o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}if(c.pos.y>r-o){c.pos.y=r-o;const a=c.pos.y-c.oldPos.y;c.oldPos.y=c.pos.y-a*l}}}function y3(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color===a.color)continue;const u=c.isFalling||c.isLoose,f=a.isFalling||a.isLoose;if(!u&&!f)continue;const d=c.targetX-a.targetX,p=c.targetY-a.targetY;if(!(Math.sqrt(d*d+p*p)>Je*4))for(const S of c.vertices)for(const R of a.vertices){const j=R.pos.x-S.pos.x,g=R.pos.y-S.pos.y,h=Math.sqrt(j*j+g*g);if(h<20&&h>.01){const x=20-h,m=j/h,P=g/h,k=x*.8;S.pos.x-=m*k*.5,S.pos.y-=P*k*.5,R.pos.x+=m*k*.5,R.pos.y+=P*k*.5,S.oldPos.x-=m*k*.3,S.oldPos.y-=P*k*.3,R.oldPos.x+=m*k*.3,R.oldPos.y+=P*k*.3}}}}function g3(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c||l.color!==c.color)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const c=e[o],a=e[l];if(c.color!==a.color)continue;const u=c.targetX-a.targetX,f=c.targetY-a.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<c.vertices.length;p++)for(let y=0;y<a.vertices.length;y++){const S=c.vertices[p],R=a.vertices[y],j=`${o}-${p}-${l}-${y}`;if(r.has(j))continue;const g=R.pos.x-S.pos.x,h=R.pos.y-S.pos.y,x=Math.sqrt(g*g+h*h),m=n.attractionRadius*S.attractionRadius,P=n.attractionRadius*R.attractionRadius,k=m+P;x<k&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(j))}}return s}function m3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],c=e[o.blobB];if(!l||!c)continue;const a=l.vertices[o.vertA],u=c.vertices[o.vertB];if(!a||!u)continue;const f=u.pos.x-a.pos.x,d=u.pos.y-a.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(a.attractionRadius+u.attractionRadius),S=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),R=s+S*(r-s),j=p-o.restLength,g=f/p*j*R,h=d/p*j*R;a.pos.x+=g,a.pos.y+=h,u.pos.x-=g,u.pos.y-=h}}function v3(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,c=n[(r+1)%s].pos,a=l.x-o.x,u=l.y-o.y,f=c.x-l.x,d=c.y-l.y,p=Math.sqrt(a*a+u*u)||1,y=Math.sqrt(f*f+d*d)||1,S=a/p,R=u/p,j=f/y,g=d/y,h=R,x=-S,m=g,P=-j;let k=h+m,C=x+P;const w=Math.sqrt(k*k+C*C)||1;k/=w,C/=w,n[r].oldPos.x-=k*t,n[r].oldPos.y-=C*t}}function S3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Pp(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],c=e[(s+2)%t],{cp1:a,cp2:u}=S3(r,o,l,c);n+=` C ${a.x} ${a.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function C3(e){return Pp(e.map(t=>t.pos))}function k3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let c=1/0;for(let a=0;a<n;a++){const u=Math.abs(a-o),f=n-u;if(u<=2||f<=2)continue;const d=e[a],p=d.x-l.x,y=d.y-l.y,S=Math.sqrt(p*p+y*y);S<c&&(c=S)}s[o]=c===1/0?1e3:c}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],c=e[o],a=e[(o+1)%n],u=c.x-l.x,f=c.y-l.y,d=a.x-c.x,p=a.y-c.y,y=Math.sqrt(u*u+f*f),S=Math.sqrt(d*d+p*p);if(y<.001||S<.001){r.push(c);continue}const R=u/y,j=f/y,g=d/S,h=p/S,x=-j,m=R,P=-h,k=g;let C=x+P,w=m+k;const T=Math.sqrt(C*C+w*w);T<.001?(C=x,w=m):(C/=T,w/=T);const L=R*g+j*h,O=Math.sqrt((1+L)/2),X=O>.1?1/O:10,K=s[o]*.4,ee=Math.min(t,K);r.push({x:c.x+C*ee*Math.min(X,3),y:c.y+w*ee*Math.min(X,3)})}return r}function w3(){const e=v.useRef(null),t=v.useRef(0),n=v.useRef(0),s=v.useRef([]),r=v.useRef([]),o=v.useRef([]),l=v.useRef(null),c=v.useRef(!1),[a,u]=v.useState(n3),[f,d]=v.useState(J2),[p,y]=v.useState(e3),[S,R]=v.useState(Vl.medium),[j,g]=v.useState("medium"),[h,x]=v.useState(!0),[m,P]=v.useState(To[0]),[k,C]=v.useState("T"),[,w]=v.useState({}),[T,L]=v.useState("A"),[O,X]=v.useState("T_T_C"),[K,ee]=v.useState(0),[I,J]=v.useState(5),[ae,W]=v.useState(1.5),Q=v.useRef(I),Y=v.useRef(ae);Q.current=I,Y.current=ae;const re=v.useRef([]),te=v.useRef(0),[q,pe]=v.useState(12),[we,E]=v.useState(150),[B,ve]=v.useState(1),[ie,ye]=v.useState(8),[se,ge]=v.useState(!1),oe="proto9-dev-settings";v.useEffect(()=>{const b=localStorage.getItem(oe);if(b)try{const _=JSON.parse(b);_.physics&&d(_.physics),_.fillParams&&y(_.fillParams),_.filterParams&&(R(_.filterParams),g("custom")),_.fallSpeed&&u(_.fallSpeed),_.impactStrength&&J(_.impactStrength),_.impactRadius&&W(_.impactRadius),_.dropletCount&&pe(_.dropletCount),_.dropletSpeed&&E(_.dropletSpeed),_.dropletLifetime&&ve(_.dropletLifetime),_.dropletSize&&ye(_.dropletSize),console.log("Loaded dev settings from localStorage")}catch(_){console.warn("Failed to load dev settings:",_)}},[]),v.useEffect(()=>{const b=_=>{_.key==="`"&&(_.preventDefault(),ge(A=>!A))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]);const ke=v.useCallback(()=>{const b={physics:f,fillParams:p,filterParams:S,fallSpeed:a,impactStrength:I,impactRadius:ae,dropletCount:q,dropletSpeed:we,dropletLifetime:B,dropletSize:ie};localStorage.setItem(oe,JSON.stringify(b)),console.log("Saved dev settings to localStorage")},[f,p,S,a,I,ae,q,we,B,ie]),he=v.useCallback(()=>{const b=[];for(let de=0;de<Ve;de++){b[de]=[];for(let Te=0;Te<en;Te++)b[de][Te]=null}r.current=b,jp=0;const _=[],A=[{x:1,y:Ve-1},{x:2,y:Ve-1},{x:3,y:Ve-1},{x:4,y:Ve-1}],z=Xn(A,To[1],!0);z.fillAmount=1,z.wasFullLastFrame=!0,_.push(z);for(const de of A)b[de.y][de.x]={blobId:z.id,color:z.color};const H=[{x:1,y:Ve-2},{x:2,y:Ve-2},{x:3,y:Ve-2},{x:2,y:Ve-3}],Z=Xn(H,To[0],!0);Z.fillAmount=1,Z.wasFullLastFrame=!0,_.push(Z);for(const de of H)b[de.y][de.x]={blobId:Z.id,color:Z.color};const ne=[{x:1,y:Ve-5},{x:1,y:Ve-4},{x:2,y:Ve-4},{x:3,y:Ve-4}],ue=Xn(ne,To[1],!0);ue.fillAmount=1,ue.wasFullLastFrame=!0,_.push(ue);for(const de of ne)b[de.y][de.x]={blobId:ue.id,color:ue.color};s.current=_,o.current=[],re.current=[],l.current=null,c.current=!1,console.log("Test A initialized: 4x1 blue, T red, J blue")},[]);v.useEffect(()=>{he()},[he]);const Ee=v.useCallback(b=>{L(b),he()},[he]);v.useEffect(()=>{let b=!0;const _=A=>{var Le,Ne,je,_e,We;if(b){n.current=A,b=!1,t.current=requestAnimationFrame(_);return}const z=Math.min((A-n.current)/1e3,.033);n.current=A;for(const ce of s.current){f3(ce,f,z),d3(ce,f);for(let Be=0;Be<f.iterations;Be++)p3(ce,f);ce.usePressure&&h3(ce,f),x3(ce)}y3(s.current);for(const ce of s.current){ce.isLocked&&p.autoFill&&ce.fillAmount<1&&(ce.fillAmount=Math.min(1,ce.fillAmount+p.fillRate*z));const Be=ce.fillAmount>=1;Be&&!ce.wasFullLastFrame&&v3(ce,t3),ce.wasFullLastFrame=Be}if(l.current!==null){const ce=s.current[l.current];if(ce&&!ce.isLocked){let Be=Ve-1;for(const ot of ce.gridCells){let jt=ot.y;for(;jt<Ve-1;){const Wa=jt+1,Ua=(Le=r.current[Wa])==null?void 0:Le[ot.x];if(Ua&&Ua.blobId!==ce.id)break;jt=Wa}jt-ot.y+ce.gridCells[0].y;const An=jt-ot.y;ot.y+An-ot.y<Be-ce.gridCells[0].y}let Xe=Ve;for(const ot of ce.gridCells){let jt=0;for(;ot.y+jt+1<Ve;){const An=ot.y+jt+1,el=(Ne=r.current[An])==null?void 0:Ne[ot.x];if(el&&el.blobId!==ce.id)break;jt++}Xe=Math.min(Xe,jt)}const wt=Xe*Je,Wn=a*z,Wt=Math.min(ce.visualOffsetY+Wn,wt);for(ce.visualOffsetY=Wt;ce.visualOffsetY>=Je;){for(const ot of ce.gridCells)ot.y+=1;ce.visualOffsetY-=Je}const Es=Ks(ce.gridCells);ce.targetY=Es.y+ce.visualOffsetY;let Jt=!0;for(const ot of ce.gridCells){const jt=ot.y+1;if(jt>=Ve){Jt=!1;break}const An=(je=r.current[jt])==null?void 0:je[ot.x];if(An&&An.blobId!==ce.id){Jt=!1;break}}!Jt&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=Es.y,c.current=!0)}}const H=s.current.filter(ce=>ce.isLoose),Z=[];for(const ce of H){let Be=Ve;for(const Jt of ce.gridCells){let ot=0;for(;Jt.y+ot+1<Ve;){const jt=Jt.y+ot+1,An=(_e=r.current[jt])==null?void 0:_e[Jt.x];if(An&&An.blobId!==ce.id)break;ot++}Be=Math.min(Be,ot)}const Xe=Be*Je,wt=l3*z,Wn=Math.min(ce.visualOffsetY+wt,Xe);for(ce.visualOffsetY=Wn;ce.visualOffsetY>=Je;){for(const Jt of ce.gridCells)Jt.y+=1;ce.visualOffsetY-=Je}const Wt=Ks(ce.gridCells);ce.targetY=Wt.y+ce.visualOffsetY;let Es=!0;for(const Jt of ce.gridCells){const ot=Jt.y+1;if(ot>=Ve){Es=!1;break}const jt=(We=r.current[ot])==null?void 0:We[Jt.x];if(jt&&jt.blobId!==ce.id){Es=!1;break}}!Es&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=Wt.y,Z.push(ce))}for(const ce of Z)Ie(ce);o.current=g3(s.current,o.current,f),m3(s.current,o.current,f),c.current&&l.current!==null&&(c.current=!1,N());const ne=300,ue=yn,de=yn+en*Je,Te=gn,be=gn+Ve*Je;for(const ce of re.current)ce.vel.y+=ne*z,ce.pos.x+=ce.vel.x*z,ce.pos.y+=ce.vel.y*z,(ce.pos.x+ce.radius<ue||ce.pos.x-ce.radius>de)&&(ce.lifetime=0),ce.pos.y+ce.radius<Te&&(ce.lifetime=0),ce.pos.y+ce.radius>be&&(ce.pos.y=be-ce.radius,ce.vel.y*=-.3),ce.lifetime-=z,ce.opacity=Math.max(0,ce.lifetime/ce.maxLifetime),ce.radius*=.995;re.current=re.current.filter(ce=>ce.lifetime>0&&ce.opacity>.01),w({}),t.current=requestAnimationFrame(_)};return t.current=requestAnimationFrame(_),()=>cancelAnimationFrame(t.current)},[f,p,a]);const Ge=v.useCallback((b,_)=>{var A;return _<0||_>=Ve||b<0||b>=en?!0:((A=r.current[_])==null?void 0:A[b])!==null},[]),$e=v.useCallback((b,_)=>{const A=new Set,z=r.current;for(const H of b){const Z=[{x:H.x-1,y:H.y},{x:H.x+1,y:H.y},{x:H.x,y:H.y-1},{x:H.x,y:H.y+1}];for(const ne of Z)if(ne.y>=0&&ne.y<Ve&&ne.x>=0&&ne.x<en){const ue=z[ne.y][ne.x];ue&&ue.color===_&&A.add(ue.blobId)}}return A},[]),Fe=v.useCallback(b=>{var Z,ne,ue;const _=Q.current,A=Y.current,z=[];for(const de of b.gridCells){const Te=de.y+1;Te<Ve&&((Z=r.current[Te])!=null&&Z[de.x])&&z.push(ri(de.x+.5,de.y+1)),de.x>0&&((ne=r.current[de.y])!=null&&ne[de.x-1])&&z.push(ri(de.x,de.y+.5)),de.x<en-1&&((ue=r.current[de.y])!=null&&ue[de.x+1])&&z.push(ri(de.x+1,de.y+.5))}if(z.length===0)return;const H=Je*A;for(const de of s.current)if(de.id!==b.id){for(const Te of de.vertices){let be=1/0,Le=null;for(const Ne of z){const je=Te.pos.x-Ne.x,_e=Te.pos.y-Ne.y,We=Math.sqrt(je*je+_e*_e);We<be&&(be=We,Le=Ne)}if(be<H&&Le){const Ne=1-be/H,je=_*Ne*Ne,_e=(Te.pos.x-Le.x)/(be+.1),We=(Te.pos.y-Le.y)/(be+.1);Te.oldPos.x-=_e*je,Te.oldPos.y-=We*je*.5}}for(const Te of de.innerVertices){let be=1/0,Le=null;for(const Ne of z){const je=Te.pos.x-Ne.x,_e=Te.pos.y-Ne.y,We=Math.sqrt(je*je+_e*_e);We<be&&(be=We,Le=Ne)}if(be<H&&Le){const Ne=1-be/H,je=_*Ne*Ne*.3,_e=(Te.pos.x-Le.x)/(be+.1),We=(Te.pos.y-Le.y)/(be+.1);Te.oldPos.x-=_e*je,Te.oldPos.y-=We*je*.5}}}},[]),Oe=v.useCallback(b=>{var H,Z;const _=b.targetX,A=b.targetY;for(let ne=0;ne<q;ne++){const ue=Math.floor(Math.random()*b.vertices.length),de=b.vertices[ue],Te=de.pos.x-_,be=de.pos.y-A,Le=Math.atan2(be,Te)+(Math.random()-.5)*.8,Ne=we*(.5+Math.random()*.8),je={id:`droplet-${te.current++}`,pos:{x:de.pos.x,y:de.pos.y},vel:{x:Math.cos(Le)*Ne,y:Math.sin(Le)*Ne-50},radius:ie*(.5+Math.random()*.7),color:b.color,opacity:1,lifetime:B*(.7+Math.random()*.6),maxLifetime:B};re.current.push(je),console.log("Created droplet:",je.pos,je.radius,je.color)}for(const ne of b.gridCells)((Z=(H=r.current[ne.y])==null?void 0:H[ne.x])==null?void 0:Z.blobId)===b.id&&(r.current[ne.y][ne.x]=null);s.current=s.current.filter(ne=>ne.id!==b.id);const z=Wf(s.current,r.current);z.length>0&&console.log(`Pop created ${z.length} loose goop blob(s)`),console.log(`Popped blob with ${b.gridCells.length} cells, spawned ${re.current.length} droplets total`)},[q,we,B,ie]),Ie=v.useCallback(b=>{if(!b.isLoose)return;console.log(`Locking loose blob ${b.id}`),Fe(b),b.visualOffsetY=0;const _=Ks(b.gridCells);b.targetY=_.y;const A=$e(b.gridCells,b.color);if(A.size>0){const H=[...b.gridCells],Z=[b],ne=[b.id];for(const de of A){const Te=s.current.find(be=>be.id===de);Te&&(H.push(...Te.gridCells),Z.push(Te),ne.push(de))}const ue=Xn(H,b.color,!0);Hf(ue,Z);for(const de of H)r.current[de.y][de.x]={blobId:ue.id,color:ue.color};s.current=s.current.filter(de=>!ne.includes(de.id)),s.current.push(ue),console.log(`Loose blob merged with ${A.size} neighbor(s) into ${H.length} cells`)}else{b.isLocked=!0,b.isLoose=!1,b.fillAmount=0,b.wasFullLastFrame=!1;for(const H of b.gridCells)r.current[H.y][H.x]={blobId:b.id,color:b.color};console.log("Loose blob locked (no same-color neighbors)")}const z=Wf(s.current,r.current);z.length>0&&console.log(`Landing created ${z.length} more loose goop blob(s)`)},[$e,Fe]),N=v.useCallback(()=>{if(l.current===null)return;const b=s.current[l.current];if(!b)return;Fe(b),b.visualOffsetY=0;const _=Ks(b.gridCells);b.targetY=_.y;const A=$e(b.gridCells,b.color);if(A.size>0){const z=[...b.gridCells],H=[b],Z=[b.id];for(const ue of A){const de=s.current.find(Te=>Te.id===ue);de&&(z.push(...de.gridCells),H.push(de),Z.push(ue))}const ne=Xn(z,b.color,!0);Hf(ne,H);for(const ue of z)r.current[ue.y][ue.x]={blobId:ne.id,color:ne.color};s.current=s.current.filter(ue=>!Z.includes(ue.id)),s.current.push(ne),console.log(`Merged ${Z.length} blobs into one with ${z.length} cells`)}else{b.isLocked=!0,b.fillAmount=0,b.wasFullLastFrame=!1;for(const z of b.gridCells)r.current[z.y][z.x]={blobId:b.id,color:b.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[$e,Fe]),G=v.useCallback(()=>{if(l.current!==null)return;const b=u3[k],_=Math.floor((en-4)/2),A=0,z=b.map(Z=>({x:Z.x+_,y:Z.y+A}));for(const Z of z)if(Ge(Z.x,Z.y)){console.log("Cannot spawn - space occupied");return}const H=Xn(z,m,!1);H.visualOffsetY=0,s.current.push(H),l.current=s.current.length-1},[k,m,Ge]),Ce=(b,_)=>{let A=b.map(Z=>({...Z}));for(let Z=0;Z<_%4;Z++)A=A.map(({x:ne,y:ue})=>({x:-ue,y:ne}));const z=Math.min(...A.map(Z=>Z.x)),H=Math.min(...A.map(Z=>Z.y));return A.map(Z=>({x:Z.x-z,y:Z.y-H}))},D=v.useCallback(()=>{if(l.current!==null)return;const b=s3[O];if(!b)return;const _=Ce(b,K),A=Math.floor((en-3)/2),z=0,H=_.map(ne=>({x:ne.x+A,y:ne.y+z}));for(const ne of H){if(ne.x<0||ne.x>=en||ne.y<0||ne.y>=Ve){console.log("Cannot spawn - out of bounds");return}if(Ge(ne.x,ne.y)){console.log("Cannot spawn - space occupied");return}}const Z=Xn(H,m,!1);Z.visualOffsetY=0,s.current.push(Z),l.current=s.current.length-1,console.log(`Spawned corrupted piece ${O} with rotation ${K*90}`)},[O,K,m,Ge]),F=v.useCallback(()=>{var _;if(l.current===null)return;const b=s.current[l.current];if(b){for(;;){let A=!0;for(const z of b.gridCells){const H=z.y+1;if(H>=Ve){A=!1;break}const Z=(_=r.current[H])==null?void 0:_[z.x];if(Z&&Z.blobId!==b.id){A=!1;break}}if(!A)break;for(const z of b.gridCells)z.y+=1}b.visualOffsetY=0,N()}},[N]),M=v.useCallback(()=>{he()},[he]),$=b=>{const _=Vl[b];_&&(R(_),g(b))},V=()=>{const{alphaMultiplier:b,alphaOffset:_}=S;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${b} ${_}`},U="#2c3e50",le=b=>{let _=1/0,A=-1/0,z=1/0,H=-1/0;for(const Z of b)Z.x<_&&(_=Z.x),Z.x>A&&(A=Z.x),Z.y<z&&(z=Z.y),Z.y>H&&(H=Z.y);return{minX:_,maxX:A,minY:z,maxY:H}};return i.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[i.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-9: Loose Goop"}),i.jsxs("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:[T==="A"&&"Test A: Click red blob to pop  top blue becomes loose  falls  merges with bottom blue",T==="B"&&"Test B: Spawn corrupted pieces, build stacks, pop middle pieces to test loose goop",T==="default"&&"Default: Original Proto-8 setup with T and square pieces"]}),i.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15,background:"#8e44ad",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold",marginRight:10},children:"Test Mode:"}),i.jsx("button",{onClick:()=>Ee("A"),style:{padding:"8px 16px",background:T==="A"?"#fff":"#2c3e50",color:T==="A"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test A: Stack Pop"}),i.jsx("button",{onClick:()=>Ee("B"),style:{padding:"8px 16px",background:T==="B"?"#fff":"#2c3e50",color:T==="B"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test B: Corrupted"}),i.jsx("button",{onClick:()=>Ee("default"),style:{padding:"8px 16px",background:T==="default"?"#fff":"#2c3e50",color:T==="default"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Default"})]}),T==="A"&&i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#e74c3c",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontSize:14},children:"Blue (floor)  Red (middle)  Blue (top)"}),i.jsx("button",{onClick:()=>he(),style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Stack"})]}),T==="B"&&i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#16a085",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Corrupted Shape:"}),i.jsxs("select",{value:O,onChange:b=>X(b.target.value),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#fff",cursor:"pointer"},children:[i.jsx("option",{value:"T_T_C",children:"T Corrupted (split T)"}),i.jsx("option",{value:"T_I_C",children:"I Corrupted (split I)"}),i.jsx("option",{value:"T_L_C",children:"L Corrupted (diagonal L)"}),i.jsx("option",{value:"T_S_C",children:"S Corrupted (diagonal S)"}),i.jsx("option",{value:"T_O_C",children:"O Corrupted (split O)"})]}),i.jsx("span",{style:{fontWeight:"bold",marginLeft:10},children:"Rotate:"}),i.jsx("button",{onClick:()=>ee(b=>(b+3)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CCW"}),i.jsx("button",{onClick:()=>ee(b=>(b+1)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CW"}),i.jsxs("span",{style:{opacity:.7},children:[K*90,""]}),i.jsx("button",{onClick:D,disabled:l.current!==null,style:{padding:"8px 16px",background:l.current!==null?"#7f8c8d":"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold",marginLeft:10},children:"Spawn Corrupted"})]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[i.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),To.map((b,_)=>i.jsx("button",{onClick:()=>P(b),style:{width:30,height:30,background:b,border:m===b?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},b)),i.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(b=>i.jsx("button",{onClick:()=>C(b),style:{padding:"6px 12px",background:k===b?"#fff":"#2c3e50",color:k===b?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:b},b))]}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[i.jsx("button",{onClick:G,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),i.jsx("button",{onClick:F,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),i.jsx("button",{onClick:M,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[i.jsx("input",{type:"checkbox",checked:h,onChange:b=>x(b.target.checked)}),i.jsx("span",{children:"Show Grid"})]}),i.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),se&&i.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[i.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),i.jsxs("div",{style:{display:"flex",gap:10},children:[i.jsx("button",{onClick:ke,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),i.jsx("button",{onClick:()=>ge(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),i.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Vl).map(b=>i.jsx("button",{onClick:()=>$(b),style:{padding:"6px 12px",background:j===b?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:j===b?"bold":"normal",fontSize:12},children:b.charAt(0).toUpperCase()+b.slice(1)},b))}),i.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),i.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:b=>y(_=>({..._,fillRate:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Fall Speed: ",a,"px/s"]}),i.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:a,onChange:b=>u(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),i.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:b=>d(_=>({..._,wallThickness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[i.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:b=>y(_=>({..._,autoFill:b.target.checked}))}),i.jsx("span",{children:"Auto-Fill"})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:b=>d(_=>({..._,damping:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Stiffness: ",f.stiffness]}),i.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:b=>d(_=>({..._,stiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),i.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:b=>d(_=>({..._,pressure:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:b=>d(_=>({..._,homeStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:b=>d(_=>({..._,innerHomeStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),i.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:b=>d(_=>({..._,returnSpeed:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),i.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:b=>d(_=>({..._,viscosity:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Iterations: ",f.iterations]}),i.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:b=>d(_=>({..._,iterations:Number(b.target.value)})),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Strength: ",I]}),i.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:I,onChange:b=>J(Number(b.target.value)),style:{width:100}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Impact Radius: ",ae.toFixed(1)," cells"]}),i.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:ae,onChange:b=>W(Number(b.target.value)),style:{width:100}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Droplets: ",q]}),i.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:q,onChange:b=>pe(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Speed: ",we]}),i.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:we,onChange:b=>E(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Lifetime: ",B.toFixed(1),"s"]}),i.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:B,onChange:b=>ve(Number(b.target.value)),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Size: ",ie,"px"]}),i.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:ie,onChange:b=>ye(Number(b.target.value)),style:{width:80}})]})]}),i.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[i.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),i.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:b=>d(_=>({..._,goopiness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),i.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:b=>d(_=>({..._,attractionRadius:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),i.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:b=>d(_=>({..._,attractionStiffness:Number(b.target.value)})),style:{width:80}})]}),i.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[i.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),i.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:b=>d(_=>({..._,tendrilEndRadius:Number(b.target.value)})),style:{width:80}})]})]})]}),i.jsxs("svg",{ref:e,width:K2,height:Q2,style:{background:U,borderRadius:8},children:[i.jsx("defs",{children:i.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[i.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:S.stdDeviation,result:"blur"}),i.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:V(),result:"goo"}),i.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&i.jsxs("g",{opacity:.2,children:[Array.from({length:en+1}).map((b,_)=>i.jsx("line",{x1:yn+_*Je,y1:gn,x2:yn+_*Je,y2:gn+Ve*Je,stroke:"#fff",strokeWidth:1},`v${_}`)),Array.from({length:Ve+1}).map((b,_)=>i.jsx("line",{x1:yn,y1:gn+_*Je,x2:yn+en*Je,y2:gn+_*Je,stroke:"#fff",strokeWidth:1},`h${_}`))]}),i.jsxs("g",{filter:S.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((b,_)=>{const A=s.current[b.blobA],z=s.current[b.blobB];if(!A||!z)return null;const H=A.vertices[b.vertA],Z=z.vertices[b.vertB];if(!H||!Z)return null;const ne=Z.pos.x-H.pos.x,ue=Z.pos.y-H.pos.y,de=Math.sqrt(ne*ne+ue*ue),Te=Math.min(1,de/f.goopiness),be=f.tendrilEndRadius,Le=1-f.tendrilSkinniness,Ne=1-f.tendrilSkinniness*.3,je=Ne-(Ne-Le)*Te,_e=be*je,We=be*1.4,ce=Math.max(2,Math.ceil(de/We)),Be=[];for(let Xe=0;Xe<=ce;Xe++){const wt=Xe/ce,Wn=Math.sin(wt*Math.PI),Wt=be-(be-_e)*Wn;Be.push({cx:H.pos.x+ne*wt,cy:H.pos.y+ue*wt,r:Math.max(2,Wt)})}return i.jsx("g",{children:Be.map((Xe,wt)=>i.jsx("circle",{cx:Xe.cx,cy:Xe.cy,r:Xe.r,fill:A.color},wt))},`tendril-${_}`)}),s.current.map((b,_)=>{const A=b.isLocked&&b.fillAmount>=1;return i.jsx("g",{style:{cursor:A?"pointer":"default"},onClick:()=>A&&Oe(b),children:i.jsx("path",{d:C3(b.vertices),fill:b.color,stroke:b.color,strokeWidth:2})},b.id)})]}),s.current.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const _=b.vertices.map(de=>de.pos),A=k3(_,f.wallThickness),z=le(A),H=z.maxY-z.minY,Z=z.maxY-H*b.fillAmount,ne=50,ue=`unfilled-clip-${b.id}`;return i.jsxs("g",{children:[i.jsx("defs",{children:i.jsx("clipPath",{id:ue,children:i.jsx("rect",{x:z.minX-ne,y:z.minY-ne,width:z.maxX-z.minX+ne*2,height:Z-z.minY+ne})})}),i.jsx("path",{d:Pp(A),fill:U,clipPath:`url(#${ue})`})]},`inner-${b.id}`)}),i.jsx("g",{children:re.current.map(b=>i.jsx("circle",{cx:b.pos.x,cy:b.pos.y,r:b.radius,fill:b.color,opacity:b.opacity},b.id))}),s.current.filter(b=>b.gridCells.length>4).map(b=>i.jsxs("g",{children:[b.vertices.map((_,A)=>i.jsxs("g",{children:[i.jsx("circle",{cx:_.pos.x,cy:_.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),i.jsx("text",{x:_.pos.x+6,y:_.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:A})]},`v-${A}`)),b.vertices.map((_,A)=>{const z=b.vertices[(A+1)%b.vertices.length];return i.jsx("line",{x1:_.pos.x,y1:_.pos.y,x2:z.pos.x,y2:z.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${A}`)})]},`debug-verts-${b.id}`)),s.current.map((b,_)=>i.jsx("text",{x:b.targetX,y:b.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:b.isLocked?`${Math.round(b.fillAmount*100)}%`:"falling"},`info-${b.id}`))]}),i.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[i.jsx("strong",{children:"Proto-8: Pop"}),i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"How to test:"}),i.jsx("br",{})," Wait for a blob to fill to 100%",i.jsx("br",{})," Click the filled blob to pop it",i.jsx("br",{})," Droplets scatter outward and fade",i.jsx("br",{}),i.jsx("br",{}),i.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",i.jsx("strong",{children:"Droplets:"})," ",re.current.length]})]})}const j3=()=>new URLSearchParams(window.location.search).get("proto"),P3=()=>{const[e,t]=v.useState("GAME"),[n,s]=v.useState(()=>mm()),[r,o]=v.useState(0);Cm(),v.useEffect(()=>{vm(n)},[n]),v.useEffect(()=>{vt.init(n.settings)},[]);const l=v.useCallback(y=>{s(S=>{const R=dt(S.careerScore),{newCareerScore:j,ranksGained:g}=ap(S.careerScore,y.score,y.won),h=dt(j),x=g>0?g:0,P=lg(R.rank,h.rank).filter(k=>!S.milestonesReached.includes(k));return P.length>0&&me.emit(xe.MILESTONE_REACHED,{milestones:P}),{...S,careerScore:j,careerRank:h.rank,scraps:S.scraps+x,milestonesReached:[...S.milestonesReached,...P],firstRunComplete:!0}})},[]),c=y=>{s(S=>({...S,settings:y})),vt.updateSettings(y)},a=y=>{if(y===0){const S=Sm();s(S),o(R=>R+1),vt.init(S.settings)}else{const S=rg(y);s(R=>({...R,careerScore:S,careerRank:y,scraps:y,powerUps:{}})),o(R=>R+1)}},u=v.useCallback(y=>{s(S=>{const R=S.powerUps[y]||0,j=En[y],g=(j==null?void 0:j.maxLevel)||4,h=(j==null?void 0:j.costPerLevel)||1;return S.scraps<h||R>=g?S:{...S,scraps:S.scraps-h,powerUps:{...S.powerUps,[y]:R+1}}})},[]),f=v.useCallback(y=>{s(S=>{const R=S.powerUps[y]||0,j=En[y],g=(j==null?void 0:j.costPerLevel)||1;if(R<=0)return S;let h=S.equippedActives;return R===1&&S.equippedActives.includes(y)&&(h=S.equippedActives.filter(x=>x!==y)),{...S,scraps:S.scraps+g,powerUps:{...S.powerUps,[y]:R-1},equippedActives:h}})},[]),d=v.useCallback(y=>{s(S=>{const R=S.equippedActives.includes(y);let j;if(R)j=S.equippedActives.filter(g=>g!==y);else{const h=1+((S.powerUps.ACTIVE_EXPANSION_SLOT||0)+(S.powerUps.ACTIVE_EXPANSION_SLOT_2||0));S.equippedActives.length>=h?j=[...S.equippedActives.slice(0,h-1),y]:j=[...S.equippedActives,y]}return{...S,equippedActives:j}})},[]),p=j3();return p==="1"?i.jsx(Mm,{}):p==="2"?i.jsx(Dm,{}):p==="3"?i.jsx(Xm,{}):p==="4"?i.jsx(ov,{}):p==="5"?i.jsx(yv,{}):p==="5b"?i.jsx(Ev,{}):p==="5c"?i.jsx(Yv,{}):p==="6"?i.jsx(o2,{}):p==="7"?i.jsx(R2,{}):p==="8"?i.jsx(Z2,{}):p==="9"?i.jsx(w3,{}):i.jsxs("div",{className:"w-full h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[e==="GAME"&&i.jsx(pm,{onExit:()=>{},onRunComplete:l,initialTotalScore:n.careerScore,powerUps:n.powerUps,scraps:n.scraps,settings:n.settings,onOpenSettings:()=>t("SETTINGS"),onOpenHelp:()=>t("HOW_TO_PLAY"),onOpenUpgrades:()=>t("UPGRADES"),onSetRank:a,onPurchaseUpgrade:u,onRefundUpgrade:f,equippedActives:n.equippedActives,onToggleEquip:d},r),e==="UPGRADES"&&i.jsx(hm,{onBack:()=>t("GAME")}),e==="SETTINGS"&&i.jsx(xm,{settings:n.settings,onUpdate:c,onBack:()=>t("GAME")}),e==="HOW_TO_PLAY"&&i.jsx(ym,{onBack:()=>t("GAME")})]})},Rp=document.getElementById("root");if(!Rp)throw new Error("Could not find root element to mount to");const R3=ql.createRoot(Rp);R3.render(i.jsx(Wp.StrictMode,{children:i.jsx(P3,{})}));
