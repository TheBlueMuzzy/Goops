var sh=Object.defineProperty;var oh=(e,t,n)=>t in e?sh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Be=(e,t,n)=>(oh(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function rh(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var yd={exports:{}},Xi={},md={exports:{}},Ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gr=Symbol.for("react.element"),ih=Symbol.for("react.portal"),lh=Symbol.for("react.fragment"),ah=Symbol.for("react.strict_mode"),ch=Symbol.for("react.profiler"),uh=Symbol.for("react.provider"),fh=Symbol.for("react.context"),dh=Symbol.for("react.forward_ref"),ph=Symbol.for("react.suspense"),hh=Symbol.for("react.memo"),xh=Symbol.for("react.lazy"),lu=Symbol.iterator;function yh(e){return e===null||typeof e!="object"?null:(e=lu&&e[lu]||e["@@iterator"],typeof e=="function"?e:null)}var gd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vd=Object.assign,Sd={};function So(e,t,n){this.props=e,this.context=t,this.refs=Sd,this.updater=n||gd}So.prototype.isReactComponent={};So.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};So.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Cd(){}Cd.prototype=So.prototype;function ac(e,t,n){this.props=e,this.context=t,this.refs=Sd,this.updater=n||gd}var cc=ac.prototype=new Cd;cc.constructor=ac;vd(cc,So.prototype);cc.isPureReactComponent=!0;var au=Array.isArray,kd=Object.prototype.hasOwnProperty,uc={current:null},wd={key:!0,ref:!0,__self:!0,__source:!0};function Rd(e,t,n){var s,r={},o=null,a=null;if(t!=null)for(s in t.ref!==void 0&&(a=t.ref),t.key!==void 0&&(o=""+t.key),t)kd.call(t,s)&&!wd.hasOwnProperty(s)&&(r[s]=t[s]);var i=arguments.length-2;if(i===1)r.children=n;else if(1<i){for(var c=Array(i),u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(s in i=e.defaultProps,i)r[s]===void 0&&(r[s]=i[s]);return{$$typeof:gr,type:e,key:o,ref:a,props:r,_owner:uc.current}}function mh(e,t){return{$$typeof:gr,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function fc(e){return typeof e=="object"&&e!==null&&e.$$typeof===gr}function gh(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var cu=/\/+/g;function dl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?gh(""+e.key):t.toString(36)}function ti(e,t,n,s,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var a=!1;if(e===null)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case gr:case ih:a=!0}}if(a)return a=e,r=r(a),e=s===""?"."+dl(a,0):s,au(r)?(n="",e!=null&&(n=e.replace(cu,"$&/")+"/"),ti(r,t,n,"",function(u){return u})):r!=null&&(fc(r)&&(r=mh(r,n+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(cu,"$&/")+"/")+e)),t.push(r)),1;if(a=0,s=s===""?".":s+":",au(e))for(var i=0;i<e.length;i++){o=e[i];var c=s+dl(o,i);a+=ti(o,t,n,c,r)}else if(c=yh(e),typeof c=="function")for(e=c.call(e),i=0;!(o=e.next()).done;)o=o.value,c=s+dl(o,i++),a+=ti(o,t,n,c,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function wr(e,t,n){if(e==null)return e;var s=[],r=0;return ti(e,s,"","",function(o){return t.call(n,o,r++)}),s}function vh(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Wt={current:null},ni={transition:null},Sh={ReactCurrentDispatcher:Wt,ReactCurrentBatchConfig:ni,ReactCurrentOwner:uc};function Pd(){throw Error("act(...) is not supported in production builds of React.")}Ke.Children={map:wr,forEach:function(e,t,n){wr(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return wr(e,function(){t++}),t},toArray:function(e){return wr(e,function(t){return t})||[]},only:function(e){if(!fc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ke.Component=So;Ke.Fragment=lh;Ke.Profiler=ch;Ke.PureComponent=ac;Ke.StrictMode=ah;Ke.Suspense=ph;Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sh;Ke.act=Pd;Ke.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=vd({},e.props),r=e.key,o=e.ref,a=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,a=uc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)kd.call(t,c)&&!wd.hasOwnProperty(c)&&(s[c]=t[c]===void 0&&i!==void 0?i[c]:t[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){i=Array(c);for(var u=0;u<c;u++)i[u]=arguments[u+2];s.children=i}return{$$typeof:gr,type:e.type,key:r,ref:o,props:s,_owner:a}};Ke.createContext=function(e){return e={$$typeof:fh,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:uh,_context:e},e.Consumer=e};Ke.createElement=Rd;Ke.createFactory=function(e){var t=Rd.bind(null,e);return t.type=e,t};Ke.createRef=function(){return{current:null}};Ke.forwardRef=function(e){return{$$typeof:dh,render:e}};Ke.isValidElement=fc;Ke.lazy=function(e){return{$$typeof:xh,_payload:{_status:-1,_result:e},_init:vh}};Ke.memo=function(e,t){return{$$typeof:hh,type:e,compare:t===void 0?null:t}};Ke.startTransition=function(e){var t=ni.transition;ni.transition={};try{e()}finally{ni.transition=t}};Ke.unstable_act=Pd;Ke.useCallback=function(e,t){return Wt.current.useCallback(e,t)};Ke.useContext=function(e){return Wt.current.useContext(e)};Ke.useDebugValue=function(){};Ke.useDeferredValue=function(e){return Wt.current.useDeferredValue(e)};Ke.useEffect=function(e,t){return Wt.current.useEffect(e,t)};Ke.useId=function(){return Wt.current.useId()};Ke.useImperativeHandle=function(e,t,n){return Wt.current.useImperativeHandle(e,t,n)};Ke.useInsertionEffect=function(e,t){return Wt.current.useInsertionEffect(e,t)};Ke.useLayoutEffect=function(e,t){return Wt.current.useLayoutEffect(e,t)};Ke.useMemo=function(e,t){return Wt.current.useMemo(e,t)};Ke.useReducer=function(e,t,n){return Wt.current.useReducer(e,t,n)};Ke.useRef=function(e){return Wt.current.useRef(e)};Ke.useState=function(e){return Wt.current.useState(e)};Ke.useSyncExternalStore=function(e,t,n){return Wt.current.useSyncExternalStore(e,t,n)};Ke.useTransition=function(){return Wt.current.useTransition()};Ke.version="18.3.1";md.exports=Ke;var g=md.exports;const Ch=rh(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kh=g,wh=Symbol.for("react.element"),Rh=Symbol.for("react.fragment"),Ph=Object.prototype.hasOwnProperty,jh=kh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Th={key:!0,ref:!0,__self:!0,__source:!0};function jd(e,t,n){var s,r={},o=null,a=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(a=t.ref);for(s in t)Ph.call(t,s)&&!Th.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:wh,type:e,key:o,ref:a,props:r,_owner:jh.current}}Xi.Fragment=Rh;Xi.jsx=jd;Xi.jsxs=jd;yd.exports=Xi;var l=yd.exports,aa={},Td={exports:{}},on={},bd={exports:{}},Md={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(B,Q){var K=B.length;B.push(Q);e:for(;0<K;){var re=K-1>>>1,oe=B[re];if(0<r(oe,Q))B[re]=Q,B[K]=oe,K=re;else break e}}function n(B){return B.length===0?null:B[0]}function s(B){if(B.length===0)return null;var Q=B[0],K=B.pop();if(K!==Q){B[0]=K;e:for(var re=0,oe=B.length,ve=oe>>>1;re<ve;){var Pe=2*(re+1)-1,be=B[Pe],A=Pe+1,G=B[A];if(0>r(be,K))A<oe&&0>r(G,be)?(B[re]=G,B[A]=K,re=A):(B[re]=be,B[Pe]=K,re=Pe);else if(A<oe&&0>r(G,K))B[re]=G,B[A]=K,re=A;else break e}}return Q}function r(B,Q){var K=B.sortIndex-Q.sortIndex;return K!==0?K:B.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var a=Date,i=a.now();e.unstable_now=function(){return a.now()-i}}var c=[],u=[],f=1,d=null,p=3,y=!1,v=!1,k=!1,w=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(B){for(var Q=n(u);Q!==null;){if(Q.callback===null)s(u);else if(Q.startTime<=B)s(u),Q.sortIndex=Q.expirationTime,t(c,Q);else break;Q=n(u)}}function C(B){if(k=!1,x(B),!v)if(n(c)!==null)v=!0,Y(j);else{var Q=n(u);Q!==null&&ee(C,Q.startTime-B)}}function j(B,Q){v=!1,k&&(k=!1,m(S),S=-1),y=!0;var K=p;try{for(x(Q),d=n(c);d!==null&&(!(d.expirationTime>Q)||B&&!M());){var re=d.callback;if(typeof re=="function"){d.callback=null,p=d.priorityLevel;var oe=re(d.expirationTime<=Q);Q=e.unstable_now(),typeof oe=="function"?d.callback=oe:d===n(c)&&s(c),x(Q)}else s(c);d=n(c)}if(d!==null)var ve=!0;else{var Pe=n(u);Pe!==null&&ee(C,Pe.startTime-Q),ve=!1}return ve}finally{d=null,p=K,y=!1}}var P=!1,R=null,S=-1,T=5,E=-1;function M(){return!(e.unstable_now()-E<T)}function U(){if(R!==null){var B=e.unstable_now();E=B;var Q=!0;try{Q=R(!0,B)}finally{Q?J():(P=!1,R=null)}}else P=!1}var J;if(typeof h=="function")J=function(){h(U)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,N=se.port2;se.port1.onmessage=U,J=function(){N.postMessage(null)}}else J=function(){w(U,0)};function Y(B){R=B,P||(P=!0,J())}function ee(B,Q){S=w(function(){B(e.unstable_now())},Q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_continueExecution=function(){v||y||(v=!0,Y(j))},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(B){switch(p){case 1:case 2:case 3:var Q=3;break;default:Q=p}var K=p;p=Q;try{return B()}finally{p=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(B,Q){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var K=p;p=B;try{return Q()}finally{p=K}},e.unstable_scheduleCallback=function(B,Q,K){var re=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?re+K:re):K=re,B){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=K+oe,B={id:f++,callback:Q,priorityLevel:B,startTime:K,expirationTime:oe,sortIndex:-1},K>re?(B.sortIndex=K,t(u,B),n(c)===null&&B===n(u)&&(k?(m(S),S=-1):k=!0,ee(C,K-re))):(B.sortIndex=oe,t(c,B),v||y||(v=!0,Y(j))),B},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(B){var Q=p;return function(){var K=p;p=Q;try{return B.apply(this,arguments)}finally{p=K}}}})(Md);bd.exports=Md;var bh=bd.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mh=g,sn=bh;function Se(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ad=new Set,er={};function Ns(e,t){uo(e,t),uo(e+"Capture",t)}function uo(e,t){for(er[e]=t,e=0;e<t.length;e++)Ad.add(t[e])}var Un=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ca=Object.prototype.hasOwnProperty,Ah=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,uu={},fu={};function Eh(e){return ca.call(fu,e)?!0:ca.call(uu,e)?!1:Ah.test(e)?fu[e]=!0:(uu[e]=!0,!1)}function Ih(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function _h(e,t,n,s){if(t===null||typeof t>"u"||Ih(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ut(e,t,n,s,r,o,a){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var Dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Dt[e]=new Ut(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Dt[t]=new Ut(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Dt[e]=new Ut(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Dt[e]=new Ut(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Dt[e]=new Ut(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Dt[e]=new Ut(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Dt[e]=new Ut(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Dt[e]=new Ut(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Dt[e]=new Ut(e,5,!1,e.toLowerCase(),null,!1,!1)});var dc=/[\-:]([a-z])/g;function pc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(dc,pc);Dt[t]=new Ut(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(dc,pc);Dt[t]=new Ut(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(dc,pc);Dt[t]=new Ut(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Dt[e]=new Ut(e,1,!1,e.toLowerCase(),null,!1,!1)});Dt.xlinkHref=new Ut("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Dt[e]=new Ut(e,1,!1,e.toLowerCase(),null,!0,!0)});function hc(e,t,n,s){var r=Dt.hasOwnProperty(t)?Dt[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(_h(t,n,r,s)&&(n=null),s||r===null?Eh(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Kn=Mh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Rr=Symbol.for("react.element"),Ws=Symbol.for("react.portal"),Us=Symbol.for("react.fragment"),xc=Symbol.for("react.strict_mode"),ua=Symbol.for("react.profiler"),Ed=Symbol.for("react.provider"),Id=Symbol.for("react.context"),yc=Symbol.for("react.forward_ref"),fa=Symbol.for("react.suspense"),da=Symbol.for("react.suspense_list"),mc=Symbol.for("react.memo"),es=Symbol.for("react.lazy"),_d=Symbol.for("react.offscreen"),du=Symbol.iterator;function Ro(e){return e===null||typeof e!="object"?null:(e=du&&e[du]||e["@@iterator"],typeof e=="function"?e:null)}var St=Object.assign,pl;function $o(e){if(pl===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);pl=t&&t[1]||""}return`
`+pl+e}var hl=!1;function xl(e,t){if(!e||hl)return"";hl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),a=r.length-1,i=o.length-1;1<=a&&0<=i&&r[a]!==o[i];)i--;for(;1<=a&&0<=i;a--,i--)if(r[a]!==o[i]){if(a!==1||i!==1)do if(a--,i--,0>i||r[a]!==o[i]){var c=`
`+r[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=a&&0<=i);break}}}finally{hl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?$o(e):""}function Oh(e){switch(e.tag){case 5:return $o(e.type);case 16:return $o("Lazy");case 13:return $o("Suspense");case 19:return $o("SuspenseList");case 0:case 2:case 15:return e=xl(e.type,!1),e;case 11:return e=xl(e.type.render,!1),e;case 1:return e=xl(e.type,!0),e;default:return""}}function pa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Us:return"Fragment";case Ws:return"Portal";case ua:return"Profiler";case xc:return"StrictMode";case fa:return"Suspense";case da:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Id:return(e.displayName||"Context")+".Consumer";case Ed:return(e._context.displayName||"Context")+".Provider";case yc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case mc:return t=e.displayName||null,t!==null?t:pa(e.type)||"Memo";case es:t=e._payload,e=e._init;try{return pa(e(t))}catch{}}return null}function Lh(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pa(t);case 8:return t===xc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function xs(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Od(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Nh(e){var t=Od(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(a){s=""+a,o.call(this,a)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Pr(e){e._valueTracker||(e._valueTracker=Nh(e))}function Ld(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Od(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function yi(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ha(e,t){var n=t.checked;return St({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function pu(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=xs(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Nd(e,t){t=t.checked,t!=null&&hc(e,"checked",t,!1)}function xa(e,t){Nd(e,t);var n=xs(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ya(e,t.type,n):t.hasOwnProperty("defaultValue")&&ya(e,t.type,xs(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function hu(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function ya(e,t,n){(t!=="number"||yi(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Fo=Array.isArray;function oo(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+xs(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function ma(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Se(91));return St({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function xu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Se(92));if(Fo(n)){if(1<n.length)throw Error(Se(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:xs(n)}}function Dd(e,t){var n=xs(t.value),s=xs(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function yu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function $d(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ga(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?$d(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var jr,Fd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(jr=jr||document.createElement("div"),jr.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=jr.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function tr(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ho={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dh=["Webkit","ms","Moz","O"];Object.keys(Ho).forEach(function(e){Dh.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ho[t]=Ho[e]})});function Gd(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ho.hasOwnProperty(e)&&Ho[e]?(""+t).trim():t+"px"}function Bd(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=Gd(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var $h=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function va(e,t){if(t){if($h[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Se(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Se(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Se(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Se(62))}}function Sa(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ca=null;function gc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var ka=null,ro=null,io=null;function mu(e){if(e=Cr(e)){if(typeof ka!="function")throw Error(Se(280));var t=e.stateNode;t&&(t=Qi(t),ka(e.stateNode,e.type,t))}}function zd(e){ro?io?io.push(e):io=[e]:ro=e}function Yd(){if(ro){var e=ro,t=io;if(io=ro=null,mu(e),t)for(e=0;e<t.length;e++)mu(t[e])}}function Hd(e,t){return e(t)}function Wd(){}var yl=!1;function Ud(e,t,n){if(yl)return e(t,n);yl=!0;try{return Hd(e,t,n)}finally{yl=!1,(ro!==null||io!==null)&&(Wd(),Yd())}}function nr(e,t){var n=e.stateNode;if(n===null)return null;var s=Qi(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Se(231,t,typeof n));return n}var wa=!1;if(Un)try{var Po={};Object.defineProperty(Po,"passive",{get:function(){wa=!0}}),window.addEventListener("test",Po,Po),window.removeEventListener("test",Po,Po)}catch{wa=!1}function Fh(e,t,n,s,r,o,a,i,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(f){this.onError(f)}}var Wo=!1,mi=null,gi=!1,Ra=null,Gh={onError:function(e){Wo=!0,mi=e}};function Bh(e,t,n,s,r,o,a,i,c){Wo=!1,mi=null,Fh.apply(Gh,arguments)}function zh(e,t,n,s,r,o,a,i,c){if(Bh.apply(this,arguments),Wo){if(Wo){var u=mi;Wo=!1,mi=null}else throw Error(Se(198));gi||(gi=!0,Ra=u)}}function Ds(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Xd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function gu(e){if(Ds(e)!==e)throw Error(Se(188))}function Yh(e){var t=e.alternate;if(!t){if(t=Ds(e),t===null)throw Error(Se(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return gu(r),e;if(o===s)return gu(r),t;o=o.sibling}throw Error(Se(188))}if(n.return!==s.return)n=r,s=o;else{for(var a=!1,i=r.child;i;){if(i===n){a=!0,n=r,s=o;break}if(i===s){a=!0,s=r,n=o;break}i=i.sibling}if(!a){for(i=o.child;i;){if(i===n){a=!0,n=o,s=r;break}if(i===s){a=!0,s=o,n=r;break}i=i.sibling}if(!a)throw Error(Se(189))}}if(n.alternate!==s)throw Error(Se(190))}if(n.tag!==3)throw Error(Se(188));return n.stateNode.current===n?e:t}function Vd(e){return e=Yh(e),e!==null?qd(e):null}function qd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=qd(e);if(t!==null)return t;e=e.sibling}return null}var Kd=sn.unstable_scheduleCallback,vu=sn.unstable_cancelCallback,Hh=sn.unstable_shouldYield,Wh=sn.unstable_requestPaint,wt=sn.unstable_now,Uh=sn.unstable_getCurrentPriorityLevel,vc=sn.unstable_ImmediatePriority,Zd=sn.unstable_UserBlockingPriority,vi=sn.unstable_NormalPriority,Xh=sn.unstable_LowPriority,Qd=sn.unstable_IdlePriority,Vi=null,On=null;function Vh(e){if(On&&typeof On.onCommitFiberRoot=="function")try{On.onCommitFiberRoot(Vi,e,void 0,(e.current.flags&128)===128)}catch{}}var jn=Math.clz32?Math.clz32:Zh,qh=Math.log,Kh=Math.LN2;function Zh(e){return e>>>=0,e===0?32:31-(qh(e)/Kh|0)|0}var Tr=64,br=4194304;function Go(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Si(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes,a=n&268435455;if(a!==0){var i=a&~r;i!==0?s=Go(i):(o&=a,o!==0&&(s=Go(o)))}else a=n&~r,a!==0?s=Go(a):o!==0&&(s=Go(o));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-jn(t),r=1<<n,s|=e[n],t&=~r;return s}function Qh(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jh(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-jn(o),i=1<<a,c=r[a];c===-1?(!(i&n)||i&s)&&(r[a]=Qh(i,t)):c<=t&&(e.expiredLanes|=i),o&=~i}}function Pa(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Jd(){var e=Tr;return Tr<<=1,!(Tr&4194240)&&(Tr=64),e}function ml(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vr(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-jn(t),e[t]=n}function e1(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-jn(n),o=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~o}}function Sc(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-jn(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var at=0;function ep(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var tp,Cc,np,sp,op,ja=!1,Mr=[],is=null,ls=null,as=null,sr=new Map,or=new Map,ns=[],t1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Su(e,t){switch(e){case"focusin":case"focusout":is=null;break;case"dragenter":case"dragleave":ls=null;break;case"mouseover":case"mouseout":as=null;break;case"pointerover":case"pointerout":sr.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":or.delete(t.pointerId)}}function jo(e,t,n,s,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},t!==null&&(t=Cr(t),t!==null&&Cc(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function n1(e,t,n,s,r){switch(t){case"focusin":return is=jo(is,e,t,n,s,r),!0;case"dragenter":return ls=jo(ls,e,t,n,s,r),!0;case"mouseover":return as=jo(as,e,t,n,s,r),!0;case"pointerover":var o=r.pointerId;return sr.set(o,jo(sr.get(o)||null,e,t,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,or.set(o,jo(or.get(o)||null,e,t,n,s,r)),!0}return!1}function rp(e){var t=Ps(e.target);if(t!==null){var n=Ds(t);if(n!==null){if(t=n.tag,t===13){if(t=Xd(n),t!==null){e.blockedOn=t,op(e.priority,function(){np(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function si(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Ta(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Ca=s,n.target.dispatchEvent(s),Ca=null}else return t=Cr(n),t!==null&&Cc(t),e.blockedOn=n,!1;t.shift()}return!0}function Cu(e,t,n){si(e)&&n.delete(t)}function s1(){ja=!1,is!==null&&si(is)&&(is=null),ls!==null&&si(ls)&&(ls=null),as!==null&&si(as)&&(as=null),sr.forEach(Cu),or.forEach(Cu)}function To(e,t){e.blockedOn===t&&(e.blockedOn=null,ja||(ja=!0,sn.unstable_scheduleCallback(sn.unstable_NormalPriority,s1)))}function rr(e){function t(r){return To(r,e)}if(0<Mr.length){To(Mr[0],e);for(var n=1;n<Mr.length;n++){var s=Mr[n];s.blockedOn===e&&(s.blockedOn=null)}}for(is!==null&&To(is,e),ls!==null&&To(ls,e),as!==null&&To(as,e),sr.forEach(t),or.forEach(t),n=0;n<ns.length;n++)s=ns[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<ns.length&&(n=ns[0],n.blockedOn===null);)rp(n),n.blockedOn===null&&ns.shift()}var lo=Kn.ReactCurrentBatchConfig,Ci=!0;function o1(e,t,n,s){var r=at,o=lo.transition;lo.transition=null;try{at=1,kc(e,t,n,s)}finally{at=r,lo.transition=o}}function r1(e,t,n,s){var r=at,o=lo.transition;lo.transition=null;try{at=4,kc(e,t,n,s)}finally{at=r,lo.transition=o}}function kc(e,t,n,s){if(Ci){var r=Ta(e,t,n,s);if(r===null)Tl(e,t,s,ki,n),Su(e,s);else if(n1(r,e,t,n,s))s.stopPropagation();else if(Su(e,s),t&4&&-1<t1.indexOf(e)){for(;r!==null;){var o=Cr(r);if(o!==null&&tp(o),o=Ta(e,t,n,s),o===null&&Tl(e,t,s,ki,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else Tl(e,t,s,null,n)}}var ki=null;function Ta(e,t,n,s){if(ki=null,e=gc(s),e=Ps(e),e!==null)if(t=Ds(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Xd(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ki=e,null}function ip(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Uh()){case vc:return 1;case Zd:return 4;case vi:case Xh:return 16;case Qd:return 536870912;default:return 16}default:return 16}}var os=null,wc=null,oi=null;function lp(){if(oi)return oi;var e,t=wc,n=t.length,s,r="value"in os?os.value:os.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var a=n-e;for(s=1;s<=a&&t[n-s]===r[o-s];s++);return oi=r.slice(e,1<s?1-s:void 0)}function ri(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ar(){return!0}function ku(){return!1}function rn(e){function t(n,s,r,o,a){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=a,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(n=e[i],this[i]=n?n(o):o[i]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Ar:ku,this.isPropagationStopped=ku,this}return St(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ar)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ar)},persist:function(){},isPersistent:Ar}),t}var Co={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rc=rn(Co),Sr=St({},Co,{view:0,detail:0}),i1=rn(Sr),gl,vl,bo,qi=St({},Sr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==bo&&(bo&&e.type==="mousemove"?(gl=e.screenX-bo.screenX,vl=e.screenY-bo.screenY):vl=gl=0,bo=e),gl)},movementY:function(e){return"movementY"in e?e.movementY:vl}}),wu=rn(qi),l1=St({},qi,{dataTransfer:0}),a1=rn(l1),c1=St({},Sr,{relatedTarget:0}),Sl=rn(c1),u1=St({},Co,{animationName:0,elapsedTime:0,pseudoElement:0}),f1=rn(u1),d1=St({},Co,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),p1=rn(d1),h1=St({},Co,{data:0}),Ru=rn(h1),x1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},y1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},m1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function g1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=m1[e])?!!t[e]:!1}function Pc(){return g1}var v1=St({},Sr,{key:function(e){if(e.key){var t=x1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ri(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?y1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pc,charCode:function(e){return e.type==="keypress"?ri(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ri(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),S1=rn(v1),C1=St({},qi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pu=rn(C1),k1=St({},Sr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pc}),w1=rn(k1),R1=St({},Co,{propertyName:0,elapsedTime:0,pseudoElement:0}),P1=rn(R1),j1=St({},qi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),T1=rn(j1),b1=[9,13,27,32],jc=Un&&"CompositionEvent"in window,Uo=null;Un&&"documentMode"in document&&(Uo=document.documentMode);var M1=Un&&"TextEvent"in window&&!Uo,ap=Un&&(!jc||Uo&&8<Uo&&11>=Uo),ju=String.fromCharCode(32),Tu=!1;function cp(e,t){switch(e){case"keyup":return b1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function up(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Xs=!1;function A1(e,t){switch(e){case"compositionend":return up(t);case"keypress":return t.which!==32?null:(Tu=!0,ju);case"textInput":return e=t.data,e===ju&&Tu?null:e;default:return null}}function E1(e,t){if(Xs)return e==="compositionend"||!jc&&cp(e,t)?(e=lp(),oi=wc=os=null,Xs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ap&&t.locale!=="ko"?null:t.data;default:return null}}var I1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!I1[e.type]:t==="textarea"}function fp(e,t,n,s){zd(s),t=wi(t,"onChange"),0<t.length&&(n=new Rc("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Xo=null,ir=null;function _1(e){kp(e,0)}function Ki(e){var t=Ks(e);if(Ld(t))return e}function O1(e,t){if(e==="change")return t}var dp=!1;if(Un){var Cl;if(Un){var kl="oninput"in document;if(!kl){var Mu=document.createElement("div");Mu.setAttribute("oninput","return;"),kl=typeof Mu.oninput=="function"}Cl=kl}else Cl=!1;dp=Cl&&(!document.documentMode||9<document.documentMode)}function Au(){Xo&&(Xo.detachEvent("onpropertychange",pp),ir=Xo=null)}function pp(e){if(e.propertyName==="value"&&Ki(ir)){var t=[];fp(t,ir,e,gc(e)),Ud(_1,t)}}function L1(e,t,n){e==="focusin"?(Au(),Xo=t,ir=n,Xo.attachEvent("onpropertychange",pp)):e==="focusout"&&Au()}function N1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Ki(ir)}function D1(e,t){if(e==="click")return Ki(t)}function $1(e,t){if(e==="input"||e==="change")return Ki(t)}function F1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var bn=typeof Object.is=="function"?Object.is:F1;function lr(e,t){if(bn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!ca.call(t,r)||!bn(e[r],t[r]))return!1}return!0}function Eu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Iu(e,t){var n=Eu(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Eu(n)}}function hp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?hp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function xp(){for(var e=window,t=yi();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=yi(e.document)}return t}function Tc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function G1(e){var t=xp(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hp(n.ownerDocument.documentElement,n)){if(s!==null&&Tc(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!e.extend&&o>s&&(r=s,s=o,o=r),r=Iu(n,o);var a=Iu(n,s);r&&a&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>s?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var B1=Un&&"documentMode"in document&&11>=document.documentMode,Vs=null,ba=null,Vo=null,Ma=!1;function _u(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ma||Vs==null||Vs!==yi(s)||(s=Vs,"selectionStart"in s&&Tc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Vo&&lr(Vo,s)||(Vo=s,s=wi(ba,"onSelect"),0<s.length&&(t=new Rc("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Vs)))}function Er(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var qs={animationend:Er("Animation","AnimationEnd"),animationiteration:Er("Animation","AnimationIteration"),animationstart:Er("Animation","AnimationStart"),transitionend:Er("Transition","TransitionEnd")},wl={},yp={};Un&&(yp=document.createElement("div").style,"AnimationEvent"in window||(delete qs.animationend.animation,delete qs.animationiteration.animation,delete qs.animationstart.animation),"TransitionEvent"in window||delete qs.transitionend.transition);function Zi(e){if(wl[e])return wl[e];if(!qs[e])return e;var t=qs[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in yp)return wl[e]=t[n];return e}var mp=Zi("animationend"),gp=Zi("animationiteration"),vp=Zi("animationstart"),Sp=Zi("transitionend"),Cp=new Map,Ou="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vs(e,t){Cp.set(e,t),Ns(t,[e])}for(var Rl=0;Rl<Ou.length;Rl++){var Pl=Ou[Rl],z1=Pl.toLowerCase(),Y1=Pl[0].toUpperCase()+Pl.slice(1);vs(z1,"on"+Y1)}vs(mp,"onAnimationEnd");vs(gp,"onAnimationIteration");vs(vp,"onAnimationStart");vs("dblclick","onDoubleClick");vs("focusin","onFocus");vs("focusout","onBlur");vs(Sp,"onTransitionEnd");uo("onMouseEnter",["mouseout","mouseover"]);uo("onMouseLeave",["mouseout","mouseover"]);uo("onPointerEnter",["pointerout","pointerover"]);uo("onPointerLeave",["pointerout","pointerover"]);Ns("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ns("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ns("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ns("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ns("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ns("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),H1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bo));function Lu(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,zh(s,t,void 0,e),e.currentTarget=null}function kp(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var a=s.length-1;0<=a;a--){var i=s[a],c=i.instance,u=i.currentTarget;if(i=i.listener,c!==o&&r.isPropagationStopped())break e;Lu(r,i,u),o=c}else for(a=0;a<s.length;a++){if(i=s[a],c=i.instance,u=i.currentTarget,i=i.listener,c!==o&&r.isPropagationStopped())break e;Lu(r,i,u),o=c}}}if(gi)throw e=Ra,gi=!1,Ra=null,e}function ft(e,t){var n=t[Oa];n===void 0&&(n=t[Oa]=new Set);var s=e+"__bubble";n.has(s)||(wp(t,e,2,!1),n.add(s))}function jl(e,t,n){var s=0;t&&(s|=4),wp(n,e,s,t)}var Ir="_reactListening"+Math.random().toString(36).slice(2);function ar(e){if(!e[Ir]){e[Ir]=!0,Ad.forEach(function(n){n!=="selectionchange"&&(H1.has(n)||jl(n,!1,e),jl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ir]||(t[Ir]=!0,jl("selectionchange",!1,t))}}function wp(e,t,n,s){switch(ip(t)){case 1:var r=o1;break;case 4:r=r1;break;default:r=kc}n=r.bind(null,t,n,e),r=void 0,!wa||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function Tl(e,t,n,s,r){var o=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var a=s.tag;if(a===3||a===4){var i=s.stateNode.containerInfo;if(i===r||i.nodeType===8&&i.parentNode===r)break;if(a===4)for(a=s.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;a=a.return}for(;i!==null;){if(a=Ps(i),a===null)return;if(c=a.tag,c===5||c===6){s=o=a;continue e}i=i.parentNode}}s=s.return}Ud(function(){var u=o,f=gc(n),d=[];e:{var p=Cp.get(e);if(p!==void 0){var y=Rc,v=e;switch(e){case"keypress":if(ri(n)===0)break e;case"keydown":case"keyup":y=S1;break;case"focusin":v="focus",y=Sl;break;case"focusout":v="blur",y=Sl;break;case"beforeblur":case"afterblur":y=Sl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=wu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=a1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=w1;break;case mp:case gp:case vp:y=f1;break;case Sp:y=P1;break;case"scroll":y=i1;break;case"wheel":y=T1;break;case"copy":case"cut":case"paste":y=p1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Pu}var k=(t&4)!==0,w=!k&&e==="scroll",m=k?p!==null?p+"Capture":null:p;k=[];for(var h=u,x;h!==null;){x=h;var C=x.stateNode;if(x.tag===5&&C!==null&&(x=C,m!==null&&(C=nr(h,m),C!=null&&k.push(cr(h,C,x)))),w)break;h=h.return}0<k.length&&(p=new y(p,v,null,n,f),d.push({event:p,listeners:k}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",p&&n!==Ca&&(v=n.relatedTarget||n.fromElement)&&(Ps(v)||v[Xn]))break e;if((y||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,y?(v=n.relatedTarget||n.toElement,y=u,v=v?Ps(v):null,v!==null&&(w=Ds(v),v!==w||v.tag!==5&&v.tag!==6)&&(v=null)):(y=null,v=u),y!==v)){if(k=wu,C="onMouseLeave",m="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(k=Pu,C="onPointerLeave",m="onPointerEnter",h="pointer"),w=y==null?p:Ks(y),x=v==null?p:Ks(v),p=new k(C,h+"leave",y,n,f),p.target=w,p.relatedTarget=x,C=null,Ps(f)===u&&(k=new k(m,h+"enter",v,n,f),k.target=x,k.relatedTarget=w,C=k),w=C,y&&v)t:{for(k=y,m=v,h=0,x=k;x;x=$s(x))h++;for(x=0,C=m;C;C=$s(C))x++;for(;0<h-x;)k=$s(k),h--;for(;0<x-h;)m=$s(m),x--;for(;h--;){if(k===m||m!==null&&k===m.alternate)break t;k=$s(k),m=$s(m)}k=null}else k=null;y!==null&&Nu(d,p,y,k,!1),v!==null&&w!==null&&Nu(d,w,v,k,!0)}}e:{if(p=u?Ks(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var j=O1;else if(bu(p))if(dp)j=$1;else{j=N1;var P=L1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(j=D1);if(j&&(j=j(e,u))){fp(d,j,n,f);break e}P&&P(e,p,u),e==="focusout"&&(P=p._wrapperState)&&P.controlled&&p.type==="number"&&ya(p,"number",p.value)}switch(P=u?Ks(u):window,e){case"focusin":(bu(P)||P.contentEditable==="true")&&(Vs=P,ba=u,Vo=null);break;case"focusout":Vo=ba=Vs=null;break;case"mousedown":Ma=!0;break;case"contextmenu":case"mouseup":case"dragend":Ma=!1,_u(d,n,f);break;case"selectionchange":if(B1)break;case"keydown":case"keyup":_u(d,n,f)}var R;if(jc)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Xs?cp(e,n)&&(S="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(ap&&n.locale!=="ko"&&(Xs||S!=="onCompositionStart"?S==="onCompositionEnd"&&Xs&&(R=lp()):(os=f,wc="value"in os?os.value:os.textContent,Xs=!0)),P=wi(u,S),0<P.length&&(S=new Ru(S,e,null,n,f),d.push({event:S,listeners:P}),R?S.data=R:(R=up(n),R!==null&&(S.data=R)))),(R=M1?A1(e,n):E1(e,n))&&(u=wi(u,"onBeforeInput"),0<u.length&&(f=new Ru("onBeforeInput","beforeinput",null,n,f),d.push({event:f,listeners:u}),f.data=R))}kp(d,t)})}function cr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function wi(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=nr(e,n),o!=null&&s.unshift(cr(e,o,r)),o=nr(e,t),o!=null&&s.push(cr(e,o,r))),e=e.return}return s}function $s(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Nu(e,t,n,s,r){for(var o=t._reactName,a=[];n!==null&&n!==s;){var i=n,c=i.alternate,u=i.stateNode;if(c!==null&&c===s)break;i.tag===5&&u!==null&&(i=u,r?(c=nr(n,o),c!=null&&a.unshift(cr(n,c,i))):r||(c=nr(n,o),c!=null&&a.push(cr(n,c,i)))),n=n.return}a.length!==0&&e.push({event:t,listeners:a})}var W1=/\r\n?/g,U1=/\u0000|\uFFFD/g;function Du(e){return(typeof e=="string"?e:""+e).replace(W1,`
`).replace(U1,"")}function _r(e,t,n){if(t=Du(t),Du(e)!==t&&n)throw Error(Se(425))}function Ri(){}var Aa=null,Ea=null;function Ia(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var _a=typeof setTimeout=="function"?setTimeout:void 0,X1=typeof clearTimeout=="function"?clearTimeout:void 0,$u=typeof Promise=="function"?Promise:void 0,V1=typeof queueMicrotask=="function"?queueMicrotask:typeof $u<"u"?function(e){return $u.resolve(null).then(e).catch(q1)}:_a;function q1(e){setTimeout(function(){throw e})}function bl(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),rr(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);rr(t)}function cs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Fu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var ko=Math.random().toString(36).slice(2),_n="__reactFiber$"+ko,ur="__reactProps$"+ko,Xn="__reactContainer$"+ko,Oa="__reactEvents$"+ko,K1="__reactListeners$"+ko,Z1="__reactHandles$"+ko;function Ps(e){var t=e[_n];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Xn]||n[_n]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Fu(e);e!==null;){if(n=e[_n])return n;e=Fu(e)}return t}e=n,n=e.parentNode}return null}function Cr(e){return e=e[_n]||e[Xn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ks(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Se(33))}function Qi(e){return e[ur]||null}var La=[],Zs=-1;function Ss(e){return{current:e}}function dt(e){0>Zs||(e.current=La[Zs],La[Zs]=null,Zs--)}function ut(e,t){Zs++,La[Zs]=e.current,e.current=t}var ys={},zt=Ss(ys),qt=Ss(!1),Es=ys;function fo(e,t){var n=e.type.contextTypes;if(!n)return ys;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Kt(e){return e=e.childContextTypes,e!=null}function Pi(){dt(qt),dt(zt)}function Gu(e,t,n){if(zt.current!==ys)throw Error(Se(168));ut(zt,t),ut(qt,n)}function Rp(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(Se(108,Lh(e)||"Unknown",r));return St({},n,s)}function ji(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ys,Es=zt.current,ut(zt,e),ut(qt,qt.current),!0}function Bu(e,t,n){var s=e.stateNode;if(!s)throw Error(Se(169));n?(e=Rp(e,t,Es),s.__reactInternalMemoizedMergedChildContext=e,dt(qt),dt(zt),ut(zt,e)):dt(qt),ut(qt,n)}var $n=null,Ji=!1,Ml=!1;function Pp(e){$n===null?$n=[e]:$n.push(e)}function Q1(e){Ji=!0,Pp(e)}function Cs(){if(!Ml&&$n!==null){Ml=!0;var e=0,t=at;try{var n=$n;for(at=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}$n=null,Ji=!1}catch(r){throw $n!==null&&($n=$n.slice(e+1)),Kd(vc,Cs),r}finally{at=t,Ml=!1}}return null}var Qs=[],Js=0,Ti=null,bi=0,an=[],cn=0,Is=null,Gn=1,Bn="";function ws(e,t){Qs[Js++]=bi,Qs[Js++]=Ti,Ti=e,bi=t}function jp(e,t,n){an[cn++]=Gn,an[cn++]=Bn,an[cn++]=Is,Is=e;var s=Gn;e=Bn;var r=32-jn(s)-1;s&=~(1<<r),n+=1;var o=32-jn(t)+r;if(30<o){var a=r-r%5;o=(s&(1<<a)-1).toString(32),s>>=a,r-=a,Gn=1<<32-jn(t)+r|n<<r|s,Bn=o+e}else Gn=1<<o|n<<r|s,Bn=e}function bc(e){e.return!==null&&(ws(e,1),jp(e,1,0))}function Mc(e){for(;e===Ti;)Ti=Qs[--Js],Qs[Js]=null,bi=Qs[--Js],Qs[Js]=null;for(;e===Is;)Is=an[--cn],an[cn]=null,Bn=an[--cn],an[cn]=null,Gn=an[--cn],an[cn]=null}var nn=null,tn=null,pt=!1,gn=null;function Tp(e,t){var n=un(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function zu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,nn=e,tn=cs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,nn=e,tn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=Is!==null?{id:Gn,overflow:Bn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=un(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,nn=e,tn=null,!0):!1;default:return!1}}function Na(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Da(e){if(pt){var t=tn;if(t){var n=t;if(!zu(e,t)){if(Na(e))throw Error(Se(418));t=cs(n.nextSibling);var s=nn;t&&zu(e,t)?Tp(s,n):(e.flags=e.flags&-4097|2,pt=!1,nn=e)}}else{if(Na(e))throw Error(Se(418));e.flags=e.flags&-4097|2,pt=!1,nn=e}}}function Yu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;nn=e}function Or(e){if(e!==nn)return!1;if(!pt)return Yu(e),pt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ia(e.type,e.memoizedProps)),t&&(t=tn)){if(Na(e))throw bp(),Error(Se(418));for(;t;)Tp(e,t),t=cs(t.nextSibling)}if(Yu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Se(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){tn=cs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}tn=null}}else tn=nn?cs(e.stateNode.nextSibling):null;return!0}function bp(){for(var e=tn;e;)e=cs(e.nextSibling)}function po(){tn=nn=null,pt=!1}function Ac(e){gn===null?gn=[e]:gn.push(e)}var J1=Kn.ReactCurrentBatchConfig;function Mo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Se(309));var s=n.stateNode}if(!s)throw Error(Se(147,e));var r=s,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(a){var i=r.refs;a===null?delete i[o]:i[o]=a},t._stringRef=o,t)}if(typeof e!="string")throw Error(Se(284));if(!n._owner)throw Error(Se(290,e))}return e}function Lr(e,t){throw e=Object.prototype.toString.call(t),Error(Se(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Hu(e){var t=e._init;return t(e._payload)}function Mp(e){function t(m,h){if(e){var x=m.deletions;x===null?(m.deletions=[h],m.flags|=16):x.push(h)}}function n(m,h){if(!e)return null;for(;h!==null;)t(m,h),h=h.sibling;return null}function s(m,h){for(m=new Map;h!==null;)h.key!==null?m.set(h.key,h):m.set(h.index,h),h=h.sibling;return m}function r(m,h){return m=ps(m,h),m.index=0,m.sibling=null,m}function o(m,h,x){return m.index=x,e?(x=m.alternate,x!==null?(x=x.index,x<h?(m.flags|=2,h):x):(m.flags|=2,h)):(m.flags|=1048576,h)}function a(m){return e&&m.alternate===null&&(m.flags|=2),m}function i(m,h,x,C){return h===null||h.tag!==6?(h=Nl(x,m.mode,C),h.return=m,h):(h=r(h,x),h.return=m,h)}function c(m,h,x,C){var j=x.type;return j===Us?f(m,h,x.props.children,C,x.key):h!==null&&(h.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===es&&Hu(j)===h.type)?(C=r(h,x.props),C.ref=Mo(m,h,x),C.return=m,C):(C=di(x.type,x.key,x.props,null,m.mode,C),C.ref=Mo(m,h,x),C.return=m,C)}function u(m,h,x,C){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=Dl(x,m.mode,C),h.return=m,h):(h=r(h,x.children||[]),h.return=m,h)}function f(m,h,x,C,j){return h===null||h.tag!==7?(h=As(x,m.mode,C,j),h.return=m,h):(h=r(h,x),h.return=m,h)}function d(m,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Nl(""+h,m.mode,x),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Rr:return x=di(h.type,h.key,h.props,null,m.mode,x),x.ref=Mo(m,null,h),x.return=m,x;case Ws:return h=Dl(h,m.mode,x),h.return=m,h;case es:var C=h._init;return d(m,C(h._payload),x)}if(Fo(h)||Ro(h))return h=As(h,m.mode,x,null),h.return=m,h;Lr(m,h)}return null}function p(m,h,x,C){var j=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return j!==null?null:i(m,h,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Rr:return x.key===j?c(m,h,x,C):null;case Ws:return x.key===j?u(m,h,x,C):null;case es:return j=x._init,p(m,h,j(x._payload),C)}if(Fo(x)||Ro(x))return j!==null?null:f(m,h,x,C,null);Lr(m,x)}return null}function y(m,h,x,C,j){if(typeof C=="string"&&C!==""||typeof C=="number")return m=m.get(x)||null,i(h,m,""+C,j);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Rr:return m=m.get(C.key===null?x:C.key)||null,c(h,m,C,j);case Ws:return m=m.get(C.key===null?x:C.key)||null,u(h,m,C,j);case es:var P=C._init;return y(m,h,x,P(C._payload),j)}if(Fo(C)||Ro(C))return m=m.get(x)||null,f(h,m,C,j,null);Lr(h,C)}return null}function v(m,h,x,C){for(var j=null,P=null,R=h,S=h=0,T=null;R!==null&&S<x.length;S++){R.index>S?(T=R,R=null):T=R.sibling;var E=p(m,R,x[S],C);if(E===null){R===null&&(R=T);break}e&&R&&E.alternate===null&&t(m,R),h=o(E,h,S),P===null?j=E:P.sibling=E,P=E,R=T}if(S===x.length)return n(m,R),pt&&ws(m,S),j;if(R===null){for(;S<x.length;S++)R=d(m,x[S],C),R!==null&&(h=o(R,h,S),P===null?j=R:P.sibling=R,P=R);return pt&&ws(m,S),j}for(R=s(m,R);S<x.length;S++)T=y(R,m,S,x[S],C),T!==null&&(e&&T.alternate!==null&&R.delete(T.key===null?S:T.key),h=o(T,h,S),P===null?j=T:P.sibling=T,P=T);return e&&R.forEach(function(M){return t(m,M)}),pt&&ws(m,S),j}function k(m,h,x,C){var j=Ro(x);if(typeof j!="function")throw Error(Se(150));if(x=j.call(x),x==null)throw Error(Se(151));for(var P=j=null,R=h,S=h=0,T=null,E=x.next();R!==null&&!E.done;S++,E=x.next()){R.index>S?(T=R,R=null):T=R.sibling;var M=p(m,R,E.value,C);if(M===null){R===null&&(R=T);break}e&&R&&M.alternate===null&&t(m,R),h=o(M,h,S),P===null?j=M:P.sibling=M,P=M,R=T}if(E.done)return n(m,R),pt&&ws(m,S),j;if(R===null){for(;!E.done;S++,E=x.next())E=d(m,E.value,C),E!==null&&(h=o(E,h,S),P===null?j=E:P.sibling=E,P=E);return pt&&ws(m,S),j}for(R=s(m,R);!E.done;S++,E=x.next())E=y(R,m,S,E.value,C),E!==null&&(e&&E.alternate!==null&&R.delete(E.key===null?S:E.key),h=o(E,h,S),P===null?j=E:P.sibling=E,P=E);return e&&R.forEach(function(U){return t(m,U)}),pt&&ws(m,S),j}function w(m,h,x,C){if(typeof x=="object"&&x!==null&&x.type===Us&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Rr:e:{for(var j=x.key,P=h;P!==null;){if(P.key===j){if(j=x.type,j===Us){if(P.tag===7){n(m,P.sibling),h=r(P,x.props.children),h.return=m,m=h;break e}}else if(P.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===es&&Hu(j)===P.type){n(m,P.sibling),h=r(P,x.props),h.ref=Mo(m,P,x),h.return=m,m=h;break e}n(m,P);break}else t(m,P);P=P.sibling}x.type===Us?(h=As(x.props.children,m.mode,C,x.key),h.return=m,m=h):(C=di(x.type,x.key,x.props,null,m.mode,C),C.ref=Mo(m,h,x),C.return=m,m=C)}return a(m);case Ws:e:{for(P=x.key;h!==null;){if(h.key===P)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(m,h.sibling),h=r(h,x.children||[]),h.return=m,m=h;break e}else{n(m,h);break}else t(m,h);h=h.sibling}h=Dl(x,m.mode,C),h.return=m,m=h}return a(m);case es:return P=x._init,w(m,h,P(x._payload),C)}if(Fo(x))return v(m,h,x,C);if(Ro(x))return k(m,h,x,C);Lr(m,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(m,h.sibling),h=r(h,x),h.return=m,m=h):(n(m,h),h=Nl(x,m.mode,C),h.return=m,m=h),a(m)):n(m,h)}return w}var ho=Mp(!0),Ap=Mp(!1),Mi=Ss(null),Ai=null,eo=null,Ec=null;function Ic(){Ec=eo=Ai=null}function _c(e){var t=Mi.current;dt(Mi),e._currentValue=t}function $a(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function ao(e,t){Ai=e,Ec=eo=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Vt=!0),e.firstContext=null)}function dn(e){var t=e._currentValue;if(Ec!==e)if(e={context:e,memoizedValue:t,next:null},eo===null){if(Ai===null)throw Error(Se(308));eo=e,Ai.dependencies={lanes:0,firstContext:e}}else eo=eo.next=e;return t}var js=null;function Oc(e){js===null?js=[e]:js.push(e)}function Ep(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,Oc(t)):(n.next=r.next,r.next=n),t.interleaved=n,Vn(e,s)}function Vn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ts=!1;function Lc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ip(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Hn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function us(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,st&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Vn(e,n)}return r=s.interleaved,r===null?(t.next=t,Oc(s)):(t.next=r.next,r.next=t),s.interleaved=t,Vn(e,n)}function ii(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Sc(e,n)}}function Wu(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=a:o=o.next=a,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ei(e,t,n,s){var r=e.updateQueue;ts=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,i=r.shared.pending;if(i!==null){r.shared.pending=null;var c=i,u=c.next;c.next=null,a===null?o=u:a.next=u,a=c;var f=e.alternate;f!==null&&(f=f.updateQueue,i=f.lastBaseUpdate,i!==a&&(i===null?f.firstBaseUpdate=u:i.next=u,f.lastBaseUpdate=c))}if(o!==null){var d=r.baseState;a=0,f=u=c=null,i=o;do{var p=i.lane,y=i.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:y,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var v=e,k=i;switch(p=t,y=n,k.tag){case 1:if(v=k.payload,typeof v=="function"){d=v.call(y,d,p);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=k.payload,p=typeof v=="function"?v.call(y,d,p):v,p==null)break e;d=St({},d,p);break e;case 2:ts=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,p=r.effects,p===null?r.effects=[i]:p.push(i))}else y={eventTime:y,lane:p,tag:i.tag,payload:i.payload,callback:i.callback,next:null},f===null?(u=f=y,c=d):f=f.next=y,a|=p;if(i=i.next,i===null){if(i=r.shared.pending,i===null)break;p=i,i=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(f===null&&(c=d),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=f,t=r.shared.interleaved,t!==null){r=t;do a|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Os|=a,e.lanes=a,e.memoizedState=d}}function Uu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(Se(191,r));r.call(s)}}}var kr={},Ln=Ss(kr),fr=Ss(kr),dr=Ss(kr);function Ts(e){if(e===kr)throw Error(Se(174));return e}function Nc(e,t){switch(ut(dr,t),ut(fr,e),ut(Ln,kr),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ga(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ga(t,e)}dt(Ln),ut(Ln,t)}function xo(){dt(Ln),dt(fr),dt(dr)}function _p(e){Ts(dr.current);var t=Ts(Ln.current),n=ga(t,e.type);t!==n&&(ut(fr,e),ut(Ln,n))}function Dc(e){fr.current===e&&(dt(Ln),dt(fr))}var mt=Ss(0);function Ii(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Al=[];function $c(){for(var e=0;e<Al.length;e++)Al[e]._workInProgressVersionPrimary=null;Al.length=0}var li=Kn.ReactCurrentDispatcher,El=Kn.ReactCurrentBatchConfig,_s=0,vt=null,bt=null,At=null,_i=!1,qo=!1,pr=0,ex=0;function $t(){throw Error(Se(321))}function Fc(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!bn(e[n],t[n]))return!1;return!0}function Gc(e,t,n,s,r,o){if(_s=o,vt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,li.current=e===null||e.memoizedState===null?ox:rx,e=n(s,r),qo){o=0;do{if(qo=!1,pr=0,25<=o)throw Error(Se(301));o+=1,At=bt=null,t.updateQueue=null,li.current=ix,e=n(s,r)}while(qo)}if(li.current=Oi,t=bt!==null&&bt.next!==null,_s=0,At=bt=vt=null,_i=!1,t)throw Error(Se(300));return e}function Bc(){var e=pr!==0;return pr=0,e}function An(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return At===null?vt.memoizedState=At=e:At=At.next=e,At}function pn(){if(bt===null){var e=vt.alternate;e=e!==null?e.memoizedState:null}else e=bt.next;var t=At===null?vt.memoizedState:At.next;if(t!==null)At=t,bt=e;else{if(e===null)throw Error(Se(310));bt=e,e={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},At===null?vt.memoizedState=At=e:At=At.next=e}return At}function hr(e,t){return typeof t=="function"?t(e):t}function Il(e){var t=pn(),n=t.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=e;var s=bt,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var a=r.next;r.next=o.next,o.next=a}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var i=a=null,c=null,u=o;do{var f=u.lane;if((_s&f)===f)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var d={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(i=c=d,a=s):c=c.next=d,vt.lanes|=f,Os|=f}u=u.next}while(u!==null&&u!==o);c===null?a=s:c.next=i,bn(s,t.memoizedState)||(Vt=!0),t.memoizedState=s,t.baseState=a,t.baseQueue=c,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do o=r.lane,vt.lanes|=o,Os|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function _l(e){var t=pn(),n=t.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var a=r=r.next;do o=e(o,a.action),a=a.next;while(a!==r);bn(o,t.memoizedState)||(Vt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function Op(){}function Lp(e,t){var n=vt,s=pn(),r=t(),o=!bn(s.memoizedState,r);if(o&&(s.memoizedState=r,Vt=!0),s=s.queue,zc($p.bind(null,n,s,e),[e]),s.getSnapshot!==t||o||At!==null&&At.memoizedState.tag&1){if(n.flags|=2048,xr(9,Dp.bind(null,n,s,r,t),void 0,null),It===null)throw Error(Se(349));_s&30||Np(n,t,r)}return r}function Np(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Dp(e,t,n,s){t.value=n,t.getSnapshot=s,Fp(t)&&Gp(e)}function $p(e,t,n){return n(function(){Fp(t)&&Gp(e)})}function Fp(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!bn(e,n)}catch{return!0}}function Gp(e){var t=Vn(e,1);t!==null&&Tn(t,e,1,-1)}function Xu(e){var t=An();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hr,lastRenderedState:e},t.queue=e,e=e.dispatch=sx.bind(null,vt,e),[t.memoizedState,e]}function xr(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Bp(){return pn().memoizedState}function ai(e,t,n,s){var r=An();vt.flags|=e,r.memoizedState=xr(1|t,n,void 0,s===void 0?null:s)}function el(e,t,n,s){var r=pn();s=s===void 0?null:s;var o=void 0;if(bt!==null){var a=bt.memoizedState;if(o=a.destroy,s!==null&&Fc(s,a.deps)){r.memoizedState=xr(t,n,o,s);return}}vt.flags|=e,r.memoizedState=xr(1|t,n,o,s)}function Vu(e,t){return ai(8390656,8,e,t)}function zc(e,t){return el(2048,8,e,t)}function zp(e,t){return el(4,2,e,t)}function Yp(e,t){return el(4,4,e,t)}function Hp(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Wp(e,t,n){return n=n!=null?n.concat([e]):null,el(4,4,Hp.bind(null,t,e),n)}function Yc(){}function Up(e,t){var n=pn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&Fc(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Xp(e,t){var n=pn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&Fc(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Vp(e,t,n){return _s&21?(bn(n,t)||(n=Jd(),vt.lanes|=n,Os|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Vt=!0),e.memoizedState=n)}function tx(e,t){var n=at;at=n!==0&&4>n?n:4,e(!0);var s=El.transition;El.transition={};try{e(!1),t()}finally{at=n,El.transition=s}}function qp(){return pn().memoizedState}function nx(e,t,n){var s=ds(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Kp(e))Zp(t,n);else if(n=Ep(e,t,n,s),n!==null){var r=Ht();Tn(n,e,s,r),Qp(n,t,s)}}function sx(e,t,n){var s=ds(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Kp(e))Zp(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var a=t.lastRenderedState,i=o(a,n);if(r.hasEagerState=!0,r.eagerState=i,bn(i,a)){var c=t.interleaved;c===null?(r.next=r,Oc(t)):(r.next=c.next,c.next=r),t.interleaved=r;return}}catch{}finally{}n=Ep(e,t,r,s),n!==null&&(r=Ht(),Tn(n,e,s,r),Qp(n,t,s))}}function Kp(e){var t=e.alternate;return e===vt||t!==null&&t===vt}function Zp(e,t){qo=_i=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Qp(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,Sc(e,n)}}var Oi={readContext:dn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},ox={readContext:dn,useCallback:function(e,t){return An().memoizedState=[e,t===void 0?null:t],e},useContext:dn,useEffect:Vu,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,ai(4194308,4,Hp.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ai(4194308,4,e,t)},useInsertionEffect:function(e,t){return ai(4,2,e,t)},useMemo:function(e,t){var n=An();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=An();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=nx.bind(null,vt,e),[s.memoizedState,e]},useRef:function(e){var t=An();return e={current:e},t.memoizedState=e},useState:Xu,useDebugValue:Yc,useDeferredValue:function(e){return An().memoizedState=e},useTransition:function(){var e=Xu(!1),t=e[0];return e=tx.bind(null,e[1]),An().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=vt,r=An();if(pt){if(n===void 0)throw Error(Se(407));n=n()}else{if(n=t(),It===null)throw Error(Se(349));_s&30||Np(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Vu($p.bind(null,s,o,e),[e]),s.flags|=2048,xr(9,Dp.bind(null,s,o,n,t),void 0,null),n},useId:function(){var e=An(),t=It.identifierPrefix;if(pt){var n=Bn,s=Gn;n=(s&~(1<<32-jn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=pr++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=ex++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},rx={readContext:dn,useCallback:Up,useContext:dn,useEffect:zc,useImperativeHandle:Wp,useInsertionEffect:zp,useLayoutEffect:Yp,useMemo:Xp,useReducer:Il,useRef:Bp,useState:function(){return Il(hr)},useDebugValue:Yc,useDeferredValue:function(e){var t=pn();return Vp(t,bt.memoizedState,e)},useTransition:function(){var e=Il(hr)[0],t=pn().memoizedState;return[e,t]},useMutableSource:Op,useSyncExternalStore:Lp,useId:qp,unstable_isNewReconciler:!1},ix={readContext:dn,useCallback:Up,useContext:dn,useEffect:zc,useImperativeHandle:Wp,useInsertionEffect:zp,useLayoutEffect:Yp,useMemo:Xp,useReducer:_l,useRef:Bp,useState:function(){return _l(hr)},useDebugValue:Yc,useDeferredValue:function(e){var t=pn();return bt===null?t.memoizedState=e:Vp(t,bt.memoizedState,e)},useTransition:function(){var e=_l(hr)[0],t=pn().memoizedState;return[e,t]},useMutableSource:Op,useSyncExternalStore:Lp,useId:qp,unstable_isNewReconciler:!1};function yn(e,t){if(e&&e.defaultProps){t=St({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Fa(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:St({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var tl={isMounted:function(e){return(e=e._reactInternals)?Ds(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Ht(),r=ds(e),o=Hn(s,r);o.payload=t,n!=null&&(o.callback=n),t=us(e,o,r),t!==null&&(Tn(t,e,r,s),ii(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Ht(),r=ds(e),o=Hn(s,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=us(e,o,r),t!==null&&(Tn(t,e,r,s),ii(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ht(),s=ds(e),r=Hn(n,s);r.tag=2,t!=null&&(r.callback=t),t=us(e,r,s),t!==null&&(Tn(t,e,s,n),ii(t,e,s))}};function qu(e,t,n,s,r,o,a){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,o,a):t.prototype&&t.prototype.isPureReactComponent?!lr(n,s)||!lr(r,o):!0}function Jp(e,t,n){var s=!1,r=ys,o=t.contextType;return typeof o=="object"&&o!==null?o=dn(o):(r=Kt(t)?Es:zt.current,s=t.contextTypes,o=(s=s!=null)?fo(e,r):ys),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=tl,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Ku(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&tl.enqueueReplaceState(t,t.state,null)}function Ga(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Lc(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=dn(o):(o=Kt(t)?Es:zt.current,r.context=fo(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(Fa(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&tl.enqueueReplaceState(r,r.state,null),Ei(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function yo(e,t){try{var n="",s=t;do n+=Oh(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function Ol(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ba(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var lx=typeof WeakMap=="function"?WeakMap:Map;function e0(e,t,n){n=Hn(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Ni||(Ni=!0,Za=s),Ba(e,t)},n}function t0(e,t,n){n=Hn(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Ba(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Ba(e,t),typeof s!="function"&&(fs===null?fs=new Set([this]):fs.add(this));var a=t.stack;this.componentDidCatch(t.value,{componentStack:a!==null?a:""})}),n}function Zu(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new lx;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=Cx.bind(null,e,t,n),t.then(e,e))}function Qu(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Ju(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Hn(-1,1),t.tag=2,us(n,t,1))),n.lanes|=1),e)}var ax=Kn.ReactCurrentOwner,Vt=!1;function Yt(e,t,n,s){t.child=e===null?Ap(t,null,n,s):ho(t,e.child,n,s)}function ef(e,t,n,s,r){n=n.render;var o=t.ref;return ao(t,r),s=Gc(e,t,n,s,o,r),n=Bc(),e!==null&&!Vt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qn(e,t,r)):(pt&&n&&bc(t),t.flags|=1,Yt(e,t,s,r),t.child)}function tf(e,t,n,s,r){if(e===null){var o=n.type;return typeof o=="function"&&!Zc(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,n0(e,t,o,s,r)):(e=di(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var a=o.memoizedProps;if(n=n.compare,n=n!==null?n:lr,n(a,s)&&e.ref===t.ref)return qn(e,t,r)}return t.flags|=1,e=ps(o,s),e.ref=t.ref,e.return=t,t.child=e}function n0(e,t,n,s,r){if(e!==null){var o=e.memoizedProps;if(lr(o,s)&&e.ref===t.ref)if(Vt=!1,t.pendingProps=s=o,(e.lanes&r)!==0)e.flags&131072&&(Vt=!0);else return t.lanes=e.lanes,qn(e,t,r)}return za(e,t,n,s,r)}function s0(e,t,n){var s=t.pendingProps,r=s.children,o=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut(no,Jt),Jt|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ut(no,Jt),Jt|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,ut(no,Jt),Jt|=s}else o!==null?(s=o.baseLanes|n,t.memoizedState=null):s=n,ut(no,Jt),Jt|=s;return Yt(e,t,r,n),t.child}function o0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function za(e,t,n,s,r){var o=Kt(n)?Es:zt.current;return o=fo(t,o),ao(t,r),n=Gc(e,t,n,s,o,r),s=Bc(),e!==null&&!Vt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qn(e,t,r)):(pt&&s&&bc(t),t.flags|=1,Yt(e,t,n,r),t.child)}function nf(e,t,n,s,r){if(Kt(n)){var o=!0;ji(t)}else o=!1;if(ao(t,r),t.stateNode===null)ci(e,t),Jp(t,n,s),Ga(t,n,s,r),s=!0;else if(e===null){var a=t.stateNode,i=t.memoizedProps;a.props=i;var c=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=dn(u):(u=Kt(n)?Es:zt.current,u=fo(t,u));var f=n.getDerivedStateFromProps,d=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(i!==s||c!==u)&&Ku(t,a,s,u),ts=!1;var p=t.memoizedState;a.state=p,Ei(t,s,a,r),c=t.memoizedState,i!==s||p!==c||qt.current||ts?(typeof f=="function"&&(Fa(t,n,f,s),c=t.memoizedState),(i=ts||qu(t,n,i,s,p,c,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(t.flags|=4194308)):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),a.props=s,a.state=c,a.context=u,s=i):(typeof a.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{a=t.stateNode,Ip(e,t),i=t.memoizedProps,u=t.type===t.elementType?i:yn(t.type,i),a.props=u,d=t.pendingProps,p=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=dn(c):(c=Kt(n)?Es:zt.current,c=fo(t,c));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(i!==d||p!==c)&&Ku(t,a,s,c),ts=!1,p=t.memoizedState,a.state=p,Ei(t,s,a,r);var v=t.memoizedState;i!==d||p!==v||qt.current||ts?(typeof y=="function"&&(Fa(t,n,y,s),v=t.memoizedState),(u=ts||qu(t,n,u,s,p,v,c)||!1)?(f||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(s,v,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(s,v,c)),typeof a.componentDidUpdate=="function"&&(t.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof a.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=v),a.props=s,a.state=v,a.context=c,s=u):(typeof a.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return Ya(e,t,n,s,o,r)}function Ya(e,t,n,s,r,o){o0(e,t);var a=(t.flags&128)!==0;if(!s&&!a)return r&&Bu(t,n,!1),qn(e,t,o);s=t.stateNode,ax.current=t;var i=a&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&a?(t.child=ho(t,e.child,null,o),t.child=ho(t,null,i,o)):Yt(e,t,i,o),t.memoizedState=s.state,r&&Bu(t,n,!0),t.child}function r0(e){var t=e.stateNode;t.pendingContext?Gu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Gu(e,t.context,!1),Nc(e,t.containerInfo)}function sf(e,t,n,s,r){return po(),Ac(r),t.flags|=256,Yt(e,t,n,s),t.child}var Ha={dehydrated:null,treeContext:null,retryLane:0};function Wa(e){return{baseLanes:e,cachePool:null,transitions:null}}function i0(e,t,n){var s=t.pendingProps,r=mt.current,o=!1,a=(t.flags&128)!==0,i;if((i=a)||(i=e!==null&&e.memoizedState===null?!1:(r&2)!==0),i?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),ut(mt,r&1),e===null)return Da(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(a=s.children,e=s.fallback,o?(s=t.mode,o=t.child,a={mode:"hidden",children:a},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=a):o=ol(a,s,0,null),e=As(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Wa(n),t.memoizedState=Ha,e):Hc(t,a));if(r=e.memoizedState,r!==null&&(i=r.dehydrated,i!==null))return cx(e,t,a,s,i,r,n);if(o){o=s.fallback,a=t.mode,r=e.child,i=r.sibling;var c={mode:"hidden",children:s.children};return!(a&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=c,t.deletions=null):(s=ps(r,c),s.subtreeFlags=r.subtreeFlags&14680064),i!==null?o=ps(i,o):(o=As(o,a,n,null),o.flags|=2),o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,a=e.child.memoizedState,a=a===null?Wa(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},o.memoizedState=a,o.childLanes=e.childLanes&~n,t.memoizedState=Ha,s}return o=e.child,e=o.sibling,s=ps(o,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Hc(e,t){return t=ol({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Nr(e,t,n,s){return s!==null&&Ac(s),ho(t,e.child,null,n),e=Hc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function cx(e,t,n,s,r,o,a){if(n)return t.flags&256?(t.flags&=-257,s=Ol(Error(Se(422))),Nr(e,t,a,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=s.fallback,r=t.mode,s=ol({mode:"visible",children:s.children},r,0,null),o=As(o,r,a,null),o.flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,t.mode&1&&ho(t,e.child,null,a),t.child.memoizedState=Wa(a),t.memoizedState=Ha,o);if(!(t.mode&1))return Nr(e,t,a,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var i=s.dgst;return s=i,o=Error(Se(419)),s=Ol(o,s,void 0),Nr(e,t,a,s)}if(i=(a&e.childLanes)!==0,Vt||i){if(s=It,s!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|a)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Vn(e,r),Tn(s,e,r,-1))}return Kc(),s=Ol(Error(Se(421))),Nr(e,t,a,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=kx.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,tn=cs(r.nextSibling),nn=t,pt=!0,gn=null,e!==null&&(an[cn++]=Gn,an[cn++]=Bn,an[cn++]=Is,Gn=e.id,Bn=e.overflow,Is=t),t=Hc(t,s.children),t.flags|=4096,t)}function of(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),$a(e.return,t,n)}function Ll(e,t,n,s,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function l0(e,t,n){var s=t.pendingProps,r=s.revealOrder,o=s.tail;if(Yt(e,t,s.children,n),s=mt.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&of(e,n,t);else if(e.tag===19)of(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ut(mt,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&Ii(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Ll(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&Ii(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Ll(t,!0,n,null,o);break;case"together":Ll(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ci(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Os|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Se(153));if(t.child!==null){for(e=t.child,n=ps(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=ps(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function ux(e,t,n){switch(t.tag){case 3:r0(t),po();break;case 5:_p(t);break;case 1:Kt(t.type)&&ji(t);break;case 4:Nc(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;ut(Mi,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(ut(mt,mt.current&1),t.flags|=128,null):n&t.child.childLanes?i0(e,t,n):(ut(mt,mt.current&1),e=qn(e,t,n),e!==null?e.sibling:null);ut(mt,mt.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return l0(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ut(mt,mt.current),s)break;return null;case 22:case 23:return t.lanes=0,s0(e,t,n)}return qn(e,t,n)}var a0,Ua,c0,u0;a0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ua=function(){};c0=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Ts(Ln.current);var o=null;switch(n){case"input":r=ha(e,r),s=ha(e,s),o=[];break;case"select":r=St({},r,{value:void 0}),s=St({},s,{value:void 0}),o=[];break;case"textarea":r=ma(e,r),s=ma(e,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=Ri)}va(n,s);var a;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var i=r[u];for(a in i)i.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(er.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var c=s[u];if(i=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&c!==i&&(c!=null||i!=null))if(u==="style")if(i){for(a in i)!i.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&i[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(o||(o=[]),o.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,i=i?i.__html:void 0,c!=null&&i!==c&&(o=o||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(er.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&ft("scroll",e),o||i===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};u0=function(e,t,n,s){n!==s&&(t.flags|=4)};function Ao(e,t){if(!pt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Ft(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function fx(e,t,n){var s=t.pendingProps;switch(Mc(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ft(t),null;case 1:return Kt(t.type)&&Pi(),Ft(t),null;case 3:return s=t.stateNode,xo(),dt(qt),dt(zt),$c(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Or(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,gn!==null&&(ec(gn),gn=null))),Ua(e,t),Ft(t),null;case 5:Dc(t);var r=Ts(dr.current);if(n=t.type,e!==null&&t.stateNode!=null)c0(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(Se(166));return Ft(t),null}if(e=Ts(Ln.current),Or(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[_n]=t,s[ur]=o,e=(t.mode&1)!==0,n){case"dialog":ft("cancel",s),ft("close",s);break;case"iframe":case"object":case"embed":ft("load",s);break;case"video":case"audio":for(r=0;r<Bo.length;r++)ft(Bo[r],s);break;case"source":ft("error",s);break;case"img":case"image":case"link":ft("error",s),ft("load",s);break;case"details":ft("toggle",s);break;case"input":pu(s,o),ft("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},ft("invalid",s);break;case"textarea":xu(s,o),ft("invalid",s)}va(n,o),r=null;for(var a in o)if(o.hasOwnProperty(a)){var i=o[a];a==="children"?typeof i=="string"?s.textContent!==i&&(o.suppressHydrationWarning!==!0&&_r(s.textContent,i,e),r=["children",i]):typeof i=="number"&&s.textContent!==""+i&&(o.suppressHydrationWarning!==!0&&_r(s.textContent,i,e),r=["children",""+i]):er.hasOwnProperty(a)&&i!=null&&a==="onScroll"&&ft("scroll",s)}switch(n){case"input":Pr(s),hu(s,o,!0);break;case"textarea":Pr(s),yu(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=Ri)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=$d(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=a.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=a.createElement(n,{is:s.is}):(e=a.createElement(n),n==="select"&&(a=e,s.multiple?a.multiple=!0:s.size&&(a.size=s.size))):e=a.createElementNS(e,n),e[_n]=t,e[ur]=s,a0(e,t,!1,!1),t.stateNode=e;e:{switch(a=Sa(n,s),n){case"dialog":ft("cancel",e),ft("close",e),r=s;break;case"iframe":case"object":case"embed":ft("load",e),r=s;break;case"video":case"audio":for(r=0;r<Bo.length;r++)ft(Bo[r],e);r=s;break;case"source":ft("error",e),r=s;break;case"img":case"image":case"link":ft("error",e),ft("load",e),r=s;break;case"details":ft("toggle",e),r=s;break;case"input":pu(e,s),r=ha(e,s),ft("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=St({},s,{value:void 0}),ft("invalid",e);break;case"textarea":xu(e,s),r=ma(e,s),ft("invalid",e);break;default:r=s}va(n,r),i=r;for(o in i)if(i.hasOwnProperty(o)){var c=i[o];o==="style"?Bd(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Fd(e,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&tr(e,c):typeof c=="number"&&tr(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(er.hasOwnProperty(o)?c!=null&&o==="onScroll"&&ft("scroll",e):c!=null&&hc(e,o,c,a))}switch(n){case"input":Pr(e),hu(e,s,!1);break;case"textarea":Pr(e),yu(e);break;case"option":s.value!=null&&e.setAttribute("value",""+xs(s.value));break;case"select":e.multiple=!!s.multiple,o=s.value,o!=null?oo(e,!!s.multiple,o,!1):s.defaultValue!=null&&oo(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=Ri)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Ft(t),null;case 6:if(e&&t.stateNode!=null)u0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(Se(166));if(n=Ts(dr.current),Ts(Ln.current),Or(t)){if(s=t.stateNode,n=t.memoizedProps,s[_n]=t,(o=s.nodeValue!==n)&&(e=nn,e!==null))switch(e.tag){case 3:_r(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&_r(s.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[_n]=t,t.stateNode=s}return Ft(t),null;case 13:if(dt(mt),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(pt&&tn!==null&&t.mode&1&&!(t.flags&128))bp(),po(),t.flags|=98560,o=!1;else if(o=Or(t),s!==null&&s.dehydrated!==null){if(e===null){if(!o)throw Error(Se(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Se(317));o[_n]=t}else po(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Ft(t),o=!1}else gn!==null&&(ec(gn),gn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||mt.current&1?Mt===0&&(Mt=3):Kc())),t.updateQueue!==null&&(t.flags|=4),Ft(t),null);case 4:return xo(),Ua(e,t),e===null&&ar(t.stateNode.containerInfo),Ft(t),null;case 10:return _c(t.type._context),Ft(t),null;case 17:return Kt(t.type)&&Pi(),Ft(t),null;case 19:if(dt(mt),o=t.memoizedState,o===null)return Ft(t),null;if(s=(t.flags&128)!==0,a=o.rendering,a===null)if(s)Ao(o,!1);else{if(Mt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(a=Ii(e),a!==null){for(t.flags|=128,Ao(o,!1),s=a.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)o=n,e=s,o.flags&=14680066,a=o.alternate,a===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,e=a.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ut(mt,mt.current&1|2),t.child}e=e.sibling}o.tail!==null&&wt()>mo&&(t.flags|=128,s=!0,Ao(o,!1),t.lanes=4194304)}else{if(!s)if(e=Ii(a),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Ao(o,!0),o.tail===null&&o.tailMode==="hidden"&&!a.alternate&&!pt)return Ft(t),null}else 2*wt()-o.renderingStartTime>mo&&n!==1073741824&&(t.flags|=128,s=!0,Ao(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(n=o.last,n!==null?n.sibling=a:t.child=a,o.last=a)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=wt(),t.sibling=null,n=mt.current,ut(mt,s?n&1|2:n&1),t):(Ft(t),null);case 22:case 23:return qc(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Jt&1073741824&&(Ft(t),t.subtreeFlags&6&&(t.flags|=8192)):Ft(t),null;case 24:return null;case 25:return null}throw Error(Se(156,t.tag))}function dx(e,t){switch(Mc(t),t.tag){case 1:return Kt(t.type)&&Pi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return xo(),dt(qt),dt(zt),$c(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Dc(t),null;case 13:if(dt(mt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Se(340));po()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return dt(mt),null;case 4:return xo(),null;case 10:return _c(t.type._context),null;case 22:case 23:return qc(),null;case 24:return null;default:return null}}var Dr=!1,Gt=!1,px=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function to(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){kt(e,t,s)}else n.current=null}function Xa(e,t,n){try{n()}catch(s){kt(e,t,s)}}var rf=!1;function hx(e,t){if(Aa=Ci,e=xp(),Tc(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var a=0,i=-1,c=-1,u=0,f=0,d=e,p=null;t:for(;;){for(var y;d!==n||r!==0&&d.nodeType!==3||(i=a+r),d!==o||s!==0&&d.nodeType!==3||(c=a+s),d.nodeType===3&&(a+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===e)break t;if(p===n&&++u===r&&(i=a),p===o&&++f===s&&(c=a),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}n=i===-1||c===-1?null:{start:i,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ea={focusedElem:e,selectionRange:n},Ci=!1,Ae=t;Ae!==null;)if(t=Ae,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ae=e;else for(;Ae!==null;){t=Ae;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var k=v.memoizedProps,w=v.memoizedState,m=t.stateNode,h=m.getSnapshotBeforeUpdate(t.elementType===t.type?k:yn(t.type,k),w);m.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(C){kt(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,Ae=e;break}Ae=t.return}return v=rf,rf=!1,v}function Ko(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Xa(t,n,o)}r=r.next}while(r!==s)}}function nl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Va(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function f0(e){var t=e.alternate;t!==null&&(e.alternate=null,f0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[_n],delete t[ur],delete t[Oa],delete t[K1],delete t[Z1])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function d0(e){return e.tag===5||e.tag===3||e.tag===4}function lf(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||d0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function qa(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Ri));else if(s!==4&&(e=e.child,e!==null))for(qa(e,t,n),e=e.sibling;e!==null;)qa(e,t,n),e=e.sibling}function Ka(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(Ka(e,t,n),e=e.sibling;e!==null;)Ka(e,t,n),e=e.sibling}var Lt=null,mn=!1;function Qn(e,t,n){for(n=n.child;n!==null;)p0(e,t,n),n=n.sibling}function p0(e,t,n){if(On&&typeof On.onCommitFiberUnmount=="function")try{On.onCommitFiberUnmount(Vi,n)}catch{}switch(n.tag){case 5:Gt||to(n,t);case 6:var s=Lt,r=mn;Lt=null,Qn(e,t,n),Lt=s,mn=r,Lt!==null&&(mn?(e=Lt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Lt.removeChild(n.stateNode));break;case 18:Lt!==null&&(mn?(e=Lt,n=n.stateNode,e.nodeType===8?bl(e.parentNode,n):e.nodeType===1&&bl(e,n),rr(e)):bl(Lt,n.stateNode));break;case 4:s=Lt,r=mn,Lt=n.stateNode.containerInfo,mn=!0,Qn(e,t,n),Lt=s,mn=r;break;case 0:case 11:case 14:case 15:if(!Gt&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,a=o.destroy;o=o.tag,a!==void 0&&(o&2||o&4)&&Xa(n,t,a),r=r.next}while(r!==s)}Qn(e,t,n);break;case 1:if(!Gt&&(to(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(i){kt(n,t,i)}Qn(e,t,n);break;case 21:Qn(e,t,n);break;case 22:n.mode&1?(Gt=(s=Gt)||n.memoizedState!==null,Qn(e,t,n),Gt=s):Qn(e,t,n);break;default:Qn(e,t,n)}}function af(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new px),t.forEach(function(s){var r=wx.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function xn(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=e,a=t,i=a;e:for(;i!==null;){switch(i.tag){case 5:Lt=i.stateNode,mn=!1;break e;case 3:Lt=i.stateNode.containerInfo,mn=!0;break e;case 4:Lt=i.stateNode.containerInfo,mn=!0;break e}i=i.return}if(Lt===null)throw Error(Se(160));p0(o,a,r),Lt=null,mn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){kt(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)h0(t,e),t=t.sibling}function h0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xn(t,e),Mn(e),s&4){try{Ko(3,e,e.return),nl(3,e)}catch(k){kt(e,e.return,k)}try{Ko(5,e,e.return)}catch(k){kt(e,e.return,k)}}break;case 1:xn(t,e),Mn(e),s&512&&n!==null&&to(n,n.return);break;case 5:if(xn(t,e),Mn(e),s&512&&n!==null&&to(n,n.return),e.flags&32){var r=e.stateNode;try{tr(r,"")}catch(k){kt(e,e.return,k)}}if(s&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,a=n!==null?n.memoizedProps:o,i=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{i==="input"&&o.type==="radio"&&o.name!=null&&Nd(r,o),Sa(i,a);var u=Sa(i,o);for(a=0;a<c.length;a+=2){var f=c[a],d=c[a+1];f==="style"?Bd(r,d):f==="dangerouslySetInnerHTML"?Fd(r,d):f==="children"?tr(r,d):hc(r,f,d,u)}switch(i){case"input":xa(r,o);break;case"textarea":Dd(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?oo(r,!!o.multiple,y,!1):p!==!!o.multiple&&(o.defaultValue!=null?oo(r,!!o.multiple,o.defaultValue,!0):oo(r,!!o.multiple,o.multiple?[]:"",!1))}r[ur]=o}catch(k){kt(e,e.return,k)}}break;case 6:if(xn(t,e),Mn(e),s&4){if(e.stateNode===null)throw Error(Se(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(k){kt(e,e.return,k)}}break;case 3:if(xn(t,e),Mn(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{rr(t.containerInfo)}catch(k){kt(e,e.return,k)}break;case 4:xn(t,e),Mn(e);break;case 13:xn(t,e),Mn(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Xc=wt())),s&4&&af(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(Gt=(u=Gt)||f,xn(t,e),Gt=u):xn(t,e),Mn(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!f&&e.mode&1)for(Ae=e,f=e.child;f!==null;){for(d=Ae=f;Ae!==null;){switch(p=Ae,y=p.child,p.tag){case 0:case 11:case 14:case 15:Ko(4,p,p.return);break;case 1:to(p,p.return);var v=p.stateNode;if(typeof v.componentWillUnmount=="function"){s=p,n=p.return;try{t=s,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(k){kt(s,n,k)}}break;case 5:to(p,p.return);break;case 22:if(p.memoizedState!==null){uf(d);continue}}y!==null?(y.return=p,Ae=y):uf(d)}f=f.sibling}e:for(f=null,d=e;;){if(d.tag===5){if(f===null){f=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(i=d.stateNode,c=d.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,i.style.display=Gd("display",a))}catch(k){kt(e,e.return,k)}}}else if(d.tag===6){if(f===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(k){kt(e,e.return,k)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:xn(t,e),Mn(e),s&4&&af(e);break;case 21:break;default:xn(t,e),Mn(e)}}function Mn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(d0(n)){var s=n;break e}n=n.return}throw Error(Se(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(tr(r,""),s.flags&=-33);var o=lf(e);Ka(e,o,r);break;case 3:case 4:var a=s.stateNode.containerInfo,i=lf(e);qa(e,i,a);break;default:throw Error(Se(161))}}catch(c){kt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xx(e,t,n){Ae=e,x0(e)}function x0(e,t,n){for(var s=(e.mode&1)!==0;Ae!==null;){var r=Ae,o=r.child;if(r.tag===22&&s){var a=r.memoizedState!==null||Dr;if(!a){var i=r.alternate,c=i!==null&&i.memoizedState!==null||Gt;i=Dr;var u=Gt;if(Dr=a,(Gt=c)&&!u)for(Ae=r;Ae!==null;)a=Ae,c=a.child,a.tag===22&&a.memoizedState!==null?ff(r):c!==null?(c.return=a,Ae=c):ff(r);for(;o!==null;)Ae=o,x0(o),o=o.sibling;Ae=r,Dr=i,Gt=u}cf(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Ae=o):cf(e)}}function cf(e){for(;Ae!==null;){var t=Ae;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Gt||nl(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Gt)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:yn(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Uu(t,o,s);break;case 3:var a=t.updateQueue;if(a!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Uu(t,a,n)}break;case 5:var i=t.stateNode;if(n===null&&t.flags&4){n=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var d=f.dehydrated;d!==null&&rr(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}Gt||t.flags&512&&Va(t)}catch(p){kt(t,t.return,p)}}if(t===e){Ae=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ae=n;break}Ae=t.return}}function uf(e){for(;Ae!==null;){var t=Ae;if(t===e){Ae=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ae=n;break}Ae=t.return}}function ff(e){for(;Ae!==null;){var t=Ae;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{nl(4,t)}catch(c){kt(t,n,c)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(c){kt(t,r,c)}}var o=t.return;try{Va(t)}catch(c){kt(t,o,c)}break;case 5:var a=t.return;try{Va(t)}catch(c){kt(t,a,c)}}}catch(c){kt(t,t.return,c)}if(t===e){Ae=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Ae=i;break}Ae=t.return}}var yx=Math.ceil,Li=Kn.ReactCurrentDispatcher,Wc=Kn.ReactCurrentOwner,fn=Kn.ReactCurrentBatchConfig,st=0,It=null,jt=null,Nt=0,Jt=0,no=Ss(0),Mt=0,yr=null,Os=0,sl=0,Uc=0,Zo=null,Xt=null,Xc=0,mo=1/0,Dn=null,Ni=!1,Za=null,fs=null,$r=!1,rs=null,Di=0,Qo=0,Qa=null,ui=-1,fi=0;function Ht(){return st&6?wt():ui!==-1?ui:ui=wt()}function ds(e){return e.mode&1?st&2&&Nt!==0?Nt&-Nt:J1.transition!==null?(fi===0&&(fi=Jd()),fi):(e=at,e!==0||(e=window.event,e=e===void 0?16:ip(e.type)),e):1}function Tn(e,t,n,s){if(50<Qo)throw Qo=0,Qa=null,Error(Se(185));vr(e,n,s),(!(st&2)||e!==It)&&(e===It&&(!(st&2)&&(sl|=n),Mt===4&&ss(e,Nt)),Zt(e,s),n===1&&st===0&&!(t.mode&1)&&(mo=wt()+500,Ji&&Cs()))}function Zt(e,t){var n=e.callbackNode;Jh(e,t);var s=Si(e,e===It?Nt:0);if(s===0)n!==null&&vu(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&vu(n),t===1)e.tag===0?Q1(df.bind(null,e)):Pp(df.bind(null,e)),V1(function(){!(st&6)&&Cs()}),n=null;else{switch(ep(s)){case 1:n=vc;break;case 4:n=Zd;break;case 16:n=vi;break;case 536870912:n=Qd;break;default:n=vi}n=w0(n,y0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function y0(e,t){if(ui=-1,fi=0,st&6)throw Error(Se(327));var n=e.callbackNode;if(co()&&e.callbackNode!==n)return null;var s=Si(e,e===It?Nt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=$i(e,s);else{t=s;var r=st;st|=2;var o=g0();(It!==e||Nt!==t)&&(Dn=null,mo=wt()+500,Ms(e,t));do try{vx();break}catch(i){m0(e,i)}while(1);Ic(),Li.current=o,st=r,jt!==null?t=0:(It=null,Nt=0,t=Mt)}if(t!==0){if(t===2&&(r=Pa(e),r!==0&&(s=r,t=Ja(e,r))),t===1)throw n=yr,Ms(e,0),ss(e,s),Zt(e,wt()),n;if(t===6)ss(e,s);else{if(r=e.current.alternate,!(s&30)&&!mx(r)&&(t=$i(e,s),t===2&&(o=Pa(e),o!==0&&(s=o,t=Ja(e,o))),t===1))throw n=yr,Ms(e,0),ss(e,s),Zt(e,wt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(Se(345));case 2:Rs(e,Xt,Dn);break;case 3:if(ss(e,s),(s&130023424)===s&&(t=Xc+500-wt(),10<t)){if(Si(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Ht(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=_a(Rs.bind(null,e,Xt,Dn),t);break}Rs(e,Xt,Dn);break;case 4:if(ss(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var a=31-jn(s);o=1<<a,a=t[a],a>r&&(r=a),s&=~o}if(s=r,s=wt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*yx(s/1960))-s,10<s){e.timeoutHandle=_a(Rs.bind(null,e,Xt,Dn),s);break}Rs(e,Xt,Dn);break;case 5:Rs(e,Xt,Dn);break;default:throw Error(Se(329))}}}return Zt(e,wt()),e.callbackNode===n?y0.bind(null,e):null}function Ja(e,t){var n=Zo;return e.current.memoizedState.isDehydrated&&(Ms(e,t).flags|=256),e=$i(e,t),e!==2&&(t=Xt,Xt=n,t!==null&&ec(t)),e}function ec(e){Xt===null?Xt=e:Xt.push.apply(Xt,e)}function mx(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!bn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ss(e,t){for(t&=~Uc,t&=~sl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-jn(t),s=1<<n;e[n]=-1,t&=~s}}function df(e){if(st&6)throw Error(Se(327));co();var t=Si(e,0);if(!(t&1))return Zt(e,wt()),null;var n=$i(e,t);if(e.tag!==0&&n===2){var s=Pa(e);s!==0&&(t=s,n=Ja(e,s))}if(n===1)throw n=yr,Ms(e,0),ss(e,t),Zt(e,wt()),n;if(n===6)throw Error(Se(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rs(e,Xt,Dn),Zt(e,wt()),null}function Vc(e,t){var n=st;st|=1;try{return e(t)}finally{st=n,st===0&&(mo=wt()+500,Ji&&Cs())}}function Ls(e){rs!==null&&rs.tag===0&&!(st&6)&&co();var t=st;st|=1;var n=fn.transition,s=at;try{if(fn.transition=null,at=1,e)return e()}finally{at=s,fn.transition=n,st=t,!(st&6)&&Cs()}}function qc(){Jt=no.current,dt(no)}function Ms(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,X1(n)),jt!==null)for(n=jt.return;n!==null;){var s=n;switch(Mc(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Pi();break;case 3:xo(),dt(qt),dt(zt),$c();break;case 5:Dc(s);break;case 4:xo();break;case 13:dt(mt);break;case 19:dt(mt);break;case 10:_c(s.type._context);break;case 22:case 23:qc()}n=n.return}if(It=e,jt=e=ps(e.current,null),Nt=Jt=t,Mt=0,yr=null,Uc=sl=Os=0,Xt=Zo=null,js!==null){for(t=0;t<js.length;t++)if(n=js[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var a=o.next;o.next=r,s.next=a}n.pending=s}js=null}return e}function m0(e,t){do{var n=jt;try{if(Ic(),li.current=Oi,_i){for(var s=vt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}_i=!1}if(_s=0,At=bt=vt=null,qo=!1,pr=0,Wc.current=null,n===null||n.return===null){Mt=1,yr=t,jt=null;break}e:{var o=e,a=n.return,i=n,c=t;if(t=Nt,i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,f=i,d=f.tag;if(!(f.mode&1)&&(d===0||d===11||d===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=Qu(a);if(y!==null){y.flags&=-257,Ju(y,a,i,o,t),y.mode&1&&Zu(o,u,t),t=y,c=u;var v=t.updateQueue;if(v===null){var k=new Set;k.add(c),t.updateQueue=k}else v.add(c);break e}else{if(!(t&1)){Zu(o,u,t),Kc();break e}c=Error(Se(426))}}else if(pt&&i.mode&1){var w=Qu(a);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Ju(w,a,i,o,t),Ac(yo(c,i));break e}}o=c=yo(c,i),Mt!==4&&(Mt=2),Zo===null?Zo=[o]:Zo.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var m=e0(o,c,t);Wu(o,m);break e;case 1:i=c;var h=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(fs===null||!fs.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var C=t0(o,i,t);Wu(o,C);break e}}o=o.return}while(o!==null)}S0(n)}catch(j){t=j,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(1)}function g0(){var e=Li.current;return Li.current=Oi,e===null?Oi:e}function Kc(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),It===null||!(Os&268435455)&&!(sl&268435455)||ss(It,Nt)}function $i(e,t){var n=st;st|=2;var s=g0();(It!==e||Nt!==t)&&(Dn=null,Ms(e,t));do try{gx();break}catch(r){m0(e,r)}while(1);if(Ic(),st=n,Li.current=s,jt!==null)throw Error(Se(261));return It=null,Nt=0,Mt}function gx(){for(;jt!==null;)v0(jt)}function vx(){for(;jt!==null&&!Hh();)v0(jt)}function v0(e){var t=k0(e.alternate,e,Jt);e.memoizedProps=e.pendingProps,t===null?S0(e):jt=t,Wc.current=null}function S0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=dx(n,t),n!==null){n.flags&=32767,jt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Mt=6,jt=null;return}}else if(n=fx(n,t,Jt),n!==null){jt=n;return}if(t=t.sibling,t!==null){jt=t;return}jt=t=e}while(t!==null);Mt===0&&(Mt=5)}function Rs(e,t,n){var s=at,r=fn.transition;try{fn.transition=null,at=1,Sx(e,t,n,s)}finally{fn.transition=r,at=s}return null}function Sx(e,t,n,s){do co();while(rs!==null);if(st&6)throw Error(Se(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Se(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(e1(e,o),e===It&&(jt=It=null,Nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||$r||($r=!0,w0(vi,function(){return co(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=fn.transition,fn.transition=null;var a=at;at=1;var i=st;st|=4,Wc.current=null,hx(e,n),h0(n,e),G1(Ea),Ci=!!Aa,Ea=Aa=null,e.current=n,xx(n),Wh(),st=i,at=a,fn.transition=o}else e.current=n;if($r&&($r=!1,rs=e,Di=r),o=e.pendingLanes,o===0&&(fs=null),Vh(n.stateNode),Zt(e,wt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Ni)throw Ni=!1,e=Za,Za=null,e;return Di&1&&e.tag!==0&&co(),o=e.pendingLanes,o&1?e===Qa?Qo++:(Qo=0,Qa=e):Qo=0,Cs(),null}function co(){if(rs!==null){var e=ep(Di),t=fn.transition,n=at;try{if(fn.transition=null,at=16>e?16:e,rs===null)var s=!1;else{if(e=rs,rs=null,Di=0,st&6)throw Error(Se(331));var r=st;for(st|=4,Ae=e.current;Ae!==null;){var o=Ae,a=o.child;if(Ae.flags&16){var i=o.deletions;if(i!==null){for(var c=0;c<i.length;c++){var u=i[c];for(Ae=u;Ae!==null;){var f=Ae;switch(f.tag){case 0:case 11:case 15:Ko(8,f,o)}var d=f.child;if(d!==null)d.return=f,Ae=d;else for(;Ae!==null;){f=Ae;var p=f.sibling,y=f.return;if(f0(f),f===u){Ae=null;break}if(p!==null){p.return=y,Ae=p;break}Ae=y}}}var v=o.alternate;if(v!==null){var k=v.child;if(k!==null){v.child=null;do{var w=k.sibling;k.sibling=null,k=w}while(k!==null)}}Ae=o}}if(o.subtreeFlags&2064&&a!==null)a.return=o,Ae=a;else e:for(;Ae!==null;){if(o=Ae,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Ko(9,o,o.return)}var m=o.sibling;if(m!==null){m.return=o.return,Ae=m;break e}Ae=o.return}}var h=e.current;for(Ae=h;Ae!==null;){a=Ae;var x=a.child;if(a.subtreeFlags&2064&&x!==null)x.return=a,Ae=x;else e:for(a=h;Ae!==null;){if(i=Ae,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:nl(9,i)}}catch(j){kt(i,i.return,j)}if(i===a){Ae=null;break e}var C=i.sibling;if(C!==null){C.return=i.return,Ae=C;break e}Ae=i.return}}if(st=r,Cs(),On&&typeof On.onPostCommitFiberRoot=="function")try{On.onPostCommitFiberRoot(Vi,e)}catch{}s=!0}return s}finally{at=n,fn.transition=t}}return!1}function pf(e,t,n){t=yo(n,t),t=e0(e,t,1),e=us(e,t,1),t=Ht(),e!==null&&(vr(e,1,t),Zt(e,t))}function kt(e,t,n){if(e.tag===3)pf(e,e,n);else for(;t!==null;){if(t.tag===3){pf(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(fs===null||!fs.has(s))){e=yo(n,e),e=t0(t,e,1),t=us(t,e,1),e=Ht(),t!==null&&(vr(t,1,e),Zt(t,e));break}}t=t.return}}function Cx(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Ht(),e.pingedLanes|=e.suspendedLanes&n,It===e&&(Nt&n)===n&&(Mt===4||Mt===3&&(Nt&130023424)===Nt&&500>wt()-Xc?Ms(e,0):Uc|=n),Zt(e,t)}function C0(e,t){t===0&&(e.mode&1?(t=br,br<<=1,!(br&130023424)&&(br=4194304)):t=1);var n=Ht();e=Vn(e,t),e!==null&&(vr(e,t,n),Zt(e,n))}function kx(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),C0(e,n)}function wx(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(Se(314))}s!==null&&s.delete(t),C0(e,n)}var k0;k0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||qt.current)Vt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Vt=!1,ux(e,t,n);Vt=!!(e.flags&131072)}else Vt=!1,pt&&t.flags&1048576&&jp(t,bi,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;ci(e,t),e=t.pendingProps;var r=fo(t,zt.current);ao(t,n),r=Gc(null,t,s,e,r,n);var o=Bc();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Kt(s)?(o=!0,ji(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Lc(t),r.updater=tl,t.stateNode=r,r._reactInternals=t,Ga(t,s,e,n),t=Ya(null,t,s,!0,o,n)):(t.tag=0,pt&&o&&bc(t),Yt(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(ci(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=Px(s),e=yn(s,e),r){case 0:t=za(null,t,s,e,n);break e;case 1:t=nf(null,t,s,e,n);break e;case 11:t=ef(null,t,s,e,n);break e;case 14:t=tf(null,t,s,yn(s.type,e),n);break e}throw Error(Se(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),za(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),nf(e,t,s,r,n);case 3:e:{if(r0(t),e===null)throw Error(Se(387));s=t.pendingProps,o=t.memoizedState,r=o.element,Ip(e,t),Ei(t,s,null,n);var a=t.memoizedState;if(s=a.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=yo(Error(Se(423)),t),t=sf(e,t,s,n,r);break e}else if(s!==r){r=yo(Error(Se(424)),t),t=sf(e,t,s,n,r);break e}else for(tn=cs(t.stateNode.containerInfo.firstChild),nn=t,pt=!0,gn=null,n=Ap(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(po(),s===r){t=qn(e,t,n);break e}Yt(e,t,s,n)}t=t.child}return t;case 5:return _p(t),e===null&&Da(t),s=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,a=r.children,Ia(s,r)?a=null:o!==null&&Ia(s,o)&&(t.flags|=32),o0(e,t),Yt(e,t,a,n),t.child;case 6:return e===null&&Da(t),null;case 13:return i0(e,t,n);case 4:return Nc(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=ho(t,null,s,n):Yt(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),ef(e,t,s,r,n);case 7:return Yt(e,t,t.pendingProps,n),t.child;case 8:return Yt(e,t,t.pendingProps.children,n),t.child;case 12:return Yt(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,o=t.memoizedProps,a=r.value,ut(Mi,s._currentValue),s._currentValue=a,o!==null)if(bn(o.value,a)){if(o.children===r.children&&!qt.current){t=qn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var i=o.dependencies;if(i!==null){a=o.child;for(var c=i.firstContext;c!==null;){if(c.context===s){if(o.tag===1){c=Hn(-1,n&-n),c.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?c.next=c:(c.next=f.next,f.next=c),u.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),$a(o.return,n,t),i.lanes|=n;break}c=c.next}}else if(o.tag===10)a=o.type===t.type?null:o.child;else if(o.tag===18){if(a=o.return,a===null)throw Error(Se(341));a.lanes|=n,i=a.alternate,i!==null&&(i.lanes|=n),$a(a,n,t),a=o.sibling}else a=o.child;if(a!==null)a.return=o;else for(a=o;a!==null;){if(a===t){a=null;break}if(o=a.sibling,o!==null){o.return=a.return,a=o;break}a=a.return}o=a}Yt(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,ao(t,n),r=dn(r),s=s(r),t.flags|=1,Yt(e,t,s,n),t.child;case 14:return s=t.type,r=yn(s,t.pendingProps),r=yn(s.type,r),tf(e,t,s,r,n);case 15:return n0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:yn(s,r),ci(e,t),t.tag=1,Kt(s)?(e=!0,ji(t)):e=!1,ao(t,n),Jp(t,s,r),Ga(t,s,r,n),Ya(null,t,s,!0,e,n);case 19:return l0(e,t,n);case 22:return s0(e,t,n)}throw Error(Se(156,t.tag))};function w0(e,t){return Kd(e,t)}function Rx(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function un(e,t,n,s){return new Rx(e,t,n,s)}function Zc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Px(e){if(typeof e=="function")return Zc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===yc)return 11;if(e===mc)return 14}return 2}function ps(e,t){var n=e.alternate;return n===null?(n=un(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function di(e,t,n,s,r,o){var a=2;if(s=e,typeof e=="function")Zc(e)&&(a=1);else if(typeof e=="string")a=5;else e:switch(e){case Us:return As(n.children,r,o,t);case xc:a=8,r|=8;break;case ua:return e=un(12,n,t,r|2),e.elementType=ua,e.lanes=o,e;case fa:return e=un(13,n,t,r),e.elementType=fa,e.lanes=o,e;case da:return e=un(19,n,t,r),e.elementType=da,e.lanes=o,e;case _d:return ol(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ed:a=10;break e;case Id:a=9;break e;case yc:a=11;break e;case mc:a=14;break e;case es:a=16,s=null;break e}throw Error(Se(130,e==null?e:typeof e,""))}return t=un(a,n,t,r),t.elementType=e,t.type=s,t.lanes=o,t}function As(e,t,n,s){return e=un(7,e,s,t),e.lanes=n,e}function ol(e,t,n,s){return e=un(22,e,s,t),e.elementType=_d,e.lanes=n,e.stateNode={isHidden:!1},e}function Nl(e,t,n){return e=un(6,e,null,t),e.lanes=n,e}function Dl(e,t,n){return t=un(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function jx(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ml(0),this.expirationTimes=ml(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ml(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Qc(e,t,n,s,r,o,a,i,c){return e=new jx(e,t,n,i,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=un(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lc(o),e}function Tx(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ws,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function R0(e){if(!e)return ys;e=e._reactInternals;e:{if(Ds(e)!==e||e.tag!==1)throw Error(Se(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Kt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Se(171))}if(e.tag===1){var n=e.type;if(Kt(n))return Rp(e,n,t)}return t}function P0(e,t,n,s,r,o,a,i,c){return e=Qc(n,s,!0,e,r,o,a,i,c),e.context=R0(null),n=e.current,s=Ht(),r=ds(n),o=Hn(s,r),o.callback=t??null,us(n,o,r),e.current.lanes=r,vr(e,r,s),Zt(e,s),e}function rl(e,t,n,s){var r=t.current,o=Ht(),a=ds(r);return n=R0(n),t.context===null?t.context=n:t.pendingContext=n,t=Hn(o,a),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=us(r,t,a),e!==null&&(Tn(e,r,a,o),ii(e,r,a)),a}function Fi(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Jc(e,t){hf(e,t),(e=e.alternate)&&hf(e,t)}function bx(){return null}var j0=typeof reportError=="function"?reportError:function(e){console.error(e)};function eu(e){this._internalRoot=e}il.prototype.render=eu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Se(409));rl(e,t,null,null)};il.prototype.unmount=eu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ls(function(){rl(null,e,null,null)}),t[Xn]=null}};function il(e){this._internalRoot=e}il.prototype.unstable_scheduleHydration=function(e){if(e){var t=sp();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ns.length&&t!==0&&t<ns[n].priority;n++);ns.splice(n,0,e),n===0&&rp(e)}};function tu(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ll(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function xf(){}function Mx(e,t,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Fi(a);o.call(u)}}var a=P0(t,s,e,0,null,!1,!1,"",xf);return e._reactRootContainer=a,e[Xn]=a.current,ar(e.nodeType===8?e.parentNode:e),Ls(),a}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var i=s;s=function(){var u=Fi(c);i.call(u)}}var c=Qc(e,0,!1,null,null,!1,!1,"",xf);return e._reactRootContainer=c,e[Xn]=c.current,ar(e.nodeType===8?e.parentNode:e),Ls(function(){rl(t,c,n,s)}),c}function al(e,t,n,s,r){var o=n._reactRootContainer;if(o){var a=o;if(typeof r=="function"){var i=r;r=function(){var c=Fi(a);i.call(c)}}rl(t,a,e,r)}else a=Mx(n,t,e,r,s);return Fi(a)}tp=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Go(t.pendingLanes);n!==0&&(Sc(t,n|1),Zt(t,wt()),!(st&6)&&(mo=wt()+500,Cs()))}break;case 13:Ls(function(){var s=Vn(e,1);if(s!==null){var r=Ht();Tn(s,e,1,r)}}),Jc(e,1)}};Cc=function(e){if(e.tag===13){var t=Vn(e,134217728);if(t!==null){var n=Ht();Tn(t,e,134217728,n)}Jc(e,134217728)}};np=function(e){if(e.tag===13){var t=ds(e),n=Vn(e,t);if(n!==null){var s=Ht();Tn(n,e,t,s)}Jc(e,t)}};sp=function(){return at};op=function(e,t){var n=at;try{return at=e,t()}finally{at=n}};ka=function(e,t,n){switch(t){case"input":if(xa(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=Qi(s);if(!r)throw Error(Se(90));Ld(s),xa(s,r)}}}break;case"textarea":Dd(e,n);break;case"select":t=n.value,t!=null&&oo(e,!!n.multiple,t,!1)}};Hd=Vc;Wd=Ls;var Ax={usingClientEntryPoint:!1,Events:[Cr,Ks,Qi,zd,Yd,Vc]},Eo={findFiberByHostInstance:Ps,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ex={bundleType:Eo.bundleType,version:Eo.version,rendererPackageName:Eo.rendererPackageName,rendererConfig:Eo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Kn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Vd(e),e===null?null:e.stateNode},findFiberByHostInstance:Eo.findFiberByHostInstance||bx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fr.isDisabled&&Fr.supportsFiber)try{Vi=Fr.inject(Ex),On=Fr}catch{}}on.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ax;on.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tu(t))throw Error(Se(200));return Tx(e,t,null,n)};on.createRoot=function(e,t){if(!tu(e))throw Error(Se(299));var n=!1,s="",r=j0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=Qc(e,1,!1,null,null,n,!1,s,r),e[Xn]=t.current,ar(e.nodeType===8?e.parentNode:e),new eu(t)};on.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Se(188)):(e=Object.keys(e).join(","),Error(Se(268,e)));return e=Vd(t),e=e===null?null:e.stateNode,e};on.flushSync=function(e){return Ls(e)};on.hydrate=function(e,t,n){if(!ll(t))throw Error(Se(200));return al(null,e,t,!0,n)};on.hydrateRoot=function(e,t,n){if(!tu(e))throw Error(Se(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",a=j0;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),t=P0(t,null,e,1,n??null,r,!1,o,a),e[Xn]=t.current,ar(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new il(t)};on.render=function(e,t,n){if(!ll(t))throw Error(Se(200));return al(null,e,t,!1,n)};on.unmountComponentAtNode=function(e){if(!ll(e))throw Error(Se(40));return e._reactRootContainer?(Ls(function(){al(null,null,e,!1,function(){e._reactRootContainer=null,e[Xn]=null})}),!0):!1};on.unstable_batchedUpdates=Vc;on.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!ll(n))throw Error(Se(200));if(e==null||e._reactInternals===void 0)throw Error(Se(38));return al(e,t,n,!1,s)};on.version="18.3.1-next-f1338f8080-20240426";function T0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(T0)}catch(e){console.error(e)}}T0(),Td.exports=on;var Ix=Td.exports,yf=Ix;aa.createRoot=yf.createRoot,aa.hydrateRoot=yf.hydrateRoot;var Me=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e.T_I="T_I",e.T_L="T_L",e.T_T="T_T",e.T_S="T_S",e.T_O="T_O",e.T_I_C="T_I_C",e.T_L_C="T_L_C",e.T_T_C="T_T_C",e.T_S_C="T_S_C",e.T_O_C="T_O_C",e.P_I="P_I",e.P_L="P_L",e.P_X="P_X",e.P_U="P_U",e.P_L2="P_L2",e.P_Y="P_Y",e.P_T="P_T",e.P_S="P_S",e.P_P="P_P",e.P_Z="P_Z",e.P_W="P_W",e.P_I_C="P_I_C",e.P_L_C="P_L_C",e.P_X_C="P_X_C",e.P_U_C="P_U_C",e.P_L2_C="P_L2_C",e.P_Y_C="P_Y_C",e.P_T_C="P_T_C",e.P_S_C="P_S_C",e.P_P_C="P_P_C",e.P_Z_C="P_Z_C",e.P_W_C="P_W_C",e.H_I="H_I",e.H_L="H_L",e.H_X="H_X",e.H_U="H_U",e.H_L2="H_L2",e.H_Y="H_Y",e.H_T="H_T",e.H_S="H_S",e.H_P="H_P",e.H_Z="H_Z",e.H_W="H_W",e.H_I_C="H_I_C",e.H_L_C="H_L_C",e.H_X_C="H_X_C",e.H_U_C="H_U_C",e.H_L2_C="H_L2_C",e.H_Y_C="H_Y_C",e.H_T_C="H_T_C",e.H_S_C="H_S_C",e.H_P_C="H_P_C",e.H_Z_C="H_Z_C",e.H_W_C="H_W_C",e))(Me||{}),Fn=(e=>(e.SPAWNED="SPAWNED",e.FALLING="FALLING",e.LOCKED="LOCKED",e))(Fn||{}),qe=(e=>(e.ConsoleScreen="CONSOLE",e.TankScreen="PERISCOPE",e.COMPLICATION_MINIGAME="COMPLICATION_MINIGAME",e.EndGameScreen="GAME_OVER",e))(qe||{}),Ie=(e=>(e.LIGHTS="LIGHTS",e.CONTROLS="CONTROLS",e.LASER="LASER",e))(Ie||{});const rt=12,Re=30,Bt=21,Ne=24,nt=Ne-Bt,go=375,Io=75*1e3,$l=.15,_x=.5,Ox=30,Lx=0,Nx=100,mf=15,Dx=10,$x=250,Nn={CIRCUIT_STABILIZER:{id:"CIRCUIT_STABILIZER",name:"Circuit Stabilizer",desc:"Extends grace period before lights start dimming.",type:"passive",category:"complication",unlockRank:2,costPerLevel:1,maxLevel:4,effectPerLevel:.75,formatEffect:e=>`+${(e*.75).toFixed(2)}s Grace Period`,maxLevelBonus:"Easier Fixing Sequence"},AUTO_POPPER:{id:"AUTO_POPPER",name:"Auto-Popper",desc:"At end of game, remaining goop has a chance to auto-pop before penalty.",type:"passive",unlockRank:3,costPerLevel:1,maxLevel:4,effectPerLevel:.04,formatEffect:e=>`-${20-e*4}% decay per unit`,maxLevelBonus:void 0},CAPACITOR_EFFICIENCY:{id:"CAPACITOR_EFFICIENCY",name:"Capacitor Efficiency",desc:"Reduces laser capacitor drain rate when popping goop.",type:"passive",category:"complication",unlockRank:4,costPerLevel:1,maxLevel:4,effectPerLevel:.0625,formatEffect:e=>`-${(e*6.25).toFixed(2)}% Drain Rate`,maxLevelBonus:"Easier Fixing Sequence"},COOLDOWN_BOOSTER:{id:"COOLDOWN_BOOSTER",name:"Cooldown Booster",desc:"When activated, extends all active malfunction cooldowns.",type:"active",unlockRank:5,costPerLevel:1,maxLevel:3,chargeCost:8,effectPerLevel:0,formatEffect:e=>`+${[25,35,50][e-1]||25}% Cooldown Extension`,maxLevelBonus:"+50% Cooldown Extension"},GEAR_LUBRICATION:{id:"GEAR_LUBRICATION",name:"Gear Lubrication",desc:"Increases heat dissipation rate when idle.",type:"passive",category:"complication",unlockRank:6,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Heat Dissipation`,maxLevelBonus:"Easier Fixing Sequence"},FOCUS_MODE:{id:"FOCUS_MODE",name:"Focus Mode",desc:"Time slows while at the console viewing minigames.",type:"passive",unlockRank:7,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`-${e*10}% Time Speed`,maxLevelBonus:void 0},DENSE_GOOP:{id:"DENSE_GOOP",name:"Dense Goop",desc:"Goop falls faster. Can add or remove scraps via respec.",type:"passive",unlockRank:8,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Fall Speed`,maxLevelBonus:void 0},PRESSURE_CONTROL:{id:"PRESSURE_CONTROL",name:"Pressure Control",desc:"Extends time before pressure reaches 100%.",type:"passive",unlockRank:9,costPerLevel:1,maxLevel:8,effectPerLevel:5,formatEffect:e=>`+${e*5}s Game Time`,maxLevelBonus:void 0},JUNK_UNIFORMER:{id:"JUNK_UNIFORMER",name:"Junk Uniformer",desc:"Starting junk is more likely to be the same color.",type:"passive",unlockRank:10,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`+${e*10}% Same Color`,maxLevelBonus:void 0},GOOP_SWAP:{id:"GOOP_SWAP",name:"Goop Swap",desc:"Swap falling goop with stored goop faster.",type:"passive",unlockRank:12,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${(1.5-e*.25).toFixed(2)}s Swap Time`,maxLevelBonus:void 0},GOOP_DUMP:{id:"GOOP_DUMP",name:"Goop Dump",desc:"When activated, rains same-color junk from the sky. Higher levels add more waves.",type:"active",unlockRank:15,costPerLevel:1,maxLevel:3,chargeCost:12,effectPerLevel:1,formatEffect:e=>`${e} wave${e>1?"s":""} of junk`,maxLevelBonus:"3 waves of matching junk"},SEALING_BONUS:{id:"SEALING_BONUS",name:"Sealing Bonus",desc:"Sealing cracks reduces active cooldowns more.",type:"passive",unlockRank:18,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`${10+e*5}% Cooldown per Seal`,maxLevelBonus:void 0},ACTIVE_EXPANSION_SLOT:{id:"ACTIVE_EXPANSION_SLOT",name:"Active Expansion Slot",desc:"Allows equipping a second active ability simultaneously.",type:"feature",unlockRank:20,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"2 Active Slots",maxLevelBonus:void 0},GOOP_HOLD_VIEWER:{id:"GOOP_HOLD_VIEWER",name:"Goop Hold Viewer",desc:"Shows the goop currently held.",type:"feature",unlockRank:22,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"View Held Goop",maxLevelBonus:void 0},GOOP_COLORIZER:{id:"GOOP_COLORIZER",name:"Goop Colorizer",desc:"When activated, upcoming goop matches your current color.",type:"active",unlockRank:25,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:1,formatEffect:e=>`Next ${5+e} goop match`,maxLevelBonus:"Next 8 goop match"},GOOP_WINDOW:{id:"GOOP_WINDOW",name:"Goop Window",desc:"Shows you the next goop piece.",type:"feature",unlockRank:28,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"Preview Next Goop",maxLevelBonus:void 0},SLOW_CRACKS:{id:"SLOW_CRACKS",name:"Slow Cracks",desc:"Cracks grow slower over time.",type:"passive",unlockRank:30,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`-${e*5}% Growth Chance`,maxLevelBonus:void 0},CRACK_MATCHER:{id:"CRACK_MATCHER",name:"Crack Matcher",desc:"Falling goop color biased toward the lowest crack.",type:"passive",unlockRank:32,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${e*25}% Match Chance`,maxLevelBonus:void 0},CRACK_DOWN:{id:"CRACK_DOWN",name:"Crack Down",desc:"When activated, next cracks form in the bottom 4 rows.",type:"active",unlockRank:35,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:2,formatEffect:e=>`Next ${1+e*2} cracks spawn low`,maxLevelBonus:"Next 7 cracks spawn low"},ACTIVE_EXPANSION_SLOT_2:{id:"ACTIVE_EXPANSION_SLOT_2",name:"Active Expansion Slot",desc:"Allows equipping a third active ability simultaneously.",type:"feature",unlockRank:38,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"3 Active Slots",maxLevelBonus:void 0}},tt={RED:"#ef4444",BLUE:"#3b82f6",GREEN:"#22c55e",YELLOW:"#eab308",PURPLE:"#a855f7",WHITE:"#f8fafc",BLACK:"#1a1a2e",WILD:"wild",ORANGE:"#f97316",TEAL:"#14b8a6",GRID_BG:"#020617",GRID_EMPTY:"#1e293b"},_e=(e,t)=>({type:e,color:tt.RED,cells:t.map(([n,s])=>({x:n,y:s}))}),gf=[_e(Me.I,[[-1,0],[0,0],[1,0],[2,0]]),_e(Me.J,[[-1,-1],[-1,0],[0,0],[1,0]]),_e(Me.L,[[1,-1],[-1,0],[0,0],[1,0]]),_e(Me.O,[[0,0],[1,0],[0,1],[1,1]]),_e(Me.S,[[0,0],[1,0],[0,1],[-1,1]]),_e(Me.T,[[0,-1],[-1,0],[0,0],[1,1]]),_e(Me.Z,[[-1,0],[0,0],[0,1],[1,1]])],Fx=_e(Me.T_I,[[0,-1],[0,0],[0,1],[0,2]]),Gx=_e(Me.T_L,[[0,0],[0,1],[0,2],[1,0]]),Bx=_e(Me.T_T,[[0,0],[0,1],[0,2],[1,1]]),zx=_e(Me.T_S,[[0,0],[0,1],[1,1],[1,2]]),Yx=_e(Me.T_O,[[0,0],[0,1],[1,0],[1,1]]),Hx=_e(Me.T_I_C,[[0,2],[0,3],[1,0],[1,1]]),Wx=_e(Me.T_L_C,[[0,0],[0,1],[1,0],[1,2]]),Ux=_e(Me.T_T_C,[[0,0],[0,2],[1,1],[2,1]]),Xx=_e(Me.T_S_C,[[0,2],[1,0],[1,1],[2,1]]),Vx=_e(Me.T_O_C,[[0,0],[0,2],[1,1],[1,2]]),bs=[Fx,Gx,Bx,zx,Yx],Jo=[Hx,Wx,Ux,Xx,Vx];[...bs,...Jo];const qx=_e(Me.P_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2]]),Kx=_e(Me.P_L,[[0,0],[0,1],[1,1],[1,2],[2,1]]),Zx=_e(Me.P_X,[[0,1],[1,0],[1,1],[1,2],[2,1]]),Qx=_e(Me.P_U,[[0,0],[1,0],[1,1],[1,2],[2,0]]),Jx=_e(Me.P_L2,[[0,0],[0,1],[1,0],[1,1],[1,2]]),ey=_e(Me.P_Y,[[0,0],[0,1],[1,1],[1,2],[2,2]]),ty=_e(Me.P_T,[[0,0],[0,1],[0,2],[0,3],[1,1]]),ny=_e(Me.P_S,[[0,0],[0,1],[0,2],[0,3],[1,3]]),sy=_e(Me.P_P,[[0,0],[0,1],[0,3],[1,0],[1,2]]),oy=_e(Me.P_Z,[[0,0],[0,1],[0,2],[0,3],[1,1]]),ry=_e(Me.P_W,[[0,0],[0,2],[1,1],[1,2],[2,2]]),iy=_e(Me.P_I_C,[[0,0],[0,2],[0,4],[1,1],[1,3]]),ly=_e(Me.P_L_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),ay=_e(Me.P_X_C,[[0,0],[1,1],[1,2],[2,0],[2,2]]),cy=_e(Me.P_U_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),uy=_e(Me.P_L2_C,[[0,0],[0,2],[1,1],[1,2],[2,2]]),fy=_e(Me.P_Y_C,[[0,0],[0,1],[1,1],[2,0],[2,2]]),dy=_e(Me.P_T_C,[[0,0],[0,1],[0,3],[1,2],[1,3]]),py=_e(Me.P_S_C,[[0,0],[0,1],[1,0],[1,2],[2,1]]),hy=_e(Me.P_P_C,[[0,0],[0,2],[1,0],[1,1],[1,3]]),xy=_e(Me.P_Z_C,[[0,0],[0,2],[1,1],[1,3],[2,0]]),yy=_e(Me.P_W_C,[[0,0],[0,2],[1,1],[2,0],[2,2]]),cl=[qx,Kx,Zx,Qx,Jx,ey,ty,ny,sy,oy,ry],nu=[iy,ly,ay,cy,uy,fy,dy,py,hy,xy,yy];[...cl,...nu];const my=_e(Me.H_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2],[0,3]]),gy=_e(Me.H_L,[[0,0],[0,1],[0,2],[0,3],[1,1],[2,1]]),vy=_e(Me.H_X,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,3]]),Sy=_e(Me.H_U,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,0]]),Cy=_e(Me.H_L2,[[0,0],[0,1],[1,0],[1,1],[1,2],[1,3]]),ky=_e(Me.H_Y,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2]]),wy=_e(Me.H_T,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,2]]),Ry=_e(Me.H_S,[[0,0],[0,1],[1,0],[1,1],[2,1],[2,2]]),Py=_e(Me.H_P,[[0,0],[0,1],[0,2],[0,3],[1,2],[1,3]]),jy=_e(Me.H_Z,[[0,0],[0,1],[0,2],[0,3],[1,0],[1,3]]),Ty=_e(Me.H_W,[[0,0],[0,3],[1,1],[1,2],[1,3],[2,3]]),by=_e(Me.H_I_C,[[0,0],[0,3],[0,5],[1,1],[1,2],[1,4]]),My=_e(Me.H_L_C,[[0,0],[0,2],[1,1],[1,2],[1,3],[2,0]]),Ay=_e(Me.H_X_C,[[0,0],[0,2],[0,3],[1,1],[1,3],[2,0]]),Ey=_e(Me.H_U_C,[[0,0],[0,3],[1,1],[1,2],[1,4],[2,0]]),Iy=_e(Me.H_L2_C,[[0,0],[0,1],[1,1],[1,2],[1,3],[2,0]]),_y=_e(Me.H_Y_C,[[0,0],[0,2],[1,0],[1,2],[1,3],[2,1]]),Oy=_e(Me.H_T_C,[[0,0],[0,1],[0,3],[1,1],[1,2],[1,4]]),Ly=_e(Me.H_S_C,[[0,0],[0,2],[1,1],[1,3],[2,0],[2,2]]),Ny=_e(Me.H_P_C,[[0,0],[0,2],[0,4],[1,1],[1,2],[1,3]]),Dy=_e(Me.H_Z_C,[[0,0],[0,1],[0,3],[1,0],[1,2],[2,3]]),$y=_e(Me.H_W_C,[[0,0],[0,3],[1,1],[1,2],[2,0],[2,3]]),ul=[my,gy,vy,Sy,Cy,ky,wy,Ry,Py,jy,Ty],su=[by,My,Ay,Ey,Iy,_y,Oy,Ly,Ny,Dy,$y];[...ul,...su];const Ve=e=>(e%Re+Re)%Re,tc=(e,t)=>Ve(Math.round(e)+t),Fy=(e,t)=>{let n=e-t;for(;n>Re/2;)n-=Re;for(;n<=-Re/2;)n+=Re;return n},b0=(e,t,n)=>{const s=n?n.x:Math.round(e.reduce((o,a)=>o+a.x,0)/e.length),r=n?n.y:Math.round(e.reduce((o,a)=>o+a.y,0)/e.length);return e.map(({x:o,y:a})=>{const i=o-s,c=a-r;return t?{x:-c+s,y:i+r}:{x:c+s,y:-i+r}})},Rn=e=>{const t=[tt.RED,tt.BLUE,tt.GREEN,tt.YELLOW];return e>=10&&t.push(tt.PURPLE),e>=30&&t.push(tt.WHITE),e>=50&&t.push(tt.BLACK),t},Gy=(e,t=1)=>{const n=e||gf[Math.floor(Math.random()*gf.length)],s=Rn(t),o=(e==null?void 0:e.color)&&s.includes(e.color)?e.color:s[Math.floor(Math.random()*s.length)],a=Math.round(n.cells.reduce((c,u)=>c+u.x,0)/n.cells.length),i=Math.round(n.cells.reduce((c,u)=>c+u.y,0)/n.cells.length);return{definition:{...n,color:o},x:0,y:0,screenX:0,rotation:0,cells:[...n.cells],rotationCenter:{x:a,y:i},spawnTimestamp:Date.now(),startSpawnY:0,state:Fn.SPAWNED}},vf=(e,t)=>{const n=Array(Ne).fill(null).map(()=>Array(Re).fill(null));let s=0;if(e>=9?s=11:e>=6?s=8:e>=3&&(s=5),s>0){const r=Rn(e),o=Array.from({length:Re},(d,p)=>p);for(let d=o.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[o[d],o[p]]=[o[p],o[d]]}const a=o.slice(0,s),i=Ne-1,u=((t==null?void 0:t.JUNK_UNIFORMER)||0)*.1;let f=null;a.forEach(d=>{let p;f===null?(p=r[Math.floor(Math.random()*r.length)],f=p):p=Math.random()<u?f:r[Math.floor(Math.random()*r.length)];const y=Math.random().toString(36).substr(2,9);n[i][d]={id:Math.random().toString(36).substr(2,9),goopGroupId:y,timestamp:Date.now(),color:p,groupMinY:i,groupMaxY:i,groupSize:1}})}return n},ms=(e,t,n)=>{for(const s of t.cells){const r=Ve(t.x+s.x),o=t.y+s.y;if(o+1>Ne)return!0;const a=Math.floor(o),i=Math.floor(o+1-1e-4);for(let c=a;c<=i;c++)if(c>=0&&c<Ne&&e[c][r]!==null)return!0}return!1},M0=(e,t,n)=>{let s=Math.floor(t.y);for(;s>-5&&ms(e,{...t,y:s});)s-=1;let r=s;for(;r<Ne&&!ms(e,{...t,y:r+1});)r+=1;return Math.max(s,r)},By=(e,t,n)=>{const s=e[n][t];if(!s)return[];const r=[],o=new Set,a=[{x:t,y:n}],i=s.goopGroupId;for(;a.length>0;){const{x:c,y:u}=a.shift(),f=`${c},${u}`;if(o.has(f))continue;o.add(f),r.push({x:c,y:u});const d=[{x:Ve(c+1),y:u},{x:Ve(c-1),y:u},{x:c,y:u+1},{x:c,y:u-1}];for(const p of d)if(p.y>=0&&p.y<Ne){const y=e[p.y][p.x];y&&y.goopGroupId===i&&(o.has(`${p.x},${p.y}`)||a.push(p))}}return r},Gi=e=>{const t=e.map(r=>[...r]),n=new Set,s=(r,o,a,i)=>{const c=[],u=[{x:r,y:o}],f=new Set;for(;u.length>0;){const d=u.shift(),p=`${d.x},${d.y}`;if(f.has(p))continue;f.add(p),c.push(d);const y=[{x:Ve(d.x+1),y:d.y},{x:Ve(d.x-1),y:d.y},{x:d.x,y:d.y+1},{x:d.x,y:d.y-1}];for(const v of y)if(v.y>=0&&v.y<Ne){const k=t[v.y][v.x];if(!k||f.has(`${v.x},${v.y}`))continue;(i?k.isWild:k.color===a&&!k.isWild)&&u.push(v)}}return c};for(let r=0;r<Ne;r++)for(let o=0;o<Re;o++){const a=t[r][o];if(a&&!n.has(`${o},${r}`)){const i=s(o,r,a.color,!!a.isWild);let c=Ne,u=-1;i.forEach(w=>{w.y<c&&(c=w.y),w.y>u&&(u=w.y)});const f=i.length;let d=!0;const p=a.goopGroupId,y=a.groupSize;if(y!==f)d=!1;else for(const w of i){const m=t[w.y][w.x];if(!m||m.goopGroupId!==p||m.groupSize!==y){d=!1;break}}const v=d?p:Math.random().toString(36).substr(2,9),k=d?a.timestamp:Date.now();i.forEach(w=>{n.add(`${w.x},${w.y}`);const m=t[w.y][w.x];t[w.y][w.x]={...m,goopGroupId:v,timestamp:k,groupMinY:c,groupMaxY:u,groupSize:f}})}}return t},zy=(e,t,n)=>{const s=e.map(p=>[...p]),r=Math.random().toString(36).substr(2,9),o=Date.now();let a=Ne,i=-1;const c=[],u=[];t.cells.forEach(p=>{const y=Math.floor(t.y+p.y);y<a&&(a=y),y>i&&(i=y)});const f=t.cells.length,d=t.definition.isWild;return t.cells.forEach((p,y)=>{var m;const v=Ve(t.x+p.x),k=Math.floor(t.y+p.y),w=((m=t.definition.cellColors)==null?void 0:m[y])??t.definition.color;if(k>=0&&k<Ne){const h=n.find(C=>C.x===v&&C.y===k);let x=!1;h&&(h.color===w||d)&&(c.push(h.id),x=!0),s[k][v]={id:Math.random().toString(36).substr(2,9),goopGroupId:r,timestamp:o,color:w,groupMinY:a,groupMaxY:i,groupSize:f,isSealingGoop:x,isWild:d}}}),{grid:Gi(s),consumedGoals:c,destroyedGoals:u}},Yy=(e,t)=>{const n=e.map(i=>[...i]),s=t.definition.isWild,r=t.definition.color,o=[];t.cells.forEach(i=>{const c=Ve(t.x+i.x),u=Math.floor(t.y+i.y);u>=0&&u<Ne&&o.push({x:c,y:u})});const a=new Set;if(o.forEach(({x:i,y:c})=>{[{x:Ve(i+1),y:c},{x:Ve(i-1),y:c},{x:i,y:c+1},{x:i,y:c-1}].forEach(f=>{if(f.y>=0&&f.y<Ne){const d=n[f.y][f.x];if(!d||o.some(y=>y.x===f.x&&y.y===f.y))return;s?d.isWild||a.add(d.goopGroupId):d.isWild&&a.add(d.goopGroupId)}})}),a.size>0)for(let i=0;i<Ne;i++)for(let c=0;c<Re;c++){const u=n[i][c];u&&a.has(u.goopGroupId)&&(s?n[i][c]={...u,isWild:!0}:n[i][c]={...u,color:r,isWild:!1})}return Gi(n)},A0=(e,t)=>{const n=e.map(c=>[...c]),s=[],r=new Map;for(let c=0;c<Ne;c++)for(let u=0;u<Re;u++){const f=n[c][u];f&&(r.has(f.goopGroupId)||r.set(f.goopGroupId,[]),r.get(f.goopGroupId).push({x:u,y:c}))}let o;if(t&&t.length>0){const c=new Map;for(const u of t){const f=c.get(u.x);(f===void 0||u.y<f)&&c.set(u.x,u.y)}o=new Set;for(const[u,f]of r)for(const d of f){const p=c.get(d.x);if(p!==void 0&&d.y<p){o.add(u);break}}}else o=new Set(r.keys());const a=new Set;for(const[c,u]of r)for(const f of u)if(f.y===Ne-1){a.add(c);break}let i=!0;for(;i;){i=!1;for(const[c,u]of r)if(!a.has(c))for(const f of u){const d=f.y+1;if(d<Ne){const p=n[d][f.x];if(p&&p.goopGroupId!==c&&a.has(p.goopGroupId)){a.add(c),i=!0;break}}}}for(const c of o)if(!a.has(c)){const u=r.get(c);for(const f of u)s.push({data:n[f.y][f.x],x:f.x,y:f.y,velocity:0}),n[f.y][f.x]=null}return{grid:n,looseGoop:s}},Hy=(e,t,n,s)=>{const r=[],o=[],a=.012*n,i=[...e].sort((c,u)=>u.y-c.y);for(const c of i){const u=c.y+a;if(u>=Ne-1){o.push({...c,y:Ne-1});continue}const f=Math.floor(u+1),d=c.x;t[f]&&t[f][d]?o.push({...c,y:Math.floor(u)}):r.push({...c,y:u})}return{active:r,landed:o}},Wy=e=>Math.max(0,(Ne-e)*10),Uy=(e,t)=>{const n=Ve(t+rt/2);let s=Math.abs(e-n);return s>Re/2&&(s=Re-s),s>rt/2?50:0},Xy=e=>1+e*.1,Vy=(e,t)=>{let n=0;const s=new Set(t.map(r=>`${r.x},${r.y}`));return t.forEach(({x:r,y:o})=>{[{x:Ve(r+1),y:o},{x:Ve(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}].forEach(i=>{i.y>=0&&i.y<Ne&&e[i.y][i.x]&&!s.has(`${i.x},${i.y}`)&&n++})}),n*5},Sf=(e,t,n,s,r,o=!1)=>{const a=Rn(n),i=new Set(t.map(d=>d.color)),c=a.filter(d=>!i.has(d));if(c.length===0)return null;const u=c[Math.floor(Math.random()*c.length)];let f;if(o){const d=Ne-4,p=Ne-1;f=d+Math.floor(Math.random()*(p-d+1))}else{const p=1+Math.max(0,1-s/r)*(Bt-1),y=Math.floor(Ne-p);f=Math.max(nt,Math.min(Ne-1,y))}for(let d=0;d<20;d++){const p=Math.floor(Math.random()*Re),y=f;if(!e[y][p]&&!t.some(v=>v.x===p&&v.y===y))return{id:Math.random().toString(36).substr(2,9),x:p,y,color:u,spawnTime:Date.now()}}return null},qy=(e,t,n,s,r)=>{const o=Rn(n),a=[],i=[...t],u=1+Math.max(0,1-s/r)*(Bt-1),f=Math.floor(Ne-u);let d=nt,p=Math.max(nt,f-1);for(const y of o)for(let v=0;v<20;v++){const k=Math.floor(Math.random()*Re),w=Math.floor(d+Math.random()*(p-d+1));if(w<nt||w>=Ne)continue;const m=e[w][k]!==null,h=i.some(C=>C.x===k&&C.y===w),x=a.some(C=>C.x===k&&C.y===w);if(!m&&!h&&!x){const C={id:Math.random().toString(36).substr(2,9),x:k,y:w,color:y,spawnTime:Date.now()};a.push(C);break}}return a},vn=typeof navigator<"u"&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Ky=(e,t)=>{const n=Math.max(0,Math.min(100,e))/100;if(t==="drain")if(n>.5){const s=(n-.5)*2,r=Math.round(234+(59-234)*s),o=Math.round(179+(130-179)*s),a=Math.round(8+(246-8)*s);return`rgb(${r}, ${o}, ${a})`}else{const s=n*2,r=Math.round(220+(234-220)*s),o=Math.round(38+(179-38)*s),a=Math.round(38+(8-38)*s);return`rgb(${r}, ${o}, ${a})`}else if(n<.5){const s=n*2,r=Math.round(34+(234-34)*s),o=Math.round(197+(179-197)*s),a=Math.round(94+(8-94)*s);return`rgb(${r}, ${o}, ${a})`}else{const s=(n-.5)*2,r=Math.round(234+(220-234)*s),o=Math.round(179+(38-179)*s),a=Math.round(8+(38-8)*s);return`rgb(${r}, ${o}, ${a})`}},Cf=({value:e,maxValue:t=100,colorMode:n,x:s,y:r,height:o=200,width:a=16})=>{const c=Math.max(0,Math.min(t,e))/t*(o-4),u=Ky(e,n),f="#1f2937",d="#111827";return l.jsxs("g",{transform:`translate(${s}, ${r})`,children:[l.jsx("rect",{x:0,y:0,width:a,height:o,rx:3,ry:3,fill:d,stroke:f,strokeWidth:1}),l.jsx("rect",{x:2,y:o-2-c,width:a-4,height:c,rx:2,ry:2,fill:u}),[.25,.5,.75].map(p=>l.jsx("line",{x1:0,y1:o-p*(o-4)-2,x2:4,y2:o-p*(o-4)-2,stroke:f,strokeWidth:1,opacity:.5},p))]})},We=30,zs={x:-(rt/2)*We,y:0,w:rt*We,h:Bt*We};function Ct(e){return(e-rt/2)*We}function Zy(e){return e/We+rt/2}class Qy{constructor(){Be(this,"handlers",new Map)}on(t,n){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(n),()=>this.off(t,n)}off(t,n){var s;(s=this.handlers.get(t))==null||s.delete(n)}emit(t,n){var s;(s=this.handlers.get(t))==null||s.forEach(r=>r(n))}}const pe=new Qy;var ae=(e=>(e.PIECE_MOVED="PIECE_MOVED",e.PIECE_ROTATED="PIECE_ROTATED",e.PIECE_DROPPED="PIECE_DROPPED",e.GOOP_POPPED="GOOP_POPPED",e.ACTION_REJECTED="ACTION_REJECTED",e.GAME_OVER="GAME_OVER",e.GOAL_CAPTURED="GOAL_CAPTURED",e.COMPLICATION_SPAWNED="COMPLICATION_SPAWNED",e.COMPLICATION_RESOLVED="COMPLICATION_RESOLVED",e.LIGHTS_FLICKER="LIGHTS_FLICKER",e.ABILITY_ACTIVATED="ABILITY_ACTIVATED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.GAME_START="GAME_START",e.GAME_PAUSED="GAME_PAUSED",e.GAME_RESUMED="GAME_RESUMED",e.GAME_EXITED="GAME_EXITED",e.MUSIC_START="MUSIC_START",e.MUSIC_STOP="MUSIC_STOP",e.INPUT_ROTATE="INPUT_ROTATE",e.INPUT_DRAG="INPUT_DRAG",e.INPUT_SWIPE_UP="INPUT_SWIPE_UP",e.INPUT_FAST_DROP="INPUT_FAST_DROP",e.INPUT_SWAP="INPUT_SWAP",e.INPUT_BLOCK_TAP="INPUT_BLOCK_TAP",e.INPUT_SWAP_HOLD="INPUT_SWAP_HOLD",e.TUTORIAL_STEP_TRIGGERED="TUTORIAL_STEP_TRIGGERED",e.TUTORIAL_STEP_COMPLETED="TUTORIAL_STEP_COMPLETED",e.TUTORIAL_STEP_DISMISSED="TUTORIAL_STEP_DISMISSED",e.TRAINING_SCENARIO_COMPLETE="TRAINING_SCENARIO_COMPLETE",e))(ae||{});const Jy=1500,Fs=250,Gr=10,_o=20;function em({callbacks:e,tankRotation:t,grid:n,tankPressure:s,powerUps:r,trainingHighlightColor:o,disableSwap:a,disablePop:i}){const{onBlockTap:c,onRotate:u,onDragInput:f,onSwipeUp:d,onFastDrop:p,onSwap:y}=e,v=(r==null?void 0:r.GOOP_SWAP)||0,k=Jy-v*250,[w,m]=g.useState(null),[h,x]=g.useState(null),[C,j]=g.useState(0),[P,R]=g.useState(null),S=g.useRef(null),T=g.useRef(null),E=g.useRef(null),M=g.useRef(null),{x:U,y:J,w:se,h:N}=zs,Y=g.useCallback((A,G,X)=>{const W=X,fe=W.getBoundingClientRect(),ie=W.clientLeft||0,le=W.clientTop||0,q=A-fe.left-ie,ke=G-fe.top-le,Ce=W.clientWidth,je=W.clientHeight,De=Ce/se,Fe=je/N,Te=Math.min(De,Fe),ze=se*Te,ye=(Ce-ze)/2,I=U+(q-ye)/Te,z=J+ke/Te,he=Zy(I),xe=z/We+nt;return{vx:he,vy:xe,svgX:I,svgY:z,relX:q,contentW:Ce,relY:ke}},[U,J,se,N]),ee=g.useCallback((A,G)=>{if(A>=0&&A<rt){const X=Math.floor(A),W=Ve(X+t),fe=Math.floor(G);if(fe>=0&&fe<Ne){const ie=n[fe][W];if(ie)return{type:"BLOCK",x:W,y:fe,cell:ie}}}return{type:"EMPTY"}},[t,n]),B=g.useCallback(()=>{T.current&&(clearInterval(T.current),T.current=null),j(0),R(null)},[]);g.useEffect(()=>()=>{T.current&&clearInterval(T.current)},[]);const Q=g.useCallback(A=>{if(S.current)return;A.currentTarget.setPointerCapture(A.pointerId);const{relX:G,relY:X,vx:W,vy:fe}=Y(A.clientX,A.clientY,A.currentTarget);if(S.current={startX:A.clientX,startY:A.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:A.pointerId,actionConsumed:!1},!a){R({x:G,y:X}),j(0);const le=Date.now();T.current=window.setInterval(()=>{const ke=Date.now()-le;if(ke<Fs)return;const Ce=ke-Fs,je=Math.min(100,Ce/k*100);j(je),je>=100&&(S.current&&(S.current.actionConsumed=!0),pe.emit(ae.INPUT_SWAP),y==null||y(),B(),navigator.vibrate&&navigator.vibrate(50))},16)}const ie=ee(W,fe);if(ie.type==="BLOCK"&&ie.cell){const le=ie.cell.groupSize*go,q=Date.now()-ie.cell.timestamp,ke=Ne-1-s*(Bt-1);i?(x(ie.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):o&&ie.cell.color!==o?(x(ie.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):ie.cell.groupMinY<ke?(x(ie.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):q<le?(x(ie.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Ce=>Ce===ie.cell.goopGroupId?null:Ce),300)):m(ie.cell.goopGroupId)}},[Y,ee,s,B,k,o,i,a]),K=g.useCallback(A=>{if(!S.current||S.current.activePointerId!==A.pointerId)return;const{startX:G,startY:X,isDragLocked:W}=S.current,fe=A.clientX-G,ie=A.clientY-X,le=Math.abs(fe),q=Math.abs(ie);if(W||(le>Gr||q>Gr)&&(B(),S.current.isDragLocked=!0,m(null),le>q?S.current.lockedAxis="H":(S.current.lockedAxis="V",ie>0&&(pe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)))),S.current.isDragLocked){const ke=S.current.lockedAxis;if(ke==="H")fe<-_o?(pe.emit(ae.INPUT_DRAG,{direction:1}),f==null||f(1)):fe>_o?(pe.emit(ae.INPUT_DRAG,{direction:-1}),f==null||f(-1)):(pe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0));else if(ke==="V"){const Ce=ie>0;pe.emit(ae.INPUT_FAST_DROP,{active:Ce}),p==null||p(Ce)}}},[B]),re=g.useCallback(A=>{if(!S.current||S.current.activePointerId!==A.pointerId)return;const{startTime:G,isDragLocked:X,actionConsumed:W,startX:fe,startY:ie}=S.current,le=Date.now()-G,q=A.clientX-fe,ke=A.clientY-ie;if(B(),pe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1),pe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0),m(null),S.current=null,A.currentTarget.releasePointerCapture(A.pointerId),!W&&!(le>=Fs))if(X)le<300&&Math.abs(ke)>Math.abs(q)&&Math.abs(ke)>50&&(ke<0?(pe.emit(ae.INPUT_SWIPE_UP),d==null||d()):(pe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0),setTimeout(()=>{pe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)},150)));else{const{vx:Ce,vy:je,relX:De,contentW:Fe}=Y(A.clientX,A.clientY,A.currentTarget),Te=ee(Ce,je);Te.type==="BLOCK"&&Te.cell?(pe.emit(ae.INPUT_BLOCK_TAP,{x:Te.x,y:Te.y}),c==null||c(Te.x,Te.y)):De<Fe/2?(pe.emit(ae.INPUT_ROTATE,{clockwise:!1}),u==null||u(-1)):(pe.emit(ae.INPUT_ROTATE,{clockwise:!0}),u==null||u(1))}},[B,Y,ee]),oe=g.useCallback(()=>{M.current&&(window.removeEventListener("touchmove",M.current.move),window.removeEventListener("touchend",M.current.end),window.removeEventListener("touchcancel",M.current.end),M.current=null)},[]),ve=g.useCallback(A=>{if(A.touches.length!==1||S.current)return;A.preventDefault();const G=A.touches[0],X=A.currentTarget;E.current=X;const{relX:W,relY:fe,vx:ie,vy:le}=Y(G.clientX,G.clientY,X);if(S.current={startX:G.clientX,startY:G.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:G.identifier,actionConsumed:!1},!a){R({x:W,y:fe}),j(0);const je=Date.now();T.current=window.setInterval(()=>{const Fe=Date.now()-je;if(Fe<Fs)return;const Te=Fe-Fs,ze=Math.min(100,Te/k*100);j(ze),ze>=100&&(S.current&&(S.current.actionConsumed=!0),pe.emit(ae.INPUT_SWAP),y==null||y(),B(),navigator.vibrate&&navigator.vibrate(50))},16)}const q=ee(ie,le);if(q.type==="BLOCK"&&q.cell){const je=q.cell.groupSize*go,De=Date.now()-q.cell.timestamp,Fe=Ne-1-s*(Bt-1);i?(x(q.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Te=>Te===q.cell.goopGroupId?null:Te),300)):o&&q.cell.color!==o?(x(q.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Te=>Te===q.cell.goopGroupId?null:Te),300)):q.cell.groupMinY<Fe?(x(q.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Te=>Te===q.cell.goopGroupId?null:Te),300)):De<je?(x(q.cell.goopGroupId),pe.emit(ae.ACTION_REJECTED),setTimeout(()=>x(Te=>Te===q.cell.goopGroupId?null:Te),300)):m(q.cell.goopGroupId)}const ke=je=>{if(!S.current||je.touches.length!==1)return;je.preventDefault();const De=je.touches[0];if(De.identifier!==S.current.activePointerId)return;const{startX:Fe,startY:Te,isDragLocked:ze}=S.current,ye=De.clientX-Fe,I=De.clientY-Te,z=Math.abs(ye),he=Math.abs(I);if(ze||(z>Gr||he>Gr)&&(B(),S.current.isDragLocked=!0,m(null),z>he?S.current.lockedAxis="H":(S.current.lockedAxis="V",I>0&&(pe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)))),S.current.isDragLocked){const xe=S.current.lockedAxis;xe==="H"?ye<-_o?(pe.emit(ae.INPUT_DRAG,{direction:1}),f==null||f(1)):ye>_o?(pe.emit(ae.INPUT_DRAG,{direction:-1}),f==null||f(-1)):(pe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0)):xe==="V"&&(I>_o?(pe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)):(pe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)))}},Ce=je=>{const De=je.changedTouches[0];if(!S.current||!De||De.identifier!==S.current.activePointerId)return;const{startTime:Fe,isDragLocked:Te,actionConsumed:ze,startX:ye,startY:I}=S.current,z=Date.now()-Fe,he=De.clientX-ye,xe=De.clientY-I;B(),pe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1),pe.emit(ae.INPUT_DRAG,{direction:0}),f==null||f(0),m(null);const D=E.current;if(S.current=null,E.current=null,oe(),!ze&&!(z>=Fs))if(!Te&&D){const{vx:L,vy:F,relX:H,contentW:ne}=Y(De.clientX,De.clientY,D),we=ee(L,F);we.type==="BLOCK"&&we.cell?(pe.emit(ae.INPUT_BLOCK_TAP,{x:we.x,y:we.y}),c==null||c(we.x,we.y)):H<ne/2?(pe.emit(ae.INPUT_ROTATE,{clockwise:!1}),u==null||u(-1)):(pe.emit(ae.INPUT_ROTATE,{clockwise:!0}),u==null||u(1))}else Te&&z<300&&Math.abs(xe)>Math.abs(he)&&Math.abs(xe)>50&&(xe<0?(pe.emit(ae.INPUT_SWIPE_UP),d==null||d()):(pe.emit(ae.INPUT_FAST_DROP,{active:!0}),p==null||p(!0),setTimeout(()=>{pe.emit(ae.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)},150)))};M.current={move:ke,end:Ce},window.addEventListener("touchmove",ke,{passive:!1}),window.addEventListener("touchend",Ce),window.addEventListener("touchcancel",Ce)},[Y,ee,s,B,k,y,p,f,c,u,d,oe,o,i,a]);g.useEffect(()=>()=>oe(),[oe]);const Pe=g.useCallback(A=>{A.preventDefault()},[]),be=g.useCallback(A=>{A.preventDefault()},[]);return{handlers:{onPointerDown:Q,onPointerMove:K,onPointerUp:re,onTouchStart:ve,onTouchMove:Pe,onTouchEnd:be,onTouchCancel:be},holdState:{progress:C,position:P},highlightedGroupId:w,shakingGroupId:h,setHighlightedGroupId:m,setShakingGroupId:x}}const E0=8;function tm(e,t,n,s,r,o=E0){let a="";return!r.t&&!r.l?a+=`M ${e} ${t+o} Q ${e} ${t} ${e+o} ${t} `:a+=`M ${e} ${t} `,!r.t&&!r.r?a+=`L ${e+n-o} ${t} Q ${e+n} ${t} ${e+n} ${t+o} `:a+=`L ${e+n} ${t} `,!r.b&&!r.r?a+=`L ${e+n} ${t+s-o} Q ${e+n} ${t+s} ${e+n-o} ${t+s} `:a+=`L ${e+n} ${t+s} `,!r.b&&!r.l?a+=`L ${e+o} ${t+s} Q ${e} ${t+s} ${e} ${t+s-o} `:a+=`L ${e} ${t+s} `,a+="Z",a}function Br(e,t,n,s,r,o=E0){const a=o;let i="";if(!r.t){const c=r.l?e:e+a,u=r.r?e+n:e+n-a;i+=`M ${c} ${t} L ${u} ${t} `}if(!r.r){const c=r.t?t:t+a,u=r.b?t+s:t+s-a;i+=`M ${e+n} ${c} L ${e+n} ${u} `}if(!r.b){const c=r.l?e:e+a,u=r.r?e+n:e+n-a;i+=`M ${u} ${t+s} L ${c} ${t+s} `}if(!r.l){const c=r.t?t:t+a,u=r.b?t+s:t+s-a;i+=`M ${e} ${u} L ${e} ${c} `}return!r.t&&!r.l&&(i+=`M ${e} ${t+a} Q ${e} ${t} ${e+a} ${t} `),!r.t&&!r.r&&(i+=`M ${e+n-a} ${t} Q ${e+n} ${t} ${e+n} ${t+a} `),!r.b&&!r.r&&(i+=`M ${e+n} ${t+s-a} Q ${e+n} ${t+s} ${e+n-a} ${t+s} `),!r.b&&!r.l&&(i+=`M ${e+a} ${t+s} Q ${e} ${t+s} ${e} ${t+s-a} `),i}function nm(e,t,n){var o,a,i,c;const s=new Map;for(let u=nt;u<nt+Bt;u++)for(let f=0;f<rt;f++){const d=Ve(f+t),p=e[u][d];if(!p)continue;const y=Ct(f),k=Ct(f+1)-y;if(k<=0)continue;const w=(u-nt)*We,m={t:u>0&&((o=e[u-1][d])==null?void 0:o.goopGroupId)===p.goopGroupId,b:u<Ne-1&&((a=e[u+1][d])==null?void 0:a.goopGroupId)===p.goopGroupId,l:((i=e[u][Ve(d-1)])==null?void 0:i.goopGroupId)===p.goopGroupId,r:((c=e[u][Ve(d+1)])==null?void 0:c.goopGroupId)===p.goopGroupId};s.has(p.goopGroupId)||s.set(p.goopGroupId,[]),s.get(p.goopGroupId).push({visX:f,y:u,screenX:y,screenY:w,width:k,cell:p,color:p.color,neighbors:m})}const r=new Map;return n.forEach(u=>{r.has(u.data.goopGroupId)||r.set(u.data.goopGroupId,[]),r.get(u.data.goopGroupId).push(u)}),r.forEach((u,f)=>{const d=new Set;u.forEach(p=>d.add(`${Math.round(p.x)},${Math.round(p.y)}`)),u.forEach(p=>{if(p.y<nt-1)return;let y=p.x-t;if(y>Re/2&&(y-=Re),y<-Re/2&&(y+=Re),y>=0&&y<rt){const v=Ct(y),w=Ct(y+1)-v,m=(p.y-nt)*We,h=Math.round(p.x),x=Math.round(p.y),C={t:d.has(`${h},${x-1}`),r:d.has(`${Ve(h+1)},${x}`),b:d.has(`${h},${x+1}`),l:d.has(`${Ve(h-1)},${x}`)};s.has(f)||s.set(f,[]),s.get(f).push({visX:y,y:p.y,screenX:v,screenY:m,width:w,cell:p.data,color:p.data.color,neighbors:C,isFalling:!0})}})}),s}const sm=e=>{switch(e){case"COOLDOWN_BOOSTER":return"CB";case"GOOP_DUMP":return"GD";case"GOOP_COLORIZER":return"GC";case"CRACK_DOWN":return"CD";default:return e.charAt(0)}},om=e=>{switch(e){case"COOLDOWN_BOOSTER":return"#5bbc70";case"GOOP_DUMP":return"#f97316";case"GOOP_COLORIZER":return"#a855f7";case"CRACK_DOWN":return"#ef4444";default:return"#6acbda"}},rm=({upgradeId:e,name:t,charge:n,isReady:s,x:r,y:o,size:a,onClick:i})=>{const[c,u]=g.useState(!1),f=g.useCallback(x=>{x.stopPropagation(),x.preventDefault(),s?i==null||i():(u(!0),setTimeout(()=>u(!1),300))},[s,i]),d=om(e),p=sm(e),y=a/2,v=2,k=n/100,w=y*2,m=k*w,h=y-m;return l.jsx("g",{transform:`translate(${r}, ${o})`,children:l.jsxs("g",{className:c?"shake-anim":"",style:{cursor:"pointer"},onPointerDown:f,children:[l.jsx("defs",{children:l.jsx("clipPath",{id:`clip-${e}`,children:l.jsx("circle",{cx:0,cy:0,r:y-v})})}),l.jsx("circle",{cx:0,cy:0,r:y-v,fill:d,fillOpacity:.25}),!s&&l.jsx("rect",{x:-(y-v),y:h,width:(y-v)*2,height:m,fill:d,fillOpacity:.75,clipPath:`url(#clip-${e})`}),s&&l.jsx("circle",{cx:0,cy:0,r:y-v,fill:d,fillOpacity:.85}),l.jsx("circle",{cx:0,cy:0,r:y-v,fill:"none",stroke:d,strokeWidth:v}),s&&l.jsx("circle",{cx:0,cy:0,r:y,fill:"none",stroke:d,strokeWidth:2,opacity:.5,className:"animate-pulse"}),l.jsx("text",{x:0,y:0,textAnchor:"middle",dominantBaseline:"central",fill:s?"white":"#e2e8f0",fontSize:a*.3,fontWeight:"bold",fontFamily:"monospace",children:p})]})})},Gs=48,Bs=12,kf=({piece:e,label:t,visible:n,rank:s=0})=>{const[r,o]=g.useState(Date.now());if(g.useEffect(()=>{if(!(e!=null&&e.isWild))return;const c=setInterval(()=>o(Date.now()),50);return()=>clearInterval(c)},[e==null?void 0:e.isWild]),!n)return null;const a=c=>{const u=Rn(s),f=400,d=.15,p=r%(u.length*f)/f,y=c*d,v=(p+y)%u.length,k=Math.floor(v),w=(k+1)%u.length,m=v-k,h=u[k],x=u[w],C=parseInt(h.slice(1,3),16),j=parseInt(h.slice(3,5),16),P=parseInt(h.slice(5,7),16),R=parseInt(x.slice(1,3),16),S=parseInt(x.slice(3,5),16),T=parseInt(x.slice(5,7),16),E=Math.round(C+(R-C)*m),M=Math.round(j+(S-j)*m),U=Math.round(P+(T-P)*m);return`rgb(${E}, ${M}, ${U})`};let i=null;if(e){const c=e.isWild,u=Math.min(...e.cells.map(m=>m.x)),f=Math.max(...e.cells.map(m=>m.x)),d=Math.min(...e.cells.map(m=>m.y)),p=Math.max(...e.cells.map(m=>m.y)),y=f-u+1,v=p-d+1,k=(Gs-y*Bs)/2,w=(Gs-v*Bs)/2;i=e.cells.map((m,h)=>{var C;const x=k+(m.x-u)*Bs;return l.jsx("rect",{x,y:w+(m.y-d)*Bs,width:Bs-1,height:Bs-1,fill:c?a(x):((C=e.cellColors)==null?void 0:C[h])??e.color,rx:2},h)})}return l.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",border:"2px solid #475569",borderRadius:"6px",padding:"4px 6px",display:"flex",flexDirection:"column",alignItems:"center"},children:[l.jsx("div",{className:"t-body",style:{color:"#94a3b8",textAlign:"center",marginBottom:"2px",fontFamily:"monospace",letterSpacing:"1px"},children:t}),l.jsxs("svg",{width:Gs,height:Gs,style:{display:"block"},children:[l.jsx("rect",{x:0,y:0,width:Gs,height:Gs,fill:"rgba(30, 41, 59, 0.5)",rx:4}),i]})]})};function im(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Bi(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=im(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function lm(e){return Bi(e.map(t=>t.pos))}function wf(e){if(!e.loopStarts||e.loopStarts.length<=1)return lm(e.vertices);let t="";for(let n=0;n<e.loopStarts.length;n++){const s=e.loopStarts[n],r=n+1<e.loopStarts.length?e.loopStarts[n+1]:e.vertices.length,o=e.vertices.slice(s,r);o.length>=3&&(t+=Bi(o.map(a=>a.pos))+" ")}return t.trim()}function Rf(e){let t=1/0,n=-1/0,s=1/0,r=-1/0;for(const o of e)o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y);return{minX:t,maxX:n,minY:s,maxY:r}}function Pf(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?100:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<1e-4||v<1e-4){r.push({...i});continue}const k=-f/y,w=u/y,m=-p/v,h=d/v;let x=k+m,C=w+h;const j=Math.sqrt(x*x+C*C);j<1e-4?(x=k,C=w):(x/=j,C/=j);const P=k*x+w*C,R=P>.1?1/P:1,S=s[o]*.4,T=Math.min(t,S)*Math.min(R,2);r.push({x:i.x+x*T,y:i.y+C*T})}return r}function am(e,t){if(!e.loopStarts||e.loopStarts.length<=1){const r=e.vertices.map(a=>a.pos),o=Pf(r,t);return{path:Bi(o),bounds:Rf(o)}}let n="",s=[];for(let r=0;r<e.loopStarts.length;r++){const o=e.loopStarts[r],a=r+1<e.loopStarts.length?e.loopStarts[r+1]:e.vertices.length,i=e.vertices.slice(o,a);if(i.length>=3){const c=i.map(f=>f.pos),u=Pf(c,t);n+=Bi(u)+" ",s=s.concat(u)}}return{path:n.trim(),bounds:Rf(s)}}function jf(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function Tf(e,t){const n=t*Math.PI/180,s=Math.cos(n),r=Math.sin(n);return{x:e.x*s-e.y*r,y:e.x*r+e.y*s}}const zi={damping:.98,stiffness:10,pressure:20,iterations:3,homeStiffness:.35,innerHomeStiffness:.64,returnSpeed:.8,viscosity:.7,gravity:10,fallingHomeStiffness:.35,fallingReturnSpeed:.8,fallingViscosity:.7,fallingGravity:10,attractionRadius:30,attractionRestLength:1,attractionStiffness:.037,goopiness:36,tendrilEndRadius:1,tendrilSkinniness:.2,wallThickness:8,fallingGoopiness:36,fallingTendrilEndRadius:1,fallingTendrilSkinniness:.2,dropletCount:30,dropletSpeed:60,dropletLifetime:3,dropletSize:9,dropletGravity:180},Et=30,Pn={x:-(rt/2)*Et,y:0},zo=Re*Et;function cm(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function um(e){if(e.length===0)return[];const t=new Map;for(const a of e){const i=`${a.x1},${a.y1}`,c=`${a.x2},${a.y2}`;t.has(i)||t.set(i,[]),t.has(c)||t.set(c,[]),t.get(i).push(a),t.get(c).push(a)}const n=(a,i)=>{const c=i.x===a.x1&&i.y===a.y1?a.x2:a.x1,u=i.x===a.x1&&i.y===a.y1?a.y2:a.y1;return Math.atan2(u-i.y,c-i.x)},s=(a,i)=>{let c=i-a;for(;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;return c},r=new Set,o=[];for(;r.size<e.length;){const a=e.find(y=>!r.has(y));if(!a)break;const i=[];let c=a,u={x:c.x1,y:c.y1};const f={x:u.x,y:u.y};let d=n(c,u)+Math.PI,p=!0;for(;;){r.add(c),i.push({x:u.x,y:u.y});const y=u.x===c.x1&&u.y===c.y1?{x:c.x2,y:c.y2}:{x:c.x1,y:c.y1};if(!p&&y.x===f.x&&y.y===f.y)break;p=!1,d=Math.atan2(y.y-u.y,y.x-u.x)+Math.PI;const k=`${y.x},${y.y}`,m=(t.get(k)||[]).filter(C=>!r.has(C));if(m.length===0)break;let h=m[0],x=-1/0;for(const C of m){const j=n(C,y),P=s(d,j);P>x&&(x=P,h=C)}c=h,u=y}i.length>=3&&o.push(i)}return o}function fm(e){return e.map(t=>({x:Pn.x+t.x*Et,y:Pn.y+t.y*Et}))}function bf(e){let t=0,n=0;for(const s of e){const r=Pn.x+(s.x+.5)*Et,o=Pn.y+(s.y+.5)*Et;t+=r,n+=o}return{x:t/e.length,y:n/e.length}}function dm(e,t,n,s,r=0){const o=cm(e),i=um(o).map(S=>fm(S)),c=S=>{let T=0;for(let E=0;E<S.length;E++){const M=(E+1)%S.length;T+=S[E].x*S[M].y-S[M].x*S[E].y}return T/2};i.sort((S,T)=>Math.abs(c(T))-Math.abs(c(S)));const u=i.map((S,T)=>{const E=c(S);return T===0?E>0?S:[...S].reverse():E<0?S:[...S].reverse()});let f=[];const d=[];for(const S of u)d.push(f.length),f=f.concat(S);if(f.length<3){const S=bf(e),T=Et*.4;f=[{x:S.x-T,y:S.y-T},{x:S.x+T,y:S.y-T},{x:S.x+T,y:S.y+T},{x:S.x-T,y:S.y+T}],d.length=0,d.push(0)}const p=bf(e),y=p.x,v=p.y,k=f.map(S=>({pos:{x:S.x,y:S.y},oldPos:{x:S.x,y:S.y},homeOffset:{x:S.x-y,y:S.y-v},mass:1,attractionRadius:.8+Math.random()*.4})),w=k.length,m=[];for(let S=0;S<d.length;S++){const T=d[S],E=S+1<d.length?d[S+1]:w;for(let M=T;M<E;M++){const U=M+1<E?M+1:T;m.push({a:M,b:U,restLength:jf(k[M].pos,k[U].pos)})}}const h=new Set;for(const S of m)h.add(`${Math.min(S.a,S.b)}-${Math.max(S.a,S.b)}`);const x=[],C=Et*1.5,j=new Set;for(let S=0;S<w;S++)for(let T=S+1;T<w;T++){const E=`${S}-${T}`;if(h.has(E))continue;const M=jf(k[S].pos,k[T].pos);M<C&&(j.has(E)||(j.add(E),x.push({a:S,b:T,restLength:M})))}let P=0;for(let S=0;S<d.length;S++){const T=d[S],E=S+1<d.length?d[S+1]:f.length;let M=0;for(let U=T;U<E;U++){const J=U+1<E?U+1:T;M+=f[U].x*f[J].y-f[J].x*f[U].y}P+=M}return P=Math.abs(P)/2,{id:n,color:t,vertices:k,innerVertices:[{pos:{x:y,y:v},oldPos:{x:y,y:v},homeOffset:{x:0,y:0},mass:1,attractionRadius:1}],loopStarts:d,ringsprings:m,crossSprings:x,restArea:P,gridCells:e.map(S=>({x:S.x,y:S.y})),isColliding:!1,isLocked:s,isFalling:!s,isLoose:!1,looseTime:0,fillAmount:s?0:1,wasFullLastFrame:!s,rotation:0,targetX:y,targetY:v,visualOffsetY:0,createdAtRotation:r}}function vo(e,t){let n=t-e;return n>zo/2&&(n-=zo),n<-zo/2&&(n+=zo),n}function pm(e,t,n){const s=Math.min(t,.033);for(const r of e){const o=n.damping;let a=r.isLocked?n.gravity:n.fallingGravity;if(r.isLoose){r.looseTime+=s;const i=.6,c=Math.min(1,r.looseTime/i);a*=c*c*c}else r.looseTime=0;for(const i of r.vertices){const c=(i.pos.x-i.oldPos.x)*o,u=(i.pos.y-i.oldPos.y)*o;i.oldPos.x=i.pos.x,i.oldPos.y=i.pos.y,i.pos.x+=c,i.pos.y+=u+a*s*s}for(const i of r.innerVertices){const c=(i.pos.x-i.oldPos.x)*o,u=(i.pos.y-i.oldPos.y)*o;i.oldPos.x=i.pos.x,i.oldPos.y=i.pos.y,i.pos.x+=c,i.pos.y+=u+a*s*s}}}function hm(e,t){for(const n of e){const s=n.isLocked?t.returnSpeed:t.fallingReturnSpeed,r=s*s,o=n.isLocked?t.viscosity:t.fallingViscosity,a=Math.max(0,1-o),i=o>0?.03/Math.max(1,o):0,c=n.isLocked?t.homeStiffness:t.fallingHomeStiffness;for(const u of n.vertices){const f=Tf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,v=p-u.pos.y,k=y*c*r,w=v*c*r;u.pos.x+=k*a,u.pos.y+=w*a,o>0&&(u.oldPos.x-=k*i,u.oldPos.y-=w*i)}for(const u of n.innerVertices){const f=Tf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,v=p-u.pos.y,k=y*t.innerHomeStiffness*r,w=v*t.innerHomeStiffness*r;u.pos.x+=k*a,u.pos.y+=w*a,o>0&&(u.oldPos.x-=k*i,u.oldPos.y-=w*i)}}}function Mf(e,t,n){const s=e[t.a],r=e[t.b],o=vo(s.pos.x,r.pos.x),a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)return;const u=(i-t.restLength)/i*n*.5;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}function xm(e,t){for(let n=0;n<t.iterations;n++)for(const s of e){for(const r of s.ringsprings)Mf(s.vertices,r,t.stiffness*.01);for(const r of s.crossSprings)Mf(s.vertices,r,t.stiffness*.005)}}function ym(e,t){for(const n of e){if(!n.isLocked)continue;const s=n.targetX,r=n.targetY,o=t.pressure*.002;for(const a of n.vertices){const i=a.pos.x-s,c=a.pos.y-r,u=Math.sqrt(i*i+c*c),f=Math.sqrt(a.homeOffset.x*a.homeOffset.x+a.homeOffset.y*a.homeOffset.y);if(u>1e-4&&f>1e-4){const p=(f-u)*o;a.pos.x+=i/u*p,a.pos.y+=c/u*p}}}}function mm(e,t){for(const r of e){for(const o of r.vertices){if(o.pos.y<t.minY+2){o.pos.y=t.minY+2;const a=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-a*.3}if(o.pos.y>t.maxY-2){o.pos.y=t.maxY-2;const a=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-a*.3}}for(const o of r.innerVertices)o.pos.y<t.minY+2&&(o.pos.y=t.minY+2),o.pos.y>t.maxY-2&&(o.pos.y=t.maxY-2)}}function gm(e,t,n,s){pm(e,t,n),hm(e,n),xm(e,n),ym(e,n),mm(e,s)}function vm(e,t){const n=e.vertices,s=n.length;for(let r=0;r<s;r++){const o=n[(r-1+s)%s],a=n[r],i=n[(r+1)%s],c=a.pos.x-o.pos.x,u=a.pos.y-o.pos.y,f=i.pos.x-a.pos.x,d=i.pos.y-a.pos.y,p=Math.sqrt(c*c+u*u),y=Math.sqrt(f*f+d*d);if(p<1e-4||y<1e-4)continue;const v=u/p,k=-c/p,w=d/y,m=-f/y;let h=v+w,x=k+m;const C=Math.sqrt(h*h+x*x);C<1e-4||(h/=C,x/=C,n[r].oldPos.x-=h*t,n[r].oldPos.y-=x*t)}}function Sm(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertexA],u=i.vertices[o.vertexB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertexA}-${o.blobB}-${o.vertexB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=vo(c.targetX,i.targetX),f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++){const y=i.vertices[p],v=n.attractionRadius*y.attractionRadius;for(let k=0;k<c.vertices.length;k++){const w=c.vertices[k],m=n.attractionRadius*w.attractionRadius,h=(v+m)/2,x=vo(y.pos.x,w.pos.x),C=w.pos.y-y.pos.y,j=Math.sqrt(x*x+C*C),P=`${o}-${p}-${a}-${k}`;r.has(P)||j>h||(s.push({blobA:o,blobB:a,vertexA:p,vertexB:k,restLength:n.attractionRestLength}),r.add(P))}}}return s}function Cm(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertexA],u=i.vertices[o.vertexB];if(!c||!u)continue;const f=vo(c.pos.x,u.pos.x),d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=Math.max(0,Math.min(1,1-p/n.goopiness)),v=s+y*(r-s),w=(p-o.restLength)*v,m=f/p*w,h=d/p*w;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function km(e,t=30){for(let o=0;o<3;o++)for(let a=0;a<e.length;a++)for(let i=a+1;i<e.length;i++){const c=e[a],u=e[i];if(c.color===u.color)continue;const f=c.isFalling||c.isLoose,d=u.isFalling||u.isLoose;if(!f&&!d)continue;const p=c.targetX-u.targetX,y=c.targetY-u.targetY;if(!(Math.sqrt(p*p+y*y)>t*4))for(const k of c.vertices)for(const w of u.vertices){const m=w.pos.x-k.pos.x,h=w.pos.y-k.pos.y,x=Math.sqrt(m*m+h*h);if(x<2.5&&x>.01){const C=2.5-x,j=m/x,P=h/x,R=C*.8;k.pos.x-=j*R*.5,k.pos.y-=P*R*.5,w.pos.x+=j*R*.5,w.pos.y+=P*R*.5,k.oldPos.x-=j*R*.3,k.oldPos.y-=P*R*.3,w.oldPos.x+=j*R*.3,w.oldPos.y+=P*R*.3}}}}function wm(e,t,n,s,r,o=0){var d;if(e.isLocked||e.isLoose)return;let a=!0;for(const p of e.gridCells){const y=p.y+1;if(y>=r){a=!1;break}const v=Math.floor(y)+nt;let k=Math.floor(p.x)+o;for(;k<0;)k+=Re;for(;k>=Re;)k-=Re;const w=(d=s[v])==null?void 0:d[k];if(w&&w.goopGroupId!==void 0){a=!1;break}}if(e.isColliding=!a,a){const p=n*t;for(e.visualOffsetY+=p;e.visualOffsetY>=Et;){for(const y of e.gridCells)y.y+=1;e.visualOffsetY-=Et}}let i=0,c=0;for(const p of e.gridCells)i+=p.x,c+=p.y;const u=i/e.gridCells.length,f=c/e.gridCells.length;e.targetX=Pn.x+(u+.5)*Et,e.targetY=Pn.y+(f+.5)*Et+e.visualOffsetY}function Fl(e){if(e.vertices.length<3)return[0];const t=e.vertices.map(c=>c.pos.x),n=Math.min(...t),s=Math.max(...t),r=-180,o=180,a=[],i=zo;for(const c of[0,i,-i]){const u=n+c;s+c>=r&&u<=o&&a.push(c)}return a.length>1&&console.log(`Blob ${e.id} straddles seam, rendering at offsets:`,a,`(X range: ${n.toFixed(0)} to ${s.toFixed(0)})`),a.length>0?a:[0]}const Rm=({state:e,rank:t,maxTime:n,lightsBrightness:s=100,laserCharge:r=100,controlsHeat:o=0,complicationCooldowns:a,equippedActives:i=[],activeCharges:c={},onActivateAbility:u,powerUps:f,storedGoop:d,nextGoop:p,softBodyPhysics:y,normalGoopOpacity:v=1,showVertexDebug:k=!1,gooStdDev:w=8,gooAlphaMul:m=24,gooAlphaOff:h=-13,fallingGooStdDev:x,fallingGooAlphaMul:C,fallingGooAlphaOff:j,trainingHighlightColor:P,disableSwap:R,disablePop:S})=>{const{grid:T,tankRotation:E,activeGoop:M,looseGoop:U,floatingTexts:J,shiftTime:se,goalMarks:N,crackCells:Y,dumpPieces:ee}=e,B=g.useMemo(()=>Rn(t),[t]),Q=g.useMemo(()=>se<=0?1:Math.max(0,1-se/n),[se,n]),re=`hsla(${Math.max(0,120*(1-Q))}, 100%, 50%, 0.15)`,oe=1+Q*(Bt-1),{x:ve,y:Pe,w:be,h:A}=zs,G=oe*We,X=A-G,{handlers:W,holdState:fe,highlightedGroupId:ie,shakingGroupId:le}=em({callbacks:{},tankRotation:E,grid:T,tankPressure:Q,powerUps:f,trainingHighlightColor:P,disableSwap:R,disablePop:S}),[q,ke]=g.useState(-1),[Ce,je]=g.useState(0);g.useEffect(()=>pe.on(ae.INPUT_SWAP_HOLD,L=>{ke((L==null?void 0:L.progress)??-1)}),[]),g.useEffect(()=>{var b,_;if(!y)return;const D=new Set;for(let O=nt;O<Ne;O++)for(let $=0;$<Re;$++){const V=(b=T[O])==null?void 0:b[$];V!=null&&V.goopGroupId&&D.add(V.goopGroupId)}const L=new Map;for(let O=0;O<Bt;O++){const $=O+nt;for(let V=0;V<rt;V++){const te=(E+V)%Re,me=(_=T[$])==null?void 0:_[te];if(me!=null&&me.goopGroupId){const ge=me.goopGroupId;L.has(ge)||L.set(ge,{cells:[],color:me.color}),L.get(ge).cells.push({x:V,y:O})}}}const F=new Set(y.blobs.map(O=>O.id));let H=!1;for(const[O,$]of L)F.has(O)||(y.createBlob($.cells,$.color,O,!0,E),H=!0);y.shiftBlobsForRotation(E);const ne=new Map;for(const O of U){const $=O.data.goopGroupId;ne.has($)||ne.set($,{avgY:0,cells:[]}),ne.get($).cells.push({x:O.x,y:O.y})}for(const[O,$]of ne){const V=$.cells.reduce((te,me)=>te+me.y,0)/$.cells.length;$.avgY=V}for(const O of y.blobs){const $=ne.get(O.id);if($){O.isLoose=!0,O.isLocked=!1;const V=($.avgY-nt)*Et;O.targetY=V}else O.isLoose&&(O.isLoose=!1,O.isLocked=!0,O.fillAmount=0)}const we=new Set(U.map(O=>O.data.goopGroupId));for(const O of y.blobs)O.id.startsWith("active-")||!D.has(O.id)&&!we.has(O.id)&&(e.poppedGoopGroupIds.has(O.id)&&(y.createDropletsForPop(O),e.poppedGoopGroupIds.delete(O.id)),y.removeBlob(O.id),H=!0);H&&je(O=>O+1)},[T,E,y]);const De=g.useRef(null);g.useEffect(()=>{var F;if(!y||!M||M.state!==Fn.FALLING)return;const D=`active-${M.spawnTimestamp}`;if(!y.getBlob(D)){const H=M.cells.map(_=>({x:_.x,y:_.y}));let ne=M.x-E;ne>Re/2&&(ne-=Re),ne<-Re/2&&(ne+=Re);const we=H.map(_=>({x:ne+_.x,y:M.y+_.y-nt})),b=((F=M.definition.cellColors)==null?void 0:F[0])??M.definition.color;y.createBlob(we,b,D,!1,E),je(_=>_+1)}},[M==null?void 0:M.spawnTimestamp,y,E]);const Fe=g.useRef(null),Te=g.useRef(0);g.useEffect(()=>{if(!y||!M||M.state!==Fn.FALLING)return;const D=`active-${M.spawnTimestamp}`,L=y.getBlob(D);if(!L)return;let F=M.x-E;F>Re/2&&(F-=Re),F<-Re/2&&(F+=Re);const H=M.rotation,ne=Fe.current!==null&&Fe.current!==H,we=Te.current!==E;if(ne){let b=L.gridCells.length>0?L.gridCells[0].y:0;for(const $ of L.gridCells)$.y<b&&(b=$.y);let _=M.cells.length>0?M.cells[0].y:0;for(const $ of M.cells)$.y<_&&(_=$.y);const O=M.cells.map($=>({x:F+$.x,y:b+($.y-_)}));L.gridCells=O,L.rotation=H*90}if(we||ne){for(let $=0;$<L.gridCells.length&&$<M.cells.length;$++)L.gridCells[$].x=F+M.cells[$].x;let b=0;for(const $ of L.gridCells)b+=$.x;const _=b/L.gridCells.length,O=Pn.x+(_+.5)*Et;if(we){const $=O-L.targetX;for(const V of L.vertices)V.pos.x+=$,V.oldPos.x+=$;for(const V of L.innerVertices)V.pos.x+=$,V.oldPos.x+=$}L.targetX=O}Fe.current=H,Te.current=E},[M==null?void 0:M.x,M==null?void 0:M.rotation,M==null?void 0:M.state,y,E]),g.useEffect(()=>{if(!y)return;const D=De.current,L=M;if(D&&D.state===Fn.FALLING&&(!L||L.spawnTimestamp!==D.spawnTimestamp)){const F=`active-${D.spawnTimestamp}`;y.removeBlob(F),je(H=>H+1)}De.current=L},[M,y]);const ze=Date.now(),ye=g.useMemo(()=>nm(T,E,U),[T,E,U]),I=g.useCallback(D=>{if(B.length===0)return"#a855f7";const L=400,F=.02,H=ze%(B.length*L)/L,ne=Math.abs(D)*F;let we=(H+ne)%B.length;we<0&&(we+=B.length);const b=Math.floor(we),_=(b+1)%B.length,O=we-b,$=B[b],V=B[_];if(!$||!V)return"#a855f7";const te=parseInt($.slice(1,3),16),me=parseInt($.slice(3,5),16),ge=parseInt($.slice(5,7),16),Z=parseInt(V.slice(1,3),16),Oe=parseInt(V.slice(3,5),16),Ee=parseInt(V.slice(5,7),16),$e=Math.round(te+(Z-te)*O),Ye=Math.round(me+(Oe-me)*O),Xe=Math.round(ge+(Ee-ge)*O);return`rgb(${$e}, ${Ye}, ${Xe})`},[ze,B]),z=g.useMemo(()=>vn?null:l.jsx("defs",{children:Array.from(ye.entries()).map(([D,L])=>l.jsx("mask",{id:`mask-${D}`,children:L.map((F,H)=>l.jsx("path",{d:tm(F.screenX,F.screenY,F.width,We,F.neighbors),fill:"white",stroke:"white",strokeWidth:"1.5"},F.cell.id+"-"+H))},`mask-${D}`))}),[ye]);g.useMemo(()=>new Set(N.map(D=>D.color)),[N]);const he=((f==null?void 0:f.GOOP_HOLD_VIEWER)||0)>=1,xe=((f==null?void 0:f.GOOP_WINDOW)||0)>=1;return l.jsxs("div",{className:"w-full h-full bg-slate-950 relative shadow-2xl border-x-4 border-slate-900 overflow-hidden select-none touch-none",style:{touchAction:"manipulation",contain:"strict"},onPointerDown:W.onPointerDown,onPointerMove:W.onPointerMove,onPointerUp:W.onPointerUp,onPointerLeave:W.onPointerUp,onTouchStart:W.onTouchStart,onTouchMove:W.onTouchMove,onTouchEnd:W.onTouchEnd,onTouchCancel:W.onTouchCancel,children:[!vn&&l.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] hidden md:block",style:{backgroundSize:"100% 2px, 3px 100%"}}),l.jsxs("svg",{width:"100%",height:"100%",viewBox:`${ve} ${Pe} ${be} ${A}`,preserveAspectRatio:"xMidYMin meet",className:"touch-none",style:{pointerEvents:"none",willChange:"transform",filter:s<100?`brightness(${s/100}) grayscale(${Math.max(0,(50-s)/50)})`:s>100?`brightness(${s/100})`:void 0,transition:"filter 0.05s linear"},children:[z,l.jsxs("defs",{children:[l.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:w,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${m} ${h}`,result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),l.jsxs("filter",{id:"goo-filter-falling",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:x??w,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${C??m} ${j??h}`,result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),l.jsx("clipPath",{id:"tank-viewport-clip",children:l.jsx("rect",{x:zs.x,y:zs.y,width:zs.w,height:zs.h})})]}),l.jsx("rect",{x:ve,y:X,width:be,height:G,fill:re}),l.jsx("line",{x1:ve,y1:X,x2:ve+be,y2:X,stroke:re.replace("0.15","0.6"),strokeWidth:"2",strokeDasharray:"4 4"}),!vn&&Array.from({length:Bt}).map((D,L)=>{const F=L*We;return Array.from({length:rt}).map((H,ne)=>{const we=Ct(ne),b=Ct(ne+1)-we;return l.jsxs("g",{children:[l.jsx("line",{x1:we,y1:F,x2:we+b,y2:F,stroke:tt.GRID_EMPTY,strokeWidth:"1",opacity:.2}),l.jsx("line",{x1:we,y1:F,x2:we,y2:F+We,stroke:tt.GRID_EMPTY,strokeWidth:"1",opacity:.2})]},`bg-${L}-${ne}`)})}),Y&&Y.filter(D=>ze-D.spawnTime>=500).map(D=>D.branchCrackIds.map(L=>{const F=Y.find(ge=>ge.id===L);if(!F||ze-F.spawnTime<500)return null;let H=D.x-E;H>Re/2&&(H-=Re),H<-Re/2&&(H+=Re);let ne=F.x-E;if(ne>Re/2&&(ne-=Re),ne<-Re/2&&(ne+=Re),H<-1||H>rt||ne<-1||ne>rt)return null;const we=Ct(H),b=Ct(H+1)-we,_=we+b/2,O=(D.y-nt)*We+We/2,$=Ct(ne),V=Ct(ne+1)-$,te=$+V/2,me=(F.y-nt)*We+We/2;return l.jsx("line",{x1:_,y1:O,x2:te,y2:me,stroke:D.color,strokeWidth:"2",strokeOpacity:.7},`crack-line-${D.id}-${L}`)})),Y&&Y.filter(D=>ze-D.spawnTime>=500).map(D=>{let L=D.x-E;if(L>Re/2&&(L-=Re),L<-Re/2&&(L+=Re),L>=0&&L<rt){const F=Ct(L),H=Ct(L+1)-F,ne=(D.y-nt)*We,we=F+H/2,b=ne+We/2;return l.jsx("circle",{cx:we,cy:b,r:We/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`crack-${D.id}`)}return null}),N.filter(D=>ze-D.spawnTime>=500).map(D=>{let L=D.x-E;if(L>Re/2&&(L-=Re),L<-Re/2&&(L+=Re),L>=0&&L<rt){const F=Ct(L),H=Ct(L+1)-F,ne=(D.y-nt)*We,we=F+H/2,b=ne+We/2;return l.jsx("circle",{cx:we,cy:b,r:We/4,fill:D.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`goal-${D.id}`)}return null}),N.map(D=>{let L=D.x-E;if(L>Re/2&&(L-=Re),L<-Re/2&&(L+=Re),L<0||L>=rt){const F=L>=rt,H=(D.y-nt)*We+We/2,ne=F?ve+be-5:ve+5;return l.jsx("g",{opacity:.7,children:l.jsx("path",{d:F?`M ${ne} ${H-10} L ${ne+10} ${H} L ${ne} ${H+10} Z`:`M ${ne} ${H-10} L ${ne-10} ${H} L ${ne} ${H+10} Z`,fill:D.color,stroke:"white",strokeWidth:"1"})},`off-${D.id}`)}return null}),l.jsx("g",{opacity:v,children:Array.from(ye.entries()).map(([D,L])=>{if(L.length===0)return null;const H=L[0].color,ne=D===ie,we=D===le||e.prePoppedGoopGroups.has(D),b=L.some(Z=>Z.cell.isSealingGoop),_=e.prePoppedGoopGroups.has(D),O=L.some(Z=>Z.cell.isWild);let $=1/0,V=1/0,te=-1/0,me=-1/0;L.forEach(Z=>{$=Math.min($,Z.screenX),V=Math.min(V,Z.screenY),te=Math.max(te,Z.screenX+Z.width),me=Math.max(me,Z.screenY+We)});const ge=O?I($):H;if(vn){const Z=L[0].cell.groupSize*go,Oe=ze-L[0].cell.timestamp,Ee=Math.min(1,Oe/Z),$e=Ee>=1,Ye=me-V,Xe=me-Ee*Ye;return l.jsxs("g",{className:we?"shake-anim":"",children:[L.map(Le=>l.jsx("rect",{x:Le.screenX-.5,y:Le.screenY,width:Le.width+1,height:We,fill:Le.cell.isWild?I(Le.screenX):H,fillOpacity:.25},`bg-${Le.cell.id}`)),!$e&&L.map(Le=>{const Je=Le.screenY+We,ce=Le.screenY;if(Je<=Xe)return null;const it=Math.max(ce,Xe),lt=Je-it;return l.jsx("rect",{x:Le.screenX-.5,y:it,width:Le.width+1,height:lt,fill:Le.cell.isWild?I(Le.screenX):H,fillOpacity:.75},`fill-${Le.cell.id}`)}),$e&&L.map(Le=>l.jsx("rect",{x:Le.screenX-.5,y:Le.screenY,width:Le.width+1,height:We,fill:Le.cell.isWild?I(Le.screenX):H,fillOpacity:.85},`full-${Le.cell.id}`)),L.map(Le=>l.jsx("path",{d:Br(Le.screenX,Le.screenY,Le.width,We,Le.neighbors),fill:"none",stroke:_?"#ff6b6b":b?"white":Le.cell.isWild?I(Le.screenX):H,strokeWidth:_||b?3:2,strokeDasharray:_?"4 2":void 0,className:Le.cell.isWild&&!_&&!b?"wild-stroke":void 0},`cnt-${Le.cell.id}`)),ne&&l.jsx("rect",{x:$,y:V,width:te-$,height:me-V,fill:"white",fillOpacity:.3})]},`group-${D}`)}return l.jsxs("g",{className:we?"shake-anim":"",children:[l.jsx("rect",{x:$,y:V,width:te-$,height:me-V,fill:ge,fillOpacity:.2,mask:`url(#mask-${D})`}),l.jsx("g",{opacity:.9,mask:`url(#mask-${D})`,children:L.map((Z,Oe)=>{const Ee=Z.cell.isWild?I(Z.screenX):H;if(!Z.cell||Z.isFalling)return l.jsx("rect",{x:Z.screenX-.5,y:Z.screenY,width:Z.width+1,height:We,fill:Ee},`liq-${Z.cell.id}`);const $e=Z.cell.groupSize*go,Ye=Z.cell.groupMaxY-Z.cell.groupMinY+1,Xe=$e/Math.max(1,Ye),Je=(Z.cell.groupMaxY-Z.y)*Xe,ce=ze-Z.cell.timestamp-Je;let it=ce>=Xe?We:ce>0?ce/Xe*We:0;return l.jsx("rect",{x:Z.screenX-.5,y:Z.screenY+(We-it),width:Z.width+1,height:it,fill:Ee},`liq-${Z.cell.id}`)})}),ne&&l.jsx("rect",{x:$,y:V,width:te-$,height:me-V,fill:"white",fillOpacity:.3,mask:`url(#mask-${D})`}),L.map((Z,Oe)=>l.jsx("path",{d:Br(Z.screenX,Z.screenY,Z.width,We,Z.neighbors),fill:"none",stroke:_?"#ff6b6b":b?"white":Z.cell.isWild?I(Z.screenX):H,strokeWidth:_||b?"3":"2",strokeDasharray:_?"4 2":void 0,className:!vn&&!_?Z.cell.isWild?"wild-stroke":b?"super-glowing-stroke":"glow-stroke":void 0,style:!vn&&!_&&!Z.cell.isWild?{color:b?"white":H}:void 0},`cnt-${Z.cell.id}`))]},`group-${D}`)})}),y&&y.blobs.length>0&&(()=>{const D=new Map;for(const H of y.blobs){if(H.isFalling)continue;const ne=D.get(H.color)||[];ne.push(H),D.set(H.color,ne)}const L=y.attractionSprings,F=y.params;return l.jsx(l.Fragment,{children:Array.from(D.entries()).map(([H,ne])=>{const we=P!=null&&H===P;return l.jsxs("g",{className:we?"training-pulse":void 0,children:[l.jsxs("g",{filter:"url(#goo-filter)",clipPath:"url(#tank-viewport-clip)",children:[L.map((b,_)=>{const O=y.blobs[b.blobA],$=y.blobs[b.blobB];if(!O||!$||O.color!==H)return null;const V=O.vertices[b.vertexA],te=$.vertices[b.vertexB];if(!V||!te)return null;const me=vo(V.pos.x,te.pos.x),ge=te.pos.y-V.pos.y,Z=Math.sqrt(me*me+ge*ge),Oe=Math.min(1,Z/F.goopiness),Ee=F.tendrilEndRadius;if(Ee<1)return null;const $e=1-F.tendrilSkinniness,Ye=1-F.tendrilSkinniness*.3,Xe=Ye-(Ye-$e)*Oe,Le=Ee*Xe,Je=Ee*1.4,ce=Math.max(2,Math.ceil(Z/Je)),it=[];for(let lt=0;lt<=ce;lt++){const Rt=lt/ce,de=Math.sin(Rt*Math.PI),ue=Ee-(Ee-Le)*de;it.push({cx:V.pos.x+me*Rt,cy:V.pos.y+ge*Rt,r:Math.max(2,ue)})}return l.jsx("g",{children:it.map((lt,Rt)=>l.jsx("circle",{cx:lt.cx,cy:lt.cy,r:lt.r,fill:O.color},Rt))},`tendril-${_}`)}),ne.map(b=>{const _=b.id===le||e.prePoppedGoopGroups.has(b.id),O=wf(b),V=Fl(b).map(te=>te===0?"":`translate(${te}, 0)`);return l.jsx("g",{className:_?"shake-anim":void 0,children:V.map((te,me)=>l.jsx("path",{d:O,fill:b.color,fillRule:"evenodd",transform:te},`soft-${b.id}-${me}`))},`soft-${b.id}`)})]}),l.jsx("g",{clipPath:"url(#tank-viewport-clip)",children:ne.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const _=b.id===le||e.prePoppedGoopGroups.has(b.id),O=F.wallThickness,{path:$,bounds:V}=am(b,O),te=V.maxY-V.minY,me=V.maxY-te*b.fillAmount,ge=`fill-clip-${b.id}`,Z=50,Ee=Fl(b).map($e=>$e===0?"":`translate(${$e}, 0)`);return l.jsx("g",{className:_?"shake-anim":void 0,children:Ee.map(($e,Ye)=>l.jsxs("g",{transform:$e,children:[l.jsx("defs",{children:l.jsx("clipPath",{id:`${ge}-${Ye}`,children:l.jsx("rect",{x:V.minX-Z,y:V.minY-Z,width:V.maxX-V.minX+Z*2,height:me-V.minY+Z})})}),l.jsx("path",{d:$,fill:"#1e293b",fillRule:"evenodd",clipPath:`url(#${ge}-${Ye})`})]},`cutout-${b.id}-${Ye}`))},`cutout-${b.id}`)})})]},`color-group-${H}`)})})})(),y&&(()=>{const D=y.blobs.filter(H=>H.isFalling&&!H.isLocked);if(D.length===0)return null;const L=y.attractionSprings,F=y.params;return l.jsxs("g",{filter:"url(#goo-filter-falling)",clipPath:"url(#tank-viewport-clip)",children:[L.map((H,ne)=>{const we=y.blobs[H.blobA],b=y.blobs[H.blobB];if(!we||!b||!we.isFalling&&!b.isFalling)return null;const _=we.vertices[H.vertexA],O=b.vertices[H.vertexB];if(!_||!O)return null;const $=vo(_.pos.x,O.pos.x),V=O.pos.y-_.pos.y,te=Math.sqrt($*$+V*V),me=Math.min(1,te/F.fallingGoopiness),ge=F.fallingTendrilEndRadius;if(ge<1)return null;const Z=1-F.fallingTendrilSkinniness,Oe=1-F.fallingTendrilSkinniness*.3,Ee=Oe-(Oe-Z)*me,$e=ge*Ee,Ye=ge*1.4,Xe=Math.max(2,Math.ceil(te/Ye)),Le=[];for(let Je=0;Je<=Xe;Je++){const ce=Je/Xe,it=Math.sin(ce*Math.PI),lt=ge-(ge-$e)*it;Le.push({cx:_.pos.x+$*ce,cy:_.pos.y+V*ce,r:Math.max(2,lt)})}return l.jsx("g",{children:Le.map((Je,ce)=>l.jsx("circle",{cx:Je.cx,cy:Je.cy,r:Je.r,fill:we.color},ce))},`falling-tendril-${ne}`)}),D.map(H=>Fl(H).map((we,b)=>{const _=wf(H);if(!_)return null;const O=we===0?void 0:`translate(${we}, 0)`,$=M==null?void 0:M.definition.isWild,V=$?I(H.targetX):H.color;return l.jsx("path",{d:_,fill:V,fillRule:"evenodd",fillOpacity:.8,transform:O,className:$?"wild-stroke wild-fill":void 0},`falling-${H.id}-${b}`)}))]})})(),y&&y.droplets.length>0&&l.jsx("g",{children:y.droplets.map(D=>l.jsx("circle",{cx:D.pos.x,cy:D.pos.y,r:D.radius,fill:D.color,opacity:D.opacity},D.id))}),k&&y&&y.blobs.length>0&&l.jsx("g",{children:y.blobs.map(D=>l.jsxs("g",{children:[l.jsx("circle",{cx:D.targetX,cy:D.targetY,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),D.vertices.map((L,F)=>{const H=D.vertices[(F+1)%D.vertices.length];return l.jsx("line",{x1:L.pos.x,y1:L.pos.y,x2:H.pos.x,y2:H.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${D.id}-${F}`)}),D.vertices.map((L,F)=>l.jsxs("g",{children:[l.jsx("circle",{cx:L.pos.x,cy:L.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),l.jsx("text",{x:L.pos.x+6,y:L.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:F})]},`v-${D.id}-${F}`)),D.innerVertices.map((L,F)=>l.jsx("circle",{cx:L.pos.x,cy:L.pos.y,r:3,fill:"gray",stroke:"white",strokeWidth:1},`iv-${D.id}-${F}`)),l.jsx("text",{x:D.targetX,y:D.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:D.isLocked?`${Math.round(D.fillAmount*100)}%`:"falling"})]},`debug-${D.id}`))}),M&&M.state===Fn.FALLING&&(()=>{const D=M0(T,M),L=M.definition.isWild;return M.cells.map((F,H)=>{var O;const ne=((O=M.definition.cellColors)==null?void 0:O[H])??M.definition.color,we=Ve(M.x+F.x),b=D+F.y;if(b<nt)return null;let _=we-E;if(_>Re/2&&(_-=Re),_<-Re/2&&(_+=Re),_>=-2&&_<rt+2){const $=Ct(_),V=Ct(_+1)-$,te=(b-nt)*We,me={t:M.cells.some(ge=>ge.x===F.x&&ge.y===F.y-1),r:M.cells.some(ge=>ge.x===F.x+1&&ge.y===F.y),b:M.cells.some(ge=>ge.x===F.x&&ge.y===F.y+1),l:M.cells.some(ge=>ge.x===F.x-1&&ge.y===F.y)};return l.jsxs("g",{children:[l.jsx("rect",{x:$,y:te,width:V,height:We,fill:L?I($):ne,fillOpacity:.2,rx:4,ry:4}),l.jsx("path",{d:Br($,te,V,We,me),fill:"none",stroke:L?I($):ne,strokeWidth:"1",strokeDasharray:"4 2",opacity:"0.75",className:L?"wild-stroke":void 0})]},`ghost-${H}`)}return null})})(),ee&&ee.map(D=>{let L=D.x-E;if(L>Re/2&&(L-=Re),L<-Re/2&&(L+=Re),L<-1||L>rt)return null;const F=Ct(L),H=Ct(L+1)-F,ne=(D.y-nt)*We;return ne<-We?null:l.jsxs("g",{children:[l.jsx("rect",{x:F,y:ne,width:H,height:We,fill:D.color,fillOpacity:.3,rx:4,ry:4}),l.jsx("rect",{x:F,y:ne,width:H,height:We,fill:"none",stroke:D.color,strokeWidth:"2",strokeDasharray:"4 2",rx:4,ry:4})]},`dump-${D.id}`)}),M&&M.state===Fn.FALLING&&(()=>{if(y){const F=`active-${M.spawnTimestamp}`,H=y.getBlob(F);if(H&&H.isFalling&&!H.isLocked&&H.gridCells.some(we=>we.y>=0))return null}const D=M.definition.isWild,L=M.cells.map((F,H)=>{var O;const ne=((O=M.definition.cellColors)==null?void 0:O[H])??M.definition.color,we=Ve(M.x+F.x),b=M.y+F.y;let _=we-E;if(_>Re/2&&(_-=Re),_<-Re/2&&(_+=Re),_>=-2&&_<rt+2){const $=Ct(_),V=Ct(_+1)-$,te=(b-nt)*We,me={t:M.cells.some(ge=>ge.x===F.x&&ge.y===F.y-1),r:M.cells.some(ge=>ge.x===F.x+1&&ge.y===F.y),b:M.cells.some(ge=>ge.x===F.x&&ge.y===F.y+1),l:M.cells.some(ge=>ge.x===F.x-1&&ge.y===F.y)};return{screenX:$,screenY:te,width:V,neighbors:me,color:ne}}return null}).filter(Boolean);return L.length===0?null:l.jsxs("g",{children:[l.jsx("g",{opacity:.8,children:L.map((F,H)=>l.jsx("rect",{x:F.screenX,y:F.screenY,width:F.width,height:We,fill:D?I(F.screenX):F.color,rx:4,ry:4},H))}),L.map((F,H)=>l.jsx("path",{d:Br(F.screenX,F.screenY,F.width,We,F.neighbors),fill:"none",stroke:"white",strokeWidth:"2",className:D?"wild-stroke":void 0},`outline-${H}`))]})})(),J.map(D=>{let L=D.x-E;if(L>Re/2&&(L-=Re),L<-Re/2&&(L+=Re),L>=-2&&L<rt+2){const F=Ct(L),H=Ct(L+1)-F,ne=(D.y-nt)*We;return l.jsx("text",{x:F+H/2,y:ne+We/2,fill:D.color,textAnchor:"middle",className:"floating-score",fontSize:"24",children:D.text},D.id)}return null}),e.phase===qe.TankScreen&&l.jsxs(l.Fragment,{children:[t>=1&&l.jsxs("g",{children:[a&&a[Ie.LASER]>Date.now()&&l.jsxs("text",{x:ve+8+6,y:A*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((a[Ie.LASER]-Date.now())/1e3),"s"]}),l.jsx(Cf,{value:r,colorMode:"drain",x:ve+8,y:A*.04,height:A*.2,width:12})]}),t>=3&&l.jsxs("g",{children:[a&&a[Ie.CONTROLS]>Date.now()&&l.jsxs("text",{x:ve+be-20+6,y:A*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((a[Ie.CONTROLS]-Date.now())/1e3),"s"]}),l.jsx(Cf,{value:o,colorMode:"heat",x:ve+be-20,y:A*.04,height:A*.2,width:12})]}),i.length>0&&i.map((D,L)=>{const F=Nn[D];if(!F)return null;const H=c[D]||0,ne=H>=100,we=36,b=ve+be-26,_=A*.3+L*(we+8);return l.jsx(rm,{upgradeId:D,name:F.name,charge:H,isReady:ne,x:b,y:_,size:we,onClick:()=>ne&&(u==null?void 0:u(D))},D)})]})]}),fe.position&&fe.progress>0&&l.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:fe.position.x,top:fe.position.y,transform:"translate(-50%, -50%)"},children:l.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${fe.progress/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),q>=0&&l.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:"50%",bottom:"15%",transform:"translate(-50%, 0)"},children:l.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),l.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${q/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),e.complications.length>0&&l.jsx("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none",style:{gap:"1.5rem"},children:[...e.complications].sort((D,L)=>D.startTime-L.startTime).map(D=>{const F={[Ie.LIGHTS]:"Lights",[Ie.CONTROLS]:"Controls",[Ie.LASER]:"Laser"}[D.type]||D.type;return l.jsxs("div",{className:"malfunction-pulse text-center",style:{textShadow:"0 0 20px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.5)"},children:[l.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:F}),l.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:"Malfunction"}),l.jsx("div",{className:"text-red-400 mt-2",style:{fontFamily:"'Amazon Ember', sans-serif",fontSize:"clamp(0.875rem, 3vw, 1.25rem)"},children:"Fix at Console"})]},D.id)})}),e.phase===qe.TankScreen&&(he||xe)&&l.jsxs("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:10,display:"flex",gap:"8px"},children:[l.jsx(kf,{piece:d??null,label:"STORED",visible:he,rank:t}),l.jsx(kf,{piece:p??null,label:"NEXT",visible:xe,rank:t})]})]})};var Pm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const jm=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Tm=(e,t)=>{const n=g.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:a,children:i,...c},u)=>g.createElement("svg",{ref:u,...Pm,width:r,height:r,stroke:s,strokeWidth:a?Number(o)*24/Number(r):o,className:`lucide lucide-${jm(e)}`,...c},[...t.map(([f,d])=>g.createElement(f,d)),...(Array.isArray(i)?i:[i])||[]]));return n.displayName=`${e}`,n};var _t=Tm;const bm=_t("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Mm=_t("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Am=_t("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Em=_t("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),fl=_t("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Im=_t("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),_m=_t("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),Om=_t("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),ou=_t("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Lm=_t("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Nm=_t("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Dm=_t("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),$m=_t("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Fm=_t("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["line",{x1:"12",x2:"12.01",y1:"6",y2:"6",key:"16cbga"}]]),Gm=_t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Bm=_t("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),zm=_t("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),Ym=_t("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Hm=({state:e,maxTime:t})=>{const{shiftScore:n,gameOver:s,popStreak:r,shiftTime:o}=e,a=Math.max(0,Math.min(1,1-o/t)),i=a>.8,c=a>.9;return l.jsxs(l.Fragment,{children:[c&&!s&&l.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_40%,rgba(100,0,0,0.4)_100%)] animate-pulse"}),l.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 px-1 pt-4 pointer-events-none z-50 flex justify-between items-start",style:{width:"min(100%, 100dvh * 0.75)"},children:[l.jsxs("div",{className:"flex flex-col items-start drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[l.jsx("span",{className:"t-body uppercase font-bold tracking-widest mb-0.5 text-slate-400/90",children:"Pressure"}),l.jsxs("div",{className:`flex items-baseline gap-1 ${i?"text-red-500 animate-pulse":"text-slate-200"}`,children:[l.jsx(bm,{className:"w-5 h-5 opacity-90"}),l.jsxs("span",{className:"t-display font-mono font-black leading-none tracking-tighter",children:[(a*100).toFixed(0),"%"]})]})]}),l.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-16 flex flex-col items-center",children:r>1&&l.jsxs("div",{className:"t-heading text-yellow-400 animate-bounce font-black tracking-wider whitespace-nowrap drop-shadow-[0_4px_4px_rgba(0,0,0,0.9)] stroke-black",children:["x",r," SURGE"]})}),l.jsxs("div",{className:"flex flex-col items-end drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[l.jsx("span",{className:"t-body text-green-500/90 uppercase font-bold tracking-widest mb-0.5",children:"Shift Score"}),l.jsx("span",{className:"t-display font-mono text-green-400 font-black leading-none tracking-tighter shadow-green-500/10",children:n.toLocaleString()})]})]}),l.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center text-slate-500 t-body pointer-events-none hidden md:block opacity-30 z-50 font-mono",children:"ARROWS / WASD to Rotate Cylinder  SPACE to Drop  CLICK Masses to Purge"})]})},hs=50,en=e=>e<=0?0:e*(3375+125*e),Wm=e=>{if(e<=0)return 0;if(e>=hs)return en(hs);const t=en(e),n=en(e+1);return Math.floor(t+(n-t)*.5)},Um=()=>{const e=[];for(let t=10;t<=hs;t+=10)e.push(t);return e},Xm=(e,t)=>{if(t<=e)return[];const n=[],s=Um();for(const r of s)r>e&&r<=t&&n.push(r);return n},gt=e=>{if(e<en(1))return{rank:0,progress:Math.max(0,e),toNextRank:3500,careerScore:Math.max(0,e),isMaxRank:!1};let t=1;for(;t<hs&&e>=en(t+1);)t++;const n=en(t),s=en(t+1),r=e-n,o=s-n;return{rank:t,progress:r,toNextRank:o,careerScore:e,isMaxRank:t>=hs}},I0=(e,t,n)=>{const s=gt(e).rank,r=s+2,o=e+t,a=gt(o),i=a.rank-s;let c,u;return n?i===0?(c=s+1,u=en(c)+100):i===1?(c=s+2,u=en(c)+100):(c=r,u=en(c)+100):i<=2?(u=o,c=a.rank):(c=r,u=en(c)+100),c>hs&&(c=hs,u=en(hs)),{newCareerScore:u,ranksGained:c-s}},gs={[Ie.LASER]:{unlockRank:4,capacitorMax:100,drainPerUnit:4,drainUpgradeEffect:Nn.CAPACITOR_EFFICIENCY.effectPerLevel},[Ie.LIGHTS]:{unlockRank:2,graceBaseSec:5,gracePerLevel:.75,dimDurationSec:5,recoverRate:400,overflarePeak:110,overflareUpMs:50,overflareDownMs:100,dimThreshold:10,failedBrightness:5,snapToFailMs:100,flickerDipBrightness:70,flickerDipMs:80,flickerRecoverMs:120},[Ie.CONTROLS]:{unlockRank:6,heatMax:100,heatPerRotation:5,dissipationBase:50,dissipationUpgradeEffect:Nn.GEAR_LUBRICATION.effectPerLevel,idleThresholdMs:200}},Af={minSeconds:8,maxSeconds:20};function Vm(e,t){const n=gs[e].unlockRank;return Math.max(Af.minSeconds,Af.maxSeconds-(t-n))*1e3}function Wn(e,t){return t>=gs[e].unlockRank}class qm{constructor(){Be(this,"ctx",null);Be(this,"masterGain",null);Be(this,"musicGain",null);Be(this,"sfxGain",null);Be(this,"droneOsc",null);Be(this,"droneLfo",null);Be(this,"settings",{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1});Be(this,"isInitialized",!1)}init(t){if(this.isInitialized){this.updateSettings(t);return}this.settings=t;try{const n=window.AudioContext||window.webkitAudioContext;this.ctx=new n,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.updateVolumes(),this.isInitialized=!0}catch(n){console.error("Audio init failed",n)}}updateSettings(t){this.settings=t,this.updateVolumes()}updateVolumes(){if(!this.masterGain||!this.musicGain||!this.sfxGain||!this.ctx)return;const t=this.ctx.currentTime,n=this.settings.masterVolume/100*.5,s=this.settings.musicVolume/100,r=this.settings.sfxVolume/100;this.masterGain.gain.setTargetAtTime(n,t,.1),this.musicGain.gain.setTargetAtTime(s,t,.1),this.sfxGain.gain.setTargetAtTime(r,t,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}startMusic(){this.stopMusic()}stopMusic(){if(this.droneOsc){try{this.droneOsc.stop()}catch{}this.droneOsc=null}if(this.droneLfo){try{this.droneLfo.stop()}catch{}this.droneLfo=null}}setPressure(t){}playPop(t){if(!this.ctx||!this.sfxGain)return;const n=this.ctx.currentTime,s=this.ctx.createOscillator(),r=this.ctx.createGain();s.connect(r),r.connect(this.sfxGain);const o=400+t*50;s.frequency.setValueAtTime(o,n),s.frequency.exponentialRampToValueAtTime(o*2,n+.1),r.gain.setValueAtTime(.5,n),r.gain.exponentialRampToValueAtTime(.01,n+.15),s.start(n),s.stop(n+.15)}playReject(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(150,t),n.frequency.linearRampToValueAtTime(100,t+.15),s.gain.setValueAtTime(.3,t),s.gain.linearRampToValueAtTime(0,t+.15),n.start(t),n.stop(t+.15)}playMove(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="triangle";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(800,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),n.start(t),n.stop(t+.05)}playRotate(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="square";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(600,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),n.start(t),n.stop(t+.08)}playDrop(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sine",n.frequency.setValueAtTime(350,t),n.frequency.exponentialRampToValueAtTime(60,t+.15);const s=this.ctx.createGain();s.gain.setValueAtTime(.4,t),s.gain.exponentialRampToValueAtTime(.01,t+.15),n.connect(s),s.connect(this.sfxGain),n.start(t),n.stop(t+.15);const r=this.ctx.sampleRate*.2,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),a=o.getChannelData(0);for(let f=0;f<r;f++)a[f]=Math.random()*2-1;const i=this.ctx.createBufferSource();i.buffer=o;const c=this.ctx.createBiquadFilter();c.type="lowpass",c.Q.value=8,c.frequency.setValueAtTime(800,t),c.frequency.exponentialRampToValueAtTime(200,t+.15);const u=this.ctx.createGain();u.gain.setValueAtTime(.3,t),u.gain.exponentialRampToValueAtTime(.01,t+.15),i.connect(c),c.connect(u),u.connect(this.sfxGain),i.start(t)}playGameOver(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(400,t),n.frequency.linearRampToValueAtTime(50,t+1.5),s.gain.setValueAtTime(.5,t),s.gain.linearRampToValueAtTime(0,t+1.5),n.start(t),n.stop(t+1.5)}}const Tt=new qm,Km=1e3;class Zm{checkComplications(t,n,s){const r=Date.now();if(r-s<Km)return{spawned:null,newLastCheckTime:s};const o=f=>t.complications.some(d=>d.type===f),a=f=>r<t.complicationCooldowns[f],i=gt(n).rank,c=gs[Ie.CONTROLS];let u=null;return!o(Ie.LASER)&&!a(Ie.LASER)&&Wn(Ie.LASER,i)&&t.laserCharge<=0?u=Ie.LASER:!o(Ie.CONTROLS)&&!a(Ie.CONTROLS)&&Wn(Ie.CONTROLS,i)&&t.controlsHeat>=c.heatMax&&(u=Ie.CONTROLS),{spawned:u,newLastCheckTime:r}}spawnComplication(t,n){const r={id:Math.random().toString(36).substr(2,9),type:n,startTime:Date.now(),severity:1};return t.complications=[...t.complications,r],pe.emit(ae.COMPLICATION_SPAWNED,{type:n}),r}resolveComplication(t,n,s,r){const o=t.complications.find(a=>a.id===n);if(o){switch(o.type){case Ie.LASER:t.laserCharge=gs[Ie.LASER].capacitorMax,t.prePoppedGoopGroups.clear();break;case Ie.CONTROLS:t.controlsHeat=0,t.rotationTimestamps=[];break;case Ie.LIGHTS:t.lightsBrightness=100,t.lightsGraceStart=Date.now(),t.lightsFlickered=!1;break}const a=gt(s+t.shiftScore).rank,i=Vm(o.type,a);t.complicationCooldowns[o.type]=Date.now()+i}t.complications=t.complications.filter(a=>a.id!==n),t.activeComplicationId=null,pe.emit(ae.COMPLICATION_RESOLVED),Tt.playPop(5)}extendAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Ie)){const o=t.complicationCooldowns[r];if(o>s){const i=(o-s)*n;t.complicationCooldowns[r]=o+i}}}reduceAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Ie)){const o=t.complicationCooldowns[r];if(o>s){const i=(o-s)*n;t.complicationCooldowns[r]=Math.max(s,o-i)}}}}const Ys=new Zm;class zr{constructor(t){Be(this,"type","SPIN_TANK");this.dir=t}execute(t){if(t.state.gameOver||t.state.isPaused||t.trainingAllowedControls&&t.trainingAllowedControls.tankRotate===!1)return;const n=Ve(t.state.tankRotation+this.dir);let s=t.state.activeGoop;if(t.state.activeGoop){const c=tc(t.state.activeGoop.screenX,n);s={...t.state.activeGoop,x:c};const u=Math.round(s.y),f={...s,y:u};if(ms(t.state.grid,f)){pe.emit(ae.ACTION_REJECTED);return}ms(t.state.grid,s)&&(s=f)}t.state.tankRotation=n,s&&(t.state.activeGoop=s),t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++);const r=Date.now();t.state.rotationTimestamps.push(r),t.state.rotationTimestamps.length>Ox&&t.state.rotationTimestamps.shift();const o=gt(t.initialTotalScore).rank,a=gs[Ie.CONTROLS],i=Date.now()<t.state.complicationCooldowns[Ie.CONTROLS];Wn(Ie.CONTROLS,o)&&!i&&(t.state.controlsHeat=Math.min(a.heatMax,t.state.controlsHeat+a.heatPerRotation)),pe.emit(ae.PIECE_MOVED),t.emitChange()}}class Oo{constructor(t){Be(this,"type","ROTATE_GOOP");this.clockwise=t}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop||t.trainingAllowedControls&&t.trainingAllowedControls.rotate===!1)return;const n=t.state.activeGoop,s=(n.rotation+(this.clockwise?1:-1)+4)%4;if(n.definition.type===Me.O||n.definition.type===Me.T_O){const i=n.definition.cellColors,c=i&&i.length===4?this.clockwise?[i[2],i[0],i[3],i[1]]:[i[1],i[3],i[0],i[2]]:i;pe.emit(ae.PIECE_ROTATED),t.state.activeGoop={...n,rotation:s,definition:{...n.definition,cellColors:c}},t.emitChange();return}const r=b0(n.cells,this.clockwise,n.rotationCenter),o={...n,cells:r,rotation:s},a=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:0,y:-2},{x:1,y:-2},{x:-1,y:-2},{x:2,y:0},{x:-2,y:0}];for(const i of a){const c=Ve(o.x+i.x),u=Fy(c,t.state.tankRotation),f={...o,x:c,y:o.y+i.y,screenX:u};if(!ms(t.state.grid,f,t.state.tankRotation)){pe.emit(ae.PIECE_ROTATED),t.state.activeGoop=f,t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++),t.emitChange();return}}}}class Gl{constructor(t){Be(this,"type","SET_FAST_DROP");this.active=t}execute(t){t.trainingAllowedControls&&t.trainingAllowedControls.fastDrop===!1||(t.isFastDropping=this.active)}}class Qm{constructor(){Be(this,"type","SWAP_PIECE")}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=n.definition,r=t.state.storedGoop;if(r){const o=Math.round(r.cells.reduce((c,u)=>c+u.x,0)/r.cells.length),a=Math.round(r.cells.reduce((c,u)=>c+u.y,0)/r.cells.length),i={definition:r,cells:[...r.cells],rotation:0,rotationCenter:{x:o,y:a},spawnTimestamp:Date.now(),startSpawnY:n.y,screenX:n.screenX,x:n.x,y:n.y,state:Fn.FALLING};if(ms(t.state.grid,i,t.state.tankRotation)){pe.emit(ae.ACTION_REJECTED);return}pe.emit(ae.PIECE_ROTATED),t.state.storedGoop=s,t.state.activeGoop=i,t.lockStartTime=null,t.lockResetCount=0,t.state.canSwap=!0}else pe.emit(ae.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.spawnNewPiece();t.emitChange()}}class Jm{constructor(t,n){Be(this,"type","POP_GOOP");this.x=t,this.y=n}execute(t){var u;if(t.state.gameOver||t.state.isPaused||((u=t.trainingAllowedControls)==null?void 0:u.pop)===!1)return;const n=t.state.grid[this.y][this.x];if(!n)return;if(t.trainingHighlightColor&&n.color!==t.trainingHighlightColor){pe.emit(ae.ACTION_REJECTED);return}const s=Math.max(0,1-t.state.shiftTime/t.maxTime),r=Ne-1-s*(Bt-1);if(n.groupMinY<r){pe.emit(ae.ACTION_REJECTED);return}const o=Date.now(),a=n.groupSize*go;if(o-(n.timestamp||0)<a){pe.emit(ae.ACTION_REJECTED);return}const c=By(t.state.grid,this.x,this.y);if(c.length>0){if(t.state.complications.find(Y=>Y.type===Ie.LASER)){const Y=n.goopGroupId;if(!t.state.prePoppedGoopGroups.has(Y)){t.state.prePoppedGoopGroups.add(Y);const ee=Date.now();c.forEach(B=>{const Q=t.state.grid[B.y][B.x];Q&&(Q.timestamp=ee)}),pe.emit(ae.ACTION_REJECTED),t.emitChange();return}t.state.prePoppedGoopGroups.delete(Y)}pe.emit(ae.GOOP_POPPED,{popStreak:t.state.popStreak,count:c.length}),t.state.cellsCleared++,t.state.totalUnitsPopped+=c.length;const d=gt(t.initialTotalScore).rank,p=gs[Ie.LASER];if(Wn(Ie.LASER,d)){const Y=t.powerUps.CAPACITOR_EFFICIENCY||0,ee=1-p.drainUpgradeEffect*Y,B=c.length*p.drainPerUnit*ee;t.state.laserCharge=Math.max(0,t.state.laserCharge-B)}const y=c.length;t.state.gameStats.maxGroupSize=Math.max(t.state.gameStats.maxGroupSize,y);const v=Lx,k=y*Nx;let w=0;y>=mf&&(w=(Math.floor((y-mf)/Dx)+1)*$x);let m=0;c.forEach(Y=>{var ee;(ee=t.state.grid[Y.y][Y.x])!=null&&ee.isSealingGoop&&m++});const h=m*3e3;if(m>0){t.state.goalsCleared+=m,pe.emit(ae.GOAL_CAPTURED,{count:m}),t.chargeActiveAbilities(m*25);const Y=t.powerUps.SEALING_BONUS||0;if(Y>0){const Q=.1+Y*.05;for(let K=0;K<m;K++)Ys.reduceAllCooldowns(t.state,Q)}}const x=v+k+w+h;t.state.shiftTime=Math.min(t.maxTime,t.state.shiftTime+x),t.state.gameStats.totalBonusTime+=x;let C=0,j=t.state.popStreak+1,P={base:0,height:0,offscreen:0,adjacency:0,speed:0};const R=Vy(t.state.grid,c);C+=R,P.adjacency+=R,c.forEach(Y=>{let ee=10,B=Wy(Y.y),Q=Uy(Y.x,t.state.tankRotation);const K=Xy(j),re=(ee+B+Q)*K;C+=re,P.base+=ee*K,P.height+=B*K,P.offscreen+=Q*K});const S=Math.floor(C);t.updateScoreAndStats(S,P),t.state.popStreak=j;const T=Math.random().toString(36).substr(2,9),E=[{id:T,text:`+${S}`,x:this.x,y:this.y,life:1,color:"#fbbf24"},{id:T+"_time",text:"Vented",x:this.x,y:this.y-1,life:1,color:"#4ade80"}];m>0&&E.push({id:T+"_bonus",text:"SEALED!",x:this.x,y:this.y-2,life:1.5,color:"#fff"}),t.state.floatingTexts.push(...E),setTimeout(()=>{t.state.floatingTexts=t.state.floatingTexts.filter(Y=>!Y.id.startsWith(T)),t.emitChange()},1e3);const M=n.goopGroupId;M&&t.state.poppedGoopGroupIds.add(M);let U=t.state.grid.map(Y=>[...Y]);const J=[];c.forEach(Y=>{U[Y.y][Y.x]=null,J.push({x:Y.x,y:Y.y})});const{grid:se,looseGoop:N}=A0(U,J);if(m>0&&!t.isTrainingMode&&t.state.goalsCleared>=t.state.goalsTarget){const Y=Math.max(0,1-t.state.shiftTime/t.maxTime),ee=gt(t.initialTotalScore+t.state.shiftScore).rank;if(Y<.9){const B=qy(se,t.state.goalMarks,ee,t.state.shiftTime,t.maxTime);t.state.goalMarks.push(...B),pe.emit(ae.GOAL_CAPTURED,{count:1})}else t.state.goalMarks=[]}t.state.grid=se,t.state.looseGoop.push(...N),t.emitChange()}}}class eg{constructor(){Be(this,"type","START_RUN")}execute(t){t.startRun()}}class Hs{constructor(t){Be(this,"type","SET_PHASE");this.phase=t}execute(t){this.phase===qe.ConsoleScreen&&t.isTrainingMode&&t.trainingAllowedControls||(this.phase===qe.TankScreen?t.enterPeriscope():this.phase===qe.ConsoleScreen?t.enterConsole():(t.state.phase=this.phase,t.emitChange()))}}class tg{constructor(t){Be(this,"type","RESOLVE_COMPLICATION");this.id=t}execute(t){t.resolveComplication(this.id)}}class ng{constructor(t){Be(this,"type","ACTIVATE_ABILITY");this.upgradeId=t}execute(t){t.state.gameOver||t.state.isPaused||(t.state.activeCharges[this.upgradeId]||0)<100||(t.state.activeCharges[this.upgradeId]=0,t.activateAbility(this.upgradeId),pe.emit(ae.ABILITY_ACTIVATED,{upgradeId:this.upgradeId}),t.emitChange())}}const sg=(e,t,n,s,r,o,a)=>{if(!e)return"FAILURE";const i=n>0?Math.min(100,t/n*100):100,c=Math.max(0,100-s*2),u=Math.max(0,100-s*3),f=o>0?Math.min(100,r/o*100):50,d=Math.min(100,a/100),p=(i+c+u+f+d)/5;return p>=80?"A":p>=60?"B":p>=40?"C":"FAILURE"},og=({shiftScore:e,rank:t,xpCurrent:n,xpNext:s,cracksFilled:r,cracksTarget:o,pressureVented:a,maxTime:i,massPurged:c,leftoverPenalty:u,unspentPower:f,isWin:d})=>{const y=Math.min(1,Math.max(0,n/s))*366.31,v=sg(d,r,o,u,a,i,e),k=v==="A"?"#5bbc70":v==="B"?"#6acbda":v==="C"?"#ffd92b":"#d82727",w=i>0?Math.round(a/i*100):0;return l.jsxs("g",{id:"End_Game_Monitor_Group",children:[l.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),l.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),l.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),l.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'From Where You Are'",fontSize:"42",transform:"translate(291.5 122.96)",textAnchor:"middle",children:"SHIFT OVER"}),l.jsxs("text",{fill:k,fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"24",letterSpacing:"0.1em",transform:"translate(291.5 155)",textAnchor:"middle",children:["GRADE: ",v]}),l.jsx("path",{fill:"#5bbc70",d:"M525.21,243.36H58.95c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM58.95,223.59c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H58.95Z"}),l.jsx("path",{fill:"#5bbc70",d:`M57.75,223.09h${y}v19.77H57.75c-4.79,0-8.68-3.89-8.68-8.68v-2.4c0-4.79,3.89-8.68,8.68-8.68Z`}),l.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(530 237)",children:[Math.floor(n).toLocaleString()," / ",Math.floor(s).toLocaleString()]}),l.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(530 213)",children:"PROMOTION THRESHOLD"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(49.87 209.32)",children:l.jsx("tspan",{x:"0",y:"0",children:"OPERATOR RANK"})}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(230 210.8)",textAnchor:"start",children:t}),l.jsx("path",{fill:"#fff",d:"M268.4,808.13v-1.02l.33-1.02c6.23-8.15,13.08-15.87,19.51-23.87,1.65-2.11,4.36-2.41,6.29-.46l20.02,23c.62.7,1,1.44,1.2,2.36-.03.33.04.7,0,1.02-.21,1.7-1.77,3.25-3.47,3.42h-40.15c-1.85-.05-3.51-1.61-3.74-3.42ZM271.73,793.93c1.56-1.89,3.12-3.76,4.65-5.6,2.57-3.07,5.23-6.25,7.76-9.4,1.83-2.35,4.56-3.73,7.45-3.73,2.47,0,4.83,1.01,6.66,2.85l.12.12,13.75,15.8h.16c1.7-.17,3.26-1.72,3.47-3.42.04-.32-.03-.69,0-1.02-.2-.92-.58-1.66-1.21-2.36l-20.02-23c-1.94-1.95-4.65-1.65-6.29.46-6.44,8.01-13.29,15.72-19.51,23.87l-.33,1.02v1.02c.21,1.67,1.66,3.12,3.33,3.37Z"}),l.jsx("text",{fill:"#d82727",fontFamily:"'From Where You Are'",fontSize:"24",transform:"translate(291.5 860.65)",textAnchor:"middle",children:"DRAG UP TO END SHIFT"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(165.69 321.1)",textAnchor:"middle",children:"SHIFT SCORE"}),l.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(165.69 390.05)",textAnchor:"middle",children:e.toLocaleString()}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M261.87,585.41H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 503.38)",textAnchor:"middle",children:"CRACKS FILLED"}),l.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 557.36)",textAnchor:"middle",children:[r," / ",o]})]}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M514.25,585.41h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 503.38)",textAnchor:"middle",children:"PRESSURE VENTED"}),l.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 557.36)",textAnchor:"middle",children:[w,"%"]})]}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M261.87,731.68H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 649.64)",textAnchor:"middle",children:"MAX POP"}),l.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 703.63)",textAnchor:"middle",children:c})]}),l.jsxs("g",{children:[l.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),l.jsx("path",{fill:"#fff",d:"M514.25,731.68h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 649.64)",textAnchor:"middle",children:"RESIDUAL GOOP"}),l.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 703.63)",textAnchor:"middle",children:["-",u]})]}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(418.08 321.1)",textAnchor:"middle",children:"SCRAPS"}),l.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(418.08 390.05)",textAnchor:"middle",children:f})]})},rg="#14b8a6",ig="#ffffff",lg="#22c55e",Yr="#231f20",Hr="#d8672b";function ag({complications:e,isLaserMaxed:t,onResolveComplication:n}){const[s,r]=g.useState({active:!1,solved:!1,targets:[0,0,0,0]}),[o,a]=g.useState([0,0,0,0]),[i,c]=g.useState(null),[u,f]=g.useState(!1),d=g.useRef([]),p=g.useRef(null),y=g.useRef(null),v=g.useCallback(()=>e.some(h=>h.type===Ie.LASER),[e]);g.useEffect(()=>{const h=d.current.some(C=>C.type===Ie.LASER),x=v();h&&!x&&(f(!0),y.current=setTimeout(()=>{f(!1)},2500)),d.current=e},[e,v]),g.useEffect(()=>{if(!v()&&(s.active||s.solved)&&(r({active:!1,solved:!1,targets:[0,0,0,0]}),a([0,0,0,0])),v()&&!s.active&&!s.solved){const h=t?[-1,1]:[-1,0,1],x=[0,1,2,3].map(()=>h[Math.floor(Math.random()*h.length)]),C=x.map(j=>{const P=h.filter(R=>R!==j);return P[Math.floor(Math.random()*P.length)]});a(C),r({active:!0,solved:!1,targets:x})}},[e,s.active,s.solved,t,v]),g.useEffect(()=>()=>{p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]);const k=g.useCallback((h,x)=>{a(j=>{const P=[...j];return P[h]=x,e.find(S=>S.type===Ie.LASER),P});const C=e.find(j=>j.type===Ie.LASER);if(C&&!s.solved){const j=s.targets[h];if(x!==j)c(h),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>c(null),300);else{const P=[...o];P[h]=x,P.every((S,T)=>S===s.targets[T])&&(r(S=>({...S,solved:!0})),a([0,0,0,0]),n&&n(C.id))}}},[e,s.solved,s.targets,o,n]),w=g.useCallback(h=>{if(!v())return{left:Yr,right:Yr};const x=s.targets[h];return x===-1?{left:Hr,right:Yr}:x===1?{left:Yr,right:Hr}:{left:Hr,right:Hr}},[v,s.targets]),m=g.useCallback(()=>v()?{text:"REPAIR LASER",color:ig}:u?{text:"LASER FIXED",color:lg}:{text:"REPAIR LASER",color:rg},[v,u]);return{laserSliders:o,updateLaserSlider:k,shakingSlider:i,getLaserLightColors:w,getLaserTextState:m,recentlyFixed:u,isComplicationActive:v()}}const Ef={0:"#96d7dd",1:"#f6f081",2:"#cb8abc"},cg=[45,315,225,135],If=[45,135,225,315],ug="#14b8a6",fg="#ffffff",dg="#22c55e",Qt="#231f20",Wr="#d8672b";function pg({complications:e,isLightsMaxed:t,pressedBtn:n,onResolveComplication:s}){const[r,o]=g.useState({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),[a,i]=g.useState(0),[c,u]=g.useState(!1),[f,d]=g.useState(!1),p=g.useRef([]),y=g.useRef(null),v=g.useRef(null),k=g.useRef([]),w=g.useCallback(()=>e.some(S=>S.type===Ie.LIGHTS),[e]),m=g.useCallback(()=>{const S=[],T=[0,0,0],E=t?3:4;for(let M=0;M<E;M++){const U=[];T[0]<2&&U.push(0),T[1]<2&&U.push(1),T[2]<2&&U.push(2);const J=U[Math.floor(Math.random()*U.length)];S.push(J),T[J]++}return S},[t]),h=g.useCallback(S=>{k.current.forEach(se=>clearTimeout(se)),k.current=[];let U=300;S.forEach(se=>{const N=setTimeout(()=>{o(ee=>({...ee,showingIndex:se}))},U);k.current.push(N);const Y=setTimeout(()=>{o(ee=>({...ee,showingIndex:-1}))},U+200);k.current.push(Y),U+=200+100});const J=setTimeout(()=>{o(se=>({...se,phase:"input",showingIndex:-1,inputIndex:0}))},U+100);k.current.push(J)},[]);g.useEffect(()=>{const S=p.current.some(E=>E.type===Ie.LIGHTS),T=w();S&&!T&&(d(!0),v.current=setTimeout(()=>{d(!1)},2500)),p.current=e},[e,w]),g.useEffect(()=>{if(!w()&&r.phase!=="inactive"&&(o({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),i(0)),w()&&r.phase==="inactive"){const S=m();o({phase:"slider1",slider1Target:Math.random()>.5?1:-1,sequence:S,inputIndex:0,showingIndex:-1}),i(0)}},[e,r.phase,w,m]),g.useEffect(()=>()=>{y.current&&clearTimeout(y.current),v.current&&clearTimeout(v.current),k.current.forEach(S=>clearTimeout(S))},[]);const x=g.useCallback(S=>{if(r.phase!=="input")return;const T=r.sequence[r.inputIndex];if(S===T){const E=r.inputIndex+1;E>=r.sequence.length?o(M=>({...M,phase:"slider2",inputIndex:0})):o(M=>({...M,inputIndex:E}))}else{o(M=>({...M,phase:"showing",inputIndex:0,showingIndex:-1}));const E=setTimeout(()=>{h(r.sequence)},300);k.current.push(E)}},[r.phase,r.sequence,r.inputIndex,h]),C=g.useCallback(S=>{const{phase:T,slider1Target:E,sequence:M}=r;if(T==="slider1")S===E?(i(S),o(U=>({...U,phase:"showing"})),h(M)):S!==0?(u(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),i(0)},400)):i(S);else if(T==="slider2"){const U=E===1?-1:1;if(i(S),S===U){o(se=>({...se,phase:"solved"})),i(0);const J=e.find(se=>se.type===Ie.LIGHTS);J&&s&&s(J.id)}}else i(S)},[e,r,s,h]),j=g.useCallback(S=>!w()||r.phase==="inactive"?Qt:r.phase==="showing"&&r.showingIndex===S||r.phase==="input"&&n===["blue","green","purple"][S]?Ef[S]:Qt,[w,r.phase,r.showingIndex,n]),P=g.useCallback(()=>{const{phase:S,slider1Target:T}=r;return w()?S==="inactive"?{top:Qt,bottom:Qt}:S==="slider1"?T===1?{top:Qt,bottom:Wr}:{top:Wr,bottom:Qt}:S==="slider2"?T===1?{top:Wr,bottom:Qt}:{top:Qt,bottom:Wr}:{top:Qt,bottom:Qt}:{top:Qt,bottom:Qt}},[w,r]),R=g.useCallback(()=>w()?{text:"REPAIR LIGHTS",color:fg}:f?{text:"LIGHTS FIXED",color:dg}:{text:"REPAIR LIGHTS",color:ug},[w,f]);return{lightsComplication:r,lightSlider:a,handleLightsButton:x,handleLightsSliderChange:C,lightsSliderShaking:c,getLightsButtonLightColor:j,getLightsSliderLightColors:P,getLightsTextState:R,recentlyFixed:f,isComplicationActive:w()}}const hg="#14b8a6",xg="#ffffff",yg="#22c55e",Bl="#231f20",mg="#d8672b",_f=194.32,Of=1586.66,gg=86.84,vg=gg*1.3;function Sg({complications:e,isControlsMaxed:t,onResolveComplication:n}){const[s,r]=g.useState({active:!1,solved:!1,targetCorner:null,completedCorners:0}),[o,a]=g.useState(0),[i,c]=g.useState(!1),[u,f]=g.useState(!1),[d,p]=g.useState(!1),[y,v]=g.useState(!1),k=g.useRef([]),w=g.useRef(null),m=g.useRef(null),h=g.useRef(null),x=g.useRef(null),C=g.useRef(!1),j=g.useRef(0),P=g.useRef(0),R=g.useRef(0),S=g.useRef(!1),T=g.useRef(!1),E=g.useCallback(()=>e.some(K=>K.type===Ie.CONTROLS),[e]),M=g.useCallback((K,re)=>{try{const oe=document.getElementById("coord-reference");if(!oe)return null;const ve=oe.ownerSVGElement;if(!ve)return null;const Pe=ve.createSVGPoint();Pe.x=K,Pe.y=re;const be=oe.getScreenCTM();if(!be)return null;const A=Pe.matrixTransform(be.inverse());return{x:A.x,y:A.y}}catch{return null}},[]);g.useEffect(()=>{const K=k.current.some(oe=>oe.type===Ie.CONTROLS),re=E();K&&!re&&(v(!0),m.current=setTimeout(()=>{v(!1)},2500)),k.current=e},[e,E]),g.useEffect(()=>{if(!E()&&(s.active||s.solved)&&r({active:!1,solved:!1,targetCorner:null,completedCorners:0}),E()&&!s.active&&!s.solved){const K=Math.floor(Math.random()*4);r({active:!0,solved:!1,targetCorner:K,completedCorners:0})}},[e,s.active,s.solved,E]),g.useEffect(()=>()=>{w.current&&clearTimeout(w.current),m.current&&clearTimeout(m.current),h.current&&clearTimeout(h.current),x.current&&clearTimeout(x.current)},[]);const U=g.useCallback((K,re)=>{const oe=M(K,re);if(!oe)return;const ve=oe.x-_f,Pe=oe.y-Of;Math.sqrt(ve*ve+Pe*Pe)>vg||(j.current=Math.atan2(Pe,ve)*(180/Math.PI),P.current=o,C.current=!0,S.current=!1,c(!0))},[o,M]),J=g.useCallback((K,re)=>{if(!C.current)return;const oe=M(K,re);if(!oe)return;const ve=oe.x-_f,Pe=oe.y-Of,A=Math.atan2(Pe,ve)*(180/Math.PI)-j.current+P.current;R.current=A,S.current=!0,a(A)},[M]),se=g.useCallback(()=>{if(!C.current||(C.current=!1,c(!1),S.current&&(T.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{T.current=!1},100)),!S.current))return;const K=R.current;let re=K%360;re<0&&(re+=360);let oe=If[0],ve=1/0;for(const X of If){const W=Math.min(Math.abs(re-X),Math.abs(re-X+360),Math.abs(re-X-360));W<ve&&(ve=W,oe=X)}const Pe=Math.floor(K/360)*360,be=[Pe+oe-360,Pe+oe,Pe+oe+360];let A=be[0],G=Math.abs(K-be[0]);for(const X of be){const W=Math.abs(K-X);W<G&&(G=W,A=X)}R.current=A,a(A)},[]);g.useEffect(()=>{if(!i)return;const K=Pe=>{J(Pe.clientX,Pe.clientY)},re=()=>{se()},oe=Pe=>{Pe.touches.length>0&&J(Pe.touches[0].clientX,Pe.touches[0].clientY)},ve=()=>{se()};return window.addEventListener("mousemove",K),window.addEventListener("mouseup",re),window.addEventListener("touchmove",oe),window.addEventListener("touchend",ve),()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",re),window.removeEventListener("touchmove",oe),window.removeEventListener("touchend",ve)}},[i,J,se]);const N=g.useCallback(()=>{if(s.targetCorner===null)return!1;const K=cg[s.targetCorner],re=(o%360+360)%360,oe=Math.abs(re-K);return Math.min(oe,360-oe)<15},[s.targetCorner,o]),Y=g.useCallback(()=>{f(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>f(!1),300)},[]),ee=g.useCallback(()=>{if(!(!E()||s.solved)&&!i&&!T.current)if(p(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>p(!1),150),N()){const K=s.completedCorners+1;if(K>=(t?3:4)){r(ve=>({...ve,solved:!0,targetCorner:null,completedCorners:4}));const oe=e.find(ve=>ve.type===Ie.CONTROLS);oe&&n&&n(oe.id)}else{const oe=[0,1,2,3].filter(Pe=>Pe!==s.targetCorner),ve=oe[Math.floor(Math.random()*oe.length)];r(Pe=>({...Pe,targetCorner:ve,completedCorners:K}))}}else Y()},[E,s.solved,s.completedCorners,s.targetCorner,i,N,t,e,n,Y]),B=g.useCallback(K=>!E()||s.solved?Bl:s.targetCorner===K?mg:Bl,[E,s.solved,s.targetCorner]),Q=g.useCallback(()=>E()?{text:"REPAIR CONTROLS",color:xg}:y?{text:"CONTROLS FIXED",color:yg}:{text:"REPAIR CONTROLS",color:hg},[E,y]);return{localDialRotation:o,isDialDragging:i,dialShaking:u,dialPressed:d,handleDialStart:U,handleDialMove:J,handleDialEnd:se,handleDialPress:ee,getControlsCornerLightColor:B,getControlsTextState:Q,recentlyFixed:y,isDialAligned:N,isComplicationActive:E()&&!s.solved}}const Yo=({x:e,y:t,rotation:n=0,length:s=176,width:r=50,handleSize:o=50,value:a=0,onChange:i,trackColor:c="#eebfc5",handleColor:u="#d36b28",arrowColor:f="#ffffff",className:d=""})=>{const[p,y]=g.useState(!1),[v,k]=g.useState(0),w=g.useRef(null),m=g.useRef(0),h=(s-o)/2,x={"-1":-h,0:0,1:h},C=p?v:x[`${a}`]||0,j=S=>{S.stopPropagation(),S.currentTarget.setPointerCapture(S.pointerId),w.current={x:S.clientX,y:S.clientY},m.current=C,k(C),y(!0)},P=S=>{if(!p||!w.current)return;S.stopPropagation();const T=S.clientX-w.current.x,E=S.clientY-w.current.y,M=n*Math.PI/180,U=T*Math.cos(M)+E*Math.sin(M),J=m.current+U,se=Math.max(-h,Math.min(h,J));k(se)},R=S=>{if(!p)return;S.stopPropagation(),S.currentTarget.releasePointerCapture(S.pointerId),y(!1);const T=Math.abs(v-x[-1]),E=Math.abs(v-x[0]),M=Math.abs(v-x[1]);let U=0;T<E&&T<M?U=-1:M<E&&M<T?U=1:U=0,i&&U!==a&&i(U)};return l.jsx("g",{transform:`translate(${e}, ${t}) rotate(${n})`,children:l.jsxs("g",{className:d,children:[l.jsx("rect",{x:-s/2,y:-r/2,width:s,height:r,rx:6.92,ry:6.92,fill:c}),l.jsx("g",{transform:`translate(${C}, 0)`,style:{transition:p?"none":"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:l.jsx("rect",{x:-o/2,y:-o/2,width:o,height:o,rx:3.69,ry:3.69,fill:u})}),l.jsx("rect",{x:-s/2-20,y:-r/2-20,width:s+40,height:r+40,fill:"transparent",style:{cursor:"grab",touchAction:"none"},onPointerDown:j,onPointerMove:P,onPointerUp:R,onPointerLeave:R})]})})},Cg=({laserSliders:e,shakingSlider:t,onSliderChange:n,getLaserLightColors:s,textState:r,isComplicationActive:o=!1,isUnlocked:a=!0})=>l.jsxs("g",{id:"Reset_Laser_Top",className:a?"minigame-active":"minigame-inactive",children:[l.jsxs("g",{pointerEvents:"none",children:[l.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M157.91,233.16h-4.24l-18.69-18.69c-3.62-3.62-3.62-9.52,0-13.14l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0-8.89l20.81,20.81ZM111.51,212.35c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-1.75,1.75-2.72,4.09-2.72,6.57s.97,4.81,2.72,6.57l18.69,18.69h4.24l-20.81-20.81ZM107.64,182.65h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM235.4,214.47c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,233.16h4.24l18.69-18.69c1.75-1.75,2.72-4.09,2.72-6.57s-.97-4.81-2.72-6.57l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM260.08,214.47c.17-.17.33-.36.49-.54v-12.05c-.16-.19-.32-.37-.49-.54l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"}),l.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M132.32,324.04h-4.24l-18.69-18.69c-1.75-1.75-2.72-4.09-2.72-6.57s.97-4.81,2.72-6.57l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0,8.89l20.81,20.81ZM137.1,303.23c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-3.62,3.62-3.62-9.52,0,13.14l18.69,18.69h4.24l-20.81-20.81ZM107.64,273.53h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM260.08,305.35c.18-.18.34-.36.49-.55v-12.04c-.16-.19-.32-.37-.49-.55l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,324.04h4.24l18.69-18.69c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c1.19,1.19,1.84,2.77,1.84,4.45s-.65,3.26-1.84,4.45l-20.81,20.81ZM235.4,305.35c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"})]}),l.jsx(Yo,{x:172.65,y:207.9,value:e[0],onChange:i=>n(0,i),className:t===0?"shake-anim":""}),l.jsx(Yo,{x:172.65,y:298.78,value:e[1],onChange:i=>n(1,i),className:t===1?"shake-anim":""}),l.jsx(Yo,{x:445.24,y:207.9,value:e[2],onChange:i=>n(2,i),className:t===2?"shake-anim":""}),l.jsx(Yo,{x:445.24,y:298.78,value:e[3],onChange:i=>n(3,i),className:t===3?"shake-anim":""}),l.jsxs("g",{children:[l.jsx("path",{fill:s(0).right,fillRule:"evenodd",d:"M280.92,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(0).left,fillRule:"evenodd",d:"M63.6,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:s(1).right,fillRule:"evenodd",d:"M280.92,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(1).left,fillRule:"evenodd",d:"M63.6,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:s(2).left,fillRule:"evenodd",d:"M336.96,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(2).right,fillRule:"evenodd",d:"M554.28,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:s(3).left,fillRule:"evenodd",d:"M336.96,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),l.jsx("path",{fill:s(3).right,fillRule:"evenodd",d:"M554.28,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),l.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsx("text",{fill:r.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(245.29 261.57)",children:r.text})]}),zl=({x:e,y:t,colorBody:n,colorTop:s,isPressed:r,onPress:o,onRelease:a})=>{const i="M42.31,73.62C18.58,73.62,0,59.79,0,42.13S18.58,10.65,42.31,10.65s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",c="M74.5,41.03c0,11.84-14.45,21.44-32.27,21.44S9.97,52.87,9.97,41.03c0-8.74.25-20.68.25-20.68h64.43s-.15,13.21-.15,20.68Z",f="M42.31,62.97C18.58,62.97,0,49.14,0,31.48S18.58,0,42.31,0s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",d="M74.5,30.38c0,11.84-14.45,21.44-32.27,21.44S9.97,42.22,9.97,30.38c0-8.74.25-8.47.25-8.47h64.43s-.15.99-.15,8.47Z";return l.jsx("g",{transform:`translate(${e}, ${t})`,style:{cursor:"pointer"},onMouseDown:v=>{v.stopPropagation(),o()},onMouseUp:v=>{v.stopPropagation(),a()},onMouseLeave:()=>{r&&a()},onTouchStart:v=>{v.stopPropagation(),o()},onTouchEnd:v=>{v.stopPropagation(),a()},children:r?l.jsxs("g",{transform:`translate(0, ${10.65})`,children:[l.jsx("path",{fill:"#0d1a19",d:f}),l.jsx("path",{fill:n,fillRule:"evenodd",d}),l.jsx("ellipse",{fill:s,cx:"42.31",cy:23.01,rx:"32.27",ry:"21.44"})]}):l.jsxs("g",{children:[l.jsx("path",{fill:"#0d1a19",d:i}),l.jsx("path",{fill:n,fillRule:"evenodd",d:c}),l.jsx("ellipse",{fill:s,cx:"42.31",cy:21.44,rx:"32.27",ry:"21.44"})]})})},kg=({lightsComplication:e,lightSlider:t,onSliderChange:n,onButtonPress:s,onButtonRelease:r,getLightsButtonLightColor:o,getLightsSliderLightColors:a,textState:i,pressedBtn:c,sliderShaking:u,onBlueClick:f,onGreenClick:d,onPurpleClick:p,isComplicationActive:y=!1,recentlyFixed:v=!1,isUnlocked:k=!0})=>{const w=a(),m=e.phase==="slider1"||e.phase==="showing";return l.jsxs("g",{id:"Reset_Lights",className:k?"minigame-active":"minigame-inactive",children:[l.jsx("polygon",{fill:"#45486c",points:"608.7 1720.12 341.17 1720.12 341.17 1452.22 564.14 1452.22 608.7 1720.12",className:y?"minigame-active-pulse":v?"minigame-solved-fade":""}),l.jsx("text",{fill:i.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(414.68 1480.38)",children:i.text}),l.jsx("g",{clipPath:"url(#reset-lights-slider-clip)",children:l.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M417.83,1530.35l-30.21-30.21c-3.04-3.04-7.97-3.04-11.02,0l-30.21,30.21M346.4,1555.03l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M346.4,1580.62l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M417.83,1643.18l-30.21,30.21c-3.04,3.04-7.97,3.04-11.02,0l-30.21-30.21M346.4,1618.5l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21M346.4,1592.91l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21"})}),l.jsx(Yo,{x:382.11,y:1587.01,rotation:90,value:t,onChange:n,className:u?"shake":""}),l.jsxs("g",{children:[l.jsx("path",{fill:w.bottom,d:"M382.12,1706.83c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M382.12,1685.25c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1682.25c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.04-13.03-13.04h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:w.top,d:"M382.12,1489.51c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M382.12,1467.94c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1464.94c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),l.jsx(zl,{x:431.19,y:1495,colorBody:"#3d8380",colorTop:"#96d7dd",isPressed:c==="blue"||m,onPress:()=>s("blue"),onRelease:()=>r("blue",f)}),l.jsxs("g",{children:[l.jsx("path",{fill:o(0),d:"M546.19,1547c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M546.19,1525.42c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M546.19,1522.42c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),l.jsx(zl,{x:437.5,y:1565,colorBody:"#4c833c",colorTop:"#f6f081",isPressed:c==="green"||m,onPress:()=>s("green"),onRelease:()=>r("green",d)}),l.jsxs("g",{children:[l.jsx("path",{fill:o(1),d:"M554.61,1616.4c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M554.61,1594.82c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M554.61,1591.82c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),l.jsx(zl,{x:444.51,y:1635,colorBody:"#803d83",colorTop:"#cb8abc",isPressed:c==="purple"||m,onPress:()=>s("purple"),onRelease:()=>r("purple",p)}),l.jsxs("g",{children:[l.jsx("path",{fill:o(2),d:"M565.12,1689.3c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M565.12,1667.73c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.04h0M565.12,1664.73c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]})]})},Lf=194.32,Nf=1586.66,wg=({localDialRotation:e,isDialDragging:t,dialShaking:n,dialPressed:s,onDialStart:r,onDialPress:o,getControlsCornerLightColor:a,textState:i,isDialAligned:c,isComplicationActive:u,recentlyFixed:f=!1,isUnlocked:d=!0})=>l.jsxs("g",{id:"Reset_Controls",className:d?"minigame-active":"minigame-inactive",children:[l.jsx("path",{fill:"#45486c",d:"M290.21,1663.73c10.78-17.3,17.01-37.73,17.01-59.61,0-23.97-7.48-46.2-20.22-64.48,7.77-.06,15.53-3.05,21.46-8.98,11.98-11.98,11.98-31.4,0-43.37-1.9-1.9-3.99-3.5-6.21-4.8-.5-17.51-14.85-31.56-32.48-31.56H121.34c-17.78,0-32.22,14.28-32.49,32-1.95,1.22-3.81,2.66-5.5,4.36-11.98,11.98-11.98,31.4,0,43.37,5.16,5.16,11.69,8.09,18.42,8.8-12.82,18.31-20.34,40.6-20.34,64.65,0,22.08,6.34,42.67,17.3,60.07-5.63,1.18-11,3.95-15.38,8.32-11.98,11.98-11.98,31.4,0,43.37,11.98,11.98,31.4,11.98,43.37,0,4.44-4.44,7.23-9.91,8.38-15.64,17.22,10.63,37.5,16.77,59.22,16.77,22.93,0,44.26-6.84,62.07-18.59.88,6.39,3.78,12.55,8.69,17.46,11.98,11.98,31.4,11.98,43.37,0,11.98-11.98,11.98-31.4,0-43.37-5.11-5.11-11.58-8.03-18.24-8.78Z",className:u?"minigame-active-pulse":f?"minigame-solved-fade":""}),l.jsx("circle",{fill:"#0d1a19",cx:"194.32",cy:"1604.12",r:"97.6",opacity:"0.3"}),l.jsxs("g",{children:[l.jsx("path",{fill:a(1),d:"M103.94,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M103.94,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:a(0),d:"M288.3,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M288.3,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:a(2),d:"M103.94,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M103.94,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsxs("g",{children:[l.jsx("path",{fill:a(3),d:"M288.3,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.53,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),l.jsx("path",{fill:"#1f1f38",d:"M288.3,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),l.jsx("text",{fill:i.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(108.17 1480.38)",children:i.text}),l.jsx("g",{transform:`translate(0 ${s?4:0}) rotate(${Math.round(e)} ${Lf} ${Nf})`,style:{cursor:t?"grabbing":"grab"},onMouseDown:p=>r(p.clientX,p.clientY),onTouchStart:p=>{p.touches.length>0&&r(p.touches[0].clientX,p.touches[0].clientY)},onClick:o,children:l.jsxs("g",{className:n?"shake":"",children:[l.jsx("circle",{fill:"#d36b28",cx:"194.32",cy:"1586.66",r:"86.84"}),l.jsx("path",{fill:"none",stroke:"#fff",strokeWidth:"6",strokeMiterlimit:"10",d:"M238.98,1629.6c-11.27,11.72-27.11,19.01-44.65,19.01s-32.11-6.72-43.27-17.62"}),l.jsx("g",{transform:"translate(170.65 1623.1) rotate(135) scale(1.74)",children:l.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),l.jsx("g",{transform:"translate(219.09 1623.1) rotate(45) scale(1.74 -1.74)",children:l.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),l.jsx("path",{fill:"#fff",d:"M169.51,1524.47l20.43-20.43c1.99-1.99,5.23-1.99,7.22,0l20.43,20.43c3.22,3.22.94,8.72-3.61,8.72h-40.86c-4.55,0-6.83-5.5-3.61-8.72Z"})]})}),u&&c&&l.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"24",fontWeight:"bold",textAnchor:"middle",x:Lf,y:Nf+8,style:{pointerEvents:"none"},children:"PRESS"})]}),Rg=194.32,Pg=1586.66,jg=({dialRotation:e,monitorOffset:t,periscopeY:n,dragHandlers:s,monitorDragHandlers:r,isMonitorDragging:o,isPeriscopeDragging:a=!1,isSnapping:i=!1,onDialClick:c,onBlueClick:u,onGreenClick:f,onPurpleClick:d,onUpgradesClick:p,onSettingsClick:y,onHelpClick:v,onSetRank:k,onAbortClick:w,upgradeCount:m,screenContent:h,isGameOver:x=!1,isSessionActive:C=!1,rank:j,currentXP:P,nextRankXP:R,shiftScore:S=0,gameStats:T={startTime:0,totalBonusTime:0,maxGroupSize:0,penalty:0},goalsCleared:E=0,goalsTarget:M=0,unspentPower:U=0,maxTime:J=75e3,complications:se=[],onResolveComplication:N,upgradeLevels:Y={},pulsePeriscope:ee=!1})=>{const B=(Y.CAPACITOR_EFFICIENCY||0)>=Nn.CAPACITOR_EFFICIENCY.maxLevel,Q=(Y.CIRCUIT_STABILIZER||0)>=Nn.CIRCUIT_STABILIZER.maxLevel,K=(Y.GEAR_LUBRICATION||0)>=Nn.GEAR_LUBRICATION.maxLevel,re=Wn(Ie.LASER,j),oe=Wn(Ie.LIGHTS,j),ve=Wn(Ie.CONTROLS,j),[Pe,be]=g.useState(null),[A,G]=g.useState(!1),[X,W]=g.useState(!1),{laserSliders:fe,updateLaserSlider:ie,shakingSlider:le,getLaserLightColors:q,getLaserTextState:ke,recentlyFixed:Ce,isComplicationActive:je}=ag({complications:se,isLaserMaxed:B,onResolveComplication:N}),{lightsComplication:De,lightSlider:Fe,handleLightsButton:Te,handleLightsSliderChange:ze,lightsSliderShaking:ye,getLightsButtonLightColor:I,getLightsSliderLightColors:z,getLightsTextState:he,recentlyFixed:xe,isComplicationActive:D}=pg({complications:se,isLightsMaxed:Q,pressedBtn:Pe,onResolveComplication:N}),{localDialRotation:L,isDialDragging:F,dialShaking:H,dialPressed:ne,handleDialStart:we,handleDialMove:b,handleDialEnd:_,handleDialPress:O,getControlsCornerLightColor:$,getControlsTextState:V,recentlyFixed:te,isDialAligned:me,isComplicationActive:ge}=Sg({complications:se,isControlsMaxed:K,onResolveComplication:N});g.useEffect(()=>{if(!F)return;const ue=Ze=>{b(Ze.clientX,Ze.clientY)},Ue=()=>{_()},He=Ze=>{Ze.touches.length>0&&b(Ze.touches[0].clientX,Ze.touches[0].clientY)},Ge=()=>{_()};return window.addEventListener("mousemove",ue),window.addEventListener("mouseup",Ue),window.addEventListener("touchmove",He),window.addEventListener("touchend",Ge),()=>{window.removeEventListener("mousemove",ue),window.removeEventListener("mouseup",Ue),window.removeEventListener("touchmove",He),window.removeEventListener("touchend",Ge)}},[F]),g.useEffect(()=>{C||W(!1)},[C]);const Z=ue=>{be(ue)},Oe=(ue,Ue)=>{Pe===ue?(be(null),ue==="blue"?Te(0):ue==="green"?Te(1):ue==="purple"&&Te(2),Ue&&Ue()):be(null)},Ee=ue=>{ue.stopPropagation(),G(Ue=>!Ue)},$e=ue=>{k&&k(ue),G(!1)},Ye=ue=>{ue.stopPropagation(),X?(w&&w(),W(!1)):(W(!0),setTimeout(()=>W(!1),3e3))},Xe={transition:o?"none":"transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},Le={transition:o?"none":"opacity 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},ce=363.9*Math.min(1,Math.max(0,P/R)),it=Math.min(1,Math.max(0,(t+400)/920)),lt=Math.min(1,Math.max(0,n/300)),Rt=Math.max(it,lt)*.85,de="translate(31.92, 399.44)";return l.jsxs("svg",{viewBox:"0 827.84 648 1152",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{overflow:"hidden"},onClick:()=>{A&&G(!1)},children:[l.jsxs("defs",{children:[l.jsxs("linearGradient",{id:"console-gradient",x1:"324",y1:"1979.84",x2:"324",y2:"827.84",gradientUnits:"userSpaceOnUse",children:[l.jsx("stop",{offset:"0",stopColor:"#363b5e"}),l.jsx("stop",{offset:"1",stopColor:"#0b1c3f"})]}),l.jsx("clipPath",{id:"reset-lights-slider-clip",children:l.jsx("rect",{x:"356.86",y:"1499.08",width:"50.51",height:"175.86",rx:"6.92",ry:"6.92"})})]}),l.jsxs("g",{id:"Console_Base",children:[l.jsx("polygon",{fill:"#0f1829",points:"42.37 1807.1 54.73 1865.36 592.78 1865.36 605.14 1807.1 42.37 1807.1"}),l.jsx("path",{fill:"#616a79",d:"M615.77,1807.1l14.87-84.85c.65-3.69-2.19-7.08-5.94-7.08H22.81c-3.75,0-6.59,3.38-5.94,7.08l14.87,84.85h584.04Z"}),l.jsx("path",{fill:"#59acae",d:"M583.65,1441.46H63.86l-47.08,283.09c-.6,3.61,2,6.92,5.44,6.92h603.07c3.44,0,6.04-3.31,5.44-6.92l-47.08-283.09Z"}),l.jsxs("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",transform:"translate(55 1855.15)",children:[l.jsx("tspan",{letterSpacing:"-0.04em",children:"V"}),l.jsxs("tspan",{x:"9.49",children:["ersion 1.1.13.",287]})]}),l.jsx("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",textAnchor:"end",transform:"translate(592.5 1855.15)",children:"MuzzyMade @ 2026"}),l.jsx("g",{id:"RankSelector",className:x?"pointer-events-none":"cursor-pointer hover:brightness-125 active:brightness-90 transition-all origin-center",onClick:x?void 0:Ee,children:l.jsx("text",{fill:A?"#5bbc70":"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:A?"bold":"normal",textAnchor:"middle",transform:"translate(323.75 1855.99)",children:"RANK SELECT"})})]}),l.jsxs("g",{transform:"translate(17.28, 1057.14)",children:[l.jsx("path",{fill:"#616a79",fillRule:"evenodd",d:"M597.13,32.56H15.82C6.56,32.56-.51,40.11.03,49.42l18.54,321.98c.39,6.78,5.81,12.28,12.11,12.28h551.59c6.3,0,11.72-5.5,12.11-12.28l18.54-321.98c.54-9.31-6.53-16.86-15.79-16.86Z"}),l.jsx("path",{fill:"#aad9d9",fillRule:"evenodd",d:"M604.74,37.21H8.21c-3.37,0-5.34-4.05-3.17-6.52L23.09,10.16C28.83,3.68,37.14,0,46.03,0h520.89c8.89,0,17.2,3.68,22.94,10.16l18.06,20.52c2.17,2.47.19,6.52-3.17,6.52Z"}),l.jsx("path",{fill:"#1d1d3a",d:"M536.44,362.92H76.51c-21.64,0-40.25-18.8-41.48-41.9l-11.76-220.89c-.6-11.35,3.24-22,10.81-29.99,7.45-7.85,17.63-12.18,28.67-12.18h487.46c11.04,0,21.22,4.33,28.67,12.18,7.58,7.99,11.41,18.64,10.81,29.99l-11.76,220.89c-1.23,23.1-19.84,41.9-41.48,41.9ZM62.75,62.96c-9.65,0-18.55,3.77-25.04,10.62-6.62,6.98-9.98,16.32-9.45,26.28l11.76,220.89c1.09,20.49,17.46,37.17,36.49,37.17h459.93c19.03,0,35.4-16.67,36.49-37.17l11.76-220.89c.53-9.96-2.82-19.3-9.45-26.28-6.49-6.85-15.39-10.62-25.04-10.62H62.75Z"}),l.jsx("path",{fill:"#35385b",fillRule:"evenodd",d:"M550.2,60.46H62.75c-21.59,0-38.15,17.7-36.98,39.53l11.76,220.89c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.76-220.89c1.16-21.83-15.4-39.53-36.98-39.53Z"}),l.jsx("path",{fill:"#474871",fillRule:"evenodd",d:"M549.56,74.42H63.39c-21.53,0-38.04,17.7-36.88,39.53l11.02,206.94c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.02-206.94c1.16-21.83-15.35-39.53-36.88-39.53Z",className:je?"minigame-active-pulse-laser":Ce?"minigame-solved-fade-laser":""}),l.jsxs("g",{id:"Operator_Rank_-_meter",children:[l.jsx("path",{fill:"#5bbc70",d:"M540.77,147.84H74.51c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM74.51,128.07c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H74.51Z"}),l.jsx("path",{fill:"#5bbc70",d:`M74.51,127.57h${ce}c.66,0,1.2.54,1.2,1.2v17.36c0,.66-.54,1.2-1.2,1.2H74.51c-5.45,0-9.88-4.43-9.88-9.88h0c0-5.45,4.43-9.88,9.88-9.88Z`}),l.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(545 142)",children:[Math.floor(P).toLocaleString()," / ",Math.floor(R).toLocaleString()]}),l.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(545 118)",children:"PROMOTION THRESHOLD"}),l.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(239.35 115.28)",children:j}),l.jsxs("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(65.42 113.79)",children:[l.jsx("tspan",{x:"0",y:"0",children:"OPE"}),l.jsx("tspan",{letterSpacing:".02em",x:"40.54",y:"0",children:"R"}),l.jsx("tspan",{letterSpacing:"-.05em",x:"53.68",y:"0",children:"A"}),l.jsx("tspan",{letterSpacing:"-.03em",x:"66.07",y:"0",children:"T"}),l.jsx("tspan",{x:"77.45",y:"0",children:"OR "}),l.jsx("tspan",{letterSpacing:".02em",x:"112.01",y:"0",children:"R"}),l.jsx("tspan",{x:"125.16",y:"0",children:"ANK"})]})]}),l.jsx(Cg,{laserSliders:fe,shakingSlider:le,onSliderChange:ie,getLaserLightColors:q,textState:ke(),isComplicationActive:je,recentlyFixed:Ce,isUnlocked:re})]}),l.jsx(kg,{lightsComplication:De,lightSlider:Fe,onSliderChange:ze,onButtonPress:Z,onButtonRelease:Oe,getLightsButtonLightColor:I,getLightsSliderLightColors:z,textState:he(),pressedBtn:Pe,sliderShaking:ye,onBlueClick:u,onGreenClick:f,onPurpleClick:d,isComplicationActive:D,recentlyFixed:xe,isUnlocked:oe}),l.jsx(wg,{localDialRotation:L,isDialDragging:F,dialShaking:H,dialPressed:ne,onDialStart:we,onDialPress:O,getControlsCornerLightColor:$,textState:V(),isDialAligned:me(),isComplicationActive:ge,recentlyFixed:te,isUnlocked:ve}),l.jsx("circle",{id:"coord-reference",cx:Rg,cy:Pg,r:"1",fill:"transparent",style:{pointerEvents:"none"}}),(C||j>0)&&l.jsx("g",{id:"System_Upgrades",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:C?Ye:p,children:C?l.jsxs(l.Fragment,{children:[l.jsx("rect",{fill:"#ef4444",x:"123.18",y:"1748.67",width:"342.8",height:"44.19",rx:"12.37",ry:"12.37"}),l.jsx("rect",{fill:"none",stroke:"#ef4444",strokeMiterlimit:"10",x:"123.45",y:"1748.67",width:"420.29",height:"44.19",rx:"9.43",ry:"9.43"}),l.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"294.58",y:"1778.17",children:X?"ARE YOU SURE?":"END SHIFT EARLY"}),l.jsx("text",{fill:"#ef4444",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",transform:"translate(492.79 1783.33)",children:"X"})]}):l.jsxs(l.Fragment,{children:[l.jsx("rect",{fill:"#ffd92b",x:"205",y:"1748.67",width:"160",height:"44.19",rx:"12.37",ry:"12.37"}),l.jsx("rect",{fill:"none",stroke:"#ffd92b",strokeMiterlimit:"10",x:"205",y:"1748.67",width:"238",height:"44.19",rx:"9.43",ry:"9.43"}),l.jsx("text",{fill:"#45486c",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"285",y:"1778.17",children:"UPGRADES"}),l.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",textAnchor:"middle",x:"404",y:"1783.33",children:m})]})}),l.jsxs("text",{fill:"#5bbc70",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(210.86 1947.47)",children:[l.jsx("tspan",{letterSpacing:".01em",children:"G"}),l.jsx("tspan",{x:"50.77",children:"O"}),l.jsx("tspan",{letterSpacing:".01em",x:"94.43",children:"O"}),l.jsx("tspan",{letterSpacing:".03em",x:"138.94",children:"P"}),l.jsx("tspan",{x:"182.79",children:"S"})]}),l.jsxs("g",{id:"How_to_Play",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:v,children:[l.jsx("circle",{fill:"#5bbc70",cx:"60.02",cy:"1920.16",r:"42.65"}),l.jsx("text",{fill:"#0f1528",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(43.23 1951.29)",children:"?"})]}),l.jsxs("g",{id:"Settings",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:y,children:[l.jsx("circle",{fill:"#5bbc70",cx:"586.51",cy:"1921.29",r:"42.65"}),l.jsx("path",{fill:"#0f1528",d:"M575.34,1888.9c1.31-.22,2.74.1,3.77.94.53.43.76,1.11,1.28,1.57,3.07,2.69,6.81,3.17,10.41,1.27,2.93-1.54,3.23-4.63,7.35-3.65,2.47.59,8.3,3.99,10.15,5.79,3.3,3.22.52,5.23.71,8.67.17,3.07,2.34,6.18,5.12,7.42,2.12.95,4.78.73,5.84,3.27s.95,10.11.24,12.77c-1.23,4.62-4.11,3.02-7.31,4.93-2.36,1.42-4.2,4.72-4.2,7.5s1.94,4.09.64,6.88c-1.06,2.28-8.15,6.41-10.64,7.02-3.9.96-4.47-2.07-6.97-3.74-2.65-1.77-6.22-1.75-9.02-.28-3.07,1.61-3.15,5.19-7.61,4.38-2.27-.42-8.91-4.29-10.53-5.98-2.69-2.79-.66-4.28-.3-6.87.55-3.94-1.21-8.15-4.99-9.77-2.48-1.06-5.42-.37-6.52-3.73-.83-2.52-.68-11.58.66-13.88,1.2-2.06,3.02-1.68,4.85-2.27,4.19-1.36,6.81-5.14,6.29-9.6-.29-2.49-1.96-4.37.32-6.86,1.42-1.56,8.41-5.43,10.46-5.77ZM586.19,1909.97c-14.67.42-14.14,22.83.44,22.69,14.84-.14,14.53-23.12-.44-22.69Z"})]}),l.jsx("rect",{x:"0",y:"827.84",width:"648",height:"1152",fill:"#000",style:{opacity:Rt,...Le,pointerEvents:"none"}}),l.jsxs("g",{id:"Periscope",className:ee?"periscope-pulse":"",transform:`translate(0, ${n})`,style:{transition:a||i?"none":"transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"grab"},...s,children:[l.jsx("rect",{fill:"#087962",x:"22.36",y:"978.45",width:"603.66",height:"51.13",rx:"11.03",ry:"11.03"}),l.jsx("path",{fill:"#087962",d:"M 390.17 -1000 V 1111.98 c 0 13.74 -11.16 24.9 -24.9 24.9 h -88.54 c -13.74 0 -24.9 -11.16 -24.9 -24.9 V -1000 H 390.17 Z"}),l.jsxs("g",{children:[l.jsx("path",{fill:"#5bbc70",fillRule:"evenodd",d:"M252.54,1089.77c-23.25,0-45.07-9.09-61.45-25.59-16.38-16.5-25.3-38.39-25.13-61.64.35-47.38,39.59-85.92,87.47-85.92h138.58c23.99,0,46.29,9.59,62.81,26.99,16.51,17.4,24.9,40.21,23.64,64.23-2.4,45.72-40.19,81.7-86.02,81.93h-.44c-24.04,0-47.19-10.12-63.53-27.77-2.19-2.36-4.86-2.71-6.27-2.71s-3.96.34-6.05,2.61c-16.35,17.72-39.54,27.87-63.63,27.87Z"}),l.jsx("path",{fill:"#0b1c3f",fillRule:"evenodd",d:"M392.01,931.91h-138.58c-39.31,0-71.89,31.44-72.18,70.75-.29,39.62,31.74,71.83,71.29,71.83,20.72,0,39.37-8.84,52.39-22.95,9.32-10.1,25.43-10,34.77.09,13.09,14.14,31.85,22.97,52.67,22.87,37.55-.18,68.86-29.95,70.83-67.44,2.16-41.12-30.54-75.13-71.19-75.13Z"}),l.jsx("path",{fill:"#373a60",fillRule:"evenodd",d:"M392.02,1054.51c-14.46,0-27.83-5.85-37.66-16.46-8.25-8.91-19.96-14.02-32.14-14.02s-23.79,5.09-31.97,13.96c-9.83,10.66-23.23,16.53-37.71,16.53s-26.71-5.39-36.42-15.17c-9.71-9.78-15-22.76-14.89-36.54.21-28.08,23.63-50.92,52.21-50.92h138.58c14.22,0,27.44,5.68,37.23,16,9.78,10.31,14.76,23.84,14.01,38.11-1.42,27.07-23.82,48.38-50.98,48.52h-.26Z"})]}),l.jsx("g",{transform:"translate(303.67 1091.18) scale(1.74)",children:l.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})})]}),l.jsx("g",{transform:`translate(0, ${t})`,style:{...Xe,cursor:x?"grab":"default",pointerEvents:x?"auto":"none",touchAction:x?"none":"auto"},...x&&o!==void 0?r:{},children:x?l.jsx("g",{transform:de,children:l.jsx(og,{shiftScore:S,rank:j,xpCurrent:P,xpNext:R,cracksFilled:E,cracksTarget:M,pressureVented:T.totalBonusTime||0,maxTime:J,massPurged:T.maxGroupSize||0,leftoverPenalty:T.penalty||0,unspentPower:U,isWin:E>=M})}):l.jsxs(l.Fragment,{children:[l.jsx("path",{fill:"#f2a743",d:"M48.78,432h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H44.2c-6.78,0-12.28-5.5-12.28-12.28V448.86c0-9.31,7.55-16.86,16.86-16.86Z"}),l.jsx("path",{fill:"#d36b28",d:"M606.65,436.65H40.86c-3.39,0-5.14-4.05-2.82-6.52l19.25-20.52c6.08-6.49,14.58-10.16,23.47-10.16h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),l.jsx("path",{fill:"none",stroke:"#1d1d3a",strokeWidth:"5",strokeMiterlimit:"10",d:"M592.34,1246.25c0,21.83-17.7,39.53-39.53,39.53H94.71c-21.83,0-39.53-17.7-39.53-39.53V499.44c0-21.83,17.7-39.53,39.53-39.53h458.1c21.83,0,39.53,17.7,39.53,39.53v746.81Z"}),l.jsx("rect",{fill:"#1f1f38",x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),l.jsx("foreignObject",{x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53",children:l.jsx("div",{className:"w-full h-full overflow-hidden rounded-[39px]",children:h})}),l.jsx("g",{pointerEvents:"none",children:l.jsx("path",{fill:"none",stroke:"#5bbc70",strokeWidth:"1",strokeOpacity:"0.2",d:"M94.71,474.42h458.1c21.82,0,39.53,17.71,39.53,39.53v732.85c0,21.82-17.71,39.53-39.53,39.53H94.71c-21.82,0-39.53-17.71-39.53-39.53V513.95c0-21.82,17.71-39.53,39.53-39.53Z"})})]})}),A&&!x&&l.jsx("foreignObject",{x:"200",y:"1550",width:"250",height:"300",children:l.jsxs("div",{onClick:ue=>ue.stopPropagation(),style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1d1d3a 0%, #0f1829 100%)",border:"2px solid #5bbc70",borderRadius:"8px",overflow:"hidden"},children:[l.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #5bbc70",color:"#5bbc70",fontFamily:"Amazon Ember, sans-serif",fontWeight:"bold",fontSize:"14px",textAlign:"center"},children:"SELECT RANK"}),l.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px"},children:Array.from({length:51},(ue,Ue)=>l.jsx("div",{onClick:()=>$e(Ue),style:{padding:"8px 12px",color:Ue===0?"#f87171":Ue===j?"#5bbc70":"#aad9d9",fontFamily:"Amazon Ember, sans-serif",fontSize:"14px",cursor:"pointer",borderRadius:"4px",background:Ue===j?"rgba(91, 188, 112, 0.2)":"transparent",fontWeight:Ue===j?"bold":"normal",transition:"background 0.15s"},onMouseEnter:He=>{Ue!==j&&(He.currentTarget.style.background="rgba(170, 217, 217, 0.1)")},onMouseLeave:He=>{Ue!==j&&(He.currentTarget.style.background="transparent")},children:Ue===0?"0 - WIPE DATA":`Rank ${Ue}`},Ue))})]})})]})},Tg=[{id:"actives",label:"TOOLS",unlockRank:5,color:"#fbbf24"},{id:"features",label:"FEATURES",unlockRank:20,color:"#a78bfa"},{id:"complications",label:"SYSTEMS",unlockRank:2,color:"#f97316"},{id:"passives",label:"UTILITY",unlockRank:3,color:"#5bbc70"}],bg=(e,t)=>t==="active"?{accent:"#b45309",text:"#fbbf24"}:t==="feature"?{accent:"#7c3aed",text:"#a78bfa"}:e==="CAPACITOR_EFFICIENCY"?{accent:"#d82727",text:"#ff6b6b"}:e==="CIRCUIT_STABILIZER"?{accent:"#d36b28",text:"#ffa94d"}:e==="GEAR_LUBRICATION"?{accent:"#2d5a87",text:"#74c0fc"}:{accent:"#2d7a4d",text:"#5bbc70"},Mg=({scraps:e,upgrades:t,rank:n,onPurchase:s,onRefund:r,onClose:o,equippedActives:a=[],onToggleEquip:i,maxActiveSlots:c=1})=>{var S;const u=Tg.filter(T=>T.unlockRank<=n),[f,d]=g.useState(((S=u[0])==null?void 0:S.id)||"complications"),[p,y]=g.useState(!1),v=g.useRef(0),k=g.useRef(0),w=50,m=(T,E)=>{y(!0),v.current=T,k.current=E},h=(T,E)=>{if(!p)return;y(!1);const M=T-v.current,U=E-k.current;if(Math.abs(M)>Math.abs(U)&&Math.abs(M)>w){const J=u.findIndex(se=>se.id===f);M>0&&J<u.length-1?d(u[J+1].id):M<0&&J>0&&d(u[J-1].id)}};g.useEffect(()=>{const T=M=>{p&&h(M.clientX,M.clientY)},E=M=>{p&&M.changedTouches[0]&&h(M.changedTouches[0].clientX,M.changedTouches[0].clientY)};return p&&(window.addEventListener("mouseup",T),window.addEventListener("touchend",E)),()=>{window.removeEventListener("mouseup",T),window.removeEventListener("touchend",E)}},[p,f,u]);const C=(()=>{const T=Object.values(Nn).filter(E=>E.unlockRank<=n);switch(f){case"actives":return T.filter(E=>E.type==="active").sort((E,M)=>E.unlockRank-M.unlockRank);case"features":return T.filter(E=>E.type==="feature").sort((E,M)=>E.unlockRank-M.unlockRank);case"complications":return T.filter(E=>E.category==="complication").sort((E,M)=>E.unlockRank-M.unlockRank);case"passives":return T.filter(E=>E.type==="passive"&&E.category!=="complication").sort((E,M)=>E.unlockRank-M.unlockRank);default:return[]}})(),j=u.length>0,P=T=>{const E=t[T.id]||0,M=E>=T.maxLevel,J=e>=T.costPerLevel&&!M,se=E>0,N=bg(T.id,T.type),Y=T.type==="active",ee=a.includes(T.id);return l.jsxs("div",{className:"rounded-xl p-4 border",style:{backgroundColor:"#0c0f19",borderColor:Y&&ee?"#5bbc70":"#ffffff40"},children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("h3",{className:"font-bold tracking-wide t-body",style:{color:N.text},children:T.name}),l.jsx("p",{style:{color:"#59acae"},className:"mt-1 t-body",children:T.desc})]}),Y&&E>0&&i&&l.jsx("button",{onClick:()=>i(T.id),disabled:!ee&&a.length>=c,className:"ml-2 px-3 py-1 rounded-lg font-bold t-body border-2 transition-all",style:{borderColor:ee?"#5bbc70":"#59acae60",color:ee?"#5bbc70":"#59acae",backgroundColor:ee?"#5bbc7020":"transparent",cursor:!ee&&a.length>=c?"not-allowed":"pointer",opacity:!ee&&a.length>=c?.5:1},children:ee?"ON":"OFF"})]}),l.jsxs("div",{className:"flex items-center gap-3 my-3",children:[l.jsx("button",{onClick:()=>se&&(r==null?void 0:r(T.id)),disabled:!se,className:"w-8 h-8 rounded-lg font-bold t-heading border-2 transition-all flex items-center justify-center",style:{borderColor:se?N.accent:"#59acae30",color:se?N.text:"#59acae40",backgroundColor:se?N.accent+"20":"transparent",cursor:se?"pointer":"not-allowed"},children:""}),l.jsx("div",{className:"flex gap-1 flex-1 justify-center",children:Array.from({length:T.maxLevel}).map((B,Q)=>l.jsx("div",{className:"h-4 rounded-sm border flex-1 max-w-8",style:{borderColor:Q<E?N.accent:"#59acae40",backgroundColor:Q<E?N.accent:"transparent"}},Q))}),l.jsx("button",{onClick:()=>J&&s(T.id),disabled:!J,className:"w-8 h-8 rounded-lg font-bold t-heading border-2 transition-all flex items-center justify-center",style:{borderColor:J?N.accent:"#59acae30",color:J?N.text:"#59acae40",backgroundColor:J?N.accent+"20":"transparent",cursor:J?"pointer":"not-allowed"},children:"+"}),l.jsxs("span",{className:"font-bold w-12 text-right t-body",style:{color:N.text},children:[E,"/",T.maxLevel]})]}),l.jsxs("div",{className:"flex justify-between items-start t-body",children:[l.jsx("div",{style:{color:"#ffffff"},children:Y?l.jsxs(l.Fragment,{children:["Effect: ",T.formatEffect(1)]}):E>0?l.jsxs(l.Fragment,{children:["Current: ",T.formatEffect(E)]}):l.jsx("span",{style:{color:"#59acae"},children:"Current: Spend points to upgrade"})}),M&&T.maxLevelBonus&&l.jsxs("div",{className:"italic text-right ml-2",style:{color:"#5bbc70"},children:["Max: ",T.maxLevelBonus]})]})]},T.id)},R=()=>u.length===0?null:l.jsx("div",{className:"flex w-full mb-3",style:{height:"36px"},children:u.map(T=>{const E=f===T.id;return l.jsx("button",{onClick:()=>d(T.id),className:"font-bold text-center transition-all t-body",style:{width:"25%",backgroundColor:E?T.color+"30":"transparent",color:E?T.color:"#59acae",borderBottom:E?`3px solid ${T.color}`:"3px solid transparent",padding:"8px 4px",fontFamily:"'From Where You Are', sans-serif",letterSpacing:"0.05em"},children:T.label},T.id)})});return l.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:l.jsxs("div",{className:"relative",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:[l.jsxs("svg",{viewBox:"0 0 583.67 910",className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[l.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),l.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),l.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),l.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),l.jsx("text",{fill:"#f2a743",fontFamily:"'From Where You Are'",fontSize:"28",transform:"translate(50 105)",children:"UPGRADES"}),l.jsxs("text",{fill:"#5bbc70",fontFamily:"'Amazon Ember'",transform:"translate(530 105)",textAnchor:"end",children:[l.jsx("tspan",{fontSize:"16",fontWeight:"600",children:"SCRAPS: "}),l.jsx("tspan",{fontSize:"32",fontWeight:"800",children:e})]}),l.jsxs("foreignObject",{x:"40",y:"125",width:"503",height:"720",children:[l.jsx("style",{children:".upgrade-scroll::-webkit-scrollbar { display: none; }"}),l.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"upgrade-scroll w-full h-full overflow-y-auto",style:{fontFamily:"'Amazon Ember', sans-serif",scrollbarWidth:"none",msOverflowStyle:"none"},onMouseDown:T=>m(T.clientX,T.clientY),onTouchStart:T=>m(T.touches[0].clientX,T.touches[0].clientY),children:j?l.jsxs("div",{className:"pb-20",children:[l.jsx("div",{className:"t-body mb-3 text-center",style:{color:"#fbbf24",fontFamily:"'Amazon Ember', sans-serif"},children:"Earn Scraps by Increasing your Operator Rank"}),R(),l.jsx("div",{className:"space-y-3",children:C.length>0?C.map(P):l.jsx("div",{className:"text-center py-8 t-body",style:{color:"#59acae"},children:"No upgrades available in this category yet."})})]}):l.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[l.jsx("p",{className:"t-heading tracking-wide mb-3",style:{color:"#6acbda",fontFamily:"'From Where You Are', sans-serif"},children:"NO UPGRADES AVAILABLE"}),l.jsx("p",{className:"t-body",style:{color:"#59acae"},children:"Reach Rank 2 to unlock your first upgrade"})]})})]})]}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:o,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(fl,{className:"w-1/2 h-1/2 stroke-[3]"})})})]})})},Ag=({engine:e,state:t,careerScore:n,scraps:s,powerUps:r={},onOpenSettings:o,onOpenHelp:a,onOpenUpgrades:i,onSetRank:c,onPurchaseUpgrade:u,onRefundUpgrade:f,onDismissGameOver:d,equippedActives:p=[],onToggleEquip:y,pulsePeriscope:v=!1})=>{const k=t.shiftScore>0||t.gameOver;let w;if(k){const le=t.goalsCleared>=t.goalsTarget,{newCareerScore:q}=I0(e.initialTotalScore,t.shiftScore,le);w=gt(q)}else w=gt(n);const[m,h]=g.useState(!1),x=g.useRef(null),[C,j]=g.useState(0),[P,R]=g.useState(!1),[S,T]=g.useState(!1),E=g.useRef(0),M=200,U=300,[J,se]=g.useState(0),[N,Y]=g.useState(!1),ee=g.useRef(0),B=150,[Q,K]=g.useState(0);g.useEffect(()=>{if(!t.gameOver){const le=setInterval(()=>{K(q=>(q+1)%2)},2e3);return()=>clearInterval(le)}},[t.gameOver]),g.useEffect(()=>{t.phase===qe.ConsoleScreen&&!t.gameOver&&(j(U),T(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{T(!1),j(0)})}))},[t.phase,t.gameOver]);const re=le=>{t.gameOver||(R(!0),E.current=le-C)},oe=le=>{if(!P)return;const q=le-E.current,ke=Math.max(0,Math.min(U,q));j(ke)},ve=()=>{P&&(R(!1),C>M?(e.execute(new Hs(qe.TankScreen)),setTimeout(()=>j(0),1e3)):j(0))},Pe=le=>{t.gameOver&&(Y(!0),ee.current=le-J)},be=le=>{if(!N)return;const q=le-ee.current,ke=Math.min(0,q);se(ke)},A=()=>{N&&(Y(!1),J<-B&&d&&d(),se(0))};g.useEffect(()=>{const le=je=>{P&&oe(je.clientY),N&&be(je.clientY)},q=()=>{P&&ve(),N&&A()},ke=je=>{P&&oe(je.touches[0].clientY),N&&be(je.touches[0].clientY)},Ce=()=>{P&&ve(),N&&A()};return(P||N)&&(window.addEventListener("mousemove",le),window.addEventListener("mouseup",q),window.addEventListener("touchmove",ke),window.addEventListener("touchend",Ce)),()=>{window.removeEventListener("mousemove",le),window.removeEventListener("mouseup",q),window.removeEventListener("touchmove",ke),window.removeEventListener("touchend",Ce)}},[P,C,N,J]);const G=()=>{e.abortRun()},X=e.isSessionActive&&!t.gameOver,fe=(t.gameOver?520:-400)+J,ie=()=>l.jsx("div",{className:"w-full h-full flex flex-col items-center pt-24 font-mono overflow-hidden text-center select-none",children:l.jsx("div",{className:"mt-auto mb-4 flex flex-col items-center",children:X?Q===0?l.jsx("div",{className:"text-[#5bbc70] t-display font-black tracking-widest font-['From_Where_You_Are'] animate-pulse",children:"CLEANING..."}):l.jsxs("div",{className:"text-[#f1a941] t-display font-black tracking-widest font-['From_Where_You_Are']",children:[Math.floor((1-t.shiftTime/e.maxTime)*100),"% PSI"]}):Q===0?l.jsx("div",{className:"text-[#f1a941] t-heading font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"TO START SHIFT"}):l.jsx("div",{className:"text-[#f1a941] t-heading font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"PULL DOWN PERISCOPE"})})});return l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{ref:x,className:"relative z-10 select-none flex items-center justify-center",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsx("div",{className:"w-full h-full shadow-2xl relative",children:l.jsx(jg,{dialRotation:0,monitorOffset:fe,periscopeY:C,dragHandlers:{onMouseDown:le=>re(le.clientY),onTouchStart:le=>re(le.touches[0].clientY)},monitorDragHandlers:{onMouseDown:le=>Pe(le.clientY),onTouchStart:le=>Pe(le.touches[0].clientY)},isMonitorDragging:N,isPeriscopeDragging:P,isSnapping:S,onSettingsClick:o,onHelpClick:a,onUpgradesClick:()=>h(!0),onSetRank:c,onAbortClick:G,upgradeCount:s,screenContent:t.gameOver?null:l.jsx(ie,{}),isGameOver:t.gameOver,isSessionActive:e.isSessionActive,rank:w.rank,currentXP:w.progress,nextRankXP:w.toNextRank,shiftScore:t.shiftScore,gameStats:t.gameStats,goalsCleared:t.goalsCleared,goalsTarget:t.goalsTarget,unspentPower:s,maxTime:e.maxTime,complications:t.complications,onResolveComplication:le=>e.execute(new tg(le)),upgradeLevels:r,pulsePeriscope:v})})}),m&&l.jsx(Mg,{scraps:s,upgrades:r,rank:w.rank,onPurchase:le=>u==null?void 0:u(le),onRefund:le=>f==null?void 0:f(le),onClose:()=>h(!1),equippedActives:p,onToggleEquip:y,maxActiveSlots:1+(r.ACTIVE_EXPANSION_SLOT||0)+(r.ACTIVE_EXPANSION_SLOT_2||0)})]})};function Yl(e){return`${e.x},${e.y}`}function Df(e){if(e.length<=1)return!0;const t=new Set(e.map(Yl)),n=new Set,s=[e[0]];for(;s.length>0;){const r=s.shift(),o=Yl(r);if(n.has(o))continue;n.add(o);const a=[{x:r.x,y:r.y+1},{x:r.x,y:r.y-1},{x:r.x+1,y:r.y},{x:r.x-1,y:r.y}];for(const i of a){const c=Yl(i);t.has(c)&&!n.has(c)&&s.push(i)}}return n.size===e.length}function Eg(e){const t=e.length;if(t<2)return null;let n=null,s=1/0;for(let r=1;r<(1<<t)-1;r++){const o=[],a=[];for(let f=0;f<t;f++)r&1<<f?o.push(f):a.push(f);const i=o.map(f=>e[f]),c=a.map(f=>e[f]);if(!Df(i)||!Df(c))continue;const u=Math.abs(o.length-a.length);if(u<s&&(s=u,n=[o,a],u===0))break}return n}function $f(e,t,n){const s=Eg(e.cells);if(!s)return{...e,color:t};const[r]=s,o=new Set(r),a=e.cells.map((i,c)=>o.has(c)?t:n);return{...e,color:t,cellColors:a}}const Ff=5e3;class Ig{trySpawnGoal(t,n,s,r,o,a){if(t.goalsCleared>=t.goalsTarget)return{goal:null,newLastSpawnTime:a};const i=Date.now();if(i-a<=Ff)return{goal:null,newLastSpawnTime:a};const c=gt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=Sf(n,t.goalMarks,c,r,o,u);return f?(u&&t.crackDownRemaining--,Tt.playPop(1),{goal:f,newLastSpawnTime:i}):{goal:null,newLastSpawnTime:i}}trySpawnCrack(t,n,s,r,o,a){if(t.goalsCleared>=t.goalsTarget)return{crack:null,newLastSpawnTime:a};const i=Date.now();if(i-a<=Ff)return{crack:null,newLastSpawnTime:a};const c=gt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=t.crackCells.map(p=>({id:p.id,x:p.x,y:p.y,color:p.color,spawnTime:p.spawnTime})),d=Sf(n,f,c,r,o,u);if(d){console.log(`[CRACK] SPAWN via GoalManager at (${d.x}, ${d.y}) color=${d.color} source="GoalManager-trySpawnCrack" time=${new Date().toLocaleTimeString()}`);const p={id:d.id,x:d.x,y:d.y,color:d.color,originCrackId:[],branchCrackIds:[],lastGrowthCheck:i,crackBranchInterval:7e3+Math.random()*5e3,spawnTime:d.spawnTime};return u&&t.crackDownRemaining--,Tt.playPop(1),{crack:p,newLastSpawnTime:i}}return{crack:null,newLastSpawnTime:i}}handleGoals(t,n,s,r,o){t.goalMarks=t.goalMarks.filter(i=>!n.includes(i.id));const a=new Set(n);n.forEach(i=>{const c=t.crackCells.find(u=>u.id===i);c&&(c.originCrackId.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.branchCrackIds=f.branchCrackIds.filter(d=>d!==i))}),c.branchCrackIds.forEach(u=>{const f=t.crackCells.find(d=>d.id===u);f&&(f.originCrackId=f.originCrackId.filter(d=>d!==i))}))}),t.crackCells=t.crackCells.filter(i=>!a.has(i.id)),n.forEach(i=>{const c=Ve(r.x),u=Math.floor(r.y),f=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:f,text:"Laser to Seal",x:c,y:u,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(d=>d.id!==f),o()},1e3),pe.emit(ae.GOAL_CAPTURED,{count:1})})}handleCrackConsumption(t,n,s,r){if(n.length===0)return;const o=new Set(n);if(n.forEach(a=>{const i=t.crackCells.find(c=>c.id===a);i&&(i.originCrackId.forEach(c=>{const u=t.crackCells.find(f=>f.id===c);u&&(u.branchCrackIds=u.branchCrackIds.filter(f=>f!==a))}),i.branchCrackIds.forEach(c=>{const u=t.crackCells.find(f=>f.id===c);u&&(u.originCrackId=u.originCrackId.filter(f=>f!==a))}))}),t.crackCells=t.crackCells.filter(a=>!o.has(a.id)),t.goalMarks=t.goalMarks.filter(a=>!o.has(a.id)),n.length>0){const a=Ve(s.x),i=Math.floor(s.y),c=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:c,text:n.length>1?`Sealed ${n.length}`:"Sealed",x:a,y:i,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(u=>u.id!==c),r()},1e3),pe.emit(ae.GOAL_CAPTURED,{count:n.length})}}countCracks(t){if(t.length===0)return 0;const n=new Set;let s=0;for(const r of t){if(n.has(r.id))continue;const o=[r.id];for(;o.length>0;){const a=o.shift();if(n.has(a))continue;n.add(a);const i=t.find(c=>c.id===a);i&&(i.originCrackId.forEach(c=>{n.has(c)||o.push(c)}),i.branchCrackIds.forEach(c=>{n.has(c)||o.push(c)}))}s++}return s}getConnectedComponent(t,n){const s=new Set,r=[],o=[t];for(;o.length>0;){const a=o.shift();if(s.has(a))continue;s.add(a);const i=n.find(c=>c.id===a);i&&(r.push(i),i.originCrackId.forEach(c=>{s.has(c)||o.push(c)}),i.branchCrackIds.forEach(c=>{s.has(c)||o.push(c)}))}return r}isLeafCell(t,n){const s=n.find(r=>r.id===t);return s?s.branchCrackIds.length===0:!0}}const nc=new Ig,_g=8;class Og{tickGrowth(t,n,s,r){var i;if(gt(n).rank<30||t.phase===qe.ConsoleScreen||t.phase===qe.COMPLICATION_MINIGAME)return;const a=Date.now();for(const c of t.crackCells){if((i=t.grid[c.y])!=null&&i[c.x]||a-c.lastGrowthCheck<c.crackBranchInterval)continue;c.lastGrowthCheck=a,c.crackBranchInterval=5e3+Math.random()*5e3;const u=Math.max(0,1-t.shiftTime/r),f=Math.min(1,.1+u),p=(s.SLOW_CRACKS||0)*.05;let y=Math.max(0,f-p);c.branchCrackIds.length===0&&(y*=.5);const k=this.getDistanceFromRoot(c,t.crackCells),w=Math.max(.1,1-k*.25);if(y*=w,Math.random()>y)continue;const m=[{x:Ve(c.x+1),y:c.y},{x:Ve(c.x-1),y:c.y},{x:c.x,y:c.y+1},{x:c.x,y:c.y-1},{x:Ve(c.x+1),y:c.y-1},{x:Ve(c.x-1),y:c.y-1},{x:Ve(c.x+1),y:c.y+1},{x:Ve(c.x-1),y:c.y+1}],h=[];for(const C of m){if(C.y<nt||C.y>=Ne)continue;const j=t.crackCells.find(R=>R.x===C.x&&R.y===C.y&&R.color===c.color);if(j){!c.branchCrackIds.includes(j.id)&&!c.originCrackId.includes(j.id)&&h.push({...C,existingCrack:j});continue}t.crackCells.find(R=>R.x===C.x&&R.y===C.y)||t.grid[C.y][C.x]||h.push(C)}if(h.length===0)continue;const x=h[Math.floor(Math.random()*h.length)];if(x.existingCrack)x.existingCrack.originCrackId.push(c.id),c.branchCrackIds.push(x.existingCrack.id);else{if(nc.countCracks(t.crackCells)>=_g)continue;const j={id:Math.random().toString(36).substr(2,9),x:x.x,y:x.y,color:c.color,originCrackId:[c.id],branchCrackIds:[],lastGrowthCheck:a,crackBranchInterval:5e3+Math.random()*5e3,spawnTime:a};c.branchCrackIds.push(j.id),console.log(`[CRACK] SPAWN id=${j.id} at (${j.x}, ${j.y}) color=${j.color} source="CrackManager-branch" time=${new Date().toLocaleTimeString()} totalCracks=${t.crackCells.length+1}`),t.crackCells.push(j),t.goalMarks.push({id:j.id,x:j.x,y:j.y,color:j.color,spawnTime:j.spawnTime})}}}getDistanceFromRoot(t,n){if(t.originCrackId.length===0)return 0;let s=0,r=t.id;const o=new Set;for(;!o.has(r);){o.add(r);const a=n.find(i=>i.id===r);if(!a||a.originCrackId.length===0||(s++,r=a.originCrackId[0],s>20))break}return s}}const Gf=780,Bf=8,zf=500,Lg=80,Ng=.03;class Dg{constructor(t,n={},s=[]){Be(this,"state");Be(this,"listeners",new Set);Be(this,"maxTime",Io);Be(this,"lockStartTime",null);Be(this,"lockResetCount",0);Be(this,"usePhysicsForFalling",!1);Be(this,"freezeTimer",!1);Be(this,"freezeFalling",!1);Be(this,"devOverrideNextGoop",null);Be(this,"lastGoalSpawnTime",0);Be(this,"lastComplicationCheckTime",0);Be(this,"isFastDropping",!1);Be(this,"wasFastDropping",!1);Be(this,"lightsOverflarePhase","none");Be(this,"lightsOverflareTime",0);Be(this,"lightsFlickerTime",0);Be(this,"lightsFlickerActive",!1);Be(this,"lightsGracePausedAt",null);Be(this,"initialTotalScore",0);Be(this,"powerUps",{});Be(this,"isSessionActive",!1);Be(this,"isTrainingMode",!1);Be(this,"maxPieceSize",null);Be(this,"pendingTrainingPalette",null);Be(this,"trainingAllowedControls",null);Be(this,"trainingPressureRate",0);Be(this,"trainingHighlightColor",null);Be(this,"trainingPopLowersPressure",!1);Be(this,"equippedActives",[]);Be(this,"crackManager");Be(this,"pendingTotalScore",null);this.initialTotalScore=t,this.powerUps=n,this.equippedActives=s;const r=gt(t).rank,a=Rn(r).length+r;this.state={grid:vf(r,n),tankRotation:0,activeGoop:null,storedGoop:null,nextGoop:null,shiftScore:0,gameOver:!1,isPaused:!1,canSwap:!0,level:1,cellsCleared:0,popStreak:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:Io,scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},gameStats:{startTime:0,totalBonusTime:0,maxGroupSize:0},floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:a,phase:qe.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ie.LIGHTS]:0,[Ie.CONTROLS]:0,[Ie.LASER]:0},activeCharges:{},crackGoopPopped:0,colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.applyUpgrades(),this.crackManager=new Og}randomThreshold(){return Math.floor(Math.random()*13)+12}hasAdjacentWild(t,n){for(const s of n.cells){const r=Ve(n.x+s.x),o=Math.floor(n.y+s.y);if(o<0||o>=Ne)continue;const a=[{x:Ve(r+1),y:o},{x:Ve(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}];for(const i of a)if(i.y>=0&&i.y<Ne){const c=t[i.y][i.x];if(c!=null&&c.isWild)return!0}}return!1}execute(t){t.execute(this)}applyUpgrades(){let t=Io;const n=this.powerUps.PRESSURE_CONTROL||0;if(n>0){const s=n*5*1e3;t+=s}this.maxTime=t,this.state.gameStats.startTime===0&&(this.state.shiftTime=this.maxTime)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emitChange(){this.listeners.forEach(t=>t())}syncTotalScore(t){this.state.gameOver?this.pendingTotalScore=t:(this.initialTotalScore=t,this.pendingTotalScore=null)}startRun(){this.isTrainingMode=!1,this.maxPieceSize=null;const t=gt(this.initialTotalScore).rank,n=Rn(t),s=n.length+t,r=n[Math.floor(Math.random()*n.length)],o=Math.random()<$l,a=o?Jo:bs,i=Math.floor(Math.random()*a.length),c=this.maybeApplyMirror({...a[i]}),u=!o&&t>=20&&Math.random()<.25;let f;if(u){const w=n.filter(x=>x!==r),m=w[Math.floor(Math.random()*w.length)],h={...c,color:r};f=$f(h,r,m)}else f={...c,color:r,isCorrupted:o||void 0};const d=Math.random()<$l,p=d?Jo:bs,y=Math.floor(Math.random()*p.length),v=this.maybeApplyMirror({...p[y]});this.state={...this.state,grid:vf(t,this.powerUps),tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...v,color:n[Math.floor(Math.random()*n.length)],isCorrupted:d||void 0},nextGoop:f,canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:this.maxTime,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:s,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:qe.TankScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ie.LIGHTS]:0,[Ie.CONTROLS]:0,[Ie.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0;const k={};this.equippedActives.forEach(w=>{k[w]=0}),this.state.activeCharges=k,this.spawnNewPiece(),pe.emit(ae.GAME_START),pe.emit(ae.MUSIC_START),this.emitChange()}startTraining(t){this.isTrainingMode=!0,this.maxTime=Io,this.maxPieceSize=null;const n=Array(Ne).fill(null).map(()=>Array(Re).fill(null)),s=t[Math.floor(Math.random()*t.length)],r=bs,o=Math.floor(Math.random()*r.length),a=this.maybeApplyMirror({...r[o]}),i=t[Math.floor(Math.random()*t.length)],c=Math.floor(Math.random()*r.length),u=this.maybeApplyMirror({...r[c]});this.state={...this.state,grid:n,tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...u,color:i},nextGoop:{...a,color:s},canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:Io,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:0,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:qe.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Ie.LIGHTS]:0,[Ie.CONTROLS]:0,[Ie.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0,this.state.activeCharges={},pe.emit(ae.GAME_START),this.emitChange()}resetSession(){this.state.gameOver=!1,this.isSessionActive=!1,this.state.phase=qe.ConsoleScreen,this.state.shiftScore=0,this.state.activeGoop=null,this.pendingTotalScore!==null&&(this.initialTotalScore=this.pendingTotalScore,this.pendingTotalScore=null),this.emitChange()}abortRun(){!this.isSessionActive||this.state.gameOver||(this.state.shiftScore=0,this.state.goalsCleared=0,this.finalizeGame())}enterConsole(){this.state.phase=qe.ConsoleScreen,this.emitChange()}enterPeriscope(){this.pendingTrainingPalette&&this.state.isPaused||(this.state.gameOver?this.pendingTrainingPalette?(this.startTraining(this.pendingTrainingPalette),this.state.phase=qe.TankScreen):this.startRun():(this.state.phase=qe.TankScreen,this.isSessionActive||(this.pendingTrainingPalette?(this.startTraining(this.pendingTrainingPalette),this.state.phase=qe.TankScreen):this.startRun())),this.emitChange())}resolveComplication(t){this.state.gameOver||(Ys.resolveComplication(this.state,t,this.initialTotalScore,this.powerUps),this.state.phase=qe.ConsoleScreen,this.emitChange())}activateAbility(t){var s,r;if(this.state.gameOver)return;const n=Nn[t];if(!(!n||n.type!=="active"))switch(t){case"COOLDOWN_BOOSTER":{const o=this.powerUps[t]||1,i=[.25,.35,.5][Math.min(o,3)-1];Ys.extendAllCooldowns(this.state,i),console.log(`COOLDOWN_BOOSTER activated: +${i*100}% cooldown extension`);break}case"GOOP_DUMP":{const o=Rn(gt(this.initialTotalScore).rank),a=((s=this.state.activeGoop)==null?void 0:s.definition.color)||o[Math.floor(Math.random()*o.length)],i=this.powerUps[t]||1,c=Math.min(i,3),u=18,f=600,d=[];for(let p=0;p<c;p++)for(let y=0;y<u;y++)d.push({id:Math.random().toString(36).substr(2,9),color:a,x:Math.floor(Math.random()*Re),y:-1,spawnDelay:p*f+y*Lg});this.state.dumpQueue.push(...d),console.log(`GOOP_DUMP activated: ${c} wave(s), ${d.length} total ${a} pieces`);break}case"GOOP_COLORIZER":{const o=(r=this.state.activeGoop)==null?void 0:r.definition.color;if(!o){console.log("GOOP_COLORIZER: No active piece to match color");break}const a=this.powerUps[t]||1,c=[6,7,8][Math.min(a,3)-1];this.state.colorizerColor=o,this.state.colorizerRemaining=c,console.log(`GOOP_COLORIZER activated: next ${c} pieces will be ${o}`);break}case"CRACK_DOWN":{const a=1+(this.powerUps[t]||1)*2;this.state.crackDownRemaining=a;break}}}chargeActiveAbilities(t){Object.keys(this.state.activeCharges).forEach(n=>{const s=this.state.activeCharges[n]||0;this.state.activeCharges[n]=Math.min(100,s+t)})}checkComplications(t){const{spawned:n,newLastCheckTime:s}=Ys.checkComplications(this.state,this.initialTotalScore,this.lastComplicationCheckTime);this.lastComplicationCheckTime=s,n&&(Ys.spawnComplication(this.state,n),this.emitChange())}finalizeGame(){if(this.state.gameOver)return;this.state.gameOver=!0,this.isSessionActive=!1,this.state.phase=qe.ConsoleScreen;let t=0;for(let a=0;a<Ne;a++)for(let i=0;i<Re;i++)this.state.grid[a][i]&&t++;const n=this.powerUps.AUTO_POPPER||0;if(n>0){const a=t,i=.2-n*.04;let c=0;for(let u=0;u<a;u++)Math.random()>i&&c++;t-=c,console.log(`AUTO_POPPER: ${c} of ${a} goop auto-popped (${t} remaining)`)}const s=t*50;this.state.gameStats.penalty=s,this.state.shiftScore=Math.max(0,this.state.shiftScore-s);const o=100*gt(this.initialTotalScore).rank;this.state.shiftScore=Math.max(o,this.state.shiftScore),this.state.complications=[],this.state.activeComplicationId=null,this.state.prePoppedGoopGroups.clear(),pe.emit(ae.GAME_OVER),this.emitChange()}getPiecePoolByZone(t){const s=(this.maxTime-this.state.shiftTime)/1e3,r=this.maxTime/3/1e3,o=!t&&Math.random()<$l;return s<r?{pool:o?Jo:bs,isCorrupted:o}:s<r*2?{pool:o?nu:cl,isCorrupted:o}:{pool:o?su:ul,isCorrupted:o}}maybeApplyMirror(t){return Math.random()>=_x||t.cells.every(s=>t.cells.some(r=>r.x===-s.x&&r.y===s.y))?t:{...t,cells:t.cells.map(s=>({x:-s.x,y:s.y}))}}spawnNewPiece(t,n,s){const r=n||this.state.grid,o=s!==void 0?s:this.state.tankRotation,a=this.initialTotalScore+this.state.shiftScore,i=gt(a).rank,c=Rn(i);let u=t;if(!u&&this.state.nextGoop){u=this.state.nextGoop;let y=c[Math.floor(Math.random()*c.length)];const v=this.powerUps.CRACK_MATCHER||0,k=this.state.crackCells.length>0?this.state.crackCells:this.state.goalMarks;if(v>0&&k.length>0){const P=k.reduce((S,T)=>T.y>S.y?T:S),R=v*.25;Math.random()<R&&(y=P.color)}let{pool:w,isCorrupted:m}=this.getPiecePoolByZone();if(this.maxPieceSize!==null){const P=w.filter(R=>R.cells.length<=this.maxPieceSize);P.length>0&&(w=P)}const h=Math.floor(Math.random()*w.length),x=this.maybeApplyMirror({...w[h]}),C=!m&&i>=20&&Math.random()<.25;let j;if(C){const P=c.filter(T=>T!==y),R=P[Math.floor(Math.random()*P.length)],S={...x,color:y};j=$f(S,y,R)}else j={...x,color:y,isCorrupted:m||void 0};if(!m&&i>=40&&Math.random()<.15){const{pool:P}=this.getPiecePoolByZone(!0),R=Math.floor(Math.random()*P.length);j={...this.maybeApplyMirror({...P[R]}),color:tt.WILD,isWild:!0},console.log("Wild piece queued for next spawn")}this.state.nextGoop=j,this.devOverrideNextGoop&&(this.state.nextGoop={...this.devOverrideNextGoop})}const f=Gy(u,i);this.state.colorizerRemaining>0&&this.state.colorizerColor&&(f.definition={...f.definition,color:this.state.colorizerColor,cellColors:void 0},this.state.colorizerRemaining--,this.state.nextGoop&&this.state.colorizerRemaining>0&&(this.state.nextGoop={...this.state.nextGoop,color:this.state.colorizerColor,cellColors:void 0}),console.log(`GOOP_COLORIZER: Spawned ${this.state.colorizerColor} piece (${this.state.colorizerRemaining} remaining)`),this.state.colorizerRemaining===0&&(this.state.colorizerColor=null));const d=Math.floor((rt-1)/2),p=this.isTrainingMode?nt-1:0;if(f.screenX=d,f.x=tc(d,o),f.y=p,f.startSpawnY=p,f.state=Fn.FALLING,this.lockStartTime=null,this.lockResetCount=0,ms(r,f)){if(this.isTrainingMode){pe.emit(ae.GAME_OVER);return}this.finalizeGame();return}this.state.activeGoop=f,this.state.canSwap=!0,this.emitChange()}updateScoreAndStats(t,n){this.state.shiftScore+=t,n&&(this.state.scoreBreakdown.base+=n.base||0,this.state.scoreBreakdown.height+=n.height||0,this.state.scoreBreakdown.offscreen+=n.offscreen||0,this.state.scoreBreakdown.adjacency+=n.adjacency||0,this.state.scoreBreakdown.speed+=n.speed||0)}handleGoals(t,n,s){nc.handleGoals(this.state,t,n,s,()=>this.emitChange())}tickTimer(t){if(this.isTrainingMode)return!this.freezeTimer&&this.trainingPressureRate>0&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*this.trainingPressureRate)),!0;const n=this.powerUps.FOCUS_MODE||0,r=this.state.phase===qe.COMPLICATION_MINIGAME&&n>0?1-n*.1:1;return!this.freezeTimer&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*r),this.state.shiftTime<=0)?(this.finalizeGame(),!1):!0}tickGoals(){const{crack:t,newLastSpawnTime:n}=nc.trySpawnCrack(this.state,this.state.grid,this.initialTotalScore,this.state.shiftTime,this.maxTime,this.lastGoalSpawnTime);this.lastGoalSpawnTime=n,t&&(console.log(`[CRACK] SPAWN id=${t.id} at (${t.x}, ${t.y}) color=${t.color} source="ENGINE-tickGoals" time=${new Date().toLocaleTimeString()} totalCracks=${this.state.crackCells.length+1} isTraining=${this.isTrainingMode}`),this.state.crackCells.push(t),this.state.goalMarks.push({id:t.id,x:t.x,y:t.y,color:t.color,spawnTime:t.spawnTime}))}tickHeat(t){const n=gt(this.initialTotalScore).rank,s=gs[Ie.CONTROLS];if(Wn(Ie.CONTROLS,n)&&this.state.controlsHeat>0){const r=Date.now(),o=this.state.rotationTimestamps.length>0?this.state.rotationTimestamps[this.state.rotationTimestamps.length-1]:0;if(r-o>s.idleThresholdMs){const i=this.powerUps.GEAR_LUBRICATION||0,c=s.dissipationBase*(1+s.dissipationUpgradeEffect*i);this.state.controlsHeat=Math.max(0,this.state.controlsHeat-c*t/1e3)}}}tickLightsBrightness(t){const n=gt(this.initialTotalScore).rank,s=gs[Ie.LIGHTS];if(!Wn(Ie.LIGHTS,n))return;if(this.state.phase!==qe.TankScreen){this.state.lightsGraceStart!==null&&this.lightsGracePausedAt===null&&(this.lightsGracePausedAt=Date.now());return}if(this.lightsGracePausedAt!==null&&this.state.lightsGraceStart!==null){const c=Date.now()-this.lightsGracePausedAt;this.state.lightsGraceStart+=c,this.lightsGracePausedAt=null}if(this.state.complications.some(c=>c.type===Ie.LIGHTS)){this.state.lightsBrightness=s.failedBrightness;return}const o=Date.now();this.isFastDropping&&!this.wasFastDropping&&(this.state.lightsGraceStart=null,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),!this.isFastDropping&&this.wasFastDropping&&(this.state.lightsGraceStart=o,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),this.wasFastDropping=this.isFastDropping;const a=this.powerUps.CIRCUIT_STABILIZER||0,i=(s.graceBaseSec+s.gracePerLevel*a)*1e3;if(this.isFastDropping){if(this.state.lightsBrightness<100){const c=s.recoverRate*t/1e3;this.state.lightsBrightness=Math.min(100,this.state.lightsBrightness+c),this.state.lightsBrightness>=100&&(this.lightsOverflarePhase="rising",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="rising"){this.lightsOverflareTime+=t;const c=Math.min(1,this.lightsOverflareTime/s.overflareUpMs);this.state.lightsBrightness=100+(s.overflarePeak-100)*c,c>=1&&(this.lightsOverflarePhase="falling",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="falling"){this.lightsOverflareTime+=t;const c=Math.min(1,this.lightsOverflareTime/s.overflareDownMs);this.state.lightsBrightness=s.overflarePeak-(s.overflarePeak-100)*c,c>=1&&(this.lightsOverflarePhase="none",this.state.lightsBrightness=100)}}else{this.state.lightsGraceStart===null&&(this.state.lightsGraceStart=o);const c=o-this.state.lightsGraceStart;if(c<i){if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1,this.state.lightsBrightness=100}}else if(c>=i&&!this.state.lightsFlickered)this.state.lightsFlickered=!0,this.lightsFlickerActive=!0,this.lightsFlickerTime=0,pe.emit(ae.LIGHTS_FLICKER,{});else if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1}else{const u=c-i,f=s.dimDurationSec*1e3,d=Math.min(1,u/f);this.state.lightsBrightness=100-(100-s.dimThreshold)*d,this.state.lightsBrightness<=s.dimThreshold&&(this.state.lightsBrightness=s.failedBrightness,Ys.spawnComplication(this.state,Ie.LIGHTS))}}}tickLooseGoop(t){if(this.state.looseGoop.length===0)return;const{active:n,landed:s}=Hy(this.state.looseGoop,this.state.grid,t);if(s.length>0){pe.emit(ae.PIECE_DROPPED);const r=this.state.grid.map(i=>[...i]);let o=!1;const a=[];if(s.forEach(i=>{if(i.y>=0&&i.y<Ne){const c=Math.floor(i.y),u=this.state.goalMarks.find(d=>d.x===i.x&&d.y===c);let f=!1;u&&u.color===i.data.color&&(a.push(u.id),f=!0),r[c][i.x]={...i.data,timestamp:Date.now(),isSealingGoop:f},o=!0}}),o&&(this.state.grid=Gi(r)),a.length>0){const i=new Set(a);a.forEach(c=>{const u=this.state.crackCells.find(f=>f.id===c);u&&(u.originCrackId.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.branchCrackIds=d.branchCrackIds.filter(p=>p!==c))}),u.branchCrackIds.forEach(f=>{const d=this.state.crackCells.find(p=>p.id===f);d&&(d.originCrackId=d.originCrackId.filter(p=>p!==c))}))}),this.state.crackCells=this.state.crackCells.filter(c=>!i.has(c.id)),this.state.goalMarks=this.state.goalMarks.filter(c=>!i.has(c.id)),pe.emit(ae.GOAL_CAPTURED,{count:a.length})}this.state.looseGoop=n}else this.state.looseGoop=n}tickDumpPieces(t){var a;const n=[];for(const i of this.state.dumpQueue)i.spawnDelay-=t,i.spawnDelay<=0?this.state.dumpPieces.push(i):n.push(i);if(this.state.dumpQueue=n,this.state.dumpPieces.length===0)return;const s=[],r=this.state.grid.map(i=>[...i]);let o=!1;for(const i of this.state.dumpPieces){i.y+=Ng*t;const c=Math.floor(i.y),u=i.x;let f=!1;(c>=Ne-1||c>=0&&((a=r[c+1])!=null&&a[u]))&&(f=!0),f&&c>=0&&c<Ne?(r[c][u]={id:i.id,goopGroupId:Math.random().toString(36).substr(2,9),timestamp:Date.now(),color:i.color,groupMinY:c,groupMaxY:c,groupSize:1},o=!0):f||s.push(i)}this.state.dumpPieces=s,o&&(this.state.grid=Gi(r))}tickActivePiece(t){if(!this.state.activeGoop||this.usePhysicsForFalling)return;const s=1+(this.powerUps.DENSE_GOOP||0)*.125,r=Gf/s,o=this.isFastDropping?r/Bf:r,a=t/o,i=this.state.activeGoop.y+a,c=tc(this.state.activeGoop.screenX,this.state.tankRotation),u={...this.state.activeGoop,y:i,x:c};if(ms(this.state.grid,u,this.state.tankRotation)){this.lockStartTime===null&&(this.lockStartTime=Date.now());const f=Date.now()-this.lockStartTime,d=this.isFastDropping?50:zf;(f>d||this.lockResetCount>=10)&&this.lockActivePiece()}else this.state.activeGoop=u,this.lockStartTime=null}lockActivePiece(){if(!this.state.activeGoop||this.state.gameOver)return;const t=M0(this.state.grid,this.state.activeGoop,this.state.tankRotation),n={...this.state.activeGoop,y:t};let{grid:s,consumedGoals:r,destroyedGoals:o}=zy(this.state.grid,n,this.state.goalMarks);(n.definition.isWild||this.hasAdjacentWild(s,n))&&(s=Yy(s,n)),(r.length>0||o.length>0)&&this.handleGoals(r,o,n),this.state.complications.some(u=>u.type===Ie.LASER)||(this.state.laserCharge=Math.min(100,this.state.laserCharge+10)),pe.emit(ae.PIECE_DROPPED);const{grid:i,looseGoop:c}=A0(s);c.length>0&&this.state.looseGoop.push(...c),this.state.grid=i,this.isTrainingMode?(this.state.activeGoop=null,this.state.isPaused=!0,this.freezeFalling=!0,this.emitChange()):this.spawnNewPiece(void 0,i),this.state.popStreak=0,this.isFastDropping=!1}tickActiveCharges(t){Object.keys(this.state.activeCharges).length===0&&this.equippedActives.length>0&&this.equippedActives.forEach(s=>{this.state.activeCharges[s]=this.state.activeCharges[s]??0});const n={COOLDOWN_BOOSTER:100/20,GOOP_DUMP:100/15,GOOP_COLORIZER:100/25,CRACK_DOWN:100/30};Object.keys(this.state.activeCharges).forEach(s=>{const r=this.state.activeCharges[s]||0;if(r<100){const o=n[s]||3,a=t/1e3*o,i=Math.min(100,r+a);this.state.activeCharges[s]=i}})}getFallSpeed(){const n=1+(this.powerUps.DENSE_GOOP||0)*.125,s=30/Gf*1e3*n;return this.isFastDropping?s*Bf:s}syncActivePieceFromPhysics(t,n){if(!(!this.state.activeGoop||this.state.gameOver))if(this.state.activeGoop.y=n,t){this.lockStartTime===null&&(this.lockStartTime=Date.now());const s=Date.now()-this.lockStartTime,r=this.isFastDropping?50:zf;(s>r||this.lockResetCount>=10)&&this.lockActivePiece()}else this.lockStartTime=null}tick(t){!this.isSessionActive||this.state.gameOver||this.state.isPaused||this.tickTimer(t)&&(this.isTrainingMode||(this.tickGoals(),this.crackManager.tickGrowth(this.state,this.initialTotalScore,this.powerUps,this.maxTime),this.checkComplications(t),this.tickHeat(t),this.tickLightsBrightness(t),this.tickDumpPieces(t),this.tickActiveCharges(t)),this.tickLooseGoop(t),this.tickActivePiece(t),this.emitChange())}}const Yf=vn?25:16,$g=(e,t,n,s=[],r)=>{const o=g.useRef(null);o.current||(o.current=new Dg(e,t,s));const a=o.current;if(a.equippedActives.length!==s.length||!a.equippedActives.every((p,y)=>p===s[y])){a.equippedActives=s;const p=a.state.activeCharges||{},y={};s.forEach(v=>{y[v]=p[v]??0}),a.state.activeCharges=y}const[,c]=g.useReducer(p=>p+1,0),u=g.useRef(0),f=g.useRef(0),d=g.useRef(0);return g.useEffect(()=>{a.syncTotalScore(e)},[e,a]),g.useEffect(()=>a.subscribe(()=>{if(a.state.gameOver){c();return}const y=performance.now();y-f.current>=Yf&&(f.current=y,c())}),[a]),g.useEffect(()=>{const p=y=>{u.current||(u.current=y);const v=y-u.current;if(vn&&v<Yf){d.current=requestAnimationFrame(p);return}u.current=y,a.tick(v),r&&r(v/1e3,a),d.current=requestAnimationFrame(p)};return d.current=requestAnimationFrame(p),()=>cancelAnimationFrame(d.current)},[a]),{engine:a,gameState:a.state}},Fg=2.4;function Gg(){return{minX:Pn.x,maxX:Pn.x+rt*Et,minY:Pn.y,maxY:Pn.y+Bt*Et}}function Bg(e){const{enabled:t,params:n,bounds:s}=e,r=g.useRef([]),o=g.useRef([]),a=g.useRef([]),i=g.useRef(0),c=g.useRef({...zi,...n}),u=g.useRef(s??Gg());g.useEffect(()=>{n&&(c.current={...zi,...n})},[n==null?void 0:n.damping,n==null?void 0:n.stiffness,n==null?void 0:n.pressure,n==null?void 0:n.iterations,n==null?void 0:n.homeStiffness,n==null?void 0:n.innerHomeStiffness,n==null?void 0:n.returnSpeed,n==null?void 0:n.viscosity,n==null?void 0:n.gravity,n==null?void 0:n.fallingHomeStiffness,n==null?void 0:n.fallingReturnSpeed,n==null?void 0:n.fallingViscosity,n==null?void 0:n.fallingGravity,n==null?void 0:n.attractionRadius,n==null?void 0:n.attractionRestLength,n==null?void 0:n.attractionStiffness,n==null?void 0:n.goopiness,n==null?void 0:n.tendrilEndRadius,n==null?void 0:n.tendrilSkinniness,n==null?void 0:n.wallThickness,n==null?void 0:n.fallingGoopiness,n==null?void 0:n.fallingTendrilEndRadius,n==null?void 0:n.fallingTendrilSkinniness,n==null?void 0:n.dropletCount,n==null?void 0:n.dropletSpeed,n==null?void 0:n.dropletLifetime,n==null?void 0:n.dropletSize,n==null?void 0:n.dropletGravity]),g.useEffect(()=>{s&&(u.current=s)},[s]);const f=g.useCallback((C,j,P,R,S=0)=>{const T=dm(C,j,P,R,S);return r.current=[...r.current,T],T},[]),d=g.useCallback(C=>{r.current=r.current.filter(j=>j.id!==C)},[]),p=g.useCallback((C,j,P)=>{const R=r.current.find(S=>S.id===C);R&&(R.targetX=j,R.targetY=P)},[]),y=g.useCallback(C=>{const j=r.current.find(P=>P.id===C);j&&(j.isLocked=!0,j.isFalling=!1,j.isLoose=!1,j.fillAmount=0)},[]),v=g.useCallback((C,j)=>{if(!t)return;const P=r.current,R=c.current,S=P.length>0;if(j&&S)for(const M of P)M.isFalling&&!M.isLocked&&wm(M,C,j.fallSpeed,j.grid,Bt,j.tankRotation);if(S){gm(P,C,R,u.current);for(const M of P)if(M.isLocked&&M.fillAmount<1&&!(j!=null&&j.isPaused)){const J=1/(M.gridCells.length*go/1e3);M.fillAmount=Math.min(1,M.fillAmount+J*C);const se=M.fillAmount>=1;se&&!M.wasFullLastFrame&&vm(M,Fg),M.wasFullLastFrame=se}o.current=Sm(P,o.current,R),Cm(P,o.current,R),km(P,Et)}const T=R.dropletGravity,E=u.current;for(const M of a.current)M.vel.y+=T*C,M.pos.x+=M.vel.x*C,M.pos.y+=M.vel.y*C,(M.pos.x+M.radius<E.minX||M.pos.x-M.radius>E.maxX)&&(M.lifetime=0),M.pos.y+M.radius<E.minY&&(M.lifetime=0),M.pos.y+M.radius>E.maxY&&(M.pos.y=E.maxY-M.radius,M.vel.y*=-.3),M.lifetime-=C,M.opacity=Math.max(0,M.lifetime/M.maxLifetime),M.radius*=.995;a.current=a.current.filter(M=>M.lifetime>0&&M.opacity>.01)},[t]),k=g.useCallback(()=>{r.current=[],o.current=[],a.current=[]},[]),w=g.useCallback(C=>{const j=c.current,P=C.targetX,R=C.targetY;for(let S=0;S<j.dropletCount;S++){const T=Math.floor(Math.random()*C.vertices.length),E=C.vertices[T],M=E.pos.x-P,U=E.pos.y-R,J=Math.atan2(U,M)+(Math.random()-.5)*.8,se=j.dropletSpeed*(.5+Math.random()*.8),N={id:`droplet-${i.current++}`,pos:{x:E.pos.x,y:E.pos.y},vel:{x:Math.cos(J)*se,y:Math.sin(J)*se-50},radius:j.dropletSize*(.5+Math.random()*.7),color:C.color,opacity:1,lifetime:j.dropletLifetime*(.7+Math.random()*.6),maxLifetime:j.dropletLifetime};a.current.push(N)}},[]),m=g.useCallback(C=>r.current.find(j=>j.id===C),[]),h=g.useCallback(C=>{for(const j of r.current){const R=-(C-j.createdAtRotation)*Et;for(const S of j.vertices)S.pos.x+=R,S.oldPos.x+=R;for(const S of j.innerVertices)S.pos.x+=R,S.oldPos.x+=R;j.targetX+=R,j.createdAtRotation=C}},[]),x=g.useCallback(()=>{var R;const C=r.current.find(S=>S.isFalling&&!S.isLocked);if(!C)return null;let j=((R=C.gridCells[0])==null?void 0:R.y)??0;for(const S of C.gridCells)S.y<j&&(j=S.y);return{gridY:j+nt,isColliding:C.isColliding}},[]);return{blobs:r.current,attractionSprings:o.current,params:c.current,createBlob:f,removeBlob:d,updateBlobTarget:p,lockBlob:y,step:v,clearBlobs:k,getBlob:m,shiftBlobsForRotation:h,droplets:a.current,createDropletsForPop:w,getActivePieceState:x}}const Ur="";function Hf(e){let t=e;return()=>(t=t*1664525+1013904223&4294967295,(t>>>0)/4294967295)}function Wf(e){return e.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")}function Uf(e){const t=e.match(/[^a-zA-Z0-9]+$/);return t?t[0]:""}function Xf(e){const t=e.match(/^[^a-zA-Z0-9]+/);return t?t[0]:""}const zg=({fullText:e,keywords:t,revealed:n=!1,className:s="",visibleChars:r})=>{const o=g.useMemo(()=>{const u=t.map(y=>y.toLowerCase());if(e.includes("[")){const y=[],v=e.split(/\[([^\]]*)\]/);let k=0;for(let w=0;w<v.length;w++){const m=w%2===1,h=v[w];if(!h)continue;const x=h.split(/(\s+)/);for(const C of x){if(!C)continue;if(/^\s+$/.test(C)){y.push({isKeyword:!1,display:C,original:C,garbleLevel:"none"});continue}const j=Wf(C),P=Xf(C),R=Uf(C),S=!m&&u.includes(j.toLowerCase()),T=k++;if(n||S||!m){y.push({isKeyword:S,display:C,original:C,garbleLevel:"none"});continue}const E=Hf(T*7919+31),M=j.split("").map(()=>Ur[Math.floor(E()*Ur.length)]).join("");y.push({isKeyword:!1,display:P+M+R,original:C,garbleLevel:"garbled"})}}return y}const d=e.split(/(\s+)/);let p=0;return d.map(y=>{if(/^\s+$/.test(y))return{isKeyword:!1,display:y,original:y,garbleLevel:"none"};const v=Wf(y),k=Xf(y),w=Uf(y),m=u.includes(v.toLowerCase()),h=p++;if(n||m)return{isKeyword:m,display:y,original:y,garbleLevel:"none"};const x=Hf(h*7919+31),C=v.split("").map(()=>Ur[Math.floor(x()*Ur.length)]).join("");return{isKeyword:!1,display:k+C+w,original:y,garbleLevel:"garbled"}})},[e,t,n]),a=o.map(u=>u.display).join(""),i=r===void 0||r>=a.length;let c=0;return l.jsx("p",{className:`leading-relaxed ${s}`,children:o.map((u,f)=>{if(!i&&c>=r)return null;let d=u.display;if(!i){const y=r-c;d.length>y&&(d=d.slice(0,y))}if(c+=u.display.length,/^\s+$/.test(u.original))return l.jsx("span",{children:d},f);if(u.isKeyword)return l.jsx("span",{className:"text-green-400 font-semibold",children:d},f);const p=u.garbleLevel!=="none"?"text-slate-600":"text-slate-300";return l.jsx("span",{className:p,children:d},f)})})};const Yg=1,Hg=35,Wg=({message:e,onDismiss:t,onComplete:n,position:s="top",className:r="",advanceType:o,canDismiss:a=!0,trainingProgress:i})=>{const[c,u]=g.useState(0),[f,d]=g.useState(!1),p=g.useRef(null),y=e.fullText.length;g.useEffect(()=>(p.current=setInterval(()=>{u(m=>{const h=m+Yg;return h>=y?(p.current&&clearInterval(p.current),y):h})},Hg),()=>{p.current&&clearInterval(p.current)}),[y]),g.useEffect(()=>{c>=y&&d(!0)},[c,y]);const v=g.useCallback(()=>{f||(p.current&&clearInterval(p.current),u(y),d(!0))},[f,y]),k={top:"left-1/2 -translate-x-1/2",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",bottom:"bottom-12 left-1/2 -translate-x-1/2"},w=s==="top"?{top:"33%"}:{};return l.jsx("div",{className:`absolute ${k[s]} z-[90] ${r}`,style:{width:"min(calc(100vw - 24px), calc(100dvh * 0.5625 - 24px))",...w},onClick:v,onTouchStart:v,children:l.jsxs("div",{className:"bg-slate-900/95 border border-slate-700 rounded-sm shadow-lg shadow-black/50 overflow-hidden intercom-enter",children:[l.jsx("div",{className:"px-3 py-1.5 border-b border-slate-800 bg-slate-950/60",children:i?l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"t-caption text-slate-400 leading-tight truncate",children:i.phaseName}),l.jsx("span",{className:"t-caption text-slate-500 leading-tight flex-shrink-0 ml-2",children:i.stepProgress})]}),l.jsx("div",{className:"flex items-center justify-center gap-1.5 mt-1",children:i.phaseDots.map(m=>l.jsx("span",{className:`intercom-phase-dot intercom-phase-dot--${m.status}`,title:`Phase ${m.phase}`},m.phase))})]}):l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{className:"t-body text-slate-500 uppercase tracking-widest font-mono",children:"Intercom"}),l.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 intercom-blink"})]})}),l.jsx("div",{className:"px-3 py-2.5 t-display text-slate-300",children:l.jsx(zg,{fullText:e.fullText,keywords:e.keywords,visibleChars:c})}),f&&a&&l.jsx("div",{className:"px-3 py-3 border-t border-slate-800",children:o!=="tap"?l.jsx("button",{onClick:m=>{m.stopPropagation(),t()},className:"w-full h-12 flex items-center justify-center t-heading font-mono text-green-400 hover:text-green-300 border border-green-900 hover:border-green-700 rounded-sm transition-colors",children:""}):l.jsx("button",{onClick:m=>{m.stopPropagation(),n()},className:"w-full h-12 flex items-center justify-center t-heading font-mono text-green-400 hover:text-green-300 border border-green-900 hover:border-green-700 rounded-sm transition-colors",children:""})})]})})},Ug={},Xg=({activeStep:e,onComplete:t,onDismiss:n,highlightElement:s,messagePosition:r="center",advanceType:o,blockInteraction:a=!1,trainingProgress:i,canDismiss:c=!0})=>{const[u,f]=g.useState(null),[d,p]=g.useState(!1),y=g.useRef(null);if(g.useEffect(()=>(y.current&&(clearTimeout(y.current),y.current=null),e&&!u?(f(e),requestAnimationFrame(()=>p(!0))):e&&u?(p(!1),y.current=setTimeout(()=>{f(e),requestAnimationFrame(()=>p(!0))},160)):!e&&u&&(p(!1),y.current=setTimeout(()=>{f(null)},150)),()=>{y.current&&clearTimeout(y.current)}),[e]),!u)return null;const v=s?Ug[s]??null:null,k=v?{clipPath:`polygon(
          0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%,
          ${v.left}% ${v.top}%,
          ${v.left}% ${v.bottom}%,
          ${v.right}% ${v.bottom}%,
          ${v.right}% ${v.top}%,
          ${v.left}% ${v.top}%
        )`}:void 0;return l.jsxs("div",{className:`absolute inset-0 z-[90] ${a?"pointer-events-auto":"pointer-events-none"}`,style:{transition:"opacity 150ms ease-out, background-color 150ms ease-out",opacity:d?1:0,backgroundColor:a?"rgba(0, 0, 0, 0.35)":"transparent"},children:[v&&l.jsx("div",{className:"absolute inset-0",style:{backgroundColor:"rgba(0, 0, 0, 0.4)",...k,transition:"clip-path 300ms ease-out"}}),l.jsx("div",{className:"pointer-events-auto",children:l.jsx(Wg,{message:u.message,onDismiss:n,onComplete:t,position:r,advanceType:o,trainingProgress:i,canDismiss:c})})]})},Xr=[{id:"WELCOME",rank:0,trigger:{type:"ON_GAME_START",rank:0},message:{keywords:["Welcome","operator"],fullText:"Welcome aboard, operator."},autoAdvanceMs:4e3},{id:"ROTATE_INTRO",rank:0,trigger:{type:"ON_GAME_START",rank:0},message:{keywords:["Swipe","rotate","tank"],fullText:"Swipe left or right to rotate the tank."},requiresAction:"ROTATE"}],Vf={A1_WELCOME:{keywords:["Operator","training","periscope"],fullText:"[Your] Operator training [begins now]. Drag [the] periscope down [to] start."},B1_GOOP_FALLS:{keywords:["goop","tank"],fullText:"[The] extruder drops goop into [the] tank."},B2_FAST_DROP:{keywords:["slow","Swipe","S","fast-drop"],fullText:"[Yeah.] It's slow. Swipe down or [press] S [to] fast-drop."},B3_ROTATION:{keywords:["Rotate","Q/E","tap","left/right","tank"],fullText:"Rotate [with] Q/E or tap [the] left/right [side of the] tank."},B4_PRACTICE:{keywords:[],fullText:"[Do it] again."},C1_PRESSURE:{keywords:["Pressure"],fullText:"Pressure [builds] over time."},C2_POP:{keywords:["Tap","goop","pressure","pop"],fullText:"Tap goop below [the] pressure [line] to pop [it]."},C3_MERGE_SOLIDIFY:{keywords:["goop","merges","Bigger","vent","set"],fullText:"Same-color goop merges. Bigger [blobs] vent more. [Fresh goop] needs a moment to set."},C4_PRACTICE_POP:{keywords:["Pop"],fullText:"Pop [it]."},D1_CRACK:{keywords:["Cracks","tank","goop","seal"],fullText:"Cracks [form in the] tank [wall]. Drop matching [color] goop [on them] to seal."},D2_TANK_ROTATION:{keywords:["Swipe","left/right","A/D","spin","tank"],fullText:"Swipe left/right [or] A/D [to] spin [the] tank."},D3_OFFSCREEN:{keywords:["tank","Cracks"],fullText:"[You] only see 1/3 [of the] tank. Cracks [can] spawn anywhere."},E1_SCAFFOLDING:{keywords:["Cracks","pressure","goop","reach"],fullText:"Cracks [spawn] higher as [the] pressure builds. Stack goop [to] reach [them]."},F1_GRADUATION:{keywords:["basics","goop","high"],fullText:"[That] covers [the] basics. Don't [let the] goop [pile] too high."}},Hl={PRESSURE_CAP:{keywords:["Swipe up","leave training"],fullText:"[I've] stopped [the] pressure [so you can] practice. Swipe up [to] leave training."},OVERFLOW:{keywords:["Swipe up","end"],fullText:"[You] overflowed [the] tank! Training [is] over. Swipe up [to] end."}},Vg={D2_RETRY:{keywords:["tank","goop","crack","Spin"],fullText:"Try again! Spin [the] tank [to] align [the] goop with [the] crack."}},qg={A:"Enter the Tank",B:"Goop Basics",C:"Pressure & Popping",D:"Cracks & Sealing",E:"Scaffolding",F:"Graduation"},mr=[{id:"A1_WELCOME",phase:"A",name:"Welcome",teaches:"premise-and-entry",setup:{view:"console",pressureRate:0,highlightElement:"periscope",messagePosition:"top"},pauseGame:!0,advance:{type:"action",action:"drag-periscope"},markComplete:"WELCOME"},{id:"B1_GOOP_FALLS",phase:"B",name:"Goop Falls",teaches:"what-goop-is",setup:{view:"tank",spawnPiece:{color:tt.BLUE,shape:Me.T_I,rotation:1,autoFall:!0},pressureRate:0,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1,pop:!1},advanceAtRow:8},pauseGame:!1,advance:{type:"event",event:"piece-landed"}},{id:"B2_FAST_DROP",phase:"B",name:"Fast-Drop",teaches:"fast-drop-input",setup:{pressureRate:0,allowedControls:{fastDrop:!0,rotate:!1,tankRotate:!1,pop:!1}},pauseGame:!1,advance:{type:"event",event:"piece-landed"}},{id:"B3_ROTATION",phase:"B",name:"Rotation",teaches:"piece-rotation-input",setup:{spawnPiece:{color:tt.YELLOW,shape:Me.T_T},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:1200},pauseGame:!0,advance:{type:"event",event:"piece-landed"},markComplete:"DROP_INTRO"},{id:"B4_PRACTICE",phase:"B",name:"Practice",teaches:"practice-basics",setup:{spawnPiece:{color:tt.BLUE,shape:Me.T_O},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1}},pauseGame:!0,advance:{type:"event",event:"piece-landed"}},{id:"C1_PRESSURE",phase:"C",name:"Pressure Rises",teaches:"pressure-concept",setup:{pressureRate:2.5,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1,pop:!1},advanceWhenPressureAbovePieces:!0,advancePressureAboveColor:tt.YELLOW,autoSkipMs:1e4},pauseGame:!0,advance:{type:"auto",delayMs:6e4}},{id:"C2_POP",phase:"C",name:"Pop",teaches:"how-to-pop",setup:{pressureRate:0,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1},highlightGoopColor:tt.YELLOW,reshowAfterMs:3e3,reshowNonDismissible:!0,popLowersPressure:!0},pauseGame:!1,advance:{type:"action",action:"pop-goop"}},{id:"C3_MERGE_SOLIDIFY",phase:"C",name:"Merge & Solidify",teaches:"merge-and-fill-timing",setup:{pressureRate:.3125,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:1500},pauseGame:!0,advance:{type:"tap"},markComplete:"POP_TIMING"},{id:"C4_PRACTICE_POP",phase:"C",name:"Practice Pop",teaches:"second-pop-rep",setup:{pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1},highlightGoopColor:tt.BLUE,messageDelay:2e3,popLowersPressure:!0},pauseGame:!1,advance:{type:"action",action:"pop-goop"}},{id:"D1_CRACK",phase:"D",name:"Crack Appears",teaches:"crack-sealing",setup:{spawnCrack:{color:tt.GREEN,placement:"near-stack",row:22},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:2500},pauseGame:!0,advance:{type:"tap"},markComplete:"CRACK_INTRO"},{id:"D2_TANK_ROTATION",phase:"D",name:"Tank Rotation",teaches:"tank-rotation-input",setup:{spawnPiece:{color:tt.GREEN,shape:Me.T_O},pressureRate:.46875,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},showWhenPieceBelow:8,retryOnPieceLand:{retryMessageId:"D2_RETRY",spawnExtraCrack:{color:tt.GREEN,placement:"near-stack"}},popLowersPressure:!0},pauseGame:!0,advance:{type:"event",event:"crack-sealed"},markComplete:"ROTATE_INTRO"},{id:"D3_OFFSCREEN",phase:"D",name:"Offscreen Cracks",teaches:"cylindrical-awareness",setup:{spawnCrack:{color:tt.GREEN,placement:"near-stack"},pressureRate:.46875,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},showWhenCracksOffscreen:!0,autoSkipMs:15e3,popLowersPressure:!0},pauseGame:!0,advance:{type:"tap"},markComplete:"WRAP_INTRO"},{id:"E1_SCAFFOLDING",phase:"E",name:"Build Scaffolding",teaches:"scaffolding-strategy",setup:{spawnCrack:{color:tt.GREEN,placement:"at-pressure-line"},pressureRate:.46875,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},messagePosition:"top",continuousSpawn:!0,autoSkipMs:9e4,popLowersPressure:!0},pauseGame:!0,advance:{type:"event",event:"crack-sealed"}},{id:"F1_GRADUATION",phase:"F",name:"Graduation",teaches:"free-play",setup:{pressureRate:.5,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},messagePosition:"top",continuousSpawn:!0,pressureCap:.95,periodicCrackIntervalMs:1e4,popLowersPressure:!0},pauseGame:!0,advance:{type:"action",action:"swipe-up"},markComplete:"FIRST_SHIFT"}];function Kg(e){return mr.find(t=>!e.includes(t.id))??null}function sc(e){return mr.every(t=>e.includes(t.id))}function Zg(e){return mr.filter(t=>t.phase===e)}const Qg=({rank:e,isSessionActive:t,saveData:n,setSaveData:s})=>{var y;const[r,o]=g.useState(()=>{var v;return{activeStep:null,completedSteps:((v=n.tutorialProgress)==null?void 0:v.completedSteps)??[],dismissed:!1}}),a=g.useRef(r.completedSteps);a.current=r.completedSteps;const i=r.activeStep?Xr.find(v=>v.id===r.activeStep)??null:null,c=g.useCallback(v=>r.completedSteps.includes(v),[r.completedSteps]),u=g.useCallback(v=>{a.current.includes(v.id)||o(k=>k.activeStep!==null||k.completedSteps.includes(v.id)?k:(pe.emit(ae.TUTORIAL_STEP_TRIGGERED,{stepId:v.id,message:v.message}),{...k,activeStep:v.id,dismissed:!1}))},[]),f=g.useCallback(()=>{o(v=>{if(!v.activeStep)return v;const k=v.activeStep,w=[...v.completedSteps,k];return pe.emit(ae.TUTORIAL_STEP_COMPLETED,{stepId:k}),s(m=>({...m,tutorialProgress:{completedSteps:w}})),{activeStep:null,completedSteps:w,dismissed:!1}})},[s]),d=g.useCallback(()=>{o(v=>v.activeStep?(pe.emit(ae.TUTORIAL_STEP_DISMISSED,{stepId:v.activeStep}),{...v,activeStep:null,dismissed:!0}):v)},[]),p=e===0&&!sc(((y=n.tutorialProgress)==null?void 0:y.completedSteps)??[]);return g.useEffect(()=>{if(p)return;const v=Xr.filter(k=>k.trigger.type==="ON_RANK_REACH"&&k.trigger.rank===e);for(const k of v)u(k)},[e,u,p]),g.useEffect(()=>{if(p||!t)return;const v=Xr.filter(k=>k.trigger.type==="ON_GAME_START"&&k.trigger.rank===e);for(const k of v)u(k)},[t,e,u,p]),g.useEffect(()=>{if(p)return;const k=Xr.filter(w=>w.trigger.type==="ON_EVENT").map(w=>{const m=w.trigger.event;return pe.on(m,()=>{u(w)})});return()=>{k.forEach(w=>w())}},[u,p]),{activeStep:i,completeStep:f,dismissStep:d,isStepCompleted:c,tutorialState:r}},qf={"fast-fall":[ae.INPUT_FAST_DROP],"rotate-piece":[ae.PIECE_ROTATED],"pop-goop":[ae.GOOP_POPPED],"rotate-tank":[ae.INPUT_DRAG],"swipe-up":[ae.INPUT_SWIPE_UP],"piece-landed":[ae.PIECE_DROPPED],"goop-merged":[ae.PIECE_DROPPED],"crack-sealed":[ae.GOAL_CAPTURED],"game-over":[ae.GAME_OVER]},Jg=4e3,oc=[tt.BLUE,tt.YELLOW,tt.GREEN,tt.RED];function rc(e,t,n,s,r){const o=Date.now(),a=Math.random().toString(36).substr(2,9);console.log(`[CRACK] SPAWN id=${a} at (${t}, ${n}) color=${s} source="${r}" time=${new Date(o).toLocaleTimeString()} totalCracks=${e.state.crackCells.length+1}`),e.state.crackCells.push({id:a,x:t,y:n,color:s,originCrackId:[],branchCrackIds:[],lastGrowthCheck:o,crackBranchInterval:999999,spawnTime:o}),e.state.goalMarks.push({id:a,x:t,y:n,color:s,spawnTime:o})}function ev(e,t){var r,o,a;const n=e.state.grid,s=e.state.tankRotation;if(t.placement==="near-stack"){const i=rt-3,c=Ve(s+i),u=t.row??Ne-2;return{x:c,y:u}}if(t.placement==="high"||t.placement==="at-pressure-line"){const i=e.maxTime??1,u=1+Math.max(0,1-e.state.shiftTime/i)*(Bt-1),f=Math.floor(Ne-u),d=1+Math.floor(Math.random()*3),p=Math.max(nt,Math.min(Ne-1,f+d));for(let y=0;y<30;y++){const v=2+Math.floor(Math.random()*(rt-4)),k=Ve(s+v);if(((r=n[p])==null?void 0:r[k])===null)return{x:k,y:p}}return null}if(t.placement==="offscreen"||t.placement==="high-offscreen"){const i=[];for(let c=0;c<Re;c++)((c-s)%Re+Re)%Re>=rt&&i.push(c);if(i.length>0){const c=t.placement==="high-offscreen"?{min:nt,max:nt+4}:{min:Ne-6,max:Ne-1};for(let u=0;u<30;u++){const f=i[Math.floor(Math.random()*i.length)],d=c.min+Math.floor(Math.random()*(c.max-c.min+1));if(((o=n[d])==null?void 0:o[f])===null)return{x:f,y:d}}}return null}for(let i=0;i<30;i++){const c=Math.floor(Math.random()*rt),u=Ve(s+c),f=Ne-5+Math.floor(Math.random()*3);if(f>=nt&&f<Ne&&((a=n[f])==null?void 0:a[u])===null)return{x:u,y:f}}return null}function Kf(e,t){const s=[...bs,...cl,...ul].find(a=>a.type===t.shape);if(!s)return;let r=s.cells.map(a=>({...a}));if(t.rotation&&t.rotation>0)for(let a=0;a<t.rotation;a++)r=b0(r,!0);const o={type:t.shape,cells:r,color:t.color};e.spawnNewPiece(o)}function tv(e){var u;const t=e.state.tankRotation,n=oc[Math.floor(Math.random()*oc.length)],s=e.maxTime??1,r=Math.max(0,1-e.state.shiftTime/s),o=1+r*(Bt-1),a=Math.floor(Ne-o),i=1+Math.floor(Math.random()*3),c=Math.max(nt,Math.min(Ne-1,a+i));console.log(`[CRACK] PRESSURE DEBUG: psi=${(r*100).toFixed(1)}% shiftTime=${e.state.shiftTime.toFixed(1)} maxTime=${s} waterHeight=${o.toFixed(1)} pressureLine=row${a} offset=${i} spawnY=row${c}`);for(let f=0;f<20;f++){const d=Math.floor(Math.random()*rt),p=Ve(t+d),y=(u=e.state.grid[c])==null?void 0:u[p],v=e.state.crackCells.some(k=>k.x===p&&k.y===c);if(y===null&&!v){rc(e,p,c,n,"periodic-F1"),e.emitChange();return}}}function Zf(e){const t=e.state.crackCells;if(t.length===0)return!1;const n=e.state.tankRotation;return t.some(s=>{let r=s.x-n;return r>Re/2&&(r-=Re),r<-Re/2&&(r+=Re),r<0||r>=rt})}const nv=({saveData:e,setSaveData:t,gameEngine:n,rank:s})=>{var ve,Pe,be;const r=((ve=e.tutorialProgress)==null?void 0:ve.completedSteps)??[],o=sc(r),a=s===0&&!o,i=a?Kg(r):null,[c,u]=g.useState(!0),[f,d]=g.useState(!0),[p,y]=g.useState(null),v=g.useRef(!0),k=g.useRef(null),w=g.useRef(null),m=g.useRef(null),h=g.useRef(!1),x=g.useRef(null),C=g.useRef(null),j=g.useRef(null),P=g.useRef(null),R=g.useRef(!1),S=g.useRef(!1),T=g.useRef(!1),E=g.useRef(!1),M=g.useRef("none"),U=g.useRef(null),J=g.useRef([]),se=g.useRef(r);se.current=r,g.useEffect(()=>{var X,W,fe,ie,le,q,ke,Ce,je,De,Fe;if(console.log(`[STEP] === STEP CHANGE === ${(i==null?void 0:i.id)??"null"} (${(i==null?void 0:i.name)??""}) at ${new Date().toLocaleTimeString()}`),w.current&&(clearTimeout(w.current),w.current=null),x.current&&(clearInterval(x.current),x.current=null),k.current&&(clearTimeout(k.current),k.current=null),C.current&&(clearTimeout(C.current),C.current=null),j.current&&(j.current(),j.current=null),P.current&&(clearInterval(P.current),P.current=null),U.current&&(clearInterval(U.current),U.current=null),J.current.forEach(Te=>clearTimeout(Te)),J.current=[],h.current=!1,d(!0),y(null),R.current=!1,E.current=!1,T.current=!1,M.current="none",!i)return;const A=i.pauseGame!==!1&&(((X=i.setup)==null?void 0:X.pauseDelay)!=null||((W=i.setup)==null?void 0:W.showWhenPieceBelow)!=null||((fe=i.setup)==null?void 0:fe.showWhenCracksOffscreen));if(v.current=i.pauseGame===!1&&!A,n&&n.isSessionActive&&(A?(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange()):i.pauseGame!==!1?(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()):(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange()),(ie=i.setup)!=null&&ie.spawnPiece&&Kf(n,i.setup.spawnPiece),(le=i.setup)!=null&&le.spawnCrack)){n.state.crackCells.length>0&&console.log(`[CRACK] CLEAR ALL  ${n.state.crackCells.length} cracks removed before spawning for ${i.id}`),n.state.crackCells=[],n.state.goalMarks=[];const Te=ev(n,i.setup.spawnCrack);Te&&(rc(n,Te.x,Te.y,i.setup.spawnCrack.color,`step-setup[${i.id}]`),n.emitChange())}const G=(q=i.setup)==null?void 0:q.showWhenPieceBelow;return G!=null&&n?(u(!1),x.current=setInterval(()=>{var ze;(((ze=n.state.activeGoop)==null?void 0:ze.y)??0)>=G&&(u(!0),x.current&&(clearInterval(x.current),x.current=null),i.pauseGame!==!1&&(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()))},200)):(ke=i.setup)!=null&&ke.showWhenCracksOffscreen&&n?(u(!1),P.current=setInterval(()=>{Zf(n)&&(P.current&&(clearInterval(P.current),P.current=null),T.current=!0,u(!0),i.pauseGame!==!1&&(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()))},200)):((Ce=i.setup)==null?void 0:Ce.pauseDelay)!=null?(u(!1),w.current=setTimeout(()=>{n&&n.isSessionActive&&(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange()),u(!0),w.current=null},i.setup.pauseDelay)):i.pauseGame===!1?(je=i.setup)!=null&&je.messageDelay&&((De=i.setup)!=null&&De.showOnInput)?(u(!1),h.current=!0,w.current=setTimeout(()=>{h.current&&(u(!0),h.current=!1),w.current=null},i.setup.messageDelay)):(Fe=i.setup)!=null&&Fe.messageDelay?(u(!1),w.current=setTimeout(()=>{u(!0),w.current=null},i.setup.messageDelay)):u(!0):(u(!1),w.current=setTimeout(()=>{u(!0),w.current=null},400)),()=>{w.current&&(clearTimeout(w.current),w.current=null),x.current&&(clearInterval(x.current),x.current=null),k.current&&(clearTimeout(k.current),k.current=null),C.current&&(clearTimeout(C.current),C.current=null),j.current&&(j.current(),j.current=null),P.current&&(clearInterval(P.current),P.current=null),U.current&&(clearInterval(U.current),U.current=null)}},[i==null?void 0:i.id]),g.useEffect(()=>{n&&(a?n.pendingTrainingPalette=oc:n.pendingTrainingPalette=null)},[n,a]);const N=g.useCallback(()=>{if(!i)return;const A=i.id;t(G=>{var fe;const X=((fe=G.tutorialProgress)==null?void 0:fe.completedSteps)??[];if(X.includes(A))return G;const W=[...X,A];return i.markComplete&&!X.includes(i.markComplete)&&W.push(i.markComplete),{...G,tutorialProgress:{completedSteps:W}}})},[i,t]),Y=g.useCallback(()=>{if(n&&m.current){const A=Date.now()-m.current,G=n.state.grid;for(let X=0;X<G.length;X++)for(let W=0;W<G[X].length;W++){const fe=G[X][W];fe&&fe.timestamp&&(fe.timestamp+=A)}m.current=null}},[n]),ee=g.useCallback(()=>{if(!i)return;v.current=!1,Y(),N(),n&&n.isSessionActive&&(n.state.isPaused=!0,n.freezeFalling=!0,n.emitChange());const A=[...se.current,i.id];i.markComplete&&A.push(i.markComplete),sc(A)&&(pe.emit(ae.TRAINING_SCENARIO_COMPLETE),n&&(n.pendingTrainingPalette=null))},[Y,N,i,n]),B=g.useRef(ee);B.current=ee;const Q=g.useCallback(()=>{var A,G,X,W,fe,ie;if(M.current==="pressure-cap"&&!E.current){if(u(!1),y(null),M.current="none",Y(),n&&n.isSessionActive){n.state.isPaused=!1,n.freezeFalling=!1,((A=i==null?void 0:i.setup)==null?void 0:A.pressureRate)!=null&&(n.trainingPressureRate=i.setup.pressureRate),n.emitChange(),n.state.activeGoop||setTimeout(()=>{n.isSessionActive&&M.current==="none"&&(n.spawnNewPiece(),n.emitChange())},300);const le=((G=i==null?void 0:i.setup)==null?void 0:G.pressureCap)??.95;let q=!1;const ke=setInterval(()=>{if(M.current!=="none"){clearInterval(ke);return}const Ce=n.maxTime??1,je=Ce>0?Math.max(0,1-n.state.shiftTime/Ce):0;je<le?q=!0:q&&je>=le&&(clearInterval(ke),n.trainingPressureRate=0,n.emitChange(),M.current="pressure-cap",y(Hl.PRESSURE_CAP),u(!0),d(!0),v.current=!0,n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange())},250)}return}if(E.current){E.current=!1,y(null),u(!1),Y(),n&&n.isSessionActive&&(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),(X=i==null?void 0:i.setup)!=null&&X.continuousSpawn&&!n.state.activeGoop&&setTimeout(()=>{n.isSessionActive&&!n.state.isPaused&&(n.spawnNewPiece(),n.emitChange())},300));return}if(u(!1),Y(),n&&n.isSessionActive&&(n.state.isPaused=!1,n.freezeFalling=!1,((W=i==null?void 0:i.setup)==null?void 0:W.pressureRate)!=null&&(n.trainingPressureRate=i.setup.pressureRate),n.emitChange()),k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{v.current=!0,k.current=null},150),(fe=i==null?void 0:i.setup)!=null&&fe.continuousSpawn&&n&&(setTimeout(()=>{n.isSessionActive&&M.current==="none"&&(n.spawnNewPiece(),n.emitChange())},300),i.setup.periodicCrackIntervalMs&&(console.log(`[CRACK] PERIODIC TIMER STARTED  interval=${i.setup.periodicCrackIntervalMs}ms step=${i.id}`),U.current&&clearInterval(U.current),U.current=setInterval(()=>{if(M.current!=="none"){console.log(`[CRACK] PERIODIC SKIPPED  f1Ending=${M.current}`);return}n.isSessionActive&&(console.log("[CRACK] PERIODIC TICK  spawning random crack"),tv(n))},i.setup.periodicCrackIntervalMs))),C.current&&clearTimeout(C.current),(ie=i==null?void 0:i.setup)!=null&&ie.reshowAfterMs){const le=!!i.setup.reshowNonDismissible,q=i.setup.reshowAfterMs;C.current=setTimeout(()=>{n&&n.isSessionActive&&(le?(n.trainingPressureRate=0,n.emitChange(),u(!0),d(!1)):(n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange(),u(!0),v.current=!1)),C.current=null},q)}},[Y,n,i]);g.useEffect(()=>{var ie,le,q,ke,Ce,je,De,Fe,Te,ze;if(!i||!a)return;const{advance:A}=i,G=[];if((ie=i.setup)!=null&&ie.showOnInput){const ye=()=>{h.current&&(u(!0),h.current=!1)};document.addEventListener("pointerdown",ye,!0),document.addEventListener("touchstart",ye,!0),document.addEventListener("keydown",ye,!0),G.push(()=>{document.removeEventListener("pointerdown",ye,!0),document.removeEventListener("touchstart",ye,!0),document.removeEventListener("keydown",ye,!0)})}if(((le=i.setup)==null?void 0:le.advanceAtRow)!=null&&n){const ye=i.setup.advanceAtRow,I=setInterval(()=>{var he;(((he=n.state.activeGoop)==null?void 0:he.y)??0)>=ye&&v.current&&(clearInterval(I),B.current())},150);G.push(()=>clearInterval(I))}if(((q=i.setup)==null?void 0:q.reshowAtRow)!=null&&n){const ye=i.setup.reshowAtRow,I={current:!1};if(i.setup.reshowUntilAction){const he=qf[i.setup.reshowUntilAction];if(he){const xe=he.map(D=>pe.on(D,()=>{I.current=!0}));G.push(()=>xe.forEach(D=>D()))}}const z=setInterval(()=>{if(I.current||n.isFastDropping){clearInterval(z);return}if(!n.state.activeGoop){clearInterval(z);return}(n.state.activeGoop.y??0)>=ye&&(clearInterval(z),n.state.isPaused=!0,n.freezeFalling=!0,n.emitChange(),u(!0),v.current=!1)},150);G.push(()=>clearInterval(z))}if(((ke=i.setup)==null?void 0:ke.advanceAtPressure)!=null&&n){const ye=i.setup.advanceAtPressure/100,I=setInterval(()=>{if(!v.current)return;const z=n.maxTime??1;(z>0?Math.max(0,1-n.state.shiftTime/z):0)>=ye&&(clearInterval(I),B.current())},250);G.push(()=>clearInterval(I))}if((Ce=i.setup)!=null&&Ce.advanceWhenPressureAbovePieces&&n){const ye=setInterval(()=>{var L;if(!v.current)return;const I=n.maxTime??1,z=I>0?Math.max(0,1-n.state.shiftTime/I):0,he=Ne-1-z*(Bt-1),xe=((L=i.setup)==null?void 0:L.advancePressureAboveColor)??null;let D=Ne;for(let F=0;F<Ne;F++){for(let H=0;H<n.state.grid[F].length;H++){const ne=n.state.grid[F][H];if(ne!==null&&(xe===null||ne.color===xe)){D=F;break}}if(D<Ne)break}he<D&&(clearInterval(ye),B.current())},250);G.push(()=>clearInterval(ye))}if((je=i.setup)!=null&&je.retryOnPieceLand&&n){const ye=i.setup.retryOnPieceLand,I=pe.on(ae.GOAL_CAPTURED,()=>{R.current=!0});G.push(I);const z=pe.on(ae.PIECE_DROPPED,()=>{if(R.current){R.current=!1;return}const he=setTimeout(()=>{if(n.state.activeGoop)return;n.state.isPaused=!1,n.freezeFalling=!1,n.trainingPressureRate=0,n.emitChange();const xe=setTimeout(()=>{n.freezeFalling=!0;const D=n.state.grid;for(let F=0;F<D.length;F++)for(let H=0;H<D[F].length;H++){const ne=D[F][H];ne&&(n.state.poppedGoopGroupIds.add(ne.goopGroupId),D[F][H]=null)}n.emitChange();const L=setTimeout(()=>{var H;if(ye.spawnExtraCrack){const ne=ye.spawnExtraCrack.color,we=n.state.tankRotation;for(let b=0;b<30;b++){const _=Math.floor(Math.random()*rt),O=Ve(we+_),$=Ne-1-Math.floor(Math.random()*2);if(!n.state.crackCells.some(te=>te.x===O&&te.y===$)){rc(n,O,$,ne,"retry-extra-crack");break}}}n.state.isPaused=!0,m.current=Date.now();const F=Vg[ye.retryMessageId];F&&y(F),u(!0),v.current=!1,(H=i.setup)!=null&&H.spawnPiece&&Kf(n,i.setup.spawnPiece),n.emitChange(),R.current=!1},2e3);J.current.push(L)},2e3);J.current.push(xe)},0);J.current.push(he)});G.push(z)}if((De=i.setup)!=null&&De.autoSkipMs){const ye=setTimeout(()=>{i.id==="D3_OFFSCREEN"&&!T.current&&(S.current=!0),B.current()},i.setup.autoSkipMs);G.push(()=>clearTimeout(ye))}if((Fe=i.setup)!=null&&Fe.continuousSpawn&&n){const ye=pe.on(ae.PIECE_DROPPED,()=>{M.current==="none"&&setTimeout(()=>{n.state.activeGoop||(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),setTimeout(()=>{n.isSessionActive&&!n.state.isPaused&&!n.state.activeGoop&&(n.spawnNewPiece(),n.emitChange())},300))},0)});G.push(ye)}if(((Te=i.setup)==null?void 0:Te.pressureCap)!=null&&n){const ye=i.setup.pressureCap,I=setInterval(()=>{const z=n.maxTime??1,he=z>0?Math.max(0,1-n.state.shiftTime/z):0;he>=ye&&(clearInterval(I),n.trainingPressureRate=0,n.emitChange(),i.id==="F1_GRADUATION"&&M.current==="none"&&(console.log(`[F1] PRESSURE CAP reached (${(he*100).toFixed(1)}%)  showing ending message`),M.current="pressure-cap",y(Hl.PRESSURE_CAP),u(!0),d(!0),v.current=!0))},250);G.push(()=>clearInterval(I))}if(i.id==="F1_GRADUATION"&&n){const ye=()=>{M.current==="none"&&(console.log("[F1] OVERFLOW detected  showing ending message"),M.current="overflow",n.state.isPaused=!0,n.freezeFalling=!0,n.trainingPressureRate=0,n.emitChange(),y(Hl.OVERFLOW),u(!0),d(!1),v.current=!0)},I=pe.on(ae.GAME_OVER,ye);G.push(I)}const X=["D2_TANK_ROTATION","E1_SCAFFOLDING","F1_GRADUATION"];if(!T.current&&n&&i.id!=="D3_OFFSCREEN"&&X.includes(i.id)&&n.state.crackCells.length>0){const ye=setInterval(()=>{E.current||M.current==="none"&&(n.state.isPaused||Zf(n)&&(clearInterval(ye),T.current=!0,S.current=!1,E.current=!0,y(Vf.D3_OFFSCREEN),u(!0),n.state.isPaused=!0,n.freezeFalling=!0,m.current=Date.now(),n.emitChange(),t(I=>{var xe;const z=((xe=I.tutorialProgress)==null?void 0:xe.completedSteps)??[];if(z.includes("D3_OFFSCREEN"))return I;const he=[...z,"D3_OFFSCREEN"];return z.includes("WRAP_INTRO")||he.push("WRAP_INTRO"),{...I,tutorialProgress:{completedSteps:he}}})))},200);G.push(()=>clearInterval(ye))}if(A.type==="tap")return G.length>0?()=>G.forEach(ye=>ye()):void 0;if(A.type==="auto"){const ye=setTimeout(()=>{B.current()},A.delayMs);return G.push(()=>clearTimeout(ye)),()=>G.forEach(I=>I())}let W;if(A.type==="action"){if(A.action==="drag-periscope"){const ye=pe.on(ae.GAME_START,()=>{v.current&&B.current()});return G.push(ye),()=>G.forEach(I=>I())}if(A.action==="swipe-up"){const ye=pe.on(ae.INPUT_SWIPE_UP,()=>{v.current&&M.current!=="none"&&B.current()});return G.push(ye),()=>G.forEach(I=>I())}W=A.action}else A.type==="event"&&(W=A.event);const fe=W?qf[W]:void 0;if(fe&&fe.length>0){const ye=fe.map(I=>pe.on(I,()=>{v.current&&B.current()}));G.push(()=>ye.forEach(I=>I()))}else if(!((ze=i.setup)!=null&&ze.advanceAtRow)){const ye=setTimeout(()=>{B.current()},Jg);G.push(()=>clearTimeout(ye))}return()=>G.forEach(ye=>ye())},[i==null?void 0:i.id,a]),g.useEffect(()=>{var A;n&&(a&&((A=i==null?void 0:i.setup)!=null&&A.allowedControls)?n.trainingAllowedControls=i.setup.allowedControls:n.trainingAllowedControls=null)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>{var A;n&&(a&&((A=i==null?void 0:i.setup)==null?void 0:A.pressureRate)!=null?n.trainingPressureRate=i.setup.pressureRate:n.trainingPressureRate=0)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>{var A;n&&(a&&((A=i==null?void 0:i.setup)!=null&&A.highlightGoopColor)?n.trainingHighlightColor=i.setup.highlightGoopColor:n.trainingHighlightColor=null)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>{var A;n&&(a&&((A=i==null?void 0:i.setup)!=null&&A.popLowersPressure)?n.trainingPopLowersPressure=!0:n.trainingPopLowersPressure=!1)},[n,i==null?void 0:i.id,a]),g.useEffect(()=>pe.on(ae.TRAINING_SCENARIO_COMPLETE,()=>{n&&(n.isTrainingMode=!1,n.pendingTrainingPalette=null,n.trainingAllowedControls=null,n.trainingPressureRate=0,n.trainingHighlightColor=null,n.freezeFalling=!1,n.trainingPopLowersPressure=!1,n.state.crackCells=[],n.state.goalMarks=[],n.state.shiftScore=0,n.state.goalsCleared=0,n.state.isPaused=!1,n.isSessionActive=!1,n.state.phase=qe.ConsoleScreen,n.emitChange(),t(G=>({...G,careerRank:1,careerScore:en(1)})))}),[n,t]);const K=i&&c?{message:p??Vf[i.id]??{keywords:[],fullText:i.name}}:null,re=((Pe=i==null?void 0:i.setup)==null?void 0:Pe.messagePosition)??"center",oe=a&&((be=i==null?void 0:i.setup)==null?void 0:be.highlightGoopColor)||null;return{currentStep:i,isInTraining:a,isTrainingDone:o,completedStepIds:r,advanceStep:ee,dismissMessage:Q,trainingDisplayStep:K,messagePosition:re,highlightColor:oe,canDismiss:f}},sv=({onExit:e,onRunComplete:t,initialTotalScore:n,powerUps:s={},scraps:r,settings:o,onOpenSettings:a,onOpenHelp:i,onOpenUpgrades:c,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,equippedActives:p=[],onToggleEquip:y,saveData:v,setSaveData:k})=>{var ce,it,lt,Rt;const[w,m]=g.useState(!1),[h,x]=g.useState(!1),[C,j]=g.useState(tt.RED),[P,R]=g.useState(!0),[S,T]=g.useState({...zi}),[E,M]=g.useState(.2),[U,J]=g.useState(!1),[se,N]=g.useState(5),[Y,ee]=g.useState(40),[B,Q]=g.useState(-11),[K,re]=g.useState(5),[oe,ve]=g.useState(40),[Pe,be]=g.useState(-11),A=Bg({enabled:!0,params:S}),G=g.useCallback((de,ue)=>{if(ue.state.gameOver||!ue.isSessionActive)return;const Ue={grid:ue.state.grid,tankRotation:ue.state.tankRotation,fallSpeed:ue.freezeFalling?0:ue.getFallSpeed(),isPaused:ue.state.isPaused};A.step(de,Ue);const He=ue.state.activeGoop;if(He){const Ge=`active-${He.spawnTimestamp}`,Ze=A.getBlob(Ge);if(Ze&&Ze.isFalling&&!Ze.isLocked){const Qe=A.getActivePieceState();Qe&&ue.syncActivePieceFromPhysics(Qe.isColliding,Qe.gridY)}}},[A]),{engine:X,gameState:W}=$g(n,s,t,p,G);g.useEffect(()=>{X.usePhysicsForFalling=!vn},[X]);const fe=g.useCallback(de=>{X.execute(new ng(de))},[X]),ie=g.useRef(new Set),le=g.useRef(0),q=g.useRef(0),ke=g.useRef(null),Ce=g.useRef(!1),je=g.useRef(null),De=g.useRef(null),Fe=250,ze=1500-((s==null?void 0:s.GOOP_SWAP)||0)*250,ye=W.complications.find(de=>de.type===Ie.CONTROLS),I=g.useRef(0);g.useEffect(()=>{ye||(I.current=0)},[ye==null?void 0:ye.id]);const z=o.invertRotation?-1:1;g.useEffect(()=>{if(W.gameOver&&W.phase===qe.ConsoleScreen){const de=W.goalsCleared>=W.goalsTarget;t({score:W.shiftScore,won:de})}},[W.gameOver]);const he=g.useCallback(()=>{Ce.current=!1,ke.current&&(cancelAnimationFrame(ke.current),ke.current=null)},[]),xe=g.useCallback(()=>{De.current&&(clearInterval(De.current),De.current=null),je.current=null,pe.emit(ae.INPUT_SWAP_HOLD,{progress:-1})},[]),D=g.useCallback(()=>{De.current||(je.current=Date.now(),pe.emit(ae.INPUT_SWAP_HOLD,{progress:0}),De.current=window.setInterval(()=>{if(!je.current)return;const de=Date.now()-je.current;if(de<Fe)return;const ue=de-Fe,Ue=Math.min(100,ue/ze*100);pe.emit(ae.INPUT_SWAP_HOLD,{progress:Ue}),Ue>=100&&(pe.emit(ae.INPUT_SWAP),xe())},16))},[xe]),L=g.useCallback(()=>{if(Ce.current)return;Ce.current=!0;const de=()=>{if(!Ce.current)return;const ue=Date.now(),Ue=ye?200:100;if(ue>=q.current){let Ge=0;(ie.current.has("ArrowLeft")||ie.current.has("KeyA"))&&(Ge=1*z),(ie.current.has("ArrowRight")||ie.current.has("KeyD"))&&(Ge=-1*z),le.current!==0&&(Ge=le.current*z),Ge!==0&&(ye?(I.current++,I.current>=2&&(X.execute(new zr(Ge)),I.current=0)):X.execute(new zr(Ge)),q.current=ue+Ue)}(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||le.current!==0)&&W.phase===qe.TankScreen&&!X.state.isPaused&&X.isSessionActive?ke.current=requestAnimationFrame(de):he()};ke.current=requestAnimationFrame(de)},[X,W.phase,he,z,ye]);g.useEffect(()=>{const de=He=>{if(!He.repeat){if(ie.current.add(He.code),He.key==="`"){He.preventDefault(),m(Ge=>!Ge);return}if(He.key==="~"){He.preventDefault(),x(Ge=>!Ge);return}if(He.key==="Backspace"&&W.phase===qe.TankScreen&&X.execute(new Hs(qe.ConsoleScreen)),W.gameOver){He.key==="Enter"&&X.resetSession();return}if(W.phase===qe.TankScreen&&!X.state.isPaused&&X.isSessionActive)switch(He.code){case"ArrowLeft":case"KeyA":X.execute(new zr(1*z)),q.current=Date.now()+250,L();break;case"ArrowRight":case"KeyD":X.execute(new zr(-1*z)),q.current=Date.now()+250,L();break;case"KeyQ":X.execute(new Oo(!1));break;case"KeyE":X.execute(new Oo(!0));break;case"KeyS":X.execute(new Gl(!0));break;case"Space":X.execute(new Hs(qe.ConsoleScreen));break;case"KeyW":X.execute(new Hs(qe.ConsoleScreen));break;case"KeyR":D();break}}},ue=He=>{if(ie.current.delete(He.code),W.phase===qe.TankScreen)switch(He.code){case"KeyS":X.execute(new Gl(!1));break;case"KeyR":xe();break;case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":!(ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD"))&&le.current===0&&he();break}},Ue=He=>{W.phase===qe.TankScreen&&!X.state.isPaused&&!W.gameOver&&X.isSessionActive&&(He.deltaY>0?X.execute(new Oo(!0)):X.execute(new Oo(!1)))};return window.addEventListener("keydown",de),window.addEventListener("keyup",ue),window.addEventListener("wheel",Ue),()=>{window.removeEventListener("keydown",de),window.removeEventListener("keyup",ue),window.removeEventListener("wheel",Ue),he(),xe()}},[X,W.phase,W.gameOver,L,he,D,xe,z]),g.useEffect(()=>{const de=pe.on(ae.INPUT_ROTATE,Qe=>{X.execute(new Oo((Qe==null?void 0:Qe.clockwise)??!0))}),ue=pe.on(ae.INPUT_DRAG,Qe=>{le.current=(Qe==null?void 0:Qe.direction)??0,(Qe==null?void 0:Qe.direction)!==0?L():ie.current.has("ArrowLeft")||ie.current.has("ArrowRight")||ie.current.has("KeyA")||ie.current.has("KeyD")||he()}),Ue=pe.on(ae.INPUT_SWIPE_UP,()=>{X.execute(new Hs(qe.ConsoleScreen))}),He=pe.on(ae.INPUT_FAST_DROP,Qe=>{X.execute(new Gl((Qe==null?void 0:Qe.active)??!1))}),Ge=pe.on(ae.INPUT_SWAP,()=>{X.execute(new Qm)}),Ze=pe.on(ae.INPUT_BLOCK_TAP,Qe=>{Qe&&X.execute(new Jm(Qe.x,Qe.y))});return()=>{de(),ue(),Ue(),He(),Ge(),Ze()}},[X,L,he]);const F=gt(n).rank,{activeStep:H,completeStep:ne,dismissStep:we}=Qg({rank:F,isSessionActive:X.isSessionActive,saveData:v,setSaveData:k}),{isInTraining:b,currentStep:_,completedStepIds:O,advanceStep:$,dismissMessage:V,trainingDisplayStep:te,messagePosition:me,highlightColor:ge,canDismiss:Z}=nv({saveData:v,setSaveData:k,gameEngine:X,rank:F}),Oe=["A","B","C","D","E","F"],Ee=b&&_?(()=>{const de=mr.findIndex(Ue=>Ue.id===_.id),ue=Oe.map(Ue=>{const Ge=Zg(Ue).every(Qe=>O.includes(Qe.id)),Ze=_.phase===Ue;return{phase:Ue,status:Ge?"complete":Ze?"current":"upcoming"}});return{phaseName:`Phase ${_.id.split("_")[0]}: ${qg[_.phase]}`,stepProgress:`Step ${de+1} of ${mr.length}`,phaseDots:ue}})():void 0,$e=(_==null?void 0:_.advance.type)==="tap",Ye=b?te:H,Xe=()=>{},Le=b?Z?$e?$:V:Xe:ne,Je=b?Z?$e?$:V:Xe:we;return l.jsxs("div",{className:"w-full h-full relative touch-none bg-slate-950 overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0",children:l.jsx(Rm,{state:W,rank:F,maxTime:X.maxTime,lightsBrightness:W.phase===qe.TankScreen?W.lightsBrightness:100,laserCharge:W.laserCharge,controlsHeat:W.controlsHeat,complicationCooldowns:W.complicationCooldowns,equippedActives:p,activeCharges:W.activeCharges,onActivateAbility:fe,powerUps:s,storedGoop:X.state.storedGoop,nextGoop:X.state.nextGoop,softBodyPhysics:A,normalGoopOpacity:E,showVertexDebug:U,gooStdDev:se,gooAlphaMul:Y,gooAlphaOff:B,fallingGooStdDev:K,fallingGooAlphaMul:oe,fallingGooAlphaOff:Pe,trainingHighlightColor:ge,disableSwap:b,disablePop:b&&((it=(ce=_==null?void 0:_.setup)==null?void 0:ce.allowedControls)==null?void 0:it.pop)===!1})}),l.jsx("div",{className:`absolute inset-0 z-50 transition-opacity duration-500 ${W.phase===qe.ConsoleScreen?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:l.jsx(Ag,{engine:X,state:W,careerScore:n,scraps:r,powerUps:s,onOpenSettings:a,onOpenHelp:i,onOpenUpgrades:c,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,onDismissGameOver:()=>X.resetSession(),equippedActives:p,onToggleEquip:y,pulsePeriscope:((lt=_==null?void 0:_.setup)==null?void 0:lt.highlightElement)==="periscope"})}),l.jsx("div",{className:`absolute inset-0 z-20 pointer-events-none transition-opacity duration-500 ${W.phase===qe.TankScreen?"opacity-100":"opacity-0"}`,children:l.jsx(Hm,{state:W,onRestart:()=>X.execute(new eg),onExit:()=>{pe.emit(ae.GAME_EXITED),X.execute(new Hs(qe.ConsoleScreen))},initialTotalScore:X.initialTotalScore,maxTime:X.maxTime})}),w&&!vn&&l.jsxs("div",{className:"absolute top-2 right-2 z-[100] bg-black/90 text-white p-3 rounded-lg t-meta font-mono pointer-events-auto overflow-y-auto",style:{minWidth:460,maxHeight:"95vh"},children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("span",{className:"font-bold",children:"Physics Debug"}),l.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-white",children:""})]}),l.jsxs("div",{className:"space-y-2 mb-2",children:[l.jsx("div",{className:"text-gray-400 t-meta uppercase tracking-wider",children:"Shared"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Damping: ",S.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:S.damping,onChange:de=>T(ue=>({...ue,damping:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Stiffness: ",S.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:S.stiffness,onChange:de=>T(ue=>({...ue,stiffness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Pressure: ",S.pressure]}),l.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:S.pressure,onChange:de=>T(ue=>({...ue,pressure:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Inner Home Stiffness: ",S.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:S.innerHomeStiffness,onChange:de=>T(ue=>({...ue,innerHomeStiffness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Iterations: ",S.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:S.iterations,onChange:de=>T(ue=>({...ue,iterations:Number(de.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-600",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-yellow-400 t-meta uppercase tracking-wider",children:"Locked"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Home Stiffness: ",S.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.homeStiffness,onChange:de=>T(ue=>({...ue,homeStiffness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Return Speed: ",S.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.returnSpeed,onChange:de=>T(ue=>({...ue,returnSpeed:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Viscosity: ",S.viscosity.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:S.viscosity,onChange:de=>T(ue=>({...ue,viscosity:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Gravity: ",S.gravity]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.gravity,onChange:de=>T(ue=>({...ue,gravity:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[l.jsx("div",{className:"text-gray-500 t-meta",children:"Goo Filter"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Blur: ",se]}),l.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:se,onChange:de=>N(Number(de.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Mul: ",Y]}),l.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:Y,onChange:de=>ee(Number(de.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Off: ",B]}),l.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:B,onChange:de=>Q(Number(de.target.value)),className:"w-full"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-cyan-400 t-meta uppercase tracking-wider",children:"Falling"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Home Stiffness: ",S.fallingHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingHomeStiffness,onChange:de=>T(ue=>({...ue,fallingHomeStiffness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Return Speed: ",S.fallingReturnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingReturnSpeed,onChange:de=>T(ue=>({...ue,fallingReturnSpeed:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Viscosity: ",S.fallingViscosity.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:S.fallingViscosity,onChange:de=>T(ue=>({...ue,fallingViscosity:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Gravity: ",S.fallingGravity]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.fallingGravity,onChange:de=>T(ue=>({...ue,fallingGravity:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[l.jsx("div",{className:"text-gray-500 t-meta",children:"Tendrils"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Goopiness: ",S.fallingGoopiness]}),l.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:S.fallingGoopiness,onChange:de=>T(ue=>({...ue,fallingGoopiness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["End Radius: ",S.fallingTendrilEndRadius]}),l.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:S.fallingTendrilEndRadius,onChange:de=>T(ue=>({...ue,fallingTendrilEndRadius:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Skinniness: ",S.fallingTendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingTendrilSkinniness,onChange:de=>T(ue=>({...ue,fallingTendrilSkinniness:Number(de.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[l.jsx("div",{className:"text-gray-500 t-meta",children:"Goo Filter"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Blur: ",K]}),l.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:K,onChange:de=>re(Number(de.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Mul: ",oe]}),l.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:oe,onChange:de=>ve(Number(de.target.value)),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Alpha Off: ",Pe]}),l.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:Pe,onChange:de=>be(Number(de.target.value)),className:"w-full"})]})]})]})]}),l.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600 mt-2",children:[l.jsxs("div",{className:"pt-0",children:[l.jsx("div",{className:"text-gray-400 mb-1",children:"Attraction"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Radius: ",S.attractionRadius]}),l.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:S.attractionRadius,onChange:de=>T(ue=>({...ue,attractionRadius:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Rest Length: ",S.attractionRestLength]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.attractionRestLength,onChange:de=>T(ue=>({...ue,attractionRestLength:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Stiffness: ",S.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",value:S.attractionStiffness,onChange:de=>T(ue=>({...ue,attractionStiffness:Number(de.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[l.jsx("div",{className:"text-gray-400 mb-1",children:"Rendering"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Goopiness: ",S.goopiness]}),l.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.goopiness,onChange:de=>T(ue=>({...ue,goopiness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Tendril End Radius: ",S.tendrilEndRadius]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:S.tendrilEndRadius,onChange:de=>T(ue=>({...ue,tendrilEndRadius:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Tendril Skinniness: ",S.tendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.tendrilSkinniness,onChange:de=>T(ue=>({...ue,tendrilSkinniness:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Wall Thickness: ",S.wallThickness]}),l.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:S.wallThickness,onChange:de=>T(ue=>({...ue,wallThickness:Number(de.target.value)})),className:"w-full"})]})]}),l.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[l.jsx("div",{className:"text-gray-400 mb-1",children:"Droplets (Pop Effect)"}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Count: ",S.dropletCount]}),l.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:S.dropletCount,onChange:de=>T(ue=>({...ue,dropletCount:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Speed: ",S.dropletSpeed]}),l.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:S.dropletSpeed,onChange:de=>T(ue=>({...ue,dropletSpeed:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Lifetime: ",S.dropletLifetime,"s"]}),l.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:S.dropletLifetime,onChange:de=>T(ue=>({...ue,dropletLifetime:Number(de.target.value)})),className:"w-full"})]}),l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Size: ",S.dropletSize]}),l.jsx("input",{type:"range",min:"2",max:"30",step:"1",value:S.dropletSize,onChange:de=>T(ue=>({...ue,dropletSize:Number(de.target.value)})),className:"w-full"})]})]}),l.jsx("div",{className:"pt-2 border-t border-gray-600",children:l.jsxs("label",{className:"block",children:[l.jsxs("span",{children:["Normal Goop Opacity: ",E.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:E,onChange:de=>M(Number(de.target.value)),className:"w-full"})]})}),l.jsxs("div",{className:"pt-2 border-t border-gray-600 text-gray-400",children:[l.jsxs("div",{children:["Blobs: ",A.blobs.length]}),l.jsxs("div",{className:"flex gap-1 mt-1",children:[l.jsx("button",{onClick:()=>{T({...zi}),M(.25),J(!1),N(8),ee(24),Q(-13),re(8),ve(24),be(-13)},className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded t-meta",children:"Reset to Defaults"}),l.jsx("button",{onClick:()=>{const de={...S,gooStdDev:se,gooAlphaMul:Y,gooAlphaOff:B,fallingGooStdDev:K,fallingGooAlphaMul:oe,fallingGooAlphaOff:Pe,normalGoopOpacity:E};console.log("=== DEBUG PARAMS SNAPSHOT ==="),console.log(JSON.stringify(de,null,2)),console.log("============================")},className:"px-2 py-1 bg-blue-700 hover:bg-blue-600 rounded t-meta",children:"Save"})]})]})]})]}),!1,h&&!vn&&(()=>{var ks,wo;const de=gt(n).rank,ue=Rn(de),Ue=[{key:"RED",hex:tt.RED},{key:"BLUE",hex:tt.BLUE},{key:"GREEN",hex:tt.GREEN},{key:"YELLOW",hex:tt.YELLOW},{key:"PURPLE",hex:tt.PURPLE},{key:"WHITE",hex:tt.WHITE},{key:"BLACK",hex:tt.BLACK}],He=36,Ge=7,Ze=(ot,hn)=>{const Zn=Math.min(...ot.cells.map(Ot=>Ot.x)),K0=Math.max(...ot.cells.map(Ot=>Ot.x)),iu=Math.min(...ot.cells.map(Ot=>Ot.y)),Z0=Math.max(...ot.cells.map(Ot=>Ot.y)),Q0=K0-Zn+1,J0=Z0-iu+1,eh=(He-Q0*Ge)/2,th=(He-J0*Ge)/2;return l.jsx("div",{onClick:()=>{const Ot={...ot,color:C};X.state.nextGoop=Ot,P||(X.devOverrideNextGoop=Ot),X.emitChange()},style:{cursor:"pointer",borderRadius:4,border:"1px solid #334155",background:"rgba(30, 41, 59, 0.5)"},title:ot.type,onMouseEnter:Ot=>Ot.currentTarget.style.background="rgba(51, 65, 85, 0.8)",onMouseLeave:Ot=>Ot.currentTarget.style.background="rgba(30, 41, 59, 0.5)",children:l.jsx("svg",{width:He,height:He,children:ot.cells.map((Ot,nh)=>l.jsx("rect",{x:eh+(Ot.x-Zn)*Ge,y:th+(Ot.y-iu)*Ge,width:Ge-1,height:Ge-1,fill:C,rx:1},nh))})},hn)},Qe=[{label:"TETRA",normal:bs,corrupted:Jo},{label:"PENTA",normal:cl,corrupted:nu},{label:"HEXA",normal:ul,corrupted:su}];return l.jsxs("div",{className:"absolute top-2 left-2 z-[100] bg-black/90 text-white p-3 rounded-lg t-meta font-mono pointer-events-auto overflow-y-auto",style:{minWidth:280,maxHeight:"95vh"},children:[l.jsxs("div",{className:"flex justify-between items-center mb-2",children:[l.jsx("span",{className:"font-bold",children:"Piece Picker"}),l.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-white px-1",children:""})]}),l.jsxs("div",{className:"flex gap-3 mb-2 pb-2 border-b border-gray-700",children:[l.jsxs("div",{className:"text-gray-400",children:[l.jsx("span",{className:"t-meta uppercase tracking-wider",children:"Next:"})," ",l.jsx("span",{className:"text-gray-200",children:((ks=W.nextGoop)==null?void 0:ks.type)??""})]}),l.jsxs("div",{className:"text-gray-400",children:[l.jsx("span",{className:"t-meta uppercase tracking-wider",children:"Hold:"})," ",l.jsx("span",{className:"text-gray-200",children:((wo=W.storedGoop)==null?void 0:wo.type)??""})]})]}),l.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700",children:[l.jsx("div",{className:"t-meta uppercase tracking-wider text-gray-400 mb-1",children:"Color"}),l.jsx("div",{className:"flex gap-1.5",children:Ue.map(ot=>{const hn=ue.includes(ot.hex),Zn=C===ot.hex;return l.jsx("div",{onClick:()=>hn&&j(ot.hex),style:{width:24,height:24,borderRadius:"50%",background:ot.hex,opacity:hn?1:.3,cursor:hn?"pointer":"not-allowed",border:Zn?"3px solid #facc15":hn?"2px solid #475569":"2px dashed #334155",boxSizing:"border-box"},title:`${ot.key}${hn?"":" (locked)"}`},ot.key)})})]}),l.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700 space-y-1",children:[l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:P,onChange:ot=>{R(ot.target.checked),ot.target.checked&&(X.devOverrideNextGoop=null)}}),l.jsx("span",{children:"Random Pieces"})]}),l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:U,onChange:ot=>J(ot.target.checked)}),l.jsx("span",{children:"Show Vertices"})]}),l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:X.freezeTimer,onChange:ot=>{X.freezeTimer=ot.target.checked}}),l.jsx("span",{children:"Freeze Timer"})]}),l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:X.freezeFalling,onChange:ot=>{X.freezeFalling=ot.target.checked}}),l.jsx("span",{children:"Freeze Falling"})]})]}),Qe.map(ot=>l.jsxs("div",{className:"mb-2",children:[l.jsxs("div",{className:"t-meta uppercase tracking-wider text-cyan-400 mb-1",children:[ot.label,"  Normal"]}),l.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:ot.normal.map((hn,Zn)=>Ze(hn,Zn))}),l.jsxs("div",{className:"t-meta uppercase tracking-wider text-orange-400 mb-1",children:[ot.label,"  Corrupted"]}),l.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:ot.corrupted.map((hn,Zn)=>Ze(hn,Zn))})]},ot.label))]})})(),l.jsx(Xg,{activeStep:Ye,onComplete:Le,onDismiss:Je,highlightElement:(Rt=_==null?void 0:_.setup)==null?void 0:Rt.highlightElement,messagePosition:b?me:void 0,advanceType:b?$e?"tap":"dismiss":void 0,blockInteraction:b&&(_==null?void 0:_.pauseGame)!==!1&&!!te&&Z,trainingProgress:Ee,canDismiss:b?Z:!0})]})},ov=({onBack:e})=>l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[l.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[l.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-4",children:l.jsx("h2",{className:"t-title font-bold text-yellow-400 tracking-wider",children:"UPGRADES"})}),l.jsx("div",{className:"w-full max-w-md space-y-4 opacity-50 pointer-events-none",children:[1,2,3].map(t=>l.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center",children:l.jsx(ou,{className:"w-6 h-6 text-slate-600"})}),l.jsxs("div",{children:[l.jsxs("div",{className:"font-bold text-slate-300 t-body",children:["Locked Upgrade ",t]}),l.jsxs("div",{className:"t-body text-slate-500",children:["Requires Rank ",t*5]})]})]}),l.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded text-slate-500 t-body font-bold",children:"LOCKED"})]},t))}),l.jsx("div",{className:"mt-8 text-center text-slate-500 t-body",children:"Play more to unlock system upgrades."})]}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(fl,{className:"w-1/2 h-1/2 stroke-[3]"})})}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),rv=({settings:e,onUpdate:t,onBack:n})=>{g.useEffect(()=>{Tt.init(e)},[]);const s=(a,i)=>{t({...e,[a]:i})},r=({label:a,value:i,onChange:c,icon:u,colorClass:f})=>l.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex flex-col gap-3 transition-colors hover:border-slate-700",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(u,{className:`w-5 h-5 ${f}`}),l.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase t-body",children:a})]}),l.jsxs("span",{className:`font-bold t-body ${f}`,children:[i,"%"]})]}),l.jsxs("div",{className:"relative w-full h-6 flex items-center",children:[l.jsx("input",{type:"range",min:"0",max:"100",value:i,onChange:d=>c(Number(d.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-cyan-500 z-10",style:{background:`linear-gradient(to right, currentColor 0%, currentColor ${i}%, rgba(30, 41, 59, 1) ${i}%, rgba(30, 41, 59, 1) 100%)`}}),l.jsx("style",{children:`
              input[type=range]::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  height: 16px;
                  width: 16px;
                  border-radius: 50%;
                  background: #f1f5f9;
                  margin-top: -2px; /* align center */
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
              input[type=range]::-moz-range-thumb {
                  height: 16px;
                  width: 16px;
                  border: none;
                  border-radius: 50%;
                  background: #f1f5f9;
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
           `})]})]}),o=({label:a,value:i,onChange:c,icon:u,colorClass:f})=>l.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex items-center justify-between transition-colors hover:border-slate-700 cursor-pointer",onClick:()=>c(!i),children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(u,{className:`w-5 h-5 ${f}`}),l.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase t-body",children:a})]}),l.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${i?"bg-cyan-600":"bg-slate-700"}`,children:l.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform duration-300 ${i?"translate-x-6":"translate-x-0"}`})})]});return l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[l.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[l.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6",children:l.jsx("h2",{className:"t-title text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Config"})}),l.jsxs("div",{className:"w-full max-w-md space-y-4",children:[l.jsx(r,{label:"Master Output",value:e.masterVolume,onChange:a=>s("masterVolume",a),icon:Bm,colorClass:"text-cyan-400"}),l.jsx(r,{label:"Music Level",value:e.musicVolume,onChange:a=>s("musicVolume",a),icon:Lm,colorClass:"text-purple-400"}),l.jsx(r,{label:"SFX Level",value:e.sfxVolume,onChange:a=>{s("sfxVolume",a)},icon:Fm,colorClass:"text-green-400"}),l.jsx("div",{className:"h-px bg-slate-800 my-2"}),l.jsx(o,{label:"Invert Rotation",value:e.invertRotation||!1,onChange:a=>s("invertRotation",a),icon:Dm,colorClass:"text-yellow-400"})]}),l.jsx("div",{className:"mt-8 text-center text-slate-700 t-body uppercase tracking-widest font-bold",children:"Audio System v2.1  Initialized"})]}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:n,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(fl,{className:"w-1/2 h-1/2 stroke-[3]"})})}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},Wl=[{id:"BASICS",title:"THE OBJECTIVE",icon:"Gauge",unlockedBy:"ALWAYS",sections:[{heading:"PRESSURE SYSTEM",body:"The tank pressure climbs as goop accumulates. If pressure hits 100%, the system fails. Pop goop to vent pressure and buy time."},{heading:"POPPING BASICS",body:"Click or tap solid goop below the pressure line to pop it. Bigger groups vent more pressure. Keep the tank clear."},{heading:"YOUR OBJECTIVE",body:"Seal all cracks before the shift timer runs out. Cracks appear in the tank walls. Place matching-color goop on a crack, then pop it to seal."}]},{id:"CONTROLS",title:"CONTROLS",icon:"Keyboard",unlockedBy:"ROTATE_INTRO",sections:[{heading:"TANK ROTATION",body:"Swipe left/right or A/D keys to rotate the tank. The tank is a cylinder  it wraps all the way around."},{heading:"PIECE ROTATION",body:"Q / E keys or tap screen edges to rotate the falling piece."},{heading:"SOFT DROP",body:"S key or swipe down to make the piece fall faster."},{heading:"HOLD & SWAP",body:"R key to swap the falling piece with your held piece. One swap per drop."},{heading:"CONSOLE RETURN",body:"W or Space to return to the console view. Use this to fix complications."},{heading:"CLICK TO POP",body:"Click or tap solid goop below the pressure line. Groups of same-color goop pop together."}]},{id:"POPPING",title:"PURGING",icon:"Target",unlockedBy:"POP_TIMING",sections:[{heading:"WHAT CAN BE POPPED",body:"Only fully solid goop below the pressure line can be popped. Fresh goop needs time to solidify  watch it fill in."},{heading:"TIMING TENSION",body:"Let goop accumulate for bigger group pops and more points. But wait too long and pressure overwhelms you. Find the balance."},{heading:"MERGING",body:"Same-color goop touching each other merges into bigger blobs. Bigger pops vent more pressure and score more points."}]},{id:"SCORING",title:"SCORING",icon:"ArrowUpCircle",unlockedBy:"FIRST_SHIFT",sections:[{heading:"GROUP SIZE BONUS",body:"Larger groups of connected same-color goop score exponentially more. Two cells is good. Ten cells is great."},{heading:"ELEVATION BONUS",body:"Goop popped higher in the tank scores more. Build up, then pop from the top for maximum points."},{heading:"SHIFTS",body:"Each shift lasts 75 seconds. Seal all assigned cracks before time runs out."}]},{id:"CRACKS",title:"STRUCTURAL DAMAGE",icon:"AlertTriangle",unlockedBy:"CRACK_INTRO",sections:[{heading:"CRACKS SPREAD",body:"Cracks appear in the tank walls and grow over time. Left unchecked, they branch and spread across the surface."},{heading:"SEALING CRACKS",body:"Place matching-color goop on a crack and pop it. Sealed cracks give a massive pressure drop. This is the core of your job."}]},{id:"WRAPPING",title:"CYLINDER WRAP",icon:"RefreshCw",unlockedBy:"WRAP_INTRO",sections:[{heading:"THE TANK WRAPS",body:"The tank is a full cylinder. Goop on the left edge connects to goop on the right edge. Rotate all the way around to see everything."},{heading:"CROSS-SEAM CONNECTIONS",body:"Same-color goop touching across the seam forms one group. Plan wrapping pops for massive combos."}]},{id:"COMPLICATIONS_LIGHTS",title:"LIGHTS FAILURE",icon:"Lightbulb",unlockedBy:"COMPLICATION_LIGHTS",sections:[{heading:"LIGHTS SYSTEM",body:"Details on the lights complication system. (Operator notes pending.)"}]},{id:"COMPLICATIONS_LASER",title:"LASER MALFUNCTION",icon:"Zap",unlockedBy:"COMPLICATION_LASER",sections:[{heading:"LASER SYSTEM",body:"Details on the laser complication system. (Operator notes pending.)"}]},{id:"COMPLICATIONS_CONTROLS",title:"CONTROLS LOCKOUT",icon:"Lock",unlockedBy:"COMPLICATION_CONTROLS",sections:[{heading:"CONTROLS SYSTEM",body:"Details on the controls complication system. (Operator notes pending.)"}]},{id:"UPGRADES",title:"UPGRADES",icon:"Wrench",unlockedBy:"UPGRADE_INTRO",sections:[{heading:"UPGRADE SYSTEM",body:"Details on the upgrade system. (Operator notes pending.)"}]},{id:"ABILITIES",title:"ACTIVE ABILITIES",icon:"Sparkles",unlockedBy:"ABILITY_INTRO",sections:[{heading:"ABILITIES",body:"Details on active abilities. (Operator notes pending.)"}]}];const iv={Gauge:Im,Keyboard:_m,Target:Gm,ArrowUpCircle:Am,AlertTriangle:Mm,RefreshCw:Nm,Lightbulb:Om,Zap:Ym,Lock:ou,Wrench:zm,Sparkles:$m},lv=({completedSteps:e,onBack:t})=>{const n=g.useMemo(()=>{const i=new Set;for(const c of Wl)(c.unlockedBy==="ALWAYS"||e.includes(c.unlockedBy))&&i.add(c.id);return i},[e]),s=g.useMemo(()=>{const i=Wl.find(c=>n.has(c.id));return(i==null?void 0:i.id)??null},[n]),[r,o]=g.useState(s),a=i=>{n.has(i)&&o(c=>c===i?null:i)};return l.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[l.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),l.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:l.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[l.jsx("div",{className:"w-full flex items-center justify-center pt-5 pb-3 flex-shrink-0",children:l.jsx("h2",{className:"t-title text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Operator Journal"})}),l.jsx("div",{className:"w-full flex-1 overflow-y-auto pb-28 px-3 space-y-1.5",children:Wl.map(i=>{const c=n.has(i.id),u=r===i.id,f=iv[i.icon];return l.jsxs("div",{children:[l.jsxs("button",{onClick:()=>a(i.id),disabled:!c,className:`
                      w-full flex items-center gap-3 px-4 py-3
                      rounded-lg border text-left transition-all
                      ${u?"bg-slate-800 border-green-600 text-slate-100":c?"bg-slate-900 border-slate-700 text-slate-400 hover:bg-slate-800 hover:text-slate-300":"bg-slate-900/50 border-slate-800 text-slate-600 cursor-not-allowed opacity-50"}
                    `,style:{minHeight:"48px"},children:[l.jsxs("div",{className:"relative flex-shrink-0",children:[f&&l.jsx(f,{className:`w-5 h-5 ${u?"text-green-400":c?"text-slate-500":"text-slate-700"}`}),!c&&l.jsx(ou,{className:"w-3 h-3 text-slate-600 absolute -bottom-1 -right-1"})]}),l.jsx("span",{className:"t-body flex-1 font-bold uppercase tracking-wider",children:c?i.title:"???"}),c&&l.jsx(Em,{className:`w-5 h-5 flex-shrink-0 transition-transform duration-200 ${u?"rotate-180 text-green-400":"text-slate-600"}`})]}),u&&c&&l.jsx("div",{className:"journal-page-enter mt-1.5 mb-2 space-y-3 pl-2 pr-1",children:i.sections.map((d,p)=>l.jsxs("div",{className:"bg-slate-900/80 p-4 rounded-xl border border-slate-800 backdrop-blur-sm",children:[l.jsx("h4",{className:"t-heading font-bold text-slate-200 uppercase tracking-wider mb-2",children:d.heading}),l.jsx("p",{className:"t-body text-slate-400 leading-relaxed",children:d.body})]},p))})]},i.id)})}),l.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:l.jsx("button",{onClick:t,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:l.jsx(fl,{className:"w-1/2 h-1/2 stroke-[3]"})})}),l.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},Yi="gooptris_save_v3",Qf="gooptris_save_v2",ic=()=>({careerRank:1,careerScore:0,scraps:0,powerUps:{},equippedActives:[],unlockedUpgrades:[],firstRunComplete:!1,milestonesReached:[],tutorialProgress:{completedSteps:[]},settings:{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1}}),av=e=>{const t={...e};return"operatorXP"in t&&(t.careerScore=t.operatorXP,delete t.operatorXP),"operatorRank"in t&&(t.careerRank=t.operatorRank,delete t.operatorRank),t},cv=()=>{try{let e=localStorage.getItem(Yi);const t=ic();if(!e){const s=localStorage.getItem(Qf);if(s){const r=JSON.parse(s),o=av(r);localStorage.setItem(Yi,JSON.stringify(o)),localStorage.removeItem(Qf),e=JSON.stringify(o)}}if(!e)return t;const n=JSON.parse(e);return{...t,...n,settings:{...t.settings,...n.settings||{}},powerUps:{...t.powerUps,...n.powerUps||{}},tutorialProgress:{...t.tutorialProgress,...n.tutorialProgress||{}},equippedActives:n.equippedActives||t.equippedActives,unlockedUpgrades:n.unlockedUpgrades||t.unlockedUpgrades,milestonesReached:n.milestonesReached||t.milestonesReached}}catch(e){return console.error("Failed to load save data",e),ic()}},uv=e=>{try{localStorage.setItem(Yi,JSON.stringify(e))}catch(t){console.error("Failed to save data",t)}},fv=()=>{const e=ic();try{localStorage.setItem(Yi,JSON.stringify(e))}catch(t){console.error("Failed to wipe save data",t)}return e},dv=()=>{g.useEffect(()=>{const e=pe.on(ae.PIECE_MOVED,()=>Tt.playMove()),t=pe.on(ae.PIECE_ROTATED,()=>Tt.playRotate()),n=pe.on(ae.PIECE_DROPPED,()=>Tt.playDrop()),s=pe.on(ae.GOOP_POPPED,f=>{Tt.playPop((f==null?void 0:f.popStreak)||0)}),r=pe.on(ae.ACTION_REJECTED,()=>Tt.playReject()),o=pe.on(ae.GOAL_CAPTURED,f=>{Tt.playPop(10)}),a=pe.on(ae.GAME_OVER,()=>{Tt.playGameOver(),Tt.stopMusic()}),i=pe.on(ae.MUSIC_START,()=>Tt.startMusic()),c=pe.on(ae.MUSIC_STOP,()=>Tt.stopMusic()),u=pe.on(ae.GAME_RESUMED,()=>{Tt.resume(),Tt.startMusic()});return()=>{e(),t(),n(),s(),r(),o(),a(),i(),c(),u()}},[])},Jf={damping:.975,gravity:30,stiffness:20,pressure:2.5,iterations:3},ed=40;function td(e,t){const n=[],s=[],r=[],o=ed,a=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of a)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=_0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,centerX:e,centerY:t,radius:ed*1.5}}function _0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function O0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function pv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function hv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function xv(e,t){const n=_0(e.vertices);if(n<1)return;const s=e.restArea/n,r=O0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function yv(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5)}function mv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function gv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=mv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=O0(s),i=e.createRadialGradient(a.x-20,a.y-20,0,a.x,a.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill(),e.fillStyle="#fff",e.font="10px monospace",e.fillText(String(c),u.pos.x-3,u.pos.y+3)}e.strokeStyle="rgba(52, 152, 219, 0.5)",e.lineWidth=1;for(const c of t.ringsprings)e.beginPath(),e.moveTo(s[c.a].pos.x,s[c.a].pos.y),e.lineTo(s[c.b].pos.x,s[c.b].pos.y),e.stroke();e.strokeStyle="rgba(155, 89, 182, 0.3)";for(const c of t.crossSprings)e.beginPath(),e.moveTo(s[c.a].pos.x,s[c.a].pos.y),e.lineTo(s[c.b].pos.x,s[c.b].pos.y),e.stroke();e.beginPath(),e.arc(a.x,a.y,5,0,Math.PI*2),e.fillStyle="#f39c12",e.fill()}}const Ul=500,Xl=400;function vv(){const e=g.useRef(null),t=g.useRef(td(Ul/2,Xl/3)),n=g.useRef(0),s=g.useRef(-1),r=g.useRef({active:!1,vertexIndex:-1}),[o,a]=g.useState(Jf),[i,c]=g.useState(!0),[u,f]=g.useState(0);g.useEffect(()=>{const m=e.current;if(!m)return;const h=m.getContext("2d");if(!h)return;let x=0,C=performance.now();const j=P=>{x++,P-C>1e3&&(f(x),x=0,C=P);const R=t.current;if(s.current>=0){const S=Math.min((P-s.current)/1e3,.033);pv(R,S,o);for(let T=0;T<o.iterations;T++)hv(R,o),xv(R,o);yv(R,m.width,m.height)}s.current=P,r.current.active&&r.current.vertexIndex>=0,h.fillStyle="#2c3e50",h.fillRect(0,0,m.width,m.height),h.fillStyle="#34495e",h.fillRect(0,m.height-10,m.width,10),gv(h,R,i),n.current=requestAnimationFrame(j)};return n.current=requestAnimationFrame(j),()=>{cancelAnimationFrame(n.current)}},[o,i]);const d=g.useCallback((m,h)=>{const x=t.current;if(!x)return-1;let C=1/0,j=-1;for(let P=0;P<x.vertices.length;P++){const R=x.vertices[P],S=R.pos.x-m,T=R.pos.y-h,E=Math.sqrt(S*S+T*T);E<C&&E<50&&(C=E,j=P)}return j},[]),p=g.useCallback(m=>{const h=e.current;if(!h)return;const x=h.getBoundingClientRect(),C=m.clientX-x.left,j=m.clientY-x.top,P=d(C,j);P>=0&&(r.current={active:!0,vertexIndex:P})},[d]),y=g.useCallback(m=>{if(!r.current.active)return;const h=e.current;if(!h)return;const x=t.current,C=h.getBoundingClientRect(),j=m.clientX-C.left,P=m.clientY-C.top,R=x.vertices[r.current.vertexIndex];R.pos.x=j,R.pos.y=P,R.oldPos.x=j,R.oldPos.y=P},[]),v=g.useCallback(()=>{r.current={active:!1,vertexIndex:-1}},[]),k=g.useCallback(()=>{t.current=td(Ul/2,Xl/3),s.current=-1},[]),w=g.useCallback(()=>{const m=t.current;for(const h of m.vertices)h.oldPos.x=h.pos.x+(Math.random()-.5)*30,h.oldPos.y=h.pos.y+(Math.random()-.5)*30},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-1: Soft Body Blob"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Click and drag vertices to poke the blob"}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Ul,height:Xl,onMouseDown:p,onMouseMove:y,onMouseUp:v,onMouseLeave:v,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"pointer"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[l.jsxs("span",{children:["FPS: ",u]}),l.jsx("span",{children:"Vertices: 10"})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Damping (velocity): ",o.damping.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.001",value:o.damping,onChange:m=>a(h=>({...h,damping:parseFloat(m.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Gravity: ",o.gravity]}),l.jsx("input",{type:"range",min:"-25",max:"50",step:"5",value:o.gravity,onChange:m=>a(h=>({...h,gravity:parseFloat(m.target.value)}))}),l.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"-25 = floats up, 0 = zero-g, 50 = gentle fall"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Stiffness (k): ",o.stiffness]}),l.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:o.stiffness,onChange:m=>a(h=>({...h,stiffness:parseFloat(m.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Pressure: ",o.pressure.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:o.pressure,onChange:m=>a(h=>({...h,pressure:parseFloat(m.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Constraint Iterations: ",o.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:o.iterations,onChange:m=>a(h=>({...h,iterations:parseInt(m.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:i,onChange:m=>c(m.target.checked)}),l.jsx("span",{children:"Show Debug (vertices, springs)"})]}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:w,style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Poke!"}),l.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset"})]}),l.jsx("button",{onClick:()=>a(Jf),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset Parameters"})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-1 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:"Verlet integration with position-based constraints"}),l.jsx("li",{children:"T-tetromino shape with 10 perimeter vertices"}),l.jsx("li",{children:"Ring springs (perimeter) + cross springs (structural)"}),l.jsx("li",{children:"Pressure force for volume preservation"}),l.jsx("li",{children:"Catmull-Rom to Bezier for smooth rendering"})]})]})]})}const nd={damping:.92,gravity:0,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.03},Sv=40,Vl=500,ql=400;function sd(e,t){const n=[],s=[],r=[],o=Sv,a=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of a)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=L0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t}}function L0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function N0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Cv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function kv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,a=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=a*t.homeStiffness}}function wv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function Rv(e,t){const n=L0(e.vertices);if(n<1)return;const s=e.restArea/n,r=N0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function Pv(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3)}function jv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Tv(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let c=0;c<r;c++){const u=t.targetX+s[c].homeOffset.x,f=t.targetY+s[c].homeOffset.y;c===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=jv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=N0(s),i=e.createRadialGradient(a.x-20,a.y-20,0,a.x,a.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}e.strokeStyle="#f39c12",e.lineWidth=2,e.beginPath(),e.moveTo(t.targetX-10,t.targetY),e.lineTo(t.targetX+10,t.targetY),e.moveTo(t.targetX,t.targetY-10),e.lineTo(t.targetX,t.targetY+10),e.stroke()}}function bv(){const e=g.useRef(null),t=g.useRef(sd(Vl/2,ql/2)),n=g.useRef(0),s=g.useRef(-1),[r,o]=g.useState(nd),[a,i]=g.useState(!0),[c,u]=g.useState(0),[f,d]=g.useState("cursor");g.useEffect(()=>{const w=e.current;if(!w)return;const m=w.getContext("2d");if(!m)return;let h=0,x=performance.now();const C=j=>{h++,j-x>1e3&&(u(h),h=0,x=j);const P=t.current;if(s.current>=0){const R=Math.min((j-s.current)/1e3,.033);Cv(P,R,r),kv(P,r);for(let S=0;S<r.iterations;S++)wv(P,r),Rv(P,r);Pv(P,w.width,w.height)}s.current=j,m.fillStyle="#2c3e50",m.fillRect(0,0,w.width,w.height),Tv(m,P,a),m.fillStyle="rgba(255,255,255,0.5)",m.font="12px system-ui",m.fillText(f==="cursor"?"Move mouse to guide blob":"Click to set target",10,20),n.current=requestAnimationFrame(C)};return n.current=requestAnimationFrame(C),()=>cancelAnimationFrame(n.current)},[r,a,f]);const p=g.useCallback(w=>{if(f!=="cursor")return;const m=e.current;if(!m)return;const h=m.getBoundingClientRect(),x=w.clientX-h.left,C=w.clientY-h.top;t.current.targetX=x,t.current.targetY=C},[f]),y=g.useCallback(w=>{if(f!=="click")return;const m=e.current;if(!m)return;const h=m.getBoundingClientRect();t.current.targetX=w.clientX-h.left,t.current.targetY=w.clientY-h.top},[f]),v=g.useCallback(()=>{t.current=sd(Vl/2,ql/2),s.current=-1},[]),k=g.useCallback(()=>{const w=t.current;for(const m of w.vertices){const h=m.homeOffset.x,x=m.homeOffset.y;m.homeOffset.x=x,m.homeOffset.y=-h}},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-2: Blob Follows Cursor"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Testing two-layer architecture: render follows data"}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Vl,height:ql,onMouseMove:p,onClick:y,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"crosshair"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[l.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:l.jsxs("span",{children:["FPS: ",c]})}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:()=>d("cursor"),style:{flex:1,padding:"8px",backgroundColor:f==="cursor"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Follow Cursor"}),l.jsx("button",{onClick:()=>d("click"),style:{flex:1,padding:"8px",backgroundColor:f==="click"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Click Target"})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Home Stiffness: ",r.homeStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.5",step:"0.01",value:r.homeStiffness,onChange:w=>o(m=>({...m,homeStiffness:parseFloat(w.target.value)}))}),l.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"Low = laggy/stretchy, High = snappy"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Damping: ",r.damping.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.005",value:r.damping,onChange:w=>o(m=>({...m,damping:parseFloat(w.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Stiffness: ",r.stiffness]}),l.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:r.stiffness,onChange:w=>o(m=>({...m,stiffness:parseFloat(w.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Iterations: ",r.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:r.iterations,onChange:w=>o(m=>({...m,iterations:parseInt(w.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:a,onChange:w=>i(w.target.checked)}),l.jsx("span",{children:"Show Debug (target, ghost)"})]}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Rotate 90"}),l.jsx("button",{onClick:v,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]}),l.jsx("button",{onClick:()=>o(nd),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Parameters"})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-2 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:"Test two-layer architecture (data layer drives render layer)"}),l.jsx("li",{children:"Blob follows cursor/click target with springy physics"}),l.jsx("li",{children:"Slow moves = smooth follow"}),l.jsx("li",{children:"Fast/jump moves = overshoot, bounce, settle"}),l.jsx("li",{children:"Tune homeStiffness for responsive but physical feel"})]})]})]})}const Mv={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.18},Av=40,Kl=500,Zl=400;function od(e,t){const n=[],s=[],r=[],o=Av,a=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of a)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=D0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t,rotationCount:0}}function D0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function $0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Ev(e){let t=0;for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=n.pos.x-s,a=n.pos.y-r;t+=Math.sqrt(o*o+a*a)}return t/e.vertices.length}function Iv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function _v(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,a=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=a*t.homeStiffness}}function Ov(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function Lv(e,t){const n=D0(e.vertices);if(n<1)return;const s=e.restArea/n,r=$0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function Nv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Dv(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let c=0;c<r;c++){const u=t.targetX+s[c].homeOffset.x,f=t.targetY+s[c].homeOffset.y;c===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Nv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=$0(s),i=e.createRadialGradient(a.x-20,a.y-20,0,a.x,a.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n)for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function $v(){const e=g.useRef(null),t=g.useRef(od(Kl/2,Zl/2)),n=g.useRef(0),s=g.useRef(-1),r=g.useRef(0),[o,a]=g.useState(Mv),[i,c]=g.useState(!0),[u,f]=g.useState(0),[d,p]=g.useState(0),[y,v]=g.useState(0),[k,w]=g.useState(!1),[m,h]=g.useState(500),[x,C]=g.useState(0);g.useEffect(()=>{const R=e.current;if(!R)return;const S=R.getContext("2d");if(!S)return;let T=0,E=performance.now();const M=U=>{T++,U-E>1e3&&(f(T),T=0,E=U);const J=t.current;if(k&&U-r.current>m){for(const re of J.vertices){const oe=re.homeOffset.x,ve=re.homeOffset.y;re.homeOffset.x=ve,re.homeOffset.y=-oe}J.rotationCount++,v(J.rotationCount),r.current=U}if(s.current>=0){const re=Math.min((U-s.current)/1e3,.033);Iv(J,re,o),_v(J,o);for(let oe=0;oe<o.iterations;oe++)Ov(J,o),Lv(J,o)}s.current=U;const se=Ev(J);p(se),se>x&&C(se),S.fillStyle="#2c3e50",S.fillRect(0,0,R.width,R.height),Dv(S,J,i);const N=150,Y=20,ee=10,B=R.height-30;S.fillStyle="#34495e",S.fillRect(ee,B,N,Y);const Q=Math.min(se/50,1),K=Q<.3?"#27ae60":Q<.7?"#f39c12":"#e74c3c";S.fillStyle=K,S.fillRect(ee,B,N*Q,Y),S.strokeStyle="#fff",S.strokeRect(ee,B,N,Y),S.fillStyle="#fff",S.font="12px system-ui",S.fillText(`Deviation: ${se.toFixed(1)}px`,ee+5,B+14),n.current=requestAnimationFrame(M)};return n.current=requestAnimationFrame(M),()=>cancelAnimationFrame(n.current)},[o,i,k,m,x]);const j=g.useCallback(()=>{const R=t.current;for(const S of R.vertices){const T=S.homeOffset.x,E=S.homeOffset.y;S.homeOffset.x=E,S.homeOffset.y=-T}R.rotationCount++,v(R.rotationCount)},[]),P=g.useCallback(()=>{t.current=od(Kl/2,Zl/2),s.current=-1,v(0),C(0)},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-3: Rotation Stress Test"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Spam rotate - does lag accumulate?"}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Kl,height:Zl,style:{border:"2px solid #34495e",borderRadius:"8px"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[l.jsxs("span",{children:["FPS: ",u]}),l.jsxs("span",{children:["Rotations: ",y]})]}),l.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c3e50",borderRadius:"4px",textAlign:"center"},children:[l.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[d.toFixed(1),"px"]}),l.jsx("div",{style:{fontSize:"12px",opacity:.7},children:"Current Deviation"}),l.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"5px"},children:["Peak: ",x.toFixed(1),"px"]})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsx("button",{onClick:j,style:{padding:"15px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"18px",fontWeight:"bold"},children:"ROTATE 90"}),l.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:k,onChange:R=>w(R.target.checked)}),l.jsx("span",{children:"Auto-rotate"})]}),l.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:m,onChange:R=>h(parseInt(R.target.value)),style:{flex:1},disabled:!k}),l.jsxs("span",{style:{fontSize:"12px",width:"50px"},children:[m,"ms"]})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Home Stiffness: ",o.homeStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.005",value:o.homeStiffness,onChange:R=>a(S=>({...S,homeStiffness:parseFloat(R.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[l.jsxs("span",{children:["Damping: ",o.damping.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:o.damping,onChange:R=>a(S=>({...S,damping:parseFloat(R.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:i,onChange:R=>c(R.target.checked)}),l.jsx("span",{children:"Show Debug"})]}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:()=>C(0),style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Peak"}),l.jsx("button",{onClick:P,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset All"})]})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-3 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:"Spam rotate button - observe deviation meter"}),l.jsx("li",{children:"Enable auto-rotate at various speeds"}),l.jsx("li",{children:"Watch for lag accumulation (peak deviation climbing)"}),l.jsx("li",{children:"Target: deviation stays bounded, recovers between rotations"}),l.jsx("li",{children:"Success = peak deviation stays under ~40px even with spam"})]})]})]})}const F0=30,Lo=600,No=450,Fv={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.05,attractionRadius:F0,attractionRestLength:0,attractionStiffness:.02,breakDistance:60};function Vr(e,t,n,s){const r=[],o=[],a=[],i=[],c=F0;let u,f,d,p;const y=1.5,v=.3;s==="T"?(u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],p=[y,y,y,y,y,v,y,y,v,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]],d=[{center:{x:-1*c,y:-.5*c},vertices:[0,1,9]},{center:{x:0*c,y:-.5*c},vertices:[1,2,5,8]},{center:{x:1*c,y:-.5*c},vertices:[2,3,4,5]},{center:{x:0*c,y:.5*c},vertices:[5,6,7,8]}]):(u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],p=[y,y,v,v,y,y,y,y,y,y,y,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]],d=[{center:{x:-1*c,y:-.5*c},vertices:[0,1,2,11]},{center:{x:1*c,y:-.5*c},vertices:[3,4,5,6]},{center:{x:-1*c,y:.5*c},vertices:[9,10,11,2]},{center:{x:0*c,y:.5*c},vertices:[2,3,8,9]},{center:{x:1*c,y:.5*c},vertices:[3,6,7,8]}]);for(let m=0;m<u.length;m++){const h=u[m];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:p[m]})}const k=r.length;for(let m=0;m<k;m++){const h=(m+1)%k,x=r[h].pos.x-r[m].pos.x,C=r[h].pos.y-r[m].pos.y,j=Math.sqrt(x*x+C*C);o.push({a:m,b:h,restLength:j})}for(const[m,h]of f)if(m<k&&h<k){const x=r[h].pos.x-r[m].pos.x,C=r[h].pos.y-r[m].pos.y,j=Math.sqrt(x*x+C*C);a.push({a:m,b:h,restLength:j})}const w=G0(r);for(const m of d)i.push({center:m.center,vertexIndices:m.vertices});return{vertices:r,ringsprings:o,crossSprings:a,restArea:w,targetX:e,targetY:t,color:n,blocks:i}}function G0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function ru(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Gv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Bv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,a=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=a*t.homeStiffness}}function zv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],a=e.vertices[r.b],i=a.pos.x-o.pos.x,c=a.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,a.pos.x-=p,a.pos.y-=y}}function Yv(e,t){const n=G0(e.vertices);if(n<1)return;const s=e.restArea/n,r=ru(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const a=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(a*a+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=a/c*u,o.pos.y+=i/c*u}}function rd(e,t){return{x:e.targetX+t.center.x,y:e.targetY+t.center.y}}function Hv(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.breakDistance&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];for(const u of i.blocks)for(const f of c.blocks){const d=rd(i,u),p=rd(c,f),y=p.x-d.x,v=p.y-d.y;if(Math.sqrt(y*y+v*v)<n.attractionRadius*4)for(const w of u.vertexIndices)for(const m of f.vertexIndices){const h=`${o}-${w}-${a}-${m}`;if(r.has(h))continue;const x=i.vertices[w],C=c.vertices[m],j=C.pos.x-x.pos.x,P=C.pos.y-x.pos.y,R=Math.sqrt(j*j+P*P),S=n.attractionRadius*x.attractionRadius,T=n.attractionRadius*C.attractionRadius,E=S+T;R<E&&(s.push({blobA:o,vertA:w,blobB:a,vertB:m,restLength:n.attractionRestLength}),r.add(h))}}}return s}function Wv(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),k=(f-o.restLength)*y*.5,w=c/f*k,m=u/f*k;a.pos.x+=w,a.pos.y+=m,i.pos.x-=w,i.pos.y-=m}}function Uv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Xv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Uv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const a=ru(s),i=e.createRadialGradient(a.x-15,a.y-15,0,a.x,a.y,60);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=2,e.stroke(),n)for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Vv(e,t,n){e.strokeStyle="#f39c12",e.lineWidth=2,e.setLineDash([4,4]);for(const s of n){const r=t[s.blobA].vertices[s.vertA],o=t[s.blobB].vertices[s.vertB];e.beginPath(),e.moveTo(r.pos.x,r.pos.y),e.lineTo(o.pos.x,o.pos.y),e.stroke()}e.setLineDash([])}function qv(){const e=g.useRef(null),t=g.useRef([Vr(Lo/3,No/2,"#27ae60","T"),Vr(Lo*2/3,No/2,"#27ae60","U")]),n=g.useRef([]),s=g.useRef(0),r=g.useRef(-1),o=g.useRef(null),[a,i]=g.useState(Fv),[c,u]=g.useState(!0),[f,d]=g.useState(0),[p,y]=g.useState(0);g.useEffect(()=>{const x=e.current;if(!x)return;const C=x.getContext("2d");if(!C)return;let j=0,P=performance.now();const R=S=>{j++,S-P>1e3&&(d(j),j=0,P=S);const T=t.current;if(r.current>=0){const E=Math.min((S-r.current)/1e3,.033);n.current=Hv(T,n.current,a),y(n.current.length);for(let M=0;M<T.length;M++){const U=T[M];Gv(U,E,a);const J=M===0?{...a,homeStiffness:.3}:a;Bv(U,J);for(let se=0;se<a.iterations;se++)zv(U,a),Yv(U,a)}Wv(T,n.current,a)}if(r.current=S,C.fillStyle="#2c3e50",C.fillRect(0,0,x.width,x.height),c){C.lineWidth=1;for(const E of T)for(const M of E.vertices){const U=a.attractionRadius*M.attractionRadius,J=M.attractionRadius>1;C.strokeStyle=J?"rgba(243, 156, 18, 0.3)":"rgba(52, 152, 219, 0.3)",C.beginPath(),C.arc(M.pos.x,M.pos.y,U,0,Math.PI*2),C.stroke()}}c&&Vv(C,T,n.current);for(const E of T)Xv(C,E,c);C.fillStyle="rgba(255,255,255,0.5)",C.font="12px system-ui",C.fillText("Drag blobs to test attraction",10,20),s.current=requestAnimationFrame(R)};return s.current=requestAnimationFrame(R),()=>cancelAnimationFrame(s.current)},[a,c]);const v=g.useCallback(x=>{const C=e.current;if(!C)return;const j=C.getBoundingClientRect(),P=C.width/j.width,R=C.height/j.height,S=(x.clientX-j.left)*P,T=(x.clientY-j.top)*R,E=t.current[1],M=ru(E.vertices),U=S-M.x,J=T-M.y;Math.sqrt(U*U+J*J)<150&&(o.current={blobIndex:1,offsetX:E.targetX-S,offsetY:E.targetY-T})},[]),k=g.useCallback(x=>{if(!o.current)return;const C=e.current;if(!C)return;const j=C.getBoundingClientRect(),P=C.width/j.width,R=C.height/j.height,S=(x.clientX-j.left)*P,T=(x.clientY-j.top)*R,E=t.current[o.current.blobIndex];E.targetX=S+o.current.offsetX,E.targetY=T+o.current.offsetY},[]),w=g.useCallback(()=>{o.current=null},[]),m=g.useCallback(()=>{t.current=[Vr(Lo/3,No/2,"#27ae60","T"),Vr(Lo*2/3,No/2,"#27ae60","U")],n.current=[],r.current=-1},[]),h=g.useCallback(x=>{const C=t.current[x];for(const j of C.vertices){const P=j.homeOffset.x,R=j.homeOffset.y;j.homeOffset.x=R,j.homeOffset.y=-P}for(const j of C.blocks){const P=j.center.x,R=j.center.y;j.center.x=R,j.center.y=-P}},[]);return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-4: Two Blobs Attraction"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:'Do vertex springs create the "reaching" effect?'}),l.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("canvas",{ref:e,width:Lo,height:No,onMouseDown:v,onMouseMove:k,onMouseUp:w,onMouseLeave:w,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"grab"}}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"280px"},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[l.jsxs("span",{children:["FPS: ",f]}),l.jsxs("span",{children:["Springs: ",p]})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsx("div",{style:{fontWeight:"bold",color:"#f39c12"},children:"Attraction Settings"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Attraction Radius: ",a.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:a.attractionRadius,onChange:x=>i(C=>({...C,attractionRadius:parseInt(x.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Rest Length: ",a.attractionRestLength,"px"]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:a.attractionRestLength,onChange:x=>i(C=>({...C,attractionRestLength:parseInt(x.target.value)}))}),l.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"0 = vertices touch"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Attraction Stiffness: ",a.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.1",step:"0.005",value:a.attractionStiffness,onChange:x=>i(C=>({...C,attractionStiffness:parseFloat(x.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Break Distance: ",a.breakDistance,"px"]}),l.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:a.breakDistance,onChange:x=>i(C=>({...C,breakDistance:parseInt(x.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsx("div",{style:{fontWeight:"bold",color:"#3498db"},children:"Blob Physics"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Home Stiffness: ",a.homeStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.01",value:a.homeStiffness,onChange:x=>i(C=>({...C,homeStiffness:parseFloat(x.target.value)}))})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[l.jsxs("span",{children:["Damping: ",a.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:a.damping,onChange:x=>i(C=>({...C,damping:parseFloat(x.target.value)}))})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[l.jsx("input",{type:"checkbox",checked:c,onChange:x=>u(x.target.checked)}),l.jsx("span",{children:"Show Debug (springs, radius)"})]}),l.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),l.jsxs("div",{style:{display:"flex",gap:"10px"},children:[l.jsx("button",{onClick:()=>h(0),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate T"}),l.jsx("button",{onClick:()=>h(1),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate U"})]}),l.jsx("button",{onClick:m,style:{padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]})]}),l.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"860px"},children:[l.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-4 Goals:"}),l.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[l.jsx("li",{children:'Drag blobs close together - watch for "reaching" effect'}),l.jsx("li",{children:"Vertices should stretch toward each other before touching"}),l.jsx("li",{children:"Orange dashed lines = attraction springs forming"}),l.jsx("li",{children:"Drag apart - springs should break cleanly"}),l.jsx("li",{children:"Success = gummy/stretchy feel, NOT magnetic snap"})]})]})]})}const B0=30,Kv=600,Zv=450,Qv={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08},Ql={none:{enabled:!1,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6},subtle:{enabled:!0,stdDeviation:10,alphaMultiplier:20,alphaOffset:-8},medium:{enabled:!0,stdDeviation:15,alphaMultiplier:24,alphaOffset:-7},aggressive:{enabled:!0,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6}};function Jv(e,t){const n=[],s=[],r=B0*.45,o=8,a=12,i=[{x:-r,y:-r},{x:r,y:-r},{x:r,y:r},{x:-r,y:r}];for(let u=0;u<4;u++){const f=i[u],d={x:-Math.sign(f.x),y:-Math.sign(f.y)},p=f.x+d.x*o,y=f.y,v=f.x,k=f.y+d.y*o;u===0?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):u===1?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1}):u===2?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1})}for(let u=0;u<a;u++){const f=(u+1)%a,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:f,restLength:Math.sqrt(d*d+p*p)})}for(let u=0;u<a/2;u++){const f=(u+a/2)%a,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:Math.floor(f),restLength:Math.sqrt(d*d+p*p)})}let c=0;for(let u=0;u<a;u++){const f=(u+1)%a;c+=n[u].homeOffset.x*n[f].homeOffset.y,c-=n[f].homeOffset.x*n[u].homeOffset.y}return{vertices:n,springs:s,restArea:Math.abs(c)/2,centerOffset:{x:e,y:t}}}function id(e,t,n,s){const r=[],o=B0;let a;n==="T"?a=[{x:-o,y:-o*.5},{x:0,y:-o*.5},{x:o,y:-o*.5},{x:0,y:o*.5}]:a=[{x:-o,y:-o*.5},{x:o,y:-o*.5},{x:-o,y:o*.5},{x:0,y:o*.5},{x:o,y:o*.5}];for(const c of a){const u=Jv(c.x,c.y);r.push(u)}const i={blocks:r,targetX:e,targetY:t,rotation:0,color:s};return e2(i),i}function Hi(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function e2(e){for(const t of e.blocks){const n=Hi(t.centerOffset.x,t.centerOffset.y,e.rotation),s=e.targetX+n.x,r=e.targetY+n.y;for(const o of t.vertices){const a=Hi(o.homeOffset.x,o.homeOffset.y,e.rotation),i=s+a.x,c=r+a.y;o.pos.x===0&&o.pos.y===0&&(o.pos={x:i,y:c},o.oldPos={x:i,y:c})}}}function t2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function n2(e,t,n){const s=Hi(t.centerOffset.x,t.centerOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const a of t.vertices){const i=Hi(a.homeOffset.x,a.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-a.pos.x,d=u-a.pos.y;a.pos.x+=f*n.homeStiffness,a.pos.y+=d*n.homeStiffness}}function s2(e,t){for(const n of e.springs){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function o2(e,t){const n=e.vertices.length;let s=0;for(let c=0;c<n;c++){const u=(c+1)%n;s+=e.vertices[c].pos.x*e.vertices[u].pos.y,s-=e.vertices[u].pos.x*e.vertices[c].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;let a=0,i=0;for(const c of e.vertices)a+=c.pos.x,i+=c.pos.y;a/=n,i/=n;for(const c of e.vertices){const u=c.pos.x-a,f=c.pos.y-i,d=Math.sqrt(u*u+f*f);d>1e-4&&(c.pos.x+=u/d*o,c.pos.y+=f/d*o)}}function r2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function i2(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],a=n[r],i=n[(r+1)%t],c=n[(r+2)%t],{cp1:u,cp2:f}=r2(o,a,i,c);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${i.x} ${i.y}`}return s+" Z"}function l2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef(null),o=g.useRef({x:0,y:0}),[a]=g.useState(Qv),[i,c]=g.useState(Ql.aggressive),[u,f]=g.useState("aggressive"),[,d]=g.useState({});g.useEffect(()=>{const h=[id(180,250,"T","#e74c3c"),id(380,250,"U","#e74c3c")];s.current=h},[]),g.useEffect(()=>{let h=!0;const x=C=>{if(h){n.current=C,h=!1,t.current=requestAnimationFrame(x);return}const j=Math.min((C-n.current)/1e3,.033);n.current=C;for(const P of s.current)for(const R of P.blocks){t2(R,a,j),n2(P,R,a);for(let S=0;S<a.iterations;S++)s2(R,a);o2(R,a)}d({}),t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[a]);const p=g.useCallback(h=>{const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),j=h.clientX-C.left,P=h.clientY-C.top;for(let R=0;R<s.current.length;R++){const S=s.current[R],T=j-S.targetX,E=P-S.targetY;if(T*T+E*E<80*80){r.current=R,o.current={x:T,y:E},h.target.setPointerCapture(h.pointerId);break}}},[]),y=g.useCallback(h=>{if(r.current===null)return;const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),j=h.clientX-C.left-o.current.x,P=h.clientY-C.top-o.current.y;s.current[r.current].targetX=j,s.current[r.current].targetY=P},[]),v=g.useCallback(()=>{r.current=null},[]),k=h=>{const x=s.current[h];x.rotation=(x.rotation+90)%360},w=h=>{const x=Ql[h];x&&(c(x),f(h))},m=()=>{const{alphaMultiplier:h,alphaOffset:x}=i;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${h} ${x}`};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5: Goo Filter Variations"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Drag pieces to overlap. Use Rotate buttons. Both pieces are same color for merge test."}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Ql).map(h=>l.jsx("button",{onClick:()=>w(h),style:{padding:"8px 16px",background:u===h?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:u===h?"bold":"normal"},children:h.charAt(0).toUpperCase()+h.slice(1)},h))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",i.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:i.stdDeviation,onChange:h=>{c(x=>({...x,stdDeviation:Number(h.target.value)})),f("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",i.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:i.alphaMultiplier,onChange:h=>{c(x=>({...x,alphaMultiplier:Number(h.target.value)})),f("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",i.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:i.alphaOffset,onChange:h=>{c(x=>({...x,alphaOffset:Number(h.target.value)})),f("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:i.enabled,onChange:h=>{c(x=>({...x,enabled:h.target.checked})),f(h.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>k(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>k(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"})]})]}),l.jsxs("svg",{ref:e,width:Kv,height:Zv,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:p,onPointerMove:y,onPointerUp:v,onPointerLeave:v,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:i.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:m(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:180,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T-tetromino"}),l.jsx("text",{x:380,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U-pentomino"}),l.jsx("g",{filter:i.enabled?"url(#goo-filter)":void 0,children:s.current.map((h,x)=>h.blocks.map((C,j)=>l.jsx("path",{d:i2(C.vertices),fill:h.color,stroke:h.color,strokeWidth:2},`${x}-${j}`)))}),s.current.map((h,x)=>l.jsx("circle",{cx:h.targetX,cy:h.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${x}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Goal:"})," Find filter settings where blocks within a piece merge smoothly, AND where two pieces overlap their blocks also merge into one membrane.",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Test:"})," Drag the T into the U's alcove. Rotate pieces. Watch how blocks merge visually."]})]})}const a2=30,c2=600,u2=450,f2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25},Jl={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function ea(e,t,n,s){const r=[],o=[],a=[],i=a2;let c,u;const f=1.5,d=.3,p=1;let y;if(n==="T")c=[{x:-1.5*i,y:-1*i},{x:-.5*i,y:-1*i},{x:.5*i,y:-1*i},{x:1.5*i,y:-1*i},{x:1.5*i,y:0*i},{x:.5*i,y:0*i},{x:.5*i,y:1*i},{x:-.5*i,y:1*i},{x:-.5*i,y:0*i},{x:-1.5*i,y:0*i}],y=[f,p,p,f,p,d,f,f,d,p],u=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")c=[{x:-1.5*i,y:-1*i},{x:-.5*i,y:-1*i},{x:-.5*i,y:0*i},{x:.5*i,y:0*i},{x:.5*i,y:-1*i},{x:1.5*i,y:-1*i},{x:1.5*i,y:0*i},{x:1.5*i,y:1*i},{x:.5*i,y:1*i},{x:-.5*i,y:1*i},{x:-1.5*i,y:1*i},{x:-1.5*i,y:0*i}],y=[f,f,d,d,f,f,p,f,p,p,f,p],u=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else{const m=.08*i;c=[{x:-1.5*i,y:-1.5*i},{x:-.5*i,y:-1.5*i},{x:-.5*i,y:-.5*i},{x:-m,y:-.5*i},{x:-m,y:-.5*i+m},{x:-.5*i,y:-.5*i+m},{x:-.5*i,y:1.5*i},{x:.5*i,y:1.5*i},{x:.5*i,y:-.5*i+m},{x:m,y:-.5*i+m},{x:m,y:-.5*i},{x:.5*i,y:-.5*i},{x:.5*i,y:-1.5*i},{x:1.5*i,y:-1.5*i},{x:1.5*i,y:-.5*i},{x:.5*i+m,y:-.5*i},{x:.5*i+m,y:-.5*i-m},{x:-.5*i-m,y:-.5*i-m},{x:-.5*i-m,y:-.5*i},{x:-1.5*i,y:-.5*i}],y=[f,p,f,d,d,f,f,f,f,d,d,f,p,f,f,d,d,d,d,p],u=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}for(let m=0;m<c.length;m++){const h=c[m];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:y[m]})}const v=r.length;for(let m=0;m<v;m++){const h=(m+1)%v,x=r[h].homeOffset.x-r[m].homeOffset.x,C=r[h].homeOffset.y-r[m].homeOffset.y;o.push({a:m,b:h,restLength:Math.sqrt(x*x+C*C)})}for(const[m,h]of u){const x=r[h].homeOffset.x-r[m].homeOffset.x,C=r[h].homeOffset.y-r[m].homeOffset.y;a.push({a:m,b:h,restLength:Math.sqrt(x*x+C*C)})}let k=0;for(let m=0;m<v;m++){const h=(m+1)%v;k+=r[m].homeOffset.x*r[h].homeOffset.y,k-=r[h].homeOffset.x*r[m].homeOffset.y}const w=Math.abs(k)/2;return{vertices:r,ringsprings:o,crossSprings:a,restArea:w,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function d2(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function p2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function h2(e,t){for(const n of e.vertices){const s=d2(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.homeStiffness,n.pos.y+=i*t.homeStiffness}}function x2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function y2(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function m2(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function g2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;a.pos.x+=k,a.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function v2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function S2(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],a=n[r],i=n[(r+1)%t],c=n[(r+2)%t],{cp1:u,cp2:f}=v2(o,a,i,c);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${i.x} ${i.y}`}return s+" Z"}function C2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),a=g.useRef({x:0,y:0}),[i,c]=g.useState(f2),[u,f]=g.useState(Jl.medium),[d,p]=g.useState("medium"),[y,v]=g.useState(!1),[,k]=g.useState({});g.useEffect(()=>{const P=[ea(120,250,"T","#e74c3c"),ea(300,250,"U","#e74c3c"),ea(480,250,"Corrupt","#e74c3c")];s.current=P},[]),g.useEffect(()=>{let P=!0;const R=S=>{if(P){n.current=S,P=!1,t.current=requestAnimationFrame(R);return}const T=Math.min((S-n.current)/1e3,.033);n.current=S;for(const E of s.current){p2(E,i,T),h2(E,i);for(let M=0;M<i.iterations;M++)x2(E,i);E.usePressure&&y2(E,i)}r.current=m2(s.current,r.current,i),g2(s.current,r.current,i),k({}),t.current=requestAnimationFrame(R)};return t.current=requestAnimationFrame(R),()=>cancelAnimationFrame(t.current)},[i]);const w=g.useCallback(P=>{const R=e.current;if(!R)return;const S=R.getBoundingClientRect(),T=P.clientX-S.left,E=P.clientY-S.top;for(let M=0;M<s.current.length;M++){const U=s.current[M],J=T-U.targetX,se=E-U.targetY;if(J*J+se*se<80*80){o.current=M,a.current={x:J,y:se},P.target.setPointerCapture(P.pointerId);break}}},[]),m=g.useCallback(P=>{if(o.current===null)return;const R=e.current;if(!R)return;const S=R.getBoundingClientRect(),T=P.clientX-S.left-a.current.x,E=P.clientY-S.top-a.current.y;s.current[o.current].targetX=T,s.current[o.current].targetY=E},[]),h=g.useCallback(()=>{o.current=null},[]),x=P=>{s.current[P].rotation=(s.current[P].rotation+90)%360},C=P=>{const R=Jl[P];R&&(f(R),p(P))},j=()=>{const{alphaMultiplier:P,alphaOffset:R}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${P} ${R}`};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5b: Single Perimeter Shapes"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Each shape is ONE continuous soft body (not composed of blocks). Same color for merge test."}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(Jl).map(P=>l.jsx("button",{onClick:()=>C(P),style:{padding:"8px 16px",background:d===P?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===P?"bold":"normal"},children:P.charAt(0).toUpperCase()+P.slice(1)},P))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",u.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:P=>{f(R=>({...R,stdDeviation:Number(P.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:P=>{f(R=>({...R,alphaMultiplier:Number(P.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:P=>{f(R=>({...R,alphaOffset:Number(P.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:u.enabled,onChange:P=>{f(R=>({...R,enabled:P.target.checked})),p(P.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),l.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),l.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:P=>c(R=>({...R,goopiness:Number(P.target.value)})),style:{width:120}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance (mozzarella)"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:P=>c(R=>({...R,attractionRadius:Number(P.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"How close to connect"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:P=>c(R=>({...R,attractionStiffness:Number(P.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Pull force (10%-100%)"})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:l.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:y,onChange:P=>v(P.target.checked)}),l.jsx("span",{children:"Show Springs"})]})]}),l.jsxs("svg",{ref:e,width:c2,height:u2,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:w,onPointerMove:m,onPointerUp:h,onPointerLeave:h,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-5b",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),l.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),l.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),l.jsxs("g",{filter:u.enabled?"url(#goo-filter-5b)":void 0,children:[r.current.map((P,R)=>{var K,re;const S=(K=s.current[P.blobA])==null?void 0:K.vertices[P.vertA],T=(re=s.current[P.blobB])==null?void 0:re.vertices[P.vertB];if(!S||!T)return null;const E=T.pos.x-S.pos.x,M=T.pos.y-S.pos.y,U=Math.sqrt(E*E+M*M),J=Math.min(1,U/i.goopiness),se=8,N=4,Y=se-(se-N)*J,ee=Y*1.5,B=Math.max(2,Math.ceil(U/ee)),Q=[];for(let oe=0;oe<=B;oe++){const ve=oe/B,Pe=1-.3*Math.sin(ve*Math.PI),be=Y*Pe;Q.push({cx:S.pos.x+E*ve,cy:S.pos.y+M*ve,r:Math.max(N*.5,be)})}return l.jsx("g",{children:Q.map((oe,ve)=>l.jsx("circle",{cx:oe.cx,cy:oe.cy,r:oe.r,fill:"#e74c3c"},ve))},`tendril-${R}`)}),s.current.map((P,R)=>l.jsx("path",{d:S2(P.vertices),fill:P.color,stroke:P.color,strokeWidth:2},R))]}),y&&r.current.map((P,R)=>{var Y,ee;const S=(Y=s.current[P.blobA])==null?void 0:Y.vertices[P.vertA],T=(ee=s.current[P.blobB])==null?void 0:ee.vertices[P.vertB];if(!S||!T)return null;const E=T.pos.x-S.pos.x,M=T.pos.y-S.pos.y,J=Math.sqrt(E*E+M*M)/i.goopiness,se=Math.min(255,Math.floor(J*255)),N=Math.max(0,255-Math.floor(J*255));return l.jsx("line",{x1:S.pos.x,y1:S.pos.y,x2:T.pos.x,y2:T.pos.y,stroke:`rgb(${se},${N},100)`,strokeWidth:2,opacity:.7},`spring-${R}`)}),s.current.map((P,R)=>l.jsx("circle",{cx:P.targetX,cy:P.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${R}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-5b + Attraction:"}),' Single-perimeter shapes with physics-based attraction springs. When pieces get close, springs form. Pull them apart to see the "mozzarella pull" effect  they stretch until breaking at the Goopiness distance.',l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Goopiness:"}),' Controls how far the "mozzarella strings" stretch before snapping. Higher = longer stretchy connections when pulling apart.',l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Stiffness Ramp:"})," Attraction is weak (10%) at max distance (reaching effect) and strong (100%) when close (solid merge). This creates natural-looking goop behavior.",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Test:"})," Drag T into U's notch, let them merge, then slowly pull apart to see the stretching effect."]})]})}const k2=30,w2=600,R2=450,P2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ta={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function na(e,t,n,s){const r=[],o=[],a=[],i=[],c=k2;let u,f;const d=1.5,p=.3,y=1;let v;if(n==="T")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],v=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],v=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*c;u=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-x,y:-.5*c},{x:-x,y:-.5*c+x},{x:-.5*c,y:-.5*c+x},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+x},{x,y:-.5*c+x},{x,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+x,y:-.5*c},{x:.5*c+x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c},{x:-1.5*c,y:-.5*c}],v=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*c,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:.5*c},{x:-.5*c,y:.5*c}],v=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c}],v=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:v[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const k=r.length;for(let x=0;x<k;x++){const C=(x+1)%k,j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;a.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}for(const[x,C]of f){const j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;i.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}let w=0;for(let x=0;x<k;x++){const C=(x+1)%k;w+=r[x].homeOffset.x*r[C].homeOffset.y,w-=r[C].homeOffset.x*r[x].homeOffset.y}const m=Math.abs(w)/2;let h;if(n==="Corrupt"){const x=.5*c;h=[{offsetX:-c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-c},{x,y:-c},{x,y:c},{x:-x,y:c}],outerVertexIndices:[5,8,7,6]}].map(j=>{const P=j.points.map(R=>{const S=e+j.offsetX+R.x,T=t+j.offsetY+R.y;return{pos:{x:S,y:T},oldPos:{x:S,y:T},homeOffset:{x:R.x,y:R.y}}});return{...j,vertices:P,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:a,crossSprings:i,restArea:m,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function qr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function j2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,a=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=a+10*n*n}}function T2(e,t){for(const n of e.vertices){const s=qr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.homeStiffness,n.pos.y+=i*t.homeStiffness}for(const n of e.innerVertices){const s=qr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.innerHomeStiffness,n.pos.y+=i*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=qr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const a of n.vertices){const i=qr(a.homeOffset.x,a.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-a.pos.x,d=u-a.pos.y;a.pos.x+=f*t.innerHomeStiffness,a.pos.y+=d*t.innerHomeStiffness}}}function b2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function M2(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function A2(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function E2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;a.pos.x+=k,a.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function I2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function lc(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=I2(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function _2(e){return lc(e.map(t=>t.pos))}function ld(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,J=s[o]*.4,se=Math.min(t,J);r.push({x:i.x+R*se*Math.min(U,3),y:i.y+S*se*Math.min(U,3)})}return r}function O2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),a=g.useRef({x:0,y:0}),[i,c]=g.useState(P2),[u,f]=g.useState(ta.medium),[d,p]=g.useState("medium"),[y,v]=g.useState(!1),[,k]=g.useState({});g.useEffect(()=>{const R=[na(120,250,"T","#e74c3c"),na(300,250,"U","#e74c3c"),na(480,250,"Corrupt","#e74c3c")];s.current=R},[]),g.useEffect(()=>{let R=!0;const S=T=>{if(R){n.current=T,R=!1,t.current=requestAnimationFrame(S);return}const E=Math.min((T-n.current)/1e3,.033);n.current=T;for(const M of s.current){j2(M,i,E),T2(M,i);for(let U=0;U<i.iterations;U++)b2(M,i);M.usePressure&&M2(M,i)}r.current=A2(s.current,r.current,i),E2(s.current,r.current,i),k({}),t.current=requestAnimationFrame(S)};return t.current=requestAnimationFrame(S),()=>cancelAnimationFrame(t.current)},[i]);const w=g.useCallback(R=>{const S=e.current;if(!S)return;const T=S.getBoundingClientRect(),E=R.clientX-T.left,M=R.clientY-T.top;for(let U=0;U<s.current.length;U++){const J=s.current[U],se=E-J.targetX,N=M-J.targetY;if(se*se+N*N<80*80){o.current=U,a.current={x:se,y:N},R.target.setPointerCapture(R.pointerId);break}}},[]),m=g.useCallback(R=>{if(o.current===null)return;const S=e.current;if(!S)return;const T=S.getBoundingClientRect(),E=R.clientX-T.left-a.current.x,M=R.clientY-T.top-a.current.y;s.current[o.current].targetX=E,s.current[o.current].targetY=M},[]),h=g.useCallback(()=>{o.current=null},[]),x=R=>{s.current[R].rotation=(s.current[R].rotation+90)%360},C=R=>{const S=ta[R];S&&(f(S),p(R))},j=()=>{const{alphaMultiplier:R,alphaOffset:S}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${R} ${S}`},P="#2c3e50";return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5c: Cell Wall (Outer - Inner)"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Outer gooey silhouette + stable inner core = visible cell wall ring"}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ta).map(R=>l.jsx("button",{onClick:()=>C(R),style:{padding:"8px 16px",background:d===R?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===R?"bold":"normal"},children:R.charAt(0).toUpperCase()+R.slice(1)},R))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",u.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:R=>{f(S=>({...S,stdDeviation:Number(R.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:R=>{f(S=>({...S,alphaMultiplier:Number(R.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:R=>{f(S=>({...S,alphaOffset:Number(R.target.value)})),p("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:u.enabled,onChange:R=>{f(S=>({...S,enabled:R.target.checked})),p(R.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),l.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",i.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i.innerHomeStiffness,onChange:R=>c(S=>({...S,innerHomeStiffness:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),l.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:R=>c(S=>({...S,goopiness:Number(R.target.value)})),style:{width:120}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:R=>c(S=>({...S,attractionRadius:Number(R.target.value)})),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:R=>c(S=>({...S,attractionStiffness:Number(R.target.value)})),style:{width:100}})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:l.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:y,onChange:R=>v(R.target.checked)}),l.jsx("span",{children:"Show Springs"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",i.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:i.tendrilEndRadius,onChange:R=>c(S=>({...S,tendrilEndRadius:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",i.tendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:i.tendrilSkinniness,onChange:R=>c(S=>({...S,tendrilSkinniness:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",i.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:i.wallThickness,onChange:R=>c(S=>({...S,wallThickness:Number(R.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),l.jsxs("svg",{ref:e,width:w2,height:R2,style:{background:P,borderRadius:8,cursor:"grab"},onPointerDown:w,onPointerMove:m,onPointerUp:h,onPointerLeave:h,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-5c",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),l.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),l.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),l.jsxs("g",{filter:u.enabled?"url(#goo-filter-5c)":void 0,children:[r.current.map((R,S)=>{var ve,Pe;const T=(ve=s.current[R.blobA])==null?void 0:ve.vertices[R.vertA],E=(Pe=s.current[R.blobB])==null?void 0:Pe.vertices[R.vertB];if(!T||!E)return null;const M=E.pos.x-T.pos.x,U=E.pos.y-T.pos.y,J=Math.sqrt(M*M+U*U),se=Math.min(1,J/i.goopiness),N=i.tendrilEndRadius,Y=1-i.tendrilSkinniness,ee=1-i.tendrilSkinniness*.3,B=ee-(ee-Y)*se,Q=N*B,K=N*1.4,re=Math.max(2,Math.ceil(J/K)),oe=[];for(let be=0;be<=re;be++){const A=be/re,G=Math.sin(A*Math.PI),X=N-(N-Q)*G;oe.push({cx:T.pos.x+M*A,cy:T.pos.y+U*A,r:Math.max(2,X)})}return l.jsx("g",{children:oe.map((be,A)=>l.jsx("circle",{cx:be.cx,cy:be.cy,r:be.r,fill:"#e74c3c"},A))},`tendril-${S}`)}),s.current.map((R,S)=>l.jsx("path",{d:_2(R.vertices),fill:R.color,stroke:R.color,strokeWidth:2},S))]}),s.current.map((R,S)=>{if(R.innerRegions)return R.innerRegions.map((T,E)=>{let M;T.outerVertexIndices?M=T.outerVertexIndices.map(J=>R.vertices[J].pos):M=T.vertices.map(J=>J.pos);const U=ld(M,i.wallThickness);return l.jsx("path",{d:lc(U),fill:P},`inner-${S}-${E}`)});{const T=R.vertices.map(M=>M.pos),E=ld(T,i.wallThickness);return l.jsx("path",{d:lc(E),fill:P},`inner-${S}`)}}),y&&r.current.map((R,S)=>{var ee,B;const T=(ee=s.current[R.blobA])==null?void 0:ee.vertices[R.vertA],E=(B=s.current[R.blobB])==null?void 0:B.vertices[R.vertB];if(!T||!E)return null;const M=E.pos.x-T.pos.x,U=E.pos.y-T.pos.y,se=Math.sqrt(M*M+U*U)/i.goopiness,N=Math.min(255,Math.floor(se*255)),Y=Math.max(0,255-Math.floor(se*255));return l.jsx("line",{x1:T.pos.x,y1:T.pos.y,x2:E.pos.x,y2:E.pos.y,stroke:`rgb(${N},${Y},100)`,strokeWidth:2,opacity:.7},`spring-${S}`)}),s.current.map((R,S)=>l.jsx("circle",{cx:R.targetX,cy:R.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${S}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-5c: Cell Wall Model"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Two layers:"}),l.jsx("br",{})," ",l.jsx("strong",{children:"Outer"})," (gooey): Stretches, merges with filter effect",l.jsx("br",{})," ",l.jsx("strong",{children:"Inner"})," (stable): Barely moves, cuts out the center",l.jsx("br",{})," ",l.jsx("strong",{children:"Cell Wall"}),": The visible ring between them",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Inner Stiffness:"})," Controls how stable the core is (higher = more rigid)",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Next:"})," Dynamic rebuilding when pieces lock (merge walls) or become loose goop (amputate)"]})]})}const L2=30,N2=600,D2=450,$2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},sa={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},F2={autoFill:!0,fillRate:.15},ad=1.15,G2=200;function oa(e,t,n,s){const r=[],o=[],a=[],i=[],c=L2;let u,f;const d=1.5,p=.3,y=1;let v;if(n==="T")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],v=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],v=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*c;u=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-x,y:-.5*c},{x:-x,y:-.5*c+x},{x:-.5*c,y:-.5*c+x},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+x},{x,y:-.5*c+x},{x,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+x,y:-.5*c},{x:.5*c+x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c},{x:-1.5*c,y:-.5*c}],v=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*c,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:.5*c},{x:-.5*c,y:.5*c}],v=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c}],v=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:v[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const k=r.length;for(let x=0;x<k;x++){const C=(x+1)%k,j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;a.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}for(const[x,C]of f){const j=r[C].homeOffset.x-r[x].homeOffset.x,P=r[C].homeOffset.y-r[x].homeOffset.y;i.push({a:x,b:C,restLength:Math.sqrt(j*j+P*P)})}let w=0;for(let x=0;x<k;x++){const C=(x+1)%k;w+=r[x].homeOffset.x*r[C].homeOffset.y,w-=r[C].homeOffset.x*r[x].homeOffset.y}const m=Math.abs(w)/2;let h;if(n==="Corrupt"){const x=.5*c;h=[{offsetX:-c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-c},{x,y:-c},{x,y:c},{x:-x,y:c}],outerVertexIndices:[5,8,7,6]}].map(j=>{const P=j.points.map(R=>{const S=e+j.offsetX+R.x,T=t+j.offsetY+R.y;return{pos:{x:S,y:T},oldPos:{x:S,y:T},homeOffset:{x:R.x,y:R.y}}});return{...j,vertices:P,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:a,crossSprings:i,restArea:m,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt",fillAmount:0,isShaking:!1,boopScale:1,wasFullLastFrame:!1}}function Kr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function B2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,a=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=a+10*n*n}}function z2(e,t){for(const n of e.vertices){const s=Kr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.homeStiffness,n.pos.y+=i*t.homeStiffness}for(const n of e.innerVertices){const s=Kr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,a=r-n.pos.x,i=o-n.pos.y;n.pos.x+=a*t.innerHomeStiffness,n.pos.y+=i*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Kr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const a of n.vertices){const i=Kr(a.homeOffset.x,a.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-a.pos.x,d=u-a.pos.y;a.pos.x+=f*t.innerHomeStiffness,a.pos.y+=d*t.innerHomeStiffness}}}function Y2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function H2(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function W2(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function U2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-a.pos.x,u=i.pos.y-a.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(a.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;a.pos.x+=k,a.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function X2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function z0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=X2(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function V2(e){return z0(e.map(t=>t.pos))}function cd(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,J=s[o]*.4,se=Math.min(t,J);r.push({x:i.x+R*se*Math.min(U,3),y:i.y+S*se*Math.min(U,3)})}return r}function q2(){var U,J,se;const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),a=g.useRef({x:0,y:0}),[i,c]=g.useState($2),[u,f]=g.useState(F2),[d,p]=g.useState(sa.medium),[y,v]=g.useState("medium"),[k,w]=g.useState(!1),[,m]=g.useState({});g.useEffect(()=>{const N=[oa(120,250,"T","#e74c3c"),oa(300,250,"U","#e74c3c"),oa(480,250,"Corrupt","#e74c3c")];s.current=N},[]),g.useEffect(()=>{let N=!0;const Y=ee=>{if(N){n.current=ee,N=!1,t.current=requestAnimationFrame(Y);return}const B=Math.min((ee-n.current)/1e3,.033);n.current=ee;for(const Q of s.current){B2(Q,i,B),z2(Q,i);for(let re=0;re<i.iterations;re++)Y2(Q,i);Q.usePressure&&H2(Q,i),u.autoFill&&Q.fillAmount<1&&(Q.fillAmount=Math.min(1,Q.fillAmount+u.fillRate*B));const K=Q.fillAmount>=1;if(K&&!Q.wasFullLastFrame&&(Q.boopScale=ad),Q.wasFullLastFrame=K,Q.boopScale>1){const re=(ad-1)/(G2/1e3);Q.boopScale=Math.max(1,Q.boopScale-re*B)}}r.current=W2(s.current,r.current,i),U2(s.current,r.current,i),m({}),t.current=requestAnimationFrame(Y)};return t.current=requestAnimationFrame(Y),()=>cancelAnimationFrame(t.current)},[i,u]);const h=g.useCallback(N=>{const Y=e.current;if(!Y)return;const ee=Y.getBoundingClientRect(),B=N.clientX-ee.left,Q=N.clientY-ee.top;for(let K=0;K<s.current.length;K++){const re=s.current[K],oe=B-re.targetX,ve=Q-re.targetY;if(oe*oe+ve*ve<80*80){re.fillAmount<1&&(re.isShaking=!0,setTimeout(()=>{re.isShaking=!1,m({})},300)),o.current=K,a.current={x:oe,y:ve},N.target.setPointerCapture(N.pointerId);break}}},[]),x=g.useCallback(N=>{if(o.current===null)return;const Y=e.current;if(!Y)return;const ee=Y.getBoundingClientRect(),B=N.clientX-ee.left-a.current.x,Q=N.clientY-ee.top-a.current.y;s.current[o.current].targetX=B,s.current[o.current].targetY=Q},[]),C=g.useCallback(()=>{o.current=null},[]),j=N=>{s.current[N].rotation=(s.current[N].rotation+90)%360},P=()=>{for(const N of s.current)N.fillAmount=0,N.wasFullLastFrame=!1,N.boopScale=1},R=N=>{const Y=sa[N];Y&&(p(Y),v(N))},S=()=>{const{alphaMultiplier:N,alphaOffset:Y}=d;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${N} ${Y}`},T="#2c3e50",E=N=>{let Y=1/0,ee=-1/0,B=1/0,Q=-1/0;for(const K of N)K.x<Y&&(Y=K.x),K.x>ee&&(ee=K.x),K.y<B&&(B=K.y),K.y>Q&&(Q=K.y);return{minX:Y,maxX:ee,minY:B,maxY:Q}},M=`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  `;return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("style",{children:M}),l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-6: Fill / Pour"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:'Goop fills the cell wall container over time  visual "time to pop" mechanic'}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(sa).map(N=>l.jsx("button",{onClick:()=>R(N),style:{padding:"8px 16px",background:y===N?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:y===N?"bold":"normal"},children:N.charAt(0).toUpperCase()+N.slice(1)},N))}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:"bold"},children:[l.jsx("input",{type:"checkbox",checked:u.autoFill,onChange:N=>f(Y=>({...Y,autoFill:N.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Fill Rate: ",u.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:u.fillRate,onChange:N=>f(Y=>({...Y,fillRate:Number(N.target.value)})),style:{width:120}})]}),l.jsx("button",{onClick:P,style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Fill"}),l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:12},children:[l.jsxs("span",{children:["T: ",Math.round(((U=s.current[0])==null?void 0:U.fillAmount)*100||0),"%"]}),l.jsxs("span",{children:["U: ",Math.round(((J=s.current[1])==null?void 0:J.fillAmount)*100||0),"%"]}),l.jsxs("span",{children:["C: ",Math.round(((se=s.current[2])==null?void 0:se.fillAmount)*100||0),"%"]})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Blur: ",d.stdDeviation]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:d.stdDeviation,onChange:N=>{p(Y=>({...Y,stdDeviation:Number(N.target.value)})),v("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Mult: ",d.alphaMultiplier]}),l.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:d.alphaMultiplier,onChange:N=>{p(Y=>({...Y,alphaMultiplier:Number(N.target.value)})),v("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Alpha Offset: ",d.alphaOffset]}),l.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:d.alphaOffset,onChange:N=>{p(Y=>({...Y,alphaOffset:Number(N.target.value)})),v("custom")},style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:d.enabled,onChange:N=>{p(Y=>({...Y,enabled:N.target.checked})),v(N.target.checked?"custom":"none")}}),l.jsx("span",{children:"Filter On"})]}),l.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[l.jsx("button",{onClick:()=>j(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),l.jsx("button",{onClick:()=>j(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),l.jsx("button",{onClick:()=>j(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),l.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",i.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i.innerHomeStiffness,onChange:N=>c(Y=>({...Y,innerHomeStiffness:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),l.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:N=>c(Y=>({...Y,goopiness:Number(N.target.value)})),style:{width:120}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:N=>c(Y=>({...Y,attractionRadius:Number(N.target.value)})),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:N=>c(Y=>({...Y,attractionStiffness:Number(N.target.value)})),style:{width:100}})]}),l.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:l.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[l.jsx("input",{type:"checkbox",checked:k,onChange:N=>w(N.target.checked)}),l.jsx("span",{children:"Show Springs"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",i.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:i.tendrilEndRadius,onChange:N=>c(Y=>({...Y,tendrilEndRadius:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",i.tendrilSkinniness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:i.tendrilSkinniness,onChange:N=>c(Y=>({...Y,tendrilSkinniness:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[l.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",i.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:i.wallThickness,onChange:N=>c(Y=>({...Y,wallThickness:Number(N.target.value)})),style:{width:100}}),l.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),l.jsxs("svg",{ref:e,width:N2,height:D2,style:{background:T,borderRadius:8,cursor:"grab"},onPointerDown:h,onPointerMove:x,onPointerUp:C,onPointerLeave:C,children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-6",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:d.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:S(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),l.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),l.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),l.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),l.jsxs("g",{filter:d.enabled?"url(#goo-filter-6)":void 0,children:[r.current.map((N,Y)=>{var ie,le;const ee=(ie=s.current[N.blobA])==null?void 0:ie.vertices[N.vertA],B=(le=s.current[N.blobB])==null?void 0:le.vertices[N.vertB];if(!ee||!B)return null;const Q=B.pos.x-ee.pos.x,K=B.pos.y-ee.pos.y,re=Math.sqrt(Q*Q+K*K),oe=Math.min(1,re/i.goopiness),ve=i.tendrilEndRadius,Pe=1-i.tendrilSkinniness,be=1-i.tendrilSkinniness*.3,A=be-(be-Pe)*oe,G=ve*A,X=ve*1.4,W=Math.max(2,Math.ceil(re/X)),fe=[];for(let q=0;q<=W;q++){const ke=q/W,Ce=Math.sin(ke*Math.PI),je=ve-(ve-G)*Ce;fe.push({cx:ee.pos.x+Q*ke,cy:ee.pos.y+K*ke,r:Math.max(2,je)})}return l.jsx("g",{children:fe.map((q,ke)=>l.jsx("circle",{cx:q.cx,cy:q.cy,r:q.r,fill:"#e74c3c"},ke))},`tendril-${Y}`)}),s.current.map((N,Y)=>{const ee=N.boopScale!==1?`translate(${N.targetX}, ${N.targetY}) scale(${N.boopScale}) translate(${-N.targetX}, ${-N.targetY})`:void 0;return l.jsx("g",{transform:ee,style:N.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,children:l.jsx("path",{d:V2(N.vertices),fill:N.color,stroke:N.color,strokeWidth:2})},Y)})]}),s.current.map((N,Y)=>{const ee=N.boopScale!==1?`translate(${N.targetX}, ${N.targetY}) scale(${N.boopScale}) translate(${-N.targetX}, ${-N.targetY})`:void 0,B=N.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,Q=(K,re)=>{const oe=E(K),ve=oe.maxY-oe.minY,Pe=oe.maxY-ve*N.fillAmount,be=50;return N.fillAmount>=1?null:l.jsxs("g",{children:[l.jsx("defs",{children:l.jsx("clipPath",{id:re,children:l.jsx("rect",{x:oe.minX-be,y:oe.minY-be,width:oe.maxX-oe.minX+be*2,height:Pe-oe.minY+be})})}),l.jsx("path",{d:z0(K),fill:T,clipPath:`url(#${re})`})]},re)};if(N.innerRegions)return l.jsx("g",{transform:ee,style:B,children:N.innerRegions.map((K,re)=>{let oe;K.outerVertexIndices?oe=K.outerVertexIndices.map(Pe=>N.vertices[Pe].pos):oe=K.vertices.map(Pe=>Pe.pos);const ve=cd(oe,i.wallThickness);return Q(ve,`unfilled-clip-${Y}-${re}`)})},`inner-group-${Y}`);{const K=N.vertices.map(oe=>oe.pos),re=cd(K,i.wallThickness);return l.jsx("g",{transform:ee,style:B,children:Q(re,`unfilled-clip-${Y}`)},`inner-group-${Y}`)}}),k&&r.current.map((N,Y)=>{var be,A;const ee=(be=s.current[N.blobA])==null?void 0:be.vertices[N.vertA],B=(A=s.current[N.blobB])==null?void 0:A.vertices[N.vertB];if(!ee||!B)return null;const Q=B.pos.x-ee.pos.x,K=B.pos.y-ee.pos.y,oe=Math.sqrt(Q*Q+K*K)/i.goopiness,ve=Math.min(255,Math.floor(oe*255)),Pe=Math.max(0,255-Math.floor(oe*255));return l.jsx("line",{x1:ee.pos.x,y1:ee.pos.y,x2:B.pos.x,y2:B.pos.y,stroke:`rgb(${ve},${Pe},100)`,strokeWidth:2,opacity:.7},`spring-${Y}`)}),s.current.map((N,Y)=>l.jsx("circle",{cx:N.targetX,cy:N.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${Y}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-6: Fill / Pour"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"New mechanics:"}),l.jsx("br",{})," ",l.jsx("strong",{children:"Fill Amount"}),": Each blob has 0-100% fill level (same color as outer goop)",l.jsx("br",{})," ",l.jsx("strong",{children:"Auto-Fill"}),": Fill rises over time (adjustable rate)",l.jsx("br",{})," ",l.jsx("strong",{children:"Shake on early click"}),": Click before 100% and the goop shakes",l.jsx("br",{})," ",l.jsx("strong",{children:"Boop at 100%"}),": Scale pulse from center when fill completes",l.jsx("br",{})," ",l.jsx("strong",{children:"Reset"}),": Empty all containers to start over",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Game implication:"})," Player must clear goop before it fills to 100% (pop!)",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Next:"})," Proto-7 (Pop)  what happens when fill reaches 100%?"]})]})}const En=6,ht=8,Pt=50,zn=50,Yn=50,K2=En*Pt+zn*2,Z2=ht*Pt+Yn*2,Q2={damping:.97,stiffness:1,pressure:5,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ra={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},J2={autoFill:!0,fillRate:.15},ud=1.15,e3=200,t3=200,Zr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function n3(e,t){return{x:zn+(e+.5)*Pt,y:Yn+(t+.5)*Pt}}function pi(e,t){return{x:zn+e*Pt,y:Yn+t*Pt}}function Wi(e){let t=0,n=0;for(const s of e){const r=n3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function s3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function o3(e){if(e.length===0)return[];const t=new Map;for(const a of e){const i=`${a.x1},${a.y1}`,c=`${a.x2},${a.y2}`;t.has(i)||t.set(i,[]),t.has(c)||t.set(c,[]),t.get(i).push(a),t.get(c).push(a)}const n=new Set,s=[];let r=e[0],o={x:r.x1,y:r.y1};for(;n.size<e.length;){n.add(r),s.push(pi(o.x,o.y));const a=o.x===r.x1&&o.y===r.y1?{x:r.x2,y:r.y2}:{x:r.x1,y:r.y1},i=`${a.x},${a.y}`,u=(t.get(i)||[]).find(f=>!n.has(f));if(!u)break;r=u,o=a}return s}let Y0=0;function Qr(e,t,n){const s=`blob-${Y0++}`,r=s3(e),o=o3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const w=Wi(e),m=Pt*.4;o.push({x:w.x-m,y:w.y-m},{x:w.x+m,y:w.y-m},{x:w.x+m,y:w.y+m},{x:w.x-m,y:w.y+m})}const a=Wi(e),i=o.map(w=>({pos:{x:w.x,y:w.y},oldPos:{x:w.x,y:w.y},homeOffset:{x:w.x-a.x,y:w.y-a.y},mass:1,attractionRadius:1})),c=o.map(w=>({pos:{x:w.x,y:w.y},oldPos:{x:w.x,y:w.y},homeOffset:{x:w.x-a.x,y:w.y-a.y}})),u=[],f=i.length;for(let w=0;w<f;w++){const m=(w+1)%f,h=i[m].homeOffset.x-i[w].homeOffset.x,x=i[m].homeOffset.y-i[w].homeOffset.y;u.push({a:w,b:m,restLength:Math.sqrt(h*h+x*x)})}const d=[],p=Pt*1.5,y=new Set;for(let w=0;w<f;w++)for(let m=w+2;m<f;m++){if(m===f-1&&w===0)continue;const h=i[m].homeOffset.x-i[w].homeOffset.x,x=i[m].homeOffset.y-i[w].homeOffset.y,C=Math.sqrt(h*h+x*x);if(C<p){const j=`${Math.min(w,m)}-${Math.max(w,m)}`;y.has(j)||(y.add(j),d.push({a:w,b:m,restLength:C}))}}let v=0;for(let w=0;w<f;w++){const m=(w+1)%f;v+=i[w].homeOffset.x*i[m].homeOffset.y,v-=i[m].homeOffset.x*i[w].homeOffset.y}const k=Math.abs(v)/2;return{id:s,vertices:i,innerVertices:c,ringsprings:u,crossSprings:d,restArea:k,targetX:a.x,targetY:a.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,boopScale:1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function r3(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,a={x:0,y:0};for(const i of n){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,a={x:0,y:0};for(const i of s){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}}const i3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function fd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function l3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function a3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const a of e.vertices){const i=fd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}for(const a of e.innerVertices){const i=fd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}}function c3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function u3(e,t){const n=e.vertices.length;let s=0;for(let a=0;a<n;a++){const i=(a+1)%n;s+=e.vertices[a].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[a].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let a=0;a<n;a++){const i=(a-1+n)%n,c=(a+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[a].pos.x+=d/y*o,e.vertices[a].pos.y+=p/y*o)}}function f3(e){const t=zn,n=zn+En*Pt,s=Yn,r=Yn+ht*Pt,o=2,a=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}}function d3(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function p3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function h3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function H0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=h3(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function x3(e){return H0(e.map(t=>t.pos))}function y3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,J=s[o]*.4,se=Math.min(t,J);r.push({x:i.x+R*se*Math.min(U,3),y:i.y+S*se*Math.min(U,3)})}return r}function m3(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),a=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(t3),[f,d]=g.useState(Q2),[p,y]=g.useState(J2),[v,k]=g.useState(ra.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Zr[0]),[P,R]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState(5),[M,U]=g.useState(1.5),J=g.useRef(T),se=g.useRef(M);J.current=T,se.current=M,g.useEffect(()=>{const A=[];for(let le=0;le<ht;le++){A[le]=[];for(let q=0;q<En;q++)A[le][q]=null}r.current=A;const G=[],X=[{x:0,y:ht-1},{x:1,y:ht-1},{x:2,y:ht-1},{x:1,y:ht-2}],W=Qr(X,Zr[0],!0);G.push(W);for(const le of X)A[le.y][le.x]={blobId:W.id,color:W.color};const fe=[{x:4,y:ht-1},{x:5,y:ht-1},{x:4,y:ht-2},{x:5,y:ht-2}],ie=Qr(fe,Zr[1],!0);G.push(ie);for(const le of fe)A[le.y][le.x]={blobId:ie.id,color:ie.color};s.current=G},[]),g.useEffect(()=>{let A=!0;const G=X=>{var fe,ie,le;if(A){n.current=X,A=!1,t.current=requestAnimationFrame(G);return}const W=Math.min((X-n.current)/1e3,.033);n.current=X;for(const q of s.current){l3(q,f,W),a3(q,f);for(let Ce=0;Ce<f.iterations;Ce++)c3(q,f);q.usePressure&&u3(q,f),f3(q),q.isLocked&&p.autoFill&&q.fillAmount<1&&(q.fillAmount=Math.min(1,q.fillAmount+p.fillRate*W));const ke=q.fillAmount>=1;if(ke&&!q.wasFullLastFrame&&(q.boopScale=ud),q.wasFullLastFrame=ke,q.boopScale>1){const Ce=(ud-1)/(e3/1e3);q.boopScale=Math.max(1,q.boopScale-Ce*W)}}if(a.current!==null){const q=s.current[a.current];if(q&&!q.isLocked){let ke=ht-1;for(const ye of q.gridCells){let I=ye.y;for(;I<ht-1;){const xe=I+1,D=(fe=r.current[xe])==null?void 0:fe[ye.x];if(D&&D.blobId!==q.id)break;I=xe}I-ye.y+q.gridCells[0].y;const z=I-ye.y;ye.y+z-ye.y<ke-q.gridCells[0].y}let Ce=ht;for(const ye of q.gridCells){let I=0;for(;ye.y+I+1<ht;){const z=ye.y+I+1,he=(ie=r.current[z])==null?void 0:ie[ye.x];if(he&&he.blobId!==q.id)break;I++}Ce=Math.min(Ce,I)}const je=Ce*Pt,De=c*W,Fe=Math.min(q.visualOffsetY+De,je);for(q.visualOffsetY=Fe;q.visualOffsetY>=Pt;){for(const ye of q.gridCells)ye.y+=1;q.visualOffsetY-=Pt}const Te=Wi(q.gridCells);q.targetY=Te.y+q.visualOffsetY;let ze=!0;for(const ye of q.gridCells){const I=ye.y+1;if(I>=ht){ze=!1;break}const z=(le=r.current[I])==null?void 0:le[ye.x];if(z&&z.blobId!==q.id){ze=!1;break}}!ze&&q.visualOffsetY<.1&&(q.visualOffsetY=0,q.targetY=Te.y,i.current=!0)}}o.current=d3(s.current,o.current,f),p3(s.current,o.current,f),i.current&&a.current!==null&&(i.current=!1,B()),S({}),t.current=requestAnimationFrame(G)};return t.current=requestAnimationFrame(G),()=>cancelAnimationFrame(t.current)},[f,p,c]);const N=g.useCallback((A,G)=>{var X;return G<0||G>=ht||A<0||A>=En?!0:((X=r.current[G])==null?void 0:X[A])!==null},[]),Y=g.useCallback((A,G)=>{const X=new Set,W=r.current;for(const fe of A){const ie=[{x:fe.x-1,y:fe.y},{x:fe.x+1,y:fe.y},{x:fe.x,y:fe.y-1},{x:fe.x,y:fe.y+1}];for(const le of ie)if(le.y>=0&&le.y<ht&&le.x>=0&&le.x<En){const q=W[le.y][le.x];q&&q.color===G&&X.add(q.blobId)}}return X},[]),ee=g.useCallback(A=>{var ie,le,q;const G=J.current,X=se.current,W=[];for(const ke of A.gridCells){const Ce=ke.y+1;Ce<ht&&((ie=r.current[Ce])!=null&&ie[ke.x])&&W.push(pi(ke.x+.5,ke.y+1)),ke.x>0&&((le=r.current[ke.y])!=null&&le[ke.x-1])&&W.push(pi(ke.x,ke.y+.5)),ke.x<En-1&&((q=r.current[ke.y])!=null&&q[ke.x+1])&&W.push(pi(ke.x+1,ke.y+.5))}if(W.length===0)return;const fe=Pt*X;for(const ke of s.current)if(ke.id!==A.id){for(const Ce of ke.vertices){let je=1/0,De=null;for(const Fe of W){const Te=Ce.pos.x-Fe.x,ze=Ce.pos.y-Fe.y,ye=Math.sqrt(Te*Te+ze*ze);ye<je&&(je=ye,De=Fe)}if(je<fe&&De){const Fe=1-je/fe,Te=G*Fe*Fe,ze=(Ce.pos.x-De.x)/(je+.1),ye=(Ce.pos.y-De.y)/(je+.1);Ce.oldPos.x-=ze*Te,Ce.oldPos.y-=ye*Te*.5}}for(const Ce of ke.innerVertices){let je=1/0,De=null;for(const Fe of W){const Te=Ce.pos.x-Fe.x,ze=Ce.pos.y-Fe.y,ye=Math.sqrt(Te*Te+ze*ze);ye<je&&(je=ye,De=Fe)}if(je<fe&&De){const Fe=1-je/fe,Te=G*Fe*Fe*.3,ze=(Ce.pos.x-De.x)/(je+.1),ye=(Ce.pos.y-De.y)/(je+.1);Ce.oldPos.x-=ze*Te,Ce.oldPos.y-=ye*Te*.5}}}},[]),B=g.useCallback(()=>{if(a.current===null)return;const A=s.current[a.current];if(!A)return;ee(A),A.visualOffsetY=0;const G=Wi(A.gridCells);A.targetY=G.y;const X=Y(A.gridCells,A.color);if(X.size>0){const W=[...A.gridCells],fe=[A],ie=[A.id];for(const q of X){const ke=s.current.find(Ce=>Ce.id===q);ke&&(W.push(...ke.gridCells),fe.push(ke),ie.push(q))}const le=Qr(W,A.color,!0);r3(le,fe);for(const q of W)r.current[q.y][q.x]={blobId:le.id,color:le.color};s.current=s.current.filter(q=>!ie.includes(q.id)),s.current.push(le),console.log(`Merged ${ie.length} blobs into one with ${W.length} cells`)}else{A.isLocked=!0,A.fillAmount=0,A.wasFullLastFrame=!1;for(const W of A.gridCells)r.current[W.y][W.x]={blobId:A.id,color:A.color};console.log("Locked piece (no same-color neighbors)")}a.current=null},[Y,ee]),Q=g.useCallback(()=>{if(a.current!==null)return;const A=i3[P],G=Math.floor((En-4)/2),X=0,W=A.map(ie=>({x:ie.x+G,y:ie.y+X}));for(const ie of W)if(N(ie.x,ie.y)){console.log("Cannot spawn - space occupied");return}const fe=Qr(W,C,!1);fe.visualOffsetY=0,s.current.push(fe),a.current=s.current.length-1},[P,C,N]),K=g.useCallback(()=>{var G;if(a.current===null)return;const A=s.current[a.current];if(A){for(;;){let X=!0;for(const W of A.gridCells){const fe=W.y+1;if(fe>=ht){X=!1;break}const ie=(G=r.current[fe])==null?void 0:G[W.x];if(ie&&ie.blobId!==A.id){X=!1;break}}if(!X)break;for(const W of A.gridCells)W.y+=1}A.visualOffsetY=0,B()}},[B]),re=g.useCallback(()=>{a.current=null,i.current=!1;for(let A=0;A<ht;A++)for(let G=0;G<En;G++)r.current[A][G]=null;s.current=[],Y0=0,o.current=[]},[]),oe=A=>{const G=ra[A];G&&(k(G),m(A))},ve=()=>{const{alphaMultiplier:A,alphaOffset:G}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${A} ${G}`},Pe="#2c3e50",be=A=>{let G=1/0,X=-1/0,W=1/0,fe=-1/0;for(const ie of A)ie.x<G&&(G=ie.x),ie.x>X&&(X=ie.x),ie.y<W&&(W=ie.y),ie.y>fe&&(fe=ie.y);return{minX:G,maxX:X,minY:W,maxY:fe}};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-7: Merge"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Dynamic blob generation when pieces lock  same-color merge with unified fill layer"}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Zr.map((A,G)=>l.jsx("button",{onClick:()=>j(A),style:{width:30,height:30,background:A,border:C===A?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},A)),l.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(A=>l.jsx("button",{onClick:()=>R(A),style:{padding:"6px 12px",background:P===A?"#fff":"#2c3e50",color:P===A?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:A},A))]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("button",{onClick:Q,disabled:a.current!==null,style:{padding:"10px 20px",background:a.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),l.jsx("button",{onClick:K,disabled:a.current===null,style:{padding:"10px 20px",background:a.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:a.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),l.jsx("button",{onClick:re,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[l.jsx("input",{type:"checkbox",checked:h,onChange:A=>x(A.target.checked)}),l.jsx("span",{children:"Show Grid"})]})]}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ra).map(A=>l.jsx("button",{onClick:()=>oe(A),style:{padding:"6px 12px",background:w===A?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===A?"bold":"normal",fontSize:12},children:A.charAt(0).toUpperCase()+A.slice(1)},A))}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:A=>y(G=>({...G,fillRate:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),l.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:A=>u(Number(A.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:A=>d(G=>({...G,wallThickness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:A=>y(G=>({...G,autoFill:A.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:A=>d(G=>({...G,damping:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Stiffness: ",f.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:A=>d(G=>({...G,stiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:f.pressure,onChange:A=>d(G=>({...G,pressure:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:A=>d(G=>({...G,homeStiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:A=>d(G=>({...G,innerHomeStiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:A=>d(G=>({...G,returnSpeed:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:A=>d(G=>({...G,viscosity:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Iterations: ",f.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:A=>d(G=>({...G,iterations:Number(A.target.value)})),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Strength: ",T]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:A=>E(Number(A.target.value)),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Radius: ",M.toFixed(1)," cells"]}),l.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:M,onChange:A=>U(Number(A.target.value)),style:{width:100}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),l.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:A=>d(G=>({...G,goopiness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:A=>d(G=>({...G,attractionRadius:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:A=>d(G=>({...G,attractionStiffness:Number(A.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:A=>d(G=>({...G,tendrilEndRadius:Number(A.target.value)})),style:{width:80}})]})]}),l.jsxs("svg",{ref:e,width:K2,height:Z2,style:{background:Pe,borderRadius:8},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:ve(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&l.jsxs("g",{opacity:.2,children:[Array.from({length:En+1}).map((A,G)=>l.jsx("line",{x1:zn+G*Pt,y1:Yn,x2:zn+G*Pt,y2:Yn+ht*Pt,stroke:"#fff",strokeWidth:1},`v${G}`)),Array.from({length:ht+1}).map((A,G)=>l.jsx("line",{x1:zn,y1:Yn+G*Pt,x2:zn+En*Pt,y2:Yn+G*Pt,stroke:"#fff",strokeWidth:1},`h${G}`))]}),l.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((A,G)=>{const X=s.current[A.blobA],W=s.current[A.blobB];if(!X||!W)return null;const fe=X.vertices[A.vertA],ie=W.vertices[A.vertB];if(!fe||!ie)return null;const le=ie.pos.x-fe.pos.x,q=ie.pos.y-fe.pos.y,ke=Math.sqrt(le*le+q*q),Ce=Math.min(1,ke/f.goopiness),je=f.tendrilEndRadius,De=1-f.tendrilSkinniness,Fe=1-f.tendrilSkinniness*.3,Te=Fe-(Fe-De)*Ce,ze=je*Te,ye=je*1.4,I=Math.max(2,Math.ceil(ke/ye)),z=[];for(let he=0;he<=I;he++){const xe=he/I,D=Math.sin(xe*Math.PI),L=je-(je-ze)*D;z.push({cx:fe.pos.x+le*xe,cy:fe.pos.y+q*xe,r:Math.max(2,L)})}return l.jsx("g",{children:z.map((he,xe)=>l.jsx("circle",{cx:he.cx,cy:he.cy,r:he.r,fill:X.color},xe))},`tendril-${G}`)}),s.current.map((A,G)=>{const X=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0;return l.jsx("g",{transform:X,children:l.jsx("path",{d:x3(A.vertices),fill:A.color,stroke:A.color,strokeWidth:2})},A.id)})]}),s.current.map(A=>{if(!A.isLocked||A.fillAmount>=1)return null;const G=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0,X=A.vertices.map(Ce=>Ce.pos),W=y3(X,f.wallThickness),fe=be(W),ie=fe.maxY-fe.minY,le=fe.maxY-ie*A.fillAmount,q=50,ke=`unfilled-clip-${A.id}`;return l.jsxs("g",{transform:G,children:[l.jsx("defs",{children:l.jsx("clipPath",{id:ke,children:l.jsx("rect",{x:fe.minX-q,y:fe.minY-q,width:fe.maxX-fe.minX+q*2,height:le-fe.minY+q})})}),l.jsx("path",{d:H0(W),fill:Pe,clipPath:`url(#${ke})`})]},`inner-${A.id}`)}),s.current.map((A,G)=>l.jsx("text",{x:A.targetX,y:A.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:A.isLocked?`${Math.round(A.fillAmount*100)}%`:"falling"},`info-${A.id}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-7: Merge"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Test scenarios:"}),l.jsx("br",{})," ",l.jsx("strong",{children:"Same color adjacent"}),": Blobs merge into one, unified fill restarts",l.jsx("br",{})," ",l.jsx("strong",{children:"Different color"}),": No merge, just neighbors",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Current pieces:"})," ",s.current.length," blobs",l.jsx("br",{}),l.jsx("strong",{children:"Attraction springs:"})," ",o.current.length]})]})}const In=6,xt=8,yt=50,Sn=50,Cn=50,g3=In*yt+Sn*2,v3=xt*yt+Cn*2,S3={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ia={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},C3={autoFill:!0,fillRate:.15},k3=4,w3=200,Jr=["#e74c3c","#3498db","#2ecc71","#f39c12"];function R3(e,t){return{x:Sn+(e+.5)*yt,y:Cn+(t+.5)*yt}}function hi(e,t){return{x:Sn+e*yt,y:Cn+t*yt}}function Ui(e){let t=0,n=0;for(const s of e){const r=R3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function P3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function j3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let a=e[0],i={x:a.x1,y:a.y1},c=n(a,i)+Math.PI;for(;r.size<e.length;){r.add(a),o.push(hi(i.x,i.y));const u=i.x===a.x1&&i.y===a.y1?{x:a.x2,y:a.y2}:{x:a.x1,y:a.y1};c=Math.atan2(u.y-i.y,u.x-i.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(w=>!r.has(w));if(y.length===0)break;let v=y[0],k=1/0;for(const w of y){const m=n(w,u),h=s(c,m);(h>k||k===1/0)&&(k=h,v=w)}a=v,i=u}return o}let W0=0;function ei(e,t,n){const s=`blob-${W0++}`,r=P3(e),o=j3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Ui(e),x=yt*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let a=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;a+=o[h].x*o[x].y,a-=o[x].x*o[h].y}a<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const i=Ui(e),c=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y}})),f=[],d=c.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+j*j)})}const p=[],y=yt*1.5,v=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y,P=Math.sqrt(C*C+j*j);if(P<y){const R=`${Math.min(h,x)}-${Math.max(h,x)}`;v.has(R)||(v.add(R),p.push({a:h,b:x,restLength:P}))}}let k=0;for(let h=0;h<d;h++){const x=(h+1)%d;k+=c[h].homeOffset.x*c[x].homeOffset.y,k-=c[x].homeOffset.x*c[h].homeOffset.y}const w=k>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${k.toFixed(0)}, winding=${w}, cells=${e.length}`);const m=Math.abs(k)/2;return{id:s,vertices:c,innerVertices:u,ringsprings:f,crossSprings:p,restArea:m,targetX:i.x,targetY:i.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function T3(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,a={x:0,y:0};for(const i of n){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,a={x:0,y:0};for(const i of s){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,a=i.velocity)}r.oldPos.x=r.pos.x-a.x,r.oldPos.y=r.pos.y-a.y}}const b3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function dd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function M3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function A3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const a of e.vertices){const i=dd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}for(const a of e.innerVertices){const i=dd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}}function E3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function I3(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const a=o.pos.x-n,i=o.pos.y-s,c=Math.sqrt(a*a+i*i),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(c>1e-4&&u>1e-4){const d=(u-c)*r;o.pos.x+=a/c*d,o.pos.y+=i/c*d}}}function _3(e){const t=Sn,n=Sn+In*yt,s=Cn,r=Cn+xt*yt,o=2,a=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}}function O3(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color===c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>yt*4))for(const p of i.vertices)for(const y of c.vertices){const v=y.pos.x-p.pos.x,k=y.pos.y-p.pos.y,w=Math.sqrt(v*v+k*k);if(w<20&&w>.01){const m=20-w,h=v/w,x=k/w,C=m*.8;p.pos.x-=h*C*.5,p.pos.y-=x*C*.5,y.pos.x+=h*C*.5,y.pos.y+=x*C*.5,p.oldPos.x-=h*C*.3,p.oldPos.y-=x*C*.3,y.oldPos.x+=h*C*.3,y.oldPos.y+=x*C*.3}}}}function L3(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function N3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function D3(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,a=n[r].pos,i=n[(r+1)%s].pos,c=a.x-o.x,u=a.y-o.y,f=i.x-a.x,d=i.y-a.y,p=Math.sqrt(c*c+u*u)||1,y=Math.sqrt(f*f+d*d)||1,v=c/p,k=u/p,w=f/y,m=d/y,h=k,x=-v,C=m,j=-w;let P=h+C,R=x+j;const S=Math.sqrt(P*P+R*R)||1;P/=S,R/=S,n[r].oldPos.x-=P*t,n[r].oldPos.y-=R*t}}function $3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function U0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=$3(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function F3(e){return U0(e.map(t=>t.pos))}function G3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,J=s[o]*.4,se=Math.min(t,J);r.push({x:i.x+R*se*Math.min(U,3),y:i.y+S*se*Math.min(U,3)})}return r}function B3(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),a=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(w3),[f,d]=g.useState(S3),[p,y]=g.useState(C3),[v,k]=g.useState(ia.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Jr[0]),[P,R]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState(5),[M,U]=g.useState(1.5),J=g.useRef(T),se=g.useRef(M);J.current=T,se.current=M;const N=g.useRef([]),Y=g.useRef(0),[ee,B]=g.useState(12),[Q,K]=g.useState(150),[re,oe]=g.useState(1),[ve,Pe]=g.useState(8),[be,A]=g.useState(!1),G="proto8-dev-settings";g.useEffect(()=>{const I=localStorage.getItem(G);if(I)try{const z=JSON.parse(I);z.physics&&d(z.physics),z.fillParams&&y(z.fillParams),z.filterParams&&(k(z.filterParams),m("custom")),z.fallSpeed&&u(z.fallSpeed),z.impactStrength&&E(z.impactStrength),z.impactRadius&&U(z.impactRadius),z.dropletCount&&B(z.dropletCount),z.dropletSpeed&&K(z.dropletSpeed),z.dropletLifetime&&oe(z.dropletLifetime),z.dropletSize&&Pe(z.dropletSize),console.log("Loaded dev settings from localStorage")}catch(z){console.warn("Failed to load dev settings:",z)}},[]),g.useEffect(()=>{const I=z=>{z.key==="`"&&(z.preventDefault(),A(he=>!he))};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[]);const X=g.useCallback(()=>{const I={physics:f,fillParams:p,filterParams:v,fallSpeed:c,impactStrength:T,impactRadius:M,dropletCount:ee,dropletSpeed:Q,dropletLifetime:re,dropletSize:ve};localStorage.setItem(G,JSON.stringify(I)),console.log("Saved dev settings to localStorage")},[f,p,v,c,T,M,ee,Q,re,ve]),W=g.useCallback(()=>{const I=[];for(let F=0;F<xt;F++){I[F]=[];for(let H=0;H<In;H++)I[F][H]=null}r.current=I,W0=0;const z=[],he=[{x:0,y:xt-1},{x:1,y:xt-1},{x:2,y:xt-1},{x:1,y:xt-2}],xe=ei(he,Jr[0],!0);z.push(xe);for(const F of he)I[F.y][F.x]={blobId:xe.id,color:xe.color};const D=[{x:4,y:xt-1},{x:5,y:xt-1},{x:4,y:xt-2},{x:5,y:xt-2}],L=ei(D,Jr[1],!0);z.push(L);for(const F of D)I[F.y][F.x]={blobId:L.id,color:L.color};s.current=z,o.current=[],N.current=[],a.current=null,i.current=!1},[]);g.useEffect(()=>{W()},[W]),g.useEffect(()=>{let I=!0;const z=he=>{var we,b,_;if(I){n.current=he,I=!1,t.current=requestAnimationFrame(z);return}const xe=Math.min((he-n.current)/1e3,.033);n.current=he;for(const O of s.current){M3(O,f,xe),A3(O,f);for(let $=0;$<f.iterations;$++)E3(O,f);O.usePressure&&I3(O,f),_3(O)}O3(s.current);for(const O of s.current){O.isLocked&&p.autoFill&&O.fillAmount<1&&(O.fillAmount=Math.min(1,O.fillAmount+p.fillRate*xe));const $=O.fillAmount>=1;$&&!O.wasFullLastFrame&&D3(O,k3),O.wasFullLastFrame=$}if(a.current!==null){const O=s.current[a.current];if(O&&!O.isLocked){let $=xt-1;for(const Ee of O.gridCells){let $e=Ee.y;for(;$e<xt-1;){const Le=$e+1,Je=(we=r.current[Le])==null?void 0:we[Ee.x];if(Je&&Je.blobId!==O.id)break;$e=Le}$e-Ee.y+O.gridCells[0].y;const Ye=$e-Ee.y;Ee.y+Ye-Ee.y<$-O.gridCells[0].y}let V=xt;for(const Ee of O.gridCells){let $e=0;for(;Ee.y+$e+1<xt;){const Ye=Ee.y+$e+1,Xe=(b=r.current[Ye])==null?void 0:b[Ee.x];if(Xe&&Xe.blobId!==O.id)break;$e++}V=Math.min(V,$e)}const te=V*yt,me=c*xe,ge=Math.min(O.visualOffsetY+me,te);for(O.visualOffsetY=ge;O.visualOffsetY>=yt;){for(const Ee of O.gridCells)Ee.y+=1;O.visualOffsetY-=yt}const Z=Ui(O.gridCells);O.targetY=Z.y+O.visualOffsetY;let Oe=!0;for(const Ee of O.gridCells){const $e=Ee.y+1;if($e>=xt){Oe=!1;break}const Ye=(_=r.current[$e])==null?void 0:_[Ee.x];if(Ye&&Ye.blobId!==O.id){Oe=!1;break}}!Oe&&O.visualOffsetY<.1&&(O.visualOffsetY=0,O.targetY=Z.y,i.current=!0)}}o.current=L3(s.current,o.current,f),N3(s.current,o.current,f),i.current&&a.current!==null&&(i.current=!1,ke());const D=300,L=Sn,F=Sn+In*yt,H=Cn,ne=Cn+xt*yt;for(const O of N.current)O.vel.y+=D*xe,O.pos.x+=O.vel.x*xe,O.pos.y+=O.vel.y*xe,(O.pos.x+O.radius<L||O.pos.x-O.radius>F)&&(O.lifetime=0),O.pos.y+O.radius<H&&(O.lifetime=0),O.pos.y+O.radius>ne&&(O.pos.y=ne-O.radius,O.vel.y*=-.3),O.lifetime-=xe,O.opacity=Math.max(0,O.lifetime/O.maxLifetime),O.radius*=.995;N.current=N.current.filter(O=>O.lifetime>0&&O.opacity>.01),S({}),t.current=requestAnimationFrame(z)};return t.current=requestAnimationFrame(z),()=>cancelAnimationFrame(t.current)},[f,p,c]);const fe=g.useCallback((I,z)=>{var he;return z<0||z>=xt||I<0||I>=In?!0:((he=r.current[z])==null?void 0:he[I])!==null},[]),ie=g.useCallback((I,z)=>{const he=new Set,xe=r.current;for(const D of I){const L=[{x:D.x-1,y:D.y},{x:D.x+1,y:D.y},{x:D.x,y:D.y-1},{x:D.x,y:D.y+1}];for(const F of L)if(F.y>=0&&F.y<xt&&F.x>=0&&F.x<In){const H=xe[F.y][F.x];H&&H.color===z&&he.add(H.blobId)}}return he},[]),le=g.useCallback(I=>{var L,F,H;const z=J.current,he=se.current,xe=[];for(const ne of I.gridCells){const we=ne.y+1;we<xt&&((L=r.current[we])!=null&&L[ne.x])&&xe.push(hi(ne.x+.5,ne.y+1)),ne.x>0&&((F=r.current[ne.y])!=null&&F[ne.x-1])&&xe.push(hi(ne.x,ne.y+.5)),ne.x<In-1&&((H=r.current[ne.y])!=null&&H[ne.x+1])&&xe.push(hi(ne.x+1,ne.y+.5))}if(xe.length===0)return;const D=yt*he;for(const ne of s.current)if(ne.id!==I.id){for(const we of ne.vertices){let b=1/0,_=null;for(const O of xe){const $=we.pos.x-O.x,V=we.pos.y-O.y,te=Math.sqrt($*$+V*V);te<b&&(b=te,_=O)}if(b<D&&_){const O=1-b/D,$=z*O*O,V=(we.pos.x-_.x)/(b+.1),te=(we.pos.y-_.y)/(b+.1);we.oldPos.x-=V*$,we.oldPos.y-=te*$*.5}}for(const we of ne.innerVertices){let b=1/0,_=null;for(const O of xe){const $=we.pos.x-O.x,V=we.pos.y-O.y,te=Math.sqrt($*$+V*V);te<b&&(b=te,_=O)}if(b<D&&_){const O=1-b/D,$=z*O*O*.3,V=(we.pos.x-_.x)/(b+.1),te=(we.pos.y-_.y)/(b+.1);we.oldPos.x-=V*$,we.oldPos.y-=te*$*.5}}}},[]),q=g.useCallback(I=>{var xe,D;const z=I.targetX,he=I.targetY;for(let L=0;L<ee;L++){const F=Math.floor(Math.random()*I.vertices.length),H=I.vertices[F],ne=H.pos.x-z,we=H.pos.y-he,b=Math.atan2(we,ne)+(Math.random()-.5)*.8,_=Q*(.5+Math.random()*.8),O={id:`droplet-${Y.current++}`,pos:{x:H.pos.x,y:H.pos.y},vel:{x:Math.cos(b)*_,y:Math.sin(b)*_-50},radius:ve*(.5+Math.random()*.7),color:I.color,opacity:1,lifetime:re*(.7+Math.random()*.6),maxLifetime:re};N.current.push(O),console.log("Created droplet:",O.pos,O.radius,O.color)}for(const L of I.gridCells)((D=(xe=r.current[L.y])==null?void 0:xe[L.x])==null?void 0:D.blobId)===I.id&&(r.current[L.y][L.x]=null);s.current=s.current.filter(L=>L.id!==I.id),console.log(`Popped blob with ${I.gridCells.length} cells, spawned ${N.current.length} droplets total`)},[ee,Q,re,ve]),ke=g.useCallback(()=>{if(a.current===null)return;const I=s.current[a.current];if(!I)return;le(I),I.visualOffsetY=0;const z=Ui(I.gridCells);I.targetY=z.y;const he=ie(I.gridCells,I.color);if(he.size>0){const xe=[...I.gridCells],D=[I],L=[I.id];for(const H of he){const ne=s.current.find(we=>we.id===H);ne&&(xe.push(...ne.gridCells),D.push(ne),L.push(H))}const F=ei(xe,I.color,!0);T3(F,D);for(const H of xe)r.current[H.y][H.x]={blobId:F.id,color:F.color};s.current=s.current.filter(H=>!L.includes(H.id)),s.current.push(F),console.log(`Merged ${L.length} blobs into one with ${xe.length} cells`)}else{I.isLocked=!0,I.fillAmount=0,I.wasFullLastFrame=!1;for(const xe of I.gridCells)r.current[xe.y][xe.x]={blobId:I.id,color:I.color};console.log("Locked piece (no same-color neighbors)")}a.current=null},[ie,le]),Ce=g.useCallback(()=>{if(a.current!==null)return;const I=b3[P],z=Math.floor((In-4)/2),he=0,xe=I.map(L=>({x:L.x+z,y:L.y+he}));for(const L of xe)if(fe(L.x,L.y)){console.log("Cannot spawn - space occupied");return}const D=ei(xe,C,!1);D.visualOffsetY=0,s.current.push(D),a.current=s.current.length-1},[P,C,fe]),je=g.useCallback(()=>{var z;if(a.current===null)return;const I=s.current[a.current];if(I){for(;;){let he=!0;for(const xe of I.gridCells){const D=xe.y+1;if(D>=xt){he=!1;break}const L=(z=r.current[D])==null?void 0:z[xe.x];if(L&&L.blobId!==I.id){he=!1;break}}if(!he)break;for(const xe of I.gridCells)xe.y+=1}I.visualOffsetY=0,ke()}},[ke]),De=g.useCallback(()=>{W()},[W]),Fe=I=>{const z=ia[I];z&&(k(z),m(I))},Te=()=>{const{alphaMultiplier:I,alphaOffset:z}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${I} ${z}`},ze="#2c3e50",ye=I=>{let z=1/0,he=-1/0,xe=1/0,D=-1/0;for(const L of I)L.x<z&&(z=L.x),L.x>he&&(he=L.x),L.y<xe&&(xe=L.y),L.y>D&&(D=L.y);return{minX:z,maxX:he,minY:xe,maxY:D}};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-8: Pop"}),l.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Pop with residue  click filled blobs to pop them, droplets scatter and fade"}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Jr.map((I,z)=>l.jsx("button",{onClick:()=>j(I),style:{width:30,height:30,background:I,border:C===I?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},I)),l.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(I=>l.jsx("button",{onClick:()=>R(I),style:{padding:"6px 12px",background:P===I?"#fff":"#2c3e50",color:P===I?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:I},I))]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("button",{onClick:Ce,disabled:a.current!==null,style:{padding:"10px 20px",background:a.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),l.jsx("button",{onClick:je,disabled:a.current===null,style:{padding:"10px 20px",background:a.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:a.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),l.jsx("button",{onClick:De,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[l.jsx("input",{type:"checkbox",checked:h,onChange:I=>x(I.target.checked)}),l.jsx("span",{children:"Show Grid"})]}),l.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),be&&l.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[l.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),l.jsxs("div",{style:{display:"flex",gap:10},children:[l.jsx("button",{onClick:X,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),l.jsx("button",{onClick:()=>A(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ia).map(I=>l.jsx("button",{onClick:()=>Fe(I),style:{padding:"6px 12px",background:w===I?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===I?"bold":"normal",fontSize:12},children:I.charAt(0).toUpperCase()+I.slice(1)},I))}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:I=>y(z=>({...z,fillRate:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),l.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:I=>u(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:I=>d(z=>({...z,wallThickness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:I=>y(z=>({...z,autoFill:I.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:I=>d(z=>({...z,damping:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Stiffness: ",f.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:I=>d(z=>({...z,stiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:I=>d(z=>({...z,pressure:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:I=>d(z=>({...z,homeStiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:I=>d(z=>({...z,innerHomeStiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:I=>d(z=>({...z,returnSpeed:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:I=>d(z=>({...z,viscosity:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Iterations: ",f.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:I=>d(z=>({...z,iterations:Number(I.target.value)})),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Strength: ",T]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:I=>E(Number(I.target.value)),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Radius: ",M.toFixed(1)," cells"]}),l.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:M,onChange:I=>U(Number(I.target.value)),style:{width:100}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Droplets: ",ee]}),l.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:ee,onChange:I=>B(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Speed: ",Q]}),l.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:Q,onChange:I=>K(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Lifetime: ",re.toFixed(1),"s"]}),l.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:re,onChange:I=>oe(Number(I.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Size: ",ve,"px"]}),l.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:ve,onChange:I=>Pe(Number(I.target.value)),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),l.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:I=>d(z=>({...z,goopiness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:I=>d(z=>({...z,attractionRadius:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:I=>d(z=>({...z,attractionStiffness:Number(I.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:I=>d(z=>({...z,tendrilEndRadius:Number(I.target.value)})),style:{width:80}})]})]})]}),l.jsxs("svg",{ref:e,width:g3,height:v3,style:{background:ze,borderRadius:8},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Te(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&l.jsxs("g",{opacity:.2,children:[Array.from({length:In+1}).map((I,z)=>l.jsx("line",{x1:Sn+z*yt,y1:Cn,x2:Sn+z*yt,y2:Cn+xt*yt,stroke:"#fff",strokeWidth:1},`v${z}`)),Array.from({length:xt+1}).map((I,z)=>l.jsx("line",{x1:Sn,y1:Cn+z*yt,x2:Sn+In*yt,y2:Cn+z*yt,stroke:"#fff",strokeWidth:1},`h${z}`))]}),l.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((I,z)=>{const he=s.current[I.blobA],xe=s.current[I.blobB];if(!he||!xe)return null;const D=he.vertices[I.vertA],L=xe.vertices[I.vertB];if(!D||!L)return null;const F=L.pos.x-D.pos.x,H=L.pos.y-D.pos.y,ne=Math.sqrt(F*F+H*H),we=Math.min(1,ne/f.goopiness),b=f.tendrilEndRadius,_=1-f.tendrilSkinniness,O=1-f.tendrilSkinniness*.3,$=O-(O-_)*we,V=b*$,te=b*1.4,me=Math.max(2,Math.ceil(ne/te)),ge=[];for(let Z=0;Z<=me;Z++){const Oe=Z/me,Ee=Math.sin(Oe*Math.PI),$e=b-(b-V)*Ee;ge.push({cx:D.pos.x+F*Oe,cy:D.pos.y+H*Oe,r:Math.max(2,$e)})}return l.jsx("g",{children:ge.map((Z,Oe)=>l.jsx("circle",{cx:Z.cx,cy:Z.cy,r:Z.r,fill:he.color},Oe))},`tendril-${z}`)}),s.current.map((I,z)=>{const he=I.isLocked&&I.fillAmount>=1;return l.jsx("g",{style:{cursor:he?"pointer":"default"},onClick:()=>he&&q(I),children:l.jsx("path",{d:F3(I.vertices),fill:I.color,stroke:I.color,strokeWidth:2})},I.id)})]}),s.current.map(I=>{if(!I.isLocked||I.fillAmount>=1)return null;const z=I.vertices.map(ne=>ne.pos),he=G3(z,f.wallThickness),xe=ye(he),D=xe.maxY-xe.minY,L=xe.maxY-D*I.fillAmount,F=50,H=`unfilled-clip-${I.id}`;return l.jsxs("g",{children:[l.jsx("defs",{children:l.jsx("clipPath",{id:H,children:l.jsx("rect",{x:xe.minX-F,y:xe.minY-F,width:xe.maxX-xe.minX+F*2,height:L-xe.minY+F})})}),l.jsx("path",{d:U0(he),fill:ze,clipPath:`url(#${H})`})]},`inner-${I.id}`)}),l.jsx("g",{children:N.current.map(I=>l.jsx("circle",{cx:I.pos.x,cy:I.pos.y,r:I.radius,fill:I.color,opacity:I.opacity},I.id))}),s.current.filter(I=>I.gridCells.length>4).map(I=>l.jsxs("g",{children:[I.vertices.map((z,he)=>l.jsxs("g",{children:[l.jsx("circle",{cx:z.pos.x,cy:z.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),l.jsx("text",{x:z.pos.x+6,y:z.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:he})]},`v-${he}`)),I.vertices.map((z,he)=>{const xe=I.vertices[(he+1)%I.vertices.length];return l.jsx("line",{x1:z.pos.x,y1:z.pos.y,x2:xe.pos.x,y2:xe.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${he}`)})]},`debug-verts-${I.id}`)),s.current.map((I,z)=>l.jsx("text",{x:I.targetX,y:I.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:I.isLocked?`${Math.round(I.fillAmount*100)}%`:"falling"},`info-${I.id}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-8: Pop"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"How to test:"}),l.jsx("br",{})," Wait for a blob to fill to 100%",l.jsx("br",{})," Click the filled blob to pop it",l.jsx("br",{})," Droplets scatter outward and fade",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",l.jsx("strong",{children:"Droplets:"})," ",N.current.length]})]})}const ln=6,et=8,ct=50,kn=50,wn=50,z3=ln*ct+kn*2,Y3=et*ct+wn*2,H3={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},la={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},W3={autoFill:!0,fillRate:.15},U3=4,X3=200,Do=["#e74c3c","#3498db","#2ecc71","#f39c12"],V3={T_I_C:[{x:0,y:2},{x:0,y:3},{x:1,y:0},{x:1,y:1}],T_L_C:[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:2}],T_T_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:2,y:1}],T_S_C:[{x:0,y:2},{x:1,y:0},{x:1,y:1},{x:2,y:1}],T_O_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:1,y:2}]};function q3(e,t){return{x:kn+(e+.5)*ct,y:wn+(t+.5)*ct}}function xi(e,t){return{x:kn+e*ct,y:wn+t*ct}}function so(e){let t=0,n=0;for(const s of e){const r=q3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function K3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function Z3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let a=e[0],i={x:a.x1,y:a.y1},c=n(a,i)+Math.PI;for(;r.size<e.length;){r.add(a),o.push(xi(i.x,i.y));const u=i.x===a.x1&&i.y===a.y1?{x:a.x2,y:a.y2}:{x:a.x1,y:a.y1};c=Math.atan2(u.y-i.y,u.x-i.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(w=>!r.has(w));if(y.length===0)break;let v=y[0],k=1/0;for(const w of y){const m=n(w,u),h=s(c,m);(h>k||k===1/0)&&(k=h,v=w)}a=v,i=u}return o}let X0=0;function Jn(e,t,n){const s=`blob-${X0++}`,r=K3(e),o=Z3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=so(e),x=ct*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let a=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;a+=o[h].x*o[x].y,a-=o[x].x*o[h].y}a<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const i=so(e),c=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y}})),f=[],d=c.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+j*j)})}const p=[],y=ct*1.5,v=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y,P=Math.sqrt(C*C+j*j);if(P<y){const R=`${Math.min(h,x)}-${Math.max(h,x)}`;v.has(R)||(v.add(R),p.push({a:h,b:x,restLength:P}))}}let k=0;for(let h=0;h<d;h++){const x=(h+1)%d;k+=c[h].homeOffset.x*c[x].homeOffset.y,k-=c[x].homeOffset.x*c[h].homeOffset.y}const w=k>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${k.toFixed(0)}, winding=${w}, cells=${e.length}`);const m=Math.abs(k)/2;return{id:s,vertices:c,innerVertices:u,ringsprings:f,crossSprings:p,restArea:m,targetX:i.x,targetY:i.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,isLoose:!1,visualOffsetY:0}}function pd(e,t,n=.3){const s=[];for(const o of t)for(const a of o.vertices)s.push({pos:{x:a.pos.x,y:a.pos.y},velocity:{x:a.pos.x-a.oldPos.x,y:a.pos.y-a.oldPos.y}});for(const o of e.vertices){let a=1/0,i={x:0,y:0};for(const c of s){const u=o.pos.x-c.pos.x,f=o.pos.y-c.pos.y,d=u*u+f*f;d<a&&(a=d,i=c.velocity)}o.oldPos.x=o.pos.x-i.x*n,o.oldPos.y=o.pos.y-i.y*n}const r=[];for(const o of t)for(const a of o.innerVertices)r.push({pos:{x:a.pos.x,y:a.pos.y},velocity:{x:a.pos.x-a.oldPos.x,y:a.pos.y-a.oldPos.y}});for(const o of e.innerVertices){let a=1/0,i={x:0,y:0};for(const c of r){const u=o.pos.x-c.pos.x,f=o.pos.y-c.pos.y,d=u*u+f*f;d<a&&(a=d,i=c.velocity)}o.oldPos.x=o.pos.x-i.x*n,o.oldPos.y=o.pos.y-i.y*n}}const Q3=ct*.02*1e3;function J3(e){if(e.length===0)return[];if(e.length===1)return[[...e]];const t=new Set(e.map(r=>`${r.x},${r.y}`)),n=new Set,s=[];for(const r of e){const o=`${r.x},${r.y}`;if(n.has(o))continue;const a=[],i=[r];for(;i.length>0;){const c=i.shift(),u=`${c.x},${c.y}`;if(n.has(u))continue;n.add(u),a.push(c);const f=[{x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y}];for(const d of f){const p=`${d.x},${d.y}`;t.has(p)&&!n.has(p)&&i.push(d)}}a.length>0&&s.push(a)}return s}function e5(e,t,n){var s;for(const r of e.gridCells)if(r.y>=et-1)return!0;for(const r of e.gridCells){const o=r.y+1;if(o<et){const a=(s=t[o])==null?void 0:s[r.x];if(a&&a.blobId!==e.id&&n.has(a.blobId))return!0}}return!1}function hd(e,t){var i,c;const n=new Set;for(const u of e)if(!(!u.isLocked||u.isLoose)){for(const f of u.gridCells)if(f.y>=et-1){n.add(u.id);break}}let s=!0;for(;s;){s=!1;for(const u of e)n.has(u.id)||!u.isLocked||u.isLoose||e5(u,t,n)&&(n.add(u.id),s=!0)}const r=[],o=[],a=[];for(const u of e){if(!u.isLocked||u.isLoose||n.has(u.id))continue;for(const d of u.gridCells)((c=(i=t[d.y])==null?void 0:i[d.x])==null?void 0:c.blobId)===u.id&&(t[d.y][d.x]=null);const f=J3(u.gridCells);if(f.length===1)u.isLocked=!1,u.isLoose=!0,u.visualOffsetY=0,r.push(u),console.log(`Blob ${u.id} became loose (lost support)`);else{console.log(`Blob ${u.id} splitting into ${f.length} disconnected pieces`),o.push(u.id);for(const d of f){const p=Jn(d,u.color,!1);p.isLocked=!1,p.isLoose=!0,p.visualOffsetY=0,p.fillAmount=u.fillAmount,a.push(p),r.push(p),console.log(`  - Created loose piece with ${d.length} cell(s)`)}}}if(o.length>0||a.length>0){const u=e.filter(f=>!o.includes(f.id));e.length=0,e.push(...u,...a)}return r}const t5={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function xd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function n5(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function s5(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const a of e.vertices){const i=xd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}for(const a of e.innerVertices){const i=xd(a.homeOffset.x,a.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-a.pos.x,d=u-a.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;a.pos.x+=p*r,a.pos.y+=y*r,s>0&&(a.oldPos.x-=p*o,a.oldPos.y-=y*o)}}function o5(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,a=r.pos.y-s.pos.y,i=Math.sqrt(o*o+a*a);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=a*u,r.pos.x-=o*u,r.pos.y-=a*u}}function r5(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const a=o.pos.x-n,i=o.pos.y-s,c=Math.sqrt(a*a+i*i),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(c>1e-4&&u>1e-4){const d=(u-c)*r;o.pos.x+=a/c*d,o.pos.y+=i/c*d}}}function i5(e){const t=kn,n=kn+ln*ct,s=wn,r=wn+et*ct,o=2,a=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*a}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*a}}}function l5(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color===c.color)continue;const u=i.isFalling||i.isLoose,f=c.isFalling||c.isLoose;if(!u&&!f)continue;const d=i.targetX-c.targetX,p=i.targetY-c.targetY;if(!(Math.sqrt(d*d+p*p)>ct*4))for(const v of i.vertices)for(const k of c.vertices){const w=k.pos.x-v.pos.x,m=k.pos.y-v.pos.y,h=Math.sqrt(w*w+m*m);if(h<20&&h>.01){const x=20-h,C=w/h,j=m/h,P=x*.8;v.pos.x-=C*P*.5,v.pos.y-=j*P*.5,k.pos.x+=C*P*.5,k.pos.y+=j*P*.5,v.oldPos.x-=C*P*.3,v.oldPos.y-=j*P*.3,k.oldPos.x+=C*P*.3,k.oldPos.y+=j*P*.3}}}}function a5(e,t,n){const s=[],r=new Set;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i||a.color!==i.color)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let a=o+1;a<e.length;a++){const i=e[o],c=e[a];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${a}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,P=C+j;x<P&&(s.push({blobA:o,vertA:p,blobB:a,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function c5(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const a=e[o.blobA],i=e[o.blobB];if(!a||!i)continue;const c=a.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function u5(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,a=n[r].pos,i=n[(r+1)%s].pos,c=a.x-o.x,u=a.y-o.y,f=i.x-a.x,d=i.y-a.y,p=Math.sqrt(c*c+u*u)||1,y=Math.sqrt(f*f+d*d)||1,v=c/p,k=u/p,w=f/y,m=d/y,h=k,x=-v,C=m,j=-w;let P=h+C,R=x+j;const S=Math.sqrt(P*P+R*R)||1;P/=S,R/=S,n[r].oldPos.x-=P*t,n[r].oldPos.y-=R*t}}function f5(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function V0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],a=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=f5(r,o,a,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${a.x} ${a.y}`}return n+" Z"}function d5(e){return V0(e.map(t=>t.pos))}function p5(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const a=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-a.x,y=d.y-a.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const a=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-a.x,f=i.y-a.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,P=m;let R=x+j,S=C+P;const T=Math.sqrt(R*R+S*S);T<.001?(R=x,S=C):(R/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),U=M>.1?1/M:10,J=s[o]*.4,se=Math.min(t,J);r.push({x:i.x+R*se*Math.min(U,3),y:i.y+S*se*Math.min(U,3)})}return r}function h5(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),a=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(X3),[f,d]=g.useState(H3),[p,y]=g.useState(W3),[v,k]=g.useState(la.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Do[0]),[P,R]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState("A"),[M,U]=g.useState("T_T_C"),[J,se]=g.useState(0),[N,Y]=g.useState(5),[ee,B]=g.useState(1.5),Q=g.useRef(N),K=g.useRef(ee);Q.current=N,K.current=ee;const re=g.useRef([]),oe=g.useRef(0),[ve,Pe]=g.useState(12),[be,A]=g.useState(150),[G,X]=g.useState(1),[W,fe]=g.useState(8),[ie,le]=g.useState(!1),q="proto9-dev-settings";g.useEffect(()=>{const b=localStorage.getItem(q);if(b)try{const _=JSON.parse(b);_.physics&&d(_.physics),_.fillParams&&y(_.fillParams),_.filterParams&&(k(_.filterParams),m("custom")),_.fallSpeed&&u(_.fallSpeed),_.impactStrength&&Y(_.impactStrength),_.impactRadius&&B(_.impactRadius),_.dropletCount&&Pe(_.dropletCount),_.dropletSpeed&&A(_.dropletSpeed),_.dropletLifetime&&X(_.dropletLifetime),_.dropletSize&&fe(_.dropletSize),console.log("Loaded dev settings from localStorage")}catch(_){console.warn("Failed to load dev settings:",_)}},[]),g.useEffect(()=>{const b=_=>{_.key==="`"&&(_.preventDefault(),le(O=>!O))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]);const ke=g.useCallback(()=>{const b={physics:f,fillParams:p,filterParams:v,fallSpeed:c,impactStrength:N,impactRadius:ee,dropletCount:ve,dropletSpeed:be,dropletLifetime:G,dropletSize:W};localStorage.setItem(q,JSON.stringify(b)),console.log("Saved dev settings to localStorage")},[f,p,v,c,N,ee,ve,be,G,W]),Ce=g.useCallback(()=>{const b=[];for(let Z=0;Z<et;Z++){b[Z]=[];for(let Oe=0;Oe<ln;Oe++)b[Z][Oe]=null}r.current=b,X0=0;const _=[],O=[{x:1,y:et-1},{x:2,y:et-1},{x:3,y:et-1},{x:4,y:et-1}],$=Jn(O,Do[1],!0);$.fillAmount=1,$.wasFullLastFrame=!0,_.push($);for(const Z of O)b[Z.y][Z.x]={blobId:$.id,color:$.color};const V=[{x:1,y:et-2},{x:2,y:et-2},{x:3,y:et-2},{x:2,y:et-3}],te=Jn(V,Do[0],!0);te.fillAmount=1,te.wasFullLastFrame=!0,_.push(te);for(const Z of V)b[Z.y][Z.x]={blobId:te.id,color:te.color};const me=[{x:1,y:et-5},{x:1,y:et-4},{x:2,y:et-4},{x:3,y:et-4}],ge=Jn(me,Do[1],!0);ge.fillAmount=1,ge.wasFullLastFrame=!0,_.push(ge);for(const Z of me)b[Z.y][Z.x]={blobId:ge.id,color:ge.color};s.current=_,o.current=[],re.current=[],a.current=null,i.current=!1,console.log("Test A initialized: 4x1 blue, T red, J blue")},[]);g.useEffect(()=>{Ce()},[Ce]);const je=g.useCallback(b=>{E(b),Ce()},[Ce]);g.useEffect(()=>{let b=!0;const _=O=>{var $e,Ye,Xe,Le,Je;if(b){n.current=O,b=!1,t.current=requestAnimationFrame(_);return}const $=Math.min((O-n.current)/1e3,.033);n.current=O;for(const ce of s.current){n5(ce,f,$),s5(ce,f);for(let it=0;it<f.iterations;it++)o5(ce,f);ce.usePressure&&r5(ce,f),i5(ce)}l5(s.current);for(const ce of s.current){ce.isLocked&&p.autoFill&&ce.fillAmount<1&&(ce.fillAmount=Math.min(1,ce.fillAmount+p.fillRate*$));const it=ce.fillAmount>=1;it&&!ce.wasFullLastFrame&&u5(ce,U3),ce.wasFullLastFrame=it}if(a.current!==null){const ce=s.current[a.current];if(ce&&!ce.isLocked){let it=et-1;for(const Ge of ce.gridCells){let Ze=Ge.y;for(;Ze<et-1;){const wo=Ze+1,ot=($e=r.current[wo])==null?void 0:$e[Ge.x];if(ot&&ot.blobId!==ce.id)break;Ze=wo}Ze-Ge.y+ce.gridCells[0].y;const Qe=Ze-Ge.y;Ge.y+Qe-Ge.y<it-ce.gridCells[0].y}let lt=et;for(const Ge of ce.gridCells){let Ze=0;for(;Ge.y+Ze+1<et;){const Qe=Ge.y+Ze+1,ks=(Ye=r.current[Qe])==null?void 0:Ye[Ge.x];if(ks&&ks.blobId!==ce.id)break;Ze++}lt=Math.min(lt,Ze)}const Rt=lt*ct,de=c*$,ue=Math.min(ce.visualOffsetY+de,Rt);for(ce.visualOffsetY=ue;ce.visualOffsetY>=ct;){for(const Ge of ce.gridCells)Ge.y+=1;ce.visualOffsetY-=ct}const Ue=so(ce.gridCells);ce.targetY=Ue.y+ce.visualOffsetY;let He=!0;for(const Ge of ce.gridCells){const Ze=Ge.y+1;if(Ze>=et){He=!1;break}const Qe=(Xe=r.current[Ze])==null?void 0:Xe[Ge.x];if(Qe&&Qe.blobId!==ce.id){He=!1;break}}!He&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=Ue.y,i.current=!0)}}const V=s.current.filter(ce=>ce.isLoose),te=[];for(const ce of V){let it=et;for(const He of ce.gridCells){let Ge=0;for(;He.y+Ge+1<et;){const Ze=He.y+Ge+1,Qe=(Le=r.current[Ze])==null?void 0:Le[He.x];if(Qe&&Qe.blobId!==ce.id)break;Ge++}it=Math.min(it,Ge)}const lt=it*ct,Rt=Q3*$,de=Math.min(ce.visualOffsetY+Rt,lt);for(ce.visualOffsetY=de;ce.visualOffsetY>=ct;){for(const He of ce.gridCells)He.y+=1;ce.visualOffsetY-=ct}const ue=so(ce.gridCells);ce.targetY=ue.y+ce.visualOffsetY;let Ue=!0;for(const He of ce.gridCells){const Ge=He.y+1;if(Ge>=et){Ue=!1;break}const Ze=(Je=r.current[Ge])==null?void 0:Je[He.x];if(Ze&&Ze.blobId!==ce.id){Ue=!1;break}}!Ue&&ce.visualOffsetY<.1&&(ce.visualOffsetY=0,ce.targetY=ue.y,te.push(ce))}for(const ce of te)ye(ce);o.current=a5(s.current,o.current,f),c5(s.current,o.current,f),i.current&&a.current!==null&&(i.current=!1,I());const me=300,ge=kn,Z=kn+ln*ct,Oe=wn,Ee=wn+et*ct;for(const ce of re.current)ce.vel.y+=me*$,ce.pos.x+=ce.vel.x*$,ce.pos.y+=ce.vel.y*$,(ce.pos.x+ce.radius<ge||ce.pos.x-ce.radius>Z)&&(ce.lifetime=0),ce.pos.y+ce.radius<Oe&&(ce.lifetime=0),ce.pos.y+ce.radius>Ee&&(ce.pos.y=Ee-ce.radius,ce.vel.y*=-.3),ce.lifetime-=$,ce.opacity=Math.max(0,ce.lifetime/ce.maxLifetime),ce.radius*=.995;re.current=re.current.filter(ce=>ce.lifetime>0&&ce.opacity>.01),S({}),t.current=requestAnimationFrame(_)};return t.current=requestAnimationFrame(_),()=>cancelAnimationFrame(t.current)},[f,p,c]);const De=g.useCallback((b,_)=>{var O;return _<0||_>=et||b<0||b>=ln?!0:((O=r.current[_])==null?void 0:O[b])!==null},[]),Fe=g.useCallback((b,_)=>{const O=new Set,$=r.current;for(const V of b){const te=[{x:V.x-1,y:V.y},{x:V.x+1,y:V.y},{x:V.x,y:V.y-1},{x:V.x,y:V.y+1}];for(const me of te)if(me.y>=0&&me.y<et&&me.x>=0&&me.x<ln){const ge=$[me.y][me.x];ge&&ge.color===_&&O.add(ge.blobId)}}return O},[]),Te=g.useCallback(b=>{var te,me,ge;const _=Q.current,O=K.current,$=[];for(const Z of b.gridCells){const Oe=Z.y+1;Oe<et&&((te=r.current[Oe])!=null&&te[Z.x])&&$.push(xi(Z.x+.5,Z.y+1)),Z.x>0&&((me=r.current[Z.y])!=null&&me[Z.x-1])&&$.push(xi(Z.x,Z.y+.5)),Z.x<ln-1&&((ge=r.current[Z.y])!=null&&ge[Z.x+1])&&$.push(xi(Z.x+1,Z.y+.5))}if($.length===0)return;const V=ct*O;for(const Z of s.current)if(Z.id!==b.id){for(const Oe of Z.vertices){let Ee=1/0,$e=null;for(const Ye of $){const Xe=Oe.pos.x-Ye.x,Le=Oe.pos.y-Ye.y,Je=Math.sqrt(Xe*Xe+Le*Le);Je<Ee&&(Ee=Je,$e=Ye)}if(Ee<V&&$e){const Ye=1-Ee/V,Xe=_*Ye*Ye,Le=(Oe.pos.x-$e.x)/(Ee+.1),Je=(Oe.pos.y-$e.y)/(Ee+.1);Oe.oldPos.x-=Le*Xe,Oe.oldPos.y-=Je*Xe*.5}}for(const Oe of Z.innerVertices){let Ee=1/0,$e=null;for(const Ye of $){const Xe=Oe.pos.x-Ye.x,Le=Oe.pos.y-Ye.y,Je=Math.sqrt(Xe*Xe+Le*Le);Je<Ee&&(Ee=Je,$e=Ye)}if(Ee<V&&$e){const Ye=1-Ee/V,Xe=_*Ye*Ye*.3,Le=(Oe.pos.x-$e.x)/(Ee+.1),Je=(Oe.pos.y-$e.y)/(Ee+.1);Oe.oldPos.x-=Le*Xe,Oe.oldPos.y-=Je*Xe*.5}}}},[]),ze=g.useCallback(b=>{var V,te;const _=b.targetX,O=b.targetY;for(let me=0;me<ve;me++){const ge=Math.floor(Math.random()*b.vertices.length),Z=b.vertices[ge],Oe=Z.pos.x-_,Ee=Z.pos.y-O,$e=Math.atan2(Ee,Oe)+(Math.random()-.5)*.8,Ye=be*(.5+Math.random()*.8),Xe={id:`droplet-${oe.current++}`,pos:{x:Z.pos.x,y:Z.pos.y},vel:{x:Math.cos($e)*Ye,y:Math.sin($e)*Ye-50},radius:W*(.5+Math.random()*.7),color:b.color,opacity:1,lifetime:G*(.7+Math.random()*.6),maxLifetime:G};re.current.push(Xe),console.log("Created droplet:",Xe.pos,Xe.radius,Xe.color)}for(const me of b.gridCells)((te=(V=r.current[me.y])==null?void 0:V[me.x])==null?void 0:te.blobId)===b.id&&(r.current[me.y][me.x]=null);s.current=s.current.filter(me=>me.id!==b.id);const $=hd(s.current,r.current);$.length>0&&console.log(`Pop created ${$.length} loose goop blob(s)`),console.log(`Popped blob with ${b.gridCells.length} cells, spawned ${re.current.length} droplets total`)},[ve,be,G,W]),ye=g.useCallback(b=>{if(!b.isLoose)return;console.log(`Locking loose blob ${b.id}`),Te(b),b.visualOffsetY=0;const _=so(b.gridCells);b.targetY=_.y;const O=Fe(b.gridCells,b.color);if(O.size>0){const V=[...b.gridCells],te=[b],me=[b.id];for(const Z of O){const Oe=s.current.find(Ee=>Ee.id===Z);Oe&&(V.push(...Oe.gridCells),te.push(Oe),me.push(Z))}const ge=Jn(V,b.color,!0);pd(ge,te);for(const Z of V)r.current[Z.y][Z.x]={blobId:ge.id,color:ge.color};s.current=s.current.filter(Z=>!me.includes(Z.id)),s.current.push(ge),console.log(`Loose blob merged with ${O.size} neighbor(s) into ${V.length} cells`)}else{b.isLocked=!0,b.isLoose=!1,b.fillAmount=0,b.wasFullLastFrame=!1;for(const V of b.gridCells)r.current[V.y][V.x]={blobId:b.id,color:b.color};console.log("Loose blob locked (no same-color neighbors)")}const $=hd(s.current,r.current);$.length>0&&console.log(`Landing created ${$.length} more loose goop blob(s)`)},[Fe,Te]),I=g.useCallback(()=>{if(a.current===null)return;const b=s.current[a.current];if(!b)return;Te(b),b.visualOffsetY=0;const _=so(b.gridCells);b.targetY=_.y;const O=Fe(b.gridCells,b.color);if(O.size>0){const $=[...b.gridCells],V=[b],te=[b.id];for(const ge of O){const Z=s.current.find(Oe=>Oe.id===ge);Z&&($.push(...Z.gridCells),V.push(Z),te.push(ge))}const me=Jn($,b.color,!0);pd(me,V);for(const ge of $)r.current[ge.y][ge.x]={blobId:me.id,color:me.color};s.current=s.current.filter(ge=>!te.includes(ge.id)),s.current.push(me),console.log(`Merged ${te.length} blobs into one with ${$.length} cells`)}else{b.isLocked=!0,b.fillAmount=0,b.wasFullLastFrame=!1;for(const $ of b.gridCells)r.current[$.y][$.x]={blobId:b.id,color:b.color};console.log("Locked piece (no same-color neighbors)")}a.current=null},[Fe,Te]),z=g.useCallback(()=>{if(a.current!==null)return;const b=t5[P],_=Math.floor((ln-4)/2),O=0,$=b.map(te=>({x:te.x+_,y:te.y+O}));for(const te of $)if(De(te.x,te.y)){console.log("Cannot spawn - space occupied");return}const V=Jn($,C,!1);V.visualOffsetY=0,s.current.push(V),a.current=s.current.length-1},[P,C,De]),he=(b,_)=>{let O=b.map(te=>({...te}));for(let te=0;te<_%4;te++)O=O.map(({x:me,y:ge})=>({x:-ge,y:me}));const $=Math.min(...O.map(te=>te.x)),V=Math.min(...O.map(te=>te.y));return O.map(te=>({x:te.x-$,y:te.y-V}))},xe=g.useCallback(()=>{if(a.current!==null)return;const b=V3[M];if(!b)return;const _=he(b,J),O=Math.floor((ln-3)/2),$=0,V=_.map(me=>({x:me.x+O,y:me.y+$}));for(const me of V){if(me.x<0||me.x>=ln||me.y<0||me.y>=et){console.log("Cannot spawn - out of bounds");return}if(De(me.x,me.y)){console.log("Cannot spawn - space occupied");return}}const te=Jn(V,C,!1);te.visualOffsetY=0,s.current.push(te),a.current=s.current.length-1,console.log(`Spawned corrupted piece ${M} with rotation ${J*90}`)},[M,J,C,De]),D=g.useCallback(()=>{var _;if(a.current===null)return;const b=s.current[a.current];if(b){for(;;){let O=!0;for(const $ of b.gridCells){const V=$.y+1;if(V>=et){O=!1;break}const te=(_=r.current[V])==null?void 0:_[$.x];if(te&&te.blobId!==b.id){O=!1;break}}if(!O)break;for(const $ of b.gridCells)$.y+=1}b.visualOffsetY=0,I()}},[I]),L=g.useCallback(()=>{Ce()},[Ce]),F=b=>{const _=la[b];_&&(k(_),m(b))},H=()=>{const{alphaMultiplier:b,alphaOffset:_}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${b} ${_}`},ne="#2c3e50",we=b=>{let _=1/0,O=-1/0,$=1/0,V=-1/0;for(const te of b)te.x<_&&(_=te.x),te.x>O&&(O=te.x),te.y<$&&($=te.y),te.y>V&&(V=te.y);return{minX:_,maxX:O,minY:$,maxY:V}};return l.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[l.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-9: Loose Goop"}),l.jsxs("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:[T==="A"&&"Test A: Click red blob to pop  top blue becomes loose  falls  merges with bottom blue",T==="B"&&"Test B: Spawn corrupted pieces, build stacks, pop middle pieces to test loose goop",T==="default"&&"Default: Original Proto-8 setup with T and square pieces"]}),l.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15,background:"#8e44ad",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold",marginRight:10},children:"Test Mode:"}),l.jsx("button",{onClick:()=>je("A"),style:{padding:"8px 16px",background:T==="A"?"#fff":"#2c3e50",color:T==="A"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test A: Stack Pop"}),l.jsx("button",{onClick:()=>je("B"),style:{padding:"8px 16px",background:T==="B"?"#fff":"#2c3e50",color:T==="B"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test B: Corrupted"}),l.jsx("button",{onClick:()=>je("default"),style:{padding:"8px 16px",background:T==="default"?"#fff":"#2c3e50",color:T==="default"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Default"})]}),T==="A"&&l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#e74c3c",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontSize:14},children:"Blue (floor)  Red (middle)  Blue (top)"}),l.jsx("button",{onClick:()=>Ce(),style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Stack"})]}),T==="B"&&l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#16a085",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Corrupted Shape:"}),l.jsxs("select",{value:M,onChange:b=>U(b.target.value),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#fff",cursor:"pointer"},children:[l.jsx("option",{value:"T_T_C",children:"T Corrupted (split T)"}),l.jsx("option",{value:"T_I_C",children:"I Corrupted (split I)"}),l.jsx("option",{value:"T_L_C",children:"L Corrupted (diagonal L)"}),l.jsx("option",{value:"T_S_C",children:"S Corrupted (diagonal S)"}),l.jsx("option",{value:"T_O_C",children:"O Corrupted (split O)"})]}),l.jsx("span",{style:{fontWeight:"bold",marginLeft:10},children:"Rotate:"}),l.jsx("button",{onClick:()=>se(b=>(b+3)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CCW"}),l.jsx("button",{onClick:()=>se(b=>(b+1)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CW"}),l.jsxs("span",{style:{opacity:.7},children:[J*90,""]}),l.jsx("button",{onClick:xe,disabled:a.current!==null,style:{padding:"8px 16px",background:a.current!==null?"#7f8c8d":"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold",marginLeft:10},children:"Spawn Corrupted"})]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[l.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Do.map((b,_)=>l.jsx("button",{onClick:()=>j(b),style:{width:30,height:30,background:b,border:C===b?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},b)),l.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(b=>l.jsx("button",{onClick:()=>R(b),style:{padding:"6px 12px",background:P===b?"#fff":"#2c3e50",color:P===b?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:b},b))]}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[l.jsx("button",{onClick:z,disabled:a.current!==null,style:{padding:"10px 20px",background:a.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:a.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),l.jsx("button",{onClick:D,disabled:a.current===null,style:{padding:"10px 20px",background:a.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:a.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),l.jsx("button",{onClick:L,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[l.jsx("input",{type:"checkbox",checked:h,onChange:b=>x(b.target.checked)}),l.jsx("span",{children:"Show Grid"})]}),l.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),ie&&l.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[l.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[l.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),l.jsxs("div",{style:{display:"flex",gap:10},children:[l.jsx("button",{onClick:ke,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),l.jsx("button",{onClick:()=>le(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),l.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(la).map(b=>l.jsx("button",{onClick:()=>F(b),style:{padding:"6px 12px",background:w===b?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===b?"bold":"normal",fontSize:12},children:b.charAt(0).toUpperCase()+b.slice(1)},b))}),l.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),l.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:b=>y(_=>({..._,fillRate:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),l.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:b=>u(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),l.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:b=>d(_=>({..._,wallThickness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[l.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:b=>y(_=>({..._,autoFill:b.target.checked}))}),l.jsx("span",{children:"Auto-Fill"})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:b=>d(_=>({..._,damping:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Stiffness: ",f.stiffness]}),l.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:b=>d(_=>({..._,stiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),l.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:b=>d(_=>({..._,pressure:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:b=>d(_=>({..._,homeStiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:b=>d(_=>({..._,innerHomeStiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),l.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:b=>d(_=>({..._,returnSpeed:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),l.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:b=>d(_=>({..._,viscosity:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Iterations: ",f.iterations]}),l.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:b=>d(_=>({..._,iterations:Number(b.target.value)})),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Strength: ",N]}),l.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:N,onChange:b=>Y(Number(b.target.value)),style:{width:100}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Impact Radius: ",ee.toFixed(1)," cells"]}),l.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:ee,onChange:b=>B(Number(b.target.value)),style:{width:100}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Droplets: ",ve]}),l.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:ve,onChange:b=>Pe(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Speed: ",be]}),l.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:be,onChange:b=>A(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Lifetime: ",G.toFixed(1),"s"]}),l.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:G,onChange:b=>X(Number(b.target.value)),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Size: ",W,"px"]}),l.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:W,onChange:b=>fe(Number(b.target.value)),style:{width:80}})]})]}),l.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[l.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),l.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:b=>d(_=>({..._,goopiness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),l.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:b=>d(_=>({..._,attractionRadius:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),l.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:b=>d(_=>({..._,attractionStiffness:Number(b.target.value)})),style:{width:80}})]}),l.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[l.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),l.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:b=>d(_=>({..._,tendrilEndRadius:Number(b.target.value)})),style:{width:80}})]})]})]}),l.jsxs("svg",{ref:e,width:z3,height:Y3,style:{background:ne,borderRadius:8},children:[l.jsx("defs",{children:l.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[l.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),l.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:H(),result:"goo"}),l.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&l.jsxs("g",{opacity:.2,children:[Array.from({length:ln+1}).map((b,_)=>l.jsx("line",{x1:kn+_*ct,y1:wn,x2:kn+_*ct,y2:wn+et*ct,stroke:"#fff",strokeWidth:1},`v${_}`)),Array.from({length:et+1}).map((b,_)=>l.jsx("line",{x1:kn,y1:wn+_*ct,x2:kn+ln*ct,y2:wn+_*ct,stroke:"#fff",strokeWidth:1},`h${_}`))]}),l.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((b,_)=>{const O=s.current[b.blobA],$=s.current[b.blobB];if(!O||!$)return null;const V=O.vertices[b.vertA],te=$.vertices[b.vertB];if(!V||!te)return null;const me=te.pos.x-V.pos.x,ge=te.pos.y-V.pos.y,Z=Math.sqrt(me*me+ge*ge),Oe=Math.min(1,Z/f.goopiness),Ee=f.tendrilEndRadius,$e=1-f.tendrilSkinniness,Ye=1-f.tendrilSkinniness*.3,Xe=Ye-(Ye-$e)*Oe,Le=Ee*Xe,Je=Ee*1.4,ce=Math.max(2,Math.ceil(Z/Je)),it=[];for(let lt=0;lt<=ce;lt++){const Rt=lt/ce,de=Math.sin(Rt*Math.PI),ue=Ee-(Ee-Le)*de;it.push({cx:V.pos.x+me*Rt,cy:V.pos.y+ge*Rt,r:Math.max(2,ue)})}return l.jsx("g",{children:it.map((lt,Rt)=>l.jsx("circle",{cx:lt.cx,cy:lt.cy,r:lt.r,fill:O.color},Rt))},`tendril-${_}`)}),s.current.map((b,_)=>{const O=b.isLocked&&b.fillAmount>=1;return l.jsx("g",{style:{cursor:O?"pointer":"default"},onClick:()=>O&&ze(b),children:l.jsx("path",{d:d5(b.vertices),fill:b.color,stroke:b.color,strokeWidth:2})},b.id)})]}),s.current.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const _=b.vertices.map(Z=>Z.pos),O=p5(_,f.wallThickness),$=we(O),V=$.maxY-$.minY,te=$.maxY-V*b.fillAmount,me=50,ge=`unfilled-clip-${b.id}`;return l.jsxs("g",{children:[l.jsx("defs",{children:l.jsx("clipPath",{id:ge,children:l.jsx("rect",{x:$.minX-me,y:$.minY-me,width:$.maxX-$.minX+me*2,height:te-$.minY+me})})}),l.jsx("path",{d:V0(O),fill:ne,clipPath:`url(#${ge})`})]},`inner-${b.id}`)}),l.jsx("g",{children:re.current.map(b=>l.jsx("circle",{cx:b.pos.x,cy:b.pos.y,r:b.radius,fill:b.color,opacity:b.opacity},b.id))}),s.current.filter(b=>b.gridCells.length>4).map(b=>l.jsxs("g",{children:[b.vertices.map((_,O)=>l.jsxs("g",{children:[l.jsx("circle",{cx:_.pos.x,cy:_.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),l.jsx("text",{x:_.pos.x+6,y:_.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:O})]},`v-${O}`)),b.vertices.map((_,O)=>{const $=b.vertices[(O+1)%b.vertices.length];return l.jsx("line",{x1:_.pos.x,y1:_.pos.y,x2:$.pos.x,y2:$.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${O}`)})]},`debug-verts-${b.id}`)),s.current.map((b,_)=>l.jsx("text",{x:b.targetX,y:b.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:b.isLocked?`${Math.round(b.fillAmount*100)}%`:"falling"},`info-${b.id}`))]}),l.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[l.jsx("strong",{children:"Proto-8: Pop"}),l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"How to test:"}),l.jsx("br",{})," Wait for a blob to fill to 100%",l.jsx("br",{})," Click the filled blob to pop it",l.jsx("br",{})," Droplets scatter outward and fade",l.jsx("br",{}),l.jsx("br",{}),l.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",l.jsx("strong",{children:"Droplets:"})," ",re.current.length]})]})}const x5=()=>new URLSearchParams(window.location.search).get("proto"),y5=()=>{var y;const[e,t]=g.useState("GAME"),[n,s]=g.useState(()=>cv()),[r,o]=g.useState(0);dv(),g.useEffect(()=>{uv(n)},[n]),g.useEffect(()=>{Tt.init(n.settings)},[]);const a=g.useCallback(v=>{s(k=>{const w=gt(k.careerScore),{newCareerScore:m,ranksGained:h}=I0(k.careerScore,v.score,v.won),x=gt(m),C=h>0?h:0,P=Xm(w.rank,x.rank).filter(R=>!k.milestonesReached.includes(R));return P.length>0&&pe.emit(ae.MILESTONE_REACHED,{milestones:P}),{...k,careerScore:m,careerRank:x.rank,scraps:k.scraps+C,milestonesReached:[...k.milestonesReached,...P],firstRunComplete:!0}})},[]),i=v=>{s(k=>({...k,settings:v})),Tt.updateSettings(v)},c=v=>{if(v===0){const k=fv();s(k),o(w=>w+1),Tt.init(k.settings)}else{const k=Wm(v);s(w=>({...w,careerScore:k,careerRank:v,scraps:v,powerUps:{}})),o(w=>w+1)}},u=g.useCallback(v=>{s(k=>{const w=k.powerUps[v]||0,m=Nn[v],h=(m==null?void 0:m.maxLevel)||4,x=(m==null?void 0:m.costPerLevel)||1;return k.scraps<x||w>=h?k:{...k,scraps:k.scraps-x,powerUps:{...k.powerUps,[v]:w+1}}})},[]),f=g.useCallback(v=>{s(k=>{const w=k.powerUps[v]||0,m=Nn[v],h=(m==null?void 0:m.costPerLevel)||1;if(w<=0)return k;let x=k.equippedActives;return w===1&&k.equippedActives.includes(v)&&(x=k.equippedActives.filter(C=>C!==v)),{...k,scraps:k.scraps+h,powerUps:{...k.powerUps,[v]:w-1},equippedActives:x}})},[]),d=g.useCallback(v=>{s(k=>{const w=k.equippedActives.includes(v);let m;if(w)m=k.equippedActives.filter(h=>h!==v);else{const x=1+((k.powerUps.ACTIVE_EXPANSION_SLOT||0)+(k.powerUps.ACTIVE_EXPANSION_SLOT_2||0));k.equippedActives.length>=x?m=[...k.equippedActives.slice(0,x-1),v]:m=[...k.equippedActives,v]}return{...k,equippedActives:m}})},[]),p=x5();return p==="1"?l.jsx(vv,{}):p==="2"?l.jsx(bv,{}):p==="3"?l.jsx($v,{}):p==="4"?l.jsx(qv,{}):p==="5"?l.jsx(l2,{}):p==="5b"?l.jsx(C2,{}):p==="5c"?l.jsx(O2,{}):p==="6"?l.jsx(q2,{}):p==="7"?l.jsx(m3,{}):p==="8"?l.jsx(B3,{}):p==="9"?l.jsx(h5,{}):l.jsxs("div",{className:"w-full h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[e==="GAME"&&l.jsx(sv,{onExit:()=>{},onRunComplete:a,initialTotalScore:n.careerScore,powerUps:n.powerUps,scraps:n.scraps,settings:n.settings,onOpenSettings:()=>t("SETTINGS"),onOpenHelp:()=>t("HOW_TO_PLAY"),onOpenUpgrades:()=>t("UPGRADES"),onSetRank:c,onPurchaseUpgrade:u,onRefundUpgrade:f,equippedActives:n.equippedActives,onToggleEquip:d,saveData:n,setSaveData:s},r),e==="UPGRADES"&&l.jsx(ov,{onBack:()=>t("GAME")}),e==="SETTINGS"&&l.jsx(rv,{settings:n.settings,onUpdate:i,onBack:()=>t("GAME")}),e==="HOW_TO_PLAY"&&l.jsx(lv,{completedSteps:((y=n.tutorialProgress)==null?void 0:y.completedSteps)??[],onBack:()=>t("GAME")})]})},q0=document.getElementById("root");if(!q0)throw new Error("Could not find root element to mount to");const m5=aa.createRoot(q0);m5.render(l.jsx(Ch.StrictMode,{children:l.jsx(y5,{})}));
