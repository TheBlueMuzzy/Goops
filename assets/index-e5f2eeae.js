var ih=Object.defineProperty;var lh=(e,t,n)=>t in e?ih(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var He=(e,t,n)=>(lh(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();function ah(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var gd={exports:{}},Zi={},vd={exports:{}},Ze={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cr=Symbol.for("react.element"),ch=Symbol.for("react.portal"),uh=Symbol.for("react.fragment"),fh=Symbol.for("react.strict_mode"),dh=Symbol.for("react.profiler"),ph=Symbol.for("react.provider"),hh=Symbol.for("react.context"),xh=Symbol.for("react.forward_ref"),yh=Symbol.for("react.suspense"),mh=Symbol.for("react.memo"),gh=Symbol.for("react.lazy"),cu=Symbol.iterator;function vh(e){return e===null||typeof e!="object"?null:(e=cu&&e[cu]||e["@@iterator"],typeof e=="function"?e:null)}var Sd={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Cd=Object.assign,kd={};function ko(e,t,n){this.props=e,this.context=t,this.refs=kd,this.updater=n||Sd}ko.prototype.isReactComponent={};ko.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ko.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wd(){}wd.prototype=ko.prototype;function uc(e,t,n){this.props=e,this.context=t,this.refs=kd,this.updater=n||Sd}var fc=uc.prototype=new wd;fc.constructor=uc;Cd(fc,ko.prototype);fc.isPureReactComponent=!0;var uu=Array.isArray,Pd=Object.prototype.hasOwnProperty,dc={current:null},Rd={key:!0,ref:!0,__self:!0,__source:!0};function jd(e,t,n){var s,r={},o=null,l=null;if(t!=null)for(s in t.ref!==void 0&&(l=t.ref),t.key!==void 0&&(o=""+t.key),t)Pd.call(t,s)&&!Rd.hasOwnProperty(s)&&(r[s]=t[s]);var i=arguments.length-2;if(i===1)r.children=n;else if(1<i){for(var c=Array(i),u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(s in i=e.defaultProps,i)r[s]===void 0&&(r[s]=i[s]);return{$$typeof:Cr,type:e,key:o,ref:l,props:r,_owner:dc.current}}function Sh(e,t){return{$$typeof:Cr,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function pc(e){return typeof e=="object"&&e!==null&&e.$$typeof===Cr}function Ch(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var fu=/\/+/g;function yl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ch(""+e.key):t.toString(36)}function oi(e,t,n,s,r){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var l=!1;if(e===null)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case Cr:case ch:l=!0}}if(l)return l=e,r=r(l),e=s===""?"."+yl(l,0):s,uu(r)?(n="",e!=null&&(n=e.replace(fu,"$&/")+"/"),oi(r,t,n,"",function(u){return u})):r!=null&&(pc(r)&&(r=Sh(r,n+(!r.key||l&&l.key===r.key?"":(""+r.key).replace(fu,"$&/")+"/")+e)),t.push(r)),1;if(l=0,s=s===""?".":s+":",uu(e))for(var i=0;i<e.length;i++){o=e[i];var c=s+yl(o,i);l+=oi(o,t,n,c,r)}else if(c=vh(e),typeof c=="function")for(e=c.call(e),i=0;!(o=e.next()).done;)o=o.value,c=s+yl(o,i++),l+=oi(o,t,n,c,r);else if(o==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function jr(e,t,n){if(e==null)return e;var s=[],r=0;return oi(e,s,"","",function(o){return t.call(n,o,r++)}),s}function kh(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Wt={current:null},ri={transition:null},wh={ReactCurrentDispatcher:Wt,ReactCurrentBatchConfig:ri,ReactCurrentOwner:dc};function Td(){throw Error("act(...) is not supported in production builds of React.")}Ze.Children={map:jr,forEach:function(e,t,n){jr(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return jr(e,function(){t++}),t},toArray:function(e){return jr(e,function(t){return t})||[]},only:function(e){if(!pc(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Ze.Component=ko;Ze.Fragment=uh;Ze.Profiler=dh;Ze.PureComponent=uc;Ze.StrictMode=fh;Ze.Suspense=yh;Ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wh;Ze.act=Td;Ze.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Cd({},e.props),r=e.key,o=e.ref,l=e._owner;if(t!=null){if(t.ref!==void 0&&(o=t.ref,l=dc.current),t.key!==void 0&&(r=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)Pd.call(t,c)&&!Rd.hasOwnProperty(c)&&(s[c]=t[c]===void 0&&i!==void 0?i[c]:t[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){i=Array(c);for(var u=0;u<c;u++)i[u]=arguments[u+2];s.children=i}return{$$typeof:Cr,type:e.type,key:r,ref:o,props:s,_owner:l}};Ze.createContext=function(e){return e={$$typeof:hh,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:ph,_context:e},e.Consumer=e};Ze.createElement=jd;Ze.createFactory=function(e){var t=jd.bind(null,e);return t.type=e,t};Ze.createRef=function(){return{current:null}};Ze.forwardRef=function(e){return{$$typeof:xh,render:e}};Ze.isValidElement=pc;Ze.lazy=function(e){return{$$typeof:gh,_payload:{_status:-1,_result:e},_init:kh}};Ze.memo=function(e,t){return{$$typeof:mh,type:e,compare:t===void 0?null:t}};Ze.startTransition=function(e){var t=ri.transition;ri.transition={};try{e()}finally{ri.transition=t}};Ze.unstable_act=Td;Ze.useCallback=function(e,t){return Wt.current.useCallback(e,t)};Ze.useContext=function(e){return Wt.current.useContext(e)};Ze.useDebugValue=function(){};Ze.useDeferredValue=function(e){return Wt.current.useDeferredValue(e)};Ze.useEffect=function(e,t){return Wt.current.useEffect(e,t)};Ze.useId=function(){return Wt.current.useId()};Ze.useImperativeHandle=function(e,t,n){return Wt.current.useImperativeHandle(e,t,n)};Ze.useInsertionEffect=function(e,t){return Wt.current.useInsertionEffect(e,t)};Ze.useLayoutEffect=function(e,t){return Wt.current.useLayoutEffect(e,t)};Ze.useMemo=function(e,t){return Wt.current.useMemo(e,t)};Ze.useReducer=function(e,t,n){return Wt.current.useReducer(e,t,n)};Ze.useRef=function(e){return Wt.current.useRef(e)};Ze.useState=function(e){return Wt.current.useState(e)};Ze.useSyncExternalStore=function(e,t,n){return Wt.current.useSyncExternalStore(e,t,n)};Ze.useTransition=function(){return Wt.current.useTransition()};Ze.version="18.3.1";vd.exports=Ze;var g=vd.exports;const Ph=ah(g);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rh=g,jh=Symbol.for("react.element"),Th=Symbol.for("react.fragment"),Mh=Object.prototype.hasOwnProperty,bh=Rh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ah={key:!0,ref:!0,__self:!0,__source:!0};function Md(e,t,n){var s,r={},o=null,l=null;n!==void 0&&(o=""+n),t.key!==void 0&&(o=""+t.key),t.ref!==void 0&&(l=t.ref);for(s in t)Mh.call(t,s)&&!Ah.hasOwnProperty(s)&&(r[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)r[s]===void 0&&(r[s]=t[s]);return{$$typeof:jh,type:e,key:o,ref:l,props:r,_owner:bh.current}}Zi.Fragment=Th;Zi.jsx=Md;Zi.jsxs=Md;gd.exports=Zi;var a=gd.exports,fa={},bd={exports:{}},rn={},Ad={exports:{}},Ed={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(G,X){var V=G.length;G.push(X);e:for(;0<V;){var te=V-1>>>1,J=G[te];if(0<r(J,X))G[te]=X,G[V]=J,V=te;else break e}}function n(G){return G.length===0?null:G[0]}function s(G){if(G.length===0)return null;var X=G[0],V=G.pop();if(V!==X){G[0]=V;e:for(var te=0,J=G.length,pe=J>>>1;te<pe;){var Me=2*(te+1)-1,he=G[Me],A=Me+1,Y=G[A];if(0>r(he,V))A<J&&0>r(Y,he)?(G[te]=Y,G[A]=V,te=A):(G[te]=he,G[Me]=V,te=Me);else if(A<J&&0>r(Y,V))G[te]=Y,G[A]=V,te=A;else break e}}return X}function r(G,X){var V=G.sortIndex-X.sortIndex;return V!==0?V:G.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,i=l.now();e.unstable_now=function(){return l.now()-i}}var c=[],u=[],f=1,d=null,p=3,y=!1,v=!1,k=!1,w=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x(G){for(var X=n(u);X!==null;){if(X.callback===null)s(u);else if(X.startTime<=G)s(u),X.sortIndex=X.expirationTime,t(c,X);else break;X=n(u)}}function C(G){if(k=!1,x(G),!v)if(n(c)!==null)v=!0,ee(j);else{var X=n(u);X!==null&&H(C,X.startTime-G)}}function j(G,X){v=!1,k&&(k=!1,m(S),S=-1),y=!0;var V=p;try{for(x(X),d=n(c);d!==null&&(!(d.expirationTime>X)||G&&!M());){var te=d.callback;if(typeof te=="function"){d.callback=null,p=d.priorityLevel;var J=te(d.expirationTime<=X);X=e.unstable_now(),typeof J=="function"?d.callback=J:d===n(c)&&s(c),x(X)}else s(c);d=n(c)}if(d!==null)var pe=!0;else{var Me=n(u);Me!==null&&H(C,Me.startTime-X),pe=!1}return pe}finally{d=null,p=V,y=!1}}var R=!1,P=null,S=-1,T=5,E=-1;function M(){return!(e.unstable_now()-E<T)}function Q(){if(P!==null){var G=e.unstable_now();E=G;var X=!0;try{X=P(!0,G)}finally{X?ne():(R=!1,P=null)}}else R=!1}var ne;if(typeof h=="function")ne=function(){h(Q)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,L=ie.port2;ie.port1.onmessage=Q,ne=function(){L.postMessage(null)}}else ne=function(){w(Q,0)};function ee(G){P=G,R||(R=!0,ne())}function H(G,X){S=w(function(){G(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(G){G.callback=null},e.unstable_continueExecution=function(){v||y||(v=!0,ee(j))},e.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<G?Math.floor(1e3/G):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(G){switch(p){case 1:case 2:case 3:var X=3;break;default:X=p}var V=p;p=X;try{return G()}finally{p=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(G,X){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var V=p;p=G;try{return X()}finally{p=V}},e.unstable_scheduleCallback=function(G,X,V){var te=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?te+V:te):V=te,G){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=V+J,G={id:f++,callback:X,priorityLevel:G,startTime:V,expirationTime:J,sortIndex:-1},V>te?(G.sortIndex=V,t(u,G),n(c)===null&&G===n(u)&&(k?(m(S),S=-1):k=!0,H(C,V-te))):(G.sortIndex=J,t(c,G),v||y||(v=!0,ee(j))),G},e.unstable_shouldYield=M,e.unstable_wrapCallback=function(G){var X=p;return function(){var V=p;p=X;try{return G.apply(this,arguments)}finally{p=V}}}})(Ed);Ad.exports=Ed;var Eh=Ad.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ih=g,on=Eh;function Se(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Id=new Set,sr={};function Ds(e,t){po(e,t),po(e+"Capture",t)}function po(e,t){for(sr[e]=t,e=0;e<t.length;e++)Id.add(t[e])}var Vn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),da=Object.prototype.hasOwnProperty,_h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,du={},pu={};function Oh(e){return da.call(pu,e)?!0:da.call(du,e)?!1:_h.test(e)?pu[e]=!0:(du[e]=!0,!1)}function Lh(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Nh(e,t,n,s){if(t===null||typeof t>"u"||Lh(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Xt(e,t,n,s,r,o,l){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=l}var $t={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){$t[e]=new Xt(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];$t[t]=new Xt(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){$t[e]=new Xt(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){$t[e]=new Xt(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){$t[e]=new Xt(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){$t[e]=new Xt(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){$t[e]=new Xt(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){$t[e]=new Xt(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){$t[e]=new Xt(e,5,!1,e.toLowerCase(),null,!1,!1)});var hc=/[\-:]([a-z])/g;function xc(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(hc,xc);$t[t]=new Xt(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(hc,xc);$t[t]=new Xt(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(hc,xc);$t[t]=new Xt(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){$t[e]=new Xt(e,1,!1,e.toLowerCase(),null,!1,!1)});$t.xlinkHref=new Xt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){$t[e]=new Xt(e,1,!1,e.toLowerCase(),null,!0,!0)});function yc(e,t,n,s){var r=$t.hasOwnProperty(t)?$t[t]:null;(r!==null?r.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Nh(t,n,r,s)&&(n=null),s||r===null?Oh(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=n===null?r.type===3?!1:"":n:(t=r.attributeName,s=r.attributeNamespace,n===null?e.removeAttribute(t):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var Qn=Ih.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tr=Symbol.for("react.element"),Xs=Symbol.for("react.portal"),Vs=Symbol.for("react.fragment"),mc=Symbol.for("react.strict_mode"),pa=Symbol.for("react.profiler"),_d=Symbol.for("react.provider"),Od=Symbol.for("react.context"),gc=Symbol.for("react.forward_ref"),ha=Symbol.for("react.suspense"),xa=Symbol.for("react.suspense_list"),vc=Symbol.for("react.memo"),ns=Symbol.for("react.lazy"),Ld=Symbol.for("react.offscreen"),hu=Symbol.iterator;function jo(e){return e===null||typeof e!="object"?null:(e=hu&&e[hu]||e["@@iterator"],typeof e=="function"?e:null)}var St=Object.assign,ml;function Go(e){if(ml===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);ml=t&&t[1]||""}return`
`+ml+e}var gl=!1;function vl(e,t){if(!e||gl)return"";gl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var s=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){s=u}e.call(t.prototype)}else{try{throw Error()}catch(u){s=u}e()}}catch(u){if(u&&s&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=s.stack.split(`
`),l=r.length-1,i=o.length-1;1<=l&&0<=i&&r[l]!==o[i];)i--;for(;1<=l&&0<=i;l--,i--)if(r[l]!==o[i]){if(l!==1||i!==1)do if(l--,i--,0>i||r[l]!==o[i]){var c=`
`+r[l].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=l&&0<=i);break}}}finally{gl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Go(e):""}function Dh(e){switch(e.tag){case 5:return Go(e.type);case 16:return Go("Lazy");case 13:return Go("Suspense");case 19:return Go("SuspenseList");case 0:case 2:case 15:return e=vl(e.type,!1),e;case 11:return e=vl(e.type.render,!1),e;case 1:return e=vl(e.type,!0),e;default:return""}}function ya(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Vs:return"Fragment";case Xs:return"Portal";case pa:return"Profiler";case mc:return"StrictMode";case ha:return"Suspense";case xa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Od:return(e.displayName||"Context")+".Consumer";case _d:return(e._context.displayName||"Context")+".Provider";case gc:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case vc:return t=e.displayName||null,t!==null?t:ya(e.type)||"Memo";case ns:t=e._payload,e=e._init;try{return ya(e(t))}catch{}}return null}function $h(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ya(t);case 8:return t===mc?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function ms(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Nd(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Fh(e){var t=Nd(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(l){s=""+l,o.call(this,l)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(l){s=""+l},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Mr(e){e._valueTracker||(e._valueTracker=Fh(e))}function Dd(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=Nd(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function Si(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ma(e,t){var n=t.checked;return St({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function xu(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=ms(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function $d(e,t){t=t.checked,t!=null&&yc(e,"checked",t,!1)}function ga(e,t){$d(e,t);var n=ms(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?va(e,t.type,n):t.hasOwnProperty("defaultValue")&&va(e,t.type,ms(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function yu(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function va(e,t,n){(t!=="number"||Si(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Bo=Array.isArray;function io(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+ms(n),t=null,r=0;r<e.length;r++){if(e[r].value===n){e[r].selected=!0,s&&(e[r].defaultSelected=!0);return}t!==null||e[r].disabled||(t=e[r])}t!==null&&(t.selected=!0)}}function Sa(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Se(91));return St({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function mu(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(Se(92));if(Bo(n)){if(1<n.length)throw Error(Se(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:ms(n)}}function Fd(e,t){var n=ms(t.value),s=ms(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function gu(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Gd(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ca(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Gd(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var br,Bd=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,r){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,r)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(br=br||document.createElement("div"),br.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=br.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function or(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Wo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Gh=["Webkit","ms","Moz","O"];Object.keys(Wo).forEach(function(e){Gh.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Wo[t]=Wo[e]})});function zd(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Wo.hasOwnProperty(e)&&Wo[e]?(""+t).trim():t+"px"}function Yd(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=zd(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}var Bh=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ka(e,t){if(t){if(Bh[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Se(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Se(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Se(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Se(62))}}function wa(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pa=null;function Sc(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Ra=null,lo=null,ao=null;function vu(e){if(e=Pr(e)){if(typeof Ra!="function")throw Error(Se(280));var t=e.stateNode;t&&(t=nl(t),Ra(e.stateNode,e.type,t))}}function Hd(e){lo?ao?ao.push(e):ao=[e]:lo=e}function Ud(){if(lo){var e=lo,t=ao;if(ao=lo=null,vu(e),t)for(e=0;e<t.length;e++)vu(t[e])}}function Wd(e,t){return e(t)}function Xd(){}var Sl=!1;function Vd(e,t,n){if(Sl)return e(t,n);Sl=!0;try{return Wd(e,t,n)}finally{Sl=!1,(lo!==null||ao!==null)&&(Xd(),Ud())}}function rr(e,t){var n=e.stateNode;if(n===null)return null;var s=nl(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(Se(231,t,typeof n));return n}var ja=!1;if(Vn)try{var To={};Object.defineProperty(To,"passive",{get:function(){ja=!0}}),window.addEventListener("test",To,To),window.removeEventListener("test",To,To)}catch{ja=!1}function zh(e,t,n,s,r,o,l,i,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(f){this.onError(f)}}var Xo=!1,Ci=null,ki=!1,Ta=null,Yh={onError:function(e){Xo=!0,Ci=e}};function Hh(e,t,n,s,r,o,l,i,c){Xo=!1,Ci=null,zh.apply(Yh,arguments)}function Uh(e,t,n,s,r,o,l,i,c){if(Hh.apply(this,arguments),Xo){if(Xo){var u=Ci;Xo=!1,Ci=null}else throw Error(Se(198));ki||(ki=!0,Ta=u)}}function $s(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function qd(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Su(e){if($s(e)!==e)throw Error(Se(188))}function Wh(e){var t=e.alternate;if(!t){if(t=$s(e),t===null)throw Error(Se(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Su(r),e;if(o===s)return Su(r),t;o=o.sibling}throw Error(Se(188))}if(n.return!==s.return)n=r,s=o;else{for(var l=!1,i=r.child;i;){if(i===n){l=!0,n=r,s=o;break}if(i===s){l=!0,s=r,n=o;break}i=i.sibling}if(!l){for(i=o.child;i;){if(i===n){l=!0,n=o,s=r;break}if(i===s){l=!0,s=o,n=r;break}i=i.sibling}if(!l)throw Error(Se(189))}}if(n.alternate!==s)throw Error(Se(190))}if(n.tag!==3)throw Error(Se(188));return n.stateNode.current===n?e:t}function Kd(e){return e=Wh(e),e!==null?Zd(e):null}function Zd(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Zd(e);if(t!==null)return t;e=e.sibling}return null}var Qd=on.unstable_scheduleCallback,Cu=on.unstable_cancelCallback,Xh=on.unstable_shouldYield,Vh=on.unstable_requestPaint,wt=on.unstable_now,qh=on.unstable_getCurrentPriorityLevel,Cc=on.unstable_ImmediatePriority,Jd=on.unstable_UserBlockingPriority,wi=on.unstable_NormalPriority,Kh=on.unstable_LowPriority,ep=on.unstable_IdlePriority,Qi=null,Ln=null;function Zh(e){if(Ln&&typeof Ln.onCommitFiberRoot=="function")try{Ln.onCommitFiberRoot(Qi,e,void 0,(e.current.flags&128)===128)}catch{}}var Tn=Math.clz32?Math.clz32:e1,Qh=Math.log,Jh=Math.LN2;function e1(e){return e>>>=0,e===0?32:31-(Qh(e)/Jh|0)|0}var Ar=64,Er=4194304;function zo(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Pi(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,r=e.suspendedLanes,o=e.pingedLanes,l=n&268435455;if(l!==0){var i=l&~r;i!==0?s=zo(i):(o&=l,o!==0&&(s=zo(o)))}else l=n&~r,l!==0?s=zo(l):o!==0&&(s=zo(o));if(s===0)return 0;if(t!==0&&t!==s&&!(t&r)&&(r=s&-s,o=t&-t,r>=o||r===16&&(o&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-Tn(t),r=1<<n,s|=e[n],t&=~r;return s}function t1(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function n1(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,o=e.pendingLanes;0<o;){var l=31-Tn(o),i=1<<l,c=r[l];c===-1?(!(i&n)||i&s)&&(r[l]=t1(i,t)):c<=t&&(e.expiredLanes|=i),o&=~i}}function Ma(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function tp(){var e=Ar;return Ar<<=1,!(Ar&4194240)&&(Ar=64),e}function Cl(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function kr(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Tn(t),e[t]=n}function s1(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-Tn(n),o=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~o}}function kc(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-Tn(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var lt=0;function np(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var sp,wc,op,rp,ip,ba=!1,Ir=[],as=null,cs=null,us=null,ir=new Map,lr=new Map,os=[],o1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ku(e,t){switch(e){case"focusin":case"focusout":as=null;break;case"dragenter":case"dragleave":cs=null;break;case"mouseover":case"mouseout":us=null;break;case"pointerover":case"pointerout":ir.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":lr.delete(t.pointerId)}}function Mo(e,t,n,s,r,o){return e===null||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},t!==null&&(t=Pr(t),t!==null&&wc(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,r!==null&&t.indexOf(r)===-1&&t.push(r),e)}function r1(e,t,n,s,r){switch(t){case"focusin":return as=Mo(as,e,t,n,s,r),!0;case"dragenter":return cs=Mo(cs,e,t,n,s,r),!0;case"mouseover":return us=Mo(us,e,t,n,s,r),!0;case"pointerover":var o=r.pointerId;return ir.set(o,Mo(ir.get(o)||null,e,t,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,lr.set(o,Mo(lr.get(o)||null,e,t,n,s,r)),!0}return!1}function lp(e){var t=js(e.target);if(t!==null){var n=$s(t);if(n!==null){if(t=n.tag,t===13){if(t=qd(n),t!==null){e.blockedOn=t,ip(e.priority,function(){op(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ii(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=Aa(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Pa=s,n.target.dispatchEvent(s),Pa=null}else return t=Pr(n),t!==null&&wc(t),e.blockedOn=n,!1;t.shift()}return!0}function wu(e,t,n){ii(e)&&n.delete(t)}function i1(){ba=!1,as!==null&&ii(as)&&(as=null),cs!==null&&ii(cs)&&(cs=null),us!==null&&ii(us)&&(us=null),ir.forEach(wu),lr.forEach(wu)}function bo(e,t){e.blockedOn===t&&(e.blockedOn=null,ba||(ba=!0,on.unstable_scheduleCallback(on.unstable_NormalPriority,i1)))}function ar(e){function t(r){return bo(r,e)}if(0<Ir.length){bo(Ir[0],e);for(var n=1;n<Ir.length;n++){var s=Ir[n];s.blockedOn===e&&(s.blockedOn=null)}}for(as!==null&&bo(as,e),cs!==null&&bo(cs,e),us!==null&&bo(us,e),ir.forEach(t),lr.forEach(t),n=0;n<os.length;n++)s=os[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<os.length&&(n=os[0],n.blockedOn===null);)lp(n),n.blockedOn===null&&os.shift()}var co=Qn.ReactCurrentBatchConfig,Ri=!0;function l1(e,t,n,s){var r=lt,o=co.transition;co.transition=null;try{lt=1,Pc(e,t,n,s)}finally{lt=r,co.transition=o}}function a1(e,t,n,s){var r=lt,o=co.transition;co.transition=null;try{lt=4,Pc(e,t,n,s)}finally{lt=r,co.transition=o}}function Pc(e,t,n,s){if(Ri){var r=Aa(e,t,n,s);if(r===null)El(e,t,s,ji,n),ku(e,s);else if(r1(r,e,t,n,s))s.stopPropagation();else if(ku(e,s),t&4&&-1<o1.indexOf(e)){for(;r!==null;){var o=Pr(r);if(o!==null&&sp(o),o=Aa(e,t,n,s),o===null&&El(e,t,s,ji,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else El(e,t,s,null,n)}}var ji=null;function Aa(e,t,n,s){if(ji=null,e=Sc(s),e=js(e),e!==null)if(t=$s(e),t===null)e=null;else if(n=t.tag,n===13){if(e=qd(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ji=e,null}function ap(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qh()){case Cc:return 1;case Jd:return 4;case wi:case Kh:return 16;case ep:return 536870912;default:return 16}default:return 16}}var is=null,Rc=null,li=null;function cp(){if(li)return li;var e,t=Rc,n=t.length,s,r="value"in is?is.value:is.textContent,o=r.length;for(e=0;e<n&&t[e]===r[e];e++);var l=n-e;for(s=1;s<=l&&t[n-s]===r[o-s];s++);return li=r.slice(e,1<s?1-s:void 0)}function ai(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function _r(){return!0}function Pu(){return!1}function ln(e){function t(n,s,r,o,l){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=l,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(n=e[i],this[i]=n?n(o):o[i]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?_r:Pu,this.isPropagationStopped=Pu,this}return St(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=_r)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=_r)},persist:function(){},isPersistent:_r}),t}var wo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},jc=ln(wo),wr=St({},wo,{view:0,detail:0}),c1=ln(wr),kl,wl,Ao,Ji=St({},wr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Tc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ao&&(Ao&&e.type==="mousemove"?(kl=e.screenX-Ao.screenX,wl=e.screenY-Ao.screenY):wl=kl=0,Ao=e),kl)},movementY:function(e){return"movementY"in e?e.movementY:wl}}),Ru=ln(Ji),u1=St({},Ji,{dataTransfer:0}),f1=ln(u1),d1=St({},wr,{relatedTarget:0}),Pl=ln(d1),p1=St({},wo,{animationName:0,elapsedTime:0,pseudoElement:0}),h1=ln(p1),x1=St({},wo,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),y1=ln(x1),m1=St({},wo,{data:0}),ju=ln(m1),g1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},v1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},S1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function C1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=S1[e])?!!t[e]:!1}function Tc(){return C1}var k1=St({},wr,{key:function(e){if(e.key){var t=g1[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ai(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?v1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Tc,charCode:function(e){return e.type==="keypress"?ai(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ai(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),w1=ln(k1),P1=St({},Ji,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tu=ln(P1),R1=St({},wr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Tc}),j1=ln(R1),T1=St({},wo,{propertyName:0,elapsedTime:0,pseudoElement:0}),M1=ln(T1),b1=St({},Ji,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),A1=ln(b1),E1=[9,13,27,32],Mc=Vn&&"CompositionEvent"in window,Vo=null;Vn&&"documentMode"in document&&(Vo=document.documentMode);var I1=Vn&&"TextEvent"in window&&!Vo,up=Vn&&(!Mc||Vo&&8<Vo&&11>=Vo),Mu=String.fromCharCode(32),bu=!1;function fp(e,t){switch(e){case"keyup":return E1.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var qs=!1;function _1(e,t){switch(e){case"compositionend":return dp(t);case"keypress":return t.which!==32?null:(bu=!0,Mu);case"textInput":return e=t.data,e===Mu&&bu?null:e;default:return null}}function O1(e,t){if(qs)return e==="compositionend"||!Mc&&fp(e,t)?(e=cp(),li=Rc=is=null,qs=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return up&&t.locale!=="ko"?null:t.data;default:return null}}var L1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Au(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!L1[e.type]:t==="textarea"}function pp(e,t,n,s){Hd(s),t=Ti(t,"onChange"),0<t.length&&(n=new jc("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var qo=null,cr=null;function N1(e){Pp(e,0)}function el(e){var t=Qs(e);if(Dd(t))return e}function D1(e,t){if(e==="change")return t}var hp=!1;if(Vn){var Rl;if(Vn){var jl="oninput"in document;if(!jl){var Eu=document.createElement("div");Eu.setAttribute("oninput","return;"),jl=typeof Eu.oninput=="function"}Rl=jl}else Rl=!1;hp=Rl&&(!document.documentMode||9<document.documentMode)}function Iu(){qo&&(qo.detachEvent("onpropertychange",xp),cr=qo=null)}function xp(e){if(e.propertyName==="value"&&el(cr)){var t=[];pp(t,cr,e,Sc(e)),Vd(N1,t)}}function $1(e,t,n){e==="focusin"?(Iu(),qo=t,cr=n,qo.attachEvent("onpropertychange",xp)):e==="focusout"&&Iu()}function F1(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return el(cr)}function G1(e,t){if(e==="click")return el(t)}function B1(e,t){if(e==="input"||e==="change")return el(t)}function z1(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var bn=typeof Object.is=="function"?Object.is:z1;function ur(e,t){if(bn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!da.call(t,r)||!bn(e[r],t[r]))return!1}return!0}function _u(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ou(e,t){var n=_u(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_u(n)}}function yp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?yp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function mp(){for(var e=window,t=Si();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Si(e.document)}return t}function bc(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Y1(e){var t=mp(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&yp(n.ownerDocument.documentElement,n)){if(s!==null&&bc(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!e.extend&&o>s&&(r=s,s=o,o=r),r=Ou(n,o);var l=Ou(n,s);r&&l&&(e.rangeCount!==1||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&(t=t.createRange(),t.setStart(r.node,r.offset),e.removeAllRanges(),o>s?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var H1=Vn&&"documentMode"in document&&11>=document.documentMode,Ks=null,Ea=null,Ko=null,Ia=!1;function Lu(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Ia||Ks==null||Ks!==Si(s)||(s=Ks,"selectionStart"in s&&bc(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Ko&&ur(Ko,s)||(Ko=s,s=Ti(Ea,"onSelect"),0<s.length&&(t=new jc("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=Ks)))}function Or(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Zs={animationend:Or("Animation","AnimationEnd"),animationiteration:Or("Animation","AnimationIteration"),animationstart:Or("Animation","AnimationStart"),transitionend:Or("Transition","TransitionEnd")},Tl={},gp={};Vn&&(gp=document.createElement("div").style,"AnimationEvent"in window||(delete Zs.animationend.animation,delete Zs.animationiteration.animation,delete Zs.animationstart.animation),"TransitionEvent"in window||delete Zs.transitionend.transition);function tl(e){if(Tl[e])return Tl[e];if(!Zs[e])return e;var t=Zs[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in gp)return Tl[e]=t[n];return e}var vp=tl("animationend"),Sp=tl("animationiteration"),Cp=tl("animationstart"),kp=tl("transitionend"),wp=new Map,Nu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cs(e,t){wp.set(e,t),Ds(t,[e])}for(var Ml=0;Ml<Nu.length;Ml++){var bl=Nu[Ml],U1=bl.toLowerCase(),W1=bl[0].toUpperCase()+bl.slice(1);Cs(U1,"on"+W1)}Cs(vp,"onAnimationEnd");Cs(Sp,"onAnimationIteration");Cs(Cp,"onAnimationStart");Cs("dblclick","onDoubleClick");Cs("focusin","onFocus");Cs("focusout","onBlur");Cs(kp,"onTransitionEnd");po("onMouseEnter",["mouseout","mouseover"]);po("onMouseLeave",["mouseout","mouseover"]);po("onPointerEnter",["pointerout","pointerover"]);po("onPointerLeave",["pointerout","pointerover"]);Ds("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ds("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ds("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ds("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ds("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ds("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),X1=new Set("cancel close invalid load scroll toggle".split(" ").concat(Yo));function Du(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,Uh(s,t,void 0,e),e.currentTarget=null}function Pp(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var o=void 0;if(t)for(var l=s.length-1;0<=l;l--){var i=s[l],c=i.instance,u=i.currentTarget;if(i=i.listener,c!==o&&r.isPropagationStopped())break e;Du(r,i,u),o=c}else for(l=0;l<s.length;l++){if(i=s[l],c=i.instance,u=i.currentTarget,i=i.listener,c!==o&&r.isPropagationStopped())break e;Du(r,i,u),o=c}}}if(ki)throw e=Ta,ki=!1,Ta=null,e}function ft(e,t){var n=t[Da];n===void 0&&(n=t[Da]=new Set);var s=e+"__bubble";n.has(s)||(Rp(t,e,2,!1),n.add(s))}function Al(e,t,n){var s=0;t&&(s|=4),Rp(n,e,s,t)}var Lr="_reactListening"+Math.random().toString(36).slice(2);function fr(e){if(!e[Lr]){e[Lr]=!0,Id.forEach(function(n){n!=="selectionchange"&&(X1.has(n)||Al(n,!1,e),Al(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Lr]||(t[Lr]=!0,Al("selectionchange",!1,t))}}function Rp(e,t,n,s){switch(ap(t)){case 1:var r=l1;break;case 4:r=a1;break;default:r=Pc}n=r.bind(null,t,n,e),r=void 0,!ja||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(r=!0),s?r!==void 0?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):r!==void 0?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function El(e,t,n,s,r){var o=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var l=s.tag;if(l===3||l===4){var i=s.stateNode.containerInfo;if(i===r||i.nodeType===8&&i.parentNode===r)break;if(l===4)for(l=s.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;l=l.return}for(;i!==null;){if(l=js(i),l===null)return;if(c=l.tag,c===5||c===6){s=o=l;continue e}i=i.parentNode}}s=s.return}Vd(function(){var u=o,f=Sc(n),d=[];e:{var p=wp.get(e);if(p!==void 0){var y=jc,v=e;switch(e){case"keypress":if(ai(n)===0)break e;case"keydown":case"keyup":y=w1;break;case"focusin":v="focus",y=Pl;break;case"focusout":v="blur",y=Pl;break;case"beforeblur":case"afterblur":y=Pl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":y=Ru;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":y=f1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":y=j1;break;case vp:case Sp:case Cp:y=h1;break;case kp:y=M1;break;case"scroll":y=c1;break;case"wheel":y=A1;break;case"copy":case"cut":case"paste":y=y1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":y=Tu}var k=(t&4)!==0,w=!k&&e==="scroll",m=k?p!==null?p+"Capture":null:p;k=[];for(var h=u,x;h!==null;){x=h;var C=x.stateNode;if(x.tag===5&&C!==null&&(x=C,m!==null&&(C=rr(h,m),C!=null&&k.push(dr(h,C,x)))),w)break;h=h.return}0<k.length&&(p=new y(p,v,null,n,f),d.push({event:p,listeners:k}))}}if(!(t&7)){e:{if(p=e==="mouseover"||e==="pointerover",y=e==="mouseout"||e==="pointerout",p&&n!==Pa&&(v=n.relatedTarget||n.fromElement)&&(js(v)||v[qn]))break e;if((y||p)&&(p=f.window===f?f:(p=f.ownerDocument)?p.defaultView||p.parentWindow:window,y?(v=n.relatedTarget||n.toElement,y=u,v=v?js(v):null,v!==null&&(w=$s(v),v!==w||v.tag!==5&&v.tag!==6)&&(v=null)):(y=null,v=u),y!==v)){if(k=Ru,C="onMouseLeave",m="onMouseEnter",h="mouse",(e==="pointerout"||e==="pointerover")&&(k=Tu,C="onPointerLeave",m="onPointerEnter",h="pointer"),w=y==null?p:Qs(y),x=v==null?p:Qs(v),p=new k(C,h+"leave",y,n,f),p.target=w,p.relatedTarget=x,C=null,js(f)===u&&(k=new k(m,h+"enter",v,n,f),k.target=x,k.relatedTarget=w,C=k),w=C,y&&v)t:{for(k=y,m=v,h=0,x=k;x;x=Gs(x))h++;for(x=0,C=m;C;C=Gs(C))x++;for(;0<h-x;)k=Gs(k),h--;for(;0<x-h;)m=Gs(m),x--;for(;h--;){if(k===m||m!==null&&k===m.alternate)break t;k=Gs(k),m=Gs(m)}k=null}else k=null;y!==null&&$u(d,p,y,k,!1),v!==null&&w!==null&&$u(d,w,v,k,!0)}}e:{if(p=u?Qs(u):window,y=p.nodeName&&p.nodeName.toLowerCase(),y==="select"||y==="input"&&p.type==="file")var j=D1;else if(Au(p))if(hp)j=B1;else{j=F1;var R=$1}else(y=p.nodeName)&&y.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(j=G1);if(j&&(j=j(e,u))){pp(d,j,n,f);break e}R&&R(e,p,u),e==="focusout"&&(R=p._wrapperState)&&R.controlled&&p.type==="number"&&va(p,"number",p.value)}switch(R=u?Qs(u):window,e){case"focusin":(Au(R)||R.contentEditable==="true")&&(Ks=R,Ea=u,Ko=null);break;case"focusout":Ko=Ea=Ks=null;break;case"mousedown":Ia=!0;break;case"contextmenu":case"mouseup":case"dragend":Ia=!1,Lu(d,n,f);break;case"selectionchange":if(H1)break;case"keydown":case"keyup":Lu(d,n,f)}var P;if(Mc)e:{switch(e){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else qs?fp(e,n)&&(S="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(up&&n.locale!=="ko"&&(qs||S!=="onCompositionStart"?S==="onCompositionEnd"&&qs&&(P=cp()):(is=f,Rc="value"in is?is.value:is.textContent,qs=!0)),R=Ti(u,S),0<R.length&&(S=new ju(S,e,null,n,f),d.push({event:S,listeners:R}),P?S.data=P:(P=dp(n),P!==null&&(S.data=P)))),(P=I1?_1(e,n):O1(e,n))&&(u=Ti(u,"onBeforeInput"),0<u.length&&(f=new ju("onBeforeInput","beforeinput",null,n,f),d.push({event:f,listeners:u}),f.data=P))}Pp(d,t)})}function dr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ti(e,t){for(var n=t+"Capture",s=[];e!==null;){var r=e,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=rr(e,n),o!=null&&s.unshift(dr(e,o,r)),o=rr(e,t),o!=null&&s.push(dr(e,o,r))),e=e.return}return s}function Gs(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function $u(e,t,n,s,r){for(var o=t._reactName,l=[];n!==null&&n!==s;){var i=n,c=i.alternate,u=i.stateNode;if(c!==null&&c===s)break;i.tag===5&&u!==null&&(i=u,r?(c=rr(n,o),c!=null&&l.unshift(dr(n,c,i))):r||(c=rr(n,o),c!=null&&l.push(dr(n,c,i)))),n=n.return}l.length!==0&&e.push({event:t,listeners:l})}var V1=/\r\n?/g,q1=/\u0000|\uFFFD/g;function Fu(e){return(typeof e=="string"?e:""+e).replace(V1,`
`).replace(q1,"")}function Nr(e,t,n){if(t=Fu(t),Fu(e)!==t&&n)throw Error(Se(425))}function Mi(){}var _a=null,Oa=null;function La(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Na=typeof setTimeout=="function"?setTimeout:void 0,K1=typeof clearTimeout=="function"?clearTimeout:void 0,Gu=typeof Promise=="function"?Promise:void 0,Z1=typeof queueMicrotask=="function"?queueMicrotask:typeof Gu<"u"?function(e){return Gu.resolve(null).then(e).catch(Q1)}:Na;function Q1(e){setTimeout(function(){throw e})}function Il(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){e.removeChild(r),ar(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);ar(t)}function fs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Bu(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Po=Math.random().toString(36).slice(2),On="__reactFiber$"+Po,pr="__reactProps$"+Po,qn="__reactContainer$"+Po,Da="__reactEvents$"+Po,J1="__reactListeners$"+Po,ex="__reactHandles$"+Po;function js(e){var t=e[On];if(t)return t;for(var n=e.parentNode;n;){if(t=n[qn]||n[On]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Bu(e);e!==null;){if(n=e[On])return n;e=Bu(e)}return t}e=n,n=e.parentNode}return null}function Pr(e){return e=e[On]||e[qn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Qs(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Se(33))}function nl(e){return e[pr]||null}var $a=[],Js=-1;function ks(e){return{current:e}}function dt(e){0>Js||(e.current=$a[Js],$a[Js]=null,Js--)}function ut(e,t){Js++,$a[Js]=e.current,e.current=t}var gs={},Yt=ks(gs),Kt=ks(!1),Is=gs;function ho(e,t){var n=e.type.contextTypes;if(!n)return gs;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=t[o];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function Zt(e){return e=e.childContextTypes,e!=null}function bi(){dt(Kt),dt(Yt)}function zu(e,t,n){if(Yt.current!==gs)throw Error(Se(168));ut(Yt,t),ut(Kt,n)}function jp(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in t))throw Error(Se(108,$h(e)||"Unknown",r));return St({},n,s)}function Ai(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||gs,Is=Yt.current,ut(Yt,e),ut(Kt,Kt.current),!0}function Yu(e,t,n){var s=e.stateNode;if(!s)throw Error(Se(169));n?(e=jp(e,t,Is),s.__reactInternalMemoizedMergedChildContext=e,dt(Kt),dt(Yt),ut(Yt,e)):dt(Kt),ut(Kt,n)}var Gn=null,sl=!1,_l=!1;function Tp(e){Gn===null?Gn=[e]:Gn.push(e)}function tx(e){sl=!0,Tp(e)}function ws(){if(!_l&&Gn!==null){_l=!0;var e=0,t=lt;try{var n=Gn;for(lt=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}Gn=null,sl=!1}catch(r){throw Gn!==null&&(Gn=Gn.slice(e+1)),Qd(Cc,ws),r}finally{lt=t,_l=!1}}return null}var eo=[],to=0,Ei=null,Ii=0,cn=[],un=0,_s=null,zn=1,Yn="";function Ps(e,t){eo[to++]=Ii,eo[to++]=Ei,Ei=e,Ii=t}function Mp(e,t,n){cn[un++]=zn,cn[un++]=Yn,cn[un++]=_s,_s=e;var s=zn;e=Yn;var r=32-Tn(s)-1;s&=~(1<<r),n+=1;var o=32-Tn(t)+r;if(30<o){var l=r-r%5;o=(s&(1<<l)-1).toString(32),s>>=l,r-=l,zn=1<<32-Tn(t)+r|n<<r|s,Yn=o+e}else zn=1<<o|n<<r|s,Yn=e}function Ac(e){e.return!==null&&(Ps(e,1),Mp(e,1,0))}function Ec(e){for(;e===Ei;)Ei=eo[--to],eo[to]=null,Ii=eo[--to],eo[to]=null;for(;e===_s;)_s=cn[--un],cn[un]=null,Yn=cn[--un],cn[un]=null,zn=cn[--un],cn[un]=null}var sn=null,nn=null,pt=!1,vn=null;function bp(e,t){var n=fn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Hu(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,sn=e,nn=fs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,sn=e,nn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=_s!==null?{id:zn,overflow:Yn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=fn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,sn=e,nn=null,!0):!1;default:return!1}}function Fa(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ga(e){if(pt){var t=nn;if(t){var n=t;if(!Hu(e,t)){if(Fa(e))throw Error(Se(418));t=fs(n.nextSibling);var s=sn;t&&Hu(e,t)?bp(s,n):(e.flags=e.flags&-4097|2,pt=!1,sn=e)}}else{if(Fa(e))throw Error(Se(418));e.flags=e.flags&-4097|2,pt=!1,sn=e}}}function Uu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;sn=e}function Dr(e){if(e!==sn)return!1;if(!pt)return Uu(e),pt=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!La(e.type,e.memoizedProps)),t&&(t=nn)){if(Fa(e))throw Ap(),Error(Se(418));for(;t;)bp(e,t),t=fs(t.nextSibling)}if(Uu(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Se(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){nn=fs(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}nn=null}}else nn=sn?fs(e.stateNode.nextSibling):null;return!0}function Ap(){for(var e=nn;e;)e=fs(e.nextSibling)}function xo(){nn=sn=null,pt=!1}function Ic(e){vn===null?vn=[e]:vn.push(e)}var nx=Qn.ReactCurrentBatchConfig;function Eo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Se(309));var s=n.stateNode}if(!s)throw Error(Se(147,e));var r=s,o=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===o?t.ref:(t=function(l){var i=r.refs;l===null?delete i[o]:i[o]=l},t._stringRef=o,t)}if(typeof e!="string")throw Error(Se(284));if(!n._owner)throw Error(Se(290,e))}return e}function $r(e,t){throw e=Object.prototype.toString.call(t),Error(Se(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Wu(e){var t=e._init;return t(e._payload)}function Ep(e){function t(m,h){if(e){var x=m.deletions;x===null?(m.deletions=[h],m.flags|=16):x.push(h)}}function n(m,h){if(!e)return null;for(;h!==null;)t(m,h),h=h.sibling;return null}function s(m,h){for(m=new Map;h!==null;)h.key!==null?m.set(h.key,h):m.set(h.index,h),h=h.sibling;return m}function r(m,h){return m=xs(m,h),m.index=0,m.sibling=null,m}function o(m,h,x){return m.index=x,e?(x=m.alternate,x!==null?(x=x.index,x<h?(m.flags|=2,h):x):(m.flags|=2,h)):(m.flags|=1048576,h)}function l(m){return e&&m.alternate===null&&(m.flags|=2),m}function i(m,h,x,C){return h===null||h.tag!==6?(h=Gl(x,m.mode,C),h.return=m,h):(h=r(h,x),h.return=m,h)}function c(m,h,x,C){var j=x.type;return j===Vs?f(m,h,x.props.children,C,x.key):h!==null&&(h.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===ns&&Wu(j)===h.type)?(C=r(h,x.props),C.ref=Eo(m,h,x),C.return=m,C):(C=xi(x.type,x.key,x.props,null,m.mode,C),C.ref=Eo(m,h,x),C.return=m,C)}function u(m,h,x,C){return h===null||h.tag!==4||h.stateNode.containerInfo!==x.containerInfo||h.stateNode.implementation!==x.implementation?(h=Bl(x,m.mode,C),h.return=m,h):(h=r(h,x.children||[]),h.return=m,h)}function f(m,h,x,C,j){return h===null||h.tag!==7?(h=Es(x,m.mode,C,j),h.return=m,h):(h=r(h,x),h.return=m,h)}function d(m,h,x){if(typeof h=="string"&&h!==""||typeof h=="number")return h=Gl(""+h,m.mode,x),h.return=m,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case Tr:return x=xi(h.type,h.key,h.props,null,m.mode,x),x.ref=Eo(m,null,h),x.return=m,x;case Xs:return h=Bl(h,m.mode,x),h.return=m,h;case ns:var C=h._init;return d(m,C(h._payload),x)}if(Bo(h)||jo(h))return h=Es(h,m.mode,x,null),h.return=m,h;$r(m,h)}return null}function p(m,h,x,C){var j=h!==null?h.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return j!==null?null:i(m,h,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Tr:return x.key===j?c(m,h,x,C):null;case Xs:return x.key===j?u(m,h,x,C):null;case ns:return j=x._init,p(m,h,j(x._payload),C)}if(Bo(x)||jo(x))return j!==null?null:f(m,h,x,C,null);$r(m,x)}return null}function y(m,h,x,C,j){if(typeof C=="string"&&C!==""||typeof C=="number")return m=m.get(x)||null,i(h,m,""+C,j);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case Tr:return m=m.get(C.key===null?x:C.key)||null,c(h,m,C,j);case Xs:return m=m.get(C.key===null?x:C.key)||null,u(h,m,C,j);case ns:var R=C._init;return y(m,h,x,R(C._payload),j)}if(Bo(C)||jo(C))return m=m.get(x)||null,f(h,m,C,j,null);$r(h,C)}return null}function v(m,h,x,C){for(var j=null,R=null,P=h,S=h=0,T=null;P!==null&&S<x.length;S++){P.index>S?(T=P,P=null):T=P.sibling;var E=p(m,P,x[S],C);if(E===null){P===null&&(P=T);break}e&&P&&E.alternate===null&&t(m,P),h=o(E,h,S),R===null?j=E:R.sibling=E,R=E,P=T}if(S===x.length)return n(m,P),pt&&Ps(m,S),j;if(P===null){for(;S<x.length;S++)P=d(m,x[S],C),P!==null&&(h=o(P,h,S),R===null?j=P:R.sibling=P,R=P);return pt&&Ps(m,S),j}for(P=s(m,P);S<x.length;S++)T=y(P,m,S,x[S],C),T!==null&&(e&&T.alternate!==null&&P.delete(T.key===null?S:T.key),h=o(T,h,S),R===null?j=T:R.sibling=T,R=T);return e&&P.forEach(function(M){return t(m,M)}),pt&&Ps(m,S),j}function k(m,h,x,C){var j=jo(x);if(typeof j!="function")throw Error(Se(150));if(x=j.call(x),x==null)throw Error(Se(151));for(var R=j=null,P=h,S=h=0,T=null,E=x.next();P!==null&&!E.done;S++,E=x.next()){P.index>S?(T=P,P=null):T=P.sibling;var M=p(m,P,E.value,C);if(M===null){P===null&&(P=T);break}e&&P&&M.alternate===null&&t(m,P),h=o(M,h,S),R===null?j=M:R.sibling=M,R=M,P=T}if(E.done)return n(m,P),pt&&Ps(m,S),j;if(P===null){for(;!E.done;S++,E=x.next())E=d(m,E.value,C),E!==null&&(h=o(E,h,S),R===null?j=E:R.sibling=E,R=E);return pt&&Ps(m,S),j}for(P=s(m,P);!E.done;S++,E=x.next())E=y(P,m,S,E.value,C),E!==null&&(e&&E.alternate!==null&&P.delete(E.key===null?S:E.key),h=o(E,h,S),R===null?j=E:R.sibling=E,R=E);return e&&P.forEach(function(Q){return t(m,Q)}),pt&&Ps(m,S),j}function w(m,h,x,C){if(typeof x=="object"&&x!==null&&x.type===Vs&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case Tr:e:{for(var j=x.key,R=h;R!==null;){if(R.key===j){if(j=x.type,j===Vs){if(R.tag===7){n(m,R.sibling),h=r(R,x.props.children),h.return=m,m=h;break e}}else if(R.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===ns&&Wu(j)===R.type){n(m,R.sibling),h=r(R,x.props),h.ref=Eo(m,R,x),h.return=m,m=h;break e}n(m,R);break}else t(m,R);R=R.sibling}x.type===Vs?(h=Es(x.props.children,m.mode,C,x.key),h.return=m,m=h):(C=xi(x.type,x.key,x.props,null,m.mode,C),C.ref=Eo(m,h,x),C.return=m,m=C)}return l(m);case Xs:e:{for(R=x.key;h!==null;){if(h.key===R)if(h.tag===4&&h.stateNode.containerInfo===x.containerInfo&&h.stateNode.implementation===x.implementation){n(m,h.sibling),h=r(h,x.children||[]),h.return=m,m=h;break e}else{n(m,h);break}else t(m,h);h=h.sibling}h=Bl(x,m.mode,C),h.return=m,m=h}return l(m);case ns:return R=x._init,w(m,h,R(x._payload),C)}if(Bo(x))return v(m,h,x,C);if(jo(x))return k(m,h,x,C);$r(m,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,h!==null&&h.tag===6?(n(m,h.sibling),h=r(h,x),h.return=m,m=h):(n(m,h),h=Gl(x,m.mode,C),h.return=m,m=h),l(m)):n(m,h)}return w}var yo=Ep(!0),Ip=Ep(!1),_i=ks(null),Oi=null,no=null,_c=null;function Oc(){_c=no=Oi=null}function Lc(e){var t=_i.current;dt(_i),e._currentValue=t}function Ba(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function uo(e,t){Oi=e,_c=no=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(qt=!0),e.firstContext=null)}function pn(e){var t=e._currentValue;if(_c!==e)if(e={context:e,memoizedValue:t,next:null},no===null){if(Oi===null)throw Error(Se(308));no=e,Oi.dependencies={lanes:0,firstContext:e}}else no=no.next=e;return t}var Ts=null;function Nc(e){Ts===null?Ts=[e]:Ts.push(e)}function _p(e,t,n,s){var r=t.interleaved;return r===null?(n.next=n,Nc(t)):(n.next=r.next,r.next=n),t.interleaved=n,Kn(e,s)}function Kn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ss=!1;function Dc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Op(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Wn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ds(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,st&2){var r=s.pending;return r===null?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Kn(e,n)}return r=s.interleaved,r===null?(t.next=t,Nc(s)):(t.next=r.next,r.next=t),s.interleaved=t,Kn(e,n)}function ci(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,kc(e,n)}}function Xu(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=l:o=o.next=l,n=n.next}while(n!==null);o===null?r=o=t:o=o.next=t}else r=o=t;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Li(e,t,n,s){var r=e.updateQueue;ss=!1;var o=r.firstBaseUpdate,l=r.lastBaseUpdate,i=r.shared.pending;if(i!==null){r.shared.pending=null;var c=i,u=c.next;c.next=null,l===null?o=u:l.next=u,l=c;var f=e.alternate;f!==null&&(f=f.updateQueue,i=f.lastBaseUpdate,i!==l&&(i===null?f.firstBaseUpdate=u:i.next=u,f.lastBaseUpdate=c))}if(o!==null){var d=r.baseState;l=0,f=u=c=null,i=o;do{var p=i.lane,y=i.eventTime;if((s&p)===p){f!==null&&(f=f.next={eventTime:y,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var v=e,k=i;switch(p=t,y=n,k.tag){case 1:if(v=k.payload,typeof v=="function"){d=v.call(y,d,p);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=k.payload,p=typeof v=="function"?v.call(y,d,p):v,p==null)break e;d=St({},d,p);break e;case 2:ss=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,p=r.effects,p===null?r.effects=[i]:p.push(i))}else y={eventTime:y,lane:p,tag:i.tag,payload:i.payload,callback:i.callback,next:null},f===null?(u=f=y,c=d):f=f.next=y,l|=p;if(i=i.next,i===null){if(i=r.shared.pending,i===null)break;p=i,i=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(f===null&&(c=d),r.baseState=c,r.firstBaseUpdate=u,r.lastBaseUpdate=f,t=r.shared.interleaved,t!==null){r=t;do l|=r.lane,r=r.next;while(r!==t)}else o===null&&(r.shared.lanes=0);Ls|=l,e.lanes=l,e.memoizedState=d}}function Vu(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(Se(191,r));r.call(s)}}}var Rr={},Nn=ks(Rr),hr=ks(Rr),xr=ks(Rr);function Ms(e){if(e===Rr)throw Error(Se(174));return e}function $c(e,t){switch(ut(xr,t),ut(hr,e),ut(Nn,Rr),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ca(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ca(t,e)}dt(Nn),ut(Nn,t)}function mo(){dt(Nn),dt(hr),dt(xr)}function Lp(e){Ms(xr.current);var t=Ms(Nn.current),n=Ca(t,e.type);t!==n&&(ut(hr,e),ut(Nn,n))}function Fc(e){hr.current===e&&(dt(Nn),dt(hr))}var mt=ks(0);function Ni(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ol=[];function Gc(){for(var e=0;e<Ol.length;e++)Ol[e]._workInProgressVersionPrimary=null;Ol.length=0}var ui=Qn.ReactCurrentDispatcher,Ll=Qn.ReactCurrentBatchConfig,Os=0,vt=null,Mt=null,At=null,Di=!1,Zo=!1,yr=0,sx=0;function Gt(){throw Error(Se(321))}function Bc(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!bn(e[n],t[n]))return!1;return!0}function zc(e,t,n,s,r,o){if(Os=o,vt=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ui.current=e===null||e.memoizedState===null?lx:ax,e=n(s,r),Zo){o=0;do{if(Zo=!1,yr=0,25<=o)throw Error(Se(301));o+=1,At=Mt=null,t.updateQueue=null,ui.current=cx,e=n(s,r)}while(Zo)}if(ui.current=$i,t=Mt!==null&&Mt.next!==null,Os=0,At=Mt=vt=null,Di=!1,t)throw Error(Se(300));return e}function Yc(){var e=yr!==0;return yr=0,e}function En(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return At===null?vt.memoizedState=At=e:At=At.next=e,At}function hn(){if(Mt===null){var e=vt.alternate;e=e!==null?e.memoizedState:null}else e=Mt.next;var t=At===null?vt.memoizedState:At.next;if(t!==null)At=t,Mt=e;else{if(e===null)throw Error(Se(310));Mt=e,e={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},At===null?vt.memoizedState=At=e:At=At.next=e}return At}function mr(e,t){return typeof t=="function"?t(e):t}function Nl(e){var t=hn(),n=t.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=e;var s=Mt,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var l=r.next;r.next=o.next,o.next=l}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var i=l=null,c=null,u=o;do{var f=u.lane;if((Os&f)===f)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),s=u.hasEagerState?u.eagerState:e(s,u.action);else{var d={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(i=c=d,l=s):c=c.next=d,vt.lanes|=f,Ls|=f}u=u.next}while(u!==null&&u!==o);c===null?l=s:c.next=i,bn(s,t.memoizedState)||(qt=!0),t.memoizedState=s,t.baseState=l,t.baseQueue=c,n.lastRenderedState=s}if(e=n.interleaved,e!==null){r=e;do o=r.lane,vt.lanes|=o,Ls|=o,r=r.next;while(r!==e)}else r===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Dl(e){var t=hn(),n=t.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,o=t.memoizedState;if(r!==null){n.pending=null;var l=r=r.next;do o=e(o,l.action),l=l.next;while(l!==r);bn(o,t.memoizedState)||(qt=!0),t.memoizedState=o,t.baseQueue===null&&(t.baseState=o),n.lastRenderedState=o}return[o,s]}function Np(){}function Dp(e,t){var n=vt,s=hn(),r=t(),o=!bn(s.memoizedState,r);if(o&&(s.memoizedState=r,qt=!0),s=s.queue,Hc(Gp.bind(null,n,s,e),[e]),s.getSnapshot!==t||o||At!==null&&At.memoizedState.tag&1){if(n.flags|=2048,gr(9,Fp.bind(null,n,s,r,t),void 0,null),It===null)throw Error(Se(349));Os&30||$p(n,t,r)}return r}function $p(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function Fp(e,t,n,s){t.value=n,t.getSnapshot=s,Bp(t)&&zp(e)}function Gp(e,t,n){return n(function(){Bp(t)&&zp(e)})}function Bp(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!bn(e,n)}catch{return!0}}function zp(e){var t=Kn(e,1);t!==null&&Mn(t,e,1,-1)}function qu(e){var t=En();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mr,lastRenderedState:e},t.queue=e,e=e.dispatch=ix.bind(null,vt,e),[t.memoizedState,e]}function gr(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=vt.updateQueue,t===null?(t={lastEffect:null,stores:null},vt.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function Yp(){return hn().memoizedState}function fi(e,t,n,s){var r=En();vt.flags|=e,r.memoizedState=gr(1|t,n,void 0,s===void 0?null:s)}function ol(e,t,n,s){var r=hn();s=s===void 0?null:s;var o=void 0;if(Mt!==null){var l=Mt.memoizedState;if(o=l.destroy,s!==null&&Bc(s,l.deps)){r.memoizedState=gr(t,n,o,s);return}}vt.flags|=e,r.memoizedState=gr(1|t,n,o,s)}function Ku(e,t){return fi(8390656,8,e,t)}function Hc(e,t){return ol(2048,8,e,t)}function Hp(e,t){return ol(4,2,e,t)}function Up(e,t){return ol(4,4,e,t)}function Wp(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Xp(e,t,n){return n=n!=null?n.concat([e]):null,ol(4,4,Wp.bind(null,t,e),n)}function Uc(){}function Vp(e,t){var n=hn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&Bc(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function qp(e,t){var n=hn();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&Bc(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Kp(e,t,n){return Os&21?(bn(n,t)||(n=tp(),vt.lanes|=n,Ls|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,qt=!0),e.memoizedState=n)}function ox(e,t){var n=lt;lt=n!==0&&4>n?n:4,e(!0);var s=Ll.transition;Ll.transition={};try{e(!1),t()}finally{lt=n,Ll.transition=s}}function Zp(){return hn().memoizedState}function rx(e,t,n){var s=hs(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Qp(e))Jp(t,n);else if(n=_p(e,t,n,s),n!==null){var r=Ut();Mn(n,e,s,r),e0(n,t,s)}}function ix(e,t,n){var s=hs(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qp(e))Jp(t,r);else{var o=e.alternate;if(e.lanes===0&&(o===null||o.lanes===0)&&(o=t.lastRenderedReducer,o!==null))try{var l=t.lastRenderedState,i=o(l,n);if(r.hasEagerState=!0,r.eagerState=i,bn(i,l)){var c=t.interleaved;c===null?(r.next=r,Nc(t)):(r.next=c.next,c.next=r),t.interleaved=r;return}}catch{}finally{}n=_p(e,t,r,s),n!==null&&(r=Ut(),Mn(n,e,s,r),e0(n,t,s))}}function Qp(e){var t=e.alternate;return e===vt||t!==null&&t===vt}function Jp(e,t){Zo=Di=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function e0(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,kc(e,n)}}var $i={readContext:pn,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useInsertionEffect:Gt,useLayoutEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useMutableSource:Gt,useSyncExternalStore:Gt,useId:Gt,unstable_isNewReconciler:!1},lx={readContext:pn,useCallback:function(e,t){return En().memoizedState=[e,t===void 0?null:t],e},useContext:pn,useEffect:Ku,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,fi(4194308,4,Wp.bind(null,t,e),n)},useLayoutEffect:function(e,t){return fi(4194308,4,e,t)},useInsertionEffect:function(e,t){return fi(4,2,e,t)},useMemo:function(e,t){var n=En();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=En();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=rx.bind(null,vt,e),[s.memoizedState,e]},useRef:function(e){var t=En();return e={current:e},t.memoizedState=e},useState:qu,useDebugValue:Uc,useDeferredValue:function(e){return En().memoizedState=e},useTransition:function(){var e=qu(!1),t=e[0];return e=ox.bind(null,e[1]),En().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=vt,r=En();if(pt){if(n===void 0)throw Error(Se(407));n=n()}else{if(n=t(),It===null)throw Error(Se(349));Os&30||$p(s,t,n)}r.memoizedState=n;var o={value:n,getSnapshot:t};return r.queue=o,Ku(Gp.bind(null,s,o,e),[e]),s.flags|=2048,gr(9,Fp.bind(null,s,o,n,t),void 0,null),n},useId:function(){var e=En(),t=It.identifierPrefix;if(pt){var n=Yn,s=zn;n=(s&~(1<<32-Tn(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=yr++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=sx++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ax={readContext:pn,useCallback:Vp,useContext:pn,useEffect:Hc,useImperativeHandle:Xp,useInsertionEffect:Hp,useLayoutEffect:Up,useMemo:qp,useReducer:Nl,useRef:Yp,useState:function(){return Nl(mr)},useDebugValue:Uc,useDeferredValue:function(e){var t=hn();return Kp(t,Mt.memoizedState,e)},useTransition:function(){var e=Nl(mr)[0],t=hn().memoizedState;return[e,t]},useMutableSource:Np,useSyncExternalStore:Dp,useId:Zp,unstable_isNewReconciler:!1},cx={readContext:pn,useCallback:Vp,useContext:pn,useEffect:Hc,useImperativeHandle:Xp,useInsertionEffect:Hp,useLayoutEffect:Up,useMemo:qp,useReducer:Dl,useRef:Yp,useState:function(){return Dl(mr)},useDebugValue:Uc,useDeferredValue:function(e){var t=hn();return Mt===null?t.memoizedState=e:Kp(t,Mt.memoizedState,e)},useTransition:function(){var e=Dl(mr)[0],t=hn().memoizedState;return[e,t]},useMutableSource:Np,useSyncExternalStore:Dp,useId:Zp,unstable_isNewReconciler:!1};function mn(e,t){if(e&&e.defaultProps){t=St({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function za(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:St({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var rl={isMounted:function(e){return(e=e._reactInternals)?$s(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Ut(),r=hs(e),o=Wn(s,r);o.payload=t,n!=null&&(o.callback=n),t=ds(e,o,r),t!==null&&(Mn(t,e,r,s),ci(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Ut(),r=hs(e),o=Wn(s,r);o.tag=1,o.payload=t,n!=null&&(o.callback=n),t=ds(e,o,r),t!==null&&(Mn(t,e,r,s),ci(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ut(),s=hs(e),r=Wn(n,s);r.tag=2,t!=null&&(r.callback=t),t=ds(e,r,s),t!==null&&(Mn(t,e,s,n),ci(t,e,s))}};function Zu(e,t,n,s,r,o,l){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,o,l):t.prototype&&t.prototype.isPureReactComponent?!ur(n,s)||!ur(r,o):!0}function t0(e,t,n){var s=!1,r=gs,o=t.contextType;return typeof o=="object"&&o!==null?o=pn(o):(r=Zt(t)?Is:Yt.current,s=t.contextTypes,o=(s=s!=null)?ho(e,r):gs),t=new t(n,o),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=rl,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=o),t}function Qu(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&rl.enqueueReplaceState(t,t.state,null)}function Ya(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},Dc(e);var o=t.contextType;typeof o=="object"&&o!==null?r.context=pn(o):(o=Zt(t)?Is:Yt.current,r.context=ho(e,o)),r.state=e.memoizedState,o=t.getDerivedStateFromProps,typeof o=="function"&&(za(e,t,o,n),r.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(t=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),t!==r.state&&rl.enqueueReplaceState(r,r.state,null),Li(e,n,r,s),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308)}function go(e,t){try{var n="",s=t;do n+=Dh(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:e,source:t,stack:r,digest:null}}function $l(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function Ha(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ux=typeof WeakMap=="function"?WeakMap:Map;function n0(e,t,n){n=Wn(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){Gi||(Gi=!0,ec=s),Ha(e,t)},n}function s0(e,t,n){n=Wn(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){Ha(e,t)}}var o=e.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){Ha(e,t),typeof s!="function"&&(ps===null?ps=new Set([this]):ps.add(this));var l=t.stack;this.componentDidCatch(t.value,{componentStack:l!==null?l:""})}),n}function Ju(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new ux;var r=new Set;s.set(t,r)}else r=s.get(t),r===void 0&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=Px.bind(null,e,t,n),t.then(e,e))}function ef(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function tf(e,t,n,s,r){return e.mode&1?(e.flags|=65536,e.lanes=r,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Wn(-1,1),t.tag=2,ds(n,t,1))),n.lanes|=1),e)}var fx=Qn.ReactCurrentOwner,qt=!1;function Ht(e,t,n,s){t.child=e===null?Ip(t,null,n,s):yo(t,e.child,n,s)}function nf(e,t,n,s,r){n=n.render;var o=t.ref;return uo(t,r),s=zc(e,t,n,s,o,r),n=Yc(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Zn(e,t,r)):(pt&&n&&Ac(t),t.flags|=1,Ht(e,t,s,r),t.child)}function sf(e,t,n,s,r){if(e===null){var o=n.type;return typeof o=="function"&&!Jc(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=o,o0(e,t,o,s,r)):(e=xi(n.type,null,s,t,t.mode,r),e.ref=t.ref,e.return=t,t.child=e)}if(o=e.child,!(e.lanes&r)){var l=o.memoizedProps;if(n=n.compare,n=n!==null?n:ur,n(l,s)&&e.ref===t.ref)return Zn(e,t,r)}return t.flags|=1,e=xs(o,s),e.ref=t.ref,e.return=t,t.child=e}function o0(e,t,n,s,r){if(e!==null){var o=e.memoizedProps;if(ur(o,s)&&e.ref===t.ref)if(qt=!1,t.pendingProps=s=o,(e.lanes&r)!==0)e.flags&131072&&(qt=!0);else return t.lanes=e.lanes,Zn(e,t,r)}return Ua(e,t,n,s,r)}function r0(e,t,n){var s=t.pendingProps,r=s.children,o=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ut(oo,en),en|=n;else{if(!(n&1073741824))return e=o!==null?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ut(oo,en),en|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,ut(oo,en),en|=s}else o!==null?(s=o.baseLanes|n,t.memoizedState=null):s=n,ut(oo,en),en|=s;return Ht(e,t,r,n),t.child}function i0(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ua(e,t,n,s,r){var o=Zt(n)?Is:Yt.current;return o=ho(t,o),uo(t,r),n=zc(e,t,n,s,o,r),s=Yc(),e!==null&&!qt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Zn(e,t,r)):(pt&&s&&Ac(t),t.flags|=1,Ht(e,t,n,r),t.child)}function of(e,t,n,s,r){if(Zt(n)){var o=!0;Ai(t)}else o=!1;if(uo(t,r),t.stateNode===null)di(e,t),t0(t,n,s),Ya(t,n,s,r),s=!0;else if(e===null){var l=t.stateNode,i=t.memoizedProps;l.props=i;var c=l.context,u=n.contextType;typeof u=="object"&&u!==null?u=pn(u):(u=Zt(n)?Is:Yt.current,u=ho(t,u));var f=n.getDerivedStateFromProps,d=typeof f=="function"||typeof l.getSnapshotBeforeUpdate=="function";d||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(i!==s||c!==u)&&Qu(t,l,s,u),ss=!1;var p=t.memoizedState;l.state=p,Li(t,s,l,r),c=t.memoizedState,i!==s||p!==c||Kt.current||ss?(typeof f=="function"&&(za(t,n,f,s),c=t.memoizedState),(i=ss||Zu(t,n,i,s,p,c,u))?(d||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(t.flags|=4194308)):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=c),l.props=s,l.state=c,l.context=u,s=i):(typeof l.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{l=t.stateNode,Op(e,t),i=t.memoizedProps,u=t.type===t.elementType?i:mn(t.type,i),l.props=u,d=t.pendingProps,p=l.context,c=n.contextType,typeof c=="object"&&c!==null?c=pn(c):(c=Zt(n)?Is:Yt.current,c=ho(t,c));var y=n.getDerivedStateFromProps;(f=typeof y=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(i!==d||p!==c)&&Qu(t,l,s,c),ss=!1,p=t.memoizedState,l.state=p,Li(t,s,l,r);var v=t.memoizedState;i!==d||p!==v||Kt.current||ss?(typeof y=="function"&&(za(t,n,y,s),v=t.memoizedState),(u=ss||Zu(t,n,u,s,p,v,c)||!1)?(f||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(s,v,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(s,v,c)),typeof l.componentDidUpdate=="function"&&(t.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof l.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=v),l.props=s,l.state=v,l.context=c,s=u):(typeof l.componentDidUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&p===e.memoizedState||(t.flags|=1024),s=!1)}return Wa(e,t,n,s,o,r)}function Wa(e,t,n,s,r,o){i0(e,t);var l=(t.flags&128)!==0;if(!s&&!l)return r&&Yu(t,n,!1),Zn(e,t,o);s=t.stateNode,fx.current=t;var i=l&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&l?(t.child=yo(t,e.child,null,o),t.child=yo(t,null,i,o)):Ht(e,t,i,o),t.memoizedState=s.state,r&&Yu(t,n,!0),t.child}function l0(e){var t=e.stateNode;t.pendingContext?zu(e,t.pendingContext,t.pendingContext!==t.context):t.context&&zu(e,t.context,!1),$c(e,t.containerInfo)}function rf(e,t,n,s,r){return xo(),Ic(r),t.flags|=256,Ht(e,t,n,s),t.child}var Xa={dehydrated:null,treeContext:null,retryLane:0};function Va(e){return{baseLanes:e,cachePool:null,transitions:null}}function a0(e,t,n){var s=t.pendingProps,r=mt.current,o=!1,l=(t.flags&128)!==0,i;if((i=l)||(i=e!==null&&e.memoizedState===null?!1:(r&2)!==0),i?(o=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(r|=1),ut(mt,r&1),e===null)return Ga(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(l=s.children,e=s.fallback,o?(s=t.mode,o=t.child,l={mode:"hidden",children:l},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=l):o=al(l,s,0,null),e=Es(e,s,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Va(n),t.memoizedState=Xa,e):Wc(t,l));if(r=e.memoizedState,r!==null&&(i=r.dehydrated,i!==null))return dx(e,t,l,s,i,r,n);if(o){o=s.fallback,l=t.mode,r=e.child,i=r.sibling;var c={mode:"hidden",children:s.children};return!(l&1)&&t.child!==r?(s=t.child,s.childLanes=0,s.pendingProps=c,t.deletions=null):(s=xs(r,c),s.subtreeFlags=r.subtreeFlags&14680064),i!==null?o=xs(i,o):(o=Es(o,l,n,null),o.flags|=2),o.return=t,s.return=t,s.sibling=o,t.child=s,s=o,o=t.child,l=e.child.memoizedState,l=l===null?Va(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Xa,s}return o=e.child,e=o.sibling,s=xs(o,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Wc(e,t){return t=al({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Fr(e,t,n,s){return s!==null&&Ic(s),yo(t,e.child,null,n),e=Wc(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function dx(e,t,n,s,r,o,l){if(n)return t.flags&256?(t.flags&=-257,s=$l(Error(Se(422))),Fr(e,t,l,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(o=s.fallback,r=t.mode,s=al({mode:"visible",children:s.children},r,0,null),o=Es(o,r,l,null),o.flags|=2,s.return=t,o.return=t,s.sibling=o,t.child=s,t.mode&1&&yo(t,e.child,null,l),t.child.memoizedState=Va(l),t.memoizedState=Xa,o);if(!(t.mode&1))return Fr(e,t,l,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var i=s.dgst;return s=i,o=Error(Se(419)),s=$l(o,s,void 0),Fr(e,t,l,s)}if(i=(l&e.childLanes)!==0,qt||i){if(s=It,s!==null){switch(l&-l){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|l)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Kn(e,r),Mn(s,e,r,-1))}return Qc(),s=$l(Error(Se(421))),Fr(e,t,l,s)}return r.data==="$?"?(t.flags|=128,t.child=e.child,t=Rx.bind(null,e),r._reactRetry=t,null):(e=o.treeContext,nn=fs(r.nextSibling),sn=t,pt=!0,vn=null,e!==null&&(cn[un++]=zn,cn[un++]=Yn,cn[un++]=_s,zn=e.id,Yn=e.overflow,_s=t),t=Wc(t,s.children),t.flags|=4096,t)}function lf(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),Ba(e.return,t,n)}function Fl(e,t,n,s,r){var o=e.memoizedState;o===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function c0(e,t,n){var s=t.pendingProps,r=s.revealOrder,o=s.tail;if(Ht(e,t,s.children,n),s=mt.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&lf(e,n,t);else if(e.tag===19)lf(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(ut(mt,s),!(t.mode&1))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;n!==null;)e=n.alternate,e!==null&&Ni(e)===null&&(r=n),n=n.sibling;n=r,n===null?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Fl(t,!1,r,n,o);break;case"backwards":for(n=null,r=t.child,t.child=null;r!==null;){if(e=r.alternate,e!==null&&Ni(e)===null){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Fl(t,!0,n,null,o);break;case"together":Fl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function di(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Zn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Ls|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Se(153));if(t.child!==null){for(e=t.child,n=xs(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=xs(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function px(e,t,n){switch(t.tag){case 3:l0(t),xo();break;case 5:Lp(t);break;case 1:Zt(t.type)&&Ai(t);break;case 4:$c(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;ut(_i,s._currentValue),s._currentValue=r;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(ut(mt,mt.current&1),t.flags|=128,null):n&t.child.childLanes?a0(e,t,n):(ut(mt,mt.current&1),e=Zn(e,t,n),e!==null?e.sibling:null);ut(mt,mt.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return c0(e,t,n);t.flags|=128}if(r=t.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ut(mt,mt.current),s)break;return null;case 22:case 23:return t.lanes=0,r0(e,t,n)}return Zn(e,t,n)}var u0,qa,f0,d0;u0=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};qa=function(){};f0=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Ms(Nn.current);var o=null;switch(n){case"input":r=ma(e,r),s=ma(e,s),o=[];break;case"select":r=St({},r,{value:void 0}),s=St({},s,{value:void 0}),o=[];break;case"textarea":r=Sa(e,r),s=Sa(e,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=Mi)}ka(n,s);var l;n=null;for(u in r)if(!s.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var i=r[u];for(l in i)i.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(sr.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in s){var c=s[u];if(i=r!=null?r[u]:void 0,s.hasOwnProperty(u)&&c!==i&&(c!=null||i!=null))if(u==="style")if(i){for(l in i)!i.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in c)c.hasOwnProperty(l)&&i[l]!==c[l]&&(n||(n={}),n[l]=c[l])}else n||(o||(o=[]),o.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,i=i?i.__html:void 0,c!=null&&i!==c&&(o=o||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(sr.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&ft("scroll",e),o||i===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}};d0=function(e,t,n,s){n!==s&&(t.flags|=4)};function Io(e,t){if(!pt)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Bt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=e,r=r.sibling;else for(r=e.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function hx(e,t,n){var s=t.pendingProps;switch(Ec(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bt(t),null;case 1:return Zt(t.type)&&bi(),Bt(t),null;case 3:return s=t.stateNode,mo(),dt(Kt),dt(Yt),Gc(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Dr(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,vn!==null&&(sc(vn),vn=null))),qa(e,t),Bt(t),null;case 5:Fc(t);var r=Ms(xr.current);if(n=t.type,e!==null&&t.stateNode!=null)f0(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(Se(166));return Bt(t),null}if(e=Ms(Nn.current),Dr(t)){s=t.stateNode,n=t.type;var o=t.memoizedProps;switch(s[On]=t,s[pr]=o,e=(t.mode&1)!==0,n){case"dialog":ft("cancel",s),ft("close",s);break;case"iframe":case"object":case"embed":ft("load",s);break;case"video":case"audio":for(r=0;r<Yo.length;r++)ft(Yo[r],s);break;case"source":ft("error",s);break;case"img":case"image":case"link":ft("error",s),ft("load",s);break;case"details":ft("toggle",s);break;case"input":xu(s,o),ft("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},ft("invalid",s);break;case"textarea":mu(s,o),ft("invalid",s)}ka(n,o),r=null;for(var l in o)if(o.hasOwnProperty(l)){var i=o[l];l==="children"?typeof i=="string"?s.textContent!==i&&(o.suppressHydrationWarning!==!0&&Nr(s.textContent,i,e),r=["children",i]):typeof i=="number"&&s.textContent!==""+i&&(o.suppressHydrationWarning!==!0&&Nr(s.textContent,i,e),r=["children",""+i]):sr.hasOwnProperty(l)&&i!=null&&l==="onScroll"&&ft("scroll",s)}switch(n){case"input":Mr(s),yu(s,o,!0);break;case"textarea":Mr(s),gu(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=Mi)}s=r,t.updateQueue=s,s!==null&&(t.flags|=4)}else{l=r.nodeType===9?r:r.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Gd(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=l.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=l.createElement(n,{is:s.is}):(e=l.createElement(n),n==="select"&&(l=e,s.multiple?l.multiple=!0:s.size&&(l.size=s.size))):e=l.createElementNS(e,n),e[On]=t,e[pr]=s,u0(e,t,!1,!1),t.stateNode=e;e:{switch(l=wa(n,s),n){case"dialog":ft("cancel",e),ft("close",e),r=s;break;case"iframe":case"object":case"embed":ft("load",e),r=s;break;case"video":case"audio":for(r=0;r<Yo.length;r++)ft(Yo[r],e);r=s;break;case"source":ft("error",e),r=s;break;case"img":case"image":case"link":ft("error",e),ft("load",e),r=s;break;case"details":ft("toggle",e),r=s;break;case"input":xu(e,s),r=ma(e,s),ft("invalid",e);break;case"option":r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=St({},s,{value:void 0}),ft("invalid",e);break;case"textarea":mu(e,s),r=Sa(e,s),ft("invalid",e);break;default:r=s}ka(n,r),i=r;for(o in i)if(i.hasOwnProperty(o)){var c=i[o];o==="style"?Yd(e,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Bd(e,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&or(e,c):typeof c=="number"&&or(e,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(sr.hasOwnProperty(o)?c!=null&&o==="onScroll"&&ft("scroll",e):c!=null&&yc(e,o,c,l))}switch(n){case"input":Mr(e),yu(e,s,!1);break;case"textarea":Mr(e),gu(e);break;case"option":s.value!=null&&e.setAttribute("value",""+ms(s.value));break;case"select":e.multiple=!!s.multiple,o=s.value,o!=null?io(e,!!s.multiple,o,!1):s.defaultValue!=null&&io(e,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(e.onclick=Mi)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Bt(t),null;case 6:if(e&&t.stateNode!=null)d0(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(Se(166));if(n=Ms(xr.current),Ms(Nn.current),Dr(t)){if(s=t.stateNode,n=t.memoizedProps,s[On]=t,(o=s.nodeValue!==n)&&(e=sn,e!==null))switch(e.tag){case 3:Nr(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Nr(s.nodeValue,n,(e.mode&1)!==0)}o&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[On]=t,t.stateNode=s}return Bt(t),null;case 13:if(dt(mt),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(pt&&nn!==null&&t.mode&1&&!(t.flags&128))Ap(),xo(),t.flags|=98560,o=!1;else if(o=Dr(t),s!==null&&s.dehydrated!==null){if(e===null){if(!o)throw Error(Se(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Se(317));o[On]=t}else xo(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Bt(t),o=!1}else vn!==null&&(sc(vn),vn=null),o=!0;if(!o)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||mt.current&1?bt===0&&(bt=3):Qc())),t.updateQueue!==null&&(t.flags|=4),Bt(t),null);case 4:return mo(),qa(e,t),e===null&&fr(t.stateNode.containerInfo),Bt(t),null;case 10:return Lc(t.type._context),Bt(t),null;case 17:return Zt(t.type)&&bi(),Bt(t),null;case 19:if(dt(mt),o=t.memoizedState,o===null)return Bt(t),null;if(s=(t.flags&128)!==0,l=o.rendering,l===null)if(s)Io(o,!1);else{if(bt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(l=Ni(e),l!==null){for(t.flags|=128,Io(o,!1),s=l.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)o=n,e=s,o.flags&=14680066,l=o.alternate,l===null?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ut(mt,mt.current&1|2),t.child}e=e.sibling}o.tail!==null&&wt()>vo&&(t.flags|=128,s=!0,Io(o,!1),t.lanes=4194304)}else{if(!s)if(e=Ni(l),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Io(o,!0),o.tail===null&&o.tailMode==="hidden"&&!l.alternate&&!pt)return Bt(t),null}else 2*wt()-o.renderingStartTime>vo&&n!==1073741824&&(t.flags|=128,s=!0,Io(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(n=o.last,n!==null?n.sibling=l:t.child=l,o.last=l)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=wt(),t.sibling=null,n=mt.current,ut(mt,s?n&1|2:n&1),t):(Bt(t),null);case 22:case 23:return Zc(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?en&1073741824&&(Bt(t),t.subtreeFlags&6&&(t.flags|=8192)):Bt(t),null;case 24:return null;case 25:return null}throw Error(Se(156,t.tag))}function xx(e,t){switch(Ec(t),t.tag){case 1:return Zt(t.type)&&bi(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return mo(),dt(Kt),dt(Yt),Gc(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Fc(t),null;case 13:if(dt(mt),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Se(340));xo()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return dt(mt),null;case 4:return mo(),null;case 10:return Lc(t.type._context),null;case 22:case 23:return Zc(),null;case 24:return null;default:return null}}var Gr=!1,zt=!1,yx=typeof WeakSet=="function"?WeakSet:Set,Ee=null;function so(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){kt(e,t,s)}else n.current=null}function Ka(e,t,n){try{n()}catch(s){kt(e,t,s)}}var af=!1;function mx(e,t){if(_a=Ri,e=mp(),bc(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var l=0,i=-1,c=-1,u=0,f=0,d=e,p=null;t:for(;;){for(var y;d!==n||r!==0&&d.nodeType!==3||(i=l+r),d!==o||s!==0&&d.nodeType!==3||(c=l+s),d.nodeType===3&&(l+=d.nodeValue.length),(y=d.firstChild)!==null;)p=d,d=y;for(;;){if(d===e)break t;if(p===n&&++u===r&&(i=l),p===o&&++f===s&&(c=l),(y=d.nextSibling)!==null)break;d=p,p=d.parentNode}d=y}n=i===-1||c===-1?null:{start:i,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Oa={focusedElem:e,selectionRange:n},Ri=!1,Ee=t;Ee!==null;)if(t=Ee,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ee=e;else for(;Ee!==null;){t=Ee;try{var v=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var k=v.memoizedProps,w=v.memoizedState,m=t.stateNode,h=m.getSnapshotBeforeUpdate(t.elementType===t.type?k:mn(t.type,k),w);m.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var x=t.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(C){kt(t,t.return,C)}if(e=t.sibling,e!==null){e.return=t.return,Ee=e;break}Ee=t.return}return v=af,af=!1,v}function Qo(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&e)===e){var o=r.destroy;r.destroy=void 0,o!==void 0&&Ka(t,n,o)}r=r.next}while(r!==s)}}function il(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Za(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function p0(e){var t=e.alternate;t!==null&&(e.alternate=null,p0(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[On],delete t[pr],delete t[Da],delete t[J1],delete t[ex])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function h0(e){return e.tag===5||e.tag===3||e.tag===4}function cf(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||h0(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Qa(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Mi));else if(s!==4&&(e=e.child,e!==null))for(Qa(e,t,n),e=e.sibling;e!==null;)Qa(e,t,n),e=e.sibling}function Ja(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(Ja(e,t,n),e=e.sibling;e!==null;)Ja(e,t,n),e=e.sibling}var Lt=null,gn=!1;function es(e,t,n){for(n=n.child;n!==null;)x0(e,t,n),n=n.sibling}function x0(e,t,n){if(Ln&&typeof Ln.onCommitFiberUnmount=="function")try{Ln.onCommitFiberUnmount(Qi,n)}catch{}switch(n.tag){case 5:zt||so(n,t);case 6:var s=Lt,r=gn;Lt=null,es(e,t,n),Lt=s,gn=r,Lt!==null&&(gn?(e=Lt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Lt.removeChild(n.stateNode));break;case 18:Lt!==null&&(gn?(e=Lt,n=n.stateNode,e.nodeType===8?Il(e.parentNode,n):e.nodeType===1&&Il(e,n),ar(e)):Il(Lt,n.stateNode));break;case 4:s=Lt,r=gn,Lt=n.stateNode.containerInfo,gn=!0,es(e,t,n),Lt=s,gn=r;break;case 0:case 11:case 14:case 15:if(!zt&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,l=o.destroy;o=o.tag,l!==void 0&&(o&2||o&4)&&Ka(n,t,l),r=r.next}while(r!==s)}es(e,t,n);break;case 1:if(!zt&&(so(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(i){kt(n,t,i)}es(e,t,n);break;case 21:es(e,t,n);break;case 22:n.mode&1?(zt=(s=zt)||n.memoizedState!==null,es(e,t,n),zt=s):es(e,t,n);break;default:es(e,t,n)}}function uf(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new yx),t.forEach(function(s){var r=jx.bind(null,e,s);n.has(s)||(n.add(s),s.then(r,r))})}}function yn(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=e,l=t,i=l;e:for(;i!==null;){switch(i.tag){case 5:Lt=i.stateNode,gn=!1;break e;case 3:Lt=i.stateNode.containerInfo,gn=!0;break e;case 4:Lt=i.stateNode.containerInfo,gn=!0;break e}i=i.return}if(Lt===null)throw Error(Se(160));x0(o,l,r),Lt=null,gn=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(u){kt(r,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)y0(t,e),t=t.sibling}function y0(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(yn(t,e),An(e),s&4){try{Qo(3,e,e.return),il(3,e)}catch(k){kt(e,e.return,k)}try{Qo(5,e,e.return)}catch(k){kt(e,e.return,k)}}break;case 1:yn(t,e),An(e),s&512&&n!==null&&so(n,n.return);break;case 5:if(yn(t,e),An(e),s&512&&n!==null&&so(n,n.return),e.flags&32){var r=e.stateNode;try{or(r,"")}catch(k){kt(e,e.return,k)}}if(s&4&&(r=e.stateNode,r!=null)){var o=e.memoizedProps,l=n!==null?n.memoizedProps:o,i=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{i==="input"&&o.type==="radio"&&o.name!=null&&$d(r,o),wa(i,l);var u=wa(i,o);for(l=0;l<c.length;l+=2){var f=c[l],d=c[l+1];f==="style"?Yd(r,d):f==="dangerouslySetInnerHTML"?Bd(r,d):f==="children"?or(r,d):yc(r,f,d,u)}switch(i){case"input":ga(r,o);break;case"textarea":Fd(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var y=o.value;y!=null?io(r,!!o.multiple,y,!1):p!==!!o.multiple&&(o.defaultValue!=null?io(r,!!o.multiple,o.defaultValue,!0):io(r,!!o.multiple,o.multiple?[]:"",!1))}r[pr]=o}catch(k){kt(e,e.return,k)}}break;case 6:if(yn(t,e),An(e),s&4){if(e.stateNode===null)throw Error(Se(162));r=e.stateNode,o=e.memoizedProps;try{r.nodeValue=o}catch(k){kt(e,e.return,k)}}break;case 3:if(yn(t,e),An(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{ar(t.containerInfo)}catch(k){kt(e,e.return,k)}break;case 4:yn(t,e),An(e);break;case 13:yn(t,e),An(e),r=e.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(qc=wt())),s&4&&uf(e);break;case 22:if(f=n!==null&&n.memoizedState!==null,e.mode&1?(zt=(u=zt)||f,yn(t,e),zt=u):yn(t,e),An(e),s&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!f&&e.mode&1)for(Ee=e,f=e.child;f!==null;){for(d=Ee=f;Ee!==null;){switch(p=Ee,y=p.child,p.tag){case 0:case 11:case 14:case 15:Qo(4,p,p.return);break;case 1:so(p,p.return);var v=p.stateNode;if(typeof v.componentWillUnmount=="function"){s=p,n=p.return;try{t=s,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(k){kt(s,n,k)}}break;case 5:so(p,p.return);break;case 22:if(p.memoizedState!==null){df(d);continue}}y!==null?(y.return=p,Ee=y):df(d)}f=f.sibling}e:for(f=null,d=e;;){if(d.tag===5){if(f===null){f=d;try{r=d.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(i=d.stateNode,c=d.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,i.style.display=zd("display",l))}catch(k){kt(e,e.return,k)}}}else if(d.tag===6){if(f===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(k){kt(e,e.return,k)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===e)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;d.sibling===null;){if(d.return===null||d.return===e)break e;f===d&&(f=null),d=d.return}f===d&&(f=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:yn(t,e),An(e),s&4&&uf(e);break;case 21:break;default:yn(t,e),An(e)}}function An(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(h0(n)){var s=n;break e}n=n.return}throw Error(Se(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(or(r,""),s.flags&=-33);var o=cf(e);Ja(e,o,r);break;case 3:case 4:var l=s.stateNode.containerInfo,i=cf(e);Qa(e,i,l);break;default:throw Error(Se(161))}}catch(c){kt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function gx(e,t,n){Ee=e,m0(e)}function m0(e,t,n){for(var s=(e.mode&1)!==0;Ee!==null;){var r=Ee,o=r.child;if(r.tag===22&&s){var l=r.memoizedState!==null||Gr;if(!l){var i=r.alternate,c=i!==null&&i.memoizedState!==null||zt;i=Gr;var u=zt;if(Gr=l,(zt=c)&&!u)for(Ee=r;Ee!==null;)l=Ee,c=l.child,l.tag===22&&l.memoizedState!==null?pf(r):c!==null?(c.return=l,Ee=c):pf(r);for(;o!==null;)Ee=o,m0(o),o=o.sibling;Ee=r,Gr=i,zt=u}ff(e)}else r.subtreeFlags&8772&&o!==null?(o.return=r,Ee=o):ff(e)}}function ff(e){for(;Ee!==null;){var t=Ee;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:zt||il(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!zt)if(n===null)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:mn(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;o!==null&&Vu(t,o,s);break;case 3:var l=t.updateQueue;if(l!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Vu(t,l,n)}break;case 5:var i=t.stateNode;if(n===null&&t.flags&4){n=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var d=f.dehydrated;d!==null&&ar(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}zt||t.flags&512&&Za(t)}catch(p){kt(t,t.return,p)}}if(t===e){Ee=null;break}if(n=t.sibling,n!==null){n.return=t.return,Ee=n;break}Ee=t.return}}function df(e){for(;Ee!==null;){var t=Ee;if(t===e){Ee=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Ee=n;break}Ee=t.return}}function pf(e){for(;Ee!==null;){var t=Ee;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(c){kt(t,n,c)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var r=t.return;try{s.componentDidMount()}catch(c){kt(t,r,c)}}var o=t.return;try{Za(t)}catch(c){kt(t,o,c)}break;case 5:var l=t.return;try{Za(t)}catch(c){kt(t,l,c)}}}catch(c){kt(t,t.return,c)}if(t===e){Ee=null;break}var i=t.sibling;if(i!==null){i.return=t.return,Ee=i;break}Ee=t.return}}var vx=Math.ceil,Fi=Qn.ReactCurrentDispatcher,Xc=Qn.ReactCurrentOwner,dn=Qn.ReactCurrentBatchConfig,st=0,It=null,jt=null,Nt=0,en=0,oo=ks(0),bt=0,vr=null,Ls=0,ll=0,Vc=0,Jo=null,Vt=null,qc=0,vo=1/0,Fn=null,Gi=!1,ec=null,ps=null,Br=!1,ls=null,Bi=0,er=0,tc=null,pi=-1,hi=0;function Ut(){return st&6?wt():pi!==-1?pi:pi=wt()}function hs(e){return e.mode&1?st&2&&Nt!==0?Nt&-Nt:nx.transition!==null?(hi===0&&(hi=tp()),hi):(e=lt,e!==0||(e=window.event,e=e===void 0?16:ap(e.type)),e):1}function Mn(e,t,n,s){if(50<er)throw er=0,tc=null,Error(Se(185));kr(e,n,s),(!(st&2)||e!==It)&&(e===It&&(!(st&2)&&(ll|=n),bt===4&&rs(e,Nt)),Qt(e,s),n===1&&st===0&&!(t.mode&1)&&(vo=wt()+500,sl&&ws()))}function Qt(e,t){var n=e.callbackNode;n1(e,t);var s=Pi(e,e===It?Nt:0);if(s===0)n!==null&&Cu(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&Cu(n),t===1)e.tag===0?tx(hf.bind(null,e)):Tp(hf.bind(null,e)),Z1(function(){!(st&6)&&ws()}),n=null;else{switch(np(s)){case 1:n=Cc;break;case 4:n=Jd;break;case 16:n=wi;break;case 536870912:n=ep;break;default:n=wi}n=R0(n,g0.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function g0(e,t){if(pi=-1,hi=0,st&6)throw Error(Se(327));var n=e.callbackNode;if(fo()&&e.callbackNode!==n)return null;var s=Pi(e,e===It?Nt:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=zi(e,s);else{t=s;var r=st;st|=2;var o=S0();(It!==e||Nt!==t)&&(Fn=null,vo=wt()+500,As(e,t));do try{kx();break}catch(i){v0(e,i)}while(1);Oc(),Fi.current=o,st=r,jt!==null?t=0:(It=null,Nt=0,t=bt)}if(t!==0){if(t===2&&(r=Ma(e),r!==0&&(s=r,t=nc(e,r))),t===1)throw n=vr,As(e,0),rs(e,s),Qt(e,wt()),n;if(t===6)rs(e,s);else{if(r=e.current.alternate,!(s&30)&&!Sx(r)&&(t=zi(e,s),t===2&&(o=Ma(e),o!==0&&(s=o,t=nc(e,o))),t===1))throw n=vr,As(e,0),rs(e,s),Qt(e,wt()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(Se(345));case 2:Rs(e,Vt,Fn);break;case 3:if(rs(e,s),(s&130023424)===s&&(t=qc+500-wt(),10<t)){if(Pi(e,0)!==0)break;if(r=e.suspendedLanes,(r&s)!==s){Ut(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=Na(Rs.bind(null,e,Vt,Fn),t);break}Rs(e,Vt,Fn);break;case 4:if(rs(e,s),(s&4194240)===s)break;for(t=e.eventTimes,r=-1;0<s;){var l=31-Tn(s);o=1<<l,l=t[l],l>r&&(r=l),s&=~o}if(s=r,s=wt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*vx(s/1960))-s,10<s){e.timeoutHandle=Na(Rs.bind(null,e,Vt,Fn),s);break}Rs(e,Vt,Fn);break;case 5:Rs(e,Vt,Fn);break;default:throw Error(Se(329))}}}return Qt(e,wt()),e.callbackNode===n?g0.bind(null,e):null}function nc(e,t){var n=Jo;return e.current.memoizedState.isDehydrated&&(As(e,t).flags|=256),e=zi(e,t),e!==2&&(t=Vt,Vt=n,t!==null&&sc(t)),e}function sc(e){Vt===null?Vt=e:Vt.push.apply(Vt,e)}function Sx(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!bn(o(),r))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function rs(e,t){for(t&=~Vc,t&=~ll,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Tn(t),s=1<<n;e[n]=-1,t&=~s}}function hf(e){if(st&6)throw Error(Se(327));fo();var t=Pi(e,0);if(!(t&1))return Qt(e,wt()),null;var n=zi(e,t);if(e.tag!==0&&n===2){var s=Ma(e);s!==0&&(t=s,n=nc(e,s))}if(n===1)throw n=vr,As(e,0),rs(e,t),Qt(e,wt()),n;if(n===6)throw Error(Se(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Rs(e,Vt,Fn),Qt(e,wt()),null}function Kc(e,t){var n=st;st|=1;try{return e(t)}finally{st=n,st===0&&(vo=wt()+500,sl&&ws())}}function Ns(e){ls!==null&&ls.tag===0&&!(st&6)&&fo();var t=st;st|=1;var n=dn.transition,s=lt;try{if(dn.transition=null,lt=1,e)return e()}finally{lt=s,dn.transition=n,st=t,!(st&6)&&ws()}}function Zc(){en=oo.current,dt(oo)}function As(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,K1(n)),jt!==null)for(n=jt.return;n!==null;){var s=n;switch(Ec(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&bi();break;case 3:mo(),dt(Kt),dt(Yt),Gc();break;case 5:Fc(s);break;case 4:mo();break;case 13:dt(mt);break;case 19:dt(mt);break;case 10:Lc(s.type._context);break;case 22:case 23:Zc()}n=n.return}if(It=e,jt=e=xs(e.current,null),Nt=en=t,bt=0,vr=null,Vc=ll=Ls=0,Vt=Jo=null,Ts!==null){for(t=0;t<Ts.length;t++)if(n=Ts[t],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var l=o.next;o.next=r,s.next=l}n.pending=s}Ts=null}return e}function v0(e,t){do{var n=jt;try{if(Oc(),ui.current=$i,Di){for(var s=vt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Di=!1}if(Os=0,At=Mt=vt=null,Zo=!1,yr=0,Xc.current=null,n===null||n.return===null){bt=1,vr=t,jt=null;break}e:{var o=e,l=n.return,i=n,c=t;if(t=Nt,i.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,f=i,d=f.tag;if(!(f.mode&1)&&(d===0||d===11||d===15)){var p=f.alternate;p?(f.updateQueue=p.updateQueue,f.memoizedState=p.memoizedState,f.lanes=p.lanes):(f.updateQueue=null,f.memoizedState=null)}var y=ef(l);if(y!==null){y.flags&=-257,tf(y,l,i,o,t),y.mode&1&&Ju(o,u,t),t=y,c=u;var v=t.updateQueue;if(v===null){var k=new Set;k.add(c),t.updateQueue=k}else v.add(c);break e}else{if(!(t&1)){Ju(o,u,t),Qc();break e}c=Error(Se(426))}}else if(pt&&i.mode&1){var w=ef(l);if(w!==null){!(w.flags&65536)&&(w.flags|=256),tf(w,l,i,o,t),Ic(go(c,i));break e}}o=c=go(c,i),bt!==4&&(bt=2),Jo===null?Jo=[o]:Jo.push(o),o=l;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t;var m=n0(o,c,t);Xu(o,m);break e;case 1:i=c;var h=o.type,x=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(ps===null||!ps.has(x)))){o.flags|=65536,t&=-t,o.lanes|=t;var C=s0(o,i,t);Xu(o,C);break e}}o=o.return}while(o!==null)}k0(n)}catch(j){t=j,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(1)}function S0(){var e=Fi.current;return Fi.current=$i,e===null?$i:e}function Qc(){(bt===0||bt===3||bt===2)&&(bt=4),It===null||!(Ls&268435455)&&!(ll&268435455)||rs(It,Nt)}function zi(e,t){var n=st;st|=2;var s=S0();(It!==e||Nt!==t)&&(Fn=null,As(e,t));do try{Cx();break}catch(r){v0(e,r)}while(1);if(Oc(),st=n,Fi.current=s,jt!==null)throw Error(Se(261));return It=null,Nt=0,bt}function Cx(){for(;jt!==null;)C0(jt)}function kx(){for(;jt!==null&&!Xh();)C0(jt)}function C0(e){var t=P0(e.alternate,e,en);e.memoizedProps=e.pendingProps,t===null?k0(e):jt=t,Xc.current=null}function k0(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=xx(n,t),n!==null){n.flags&=32767,jt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{bt=6,jt=null;return}}else if(n=hx(n,t,en),n!==null){jt=n;return}if(t=t.sibling,t!==null){jt=t;return}jt=t=e}while(t!==null);bt===0&&(bt=5)}function Rs(e,t,n){var s=lt,r=dn.transition;try{dn.transition=null,lt=1,wx(e,t,n,s)}finally{dn.transition=r,lt=s}return null}function wx(e,t,n,s){do fo();while(ls!==null);if(st&6)throw Error(Se(327));n=e.finishedWork;var r=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(Se(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(s1(e,o),e===It&&(jt=It=null,Nt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Br||(Br=!0,R0(wi,function(){return fo(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=dn.transition,dn.transition=null;var l=lt;lt=1;var i=st;st|=4,Xc.current=null,mx(e,n),y0(n,e),Y1(Oa),Ri=!!_a,Oa=_a=null,e.current=n,gx(n),Vh(),st=i,lt=l,dn.transition=o}else e.current=n;if(Br&&(Br=!1,ls=e,Bi=r),o=e.pendingLanes,o===0&&(ps=null),Zh(n.stateNode),Qt(e,wt()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(Gi)throw Gi=!1,e=ec,ec=null,e;return Bi&1&&e.tag!==0&&fo(),o=e.pendingLanes,o&1?e===tc?er++:(er=0,tc=e):er=0,ws(),null}function fo(){if(ls!==null){var e=np(Bi),t=dn.transition,n=lt;try{if(dn.transition=null,lt=16>e?16:e,ls===null)var s=!1;else{if(e=ls,ls=null,Bi=0,st&6)throw Error(Se(331));var r=st;for(st|=4,Ee=e.current;Ee!==null;){var o=Ee,l=o.child;if(Ee.flags&16){var i=o.deletions;if(i!==null){for(var c=0;c<i.length;c++){var u=i[c];for(Ee=u;Ee!==null;){var f=Ee;switch(f.tag){case 0:case 11:case 15:Qo(8,f,o)}var d=f.child;if(d!==null)d.return=f,Ee=d;else for(;Ee!==null;){f=Ee;var p=f.sibling,y=f.return;if(p0(f),f===u){Ee=null;break}if(p!==null){p.return=y,Ee=p;break}Ee=y}}}var v=o.alternate;if(v!==null){var k=v.child;if(k!==null){v.child=null;do{var w=k.sibling;k.sibling=null,k=w}while(k!==null)}}Ee=o}}if(o.subtreeFlags&2064&&l!==null)l.return=o,Ee=l;else e:for(;Ee!==null;){if(o=Ee,o.flags&2048)switch(o.tag){case 0:case 11:case 15:Qo(9,o,o.return)}var m=o.sibling;if(m!==null){m.return=o.return,Ee=m;break e}Ee=o.return}}var h=e.current;for(Ee=h;Ee!==null;){l=Ee;var x=l.child;if(l.subtreeFlags&2064&&x!==null)x.return=l,Ee=x;else e:for(l=h;Ee!==null;){if(i=Ee,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:il(9,i)}}catch(j){kt(i,i.return,j)}if(i===l){Ee=null;break e}var C=i.sibling;if(C!==null){C.return=i.return,Ee=C;break e}Ee=i.return}}if(st=r,ws(),Ln&&typeof Ln.onPostCommitFiberRoot=="function")try{Ln.onPostCommitFiberRoot(Qi,e)}catch{}s=!0}return s}finally{lt=n,dn.transition=t}}return!1}function xf(e,t,n){t=go(n,t),t=n0(e,t,1),e=ds(e,t,1),t=Ut(),e!==null&&(kr(e,1,t),Qt(e,t))}function kt(e,t,n){if(e.tag===3)xf(e,e,n);else for(;t!==null;){if(t.tag===3){xf(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ps===null||!ps.has(s))){e=go(n,e),e=s0(t,e,1),t=ds(t,e,1),e=Ut(),t!==null&&(kr(t,1,e),Qt(t,e));break}}t=t.return}}function Px(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Ut(),e.pingedLanes|=e.suspendedLanes&n,It===e&&(Nt&n)===n&&(bt===4||bt===3&&(Nt&130023424)===Nt&&500>wt()-qc?As(e,0):Vc|=n),Qt(e,t)}function w0(e,t){t===0&&(e.mode&1?(t=Er,Er<<=1,!(Er&130023424)&&(Er=4194304)):t=1);var n=Ut();e=Kn(e,t),e!==null&&(kr(e,t,n),Qt(e,n))}function Rx(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),w0(e,n)}function jx(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(Se(314))}s!==null&&s.delete(t),w0(e,n)}var P0;P0=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Kt.current)qt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return qt=!1,px(e,t,n);qt=!!(e.flags&131072)}else qt=!1,pt&&t.flags&1048576&&Mp(t,Ii,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;di(e,t),e=t.pendingProps;var r=ho(t,Yt.current);uo(t,n),r=zc(null,t,s,e,r,n);var o=Yc();return t.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Zt(s)?(o=!0,Ai(t)):o=!1,t.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Dc(t),r.updater=rl,t.stateNode=r,r._reactInternals=t,Ya(t,s,e,n),t=Wa(null,t,s,!0,o,n)):(t.tag=0,pt&&o&&Ac(t),Ht(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(di(e,t),e=t.pendingProps,r=s._init,s=r(s._payload),t.type=s,r=t.tag=Mx(s),e=mn(s,e),r){case 0:t=Ua(null,t,s,e,n);break e;case 1:t=of(null,t,s,e,n);break e;case 11:t=nf(null,t,s,e,n);break e;case 14:t=sf(null,t,s,mn(s.type,e),n);break e}throw Error(Se(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:mn(s,r),Ua(e,t,s,r,n);case 1:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:mn(s,r),of(e,t,s,r,n);case 3:e:{if(l0(t),e===null)throw Error(Se(387));s=t.pendingProps,o=t.memoizedState,r=o.element,Op(e,t),Li(t,s,null,n);var l=t.memoizedState;if(s=l.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},t.updateQueue.baseState=o,t.memoizedState=o,t.flags&256){r=go(Error(Se(423)),t),t=rf(e,t,s,n,r);break e}else if(s!==r){r=go(Error(Se(424)),t),t=rf(e,t,s,n,r);break e}else for(nn=fs(t.stateNode.containerInfo.firstChild),sn=t,pt=!0,vn=null,n=Ip(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(xo(),s===r){t=Zn(e,t,n);break e}Ht(e,t,s,n)}t=t.child}return t;case 5:return Lp(t),e===null&&Ga(t),s=t.type,r=t.pendingProps,o=e!==null?e.memoizedProps:null,l=r.children,La(s,r)?l=null:o!==null&&La(s,o)&&(t.flags|=32),i0(e,t),Ht(e,t,l,n),t.child;case 6:return e===null&&Ga(t),null;case 13:return a0(e,t,n);case 4:return $c(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=yo(t,null,s,n):Ht(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:mn(s,r),nf(e,t,s,r,n);case 7:return Ht(e,t,t.pendingProps,n),t.child;case 8:return Ht(e,t,t.pendingProps.children,n),t.child;case 12:return Ht(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,o=t.memoizedProps,l=r.value,ut(_i,s._currentValue),s._currentValue=l,o!==null)if(bn(o.value,l)){if(o.children===r.children&&!Kt.current){t=Zn(e,t,n);break e}}else for(o=t.child,o!==null&&(o.return=t);o!==null;){var i=o.dependencies;if(i!==null){l=o.child;for(var c=i.firstContext;c!==null;){if(c.context===s){if(o.tag===1){c=Wn(-1,n&-n),c.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?c.next=c:(c.next=f.next,f.next=c),u.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),Ba(o.return,n,t),i.lanes|=n;break}c=c.next}}else if(o.tag===10)l=o.type===t.type?null:o.child;else if(o.tag===18){if(l=o.return,l===null)throw Error(Se(341));l.lanes|=n,i=l.alternate,i!==null&&(i.lanes|=n),Ba(l,n,t),l=o.sibling}else l=o.child;if(l!==null)l.return=o;else for(l=o;l!==null;){if(l===t){l=null;break}if(o=l.sibling,o!==null){o.return=l.return,l=o;break}l=l.return}o=l}Ht(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,uo(t,n),r=pn(r),s=s(r),t.flags|=1,Ht(e,t,s,n),t.child;case 14:return s=t.type,r=mn(s,t.pendingProps),r=mn(s.type,r),sf(e,t,s,r,n);case 15:return o0(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:mn(s,r),di(e,t),t.tag=1,Zt(s)?(e=!0,Ai(t)):e=!1,uo(t,n),t0(t,s,r),Ya(t,s,r,n),Wa(null,t,s,!0,e,n);case 19:return c0(e,t,n);case 22:return r0(e,t,n)}throw Error(Se(156,t.tag))};function R0(e,t){return Qd(e,t)}function Tx(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fn(e,t,n,s){return new Tx(e,t,n,s)}function Jc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Mx(e){if(typeof e=="function")return Jc(e)?1:0;if(e!=null){if(e=e.$$typeof,e===gc)return 11;if(e===vc)return 14}return 2}function xs(e,t){var n=e.alternate;return n===null?(n=fn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function xi(e,t,n,s,r,o){var l=2;if(s=e,typeof e=="function")Jc(e)&&(l=1);else if(typeof e=="string")l=5;else e:switch(e){case Vs:return Es(n.children,r,o,t);case mc:l=8,r|=8;break;case pa:return e=fn(12,n,t,r|2),e.elementType=pa,e.lanes=o,e;case ha:return e=fn(13,n,t,r),e.elementType=ha,e.lanes=o,e;case xa:return e=fn(19,n,t,r),e.elementType=xa,e.lanes=o,e;case Ld:return al(n,r,o,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case _d:l=10;break e;case Od:l=9;break e;case gc:l=11;break e;case vc:l=14;break e;case ns:l=16,s=null;break e}throw Error(Se(130,e==null?e:typeof e,""))}return t=fn(l,n,t,r),t.elementType=e,t.type=s,t.lanes=o,t}function Es(e,t,n,s){return e=fn(7,e,s,t),e.lanes=n,e}function al(e,t,n,s){return e=fn(22,e,s,t),e.elementType=Ld,e.lanes=n,e.stateNode={isHidden:!1},e}function Gl(e,t,n){return e=fn(6,e,null,t),e.lanes=n,e}function Bl(e,t,n){return t=fn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function bx(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cl(0),this.expirationTimes=Cl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cl(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function eu(e,t,n,s,r,o,l,i,c){return e=new bx(e,t,n,i,c),t===1?(t=1,o===!0&&(t|=8)):t=0,o=fn(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Dc(o),e}function Ax(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Xs,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function j0(e){if(!e)return gs;e=e._reactInternals;e:{if($s(e)!==e||e.tag!==1)throw Error(Se(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Zt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Se(171))}if(e.tag===1){var n=e.type;if(Zt(n))return jp(e,n,t)}return t}function T0(e,t,n,s,r,o,l,i,c){return e=eu(n,s,!0,e,r,o,l,i,c),e.context=j0(null),n=e.current,s=Ut(),r=hs(n),o=Wn(s,r),o.callback=t??null,ds(n,o,r),e.current.lanes=r,kr(e,r,s),Qt(e,s),e}function cl(e,t,n,s){var r=t.current,o=Ut(),l=hs(r);return n=j0(n),t.context===null?t.context=n:t.pendingContext=n,t=Wn(o,l),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=ds(r,t,l),e!==null&&(Mn(e,r,l,o),ci(e,r,l)),l}function Yi(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function yf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function tu(e,t){yf(e,t),(e=e.alternate)&&yf(e,t)}function Ex(){return null}var M0=typeof reportError=="function"?reportError:function(e){console.error(e)};function nu(e){this._internalRoot=e}ul.prototype.render=nu.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Se(409));cl(e,t,null,null)};ul.prototype.unmount=nu.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Ns(function(){cl(null,e,null,null)}),t[qn]=null}};function ul(e){this._internalRoot=e}ul.prototype.unstable_scheduleHydration=function(e){if(e){var t=rp();e={blockedOn:null,target:e,priority:t};for(var n=0;n<os.length&&t!==0&&t<os[n].priority;n++);os.splice(n,0,e),n===0&&lp(e)}};function su(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function fl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function mf(){}function Ix(e,t,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var u=Yi(l);o.call(u)}}var l=T0(t,s,e,0,null,!1,!1,"",mf);return e._reactRootContainer=l,e[qn]=l.current,fr(e.nodeType===8?e.parentNode:e),Ns(),l}for(;r=e.lastChild;)e.removeChild(r);if(typeof s=="function"){var i=s;s=function(){var u=Yi(c);i.call(u)}}var c=eu(e,0,!1,null,null,!1,!1,"",mf);return e._reactRootContainer=c,e[qn]=c.current,fr(e.nodeType===8?e.parentNode:e),Ns(function(){cl(t,c,n,s)}),c}function dl(e,t,n,s,r){var o=n._reactRootContainer;if(o){var l=o;if(typeof r=="function"){var i=r;r=function(){var c=Yi(l);i.call(c)}}cl(t,l,e,r)}else l=Ix(n,t,e,r,s);return Yi(l)}sp=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=zo(t.pendingLanes);n!==0&&(kc(t,n|1),Qt(t,wt()),!(st&6)&&(vo=wt()+500,ws()))}break;case 13:Ns(function(){var s=Kn(e,1);if(s!==null){var r=Ut();Mn(s,e,1,r)}}),tu(e,1)}};wc=function(e){if(e.tag===13){var t=Kn(e,134217728);if(t!==null){var n=Ut();Mn(t,e,134217728,n)}tu(e,134217728)}};op=function(e){if(e.tag===13){var t=hs(e),n=Kn(e,t);if(n!==null){var s=Ut();Mn(n,e,t,s)}tu(e,t)}};rp=function(){return lt};ip=function(e,t){var n=lt;try{return lt=e,t()}finally{lt=n}};Ra=function(e,t,n){switch(t){case"input":if(ga(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=nl(s);if(!r)throw Error(Se(90));Dd(s),ga(s,r)}}}break;case"textarea":Fd(e,n);break;case"select":t=n.value,t!=null&&io(e,!!n.multiple,t,!1)}};Wd=Kc;Xd=Ns;var _x={usingClientEntryPoint:!1,Events:[Pr,Qs,nl,Hd,Ud,Kc]},_o={findFiberByHostInstance:js,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ox={bundleType:_o.bundleType,version:_o.version,rendererPackageName:_o.rendererPackageName,rendererConfig:_o.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Qn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Kd(e),e===null?null:e.stateNode},findFiberByHostInstance:_o.findFiberByHostInstance||Ex,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var zr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!zr.isDisabled&&zr.supportsFiber)try{Qi=zr.inject(Ox),Ln=zr}catch{}}rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_x;rn.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!su(t))throw Error(Se(200));return Ax(e,t,null,n)};rn.createRoot=function(e,t){if(!su(e))throw Error(Se(299));var n=!1,s="",r=M0;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),t=eu(e,1,!1,null,null,n,!1,s,r),e[qn]=t.current,fr(e.nodeType===8?e.parentNode:e),new nu(t)};rn.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Se(188)):(e=Object.keys(e).join(","),Error(Se(268,e)));return e=Kd(t),e=e===null?null:e.stateNode,e};rn.flushSync=function(e){return Ns(e)};rn.hydrate=function(e,t,n){if(!fl(t))throw Error(Se(200));return dl(null,e,t,!0,n)};rn.hydrateRoot=function(e,t,n){if(!su(e))throw Error(Se(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",l=M0;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),t=T0(t,null,e,1,n??null,r,!1,o,l),e[qn]=t.current,fr(e),s)for(e=0;e<s.length;e++)n=s[e],r=n._getVersion,r=r(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new ul(t)};rn.render=function(e,t,n){if(!fl(t))throw Error(Se(200));return dl(null,e,t,!1,n)};rn.unmountComponentAtNode=function(e){if(!fl(e))throw Error(Se(40));return e._reactRootContainer?(Ns(function(){dl(null,null,e,!1,function(){e._reactRootContainer=null,e[qn]=null})}),!0):!1};rn.unstable_batchedUpdates=Kc;rn.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!fl(n))throw Error(Se(200));if(e==null||e._reactInternals===void 0)throw Error(Se(38));return dl(e,t,n,!1,s)};rn.version="18.3.1-next-f1338f8080-20240426";function b0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b0)}catch(e){console.error(e)}}b0(),bd.exports=rn;var Lx=bd.exports,gf=Lx;fa.createRoot=gf.createRoot,fa.hydrateRoot=gf.hydrateRoot;var Ae=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e.T_I="T_I",e.T_L="T_L",e.T_T="T_T",e.T_S="T_S",e.T_O="T_O",e.T_I_C="T_I_C",e.T_L_C="T_L_C",e.T_T_C="T_T_C",e.T_S_C="T_S_C",e.T_O_C="T_O_C",e.P_I="P_I",e.P_L="P_L",e.P_X="P_X",e.P_U="P_U",e.P_L2="P_L2",e.P_Y="P_Y",e.P_T="P_T",e.P_S="P_S",e.P_P="P_P",e.P_Z="P_Z",e.P_W="P_W",e.P_I_C="P_I_C",e.P_L_C="P_L_C",e.P_X_C="P_X_C",e.P_U_C="P_U_C",e.P_L2_C="P_L2_C",e.P_Y_C="P_Y_C",e.P_T_C="P_T_C",e.P_S_C="P_S_C",e.P_P_C="P_P_C",e.P_Z_C="P_Z_C",e.P_W_C="P_W_C",e.H_I="H_I",e.H_L="H_L",e.H_X="H_X",e.H_U="H_U",e.H_L2="H_L2",e.H_Y="H_Y",e.H_T="H_T",e.H_S="H_S",e.H_P="H_P",e.H_Z="H_Z",e.H_W="H_W",e.H_I_C="H_I_C",e.H_L_C="H_L_C",e.H_X_C="H_X_C",e.H_U_C="H_U_C",e.H_L2_C="H_L2_C",e.H_Y_C="H_Y_C",e.H_T_C="H_T_C",e.H_S_C="H_S_C",e.H_P_C="H_P_C",e.H_Z_C="H_Z_C",e.H_W_C="H_W_C",e))(Ae||{}),Bn=(e=>(e.SPAWNED="SPAWNED",e.FALLING="FALLING",e.LOCKED="LOCKED",e))(Bn||{}),qe=(e=>(e.ConsoleScreen="CONSOLE",e.TankScreen="PERISCOPE",e.COMPLICATION_MINIGAME="COMPLICATION_MINIGAME",e.EndGameScreen="GAME_OVER",e))(qe||{}),Oe=(e=>(e.LIGHTS="LIGHTS",e.CONTROLS="CONTROLS",e.LASER="LASER",e))(Oe||{});const tt=12,we=30,Dt=21,De=24,nt=De-Dt,So=375,Oo=75*1e3,zl=.15,Nx=.5,Dx=30,$x=0,Fx=100,vf=15,Gx=10,Bx=250,Dn={CIRCUIT_STABILIZER:{id:"CIRCUIT_STABILIZER",name:"Circuit Stabilizer",desc:"Extends grace period before lights start dimming.",type:"passive",category:"complication",unlockRank:2,costPerLevel:1,maxLevel:4,effectPerLevel:.75,formatEffect:e=>`+${(e*.75).toFixed(2)}s Grace Period`,maxLevelBonus:"Easier Fixing Sequence"},AUTO_POPPER:{id:"AUTO_POPPER",name:"Auto-Popper",desc:"At end of game, remaining goop has a chance to auto-pop before penalty.",type:"passive",unlockRank:3,costPerLevel:1,maxLevel:4,effectPerLevel:.04,formatEffect:e=>`-${20-e*4}% decay per unit`,maxLevelBonus:void 0},CAPACITOR_EFFICIENCY:{id:"CAPACITOR_EFFICIENCY",name:"Capacitor Efficiency",desc:"Reduces laser capacitor drain rate when popping goop.",type:"passive",category:"complication",unlockRank:4,costPerLevel:1,maxLevel:4,effectPerLevel:.0625,formatEffect:e=>`-${(e*6.25).toFixed(2)}% Drain Rate`,maxLevelBonus:"Easier Fixing Sequence"},COOLDOWN_BOOSTER:{id:"COOLDOWN_BOOSTER",name:"Cooldown Booster",desc:"When activated, extends all active malfunction cooldowns.",type:"active",unlockRank:5,costPerLevel:1,maxLevel:3,chargeCost:8,effectPerLevel:0,formatEffect:e=>`+${[25,35,50][e-1]||25}% Cooldown Extension`,maxLevelBonus:"+50% Cooldown Extension"},GEAR_LUBRICATION:{id:"GEAR_LUBRICATION",name:"Gear Lubrication",desc:"Increases heat dissipation rate when idle.",type:"passive",category:"complication",unlockRank:6,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Heat Dissipation`,maxLevelBonus:"Easier Fixing Sequence"},FOCUS_MODE:{id:"FOCUS_MODE",name:"Focus Mode",desc:"Time slows while at the console viewing minigames.",type:"passive",unlockRank:7,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`-${e*10}% Time Speed`,maxLevelBonus:void 0},DENSE_GOOP:{id:"DENSE_GOOP",name:"Dense Goop",desc:"Goop falls faster. Can add or remove scraps via respec.",type:"passive",unlockRank:8,costPerLevel:1,maxLevel:4,effectPerLevel:.125,formatEffect:e=>`+${(e*12.5).toFixed(1)}% Fall Speed`,maxLevelBonus:void 0},PRESSURE_CONTROL:{id:"PRESSURE_CONTROL",name:"Pressure Control",desc:"Extends time before pressure reaches 100%.",type:"passive",unlockRank:9,costPerLevel:1,maxLevel:8,effectPerLevel:5,formatEffect:e=>`+${e*5}s Game Time`,maxLevelBonus:void 0},JUNK_UNIFORMER:{id:"JUNK_UNIFORMER",name:"Junk Uniformer",desc:"Starting junk is more likely to be the same color.",type:"passive",unlockRank:10,costPerLevel:1,maxLevel:4,effectPerLevel:.1,formatEffect:e=>`+${e*10}% Same Color`,maxLevelBonus:void 0},GOOP_SWAP:{id:"GOOP_SWAP",name:"Goop Swap",desc:"Swap falling goop with stored goop faster.",type:"passive",unlockRank:12,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${(1.5-e*.25).toFixed(2)}s Swap Time`,maxLevelBonus:void 0},GOOP_DUMP:{id:"GOOP_DUMP",name:"Goop Dump",desc:"When activated, rains same-color junk from the sky. Higher levels add more waves.",type:"active",unlockRank:15,costPerLevel:1,maxLevel:3,chargeCost:12,effectPerLevel:1,formatEffect:e=>`${e} wave${e>1?"s":""} of junk`,maxLevelBonus:"3 waves of matching junk"},SEALING_BONUS:{id:"SEALING_BONUS",name:"Sealing Bonus",desc:"Sealing cracks reduces active cooldowns more.",type:"passive",unlockRank:18,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`${10+e*5}% Cooldown per Seal`,maxLevelBonus:void 0},ACTIVE_EXPANSION_SLOT:{id:"ACTIVE_EXPANSION_SLOT",name:"Active Expansion Slot",desc:"Allows equipping a second active ability simultaneously.",type:"feature",unlockRank:20,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"2 Active Slots",maxLevelBonus:void 0},GOOP_HOLD_VIEWER:{id:"GOOP_HOLD_VIEWER",name:"Goop Hold Viewer",desc:"Shows the goop currently held.",type:"feature",unlockRank:22,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"View Held Goop",maxLevelBonus:void 0},GOOP_COLORIZER:{id:"GOOP_COLORIZER",name:"Goop Colorizer",desc:"When activated, upcoming goop matches your current color.",type:"active",unlockRank:25,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:1,formatEffect:e=>`Next ${5+e} goop match`,maxLevelBonus:"Next 8 goop match"},GOOP_WINDOW:{id:"GOOP_WINDOW",name:"Goop Window",desc:"Shows you the next goop piece.",type:"feature",unlockRank:28,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"Preview Next Goop",maxLevelBonus:void 0},SLOW_CRACKS:{id:"SLOW_CRACKS",name:"Slow Cracks",desc:"Cracks grow slower over time.",type:"passive",unlockRank:30,costPerLevel:1,maxLevel:4,effectPerLevel:.05,formatEffect:e=>`-${e*5}% Growth Chance`,maxLevelBonus:void 0},CRACK_MATCHER:{id:"CRACK_MATCHER",name:"Crack Matcher",desc:"Falling goop color biased toward the lowest crack.",type:"passive",unlockRank:32,costPerLevel:1,maxLevel:4,effectPerLevel:.25,formatEffect:e=>`${e*25}% Match Chance`,maxLevelBonus:void 0},CRACK_DOWN:{id:"CRACK_DOWN",name:"Crack Down",desc:"When activated, next cracks form in the bottom 4 rows.",type:"active",unlockRank:35,costPerLevel:1,maxLevel:3,chargeCost:10,effectPerLevel:2,formatEffect:e=>`Next ${1+e*2} cracks spawn low`,maxLevelBonus:"Next 7 cracks spawn low"},ACTIVE_EXPANSION_SLOT_2:{id:"ACTIVE_EXPANSION_SLOT_2",name:"Active Expansion Slot",desc:"Allows equipping a third active ability simultaneously.",type:"feature",unlockRank:38,costPerLevel:1,maxLevel:1,effectPerLevel:1,formatEffect:()=>"3 Active Slots",maxLevelBonus:void 0}},Ke={RED:"#ef4444",BLUE:"#3b82f6",GREEN:"#22c55e",YELLOW:"#eab308",PURPLE:"#a855f7",WHITE:"#f8fafc",BLACK:"#1a1a2e",WILD:"wild",ORANGE:"#f97316",TEAL:"#14b8a6",GRID_BG:"#020617",GRID_EMPTY:"#1e293b"},Le=(e,t)=>({type:e,color:Ke.RED,cells:t.map(([n,s])=>({x:n,y:s}))}),Sf=[Le(Ae.I,[[-1,0],[0,0],[1,0],[2,0]]),Le(Ae.J,[[-1,-1],[-1,0],[0,0],[1,0]]),Le(Ae.L,[[1,-1],[-1,0],[0,0],[1,0]]),Le(Ae.O,[[0,0],[1,0],[0,1],[1,1]]),Le(Ae.S,[[0,0],[1,0],[0,1],[-1,1]]),Le(Ae.T,[[0,-1],[-1,0],[0,0],[1,1]]),Le(Ae.Z,[[-1,0],[0,0],[0,1],[1,1]])],zx=Le(Ae.T_I,[[0,-1],[0,0],[0,1],[0,2]]),Yx=Le(Ae.T_L,[[0,0],[0,1],[0,2],[1,0]]),Hx=Le(Ae.T_T,[[0,0],[0,1],[0,2],[1,1]]),Ux=Le(Ae.T_S,[[0,0],[0,1],[1,1],[1,2]]),Wx=Le(Ae.T_O,[[0,0],[0,1],[1,0],[1,1]]),Xx=Le(Ae.T_I_C,[[0,2],[0,3],[1,0],[1,1]]),Vx=Le(Ae.T_L_C,[[0,0],[0,1],[1,0],[1,2]]),qx=Le(Ae.T_T_C,[[0,0],[0,2],[1,1],[2,1]]),Kx=Le(Ae.T_S_C,[[0,2],[1,0],[1,1],[2,1]]),Zx=Le(Ae.T_O_C,[[0,0],[0,2],[1,1],[1,2]]),bs=[zx,Yx,Hx,Ux,Wx],tr=[Xx,Vx,qx,Kx,Zx];[...bs,...tr];const Qx=Le(Ae.P_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2]]),Jx=Le(Ae.P_L,[[0,0],[0,1],[1,1],[1,2],[2,1]]),ey=Le(Ae.P_X,[[0,1],[1,0],[1,1],[1,2],[2,1]]),ty=Le(Ae.P_U,[[0,0],[1,0],[1,1],[1,2],[2,0]]),ny=Le(Ae.P_L2,[[0,0],[0,1],[1,0],[1,1],[1,2]]),sy=Le(Ae.P_Y,[[0,0],[0,1],[1,1],[1,2],[2,2]]),oy=Le(Ae.P_T,[[0,0],[0,1],[0,2],[0,3],[1,1]]),ry=Le(Ae.P_S,[[0,0],[0,1],[0,2],[0,3],[1,3]]),iy=Le(Ae.P_P,[[0,0],[0,1],[0,3],[1,0],[1,2]]),ly=Le(Ae.P_Z,[[0,0],[0,1],[0,2],[0,3],[1,1]]),ay=Le(Ae.P_W,[[0,0],[0,2],[1,1],[1,2],[2,2]]),cy=Le(Ae.P_I_C,[[0,0],[0,2],[0,4],[1,1],[1,3]]),uy=Le(Ae.P_L_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),fy=Le(Ae.P_X_C,[[0,0],[1,1],[1,2],[2,0],[2,2]]),dy=Le(Ae.P_U_C,[[0,0],[0,2],[1,1],[1,2],[2,0]]),py=Le(Ae.P_L2_C,[[0,0],[0,2],[1,1],[1,2],[2,2]]),hy=Le(Ae.P_Y_C,[[0,0],[0,1],[1,1],[2,0],[2,2]]),xy=Le(Ae.P_T_C,[[0,0],[0,1],[0,3],[1,2],[1,3]]),yy=Le(Ae.P_S_C,[[0,0],[0,1],[1,0],[1,2],[2,1]]),my=Le(Ae.P_P_C,[[0,0],[0,2],[1,0],[1,1],[1,3]]),gy=Le(Ae.P_Z_C,[[0,0],[0,2],[1,1],[1,3],[2,0]]),vy=Le(Ae.P_W_C,[[0,0],[0,2],[1,1],[2,0],[2,2]]),pl=[Qx,Jx,ey,ty,ny,sy,oy,ry,iy,ly,ay],ou=[cy,uy,fy,dy,py,hy,xy,yy,my,gy,vy];[...pl,...ou];const Sy=Le(Ae.H_I,[[0,-2],[0,-1],[0,0],[0,1],[0,2],[0,3]]),Cy=Le(Ae.H_L,[[0,0],[0,1],[0,2],[0,3],[1,1],[2,1]]),ky=Le(Ae.H_X,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,3]]),wy=Le(Ae.H_U,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,0]]),Py=Le(Ae.H_L2,[[0,0],[0,1],[1,0],[1,1],[1,2],[1,3]]),Ry=Le(Ae.H_Y,[[0,0],[0,1],[1,0],[1,1],[1,2],[2,2]]),jy=Le(Ae.H_T,[[0,0],[0,1],[0,2],[0,3],[1,1],[1,2]]),Ty=Le(Ae.H_S,[[0,0],[0,1],[1,0],[1,1],[2,1],[2,2]]),My=Le(Ae.H_P,[[0,0],[0,1],[0,2],[0,3],[1,2],[1,3]]),by=Le(Ae.H_Z,[[0,0],[0,1],[0,2],[0,3],[1,0],[1,3]]),Ay=Le(Ae.H_W,[[0,0],[0,3],[1,1],[1,2],[1,3],[2,3]]),Ey=Le(Ae.H_I_C,[[0,0],[0,3],[0,5],[1,1],[1,2],[1,4]]),Iy=Le(Ae.H_L_C,[[0,0],[0,2],[1,1],[1,2],[1,3],[2,0]]),_y=Le(Ae.H_X_C,[[0,0],[0,2],[0,3],[1,1],[1,3],[2,0]]),Oy=Le(Ae.H_U_C,[[0,0],[0,3],[1,1],[1,2],[1,4],[2,0]]),Ly=Le(Ae.H_L2_C,[[0,0],[0,1],[1,1],[1,2],[1,3],[2,0]]),Ny=Le(Ae.H_Y_C,[[0,0],[0,2],[1,0],[1,2],[1,3],[2,1]]),Dy=Le(Ae.H_T_C,[[0,0],[0,1],[0,3],[1,1],[1,2],[1,4]]),$y=Le(Ae.H_S_C,[[0,0],[0,2],[1,1],[1,3],[2,0],[2,2]]),Fy=Le(Ae.H_P_C,[[0,0],[0,2],[0,4],[1,1],[1,2],[1,3]]),Gy=Le(Ae.H_Z_C,[[0,0],[0,1],[0,3],[1,0],[1,2],[2,3]]),By=Le(Ae.H_W_C,[[0,0],[0,3],[1,1],[1,2],[2,0],[2,3]]),hl=[Sy,Cy,ky,wy,Py,Ry,jy,Ty,My,by,Ay],ru=[Ey,Iy,_y,Oy,Ly,Ny,Dy,$y,Fy,Gy,By];[...hl,...ru];const Xe=e=>(e%we+we)%we,oc=(e,t)=>Xe(Math.round(e)+t),zy=(e,t)=>{let n=e-t;for(;n>we/2;)n-=we;for(;n<=-we/2;)n+=we;return n},A0=(e,t,n)=>{const s=n?n.x:Math.round(e.reduce((o,l)=>o+l.x,0)/e.length),r=n?n.y:Math.round(e.reduce((o,l)=>o+l.y,0)/e.length);return e.map(({x:o,y:l})=>{const i=o-s,c=l-r;return t?{x:-c+s,y:i+r}:{x:c+s,y:-i+r}})},Rn=e=>{const t=[Ke.RED,Ke.BLUE,Ke.GREEN,Ke.YELLOW];return e>=10&&t.push(Ke.PURPLE),e>=30&&t.push(Ke.WHITE),e>=50&&t.push(Ke.BLACK),t},Yy=(e,t=1)=>{const n=e||Sf[Math.floor(Math.random()*Sf.length)],s=Rn(t),o=(e==null?void 0:e.color)&&s.includes(e.color)?e.color:s[Math.floor(Math.random()*s.length)],l=Math.round(n.cells.reduce((c,u)=>c+u.x,0)/n.cells.length),i=Math.round(n.cells.reduce((c,u)=>c+u.y,0)/n.cells.length);return{definition:{...n,color:o},x:0,y:0,screenX:0,rotation:0,cells:[...n.cells],rotationCenter:{x:l,y:i},spawnTimestamp:Date.now(),startSpawnY:0,state:Bn.SPAWNED}},Cf=(e,t)=>{const n=Array(De).fill(null).map(()=>Array(we).fill(null));let s=0;if(e>=9?s=11:e>=6?s=8:e>=3&&(s=5),s>0){const r=Rn(e),o=Array.from({length:we},(d,p)=>p);for(let d=o.length-1;d>0;d--){const p=Math.floor(Math.random()*(d+1));[o[d],o[p]]=[o[p],o[d]]}const l=o.slice(0,s),i=De-1,u=((t==null?void 0:t.JUNK_UNIFORMER)||0)*.1;let f=null;l.forEach(d=>{let p;f===null?(p=r[Math.floor(Math.random()*r.length)],f=p):p=Math.random()<u?f:r[Math.floor(Math.random()*r.length)];const y=Math.random().toString(36).substr(2,9);n[i][d]={id:Math.random().toString(36).substr(2,9),goopGroupId:y,timestamp:Date.now(),color:p,groupMinY:i,groupMaxY:i,groupSize:1}})}return n},vs=(e,t,n)=>{for(const s of t.cells){const r=Xe(t.x+s.x),o=t.y+s.y;if(o+1>De)return!0;const l=Math.floor(o),i=Math.floor(o+1-1e-4);for(let c=l;c<=i;c++)if(c>=0&&c<De&&e[c][r]!==null)return!0}return!1},E0=(e,t,n)=>{let s=Math.floor(t.y);for(;s>-5&&vs(e,{...t,y:s});)s-=1;let r=s;for(;r<De&&!vs(e,{...t,y:r+1});)r+=1;return Math.max(s,r)},Hy=(e,t,n)=>{const s=e[n][t];if(!s)return[];const r=[],o=new Set,l=[{x:t,y:n}],i=s.goopGroupId;for(;l.length>0;){const{x:c,y:u}=l.shift(),f=`${c},${u}`;if(o.has(f))continue;o.add(f),r.push({x:c,y:u});const d=[{x:Xe(c+1),y:u},{x:Xe(c-1),y:u},{x:c,y:u+1},{x:c,y:u-1}];for(const p of d)if(p.y>=0&&p.y<De){const y=e[p.y][p.x];y&&y.goopGroupId===i&&(o.has(`${p.x},${p.y}`)||l.push(p))}}return r},Hi=e=>{const t=e.map(r=>[...r]),n=new Set,s=(r,o,l,i)=>{const c=[],u=[{x:r,y:o}],f=new Set;for(;u.length>0;){const d=u.shift(),p=`${d.x},${d.y}`;if(f.has(p))continue;f.add(p),c.push(d);const y=[{x:Xe(d.x+1),y:d.y},{x:Xe(d.x-1),y:d.y},{x:d.x,y:d.y+1},{x:d.x,y:d.y-1}];for(const v of y)if(v.y>=0&&v.y<De){const k=t[v.y][v.x];if(!k||f.has(`${v.x},${v.y}`))continue;(i?k.isWild:k.color===l&&!k.isWild)&&u.push(v)}}return c};for(let r=0;r<De;r++)for(let o=0;o<we;o++){const l=t[r][o];if(l&&!n.has(`${o},${r}`)){const i=s(o,r,l.color,!!l.isWild);let c=De,u=-1;i.forEach(w=>{w.y<c&&(c=w.y),w.y>u&&(u=w.y)});const f=i.length;let d=!0;const p=l.goopGroupId,y=l.groupSize;if(y!==f)d=!1;else for(const w of i){const m=t[w.y][w.x];if(!m||m.goopGroupId!==p||m.groupSize!==y){d=!1;break}}const v=d?p:Math.random().toString(36).substr(2,9),k=d?l.timestamp:Date.now();i.forEach(w=>{n.add(`${w.x},${w.y}`);const m=t[w.y][w.x];t[w.y][w.x]={...m,goopGroupId:v,timestamp:k,groupMinY:c,groupMaxY:u,groupSize:f}})}}return t},Uy=(e,t,n)=>{const s=e.map(p=>[...p]),r=Math.random().toString(36).substr(2,9),o=Date.now();let l=De,i=-1;const c=[],u=[];t.cells.forEach(p=>{const y=Math.floor(t.y+p.y);y<l&&(l=y),y>i&&(i=y)});const f=t.cells.length,d=t.definition.isWild;return t.cells.forEach((p,y)=>{var m;const v=Xe(t.x+p.x),k=Math.floor(t.y+p.y),w=((m=t.definition.cellColors)==null?void 0:m[y])??t.definition.color;if(k>=0&&k<De){const h=n.find(C=>C.x===v&&C.y===k);let x=!1;h&&(h.color===w||d)&&(c.push(h.id),x=!0),s[k][v]={id:Math.random().toString(36).substr(2,9),goopGroupId:r,timestamp:o,color:w,groupMinY:l,groupMaxY:i,groupSize:f,isSealingGoop:x,isWild:d}}}),{grid:Hi(s),consumedGoals:c,destroyedGoals:u}},Wy=(e,t)=>{const n=e.map(i=>[...i]),s=t.definition.isWild,r=t.definition.color,o=[];t.cells.forEach(i=>{const c=Xe(t.x+i.x),u=Math.floor(t.y+i.y);u>=0&&u<De&&o.push({x:c,y:u})});const l=new Set;if(o.forEach(({x:i,y:c})=>{[{x:Xe(i+1),y:c},{x:Xe(i-1),y:c},{x:i,y:c+1},{x:i,y:c-1}].forEach(f=>{if(f.y>=0&&f.y<De){const d=n[f.y][f.x];if(!d||o.some(y=>y.x===f.x&&y.y===f.y))return;s?d.isWild||l.add(d.goopGroupId):d.isWild&&l.add(d.goopGroupId)}})}),l.size>0)for(let i=0;i<De;i++)for(let c=0;c<we;c++){const u=n[i][c];u&&l.has(u.goopGroupId)&&(s?n[i][c]={...u,isWild:!0}:n[i][c]={...u,color:r,isWild:!1})}return Hi(n)},I0=(e,t)=>{const n=e.map(c=>[...c]),s=[],r=new Map;for(let c=0;c<De;c++)for(let u=0;u<we;u++){const f=n[c][u];f&&(r.has(f.goopGroupId)||r.set(f.goopGroupId,[]),r.get(f.goopGroupId).push({x:u,y:c}))}let o;if(t&&t.length>0){const c=new Map;for(const u of t){const f=c.get(u.x);(f===void 0||u.y<f)&&c.set(u.x,u.y)}o=new Set;for(const[u,f]of r)for(const d of f){const p=c.get(d.x);if(p!==void 0&&d.y<p){o.add(u);break}}}else o=new Set(r.keys());const l=new Set;for(const[c,u]of r)for(const f of u)if(f.y===De-1){l.add(c);break}let i=!0;for(;i;){i=!1;for(const[c,u]of r)if(!l.has(c))for(const f of u){const d=f.y+1;if(d<De){const p=n[d][f.x];if(p&&p.goopGroupId!==c&&l.has(p.goopGroupId)){l.add(c),i=!0;break}}}}for(const c of o)if(!l.has(c)){const u=r.get(c);for(const f of u)s.push({data:n[f.y][f.x],x:f.x,y:f.y,velocity:0}),n[f.y][f.x]=null}return{grid:n,looseGoop:s}},Xy=(e,t,n,s)=>{const r=[],o=[],l=.012*n,i=[...e].sort((c,u)=>u.y-c.y);for(const c of i){const u=c.y+l;if(u>=De-1){o.push({...c,y:De-1});continue}const f=Math.floor(u+1),d=c.x;t[f]&&t[f][d]?o.push({...c,y:Math.floor(u)}):r.push({...c,y:u})}return{active:r,landed:o}},Vy=e=>Math.max(0,(De-e)*10),qy=(e,t)=>{const n=Xe(t+tt/2);let s=Math.abs(e-n);return s>we/2&&(s=we-s),s>tt/2?50:0},Ky=e=>1+e*.1,Zy=(e,t)=>{let n=0;const s=new Set(t.map(r=>`${r.x},${r.y}`));return t.forEach(({x:r,y:o})=>{[{x:Xe(r+1),y:o},{x:Xe(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}].forEach(i=>{i.y>=0&&i.y<De&&e[i.y][i.x]&&!s.has(`${i.x},${i.y}`)&&n++})}),n*5},kf=(e,t,n,s,r,o=!1)=>{const l=Rn(n),i=new Set(t.map(d=>d.color)),c=l.filter(d=>!i.has(d));if(c.length===0)return null;const u=c[Math.floor(Math.random()*c.length)];let f;if(o){const d=De-4,p=De-1;f=d+Math.floor(Math.random()*(p-d+1))}else{const p=1+Math.max(0,1-s/r)*(Dt-1),y=Math.floor(De-p);f=Math.max(nt,Math.min(De-1,y))}for(let d=0;d<20;d++){const p=Math.floor(Math.random()*we),y=f;if(!e[y][p]&&!t.some(v=>v.x===p&&v.y===y))return{id:Math.random().toString(36).substr(2,9),x:p,y,color:u,spawnTime:Date.now()}}return null},Qy=(e,t,n,s,r)=>{const o=Rn(n),l=[],i=[...t],u=1+Math.max(0,1-s/r)*(Dt-1),f=Math.floor(De-u);let d=nt,p=Math.max(nt,f-1);for(const y of o)for(let v=0;v<20;v++){const k=Math.floor(Math.random()*we),w=Math.floor(d+Math.random()*(p-d+1));if(w<nt||w>=De)continue;const m=e[w][k]!==null,h=i.some(C=>C.x===k&&C.y===w),x=l.some(C=>C.x===k&&C.y===w);if(!m&&!h&&!x){const C={id:Math.random().toString(36).substr(2,9),x:k,y:w,color:y,spawnTime:Date.now()};l.push(C);break}}return l},Sn=typeof navigator<"u"&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Jy=(e,t)=>{const n=Math.max(0,Math.min(100,e))/100;if(t==="drain")if(n>.5){const s=(n-.5)*2,r=Math.round(234+(59-234)*s),o=Math.round(179+(130-179)*s),l=Math.round(8+(246-8)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=n*2,r=Math.round(220+(234-220)*s),o=Math.round(38+(179-38)*s),l=Math.round(38+(8-38)*s);return`rgb(${r}, ${o}, ${l})`}else if(n<.5){const s=n*2,r=Math.round(34+(234-34)*s),o=Math.round(197+(179-197)*s),l=Math.round(94+(8-94)*s);return`rgb(${r}, ${o}, ${l})`}else{const s=(n-.5)*2,r=Math.round(234+(220-234)*s),o=Math.round(179+(38-179)*s),l=Math.round(8+(38-8)*s);return`rgb(${r}, ${o}, ${l})`}},wf=({value:e,maxValue:t=100,colorMode:n,x:s,y:r,height:o=200,width:l=16})=>{const c=Math.max(0,Math.min(t,e))/t*(o-4),u=Jy(e,n),f="#1f2937",d="#111827";return a.jsxs("g",{transform:`translate(${s}, ${r})`,children:[a.jsx("rect",{x:0,y:0,width:l,height:o,rx:3,ry:3,fill:d,stroke:f,strokeWidth:1}),a.jsx("rect",{x:2,y:o-2-c,width:l-4,height:c,rx:2,ry:2,fill:u}),[.25,.5,.75].map(p=>a.jsx("line",{x1:0,y1:o-p*(o-4)-2,x2:4,y2:o-p*(o-4)-2,stroke:f,strokeWidth:1,opacity:.5},p))]})},Ue=30,Hs={x:-(tt/2)*Ue,y:0,w:tt*Ue,h:Dt*Ue};function Ct(e){return(e-tt/2)*Ue}function em(e){return e/Ue+tt/2}class tm{constructor(){He(this,"handlers",new Map)}on(t,n){return this.handlers.has(t)||this.handlers.set(t,new Set),this.handlers.get(t).add(n),()=>this.off(t,n)}off(t,n){var s;(s=this.handlers.get(t))==null||s.delete(n)}emit(t,n){var s;(s=this.handlers.get(t))==null||s.forEach(r=>r(n))}}const ae=new tm;var re=(e=>(e.PIECE_MOVED="PIECE_MOVED",e.PIECE_ROTATED="PIECE_ROTATED",e.PIECE_DROPPED="PIECE_DROPPED",e.GOOP_POPPED="GOOP_POPPED",e.ACTION_REJECTED="ACTION_REJECTED",e.GAME_OVER="GAME_OVER",e.GOAL_CAPTURED="GOAL_CAPTURED",e.GOAL_PLUGGED="GOAL_PLUGGED",e.CRACK_OFFSCREEN="CRACK_OFFSCREEN",e.COMPLICATION_SPAWNED="COMPLICATION_SPAWNED",e.COMPLICATION_RESOLVED="COMPLICATION_RESOLVED",e.LIGHTS_FLICKER="LIGHTS_FLICKER",e.ABILITY_ACTIVATED="ABILITY_ACTIVATED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.GAME_START="GAME_START",e.GAME_PAUSED="GAME_PAUSED",e.GAME_RESUMED="GAME_RESUMED",e.GAME_EXITED="GAME_EXITED",e.MUSIC_START="MUSIC_START",e.MUSIC_STOP="MUSIC_STOP",e.INPUT_ROTATE="INPUT_ROTATE",e.INPUT_DRAG="INPUT_DRAG",e.INPUT_SWIPE_UP="INPUT_SWIPE_UP",e.INPUT_FAST_DROP="INPUT_FAST_DROP",e.INPUT_SWAP="INPUT_SWAP",e.INPUT_BLOCK_TAP="INPUT_BLOCK_TAP",e.INPUT_SWAP_HOLD="INPUT_SWAP_HOLD",e.TUTORIAL_STEP_TRIGGERED="TUTORIAL_STEP_TRIGGERED",e.TUTORIAL_STEP_COMPLETED="TUTORIAL_STEP_COMPLETED",e.TUTORIAL_STEP_DISMISSED="TUTORIAL_STEP_DISMISSED",e.TRAINING_SCENARIO_COMPLETE="TRAINING_SCENARIO_COMPLETE",e))(re||{});const nm=1500,Bs=250,Yr=10,Lo=20;function sm({callbacks:e,tankRotation:t,grid:n,tankPressure:s,powerUps:r,trainingHighlightColor:o,disableSwap:l,disablePop:i}){const{onBlockTap:c,onRotate:u,onDragInput:f,onSwipeUp:d,onFastDrop:p,onSwap:y}=e,v=(r==null?void 0:r.GOOP_SWAP)||0,k=nm-v*250,[w,m]=g.useState(null),[h,x]=g.useState(null),[C,j]=g.useState(0),[R,P]=g.useState(null),S=g.useRef(null),T=g.useRef(null),E=g.useRef(null),M=g.useRef(null),{x:Q,y:ne,w:ie,h:L}=Hs,ee=g.useCallback((A,Y,q)=>{const K=q,me=K.getBoundingClientRect(),ce=K.clientLeft||0,ue=K.clientTop||0,Z=A-me.left-ce,Ce=Y-me.top-ue,ke=K.clientWidth,be=K.clientHeight,je=ke/ie,Te=be/L,Pe=Math.min(je,Te),Be=ie*Pe,Ie=(ke-Be)/2,_=Q+(Z-Ie)/Pe,F=ne+Ce/Pe,ve=em(_),xe=F/Ue+nt;return{vx:ve,vy:xe,svgX:_,svgY:F,relX:Z,contentW:ke,relY:Ce}},[Q,ne,ie,L]),H=g.useCallback((A,Y)=>{if(A>=0&&A<tt){const q=Math.floor(A),K=Xe(q+t),me=Math.floor(Y);if(me>=0&&me<De){const ce=n[me][K];if(ce)return{type:"BLOCK",x:K,y:me,cell:ce}}}return{type:"EMPTY"}},[t,n]),G=g.useCallback(()=>{T.current&&(clearInterval(T.current),T.current=null),j(0),P(null)},[]);g.useEffect(()=>()=>{T.current&&clearInterval(T.current)},[]);const X=g.useCallback(A=>{if(S.current)return;A.currentTarget.setPointerCapture(A.pointerId);const{relX:Y,relY:q,vx:K,vy:me}=ee(A.clientX,A.clientY,A.currentTarget);if(S.current={startX:A.clientX,startY:A.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:A.pointerId,actionConsumed:!1},!l){P({x:Y,y:q}),j(0);const ue=Date.now();T.current=window.setInterval(()=>{const Ce=Date.now()-ue;if(Ce<Bs)return;const ke=Ce-Bs,be=Math.min(100,ke/k*100);j(be),be>=100&&(S.current&&(S.current.actionConsumed=!0),ae.emit(re.INPUT_SWAP),y==null||y(),G(),navigator.vibrate&&navigator.vibrate(50))},16)}const ce=H(K,me);if(ce.type==="BLOCK"&&ce.cell){const ue=ce.cell.groupSize*So,Z=Date.now()-ce.cell.timestamp,Ce=De-1-s*(Dt-1);i?(x(ce.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(ke=>ke===ce.cell.goopGroupId?null:ke),300)):o&&ce.cell.color!==o?(x(ce.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(ke=>ke===ce.cell.goopGroupId?null:ke),300)):ce.cell.groupMinY<Ce?(x(ce.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(ke=>ke===ce.cell.goopGroupId?null:ke),300)):Z<ue?(x(ce.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(ke=>ke===ce.cell.goopGroupId?null:ke),300)):m(ce.cell.goopGroupId)}},[ee,H,s,G,k,o,i,l]),V=g.useCallback(A=>{if(!S.current||S.current.activePointerId!==A.pointerId)return;const{startX:Y,startY:q,isDragLocked:K}=S.current,me=A.clientX-Y,ce=A.clientY-q,ue=Math.abs(me),Z=Math.abs(ce);if(K||(ue>Yr||Z>Yr)&&(G(),S.current.isDragLocked=!0,m(null),ue>Z?S.current.lockedAxis="H":(S.current.lockedAxis="V",ce>0&&(ae.emit(re.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)))),S.current.isDragLocked){const Ce=S.current.lockedAxis;if(Ce==="H")me<-Lo?(ae.emit(re.INPUT_DRAG,{direction:1}),f==null||f(1)):me>Lo?(ae.emit(re.INPUT_DRAG,{direction:-1}),f==null||f(-1)):(ae.emit(re.INPUT_DRAG,{direction:0}),f==null||f(0));else if(Ce==="V"){const ke=ce>0;ae.emit(re.INPUT_FAST_DROP,{active:ke}),p==null||p(ke)}}},[G]),te=g.useCallback(A=>{if(!S.current||S.current.activePointerId!==A.pointerId)return;const{startTime:Y,isDragLocked:q,actionConsumed:K,startX:me,startY:ce}=S.current,ue=Date.now()-Y,Z=A.clientX-me,Ce=A.clientY-ce;if(G(),ae.emit(re.INPUT_FAST_DROP,{active:!1}),p==null||p(!1),ae.emit(re.INPUT_DRAG,{direction:0}),f==null||f(0),m(null),S.current=null,A.currentTarget.releasePointerCapture(A.pointerId),!K&&!(ue>=Bs))if(q)ue<300&&Math.abs(Ce)>Math.abs(Z)&&Math.abs(Ce)>50&&(Ce<0?(ae.emit(re.INPUT_SWIPE_UP),d==null||d()):(ae.emit(re.INPUT_FAST_DROP,{active:!0}),p==null||p(!0),setTimeout(()=>{ae.emit(re.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)},150)));else{const{vx:ke,vy:be,relX:je,contentW:Te}=ee(A.clientX,A.clientY,A.currentTarget),Pe=H(ke,be);Pe.type==="BLOCK"&&Pe.cell?(ae.emit(re.INPUT_BLOCK_TAP,{x:Pe.x,y:Pe.y}),c==null||c(Pe.x,Pe.y)):je<Te/2?(ae.emit(re.INPUT_ROTATE,{clockwise:!1}),u==null||u(-1)):(ae.emit(re.INPUT_ROTATE,{clockwise:!0}),u==null||u(1))}},[G,ee,H]),J=g.useCallback(()=>{M.current&&(window.removeEventListener("touchmove",M.current.move),window.removeEventListener("touchend",M.current.end),window.removeEventListener("touchcancel",M.current.end),M.current=null)},[]),pe=g.useCallback(A=>{if(A.touches.length!==1||S.current)return;A.preventDefault();const Y=A.touches[0],q=A.currentTarget;E.current=q;const{relX:K,relY:me,vx:ce,vy:ue}=ee(Y.clientX,Y.clientY,q);if(S.current={startX:Y.clientX,startY:Y.clientY,startTime:Date.now(),isDragLocked:!1,lockedAxis:null,activePointerId:Y.identifier,actionConsumed:!1},!l){P({x:K,y:me}),j(0);const be=Date.now();T.current=window.setInterval(()=>{const Te=Date.now()-be;if(Te<Bs)return;const Pe=Te-Bs,Be=Math.min(100,Pe/k*100);j(Be),Be>=100&&(S.current&&(S.current.actionConsumed=!0),ae.emit(re.INPUT_SWAP),y==null||y(),G(),navigator.vibrate&&navigator.vibrate(50))},16)}const Z=H(ce,ue);if(Z.type==="BLOCK"&&Z.cell){const be=Z.cell.groupSize*So,je=Date.now()-Z.cell.timestamp,Te=De-1-s*(Dt-1);i?(x(Z.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(Pe=>Pe===Z.cell.goopGroupId?null:Pe),300)):o&&Z.cell.color!==o?(x(Z.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(Pe=>Pe===Z.cell.goopGroupId?null:Pe),300)):Z.cell.groupMinY<Te?(x(Z.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(Pe=>Pe===Z.cell.goopGroupId?null:Pe),300)):je<be?(x(Z.cell.goopGroupId),ae.emit(re.ACTION_REJECTED),setTimeout(()=>x(Pe=>Pe===Z.cell.goopGroupId?null:Pe),300)):m(Z.cell.goopGroupId)}const Ce=be=>{if(!S.current||be.touches.length!==1)return;be.preventDefault();const je=be.touches[0];if(je.identifier!==S.current.activePointerId)return;const{startX:Te,startY:Pe,isDragLocked:Be}=S.current,Ie=je.clientX-Te,_=je.clientY-Pe,F=Math.abs(Ie),ve=Math.abs(_);if(Be||(F>Yr||ve>Yr)&&(G(),S.current.isDragLocked=!0,m(null),F>ve?S.current.lockedAxis="H":(S.current.lockedAxis="V",_>0&&(ae.emit(re.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)))),S.current.isDragLocked){const xe=S.current.lockedAxis;xe==="H"?Ie<-Lo?(ae.emit(re.INPUT_DRAG,{direction:1}),f==null||f(1)):Ie>Lo?(ae.emit(re.INPUT_DRAG,{direction:-1}),f==null||f(-1)):(ae.emit(re.INPUT_DRAG,{direction:0}),f==null||f(0)):xe==="V"&&(_>Lo?(ae.emit(re.INPUT_FAST_DROP,{active:!0}),p==null||p(!0)):(ae.emit(re.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)))}},ke=be=>{const je=be.changedTouches[0];if(!S.current||!je||je.identifier!==S.current.activePointerId)return;const{startTime:Te,isDragLocked:Pe,actionConsumed:Be,startX:Ie,startY:_}=S.current,F=Date.now()-Te,ve=je.clientX-Ie,xe=je.clientY-_;G(),ae.emit(re.INPUT_FAST_DROP,{active:!1}),p==null||p(!1),ae.emit(re.INPUT_DRAG,{direction:0}),f==null||f(0),m(null);const _e=E.current;if(S.current=null,E.current=null,J(),!Be&&!(F>=Bs))if(!Pe&&_e){const{vx:N,vy:D,relX:B,contentW:U}=ee(je.clientX,je.clientY,_e),le=H(N,D);le.type==="BLOCK"&&le.cell?(ae.emit(re.INPUT_BLOCK_TAP,{x:le.x,y:le.y}),c==null||c(le.x,le.y)):B<U/2?(ae.emit(re.INPUT_ROTATE,{clockwise:!1}),u==null||u(-1)):(ae.emit(re.INPUT_ROTATE,{clockwise:!0}),u==null||u(1))}else Pe&&F<300&&Math.abs(xe)>Math.abs(ve)&&Math.abs(xe)>50&&(xe<0?(ae.emit(re.INPUT_SWIPE_UP),d==null||d()):(ae.emit(re.INPUT_FAST_DROP,{active:!0}),p==null||p(!0),setTimeout(()=>{ae.emit(re.INPUT_FAST_DROP,{active:!1}),p==null||p(!1)},150)))};M.current={move:Ce,end:ke},window.addEventListener("touchmove",Ce,{passive:!1}),window.addEventListener("touchend",ke),window.addEventListener("touchcancel",ke)},[ee,H,s,G,k,y,p,f,c,u,d,J,o,i,l]);g.useEffect(()=>()=>J(),[J]);const Me=g.useCallback(A=>{A.preventDefault()},[]),he=g.useCallback(A=>{A.preventDefault()},[]);return{handlers:{onPointerDown:X,onPointerMove:V,onPointerUp:te,onTouchStart:pe,onTouchMove:Me,onTouchEnd:he,onTouchCancel:he},holdState:{progress:C,position:R},highlightedGroupId:w,shakingGroupId:h,setHighlightedGroupId:m,setShakingGroupId:x}}const _0=8;function om(e,t,n,s,r,o=_0){let l="";return!r.t&&!r.l?l+=`M ${e} ${t+o} Q ${e} ${t} ${e+o} ${t} `:l+=`M ${e} ${t} `,!r.t&&!r.r?l+=`L ${e+n-o} ${t} Q ${e+n} ${t} ${e+n} ${t+o} `:l+=`L ${e+n} ${t} `,!r.b&&!r.r?l+=`L ${e+n} ${t+s-o} Q ${e+n} ${t+s} ${e+n-o} ${t+s} `:l+=`L ${e+n} ${t+s} `,!r.b&&!r.l?l+=`L ${e+o} ${t+s} Q ${e} ${t+s} ${e} ${t+s-o} `:l+=`L ${e} ${t+s} `,l+="Z",l}function Hr(e,t,n,s,r,o=_0){const l=o;let i="";if(!r.t){const c=r.l?e:e+l,u=r.r?e+n:e+n-l;i+=`M ${c} ${t} L ${u} ${t} `}if(!r.r){const c=r.t?t:t+l,u=r.b?t+s:t+s-l;i+=`M ${e+n} ${c} L ${e+n} ${u} `}if(!r.b){const c=r.l?e:e+l,u=r.r?e+n:e+n-l;i+=`M ${u} ${t+s} L ${c} ${t+s} `}if(!r.l){const c=r.t?t:t+l,u=r.b?t+s:t+s-l;i+=`M ${e} ${u} L ${e} ${c} `}return!r.t&&!r.l&&(i+=`M ${e} ${t+l} Q ${e} ${t} ${e+l} ${t} `),!r.t&&!r.r&&(i+=`M ${e+n-l} ${t} Q ${e+n} ${t} ${e+n} ${t+l} `),!r.b&&!r.r&&(i+=`M ${e+n} ${t+s-l} Q ${e+n} ${t+s} ${e+n-l} ${t+s} `),!r.b&&!r.l&&(i+=`M ${e+l} ${t+s} Q ${e} ${t+s} ${e} ${t+s-l} `),i}function rm(e,t,n){var o,l,i,c;const s=new Map;for(let u=nt;u<nt+Dt;u++)for(let f=0;f<tt;f++){const d=Xe(f+t),p=e[u][d];if(!p)continue;const y=Ct(f),k=Ct(f+1)-y;if(k<=0)continue;const w=(u-nt)*Ue,m={t:u>0&&((o=e[u-1][d])==null?void 0:o.goopGroupId)===p.goopGroupId,b:u<De-1&&((l=e[u+1][d])==null?void 0:l.goopGroupId)===p.goopGroupId,l:((i=e[u][Xe(d-1)])==null?void 0:i.goopGroupId)===p.goopGroupId,r:((c=e[u][Xe(d+1)])==null?void 0:c.goopGroupId)===p.goopGroupId};s.has(p.goopGroupId)||s.set(p.goopGroupId,[]),s.get(p.goopGroupId).push({visX:f,y:u,screenX:y,screenY:w,width:k,cell:p,color:p.color,neighbors:m})}const r=new Map;return n.forEach(u=>{r.has(u.data.goopGroupId)||r.set(u.data.goopGroupId,[]),r.get(u.data.goopGroupId).push(u)}),r.forEach((u,f)=>{const d=new Set;u.forEach(p=>d.add(`${Math.round(p.x)},${Math.round(p.y)}`)),u.forEach(p=>{if(p.y<nt-1)return;let y=p.x-t;if(y>we/2&&(y-=we),y<-we/2&&(y+=we),y>=0&&y<tt){const v=Ct(y),w=Ct(y+1)-v,m=(p.y-nt)*Ue,h=Math.round(p.x),x=Math.round(p.y),C={t:d.has(`${h},${x-1}`),r:d.has(`${Xe(h+1)},${x}`),b:d.has(`${h},${x+1}`),l:d.has(`${Xe(h-1)},${x}`)};s.has(f)||s.set(f,[]),s.get(f).push({visX:y,y:p.y,screenX:v,screenY:m,width:w,cell:p.data,color:p.data.color,neighbors:C,isFalling:!0})}})}),s}const im=e=>{switch(e){case"COOLDOWN_BOOSTER":return"CB";case"GOOP_DUMP":return"GD";case"GOOP_COLORIZER":return"GC";case"CRACK_DOWN":return"CD";default:return e.charAt(0)}},lm=e=>{switch(e){case"COOLDOWN_BOOSTER":return"#5bbc70";case"GOOP_DUMP":return"#f97316";case"GOOP_COLORIZER":return"#a855f7";case"CRACK_DOWN":return"#ef4444";default:return"#6acbda"}},am=({upgradeId:e,name:t,charge:n,isReady:s,x:r,y:o,size:l,onClick:i})=>{const[c,u]=g.useState(!1),f=g.useCallback(x=>{x.stopPropagation(),x.preventDefault(),s?i==null||i():(u(!0),setTimeout(()=>u(!1),300))},[s,i]),d=lm(e),p=im(e),y=l/2,v=2,k=n/100,w=y*2,m=k*w,h=y-m;return a.jsx("g",{transform:`translate(${r}, ${o})`,children:a.jsxs("g",{className:c?"shake-anim":"",style:{cursor:"pointer"},onPointerDown:f,children:[a.jsx("defs",{children:a.jsx("clipPath",{id:`clip-${e}`,children:a.jsx("circle",{cx:0,cy:0,r:y-v})})}),a.jsx("circle",{cx:0,cy:0,r:y-v,fill:d,fillOpacity:.25}),!s&&a.jsx("rect",{x:-(y-v),y:h,width:(y-v)*2,height:m,fill:d,fillOpacity:.75,clipPath:`url(#clip-${e})`}),s&&a.jsx("circle",{cx:0,cy:0,r:y-v,fill:d,fillOpacity:.85}),a.jsx("circle",{cx:0,cy:0,r:y-v,fill:"none",stroke:d,strokeWidth:v}),s&&a.jsx("circle",{cx:0,cy:0,r:y,fill:"none",stroke:d,strokeWidth:2,opacity:.5,className:"animate-pulse"}),a.jsx("text",{x:0,y:0,textAnchor:"middle",dominantBaseline:"central",fill:s?"white":"#e2e8f0",fontSize:l*.3,fontWeight:"bold",fontFamily:"monospace",children:p})]})})},zs=48,Ys=12,Pf=({piece:e,label:t,visible:n,rank:s=0})=>{const[r,o]=g.useState(Date.now());if(g.useEffect(()=>{if(!(e!=null&&e.isWild))return;const c=setInterval(()=>o(Date.now()),50);return()=>clearInterval(c)},[e==null?void 0:e.isWild]),!n)return null;const l=c=>{const u=Rn(s),f=400,d=.15,p=r%(u.length*f)/f,y=c*d,v=(p+y)%u.length,k=Math.floor(v),w=(k+1)%u.length,m=v-k,h=u[k],x=u[w],C=parseInt(h.slice(1,3),16),j=parseInt(h.slice(3,5),16),R=parseInt(h.slice(5,7),16),P=parseInt(x.slice(1,3),16),S=parseInt(x.slice(3,5),16),T=parseInt(x.slice(5,7),16),E=Math.round(C+(P-C)*m),M=Math.round(j+(S-j)*m),Q=Math.round(R+(T-R)*m);return`rgb(${E}, ${M}, ${Q})`};let i=null;if(e){const c=e.isWild,u=Math.min(...e.cells.map(m=>m.x)),f=Math.max(...e.cells.map(m=>m.x)),d=Math.min(...e.cells.map(m=>m.y)),p=Math.max(...e.cells.map(m=>m.y)),y=f-u+1,v=p-d+1,k=(zs-y*Ys)/2,w=(zs-v*Ys)/2;i=e.cells.map((m,h)=>{var C;const x=k+(m.x-u)*Ys;return a.jsx("rect",{x,y:w+(m.y-d)*Ys,width:Ys-1,height:Ys-1,fill:c?l(x):((C=e.cellColors)==null?void 0:C[h])??e.color,rx:2},h)})}return a.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.8)",border:"2px solid #475569",borderRadius:"6px",padding:"4px 6px",display:"flex",flexDirection:"column",alignItems:"center"},children:[a.jsx("div",{className:"t-body",style:{color:"#94a3b8",textAlign:"center",marginBottom:"2px",fontFamily:"monospace",letterSpacing:"1px"},children:t}),a.jsxs("svg",{width:zs,height:zs,style:{display:"block"},children:[a.jsx("rect",{x:0,y:0,width:zs,height:zs,fill:"rgba(30, 41, 59, 0.5)",rx:4}),i]})]})};function cm(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Ui(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=cm(r,o,l,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function um(e){return Ui(e.map(t=>t.pos))}function Rf(e){if(!e.loopStarts||e.loopStarts.length<=1)return um(e.vertices);let t="";for(let n=0;n<e.loopStarts.length;n++){const s=e.loopStarts[n],r=n+1<e.loopStarts.length?e.loopStarts[n+1]:e.vertices.length,o=e.vertices.slice(s,r);o.length>=3&&(t+=Ui(o.map(l=>l.pos))+" ")}return t.trim()}function jf(e){let t=1/0,n=-1/0,s=1/0,r=-1/0;for(const o of e)o.x<t&&(t=o.x),o.x>n&&(n=o.x),o.y<s&&(s=o.y),o.y>r&&(r=o.y);return{minX:t,maxX:n,minY:s,maxY:r}}function Tf(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-l.x,y=d.y-l.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?100:i}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-l.x,f=i.y-l.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<1e-4||v<1e-4){r.push({...i});continue}const k=-f/y,w=u/y,m=-p/v,h=d/v;let x=k+m,C=w+h;const j=Math.sqrt(x*x+C*C);j<1e-4?(x=k,C=w):(x/=j,C/=j);const R=k*x+w*C,P=R>.1?1/R:1,S=s[o]*.4,T=Math.min(t,S)*Math.min(P,2);r.push({x:i.x+x*T,y:i.y+C*T})}return r}function fm(e,t){if(!e.loopStarts||e.loopStarts.length<=1){const r=e.vertices.map(l=>l.pos),o=Tf(r,t);return{path:Ui(o),bounds:jf(o)}}let n="",s=[];for(let r=0;r<e.loopStarts.length;r++){const o=e.loopStarts[r],l=r+1<e.loopStarts.length?e.loopStarts[r+1]:e.vertices.length,i=e.vertices.slice(o,l);if(i.length>=3){const c=i.map(f=>f.pos),u=Tf(c,t);n+=Ui(u)+" ",s=s.concat(u)}}return{path:n.trim(),bounds:jf(s)}}function Mf(e,t){const n=t.x-e.x,s=t.y-e.y;return Math.sqrt(n*n+s*s)}function bf(e,t){const n=t*Math.PI/180,s=Math.cos(n),r=Math.sin(n);return{x:e.x*s-e.y*r,y:e.x*r+e.y*s}}const Wi={damping:.98,stiffness:10,pressure:20,iterations:3,homeStiffness:.35,innerHomeStiffness:.64,returnSpeed:.8,viscosity:.7,gravity:10,fallingHomeStiffness:.35,fallingReturnSpeed:.8,fallingViscosity:.7,fallingGravity:10,attractionRadius:30,attractionRestLength:1,attractionStiffness:.037,goopiness:36,tendrilEndRadius:1,tendrilSkinniness:.2,wallThickness:8,fallingGoopiness:36,fallingTendrilEndRadius:1,fallingTendrilSkinniness:.2,dropletCount:30,dropletSpeed:60,dropletLifetime:3,dropletSize:9,dropletGravity:180},Et=30,jn={x:-(tt/2)*Et,y:0},Ho=we*Et;function dm(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function pm(e){if(e.length===0)return[];const t=new Map;for(const l of e){const i=`${l.x1},${l.y1}`,c=`${l.x2},${l.y2}`;t.has(i)||t.set(i,[]),t.has(c)||t.set(c,[]),t.get(i).push(l),t.get(c).push(l)}const n=(l,i)=>{const c=i.x===l.x1&&i.y===l.y1?l.x2:l.x1,u=i.x===l.x1&&i.y===l.y1?l.y2:l.y1;return Math.atan2(u-i.y,c-i.x)},s=(l,i)=>{let c=i-l;for(;c>Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;return c},r=new Set,o=[];for(;r.size<e.length;){const l=e.find(y=>!r.has(y));if(!l)break;const i=[];let c=l,u={x:c.x1,y:c.y1};const f={x:u.x,y:u.y};let d=n(c,u)+Math.PI,p=!0;for(;;){r.add(c),i.push({x:u.x,y:u.y});const y=u.x===c.x1&&u.y===c.y1?{x:c.x2,y:c.y2}:{x:c.x1,y:c.y1};if(!p&&y.x===f.x&&y.y===f.y)break;p=!1,d=Math.atan2(y.y-u.y,y.x-u.x)+Math.PI;const k=`${y.x},${y.y}`,m=(t.get(k)||[]).filter(C=>!r.has(C));if(m.length===0)break;let h=m[0],x=-1/0;for(const C of m){const j=n(C,y),R=s(d,j);R>x&&(x=R,h=C)}c=h,u=y}i.length>=3&&o.push(i)}return o}function hm(e){return e.map(t=>({x:jn.x+t.x*Et,y:jn.y+t.y*Et}))}function Af(e){let t=0,n=0;for(const s of e){const r=jn.x+(s.x+.5)*Et,o=jn.y+(s.y+.5)*Et;t+=r,n+=o}return{x:t/e.length,y:n/e.length}}function xm(e,t,n,s,r=0){const o=dm(e),i=pm(o).map(S=>hm(S)),c=S=>{let T=0;for(let E=0;E<S.length;E++){const M=(E+1)%S.length;T+=S[E].x*S[M].y-S[M].x*S[E].y}return T/2};i.sort((S,T)=>Math.abs(c(T))-Math.abs(c(S)));const u=i.map((S,T)=>{const E=c(S);return T===0?E>0?S:[...S].reverse():E<0?S:[...S].reverse()});let f=[];const d=[];for(const S of u)d.push(f.length),f=f.concat(S);if(f.length<3){const S=Af(e),T=Et*.4;f=[{x:S.x-T,y:S.y-T},{x:S.x+T,y:S.y-T},{x:S.x+T,y:S.y+T},{x:S.x-T,y:S.y+T}],d.length=0,d.push(0)}const p=Af(e),y=p.x,v=p.y,k=f.map(S=>({pos:{x:S.x,y:S.y},oldPos:{x:S.x,y:S.y},homeOffset:{x:S.x-y,y:S.y-v},mass:1,attractionRadius:.8+Math.random()*.4})),w=k.length,m=[];for(let S=0;S<d.length;S++){const T=d[S],E=S+1<d.length?d[S+1]:w;for(let M=T;M<E;M++){const Q=M+1<E?M+1:T;m.push({a:M,b:Q,restLength:Mf(k[M].pos,k[Q].pos)})}}const h=new Set;for(const S of m)h.add(`${Math.min(S.a,S.b)}-${Math.max(S.a,S.b)}`);const x=[],C=Et*1.5,j=new Set;for(let S=0;S<w;S++)for(let T=S+1;T<w;T++){const E=`${S}-${T}`;if(h.has(E))continue;const M=Mf(k[S].pos,k[T].pos);M<C&&(j.has(E)||(j.add(E),x.push({a:S,b:T,restLength:M})))}let R=0;for(let S=0;S<d.length;S++){const T=d[S],E=S+1<d.length?d[S+1]:f.length;let M=0;for(let Q=T;Q<E;Q++){const ne=Q+1<E?Q+1:T;M+=f[Q].x*f[ne].y-f[ne].x*f[Q].y}R+=M}return R=Math.abs(R)/2,{id:n,color:t,vertices:k,innerVertices:[{pos:{x:y,y:v},oldPos:{x:y,y:v},homeOffset:{x:0,y:0},mass:1,attractionRadius:1}],loopStarts:d,ringsprings:m,crossSprings:x,restArea:R,gridCells:e.map(S=>({x:S.x,y:S.y})),isColliding:!1,isLocked:s,isFalling:!s,isLoose:!1,looseTime:0,fillAmount:s?0:1,wasFullLastFrame:!s,rotation:0,targetX:y,targetY:v,visualOffsetY:0,createdAtRotation:r}}function Co(e,t){let n=t-e;return n>Ho/2&&(n-=Ho),n<-Ho/2&&(n+=Ho),n}function ym(e,t,n){const s=Math.min(t,.033);for(const r of e){const o=n.damping;let l=r.isLocked?n.gravity:n.fallingGravity;if(r.isLoose){r.looseTime+=s;const i=.6,c=Math.min(1,r.looseTime/i);l*=c*c*c}else r.looseTime=0;for(const i of r.vertices){const c=(i.pos.x-i.oldPos.x)*o,u=(i.pos.y-i.oldPos.y)*o;i.oldPos.x=i.pos.x,i.oldPos.y=i.pos.y,i.pos.x+=c,i.pos.y+=u+l*s*s}for(const i of r.innerVertices){const c=(i.pos.x-i.oldPos.x)*o,u=(i.pos.y-i.oldPos.y)*o;i.oldPos.x=i.pos.x,i.oldPos.y=i.pos.y,i.pos.x+=c,i.pos.y+=u+l*s*s}}}function mm(e,t){for(const n of e){const s=n.isLocked?t.returnSpeed:t.fallingReturnSpeed,r=s*s,o=n.isLocked?t.viscosity:t.fallingViscosity,l=Math.max(0,1-o),i=o>0?.03/Math.max(1,o):0,c=n.isLocked?t.homeStiffness:t.fallingHomeStiffness;for(const u of n.vertices){const f=bf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,v=p-u.pos.y,k=y*c*r,w=v*c*r;u.pos.x+=k*l,u.pos.y+=w*l,o>0&&(u.oldPos.x-=k*i,u.oldPos.y-=w*i)}for(const u of n.innerVertices){const f=bf(u.homeOffset,n.rotation),d=n.targetX+f.x,p=n.targetY+f.y,y=d-u.pos.x,v=p-u.pos.y,k=y*t.innerHomeStiffness*r,w=v*t.innerHomeStiffness*r;u.pos.x+=k*l,u.pos.y+=w*l,o>0&&(u.oldPos.x-=k*i,u.oldPos.y-=w*i)}}}function Ef(e,t,n){const s=e[t.a],r=e[t.b],o=Co(s.pos.x,r.pos.x),l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)return;const u=(i-t.restLength)/i*n*.5;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}function gm(e,t){for(let n=0;n<t.iterations;n++)for(const s of e){for(const r of s.ringsprings)Ef(s.vertices,r,t.stiffness*.01);for(const r of s.crossSprings)Ef(s.vertices,r,t.stiffness*.005)}}function vm(e,t){for(const n of e){if(!n.isLocked)continue;const s=n.targetX,r=n.targetY,o=t.pressure*.002;for(const l of n.vertices){const i=l.pos.x-s,c=l.pos.y-r,u=Math.sqrt(i*i+c*c),f=Math.sqrt(l.homeOffset.x*l.homeOffset.x+l.homeOffset.y*l.homeOffset.y);if(u>1e-4&&f>1e-4){const p=(f-u)*o;l.pos.x+=i/u*p,l.pos.y+=c/u*p}}}}function Sm(e,t){for(const r of e){for(const o of r.vertices){if(o.pos.y<t.minY+2){o.pos.y=t.minY+2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}if(o.pos.y>t.maxY-2){o.pos.y=t.maxY-2;const l=o.pos.y-o.oldPos.y;o.oldPos.y=o.pos.y-l*.3}}for(const o of r.innerVertices)o.pos.y<t.minY+2&&(o.pos.y=t.minY+2),o.pos.y>t.maxY-2&&(o.pos.y=t.maxY-2)}}function Cm(e,t,n,s){ym(e,t,n),mm(e,n),gm(e,n),vm(e,n),Sm(e,s)}function km(e,t){const n=e.vertices,s=n.length;for(let r=0;r<s;r++){const o=n[(r-1+s)%s],l=n[r],i=n[(r+1)%s],c=l.pos.x-o.pos.x,u=l.pos.y-o.pos.y,f=i.pos.x-l.pos.x,d=i.pos.y-l.pos.y,p=Math.sqrt(c*c+u*u),y=Math.sqrt(f*f+d*d);if(p<1e-4||y<1e-4)continue;const v=u/p,k=-c/p,w=d/y,m=-f/y;let h=v+w,x=k+m;const C=Math.sqrt(h*h+x*x);C<1e-4||(h/=C,x/=C,n[r].oldPos.x-=h*t,n[r].oldPos.y-=x*t)}}function wm(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i||l.color!==i.color)continue;const c=l.vertices[o.vertexA],u=i.vertices[o.vertexB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertexA}-${o.blobB}-${o.vertexB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];if(i.color!==c.color)continue;const u=Co(c.targetX,i.targetX),f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++){const y=i.vertices[p],v=n.attractionRadius*y.attractionRadius;for(let k=0;k<c.vertices.length;k++){const w=c.vertices[k],m=n.attractionRadius*w.attractionRadius,h=(v+m)/2,x=Co(y.pos.x,w.pos.x),C=w.pos.y-y.pos.y,j=Math.sqrt(x*x+C*C),R=`${o}-${p}-${l}-${k}`;r.has(R)||j>h||(s.push({blobA:o,blobB:l,vertexA:p,vertexB:k,restLength:n.attractionRestLength}),r.add(R))}}}return s}function Pm(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i)continue;const c=l.vertices[o.vertexA],u=i.vertices[o.vertexB];if(!c||!u)continue;const f=Co(c.pos.x,u.pos.x),d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=Math.max(0,Math.min(1,1-p/n.goopiness)),v=s+y*(r-s),w=(p-o.restLength)*v,m=f/p*w,h=d/p*w;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function Rm(e,t=30){for(let o=0;o<3;o++)for(let l=0;l<e.length;l++)for(let i=l+1;i<e.length;i++){const c=e[l],u=e[i];if(c.color===u.color)continue;const f=c.isFalling||c.isLoose,d=u.isFalling||u.isLoose;if(!f&&!d)continue;const p=c.targetX-u.targetX,y=c.targetY-u.targetY;if(!(Math.sqrt(p*p+y*y)>t*4))for(const k of c.vertices)for(const w of u.vertices){const m=w.pos.x-k.pos.x,h=w.pos.y-k.pos.y,x=Math.sqrt(m*m+h*h);if(x<2.5&&x>.01){const C=2.5-x,j=m/x,R=h/x,P=C*.8;k.pos.x-=j*P*.5,k.pos.y-=R*P*.5,w.pos.x+=j*P*.5,w.pos.y+=R*P*.5,k.oldPos.x-=j*P*.3,k.oldPos.y-=R*P*.3,w.oldPos.x+=j*P*.3,w.oldPos.y+=R*P*.3}}}}function jm(e,t,n,s,r,o=0){var d;if(e.isLocked||e.isLoose)return;let l=!0;for(const p of e.gridCells){const y=p.y+1;if(y>=r){l=!1;break}const v=Math.floor(y)+nt;let k=Math.floor(p.x)+o;for(;k<0;)k+=we;for(;k>=we;)k-=we;const w=(d=s[v])==null?void 0:d[k];if(w&&w.goopGroupId!==void 0){l=!1;break}}if(e.isColliding=!l,l){const p=n*t;for(e.visualOffsetY+=p;e.visualOffsetY>=Et;){for(const y of e.gridCells)y.y+=1;e.visualOffsetY-=Et}}let i=0,c=0;for(const p of e.gridCells)i+=p.x,c+=p.y;const u=i/e.gridCells.length,f=c/e.gridCells.length;e.targetX=jn.x+(u+.5)*Et,e.targetY=jn.y+(f+.5)*Et+e.visualOffsetY}function Yl(e){if(e.vertices.length<3)return[0];const t=e.vertices.map(c=>c.pos.x),n=Math.min(...t),s=Math.max(...t),r=-180,o=180,l=[],i=Ho;for(const c of[0,i,-i]){const u=n+c;s+c>=r&&u<=o&&l.push(c)}return l.length>1&&console.log(`Blob ${e.id} straddles seam, rendering at offsets:`,l,`(X range: ${n.toFixed(0)} to ${s.toFixed(0)})`),l.length>0?l:[0]}const Tm=({state:e,rank:t,maxTime:n,lightsBrightness:s=100,laserCharge:r=100,controlsHeat:o=0,complicationCooldowns:l,equippedActives:i=[],activeCharges:c={},onActivateAbility:u,powerUps:f,storedGoop:d,nextGoop:p,softBodyPhysics:y,normalGoopOpacity:v=1,showVertexDebug:k=!1,gooStdDev:w=8,gooAlphaMul:m=24,gooAlphaOff:h=-13,fallingGooStdDev:x,fallingGooAlphaMul:C,fallingGooAlphaOff:j,trainingHighlightColor:R,disableSwap:P,disablePop:S})=>{const{grid:T,tankRotation:E,activeGoop:M,looseGoop:Q,floatingTexts:ne,shiftTime:ie,goalMarks:L,crackCells:ee,dumpPieces:H}=e,G=g.useMemo(()=>Rn(t),[t]),X=g.useMemo(()=>ie<=0?1:Math.max(0,1-ie/n),[ie,n]),te=`hsla(${Math.max(0,120*(1-X))}, 100%, 50%, 0.15)`,J=1+X*(Dt-1),{x:pe,y:Me,w:he,h:A}=Hs,Y=J*Ue,q=A-Y,{handlers:K,holdState:me,highlightedGroupId:ce,shakingGroupId:ue}=sm({callbacks:{},tankRotation:E,grid:T,tankPressure:X,powerUps:f,trainingHighlightColor:R,disableSwap:P,disablePop:S}),[Z,Ce]=g.useState(-1),[ke,be]=g.useState(0);g.useEffect(()=>ae.on(re.INPUT_SWAP_HOLD,D=>{Ce((D==null?void 0:D.progress)??-1)}),[]),g.useEffect(()=>{var I,O;if(!y)return;const N=new Set;for(let $=nt;$<De;$++)for(let z=0;z<we;z++){const W=(I=T[$])==null?void 0:I[z];W!=null&&W.goopGroupId&&N.add(W.goopGroupId)}const D=new Map;for(let $=0;$<Dt;$++){const z=$+nt;for(let W=0;W<tt;W++){const ge=(E+W)%we,Re=(O=T[z])==null?void 0:O[ge];if(Re!=null&&Re.goopGroupId){const se=Re.goopGroupId;D.has(se)||D.set(se,{cells:[],color:Re.color}),D.get(se).cells.push({x:W,y:$})}}}const B=new Set(y.blobs.map($=>$.id));let U=!1;for(const[$,z]of D)B.has($)||(y.createBlob(z.cells,z.color,$,!0,E),U=!0);y.shiftBlobsForRotation(E);const le=new Map;for(const $ of Q){const z=$.data.goopGroupId;le.has(z)||le.set(z,{avgY:0,cells:[]}),le.get(z).cells.push({x:$.x,y:$.y})}for(const[$,z]of le){const W=z.cells.reduce((ge,Re)=>ge+Re.y,0)/z.cells.length;z.avgY=W}for(const $ of y.blobs){const z=le.get($.id);if(z){$.isLoose=!0,$.isLocked=!1;const W=(z.avgY-nt)*Et;$.targetY=W}else $.isLoose&&($.isLoose=!1,$.isLocked=!0,$.fillAmount=0)}const b=new Set(Q.map($=>$.data.goopGroupId));for(const $ of y.blobs)$.id.startsWith("active-")||!N.has($.id)&&!b.has($.id)&&(e.poppedGoopGroupIds.has($.id)&&(y.createDropletsForPop($),e.poppedGoopGroupIds.delete($.id)),y.removeBlob($.id),U=!0);U&&be($=>$+1)},[T,E,y]);const je=g.useRef(null);g.useEffect(()=>{var B;if(!y||!M||M.state!==Bn.FALLING)return;const N=`active-${M.spawnTimestamp}`;if(!y.getBlob(N)){const U=M.cells.map(O=>({x:O.x,y:O.y}));let le=M.x-E;le>we/2&&(le-=we),le<-we/2&&(le+=we);const b=U.map(O=>({x:le+O.x,y:M.y+O.y-nt})),I=((B=M.definition.cellColors)==null?void 0:B[0])??M.definition.color;y.createBlob(b,I,N,!1,E),be(O=>O+1)}},[M==null?void 0:M.spawnTimestamp,y,E]);const Te=g.useRef(null),Pe=g.useRef(0),Be=g.useRef(new Set);g.useEffect(()=>{const N=new Set;L.forEach(D=>{let B=D.x-E;B>we/2&&(B-=we),B<-we/2&&(B+=we),(B<0||B>=tt)&&N.add(D.id)}),N.forEach(D=>{if(!Be.current.has(D)){const B=L.find(U=>U.id===D);if(B){let U=B.x-E;U>we/2&&(U-=we),U<-we/2&&(U+=we);const le=U>=tt?"right":"left";ae.emit(re.CRACK_OFFSCREEN,{goalId:D,direction:le})}}}),Be.current=N},[L,E]),g.useEffect(()=>{if(!y||!M||M.state!==Bn.FALLING)return;const N=`active-${M.spawnTimestamp}`,D=y.getBlob(N);if(!D)return;let B=M.x-E;B>we/2&&(B-=we),B<-we/2&&(B+=we);const U=M.rotation,le=Te.current!==null&&Te.current!==U,b=Pe.current!==E;if(le){let I=D.gridCells.length>0?D.gridCells[0].y:0;for(const z of D.gridCells)z.y<I&&(I=z.y);let O=M.cells.length>0?M.cells[0].y:0;for(const z of M.cells)z.y<O&&(O=z.y);const $=M.cells.map(z=>({x:B+z.x,y:I+(z.y-O)}));D.gridCells=$,D.rotation=U*90}if(b||le){for(let z=0;z<D.gridCells.length&&z<M.cells.length;z++)D.gridCells[z].x=B+M.cells[z].x;let I=0;for(const z of D.gridCells)I+=z.x;const O=I/D.gridCells.length,$=jn.x+(O+.5)*Et;if(b){const z=$-D.targetX;for(const W of D.vertices)W.pos.x+=z,W.oldPos.x+=z;for(const W of D.innerVertices)W.pos.x+=z,W.oldPos.x+=z}D.targetX=$}Te.current=U,Pe.current=E},[M==null?void 0:M.x,M==null?void 0:M.rotation,M==null?void 0:M.state,y,E]),g.useEffect(()=>{if(!y)return;const N=je.current,D=M;if(N&&N.state===Bn.FALLING&&(!D||D.spawnTimestamp!==N.spawnTimestamp)){const B=`active-${N.spawnTimestamp}`;y.removeBlob(B),be(U=>U+1)}je.current=D},[M,y]);const Ie=Date.now(),_=g.useMemo(()=>rm(T,E,Q),[T,E,Q]),F=g.useCallback(N=>{if(G.length===0)return"#a855f7";const D=400,B=.02,U=Ie%(G.length*D)/D,le=Math.abs(N)*B;let b=(U+le)%G.length;b<0&&(b+=G.length);const I=Math.floor(b),O=(I+1)%G.length,$=b-I,z=G[I],W=G[O];if(!z||!W)return"#a855f7";const ge=parseInt(z.slice(1,3),16),Re=parseInt(z.slice(3,5),16),se=parseInt(z.slice(5,7),16),ye=parseInt(W.slice(1,3),16),Ne=parseInt(W.slice(3,5),16),Fe=parseInt(W.slice(5,7),16),ze=Math.round(ge+(ye-ge)*$),We=Math.round(Re+(Ne-Re)*$),Qe=Math.round(se+(Fe-se)*$);return`rgb(${ze}, ${We}, ${Qe})`},[Ie,G]),ve=g.useMemo(()=>Sn?null:a.jsx("defs",{children:Array.from(_.entries()).map(([N,D])=>a.jsx("mask",{id:`mask-${N}`,children:D.map((B,U)=>a.jsx("path",{d:om(B.screenX,B.screenY,B.width,Ue,B.neighbors),fill:"white",stroke:"white",strokeWidth:"1.5"},B.cell.id+"-"+U))},`mask-${N}`))}),[_]);g.useMemo(()=>new Set(L.map(N=>N.color)),[L]);const xe=((f==null?void 0:f.GOOP_HOLD_VIEWER)||0)>=1,_e=((f==null?void 0:f.GOOP_WINDOW)||0)>=1;return a.jsxs("div",{className:"w-full h-full bg-slate-950 relative shadow-2xl border-x-4 border-slate-900 overflow-hidden select-none touch-none",style:{touchAction:"manipulation",contain:"strict"},onPointerDown:K.onPointerDown,onPointerMove:K.onPointerMove,onPointerUp:K.onPointerUp,onPointerLeave:K.onPointerUp,onTouchStart:K.onTouchStart,onTouchMove:K.onTouchMove,onTouchEnd:K.onTouchEnd,onTouchCancel:K.onTouchCancel,children:[!Sn&&a.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 opacity-10 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] hidden md:block",style:{backgroundSize:"100% 2px, 3px 100%"}}),a.jsxs("svg",{width:"100%",height:"100%",viewBox:`${pe} ${Me} ${he} ${A}`,preserveAspectRatio:"xMidYMin meet",className:"touch-none",style:{pointerEvents:"none",willChange:"transform",filter:s<100?`brightness(${s/100}) grayscale(${Math.max(0,(50-s)/50)})`:s>100?`brightness(${s/100})`:void 0,transition:"filter 0.05s linear"},children:[ve,a.jsxs("defs",{children:[a.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:w,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${m} ${h}`,result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),a.jsxs("filter",{id:"goo-filter-falling",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:x??w,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${C??m} ${j??h}`,result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]}),a.jsx("clipPath",{id:"tank-viewport-clip",children:a.jsx("rect",{x:Hs.x,y:Hs.y,width:Hs.w,height:Hs.h})})]}),a.jsx("rect",{x:pe,y:q,width:he,height:Y,fill:te}),a.jsx("line",{x1:pe,y1:q,x2:pe+he,y2:q,stroke:te.replace("0.15","0.6"),strokeWidth:"2",strokeDasharray:"4 4"}),!Sn&&Array.from({length:Dt}).map((N,D)=>{const B=D*Ue;return Array.from({length:tt}).map((U,le)=>{const b=Ct(le),I=Ct(le+1)-b;return a.jsxs("g",{children:[a.jsx("line",{x1:b,y1:B,x2:b+I,y2:B,stroke:Ke.GRID_EMPTY,strokeWidth:"1",opacity:.2}),a.jsx("line",{x1:b,y1:B,x2:b,y2:B+Ue,stroke:Ke.GRID_EMPTY,strokeWidth:"1",opacity:.2})]},`bg-${D}-${le}`)})}),ee&&ee.filter(N=>Ie-N.spawnTime>=500).map(N=>N.branchCrackIds.map(D=>{const B=ee.find(se=>se.id===D);if(!B||Ie-B.spawnTime<500)return null;let U=N.x-E;U>we/2&&(U-=we),U<-we/2&&(U+=we);let le=B.x-E;if(le>we/2&&(le-=we),le<-we/2&&(le+=we),U<-1||U>tt||le<-1||le>tt)return null;const b=Ct(U),I=Ct(U+1)-b,O=b+I/2,$=(N.y-nt)*Ue+Ue/2,z=Ct(le),W=Ct(le+1)-z,ge=z+W/2,Re=(B.y-nt)*Ue+Ue/2;return a.jsx("line",{x1:O,y1:$,x2:ge,y2:Re,stroke:N.color,strokeWidth:"2",strokeOpacity:.7},`crack-line-${N.id}-${D}`)})),ee&&ee.filter(N=>Ie-N.spawnTime>=500).map(N=>{let D=N.x-E;if(D>we/2&&(D-=we),D<-we/2&&(D+=we),D>=0&&D<tt){const B=Ct(D),U=Ct(D+1)-B,le=(N.y-nt)*Ue,b=B+U/2,I=le+Ue/2;return a.jsx("circle",{cx:b,cy:I,r:Ue/4,fill:N.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`crack-${N.id}`)}return null}),L.filter(N=>Ie-N.spawnTime>=500&&!N.plugged).map(N=>{let D=N.x-E;if(D>we/2&&(D-=we),D<-we/2&&(D+=we),D>=0&&D<tt){const B=Ct(D),U=Ct(D+1)-B,le=(N.y-nt)*Ue,b=B+U/2,I=le+Ue/2;return a.jsx("circle",{cx:b,cy:I,r:Ue/4,fill:N.color,stroke:"white",strokeWidth:"1",strokeOpacity:.5},`goal-${N.id}`)}return null}),L.map(N=>{let D=N.x-E;if(D>we/2&&(D-=we),D<-we/2&&(D+=we),D<0||D>=tt){const B=D>=tt,U=(N.y-nt)*Ue+Ue/2,le=B?pe+he-5:pe+5;return a.jsx("g",{opacity:.7,children:a.jsx("path",{d:B?`M ${le} ${U-10} L ${le+10} ${U} L ${le} ${U+10} Z`:`M ${le} ${U-10} L ${le-10} ${U} L ${le} ${U+10} Z`,fill:N.color,stroke:"white",strokeWidth:"1"})},`off-${N.id}`)}return null}),a.jsx("g",{opacity:v,children:Array.from(_.entries()).map(([N,D])=>{if(D.length===0)return null;const U=D[0].color,le=N===ce,b=N===ue||e.prePoppedGoopGroups.has(N),I=D.some(ye=>ye.cell.isSealingGoop),O=e.prePoppedGoopGroups.has(N),$=D.some(ye=>ye.cell.isWild);let z=1/0,W=1/0,ge=-1/0,Re=-1/0;D.forEach(ye=>{z=Math.min(z,ye.screenX),W=Math.min(W,ye.screenY),ge=Math.max(ge,ye.screenX+ye.width),Re=Math.max(Re,ye.screenY+Ue)});const se=$?F(z):U;if(Sn){const ye=D[0].cell.groupSize*So,Ne=Ie-D[0].cell.timestamp,Fe=Math.min(1,Ne/ye),ze=Fe>=1,We=Re-W,Qe=Re-Fe*We;return a.jsxs("g",{className:b?"shake-anim":"",children:[D.map($e=>a.jsx("rect",{x:$e.screenX-.5,y:$e.screenY,width:$e.width+1,height:Ue,fill:$e.cell.isWild?F($e.screenX):U,fillOpacity:.25},`bg-${$e.cell.id}`)),!ze&&D.map($e=>{const fe=$e.screenY+Ue,Je=$e.screenY;if(fe<=Qe)return null;const rt=Math.max(Je,Qe),ct=fe-rt;return a.jsx("rect",{x:$e.screenX-.5,y:rt,width:$e.width+1,height:ct,fill:$e.cell.isWild?F($e.screenX):U,fillOpacity:.75},`fill-${$e.cell.id}`)}),ze&&D.map($e=>a.jsx("rect",{x:$e.screenX-.5,y:$e.screenY,width:$e.width+1,height:Ue,fill:$e.cell.isWild?F($e.screenX):U,fillOpacity:.85},`full-${$e.cell.id}`)),D.map($e=>a.jsx("path",{d:Hr($e.screenX,$e.screenY,$e.width,Ue,$e.neighbors),fill:"none",stroke:O?"#ff6b6b":I?"white":$e.cell.isWild?F($e.screenX):U,strokeWidth:O||I?3:2,strokeDasharray:O?"4 2":void 0,className:$e.cell.isWild&&!O&&!I?"wild-stroke":void 0},`cnt-${$e.cell.id}`)),le&&a.jsx("rect",{x:z,y:W,width:ge-z,height:Re-W,fill:"white",fillOpacity:.3})]},`group-${N}`)}return a.jsxs("g",{className:b?"shake-anim":"",children:[a.jsx("rect",{x:z,y:W,width:ge-z,height:Re-W,fill:se,fillOpacity:.2,mask:`url(#mask-${N})`}),a.jsx("g",{opacity:.9,mask:`url(#mask-${N})`,children:D.map((ye,Ne)=>{const Fe=ye.cell.isWild?F(ye.screenX):U;if(!ye.cell||ye.isFalling)return a.jsx("rect",{x:ye.screenX-.5,y:ye.screenY,width:ye.width+1,height:Ue,fill:Fe},`liq-${ye.cell.id}`);const ze=ye.cell.groupSize*So,We=ye.cell.groupMaxY-ye.cell.groupMinY+1,Qe=ze/Math.max(1,We),fe=(ye.cell.groupMaxY-ye.y)*Qe,Je=Ie-ye.cell.timestamp-fe;let rt=Je>=Qe?Ue:Je>0?Je/Qe*Ue:0;return a.jsx("rect",{x:ye.screenX-.5,y:ye.screenY+(Ue-rt),width:ye.width+1,height:rt,fill:Fe},`liq-${ye.cell.id}`)})}),le&&a.jsx("rect",{x:z,y:W,width:ge-z,height:Re-W,fill:"white",fillOpacity:.3,mask:`url(#mask-${N})`}),D.map((ye,Ne)=>a.jsx("path",{d:Hr(ye.screenX,ye.screenY,ye.width,Ue,ye.neighbors),fill:"none",stroke:O?"#ff6b6b":I?"white":ye.cell.isWild?F(ye.screenX):U,strokeWidth:O||I?"3":"2",strokeDasharray:O?"4 2":void 0,className:!Sn&&!O?ye.cell.isWild?"wild-stroke":I?"super-glowing-stroke":"glow-stroke":void 0,style:!Sn&&!O&&!ye.cell.isWild?{color:I?"white":U}:void 0},`cnt-${ye.cell.id}`))]},`group-${N}`)})}),y&&y.blobs.length>0&&(()=>{const N=new Map;for(const U of y.blobs){if(U.isFalling)continue;const le=N.get(U.color)||[];le.push(U),N.set(U.color,le)}const D=y.attractionSprings,B=y.params;return a.jsx(a.Fragment,{children:Array.from(N.entries()).map(([U,le])=>{const b=R!=null&&U===R;return a.jsxs("g",{className:b?"training-pulse":void 0,children:[a.jsxs("g",{filter:"url(#goo-filter)",clipPath:"url(#tank-viewport-clip)",children:[D.map((I,O)=>{const $=y.blobs[I.blobA],z=y.blobs[I.blobB];if(!$||!z||$.color!==U)return null;const W=$.vertices[I.vertexA],ge=z.vertices[I.vertexB];if(!W||!ge)return null;const Re=Co(W.pos.x,ge.pos.x),se=ge.pos.y-W.pos.y,ye=Math.sqrt(Re*Re+se*se),Ne=Math.min(1,ye/B.goopiness),Fe=B.tendrilEndRadius;if(Fe<1)return null;const ze=1-B.tendrilSkinniness,We=1-B.tendrilSkinniness*.3,Qe=We-(We-ze)*Ne,$e=Fe*Qe,fe=Fe*1.4,Je=Math.max(2,Math.ceil(ye/fe)),rt=[];for(let ct=0;ct<=Je;ct++){const Ft=ct/Je,oe=Math.sin(Ft*Math.PI),de=Fe-(Fe-$e)*oe;rt.push({cx:W.pos.x+Re*Ft,cy:W.pos.y+se*Ft,r:Math.max(2,de)})}return a.jsx("g",{children:rt.map((ct,Ft)=>a.jsx("circle",{cx:ct.cx,cy:ct.cy,r:ct.r,fill:$.color},Ft))},`tendril-${O}`)}),le.map(I=>{const O=I.id===ue||e.prePoppedGoopGroups.has(I.id),$=Rf(I),W=Yl(I).map(ge=>ge===0?"":`translate(${ge}, 0)`);return a.jsx("g",{className:O?"shake-anim":void 0,children:W.map((ge,Re)=>a.jsx("path",{d:$,fill:I.color,fillRule:"evenodd",transform:ge},`soft-${I.id}-${Re}`))},`soft-${I.id}`)})]}),a.jsx("g",{clipPath:"url(#tank-viewport-clip)",children:le.map(I=>{if(!I.isLocked||I.fillAmount>=1)return null;const O=I.id===ue||e.prePoppedGoopGroups.has(I.id),$=B.wallThickness,{path:z,bounds:W}=fm(I,$),ge=W.maxY-W.minY,Re=W.maxY-ge*I.fillAmount,se=`fill-clip-${I.id}`,ye=50,Fe=Yl(I).map(ze=>ze===0?"":`translate(${ze}, 0)`);return a.jsx("g",{className:O?"shake-anim":void 0,children:Fe.map((ze,We)=>a.jsxs("g",{transform:ze,children:[a.jsx("defs",{children:a.jsx("clipPath",{id:`${se}-${We}`,children:a.jsx("rect",{x:W.minX-ye,y:W.minY-ye,width:W.maxX-W.minX+ye*2,height:Re-W.minY+ye})})}),a.jsx("path",{d:z,fill:"#1e293b",fillRule:"evenodd",clipPath:`url(#${se}-${We})`})]},`cutout-${I.id}-${We}`))},`cutout-${I.id}`)})})]},`color-group-${U}`)})})})(),y&&(()=>{const N=y.blobs.filter(U=>U.isFalling&&!U.isLocked);if(N.length===0)return null;const D=y.attractionSprings,B=y.params;return a.jsxs("g",{filter:"url(#goo-filter-falling)",clipPath:"url(#tank-viewport-clip)",children:[D.map((U,le)=>{const b=y.blobs[U.blobA],I=y.blobs[U.blobB];if(!b||!I||!b.isFalling&&!I.isFalling)return null;const O=b.vertices[U.vertexA],$=I.vertices[U.vertexB];if(!O||!$)return null;const z=Co(O.pos.x,$.pos.x),W=$.pos.y-O.pos.y,ge=Math.sqrt(z*z+W*W),Re=Math.min(1,ge/B.fallingGoopiness),se=B.fallingTendrilEndRadius;if(se<1)return null;const ye=1-B.fallingTendrilSkinniness,Ne=1-B.fallingTendrilSkinniness*.3,Fe=Ne-(Ne-ye)*Re,ze=se*Fe,We=se*1.4,Qe=Math.max(2,Math.ceil(ge/We)),$e=[];for(let fe=0;fe<=Qe;fe++){const Je=fe/Qe,rt=Math.sin(Je*Math.PI),ct=se-(se-ze)*rt;$e.push({cx:O.pos.x+z*Je,cy:O.pos.y+W*Je,r:Math.max(2,ct)})}return a.jsx("g",{children:$e.map((fe,Je)=>a.jsx("circle",{cx:fe.cx,cy:fe.cy,r:fe.r,fill:b.color},Je))},`falling-tendril-${le}`)}),N.map(U=>Yl(U).map((b,I)=>{const O=Rf(U);if(!O)return null;const $=b===0?void 0:`translate(${b}, 0)`,z=M==null?void 0:M.definition.isWild,W=z?F(U.targetX):U.color;return a.jsx("path",{d:O,fill:W,fillRule:"evenodd",fillOpacity:.8,transform:$,className:z?"wild-stroke wild-fill":void 0},`falling-${U.id}-${I}`)}))]})})(),y&&y.droplets.length>0&&a.jsx("g",{children:y.droplets.map(N=>a.jsx("circle",{cx:N.pos.x,cy:N.pos.y,r:N.radius,fill:N.color,opacity:N.opacity},N.id))}),k&&y&&y.blobs.length>0&&a.jsx("g",{children:y.blobs.map(N=>a.jsxs("g",{children:[a.jsx("circle",{cx:N.targetX,cy:N.targetY,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),N.vertices.map((D,B)=>{const U=N.vertices[(B+1)%N.vertices.length];return a.jsx("line",{x1:D.pos.x,y1:D.pos.y,x2:U.pos.x,y2:U.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${N.id}-${B}`)}),N.vertices.map((D,B)=>a.jsxs("g",{children:[a.jsx("circle",{cx:D.pos.x,cy:D.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),a.jsx("text",{x:D.pos.x+6,y:D.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:B})]},`v-${N.id}-${B}`)),N.innerVertices.map((D,B)=>a.jsx("circle",{cx:D.pos.x,cy:D.pos.y,r:3,fill:"gray",stroke:"white",strokeWidth:1},`iv-${N.id}-${B}`)),a.jsx("text",{x:N.targetX,y:N.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:N.isLocked?`${Math.round(N.fillAmount*100)}%`:"falling"})]},`debug-${N.id}`))}),M&&M.state===Bn.FALLING&&(()=>{const N=E0(T,M),D=M.definition.isWild;return M.cells.map((B,U)=>{var $;const le=(($=M.definition.cellColors)==null?void 0:$[U])??M.definition.color,b=Xe(M.x+B.x),I=N+B.y;if(I<nt)return null;let O=b-E;if(O>we/2&&(O-=we),O<-we/2&&(O+=we),O>=-2&&O<tt+2){const z=Ct(O),W=Ct(O+1)-z,ge=(I-nt)*Ue,Re={t:M.cells.some(se=>se.x===B.x&&se.y===B.y-1),r:M.cells.some(se=>se.x===B.x+1&&se.y===B.y),b:M.cells.some(se=>se.x===B.x&&se.y===B.y+1),l:M.cells.some(se=>se.x===B.x-1&&se.y===B.y)};return a.jsxs("g",{children:[a.jsx("rect",{x:z,y:ge,width:W,height:Ue,fill:D?F(z):le,fillOpacity:.2,rx:4,ry:4}),a.jsx("path",{d:Hr(z,ge,W,Ue,Re),fill:"none",stroke:D?F(z):le,strokeWidth:"1",strokeDasharray:"4 2",opacity:"0.75",className:D?"wild-stroke":void 0})]},`ghost-${U}`)}return null})})(),H&&H.map(N=>{let D=N.x-E;if(D>we/2&&(D-=we),D<-we/2&&(D+=we),D<-1||D>tt)return null;const B=Ct(D),U=Ct(D+1)-B,le=(N.y-nt)*Ue;return le<-Ue?null:a.jsxs("g",{children:[a.jsx("rect",{x:B,y:le,width:U,height:Ue,fill:N.color,fillOpacity:.3,rx:4,ry:4}),a.jsx("rect",{x:B,y:le,width:U,height:Ue,fill:"none",stroke:N.color,strokeWidth:"2",strokeDasharray:"4 2",rx:4,ry:4})]},`dump-${N.id}`)}),M&&M.state===Bn.FALLING&&(()=>{if(y){const B=`active-${M.spawnTimestamp}`,U=y.getBlob(B);if(U&&U.isFalling&&!U.isLocked&&U.gridCells.some(b=>b.y>=0))return null}const N=M.definition.isWild,D=M.cells.map((B,U)=>{var $;const le=(($=M.definition.cellColors)==null?void 0:$[U])??M.definition.color,b=Xe(M.x+B.x),I=M.y+B.y;let O=b-E;if(O>we/2&&(O-=we),O<-we/2&&(O+=we),O>=-2&&O<tt+2){const z=Ct(O),W=Ct(O+1)-z,ge=(I-nt)*Ue,Re={t:M.cells.some(se=>se.x===B.x&&se.y===B.y-1),r:M.cells.some(se=>se.x===B.x+1&&se.y===B.y),b:M.cells.some(se=>se.x===B.x&&se.y===B.y+1),l:M.cells.some(se=>se.x===B.x-1&&se.y===B.y)};return{screenX:z,screenY:ge,width:W,neighbors:Re,color:le}}return null}).filter(Boolean);return D.length===0?null:a.jsxs("g",{children:[a.jsx("g",{opacity:.8,children:D.map((B,U)=>a.jsx("rect",{x:B.screenX,y:B.screenY,width:B.width,height:Ue,fill:N?F(B.screenX):B.color,rx:4,ry:4},U))}),D.map((B,U)=>a.jsx("path",{d:Hr(B.screenX,B.screenY,B.width,Ue,B.neighbors),fill:"none",stroke:"white",strokeWidth:"2",className:N?"wild-stroke":void 0},`outline-${U}`))]})})(),ne.map(N=>{let D=N.x-E;if(D>we/2&&(D-=we),D<-we/2&&(D+=we),D>=-2&&D<tt+2){const B=Ct(D),U=Ct(D+1)-B,le=(N.y-nt)*Ue;return a.jsx("text",{x:B+U/2,y:le+Ue/2,fill:N.color,textAnchor:"middle",className:"floating-score",fontSize:"24",children:N.text},N.id)}return null}),e.phase===qe.TankScreen&&a.jsxs(a.Fragment,{children:[t>=1&&a.jsxs("g",{children:[l&&l[Oe.LASER]>Date.now()&&a.jsxs("text",{x:pe+8+6,y:A*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[Oe.LASER]-Date.now())/1e3),"s"]}),a.jsx(wf,{value:r,colorMode:"drain",x:pe+8,y:A*.04,height:A*.2,width:12})]}),t>=3&&a.jsxs("g",{children:[l&&l[Oe.CONTROLS]>Date.now()&&a.jsxs("text",{x:pe+he-20+6,y:A*.04-4,fill:"white",fontSize:"10",textAnchor:"middle",fontFamily:"monospace",children:[Math.ceil((l[Oe.CONTROLS]-Date.now())/1e3),"s"]}),a.jsx(wf,{value:o,colorMode:"heat",x:pe+he-20,y:A*.04,height:A*.2,width:12})]}),i.length>0&&i.map((N,D)=>{const B=Dn[N];if(!B)return null;const U=c[N]||0,le=U>=100,b=36,I=pe+he-26,O=A*.3+D*(b+8);return a.jsx(am,{upgradeId:N,name:B.name,charge:U,isReady:le,x:I,y:O,size:b,onClick:()=>le&&(u==null?void 0:u(N))},N)})]})]}),me.position&&me.progress>0&&a.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:me.position.x,top:me.position.y,transform:"translate(-50%, -50%)"},children:a.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[a.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),a.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${me.progress/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),Z>=0&&a.jsx("div",{className:"absolute z-50 pointer-events-none",style:{left:"50%",bottom:"15%",transform:"translate(-50%, 0)"},children:a.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",children:[a.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"4"}),a.jsx("circle",{cx:"30",cy:"30",r:"20",fill:"none",stroke:"white",strokeWidth:"4",strokeDasharray:`${Z/100*125.6} 125.6`,transform:"rotate(-90 30 30)",strokeLinecap:"round"})]})}),e.complications.length>0&&a.jsx("div",{className:"absolute inset-0 z-40 flex flex-col items-center justify-center pointer-events-none",style:{gap:"1.5rem"},children:[...e.complications].sort((N,D)=>N.startTime-D.startTime).map(N=>{const B={[Oe.LIGHTS]:"Lights",[Oe.CONTROLS]:"Controls",[Oe.LASER]:"Laser"}[N.type]||N.type;return a.jsxs("div",{className:"malfunction-pulse text-center",style:{textShadow:"0 0 20px rgba(239, 68, 68, 0.8), 0 0 40px rgba(239, 68, 68, 0.5)"},children:[a.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:B}),a.jsx("div",{className:"text-red-500 font-bold",style:{fontFamily:"'From Where You Are', sans-serif",fontSize:"clamp(2rem, 8vw, 4rem)",lineHeight:1.1},children:"Malfunction"}),a.jsx("div",{className:"text-red-400 mt-2",style:{fontFamily:"'Amazon Ember', sans-serif",fontSize:"clamp(0.875rem, 3vw, 1.25rem)"},children:"Fix at Console"})]},N.id)})}),e.phase===qe.TankScreen&&(xe||_e)&&a.jsxs("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",zIndex:10,display:"flex",gap:"8px"},children:[a.jsx(Pf,{piece:d??null,label:"STORED",visible:xe,rank:t}),a.jsx(Pf,{piece:p??null,label:"NEXT",visible:_e,rank:t})]})]})};var Mm={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const bm=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Am=(e,t)=>{const n=g.forwardRef(({color:s="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:l,children:i,...c},u)=>g.createElement("svg",{ref:u,...Mm,width:r,height:r,stroke:s,strokeWidth:l?Number(o)*24/Number(r):o,className:`lucide lucide-${bm(e)}`,...c},[...t.map(([f,d])=>g.createElement(f,d)),...(Array.isArray(i)?i:[i])||[]]));return n.displayName=`${e}`,n};var _t=Am;const Em=_t("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),Im=_t("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),_m=_t("ArrowUpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]),Om=_t("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),xl=_t("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),Lm=_t("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Nm=_t("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]),Dm=_t("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),iu=_t("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),$m=_t("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),Fm=_t("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Gm=_t("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),Bm=_t("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),zm=_t("Speaker",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["circle",{cx:"12",cy:"14",r:"4",key:"1jruaj"}],["line",{x1:"12",x2:"12.01",y1:"6",y2:"6",key:"16cbga"}]]),Ym=_t("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),Hm=_t("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Um=_t("Wrench",[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z",key:"cbrjhi"}]]),Wm=_t("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Xm=({state:e,maxTime:t})=>{const{shiftScore:n,gameOver:s,popStreak:r,shiftTime:o}=e,l=Math.max(0,Math.min(1,1-o/t)),i=l>.8,c=l>.9;return a.jsxs(a.Fragment,{children:[c&&!s&&a.jsx("div",{className:"absolute inset-0 z-30 pointer-events-none bg-[radial-gradient(circle_at_center,transparent_40%,rgba(100,0,0,0.4)_100%)] animate-pulse"}),a.jsxs("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 px-1 pt-4 pointer-events-none z-50 flex justify-between items-start",style:{width:"min(100%, 100dvh * 0.75)"},children:[a.jsxs("div",{className:"flex flex-col items-start drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[a.jsx("span",{className:"t-body uppercase font-bold tracking-widest mb-0.5 text-slate-400/90",children:"Pressure"}),a.jsxs("div",{className:`flex items-baseline gap-1 ${i?"text-red-500 animate-pulse":"text-slate-200"}`,children:[a.jsx(Em,{className:"w-5 h-5 opacity-90"}),a.jsxs("span",{className:"t-display font-mono font-black leading-none tracking-tighter",children:[(l*100).toFixed(0),"%"]})]})]}),a.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 top-16 flex flex-col items-center",children:r>1&&a.jsxs("div",{className:"t-heading text-yellow-400 animate-bounce font-black tracking-wider whitespace-nowrap drop-shadow-[0_4px_4px_rgba(0,0,0,0.9)] stroke-black",children:["x",r," SURGE"]})}),a.jsxs("div",{className:"flex flex-col items-end drop-shadow-[0_2px_3px_rgba(0,0,0,0.9)]",children:[a.jsx("span",{className:"t-body text-green-500/90 uppercase font-bold tracking-widest mb-0.5",children:"Shift Score"}),a.jsx("span",{className:"t-display font-mono text-green-400 font-black leading-none tracking-tighter shadow-green-500/10",children:n.toLocaleString()})]})]})]})},ys=50,tn=e=>e<=0?0:e*(3375+125*e),Vm=e=>{if(e<=0)return 0;if(e>=ys)return tn(ys);const t=tn(e),n=tn(e+1);return Math.floor(t+(n-t)*.5)},qm=()=>{const e=[];for(let t=10;t<=ys;t+=10)e.push(t);return e},Km=(e,t)=>{if(t<=e)return[];const n=[],s=qm();for(const r of s)r>e&&r<=t&&n.push(r);return n},gt=e=>{if(e<tn(1))return{rank:0,progress:Math.max(0,e),toNextRank:3500,careerScore:Math.max(0,e),isMaxRank:!1};let t=1;for(;t<ys&&e>=tn(t+1);)t++;const n=tn(t),s=tn(t+1),r=e-n,o=s-n;return{rank:t,progress:r,toNextRank:o,careerScore:e,isMaxRank:t>=ys}},O0=(e,t,n)=>{const s=gt(e).rank,r=s+2,o=e+t,l=gt(o),i=l.rank-s;let c,u;return n?i===0?(c=s+1,u=tn(c)+100):i===1?(c=s+2,u=tn(c)+100):(c=r,u=tn(c)+100):i<=2?(u=o,c=l.rank):(c=r,u=tn(c)+100),c>ys&&(c=ys,u=tn(ys)),{newCareerScore:u,ranksGained:c-s}},Ss={[Oe.LASER]:{unlockRank:4,capacitorMax:100,drainPerUnit:4,drainUpgradeEffect:Dn.CAPACITOR_EFFICIENCY.effectPerLevel},[Oe.LIGHTS]:{unlockRank:2,graceBaseSec:5,gracePerLevel:.75,dimDurationSec:5,recoverRate:400,overflarePeak:110,overflareUpMs:50,overflareDownMs:100,dimThreshold:10,failedBrightness:5,snapToFailMs:100,flickerDipBrightness:70,flickerDipMs:80,flickerRecoverMs:120},[Oe.CONTROLS]:{unlockRank:6,heatMax:100,heatPerRotation:5,dissipationBase:50,dissipationUpgradeEffect:Dn.GEAR_LUBRICATION.effectPerLevel,idleThresholdMs:200}},If={minSeconds:8,maxSeconds:20};function Zm(e,t){const n=Ss[e].unlockRank;return Math.max(If.minSeconds,If.maxSeconds-(t-n))*1e3}function Xn(e,t){return t>=Ss[e].unlockRank}class Qm{constructor(){He(this,"ctx",null);He(this,"masterGain",null);He(this,"musicGain",null);He(this,"sfxGain",null);He(this,"droneOsc",null);He(this,"droneLfo",null);He(this,"settings",{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1});He(this,"isInitialized",!1)}init(t){if(this.isInitialized){this.updateSettings(t);return}this.settings=t;try{const n=window.AudioContext||window.webkitAudioContext;this.ctx=new n,this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.musicGain=this.ctx.createGain(),this.musicGain.connect(this.masterGain),this.sfxGain=this.ctx.createGain(),this.sfxGain.connect(this.masterGain),this.updateVolumes(),this.isInitialized=!0}catch(n){console.error("Audio init failed",n)}}updateSettings(t){this.settings=t,this.updateVolumes()}updateVolumes(){if(!this.masterGain||!this.musicGain||!this.sfxGain||!this.ctx)return;const t=this.ctx.currentTime,n=this.settings.masterVolume/100*.5,s=this.settings.musicVolume/100,r=this.settings.sfxVolume/100;this.masterGain.gain.setTargetAtTime(n,t,.1),this.musicGain.gain.setTargetAtTime(s,t,.1),this.sfxGain.gain.setTargetAtTime(r,t,.1)}resume(){this.ctx&&this.ctx.state==="suspended"&&this.ctx.resume()}startMusic(){this.stopMusic()}stopMusic(){if(this.droneOsc){try{this.droneOsc.stop()}catch{}this.droneOsc=null}if(this.droneLfo){try{this.droneLfo.stop()}catch{}this.droneLfo=null}}setPressure(t){}playPop(t){if(!this.ctx||!this.sfxGain)return;const n=this.ctx.currentTime,s=this.ctx.createOscillator(),r=this.ctx.createGain();s.connect(r),r.connect(this.sfxGain);const o=400+t*50;s.frequency.setValueAtTime(o,n),s.frequency.exponentialRampToValueAtTime(o*2,n+.1),r.gain.setValueAtTime(.5,n),r.gain.exponentialRampToValueAtTime(.01,n+.15),s.start(n),s.stop(n+.15)}playReject(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(150,t),n.frequency.linearRampToValueAtTime(100,t+.15),s.gain.setValueAtTime(.3,t),s.gain.linearRampToValueAtTime(0,t+.15),n.start(t),n.stop(t+.15)}playMove(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="triangle";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(800,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.05),n.start(t),n.stop(t+.05)}playRotate(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="square";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(600,t),s.gain.setValueAtTime(.05,t),s.gain.exponentialRampToValueAtTime(.001,t+.08),n.start(t),n.stop(t+.08)}playDrop(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sine",n.frequency.setValueAtTime(350,t),n.frequency.exponentialRampToValueAtTime(60,t+.15);const s=this.ctx.createGain();s.gain.setValueAtTime(.4,t),s.gain.exponentialRampToValueAtTime(.01,t+.15),n.connect(s),s.connect(this.sfxGain),n.start(t),n.stop(t+.15);const r=this.ctx.sampleRate*.2,o=this.ctx.createBuffer(1,r,this.ctx.sampleRate),l=o.getChannelData(0);for(let f=0;f<r;f++)l[f]=Math.random()*2-1;const i=this.ctx.createBufferSource();i.buffer=o;const c=this.ctx.createBiquadFilter();c.type="lowpass",c.Q.value=8,c.frequency.setValueAtTime(800,t),c.frequency.exponentialRampToValueAtTime(200,t+.15);const u=this.ctx.createGain();u.gain.setValueAtTime(.3,t),u.gain.exponentialRampToValueAtTime(.01,t+.15),i.connect(c),c.connect(u),u.connect(this.sfxGain),i.start(t)}playGameOver(){if(!this.ctx||!this.sfxGain)return;const t=this.ctx.currentTime,n=this.ctx.createOscillator();n.type="sawtooth";const s=this.ctx.createGain();n.connect(s),s.connect(this.sfxGain),n.frequency.setValueAtTime(400,t),n.frequency.linearRampToValueAtTime(50,t+1.5),s.gain.setValueAtTime(.5,t),s.gain.linearRampToValueAtTime(0,t+1.5),n.start(t),n.stop(t+1.5)}}const Tt=new Qm,Jm=1e3;class eg{checkComplications(t,n,s){const r=Date.now();if(r-s<Jm)return{spawned:null,newLastCheckTime:s};const o=f=>t.complications.some(d=>d.type===f),l=f=>r<t.complicationCooldowns[f],i=gt(n).rank,c=Ss[Oe.CONTROLS];let u=null;return!o(Oe.LASER)&&!l(Oe.LASER)&&Xn(Oe.LASER,i)&&t.laserCharge<=0?u=Oe.LASER:!o(Oe.CONTROLS)&&!l(Oe.CONTROLS)&&Xn(Oe.CONTROLS,i)&&t.controlsHeat>=c.heatMax&&(u=Oe.CONTROLS),{spawned:u,newLastCheckTime:r}}spawnComplication(t,n){const r={id:Math.random().toString(36).substr(2,9),type:n,startTime:Date.now(),severity:1};return t.complications=[...t.complications,r],ae.emit(re.COMPLICATION_SPAWNED,{type:n}),r}resolveComplication(t,n,s,r){const o=t.complications.find(l=>l.id===n);if(o){switch(o.type){case Oe.LASER:t.laserCharge=Ss[Oe.LASER].capacitorMax,t.prePoppedGoopGroups.clear();break;case Oe.CONTROLS:t.controlsHeat=0,t.rotationTimestamps=[];break;case Oe.LIGHTS:t.lightsBrightness=100,t.lightsGraceStart=Date.now(),t.lightsFlickered=!1;break}const l=gt(s+t.shiftScore).rank,i=Zm(o.type,l);t.complicationCooldowns[o.type]=Date.now()+i}t.complications=t.complications.filter(l=>l.id!==n),t.activeComplicationId=null,ae.emit(re.COMPLICATION_RESOLVED),Tt.playPop(5)}extendAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Oe)){const o=t.complicationCooldowns[r];if(o>s){const i=(o-s)*n;t.complicationCooldowns[r]=o+i}}}reduceAllCooldowns(t,n){const s=Date.now();for(const r of Object.values(Oe)){const o=t.complicationCooldowns[r];if(o>s){const i=(o-s)*n;t.complicationCooldowns[r]=Math.max(s,o-i)}}}}const Us=new eg;class Ur{constructor(t){He(this,"type","SPIN_TANK");this.dir=t}execute(t){if(t.state.gameOver||t.state.isPaused||t.trainingAllowedControls&&t.trainingAllowedControls.tankRotate===!1)return;const n=Xe(t.state.tankRotation+this.dir);let s=t.state.activeGoop;if(t.state.activeGoop){const c=oc(t.state.activeGoop.screenX,n);s={...t.state.activeGoop,x:c};const u=Math.round(s.y),f={...s,y:u};if(vs(t.state.grid,f)){ae.emit(re.ACTION_REJECTED);return}vs(t.state.grid,s)&&(s=f)}t.state.tankRotation=n,s&&(t.state.activeGoop=s),t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++);const r=Date.now();t.state.rotationTimestamps.push(r),t.state.rotationTimestamps.length>Dx&&t.state.rotationTimestamps.shift();const o=gt(t.initialTotalScore).rank,l=Ss[Oe.CONTROLS],i=Date.now()<t.state.complicationCooldowns[Oe.CONTROLS];Xn(Oe.CONTROLS,o)&&!i&&(t.state.controlsHeat=Math.min(l.heatMax,t.state.controlsHeat+l.heatPerRotation)),ae.emit(re.PIECE_MOVED),t.emitChange()}}class No{constructor(t){He(this,"type","ROTATE_GOOP");this.clockwise=t}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop||t.trainingAllowedControls&&t.trainingAllowedControls.rotate===!1)return;const n=t.state.activeGoop,s=(n.rotation+(this.clockwise?1:-1)+4)%4;if(n.definition.type===Ae.O||n.definition.type===Ae.T_O){const i=n.definition.cellColors,c=i&&i.length===4?this.clockwise?[i[2],i[0],i[3],i[1]]:[i[1],i[3],i[0],i[2]]:i;ae.emit(re.PIECE_ROTATED),t.state.activeGoop={...n,rotation:s,definition:{...n.definition,cellColors:c}},t.emitChange();return}const r=A0(n.cells,this.clockwise,n.rotationCenter),o={...n,cells:r,rotation:s},l=[{x:0,y:0},{x:1,y:0},{x:-1,y:0},{x:0,y:-1},{x:1,y:-1},{x:-1,y:-1},{x:0,y:-2},{x:1,y:-2},{x:-1,y:-2},{x:2,y:0},{x:-2,y:0}];for(const i of l){const c=Xe(o.x+i.x),u=zy(c,t.state.tankRotation),f={...o,x:c,y:o.y+i.y,screenX:u};if(!vs(t.state.grid,f,t.state.tankRotation)){ae.emit(re.PIECE_ROTATED),t.state.activeGoop=f,t.lockStartTime!==null&&(t.lockStartTime=null,t.lockResetCount++),t.emitChange();return}}}}class Hl{constructor(t){He(this,"type","SET_FAST_DROP");this.active=t}execute(t){t.trainingAllowedControls&&t.trainingAllowedControls.fastDrop===!1||(t.isFastDropping=this.active)}}class tg{constructor(){He(this,"type","SWAP_PIECE")}execute(t){if(t.state.gameOver||t.state.isPaused||!t.state.activeGoop)return;const n=t.state.activeGoop,s=n.definition,r=t.state.storedGoop;if(r){const o=Math.round(r.cells.reduce((c,u)=>c+u.x,0)/r.cells.length),l=Math.round(r.cells.reduce((c,u)=>c+u.y,0)/r.cells.length),i={definition:r,cells:[...r.cells],rotation:0,rotationCenter:{x:o,y:l},spawnTimestamp:Date.now(),startSpawnY:n.y,screenX:n.screenX,x:n.x,y:n.y,state:Bn.FALLING};if(vs(t.state.grid,i,t.state.tankRotation)){ae.emit(re.ACTION_REJECTED);return}ae.emit(re.PIECE_ROTATED),t.state.storedGoop=s,t.state.activeGoop=i,t.lockStartTime=null,t.lockResetCount=0,t.state.canSwap=!0}else ae.emit(re.PIECE_ROTATED),t.state.storedGoop=s,t.lockStartTime=null,t.spawnNewPiece();t.emitChange()}}class ng{constructor(t,n){He(this,"type","POP_GOOP");this.x=t,this.y=n}execute(t){var u;if(t.state.gameOver||t.state.isPaused||((u=t.trainingAllowedControls)==null?void 0:u.pop)===!1)return;const n=t.state.grid[this.y][this.x];if(!n)return;if(t.trainingHighlightColor&&n.color!==t.trainingHighlightColor){ae.emit(re.ACTION_REJECTED);return}const s=Math.max(0,1-t.state.shiftTime/t.maxTime),r=De-1-s*(Dt-1);if(n.groupMinY<r){ae.emit(re.ACTION_REJECTED);return}const o=Date.now(),l=n.groupSize*So;if(o-(n.timestamp||0)<l){ae.emit(re.ACTION_REJECTED);return}const c=Hy(t.state.grid,this.x,this.y);if(c.length>0){if(t.state.complications.find(H=>H.type===Oe.LASER)){const H=n.goopGroupId;if(!t.state.prePoppedGoopGroups.has(H)){t.state.prePoppedGoopGroups.add(H);const G=Date.now();c.forEach(X=>{const V=t.state.grid[X.y][X.x];V&&(V.timestamp=G)}),ae.emit(re.ACTION_REJECTED),t.emitChange();return}t.state.prePoppedGoopGroups.delete(H)}ae.emit(re.GOOP_POPPED,{popStreak:t.state.popStreak,count:c.length}),t.state.cellsCleared++,t.state.totalUnitsPopped+=c.length;const d=gt(t.initialTotalScore).rank,p=Ss[Oe.LASER];if(Xn(Oe.LASER,d)){const H=t.powerUps.CAPACITOR_EFFICIENCY||0,G=1-p.drainUpgradeEffect*H,X=c.length*p.drainPerUnit*G;t.state.laserCharge=Math.max(0,t.state.laserCharge-X)}const y=c.length;t.state.gameStats.maxGroupSize=Math.max(t.state.gameStats.maxGroupSize,y);const v=$x,k=y*Fx;let w=0;y>=vf&&(w=(Math.floor((y-vf)/Gx)+1)*Bx);let m=0;const h=[];c.forEach(H=>{const G=t.state.grid[H.y][H.x];if(G!=null&&G.isSealingGoop){m++;const X=t.state.goalMarks.find(V=>V.x===H.x&&V.y===H.y&&V.plugged);X&&h.push(X.id)}});const x=m*3e3;if(m>0){if(t.state.goalsCleared+=m,h.length>0){const G=new Set(h);h.forEach(X=>{const V=t.state.crackCells.find(te=>te.id===X);V&&(V.originCrackId.forEach(te=>{const J=t.state.crackCells.find(pe=>pe.id===te);J&&(J.branchCrackIds=J.branchCrackIds.filter(pe=>pe!==X))}),V.branchCrackIds.forEach(te=>{const J=t.state.crackCells.find(pe=>pe.id===te);J&&(J.originCrackId=J.originCrackId.filter(pe=>pe!==X))}))}),t.state.crackCells=t.state.crackCells.filter(X=>!G.has(X.id)),t.state.goalMarks=t.state.goalMarks.filter(X=>!G.has(X.id))}ae.emit(re.GOAL_CAPTURED,{count:m}),t.chargeActiveAbilities(m*25);const H=t.powerUps.SEALING_BONUS||0;if(H>0){const V=.1+H*.05;for(let te=0;te<m;te++)Us.reduceAllCooldowns(t.state,V)}}const C=v+k+w+x;t.state.shiftTime=Math.min(t.maxTime,t.state.shiftTime+C),t.state.gameStats.totalBonusTime+=C;let j=0,R=t.state.popStreak+1,P={base:0,height:0,offscreen:0,adjacency:0,speed:0};const S=Zy(t.state.grid,c);j+=S,P.adjacency+=S,c.forEach(H=>{let G=10,X=Vy(H.y),V=qy(H.x,t.state.tankRotation);const te=Ky(R),J=(G+X+V)*te;j+=J,P.base+=G*te,P.height+=X*te,P.offscreen+=V*te});const T=Math.floor(j);t.updateScoreAndStats(T,P),t.state.popStreak=R;const E=Math.random().toString(36).substr(2,9),M=[{id:E,text:`+${T}`,x:this.x,y:this.y,life:1,color:"#fbbf24"},{id:E+"_time",text:"Vented",x:this.x,y:this.y-1,life:1,color:"#4ade80"}];m>0&&M.push({id:E+"_bonus",text:"SEALED!",x:this.x,y:this.y-2,life:1.5,color:"#fff"}),t.state.floatingTexts.push(...M),setTimeout(()=>{t.state.floatingTexts=t.state.floatingTexts.filter(H=>!H.id.startsWith(E)),t.emitChange()},1e3);const Q=n.goopGroupId;Q&&t.state.poppedGoopGroupIds.add(Q);let ne=t.state.grid.map(H=>[...H]);const ie=[];c.forEach(H=>{ne[H.y][H.x]=null,ie.push({x:H.x,y:H.y})});const{grid:L,looseGoop:ee}=I0(ne,ie);if(ee.forEach(H=>{if(H.data.isSealingGoop){const G=t.state.goalMarks.find(X=>X.x===H.x&&X.y===Math.floor(H.y)&&X.plugged);G&&(G.plugged=!1),H.data.isSealingGoop=!1}}),m>0&&!t.isTrainingMode&&t.state.goalsCleared>=t.state.goalsTarget){const H=Math.max(0,1-t.state.shiftTime/t.maxTime),G=gt(t.initialTotalScore+t.state.shiftScore).rank;if(H<.9){const X=Qy(L,t.state.goalMarks,G,t.state.shiftTime,t.maxTime);t.state.goalMarks.push(...X),ae.emit(re.GOAL_CAPTURED,{count:1})}else t.state.goalMarks=[]}t.state.grid=L,t.state.looseGoop.push(...ee),t.emitChange()}}}class sg{constructor(){He(this,"type","START_RUN")}execute(t){t.startRun()}}class Ws{constructor(t){He(this,"type","SET_PHASE");this.phase=t}execute(t){this.phase===qe.ConsoleScreen&&t.isTrainingMode&&t.trainingAllowedControls||(this.phase===qe.TankScreen?t.enterPeriscope():this.phase===qe.ConsoleScreen?t.enterConsole():(t.state.phase=this.phase,t.emitChange()))}}class og{constructor(t){He(this,"type","RESOLVE_COMPLICATION");this.id=t}execute(t){t.resolveComplication(this.id)}}class rg{constructor(t){He(this,"type","ACTIVATE_ABILITY");this.upgradeId=t}execute(t){t.state.gameOver||t.state.isPaused||(t.state.activeCharges[this.upgradeId]||0)<100||(t.state.activeCharges[this.upgradeId]=0,t.activateAbility(this.upgradeId),ae.emit(re.ABILITY_ACTIVATED,{upgradeId:this.upgradeId}),t.emitChange())}}const ig=(e,t,n,s,r,o,l)=>{if(!e)return"FAILURE";const i=n>0?Math.min(100,t/n*100):100,c=Math.max(0,100-s*2),u=Math.max(0,100-s*3),f=o>0?Math.min(100,r/o*100):50,d=Math.min(100,l/100),p=(i+c+u+f+d)/5;return p>=80?"A":p>=60?"B":p>=40?"C":"FAILURE"},lg=({shiftScore:e,rank:t,xpCurrent:n,xpNext:s,cracksFilled:r,cracksTarget:o,pressureVented:l,maxTime:i,massPurged:c,leftoverPenalty:u,unspentPower:f,isWin:d})=>{const y=Math.min(1,Math.max(0,n/s))*366.31,v=ig(d,r,o,u,l,i,e),k=v==="A"?"#5bbc70":v==="B"?"#6acbda":v==="C"?"#ffd92b":"#d82727",w=i>0?Math.round(l/i*100):0;return a.jsxs("g",{id:"End_Game_Monitor_Group",children:[a.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),a.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),a.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),a.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'From Where You Are'",fontSize:"42",transform:"translate(291.5 122.96)",textAnchor:"middle",children:"SHIFT OVER"}),a.jsxs("text",{fill:k,fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"24",letterSpacing:"0.1em",transform:"translate(291.5 155)",textAnchor:"middle",children:["GRADE: ",v]}),a.jsx("path",{fill:"#5bbc70",d:"M525.21,243.36H58.95c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM58.95,223.59c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H58.95Z"}),a.jsx("path",{fill:"#5bbc70",d:`M57.75,223.09h${y}v19.77H57.75c-4.79,0-8.68-3.89-8.68-8.68v-2.4c0-4.79,3.89-8.68,8.68-8.68Z`}),a.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(530 237)",children:[Math.floor(n).toLocaleString()," / ",Math.floor(s).toLocaleString()]}),a.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(530 213)",children:"PROMOTION THRESHOLD"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(49.87 209.32)",children:a.jsx("tspan",{x:"0",y:"0",children:"OPERATOR RANK"})}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(230 210.8)",textAnchor:"start",children:t}),a.jsx("path",{fill:"#fff",d:"M268.4,808.13v-1.02l.33-1.02c6.23-8.15,13.08-15.87,19.51-23.87,1.65-2.11,4.36-2.41,6.29-.46l20.02,23c.62.7,1,1.44,1.2,2.36-.03.33.04.7,0,1.02-.21,1.7-1.77,3.25-3.47,3.42h-40.15c-1.85-.05-3.51-1.61-3.74-3.42ZM271.73,793.93c1.56-1.89,3.12-3.76,4.65-5.6,2.57-3.07,5.23-6.25,7.76-9.4,1.83-2.35,4.56-3.73,7.45-3.73,2.47,0,4.83,1.01,6.66,2.85l.12.12,13.75,15.8h.16c1.7-.17,3.26-1.72,3.47-3.42.04-.32-.03-.69,0-1.02-.2-.92-.58-1.66-1.21-2.36l-20.02-23c-1.94-1.95-4.65-1.65-6.29.46-6.44,8.01-13.29,15.72-19.51,23.87l-.33,1.02v1.02c.21,1.67,1.66,3.12,3.33,3.37Z"}),a.jsx("text",{fill:"#d82727",fontFamily:"'From Where You Are'",fontSize:"24",transform:"translate(291.5 860.65)",textAnchor:"middle",children:"DRAG UP TO END SHIFT"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(165.69 321.1)",textAnchor:"middle",children:"SHIFT SCORE"}),a.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(165.69 390.05)",textAnchor:"middle",children:e.toLocaleString()}),a.jsxs("g",{children:[a.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),a.jsx("path",{fill:"#fff",d:"M261.87,585.41H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 503.38)",textAnchor:"middle",children:"CRACKS FILLED"}),a.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 557.36)",textAnchor:"middle",children:[r," / ",o]})]}),a.jsxs("g",{children:[a.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"467.32",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),a.jsx("path",{fill:"#fff",d:"M514.25,585.41h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,467.82c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 503.38)",textAnchor:"middle",children:"PRESSURE VENTED"}),a.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 557.36)",textAnchor:"middle",children:[w,"%"]})]}),a.jsxs("g",{children:[a.jsx("rect",{fill:"#0c0f19",x:"55.99",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),a.jsx("path",{fill:"#fff",d:"M261.87,731.68H69.52c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM69.52,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02H69.52Z"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(165.69 649.64)",textAnchor:"middle",children:"MAX POP"}),a.jsx("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(165.69 703.63)",textAnchor:"middle",children:c})]}),a.jsxs("g",{children:[a.jsx("rect",{fill:"#0c0f19",x:"308.38",y:"613.59",width:"219.4",height:"117.59",rx:"13.52",ry:"13.52"}),a.jsx("path",{fill:"#fff",d:"M514.25,731.68h-192.35c-7.73,0-14.02-6.29-14.02-14.02v-90.54c0-7.73,6.29-14.02,14.02-14.02h192.35c7.73,0,14.02,6.29,14.02,14.02v90.54c0,7.73-6.29,14.02-14.02,14.02ZM321.9,614.09c-7.18,0-13.02,5.84-13.02,13.02v90.54c0,7.18,5.84,13.02,13.02,13.02h192.35c7.18,0,13.02-5.84,13.02-13.02v-90.54c0-7.18-5.84-13.02-13.02-13.02h-192.35Z"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"18",transform:"translate(418.08 649.64)",textAnchor:"middle",children:"RESIDUAL GOOP"}),a.jsxs("text",{fill:"#fff",fontFamily:"'Amazon Ember'",fontWeight:"700",fontSize:"36",transform:"translate(418.08 703.63)",textAnchor:"middle",children:["-",u]})]}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(418.08 321.1)",textAnchor:"middle",children:"SCRAPS"}),a.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"60",transform:"translate(418.08 390.05)",textAnchor:"middle",children:f})]})},ag="#14b8a6",cg="#ffffff",ug="#22c55e",Wr="#231f20",Xr="#d8672b";function fg({complications:e,isLaserMaxed:t,onResolveComplication:n}){const[s,r]=g.useState({active:!1,solved:!1,targets:[0,0,0,0]}),[o,l]=g.useState([0,0,0,0]),[i,c]=g.useState(null),[u,f]=g.useState(!1),d=g.useRef([]),p=g.useRef(null),y=g.useRef(null),v=g.useCallback(()=>e.some(h=>h.type===Oe.LASER),[e]);g.useEffect(()=>{const h=d.current.some(C=>C.type===Oe.LASER),x=v();h&&!x&&(f(!0),y.current=setTimeout(()=>{f(!1)},2500)),d.current=e},[e,v]),g.useEffect(()=>{if(!v()&&(s.active||s.solved)&&(r({active:!1,solved:!1,targets:[0,0,0,0]}),l([0,0,0,0])),v()&&!s.active&&!s.solved){const h=t?[-1,1]:[-1,0,1],x=[0,1,2,3].map(()=>h[Math.floor(Math.random()*h.length)]),C=x.map(j=>{const R=h.filter(P=>P!==j);return R[Math.floor(Math.random()*R.length)]});l(C),r({active:!0,solved:!1,targets:x})}},[e,s.active,s.solved,t,v]),g.useEffect(()=>()=>{p.current&&clearTimeout(p.current),y.current&&clearTimeout(y.current)},[]);const k=g.useCallback((h,x)=>{l(j=>{const R=[...j];return R[h]=x,e.find(S=>S.type===Oe.LASER),R});const C=e.find(j=>j.type===Oe.LASER);if(C&&!s.solved){const j=s.targets[h];if(x!==j)c(h),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>c(null),300);else{const R=[...o];R[h]=x,R.every((S,T)=>S===s.targets[T])&&(r(S=>({...S,solved:!0})),l([0,0,0,0]),n&&n(C.id))}}},[e,s.solved,s.targets,o,n]),w=g.useCallback(h=>{if(!v())return{left:Wr,right:Wr};const x=s.targets[h];return x===-1?{left:Xr,right:Wr}:x===1?{left:Wr,right:Xr}:{left:Xr,right:Xr}},[v,s.targets]),m=g.useCallback(()=>v()?{text:"REPAIR LASER",color:cg}:u?{text:"LASER FIXED",color:ug}:{text:"REPAIR LASER",color:ag},[v,u]);return{laserSliders:o,updateLaserSlider:k,shakingSlider:i,getLaserLightColors:w,getLaserTextState:m,recentlyFixed:u,isComplicationActive:v()}}const _f={0:"#96d7dd",1:"#f6f081",2:"#cb8abc"},dg=[45,315,225,135],Of=[45,135,225,315],pg="#14b8a6",hg="#ffffff",xg="#22c55e",Jt="#231f20",Vr="#d8672b";function yg({complications:e,isLightsMaxed:t,pressedBtn:n,onResolveComplication:s}){const[r,o]=g.useState({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),[l,i]=g.useState(0),[c,u]=g.useState(!1),[f,d]=g.useState(!1),p=g.useRef([]),y=g.useRef(null),v=g.useRef(null),k=g.useRef([]),w=g.useCallback(()=>e.some(S=>S.type===Oe.LIGHTS),[e]),m=g.useCallback(()=>{const S=[],T=[0,0,0],E=t?3:4;for(let M=0;M<E;M++){const Q=[];T[0]<2&&Q.push(0),T[1]<2&&Q.push(1),T[2]<2&&Q.push(2);const ne=Q[Math.floor(Math.random()*Q.length)];S.push(ne),T[ne]++}return S},[t]),h=g.useCallback(S=>{k.current.forEach(ie=>clearTimeout(ie)),k.current=[];let Q=300;S.forEach(ie=>{const L=setTimeout(()=>{o(H=>({...H,showingIndex:ie}))},Q);k.current.push(L);const ee=setTimeout(()=>{o(H=>({...H,showingIndex:-1}))},Q+200);k.current.push(ee),Q+=200+100});const ne=setTimeout(()=>{o(ie=>({...ie,phase:"input",showingIndex:-1,inputIndex:0}))},Q+100);k.current.push(ne)},[]);g.useEffect(()=>{const S=p.current.some(E=>E.type===Oe.LIGHTS),T=w();S&&!T&&(d(!0),v.current=setTimeout(()=>{d(!1)},2500)),p.current=e},[e,w]),g.useEffect(()=>{if(!w()&&r.phase!=="inactive"&&(o({phase:"inactive",slider1Target:1,sequence:[],inputIndex:0,showingIndex:-1}),i(0)),w()&&r.phase==="inactive"){const S=m();o({phase:"slider1",slider1Target:Math.random()>.5?1:-1,sequence:S,inputIndex:0,showingIndex:-1}),i(0)}},[e,r.phase,w,m]),g.useEffect(()=>()=>{y.current&&clearTimeout(y.current),v.current&&clearTimeout(v.current),k.current.forEach(S=>clearTimeout(S))},[]);const x=g.useCallback(S=>{if(r.phase!=="input")return;const T=r.sequence[r.inputIndex];if(S===T){const E=r.inputIndex+1;E>=r.sequence.length?o(M=>({...M,phase:"slider2",inputIndex:0})):o(M=>({...M,inputIndex:E}))}else{o(M=>({...M,phase:"showing",inputIndex:0,showingIndex:-1}));const E=setTimeout(()=>{h(r.sequence)},300);k.current.push(E)}},[r.phase,r.sequence,r.inputIndex,h]),C=g.useCallback(S=>{const{phase:T,slider1Target:E,sequence:M}=r;if(T==="slider1")S===E?(i(S),o(Q=>({...Q,phase:"showing"})),h(M)):S!==0?(u(!0),y.current&&clearTimeout(y.current),y.current=setTimeout(()=>{u(!1),i(0)},400)):i(S);else if(T==="slider2"){const Q=E===1?-1:1;if(i(S),S===Q){o(ie=>({...ie,phase:"solved"})),i(0);const ne=e.find(ie=>ie.type===Oe.LIGHTS);ne&&s&&s(ne.id)}}else i(S)},[e,r,s,h]),j=g.useCallback(S=>!w()||r.phase==="inactive"?Jt:r.phase==="showing"&&r.showingIndex===S||r.phase==="input"&&n===["blue","green","purple"][S]?_f[S]:Jt,[w,r.phase,r.showingIndex,n]),R=g.useCallback(()=>{const{phase:S,slider1Target:T}=r;return w()?S==="inactive"?{top:Jt,bottom:Jt}:S==="slider1"?T===1?{top:Jt,bottom:Vr}:{top:Vr,bottom:Jt}:S==="slider2"?T===1?{top:Vr,bottom:Jt}:{top:Jt,bottom:Vr}:{top:Jt,bottom:Jt}:{top:Jt,bottom:Jt}},[w,r]),P=g.useCallback(()=>w()?{text:"REPAIR LIGHTS",color:hg}:f?{text:"LIGHTS FIXED",color:xg}:{text:"REPAIR LIGHTS",color:pg},[w,f]);return{lightsComplication:r,lightSlider:l,handleLightsButton:x,handleLightsSliderChange:C,lightsSliderShaking:c,getLightsButtonLightColor:j,getLightsSliderLightColors:R,getLightsTextState:P,recentlyFixed:f,isComplicationActive:w()}}const mg="#14b8a6",gg="#ffffff",vg="#22c55e",Ul="#231f20",Sg="#d8672b",Lf=194.32,Nf=1586.66,Cg=86.84,kg=Cg*1.3;function wg({complications:e,isControlsMaxed:t,onResolveComplication:n}){const[s,r]=g.useState({active:!1,solved:!1,targetCorner:null,completedCorners:0}),[o,l]=g.useState(0),[i,c]=g.useState(!1),[u,f]=g.useState(!1),[d,p]=g.useState(!1),[y,v]=g.useState(!1),k=g.useRef([]),w=g.useRef(null),m=g.useRef(null),h=g.useRef(null),x=g.useRef(null),C=g.useRef(!1),j=g.useRef(0),R=g.useRef(0),P=g.useRef(0),S=g.useRef(!1),T=g.useRef(!1),E=g.useCallback(()=>e.some(V=>V.type===Oe.CONTROLS),[e]),M=g.useCallback((V,te)=>{try{const J=document.getElementById("coord-reference");if(!J)return null;const pe=J.ownerSVGElement;if(!pe)return null;const Me=pe.createSVGPoint();Me.x=V,Me.y=te;const he=J.getScreenCTM();if(!he)return null;const A=Me.matrixTransform(he.inverse());return{x:A.x,y:A.y}}catch{return null}},[]);g.useEffect(()=>{const V=k.current.some(J=>J.type===Oe.CONTROLS),te=E();V&&!te&&(v(!0),m.current=setTimeout(()=>{v(!1)},2500)),k.current=e},[e,E]),g.useEffect(()=>{if(!E()&&(s.active||s.solved)&&r({active:!1,solved:!1,targetCorner:null,completedCorners:0}),E()&&!s.active&&!s.solved){const V=Math.floor(Math.random()*4);r({active:!0,solved:!1,targetCorner:V,completedCorners:0})}},[e,s.active,s.solved,E]),g.useEffect(()=>()=>{w.current&&clearTimeout(w.current),m.current&&clearTimeout(m.current),h.current&&clearTimeout(h.current),x.current&&clearTimeout(x.current)},[]);const Q=g.useCallback((V,te)=>{const J=M(V,te);if(!J)return;const pe=J.x-Lf,Me=J.y-Nf;Math.sqrt(pe*pe+Me*Me)>kg||(j.current=Math.atan2(Me,pe)*(180/Math.PI),R.current=o,C.current=!0,S.current=!1,c(!0))},[o,M]),ne=g.useCallback((V,te)=>{if(!C.current)return;const J=M(V,te);if(!J)return;const pe=J.x-Lf,Me=J.y-Nf,A=Math.atan2(Me,pe)*(180/Math.PI)-j.current+R.current;P.current=A,S.current=!0,l(A)},[M]),ie=g.useCallback(()=>{if(!C.current||(C.current=!1,c(!1),S.current&&(T.current=!0,x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{T.current=!1},100)),!S.current))return;const V=P.current;let te=V%360;te<0&&(te+=360);let J=Of[0],pe=1/0;for(const q of Of){const K=Math.min(Math.abs(te-q),Math.abs(te-q+360),Math.abs(te-q-360));K<pe&&(pe=K,J=q)}const Me=Math.floor(V/360)*360,he=[Me+J-360,Me+J,Me+J+360];let A=he[0],Y=Math.abs(V-he[0]);for(const q of he){const K=Math.abs(V-q);K<Y&&(Y=K,A=q)}P.current=A,l(A)},[]);g.useEffect(()=>{if(!i)return;const V=Me=>{ne(Me.clientX,Me.clientY)},te=()=>{ie()},J=Me=>{Me.touches.length>0&&ne(Me.touches[0].clientX,Me.touches[0].clientY)},pe=()=>{ie()};return window.addEventListener("mousemove",V),window.addEventListener("mouseup",te),window.addEventListener("touchmove",J),window.addEventListener("touchend",pe),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",te),window.removeEventListener("touchmove",J),window.removeEventListener("touchend",pe)}},[i,ne,ie]);const L=g.useCallback(()=>{if(s.targetCorner===null)return!1;const V=dg[s.targetCorner],te=(o%360+360)%360,J=Math.abs(te-V);return Math.min(J,360-J)<15},[s.targetCorner,o]),ee=g.useCallback(()=>{f(!0),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>f(!1),300)},[]),H=g.useCallback(()=>{if(!(!E()||s.solved)&&!i&&!T.current)if(p(!0),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>p(!1),150),L()){const V=s.completedCorners+1;if(V>=(t?3:4)){r(pe=>({...pe,solved:!0,targetCorner:null,completedCorners:4}));const J=e.find(pe=>pe.type===Oe.CONTROLS);J&&n&&n(J.id)}else{const J=[0,1,2,3].filter(Me=>Me!==s.targetCorner),pe=J[Math.floor(Math.random()*J.length)];r(Me=>({...Me,targetCorner:pe,completedCorners:V}))}}else ee()},[E,s.solved,s.completedCorners,s.targetCorner,i,L,t,e,n,ee]),G=g.useCallback(V=>!E()||s.solved?Ul:s.targetCorner===V?Sg:Ul,[E,s.solved,s.targetCorner]),X=g.useCallback(()=>E()?{text:"REPAIR CONTROLS",color:gg}:y?{text:"CONTROLS FIXED",color:vg}:{text:"REPAIR CONTROLS",color:mg},[E,y]);return{localDialRotation:o,isDialDragging:i,dialShaking:u,dialPressed:d,handleDialStart:Q,handleDialMove:ne,handleDialEnd:ie,handleDialPress:H,getControlsCornerLightColor:G,getControlsTextState:X,recentlyFixed:y,isDialAligned:L,isComplicationActive:E()&&!s.solved}}const Uo=({x:e,y:t,rotation:n=0,length:s=176,width:r=50,handleSize:o=50,value:l=0,onChange:i,trackColor:c="#eebfc5",handleColor:u="#d36b28",arrowColor:f="#ffffff",className:d=""})=>{const[p,y]=g.useState(!1),[v,k]=g.useState(0),w=g.useRef(null),m=g.useRef(0),h=(s-o)/2,x={"-1":-h,0:0,1:h},C=p?v:x[`${l}`]||0,j=S=>{S.stopPropagation(),S.currentTarget.setPointerCapture(S.pointerId),w.current={x:S.clientX,y:S.clientY},m.current=C,k(C),y(!0)},R=S=>{if(!p||!w.current)return;S.stopPropagation();const T=S.clientX-w.current.x,E=S.clientY-w.current.y,M=n*Math.PI/180,Q=T*Math.cos(M)+E*Math.sin(M),ne=m.current+Q,ie=Math.max(-h,Math.min(h,ne));k(ie)},P=S=>{if(!p)return;S.stopPropagation(),S.currentTarget.releasePointerCapture(S.pointerId),y(!1);const T=Math.abs(v-x[-1]),E=Math.abs(v-x[0]),M=Math.abs(v-x[1]);let Q=0;T<E&&T<M?Q=-1:M<E&&M<T?Q=1:Q=0,i&&Q!==l&&i(Q)};return a.jsx("g",{transform:`translate(${e}, ${t}) rotate(${n})`,children:a.jsxs("g",{className:d,children:[a.jsx("rect",{x:-s/2,y:-r/2,width:s,height:r,rx:6.92,ry:6.92,fill:c}),a.jsx("g",{transform:`translate(${C}, 0)`,style:{transition:p?"none":"transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"},children:a.jsx("rect",{x:-o/2,y:-o/2,width:o,height:o,rx:3.69,ry:3.69,fill:u})}),a.jsx("rect",{x:-s/2-20,y:-r/2-20,width:s+40,height:r+40,fill:"transparent",style:{cursor:"grab",touchAction:"none"},onPointerDown:j,onPointerMove:R,onPointerUp:P,onPointerLeave:P})]})})},Pg=({laserSliders:e,shakingSlider:t,onSliderChange:n,getLaserLightColors:s,textState:r,isComplicationActive:o=!1,isUnlocked:l=!0})=>a.jsxs("g",{id:"Reset_Laser_Top",className:l?"minigame-active":"minigame-inactive",children:[a.jsxs("g",{pointerEvents:"none",children:[a.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M157.91,233.16h-4.24l-18.69-18.69c-3.62-3.62-3.62-9.52,0-13.14l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0-8.89l20.81,20.81ZM111.51,212.35c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-1.75,1.75-2.72,4.09-2.72,6.57s.97,4.81,2.72,6.57l18.69,18.69h4.24l-20.81-20.81ZM107.64,182.65h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM235.4,214.47c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,233.16h4.24l18.69-18.69c1.75-1.75,2.72-4.09,2.72-6.57s-.97-4.81-2.72-6.57l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM260.08,214.47c.17-.17.33-.36.49-.54v-12.05c-.16-.19-.32-.37-.49-.54l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"}),a.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M132.32,324.04h-4.24l-18.69-18.69c-1.75-1.75-2.72-4.09-2.72-6.57s.97-4.81,2.72-6.57l18.69-18.69h4.24l-20.81,20.81c-2.45,2.45-2.45,6.44,0,8.89l20.81,20.81ZM137.1,303.23c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81h-4.24l-18.69,18.69c-3.62,3.62-3.62-9.52,0,13.14l18.69,18.69h4.24l-20.81-20.81ZM107.64,273.53h-4.24l-18.68,18.68v13.15l18.68,18.68h4.24l-20.81-20.81c-2.45-2.45-2.45-6.44,0-8.89l20.81-20.81ZM260.08,305.35c.18-.18.34-.36.49-.55v-12.04c-.16-.19-.32-.37-.49-.55l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69ZM186.88,324.04h4.24l18.69-18.69c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c1.19,1.19,1.84,2.77,1.84,4.45s-.65,3.26-1.84,4.45l-20.81,20.81ZM235.4,305.35c3.62-3.62,3.62-9.52,0-13.14l-18.69-18.69h-4.24l20.81,20.81c2.45,2.45,2.45,6.44,0,8.89l-20.81,20.81h4.24l18.69-18.69Z"})]}),a.jsx(Uo,{x:172.65,y:207.9,value:e[0],onChange:i=>n(0,i),className:t===0?"shake-anim":""}),a.jsx(Uo,{x:172.65,y:298.78,value:e[1],onChange:i=>n(1,i),className:t===1?"shake-anim":""}),a.jsx(Uo,{x:445.24,y:207.9,value:e[2],onChange:i=>n(2,i),className:t===2?"shake-anim":""}),a.jsx(Uo,{x:445.24,y:298.78,value:e[3],onChange:i=>n(3,i),className:t===3?"shake-anim":""}),a.jsxs("g",{children:[a.jsx("path",{fill:s(0).right,fillRule:"evenodd",d:"M280.92,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),a.jsx("path",{fill:s(0).left,fillRule:"evenodd",d:"M63.6,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:s(1).right,fillRule:"evenodd",d:"M280.92,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M280.93,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M280.93,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),a.jsx("path",{fill:s(1).left,fillRule:"evenodd",d:"M63.6,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M63.61,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M63.61,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:s(2).left,fillRule:"evenodd",d:"M336.96,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),a.jsx("path",{fill:s(2).right,fillRule:"evenodd",d:"M554.28,219.43c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,197.87c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,194.87h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:s(3).left,fillRule:"evenodd",d:"M336.96,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M336.97,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M336.97,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"}),a.jsx("path",{fill:s(3).right,fillRule:"evenodd",d:"M554.28,310.32c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.53,11.53-11.53,11.54,5.17,11.54,11.53-5.17,11.53-11.53,11.53h0Z"}),a.jsx("path",{fill:"#1f1f38",fillRule:"evenodd",d:"M554.29,288.75c5.54,0,10.03,4.49,10.03,10.03s-4.49,10.03-10.03,10.03h0c-5.54,0-10.03-4.49-10.03-10.03s4.49-10.03,10.03-10.03h0M554.29,285.75h0c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),a.jsx("text",{fill:r.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(245.29 261.57)",children:r.text})]}),Wl=({x:e,y:t,colorBody:n,colorTop:s,isPressed:r,onPress:o,onRelease:l})=>{const i="M42.31,73.62C18.58,73.62,0,59.79,0,42.13S18.58,10.65,42.31,10.65s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",c="M74.5,41.03c0,11.84-14.45,21.44-32.27,21.44S9.97,52.87,9.97,41.03c0-8.74.25-20.68.25-20.68h64.43s-.15,13.21-.15,20.68Z",f="M42.31,62.97C18.58,62.97,0,49.14,0,31.48S18.58,0,42.31,0s42.31,13.83,42.31,31.48-18.59,31.48-42.31,31.48Z",d="M74.5,30.38c0,11.84-14.45,21.44-32.27,21.44S9.97,42.22,9.97,30.38c0-8.74.25-8.47.25-8.47h64.43s-.15.99-.15,8.47Z";return a.jsx("g",{transform:`translate(${e}, ${t})`,style:{cursor:"pointer"},onMouseDown:v=>{v.stopPropagation(),o()},onMouseUp:v=>{v.stopPropagation(),l()},onMouseLeave:()=>{r&&l()},onTouchStart:v=>{v.stopPropagation(),o()},onTouchEnd:v=>{v.stopPropagation(),l()},children:r?a.jsxs("g",{transform:`translate(0, ${10.65})`,children:[a.jsx("path",{fill:"#0d1a19",d:f}),a.jsx("path",{fill:n,fillRule:"evenodd",d}),a.jsx("ellipse",{fill:s,cx:"42.31",cy:23.01,rx:"32.27",ry:"21.44"})]}):a.jsxs("g",{children:[a.jsx("path",{fill:"#0d1a19",d:i}),a.jsx("path",{fill:n,fillRule:"evenodd",d:c}),a.jsx("ellipse",{fill:s,cx:"42.31",cy:21.44,rx:"32.27",ry:"21.44"})]})})},Rg=({lightsComplication:e,lightSlider:t,onSliderChange:n,onButtonPress:s,onButtonRelease:r,getLightsButtonLightColor:o,getLightsSliderLightColors:l,textState:i,pressedBtn:c,sliderShaking:u,onBlueClick:f,onGreenClick:d,onPurpleClick:p,isComplicationActive:y=!1,recentlyFixed:v=!1,isUnlocked:k=!0})=>{const w=l(),m=e.phase==="slider1"||e.phase==="showing";return a.jsxs("g",{id:"Reset_Lights",className:k?"minigame-active":"minigame-inactive",children:[a.jsx("polygon",{fill:"#45486c",points:"608.7 1720.12 341.17 1720.12 341.17 1452.22 564.14 1452.22 608.7 1720.12",className:y?"minigame-active-pulse":v?"minigame-solved-fade":""}),a.jsx("text",{fill:i.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(414.68 1480.38)",children:i.text}),a.jsx("g",{clipPath:"url(#reset-lights-slider-clip)",children:a.jsx("path",{fill:"none",stroke:"#d8672b",strokeWidth:"3",strokeMiterlimit:"10",opacity:"0.25",d:"M417.83,1530.35l-30.21-30.21c-3.04-3.04-7.97-3.04-11.02,0l-30.21,30.21M346.4,1555.03l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M346.4,1580.62l30.21-30.21c3.04-3.04,7.97-3.04,11.02,0l30.21,30.21M417.83,1643.18l-30.21,30.21c-3.04,3.04-7.97,3.04-11.02,0l-30.21-30.21M346.4,1618.5l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21M346.4,1592.91l30.21,30.21c3.04-3.04,7.97,3.04,11.02,0l30.21-30.21"})}),a.jsx(Uo,{x:382.11,y:1587.01,rotation:90,value:t,onChange:n,className:u?"shake":""}),a.jsxs("g",{children:[a.jsx("path",{fill:w.bottom,d:"M382.12,1706.83c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M382.12,1685.25c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1682.25c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.03,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.04-13.03-13.04h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:w.top,d:"M382.12,1489.51c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M382.12,1467.94c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M382.12,1464.94c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.03,13.04-5.85,13.04-13.03-5.85-13.03-13.03-13.03h0Z"})]}),a.jsx(Wl,{x:431.19,y:1495,colorBody:"#3d8380",colorTop:"#96d7dd",isPressed:c==="blue"||m,onPress:()=>s("blue"),onRelease:()=>r("blue",f)}),a.jsxs("g",{children:[a.jsx("path",{fill:o(0),d:"M546.19,1547c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M546.19,1525.42c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M546.19,1522.42c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),a.jsx(Wl,{x:437.5,y:1565,colorBody:"#4c833c",colorTop:"#f6f081",isPressed:c==="green"||m,onPress:()=>s("green"),onRelease:()=>r("green",d)}),a.jsxs("g",{children:[a.jsx("path",{fill:o(1),d:"M554.61,1616.4c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M554.61,1594.82c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04s-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04M554.61,1591.82c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]}),a.jsx(Wl,{x:444.51,y:1635,colorBody:"#803d83",colorTop:"#cb8abc",isPressed:c==="purple"||m,onPress:()=>s("purple"),onRelease:()=>r("purple",p)}),a.jsxs("g",{children:[a.jsx("path",{fill:o(2),d:"M565.12,1689.3c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M565.12,1667.73c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.04h0M565.12,1664.73c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.04h0Z"})]})]})},Df=194.32,$f=1586.66,jg=({localDialRotation:e,isDialDragging:t,dialShaking:n,dialPressed:s,onDialStart:r,onDialPress:o,getControlsCornerLightColor:l,textState:i,isDialAligned:c,isComplicationActive:u,recentlyFixed:f=!1,isUnlocked:d=!0})=>a.jsxs("g",{id:"Reset_Controls",className:d?"minigame-active":"minigame-inactive",children:[a.jsx("path",{fill:"#45486c",d:"M290.21,1663.73c10.78-17.3,17.01-37.73,17.01-59.61,0-23.97-7.48-46.2-20.22-64.48,7.77-.06,15.53-3.05,21.46-8.98,11.98-11.98,11.98-31.4,0-43.37-1.9-1.9-3.99-3.5-6.21-4.8-.5-17.51-14.85-31.56-32.48-31.56H121.34c-17.78,0-32.22,14.28-32.49,32-1.95,1.22-3.81,2.66-5.5,4.36-11.98,11.98-11.98,31.4,0,43.37,5.16,5.16,11.69,8.09,18.42,8.8-12.82,18.31-20.34,40.6-20.34,64.65,0,22.08,6.34,42.67,17.3,60.07-5.63,1.18-11,3.95-15.38,8.32-11.98,11.98-11.98,31.4,0,43.37,11.98,11.98,31.4,11.98,43.37,0,4.44-4.44,7.23-9.91,8.38-15.64,17.22,10.63,37.5,16.77,59.22,16.77,22.93,0,44.26-6.84,62.07-18.59.88,6.39,3.78,12.55,8.69,17.46,11.98,11.98,31.4,11.98,43.37,0,11.98-11.98,11.98-31.4,0-43.37-5.11-5.11-11.58-8.03-18.24-8.78Z",className:u?"minigame-active-pulse":f?"minigame-solved-fade":""}),a.jsx("circle",{fill:"#0d1a19",cx:"194.32",cy:"1604.12",r:"97.6",opacity:"0.3"}),a.jsxs("g",{children:[a.jsx("path",{fill:l(1),d:"M103.94,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M103.94,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:l(0),d:"M288.3,1519.68c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M288.3,1498.11c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1495.11c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:l(2),d:"M103.94,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.54,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M103.94,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M103.94,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),a.jsxs("g",{children:[a.jsx("path",{fill:l(3),d:"M288.3,1708.16c-6.36,0-11.53-5.17-11.53-11.53s5.17-11.54,11.53-11.53,11.53,5.17,11.53,11.53-5.17,11.54-11.53,11.54Z"}),a.jsx("path",{fill:"#1f1f38",d:"M288.3,1686.59c5.54,0,10.03,4.49,10.03,10.03h0c0,5.55-4.49,10.04-10.03,10.04h0c-5.54,0-10.03-4.49-10.03-10.03h0c0-5.55,4.49-10.04,10.03-10.04h0M288.3,1683.59c-7.19,0-13.03,5.85-13.03,13.03s5.85,13.04,13.03,13.04,13.03-5.85,13.03-13.03-5.85-13.04-13.03-13.03h0Z"})]}),a.jsx("text",{fill:i.color,fontFamily:"'Amazon Ember'",fontSize:"19.9",transform:"translate(108.17 1480.38)",children:i.text}),a.jsx("g",{transform:`translate(0 ${s?4:0}) rotate(${Math.round(e)} ${Df} ${$f})`,style:{cursor:t?"grabbing":"grab"},onMouseDown:p=>r(p.clientX,p.clientY),onTouchStart:p=>{p.touches.length>0&&r(p.touches[0].clientX,p.touches[0].clientY)},onClick:o,children:a.jsxs("g",{className:n?"shake":"",children:[a.jsx("circle",{fill:"#d36b28",cx:"194.32",cy:"1586.66",r:"86.84"}),a.jsx("path",{fill:"none",stroke:"#fff",strokeWidth:"6",strokeMiterlimit:"10",d:"M238.98,1629.6c-11.27,11.72-27.11,19.01-44.65,19.01s-32.11-6.72-43.27-17.62"}),a.jsx("g",{transform:"translate(170.65 1623.1) rotate(135) scale(1.74)",children:a.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),a.jsx("g",{transform:"translate(219.09 1623.1) rotate(45) scale(1.74 -1.74)",children:a.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})}),a.jsx("path",{fill:"#fff",d:"M169.51,1524.47l20.43-20.43c1.99-1.99,5.23-1.99,7.22,0l20.43,20.43c3.22,3.22.94,8.72-3.61,8.72h-40.86c-4.55,0-6.83-5.5-3.61-8.72Z"})]})}),u&&c&&a.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"24",fontWeight:"bold",textAnchor:"middle",x:Df,y:$f+8,style:{pointerEvents:"none"},children:"PRESS"})]}),Tg=194.32,Mg=1586.66,bg=({dialRotation:e,monitorOffset:t,periscopeY:n,dragHandlers:s,monitorDragHandlers:r,isMonitorDragging:o,isPeriscopeDragging:l=!1,isSnapping:i=!1,onDialClick:c,onBlueClick:u,onGreenClick:f,onPurpleClick:d,onUpgradesClick:p,onSettingsClick:y,onHelpClick:v,onSetRank:k,onAbortClick:w,upgradeCount:m,screenContent:h,isGameOver:x=!1,isSessionActive:C=!1,rank:j,currentXP:R,nextRankXP:P,shiftScore:S=0,gameStats:T={startTime:0,totalBonusTime:0,maxGroupSize:0,penalty:0},goalsCleared:E=0,goalsTarget:M=0,unspentPower:Q=0,maxTime:ne=75e3,complications:ie=[],onResolveComplication:L,upgradeLevels:ee={},pulsePeriscope:H=!1})=>{const G=(ee.CAPACITOR_EFFICIENCY||0)>=Dn.CAPACITOR_EFFICIENCY.maxLevel,X=(ee.CIRCUIT_STABILIZER||0)>=Dn.CIRCUIT_STABILIZER.maxLevel,V=(ee.GEAR_LUBRICATION||0)>=Dn.GEAR_LUBRICATION.maxLevel,te=Xn(Oe.LASER,j),J=Xn(Oe.LIGHTS,j),pe=Xn(Oe.CONTROLS,j),[Me,he]=g.useState(null),[A,Y]=g.useState(!1),[q,K]=g.useState(!1),{laserSliders:me,updateLaserSlider:ce,shakingSlider:ue,getLaserLightColors:Z,getLaserTextState:Ce,recentlyFixed:ke,isComplicationActive:be}=fg({complications:ie,isLaserMaxed:G,onResolveComplication:L}),{lightsComplication:je,lightSlider:Te,handleLightsButton:Pe,handleLightsSliderChange:Be,lightsSliderShaking:Ie,getLightsButtonLightColor:_,getLightsSliderLightColors:F,getLightsTextState:ve,recentlyFixed:xe,isComplicationActive:_e}=yg({complications:ie,isLightsMaxed:X,pressedBtn:Me,onResolveComplication:L}),{localDialRotation:N,isDialDragging:D,dialShaking:B,dialPressed:U,handleDialStart:le,handleDialMove:b,handleDialEnd:I,handleDialPress:O,getControlsCornerLightColor:$,getControlsTextState:z,recentlyFixed:W,isDialAligned:ge,isComplicationActive:Re}=wg({complications:ie,isControlsMaxed:V,onResolveComplication:L});g.useEffect(()=>{if(!D)return;const oe=Ye=>{b(Ye.clientX,Ye.clientY)},de=()=>{I()},Ve=Ye=>{Ye.touches.length>0&&b(Ye.touches[0].clientX,Ye.touches[0].clientY)},Ge=()=>{I()};return window.addEventListener("mousemove",oe),window.addEventListener("mouseup",de),window.addEventListener("touchmove",Ve),window.addEventListener("touchend",Ge),()=>{window.removeEventListener("mousemove",oe),window.removeEventListener("mouseup",de),window.removeEventListener("touchmove",Ve),window.removeEventListener("touchend",Ge)}},[D]),g.useEffect(()=>{C||K(!1)},[C]);const se=oe=>{he(oe)},ye=(oe,de)=>{Me===oe?(he(null),oe==="blue"?Pe(0):oe==="green"?Pe(1):oe==="purple"&&Pe(2),de&&de()):he(null)},Ne=oe=>{oe.stopPropagation(),Y(de=>!de)},Fe=oe=>{k&&k(oe),Y(!1)},ze=oe=>{oe.stopPropagation(),q?(w&&w(),K(!1)):(K(!0),setTimeout(()=>K(!1),3e3))},We={transition:o?"none":"transform 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},Qe={transition:o?"none":"opacity 0.7s cubic-bezier(0.34, 1.56, 0.64, 1)"},fe=363.9*Math.min(1,Math.max(0,R/P)),Je=Math.min(1,Math.max(0,(t+400)/920)),rt=Math.min(1,Math.max(0,n/300)),ct=Math.max(Je,rt)*.85,Ft="translate(31.92, 399.44)";return a.jsxs("svg",{viewBox:"0 827.84 648 1152",className:"w-full h-full",preserveAspectRatio:"xMidYMid slice",style:{overflow:"hidden"},onClick:()=>{A&&Y(!1)},children:[a.jsxs("defs",{children:[a.jsxs("linearGradient",{id:"console-gradient",x1:"324",y1:"1979.84",x2:"324",y2:"827.84",gradientUnits:"userSpaceOnUse",children:[a.jsx("stop",{offset:"0",stopColor:"#363b5e"}),a.jsx("stop",{offset:"1",stopColor:"#0b1c3f"})]}),a.jsx("clipPath",{id:"reset-lights-slider-clip",children:a.jsx("rect",{x:"356.86",y:"1499.08",width:"50.51",height:"175.86",rx:"6.92",ry:"6.92"})})]}),a.jsxs("g",{id:"Console_Base",children:[a.jsx("polygon",{fill:"#0f1829",points:"42.37 1807.1 54.73 1865.36 592.78 1865.36 605.14 1807.1 42.37 1807.1"}),a.jsx("path",{fill:"#616a79",d:"M615.77,1807.1l14.87-84.85c.65-3.69-2.19-7.08-5.94-7.08H22.81c-3.75,0-6.59,3.38-5.94,7.08l14.87,84.85h584.04Z"}),a.jsx("path",{fill:"#59acae",d:"M583.65,1441.46H63.86l-47.08,283.09c-.6,3.61,2,6.92,5.44,6.92h603.07c3.44,0,6.04-3.31,5.44-6.92l-47.08-283.09Z"}),a.jsxs("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",transform:"translate(55 1855.15)",children:[a.jsx("tspan",{letterSpacing:"-0.04em",children:"V"}),a.jsxs("tspan",{x:"9.49",children:["ersion 1.1.13.",334]})]}),a.jsx("text",{fill:"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"15.7",textAnchor:"end",transform:"translate(592.5 1855.15)",children:"MuzzyMade @ 2026"}),a.jsx("g",{id:"RankSelector",className:x?"pointer-events-none":"cursor-pointer hover:brightness-125 active:brightness-90 transition-all origin-center",onClick:x?void 0:Ne,children:a.jsx("text",{fill:A?"#5bbc70":"#aad9d9",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:A?"bold":"normal",textAnchor:"middle",transform:"translate(323.75 1855.99)",children:"RANK SELECT"})})]}),a.jsxs("g",{transform:"translate(17.28, 1057.14)",children:[a.jsx("path",{fill:"#616a79",fillRule:"evenodd",d:"M597.13,32.56H15.82C6.56,32.56-.51,40.11.03,49.42l18.54,321.98c.39,6.78,5.81,12.28,12.11,12.28h551.59c6.3,0,11.72-5.5,12.11-12.28l18.54-321.98c.54-9.31-6.53-16.86-15.79-16.86Z"}),a.jsx("path",{fill:"#aad9d9",fillRule:"evenodd",d:"M604.74,37.21H8.21c-3.37,0-5.34-4.05-3.17-6.52L23.09,10.16C28.83,3.68,37.14,0,46.03,0h520.89c8.89,0,17.2,3.68,22.94,10.16l18.06,20.52c2.17,2.47.19,6.52-3.17,6.52Z"}),a.jsx("path",{fill:"#1d1d3a",d:"M536.44,362.92H76.51c-21.64,0-40.25-18.8-41.48-41.9l-11.76-220.89c-.6-11.35,3.24-22,10.81-29.99,7.45-7.85,17.63-12.18,28.67-12.18h487.46c11.04,0,21.22,4.33,28.67,12.18,7.58,7.99,11.41,18.64,10.81,29.99l-11.76,220.89c-1.23,23.1-19.84,41.9-41.48,41.9ZM62.75,62.96c-9.65,0-18.55,3.77-25.04,10.62-6.62,6.98-9.98,16.32-9.45,26.28l11.76,220.89c1.09,20.49,17.46,37.17,36.49,37.17h459.93c19.03,0,35.4-16.67,36.49-37.17l11.76-220.89c.53-9.96-2.82-19.3-9.45-26.28-6.49-6.85-15.39-10.62-25.04-10.62H62.75Z"}),a.jsx("path",{fill:"#35385b",fillRule:"evenodd",d:"M550.2,60.46H62.75c-21.59,0-38.15,17.7-36.98,39.53l11.76,220.89c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.76-220.89c1.16-21.83-15.4-39.53-36.98-39.53Z"}),a.jsx("path",{fill:"#474871",fillRule:"evenodd",d:"M549.56,74.42H63.39c-21.53,0-38.04,17.7-36.88,39.53l11.02,206.94c1.16,21.83,18.62,39.53,38.99,39.53h459.93c20.37,0,37.82-17.7,38.99-39.53l11.02-206.94c1.16-21.83-15.35-39.53-36.88-39.53Z",className:be?"minigame-active-pulse-laser":ke?"minigame-solved-fade-laser":""}),a.jsxs("g",{id:"Operator_Rank_-_meter",children:[a.jsx("path",{fill:"#5bbc70",d:"M540.77,147.84H74.51c-5.73,0-10.38-4.66-10.38-10.38s4.66-10.38,10.38-10.38h466.26c5.73,0,10.38,4.66,10.38,10.38s-4.66,10.38-10.38,10.38ZM74.51,128.07c-5.17,0-9.38,4.21-9.38,9.38s4.21,9.38,9.38,9.38h466.26c5.17,0,9.38-4.21,9.38-9.38s-4.21-9.38-9.38-9.38H74.51Z"}),a.jsx("path",{fill:"#5bbc70",d:`M74.51,127.57h${fe}c.66,0,1.2.54,1.2,1.2v17.36c0,.66-.54,1.2-1.2,1.2H74.51c-5.45,0-9.88-4.43-9.88-9.88h0c0-5.45,4.43-9.88,9.88-9.88Z`}),a.jsxs("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontWeight:"600",fontSize:"14",textAnchor:"end",transform:"translate(545 142)",children:[Math.floor(R).toLocaleString()," / ",Math.floor(P).toLocaleString()]}),a.jsx("text",{fill:"#59acae",fontFamily:"'Amazon Ember'",fontSize:"12",textAnchor:"end",transform:"translate(545 118)",children:"PROMOTION THRESHOLD"}),a.jsx("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontWeight:"800",fontSize:"34.88",transform:"translate(239.35 115.28)",children:j}),a.jsxs("text",{fill:"#6acbda",fontFamily:"'Amazon Ember'",fontSize:"20.93",transform:"translate(65.42 113.79)",children:[a.jsx("tspan",{x:"0",y:"0",children:"OPE"}),a.jsx("tspan",{letterSpacing:".02em",x:"40.54",y:"0",children:"R"}),a.jsx("tspan",{letterSpacing:"-.05em",x:"53.68",y:"0",children:"A"}),a.jsx("tspan",{letterSpacing:"-.03em",x:"66.07",y:"0",children:"T"}),a.jsx("tspan",{x:"77.45",y:"0",children:"OR "}),a.jsx("tspan",{letterSpacing:".02em",x:"112.01",y:"0",children:"R"}),a.jsx("tspan",{x:"125.16",y:"0",children:"ANK"})]})]}),a.jsx(Pg,{laserSliders:me,shakingSlider:ue,onSliderChange:ce,getLaserLightColors:Z,textState:Ce(),isComplicationActive:be,recentlyFixed:ke,isUnlocked:te})]}),a.jsx(Rg,{lightsComplication:je,lightSlider:Te,onSliderChange:Be,onButtonPress:se,onButtonRelease:ye,getLightsButtonLightColor:_,getLightsSliderLightColors:F,textState:ve(),pressedBtn:Me,sliderShaking:Ie,onBlueClick:u,onGreenClick:f,onPurpleClick:d,isComplicationActive:_e,recentlyFixed:xe,isUnlocked:J}),a.jsx(jg,{localDialRotation:N,isDialDragging:D,dialShaking:B,dialPressed:U,onDialStart:le,onDialPress:O,getControlsCornerLightColor:$,textState:z(),isDialAligned:ge(),isComplicationActive:Re,recentlyFixed:W,isUnlocked:pe}),a.jsx("circle",{id:"coord-reference",cx:Tg,cy:Mg,r:"1",fill:"transparent",style:{pointerEvents:"none"}}),(C||j>0)&&a.jsx("g",{id:"System_Upgrades",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:C?ze:p,children:C?a.jsxs(a.Fragment,{children:[a.jsx("rect",{fill:"#ef4444",x:"123.18",y:"1748.67",width:"342.8",height:"44.19",rx:"12.37",ry:"12.37"}),a.jsx("rect",{fill:"none",stroke:"#ef4444",strokeMiterlimit:"10",x:"123.45",y:"1748.67",width:"420.29",height:"44.19",rx:"9.43",ry:"9.43"}),a.jsx("text",{fill:"#ffffff",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"294.58",y:"1778.17",children:q?"ARE YOU SURE?":"END SHIFT EARLY"}),a.jsx("text",{fill:"#ef4444",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",transform:"translate(492.79 1783.33)",children:"X"})]}):a.jsxs(a.Fragment,{children:[a.jsx("rect",{fill:"#ffd92b",x:"205",y:"1748.67",width:"160",height:"44.19",rx:"12.37",ry:"12.37"}),a.jsx("rect",{fill:"none",stroke:"#ffd92b",strokeMiterlimit:"10",x:"205",y:"1748.67",width:"238",height:"44.19",rx:"9.43",ry:"9.43"}),a.jsx("text",{fill:"#45486c",fontFamily:"'Amazon Ember'",fontSize:"20.93",fontWeight:"bold",textAnchor:"middle",x:"285",y:"1778.17",children:"UPGRADES"}),a.jsx("text",{fill:"#ffd92b",fontFamily:"'Amazon Ember'",fontWeight:"bold",fontSize:"34.88",textAnchor:"middle",x:"404",y:"1783.33",children:m})]})}),a.jsxs("text",{fill:"#5bbc70",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(210.86 1947.47)",children:[a.jsx("tspan",{letterSpacing:".01em",children:"G"}),a.jsx("tspan",{x:"50.77",children:"O"}),a.jsx("tspan",{letterSpacing:".01em",x:"94.43",children:"O"}),a.jsx("tspan",{letterSpacing:".03em",x:"138.94",children:"P"}),a.jsx("tspan",{x:"182.79",children:"S"})]}),a.jsxs("g",{id:"How_to_Play",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:v,children:[a.jsx("circle",{fill:"#5bbc70",cx:"60.02",cy:"1920.16",r:"42.65"}),a.jsx("text",{fill:"#0f1528",fontFamily:"'From Where You Are'",fontSize:"62.79",transform:"translate(43.23 1951.29)",children:"?"})]}),a.jsxs("g",{id:"Settings",className:"cursor-pointer hover:brightness-110 active:brightness-90 transition-all origin-center",onClick:y,children:[a.jsx("circle",{fill:"#5bbc70",cx:"586.51",cy:"1921.29",r:"42.65"}),a.jsx("path",{fill:"#0f1528",d:"M575.34,1888.9c1.31-.22,2.74.1,3.77.94.53.43.76,1.11,1.28,1.57,3.07,2.69,6.81,3.17,10.41,1.27,2.93-1.54,3.23-4.63,7.35-3.65,2.47.59,8.3,3.99,10.15,5.79,3.3,3.22.52,5.23.71,8.67.17,3.07,2.34,6.18,5.12,7.42,2.12.95,4.78.73,5.84,3.27s.95,10.11.24,12.77c-1.23,4.62-4.11,3.02-7.31,4.93-2.36,1.42-4.2,4.72-4.2,7.5s1.94,4.09.64,6.88c-1.06,2.28-8.15,6.41-10.64,7.02-3.9.96-4.47-2.07-6.97-3.74-2.65-1.77-6.22-1.75-9.02-.28-3.07,1.61-3.15,5.19-7.61,4.38-2.27-.42-8.91-4.29-10.53-5.98-2.69-2.79-.66-4.28-.3-6.87.55-3.94-1.21-8.15-4.99-9.77-2.48-1.06-5.42-.37-6.52-3.73-.83-2.52-.68-11.58.66-13.88,1.2-2.06,3.02-1.68,4.85-2.27,4.19-1.36,6.81-5.14,6.29-9.6-.29-2.49-1.96-4.37.32-6.86,1.42-1.56,8.41-5.43,10.46-5.77ZM586.19,1909.97c-14.67.42-14.14,22.83.44,22.69,14.84-.14,14.53-23.12-.44-22.69Z"})]}),a.jsx("rect",{x:"0",y:"827.84",width:"648",height:"1152",fill:"#000",style:{opacity:ct,...Qe,pointerEvents:"none"}}),a.jsxs("g",{id:"Periscope",className:H?"periscope-pulse":"",transform:`translate(0, ${n})`,style:{transition:l||i?"none":"transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"grab"},...s,children:[a.jsx("rect",{fill:"#087962",x:"22.36",y:"978.45",width:"603.66",height:"51.13",rx:"11.03",ry:"11.03"}),a.jsx("path",{fill:"#087962",d:"M 390.17 -1000 V 1111.98 c 0 13.74 -11.16 24.9 -24.9 24.9 h -88.54 c -13.74 0 -24.9 -11.16 -24.9 -24.9 V -1000 H 390.17 Z"}),a.jsxs("g",{children:[a.jsx("path",{fill:"#5bbc70",fillRule:"evenodd",d:"M252.54,1089.77c-23.25,0-45.07-9.09-61.45-25.59-16.38-16.5-25.3-38.39-25.13-61.64.35-47.38,39.59-85.92,87.47-85.92h138.58c23.99,0,46.29,9.59,62.81,26.99,16.51,17.4,24.9,40.21,23.64,64.23-2.4,45.72-40.19,81.7-86.02,81.93h-.44c-24.04,0-47.19-10.12-63.53-27.77-2.19-2.36-4.86-2.71-6.27-2.71s-3.96.34-6.05,2.61c-16.35,17.72-39.54,27.87-63.63,27.87Z"}),a.jsx("path",{fill:"#0b1c3f",fillRule:"evenodd",d:"M392.01,931.91h-138.58c-39.31,0-71.89,31.44-72.18,70.75-.29,39.62,31.74,71.83,71.29,71.83,20.72,0,39.37-8.84,52.39-22.95,9.32-10.1,25.43-10,34.77.09,13.09,14.14,31.85,22.97,52.67,22.87,37.55-.18,68.86-29.95,70.83-67.44,2.16-41.12-30.54-75.13-71.19-75.13Z"}),a.jsx("path",{fill:"#373a60",fillRule:"evenodd",d:"M392.02,1054.51c-14.46,0-27.83-5.85-37.66-16.46-8.25-8.91-19.96-14.02-32.14-14.02s-23.79,5.09-31.97,13.96c-9.83,10.66-23.23,16.53-37.71,16.53s-26.71-5.39-36.42-15.17c-9.71-9.78-15-22.76-14.89-36.54.21-28.08,23.63-50.92,52.21-50.92h138.58c14.22,0,27.44,5.68,37.23,16,9.78,10.31,14.76,23.84,14.01,38.11-1.42,27.07-23.82,48.38-50.98,48.52h-.26Z"})]}),a.jsx("g",{transform:"translate(303.67 1091.18) scale(1.74)",children:a.jsx("path",{fill:"#fff",d:"M21.05,1.52v.45l-.14.45c-2.77,3.62-5.81,7.05-8.67,10.61-.73.94-1.94,1.07-2.8.21L.54,3.02C.27,2.71.1,2.38,0,1.98c.01-.15-.02-.31,0-.45C.1.77.79.08,1.55,0h17.84c.82.02,1.56.72,1.66,1.52ZM19.57,7.83c-.69.84-1.38,1.67-2.07,2.49-1.14,1.37-2.32,2.78-3.45,4.18-.81,1.04-2.03,1.66-3.31,1.66-1.1,0-2.15-.45-2.96-1.27l-.05-.05L1.62,7.81h-.07c-.76.08-1.45.77-1.54,1.52-.02.14.01.31,0,.45.09.41.26.74.54,1.05l8.9,10.22c.86.87,2.06.73,2.8-.21,2.86-3.56,5.91-6.99,8.67-10.61l.14-.45v-.45c-.09-.74-.74-1.39-1.48-1.5Z"})})]}),a.jsx("g",{transform:`translate(0, ${t})`,style:{...We,cursor:x?"grab":"default",pointerEvents:x?"auto":"none",touchAction:x?"none":"auto"},...x&&o!==void 0?r:{},children:x?a.jsx("g",{transform:Ft,children:a.jsx(lg,{shiftScore:S,rank:j,xpCurrent:R,xpNext:P,cracksFilled:E,cracksTarget:M,pressureVented:T.totalBonusTime||0,maxTime:ne,massPurged:T.maxGroupSize||0,leftoverPenalty:T.penalty||0,unspentPower:Q,isWin:E>=M})}):a.jsxs(a.Fragment,{children:[a.jsx("path",{fill:"#f2a743",d:"M48.78,432h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H44.2c-6.78,0-12.28-5.5-12.28-12.28V448.86c0-9.31,7.55-16.86,16.86-16.86Z"}),a.jsx("path",{fill:"#d36b28",d:"M606.65,436.65H40.86c-3.39,0-5.14-4.05-2.82-6.52l19.25-20.52c6.08-6.49,14.58-10.16,23.47-10.16h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),a.jsx("path",{fill:"none",stroke:"#1d1d3a",strokeWidth:"5",strokeMiterlimit:"10",d:"M592.34,1246.25c0,21.83-17.7,39.53-39.53,39.53H94.71c-21.83,0-39.53-17.7-39.53-39.53V499.44c0-21.83,17.7-39.53,39.53-39.53h458.1c21.83,0,39.53,17.7,39.53,39.53v746.81Z"}),a.jsx("rect",{fill:"#1f1f38",x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),a.jsx("foreignObject",{x:"55.17",y:"459.91",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53",children:a.jsx("div",{className:"w-full h-full overflow-hidden rounded-[39px]",children:h})}),a.jsx("g",{pointerEvents:"none",children:a.jsx("path",{fill:"none",stroke:"#5bbc70",strokeWidth:"1",strokeOpacity:"0.2",d:"M94.71,474.42h458.1c21.82,0,39.53,17.71,39.53,39.53v732.85c0,21.82-17.71,39.53-39.53,39.53H94.71c-21.82,0-39.53-17.71-39.53-39.53V513.95c0-21.82,17.71-39.53,39.53-39.53Z"})})]})}),A&&!x&&a.jsx("foreignObject",{x:"200",y:"1550",width:"250",height:"300",children:a.jsxs("div",{onClick:oe=>oe.stopPropagation(),style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(180deg, #1d1d3a 0%, #0f1829 100%)",border:"2px solid #5bbc70",borderRadius:"8px",overflow:"hidden"},children:[a.jsx("div",{style:{padding:"8px 12px",borderBottom:"1px solid #5bbc70",color:"#5bbc70",fontFamily:"Amazon Ember, sans-serif",fontWeight:"bold",fontSize:"14px",textAlign:"center"},children:"SELECT RANK"}),a.jsx("div",{style:{flex:1,overflowY:"auto",padding:"4px"},children:Array.from({length:51},(oe,de)=>a.jsx("div",{onClick:()=>Fe(de),style:{padding:"8px 12px",color:de===0?"#f87171":de===j?"#5bbc70":"#aad9d9",fontFamily:"Amazon Ember, sans-serif",fontSize:"14px",cursor:"pointer",borderRadius:"4px",background:de===j?"rgba(91, 188, 112, 0.2)":"transparent",fontWeight:de===j?"bold":"normal",transition:"background 0.15s"},onMouseEnter:Ve=>{de!==j&&(Ve.currentTarget.style.background="rgba(170, 217, 217, 0.1)")},onMouseLeave:Ve=>{de!==j&&(Ve.currentTarget.style.background="transparent")},children:de===0?"0 - WIPE DATA":`Rank ${de}`},de))})]})})]})},Ag=[{id:"actives",label:"TOOLS",unlockRank:5,color:"#fbbf24"},{id:"features",label:"FEATURES",unlockRank:20,color:"#a78bfa"},{id:"complications",label:"SYSTEMS",unlockRank:2,color:"#f97316"},{id:"passives",label:"UTILITY",unlockRank:3,color:"#5bbc70"}],Eg=(e,t)=>t==="active"?{accent:"#b45309",text:"#fbbf24"}:t==="feature"?{accent:"#7c3aed",text:"#a78bfa"}:e==="CAPACITOR_EFFICIENCY"?{accent:"#d82727",text:"#ff6b6b"}:e==="CIRCUIT_STABILIZER"?{accent:"#d36b28",text:"#ffa94d"}:e==="GEAR_LUBRICATION"?{accent:"#2d5a87",text:"#74c0fc"}:{accent:"#2d7a4d",text:"#5bbc70"},Ig=({scraps:e,upgrades:t,rank:n,onPurchase:s,onRefund:r,onClose:o,equippedActives:l=[],onToggleEquip:i,maxActiveSlots:c=1})=>{var S;const u=Ag.filter(T=>T.unlockRank<=n),[f,d]=g.useState(((S=u[0])==null?void 0:S.id)||"complications"),[p,y]=g.useState(!1),v=g.useRef(0),k=g.useRef(0),w=50,m=(T,E)=>{y(!0),v.current=T,k.current=E},h=(T,E)=>{if(!p)return;y(!1);const M=T-v.current,Q=E-k.current;if(Math.abs(M)>Math.abs(Q)&&Math.abs(M)>w){const ne=u.findIndex(ie=>ie.id===f);M>0&&ne<u.length-1?d(u[ne+1].id):M<0&&ne>0&&d(u[ne-1].id)}};g.useEffect(()=>{const T=M=>{p&&h(M.clientX,M.clientY)},E=M=>{p&&M.changedTouches[0]&&h(M.changedTouches[0].clientX,M.changedTouches[0].clientY)};return p&&(window.addEventListener("mouseup",T),window.addEventListener("touchend",E)),()=>{window.removeEventListener("mouseup",T),window.removeEventListener("touchend",E)}},[p,f,u]);const C=(()=>{const T=Object.values(Dn).filter(E=>E.unlockRank<=n);switch(f){case"actives":return T.filter(E=>E.type==="active").sort((E,M)=>E.unlockRank-M.unlockRank);case"features":return T.filter(E=>E.type==="feature").sort((E,M)=>E.unlockRank-M.unlockRank);case"complications":return T.filter(E=>E.category==="complication").sort((E,M)=>E.unlockRank-M.unlockRank);case"passives":return T.filter(E=>E.type==="passive"&&E.category!=="complication").sort((E,M)=>E.unlockRank-M.unlockRank);default:return[]}})(),j=u.length>0,R=T=>{const E=t[T.id]||0,M=E>=T.maxLevel,ne=e>=T.costPerLevel&&!M,ie=E>0,L=Eg(T.id,T.type),ee=T.type==="active",H=l.includes(T.id);return a.jsxs("div",{className:"rounded-xl p-4 border",style:{backgroundColor:"#0c0f19",borderColor:ee&&H?"#5bbc70":"#ffffff40"},children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-bold tracking-wide t-body",style:{color:L.text},children:T.name}),a.jsx("p",{style:{color:"#59acae"},className:"mt-1 t-body",children:T.desc})]}),ee&&E>0&&i&&a.jsx("button",{onClick:()=>i(T.id),disabled:!H&&l.length>=c,className:"ml-2 px-3 py-1 rounded-lg font-bold t-body border-2 transition-all",style:{borderColor:H?"#5bbc70":"#59acae60",color:H?"#5bbc70":"#59acae",backgroundColor:H?"#5bbc7020":"transparent",cursor:!H&&l.length>=c?"not-allowed":"pointer",opacity:!H&&l.length>=c?.5:1},children:H?"ON":"OFF"})]}),a.jsxs("div",{className:"flex items-center gap-3 my-3",children:[a.jsx("button",{onClick:()=>ie&&(r==null?void 0:r(T.id)),disabled:!ie,className:"w-8 h-8 rounded-lg font-bold t-heading border-2 transition-all flex items-center justify-center",style:{borderColor:ie?L.accent:"#59acae30",color:ie?L.text:"#59acae40",backgroundColor:ie?L.accent+"20":"transparent",cursor:ie?"pointer":"not-allowed"},children:""}),a.jsx("div",{className:"flex gap-1 flex-1 justify-center",children:Array.from({length:T.maxLevel}).map((G,X)=>a.jsx("div",{className:"h-4 rounded-sm border flex-1 max-w-8",style:{borderColor:X<E?L.accent:"#59acae40",backgroundColor:X<E?L.accent:"transparent"}},X))}),a.jsx("button",{onClick:()=>ne&&s(T.id),disabled:!ne,className:"w-8 h-8 rounded-lg font-bold t-heading border-2 transition-all flex items-center justify-center",style:{borderColor:ne?L.accent:"#59acae30",color:ne?L.text:"#59acae40",backgroundColor:ne?L.accent+"20":"transparent",cursor:ne?"pointer":"not-allowed"},children:"+"}),a.jsxs("span",{className:"font-bold w-12 text-right t-body",style:{color:L.text},children:[E,"/",T.maxLevel]})]}),a.jsxs("div",{className:"flex justify-between items-start t-body",children:[a.jsx("div",{style:{color:"#ffffff"},children:ee?a.jsxs(a.Fragment,{children:["Effect: ",T.formatEffect(1)]}):E>0?a.jsxs(a.Fragment,{children:["Current: ",T.formatEffect(E)]}):a.jsx("span",{style:{color:"#59acae"},children:"Current: Spend points to upgrade"})}),M&&T.maxLevelBonus&&a.jsxs("div",{className:"italic text-right ml-2",style:{color:"#5bbc70"},children:["Max: ",T.maxLevelBonus]})]})]},T.id)},P=()=>u.length===0?null:a.jsx("div",{className:"flex w-full mb-3",style:{height:"36px"},children:u.map(T=>{const E=f===T.id;return a.jsx("button",{onClick:()=>d(T.id),className:"font-bold text-center transition-all t-body",style:{width:"25%",backgroundColor:E?T.color+"30":"transparent",color:E?T.color:"#59acae",borderBottom:E?`3px solid ${T.color}`:"3px solid transparent",padding:"8px 4px",fontFamily:"'From Where You Are', sans-serif",letterSpacing:"0.05em"},children:T.label},T.id)})});return a.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm",children:a.jsxs("div",{className:"relative",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:[a.jsxs("svg",{viewBox:"0 0 583.67 910",className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[a.jsx("path",{fill:"#f2a743",d:"M16.86,32.56h549.95c9.31,0,16.86,7.55,16.86,16.86v847.89c0,6.78-5.5,12.28-12.28,12.28H12.28c-6.78,0-12.28-5.5-12.28-12.28V49.42c0-9.31,7.55-16.86,16.86-16.86Z"}),a.jsx("path",{fill:"#d36b28",d:"M574.73,37.21H8.94c-3.39,0-5.14-4.05-2.82-6.52L25.37,10.16C31.46,3.68,39.96,0,48.85,0h485.98c8.89,0,17.39,3.68,23.47,10.16l19.25,20.52c2.32,2.47.57,6.52-2.82,6.52Z"}),a.jsx("path",{fill:"#1d1d3a",d:"M520.88,888.84H62.79c-23.18,0-42.03-18.86-42.03-42.03V100c0-23.18,18.86-42.03,42.03-42.03h458.1c23.18,0,42.03,18.86,42.03,42.03v746.81c0,23.18-18.86,42.03-42.03,42.03ZM62.79,62.96c-20.42,0-37.03,16.61-37.03,37.03v746.81c0,20.42,16.61,37.03,37.03,37.03h458.1c20.42,0,37.03-16.61,37.03-37.03V100c0-20.42-16.61-37.03-37.03-37.03H62.79Z"}),a.jsx("rect",{fill:"#1f1f38",x:"23.26",y:"60.46",width:"537.16",height:"825.87",rx:"39.53",ry:"39.53"}),a.jsx("text",{fill:"#f2a743",fontFamily:"'From Where You Are'",fontSize:"28",transform:"translate(50 105)",children:"UPGRADES"}),a.jsxs("text",{fill:"#5bbc70",fontFamily:"'Amazon Ember'",transform:"translate(530 105)",textAnchor:"end",children:[a.jsx("tspan",{fontSize:"16",fontWeight:"600",children:"SCRAPS: "}),a.jsx("tspan",{fontSize:"32",fontWeight:"800",children:e})]}),a.jsxs("foreignObject",{x:"40",y:"125",width:"503",height:"720",children:[a.jsx("style",{children:".upgrade-scroll::-webkit-scrollbar { display: none; }"}),a.jsx("div",{xmlns:"http://www.w3.org/1999/xhtml",className:"upgrade-scroll w-full h-full overflow-y-auto",style:{fontFamily:"'Amazon Ember', sans-serif",scrollbarWidth:"none",msOverflowStyle:"none"},onMouseDown:T=>m(T.clientX,T.clientY),onTouchStart:T=>m(T.touches[0].clientX,T.touches[0].clientY),children:j?a.jsxs("div",{className:"pb-20",children:[a.jsx("div",{className:"t-body mb-3 text-center",style:{color:"#fbbf24",fontFamily:"'Amazon Ember', sans-serif"},children:"Earn Scraps by Increasing your Operator Rank"}),P(),a.jsx("div",{className:"space-y-3",children:C.length>0?C.map(R):a.jsx("div",{className:"text-center py-8 t-body",style:{color:"#59acae"},children:"No upgrades available in this category yet."})})]}):a.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center",children:[a.jsx("p",{className:"t-heading tracking-wide mb-3",style:{color:"#6acbda",fontFamily:"'From Where You Are', sans-serif"},children:"NO UPGRADES AVAILABLE"}),a.jsx("p",{className:"t-body",style:{color:"#59acae"},children:"Reach Rank 2 to unlock your first upgrade"})]})})]})]}),a.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:a.jsx("button",{onClick:o,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:a.jsx(xl,{className:"w-1/2 h-1/2 stroke-[3]"})})})]})})},_g=({engine:e,state:t,careerScore:n,scraps:s,powerUps:r={},onOpenSettings:o,onOpenHelp:l,onOpenUpgrades:i,onSetRank:c,onPurchaseUpgrade:u,onRefundUpgrade:f,onDismissGameOver:d,equippedActives:p=[],onToggleEquip:y,pulsePeriscope:v=!1})=>{const k=t.shiftScore>0||t.gameOver;let w;if(k){const ue=t.goalsCleared>=t.goalsTarget,{newCareerScore:Z}=O0(e.initialTotalScore,t.shiftScore,ue);w=gt(Z)}else w=gt(n);const[m,h]=g.useState(!1),x=g.useRef(null),[C,j]=g.useState(0),[R,P]=g.useState(!1),[S,T]=g.useState(!1),E=g.useRef(0),M=200,Q=300,[ne,ie]=g.useState(0),[L,ee]=g.useState(!1),H=g.useRef(0),G=150,[X,V]=g.useState(0);g.useEffect(()=>{if(!t.gameOver){const ue=setInterval(()=>{V(Z=>(Z+1)%2)},2e3);return()=>clearInterval(ue)}},[t.gameOver]),g.useEffect(()=>{t.phase===qe.ConsoleScreen&&!t.gameOver&&(j(Q),T(!0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{T(!1),j(0)})}))},[t.phase,t.gameOver]);const te=ue=>{t.gameOver||(P(!0),E.current=ue-C)},J=ue=>{if(!R)return;const Z=ue-E.current,Ce=Math.max(0,Math.min(Q,Z));j(Ce)},pe=()=>{R&&(P(!1),C>M?(e.execute(new Ws(qe.TankScreen)),setTimeout(()=>j(0),1e3)):j(0))},Me=ue=>{t.gameOver&&(ee(!0),H.current=ue-ne)},he=ue=>{if(!L)return;const Z=ue-H.current,Ce=Math.min(0,Z);ie(Ce)},A=()=>{L&&(ee(!1),ne<-G&&d&&d(),ie(0))};g.useEffect(()=>{const ue=be=>{R&&J(be.clientY),L&&he(be.clientY)},Z=()=>{R&&pe(),L&&A()},Ce=be=>{R&&J(be.touches[0].clientY),L&&he(be.touches[0].clientY)},ke=()=>{R&&pe(),L&&A()};return(R||L)&&(window.addEventListener("mousemove",ue),window.addEventListener("mouseup",Z),window.addEventListener("touchmove",Ce),window.addEventListener("touchend",ke)),()=>{window.removeEventListener("mousemove",ue),window.removeEventListener("mouseup",Z),window.removeEventListener("touchmove",Ce),window.removeEventListener("touchend",ke)}},[R,C,L,ne]);const Y=()=>{e.abortRun()},q=e.isSessionActive&&!t.gameOver,me=(t.gameOver?520:-400)+ne,ce=()=>a.jsx("div",{className:"w-full h-full flex flex-col items-center pt-24 font-mono overflow-hidden text-center select-none",children:a.jsx("div",{className:"mt-auto mb-4 flex flex-col items-center",children:q?X===0?a.jsx("div",{className:"text-[#5bbc70] t-display font-black tracking-widest font-['From_Where_You_Are'] animate-pulse",children:"CLEANING..."}):a.jsxs("div",{className:"text-[#f1a941] t-display font-black tracking-widest font-['From_Where_You_Are']",children:[Math.floor((1-t.shiftTime/e.maxTime)*100),"% PSI"]}):X===0?a.jsx("div",{className:"text-[#f1a941] t-heading font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"TO START SHIFT"}):a.jsx("div",{className:"text-[#f1a941] t-heading font-black tracking-widest font-['From_Where_You_Are'] animate-pulse leading-none",children:"PULL DOWN PERISCOPE"})})});return a.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),a.jsx("div",{ref:x,className:"relative z-10 select-none flex items-center justify-center",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:a.jsx("div",{className:"w-full h-full shadow-2xl relative",children:a.jsx(bg,{dialRotation:0,monitorOffset:me,periscopeY:C,dragHandlers:{onMouseDown:ue=>te(ue.clientY),onTouchStart:ue=>te(ue.touches[0].clientY)},monitorDragHandlers:{onMouseDown:ue=>Me(ue.clientY),onTouchStart:ue=>Me(ue.touches[0].clientY)},isMonitorDragging:L,isPeriscopeDragging:R,isSnapping:S,onSettingsClick:o,onHelpClick:l,onUpgradesClick:()=>h(!0),onSetRank:c,onAbortClick:Y,upgradeCount:s,screenContent:t.gameOver?null:a.jsx(ce,{}),isGameOver:t.gameOver,isSessionActive:e.isSessionActive,rank:w.rank,currentXP:w.progress,nextRankXP:w.toNextRank,shiftScore:t.shiftScore,gameStats:t.gameStats,goalsCleared:t.goalsCleared,goalsTarget:t.goalsTarget,unspentPower:s,maxTime:e.maxTime,complications:t.complications,onResolveComplication:ue=>e.execute(new og(ue)),upgradeLevels:r,pulsePeriscope:v})})}),m&&a.jsx(Ig,{scraps:s,upgrades:r,rank:w.rank,onPurchase:ue=>u==null?void 0:u(ue),onRefund:ue=>f==null?void 0:f(ue),onClose:()=>h(!1),equippedActives:p,onToggleEquip:y,maxActiveSlots:1+(r.ACTIVE_EXPANSION_SLOT||0)+(r.ACTIVE_EXPANSION_SLOT_2||0)})]})};function Xl(e){return`${e.x},${e.y}`}function Ff(e){if(e.length<=1)return!0;const t=new Set(e.map(Xl)),n=new Set,s=[e[0]];for(;s.length>0;){const r=s.shift(),o=Xl(r);if(n.has(o))continue;n.add(o);const l=[{x:r.x,y:r.y+1},{x:r.x,y:r.y-1},{x:r.x+1,y:r.y},{x:r.x-1,y:r.y}];for(const i of l){const c=Xl(i);t.has(c)&&!n.has(c)&&s.push(i)}}return n.size===e.length}function Og(e){const t=e.length;if(t<2)return null;let n=null,s=1/0;for(let r=1;r<(1<<t)-1;r++){const o=[],l=[];for(let f=0;f<t;f++)r&1<<f?o.push(f):l.push(f);const i=o.map(f=>e[f]),c=l.map(f=>e[f]);if(!Ff(i)||!Ff(c))continue;const u=Math.abs(o.length-l.length);if(u<s&&(s=u,n=[o,l],u===0))break}return n}function Gf(e,t,n){const s=Og(e.cells);if(!s)return{...e,color:t};const[r]=s,o=new Set(r),l=e.cells.map((i,c)=>o.has(c)?t:n);return{...e,color:t,cellColors:l}}const Bf=5e3;class Lg{trySpawnGoal(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{goal:null,newLastSpawnTime:l};const i=Date.now();if(i-l<=Bf)return{goal:null,newLastSpawnTime:l};const c=gt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=kf(n,t.goalMarks,c,r,o,u);return f?(u&&t.crackDownRemaining--,Tt.playPop(1),{goal:f,newLastSpawnTime:i}):{goal:null,newLastSpawnTime:i}}trySpawnCrack(t,n,s,r,o,l){if(t.goalsCleared>=t.goalsTarget)return{crack:null,newLastSpawnTime:l};const i=Date.now();if(i-l<=Bf)return{crack:null,newLastSpawnTime:l};const c=gt(s+t.shiftScore).rank,u=t.crackDownRemaining>0,f=t.crackCells.map(p=>({id:p.id,x:p.x,y:p.y,color:p.color,spawnTime:p.spawnTime})),d=kf(n,f,c,r,o,u);if(d){console.log(`[CRACK] SPAWN via GoalManager at (${d.x}, ${d.y}) color=${d.color} source="GoalManager-trySpawnCrack" time=${new Date().toLocaleTimeString()}`);const p={id:d.id,x:d.x,y:d.y,color:d.color,originCrackId:[],branchCrackIds:[],lastGrowthCheck:i,crackBranchInterval:7e3+Math.random()*5e3,spawnTime:d.spawnTime};return u&&t.crackDownRemaining--,Tt.playPop(1),{crack:p,newLastSpawnTime:i}}return{crack:null,newLastSpawnTime:i}}handleGoals(t,n,s,r,o){if(n.forEach(l=>{const i=t.goalMarks.find(u=>u.id===l);i&&(i.plugged=!0);const c=t.crackCells.find(u=>u.id===l);c&&(c.plugged=!0)}),n.length>0){const l=Xe(r.x),i=Math.floor(r.y),c=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:c,text:"Plugged!",x:l,y:i,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(u=>u.id!==c),o()},1e3),ae.emit(re.GOAL_PLUGGED,{count:n.length})}}handleCrackConsumption(t,n,s,r){if(n.length===0)return;n.forEach(c=>{const u=t.goalMarks.find(d=>d.id===c);u&&(u.plugged=!0);const f=t.crackCells.find(d=>d.id===c);f&&(f.plugged=!0)});const o=Xe(s.x),l=Math.floor(s.y),i=Math.random().toString(36).substr(2,9);t.floatingTexts.push({id:i,text:n.length>1?`Plugged ${n.length}`:"Plugged!",x:o,y:l,life:1,color:"#facc15"}),setTimeout(()=>{t.floatingTexts=t.floatingTexts.filter(c=>c.id!==i),r()},1e3),ae.emit(re.GOAL_PLUGGED,{count:n.length})}countCracks(t){if(t.length===0)return 0;const n=new Set;let s=0;for(const r of t){if(n.has(r.id))continue;const o=[r.id];for(;o.length>0;){const l=o.shift();if(n.has(l))continue;n.add(l);const i=t.find(c=>c.id===l);i&&(i.originCrackId.forEach(c=>{n.has(c)||o.push(c)}),i.branchCrackIds.forEach(c=>{n.has(c)||o.push(c)}))}s++}return s}getConnectedComponent(t,n){const s=new Set,r=[],o=[t];for(;o.length>0;){const l=o.shift();if(s.has(l))continue;s.add(l);const i=n.find(c=>c.id===l);i&&(r.push(i),i.originCrackId.forEach(c=>{s.has(c)||o.push(c)}),i.branchCrackIds.forEach(c=>{s.has(c)||o.push(c)}))}return r}isLeafCell(t,n){const s=n.find(r=>r.id===t);return s?s.branchCrackIds.length===0:!0}}const rc=new Lg,Ng=8;class Dg{tickGrowth(t,n,s,r){var i;if(gt(n).rank<30||t.phase===qe.ConsoleScreen||t.phase===qe.COMPLICATION_MINIGAME)return;const l=Date.now();for(const c of t.crackCells){if((i=t.grid[c.y])!=null&&i[c.x]||l-c.lastGrowthCheck<c.crackBranchInterval)continue;c.lastGrowthCheck=l,c.crackBranchInterval=5e3+Math.random()*5e3;const u=Math.max(0,1-t.shiftTime/r),f=Math.min(1,.1+u),p=(s.SLOW_CRACKS||0)*.05;let y=Math.max(0,f-p);c.branchCrackIds.length===0&&(y*=.5);const k=this.getDistanceFromRoot(c,t.crackCells),w=Math.max(.1,1-k*.25);if(y*=w,Math.random()>y)continue;const m=[{x:Xe(c.x+1),y:c.y},{x:Xe(c.x-1),y:c.y},{x:c.x,y:c.y+1},{x:c.x,y:c.y-1},{x:Xe(c.x+1),y:c.y-1},{x:Xe(c.x-1),y:c.y-1},{x:Xe(c.x+1),y:c.y+1},{x:Xe(c.x-1),y:c.y+1}],h=[];for(const C of m){if(C.y<nt||C.y>=De)continue;const j=t.crackCells.find(P=>P.x===C.x&&P.y===C.y&&P.color===c.color);if(j){!c.branchCrackIds.includes(j.id)&&!c.originCrackId.includes(j.id)&&h.push({...C,existingCrack:j});continue}t.crackCells.find(P=>P.x===C.x&&P.y===C.y)||t.grid[C.y][C.x]||h.push(C)}if(h.length===0)continue;const x=h[Math.floor(Math.random()*h.length)];if(x.existingCrack)x.existingCrack.originCrackId.push(c.id),c.branchCrackIds.push(x.existingCrack.id);else{if(rc.countCracks(t.crackCells)>=Ng)continue;const j={id:Math.random().toString(36).substr(2,9),x:x.x,y:x.y,color:c.color,originCrackId:[c.id],branchCrackIds:[],lastGrowthCheck:l,crackBranchInterval:5e3+Math.random()*5e3,spawnTime:l};c.branchCrackIds.push(j.id),console.log(`[CRACK] SPAWN id=${j.id} at (${j.x}, ${j.y}) color=${j.color} source="CrackManager-branch" time=${new Date().toLocaleTimeString()} totalCracks=${t.crackCells.length+1}`),t.crackCells.push(j),t.goalMarks.push({id:j.id,x:j.x,y:j.y,color:j.color,spawnTime:j.spawnTime})}}}getDistanceFromRoot(t,n){if(t.originCrackId.length===0)return 0;let s=0,r=t.id;const o=new Set;for(;!o.has(r);){o.add(r);const l=n.find(i=>i.id===r);if(!l||l.originCrackId.length===0||(s++,r=l.originCrackId[0],s>20))break}return s}}const zf=780,Yf=8,Hf=500,$g=80,Fg=.03;class Gg{constructor(t,n={},s=[]){He(this,"state");He(this,"listeners",new Set);He(this,"maxTime",Oo);He(this,"lockStartTime",null);He(this,"lockResetCount",0);He(this,"usePhysicsForFalling",!1);He(this,"freezeTimer",!1);He(this,"freezeFalling",!1);He(this,"devOverrideNextGoop",null);He(this,"lastGoalSpawnTime",0);He(this,"lastComplicationCheckTime",0);He(this,"isFastDropping",!1);He(this,"wasFastDropping",!1);He(this,"lightsOverflarePhase","none");He(this,"lightsOverflareTime",0);He(this,"lightsFlickerTime",0);He(this,"lightsFlickerActive",!1);He(this,"lightsGracePausedAt",null);He(this,"initialTotalScore",0);He(this,"powerUps",{});He(this,"isSessionActive",!1);He(this,"isTrainingMode",!1);He(this,"maxPieceSize",null);He(this,"pendingTrainingPalette",null);He(this,"trainingAllowedControls",null);He(this,"trainingPressureRate",0);He(this,"trainingHighlightColor",null);He(this,"trainingPopLowersPressure",!1);He(this,"equippedActives",[]);He(this,"crackManager");He(this,"pendingTotalScore",null);this.initialTotalScore=t,this.powerUps=n,this.equippedActives=s;const r=gt(t).rank,l=Rn(r).length+r;this.state={grid:Cf(r,n),tankRotation:0,activeGoop:null,storedGoop:null,nextGoop:null,shiftScore:0,gameOver:!1,isPaused:!1,canSwap:!0,level:1,cellsCleared:0,popStreak:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:Oo,scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},gameStats:{startTime:0,totalBonusTime:0,maxGroupSize:0},floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:l,phase:qe.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Oe.LIGHTS]:0,[Oe.CONTROLS]:0,[Oe.LASER]:0},activeCharges:{},crackGoopPopped:0,colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.applyUpgrades(),this.crackManager=new Dg}randomThreshold(){return Math.floor(Math.random()*13)+12}hasAdjacentWild(t,n){for(const s of n.cells){const r=Xe(n.x+s.x),o=Math.floor(n.y+s.y);if(o<0||o>=De)continue;const l=[{x:Xe(r+1),y:o},{x:Xe(r-1),y:o},{x:r,y:o+1},{x:r,y:o-1}];for(const i of l)if(i.y>=0&&i.y<De){const c=t[i.y][i.x];if(c!=null&&c.isWild)return!0}}return!1}execute(t){t.execute(this)}applyUpgrades(){let t=Oo;const n=this.powerUps.PRESSURE_CONTROL||0;if(n>0){const s=n*5*1e3;t+=s}this.maxTime=t,this.state.gameStats.startTime===0&&(this.state.shiftTime=this.maxTime)}subscribe(t){return this.listeners.add(t),()=>this.listeners.delete(t)}emitChange(){this.listeners.forEach(t=>t())}syncTotalScore(t){this.state.gameOver?this.pendingTotalScore=t:(this.initialTotalScore=t,this.pendingTotalScore=null)}startRun(){this.isTrainingMode=!1,this.maxPieceSize=null;const t=gt(this.initialTotalScore).rank,n=Rn(t),s=n.length+t,r=n[Math.floor(Math.random()*n.length)],o=Math.random()<zl,l=o?tr:bs,i=Math.floor(Math.random()*l.length),c=this.maybeApplyMirror({...l[i]}),u=!o&&t>=20&&Math.random()<.25;let f;if(u){const w=n.filter(x=>x!==r),m=w[Math.floor(Math.random()*w.length)],h={...c,color:r};f=Gf(h,r,m)}else f={...c,color:r,isCorrupted:o||void 0};const d=Math.random()<zl,p=d?tr:bs,y=Math.floor(Math.random()*p.length),v=this.maybeApplyMirror({...p[y]});this.state={...this.state,grid:Cf(t,this.powerUps),tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...v,color:n[Math.floor(Math.random()*n.length)],isCorrupted:d||void 0},nextGoop:f,canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:this.maxTime,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:s,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:qe.TankScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Oe.LIGHTS]:0,[Oe.CONTROLS]:0,[Oe.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0;const k={};this.equippedActives.forEach(w=>{k[w]=0}),this.state.activeCharges=k,this.spawnNewPiece(),ae.emit(re.GAME_START),ae.emit(re.MUSIC_START),this.emitChange()}startTraining(t){this.isTrainingMode=!0,this.maxTime=Oo,this.maxPieceSize=null;const n=Array(De).fill(null).map(()=>Array(we).fill(null)),s=t[Math.floor(Math.random()*t.length)],r=bs,o=Math.floor(Math.random()*r.length),l=this.maybeApplyMirror({...r[o]}),i=t[Math.floor(Math.random()*t.length)],c=Math.floor(Math.random()*r.length),u=this.maybeApplyMirror({...r[c]});this.state={...this.state,grid:n,tankRotation:0,shiftScore:0,gameOver:!1,isPaused:!1,activeGoop:null,storedGoop:{...u,color:i},nextGoop:{...l,color:s},canSwap:!0,popStreak:0,cellsCleared:0,looseGoop:[],dumpPieces:[],dumpQueue:[],shiftTime:Oo,floatingTexts:[],goalMarks:[],crackCells:[],goalsCleared:0,goalsTarget:0,gameStats:{startTime:Date.now(),totalBonusTime:0,maxGroupSize:0},scoreBreakdown:{base:0,height:0,offscreen:0,adjacency:0,speed:0},phase:qe.ConsoleScreen,complications:[],activeComplicationId:null,totalUnitsAdded:0,totalUnitsPopped:0,totalRotations:0,rotationTimestamps:[],complicationThresholds:{lights:this.randomThreshold(),controls:this.randomThreshold(),laser:this.randomThreshold()},prePoppedGoopGroups:new Set,poppedGoopGroupIds:new Set,laserCharge:100,controlsHeat:0,lightsBrightness:100,lightsGraceStart:null,lightsFlickered:!1,complicationCooldowns:{[Oe.LIGHTS]:0,[Oe.CONTROLS]:0,[Oe.LASER]:0},colorizerColor:null,colorizerRemaining:0,crackDownRemaining:0},this.lockStartTime=null,this.lastGoalSpawnTime=Date.now(),this.lastComplicationCheckTime=Date.now(),this.isFastDropping=!1,this.isSessionActive=!0,this.state.activeCharges={},ae.emit(re.GAME_START),this.emitChange()}resetSession(){this.state.gameOver=!1,this.isSessionActive=!1,this.state.phase=qe.ConsoleScreen,this.state.shiftScore=0,this.state.activeGoop=null,this.pendingTotalScore!==null&&(this.initialTotalScore=this.pendingTotalScore,this.pendingTotalScore=null),this.emitChange()}abortRun(){!this.isSessionActive||this.state.gameOver||(this.state.shiftScore=0,this.state.goalsCleared=0,this.finalizeGame())}enterConsole(){this.state.phase=qe.ConsoleScreen,this.emitChange()}enterPeriscope(){this.pendingTrainingPalette&&this.state.isPaused||(this.state.gameOver?this.pendingTrainingPalette?(this.startTraining(this.pendingTrainingPalette),this.state.phase=qe.TankScreen):this.startRun():(this.state.phase=qe.TankScreen,this.isSessionActive||(this.pendingTrainingPalette?(this.startTraining(this.pendingTrainingPalette),this.state.phase=qe.TankScreen):this.startRun())),this.emitChange())}resolveComplication(t){this.state.gameOver||(Us.resolveComplication(this.state,t,this.initialTotalScore,this.powerUps),this.state.phase=qe.ConsoleScreen,this.emitChange())}activateAbility(t){var s,r;if(this.state.gameOver)return;const n=Dn[t];if(!(!n||n.type!=="active"))switch(t){case"COOLDOWN_BOOSTER":{const o=this.powerUps[t]||1,i=[.25,.35,.5][Math.min(o,3)-1];Us.extendAllCooldowns(this.state,i),console.log(`COOLDOWN_BOOSTER activated: +${i*100}% cooldown extension`);break}case"GOOP_DUMP":{const o=Rn(gt(this.initialTotalScore).rank),l=((s=this.state.activeGoop)==null?void 0:s.definition.color)||o[Math.floor(Math.random()*o.length)],i=this.powerUps[t]||1,c=Math.min(i,3),u=18,f=600,d=[];for(let p=0;p<c;p++)for(let y=0;y<u;y++)d.push({id:Math.random().toString(36).substr(2,9),color:l,x:Math.floor(Math.random()*we),y:-1,spawnDelay:p*f+y*$g});this.state.dumpQueue.push(...d),console.log(`GOOP_DUMP activated: ${c} wave(s), ${d.length} total ${l} pieces`);break}case"GOOP_COLORIZER":{const o=(r=this.state.activeGoop)==null?void 0:r.definition.color;if(!o){console.log("GOOP_COLORIZER: No active piece to match color");break}const l=this.powerUps[t]||1,c=[6,7,8][Math.min(l,3)-1];this.state.colorizerColor=o,this.state.colorizerRemaining=c,console.log(`GOOP_COLORIZER activated: next ${c} pieces will be ${o}`);break}case"CRACK_DOWN":{const l=1+(this.powerUps[t]||1)*2;this.state.crackDownRemaining=l;break}}}chargeActiveAbilities(t){Object.keys(this.state.activeCharges).forEach(n=>{const s=this.state.activeCharges[n]||0;this.state.activeCharges[n]=Math.min(100,s+t)})}checkComplications(t){const{spawned:n,newLastCheckTime:s}=Us.checkComplications(this.state,this.initialTotalScore,this.lastComplicationCheckTime);this.lastComplicationCheckTime=s,n&&(Us.spawnComplication(this.state,n),this.emitChange())}finalizeGame(){if(this.state.gameOver)return;this.state.gameOver=!0,this.isSessionActive=!1,this.state.phase=qe.ConsoleScreen;let t=0;for(let l=0;l<De;l++)for(let i=0;i<we;i++)this.state.grid[l][i]&&t++;const n=this.powerUps.AUTO_POPPER||0;if(n>0){const l=t,i=.2-n*.04;let c=0;for(let u=0;u<l;u++)Math.random()>i&&c++;t-=c,console.log(`AUTO_POPPER: ${c} of ${l} goop auto-popped (${t} remaining)`)}const s=t*50;this.state.gameStats.penalty=s,this.state.shiftScore=Math.max(0,this.state.shiftScore-s);const o=100*gt(this.initialTotalScore).rank;this.state.shiftScore=Math.max(o,this.state.shiftScore),this.state.complications=[],this.state.activeComplicationId=null,this.state.prePoppedGoopGroups.clear(),ae.emit(re.GAME_OVER),this.emitChange()}getPiecePoolByZone(t){const s=(this.maxTime-this.state.shiftTime)/1e3,r=this.maxTime/3/1e3,o=!t&&Math.random()<zl;return s<r?{pool:o?tr:bs,isCorrupted:o}:s<r*2?{pool:o?ou:pl,isCorrupted:o}:{pool:o?ru:hl,isCorrupted:o}}maybeApplyMirror(t){return Math.random()>=Nx||t.cells.every(s=>t.cells.some(r=>r.x===-s.x&&r.y===s.y))?t:{...t,cells:t.cells.map(s=>({x:-s.x,y:s.y}))}}spawnNewPiece(t,n,s){const r=n||this.state.grid,o=s!==void 0?s:this.state.tankRotation,l=this.initialTotalScore+this.state.shiftScore,i=gt(l).rank,c=Rn(i);let u=t;if(!u&&this.state.nextGoop){u=this.state.nextGoop;let y=c[Math.floor(Math.random()*c.length)];const v=this.powerUps.CRACK_MATCHER||0,k=this.state.crackCells.length>0?this.state.crackCells:this.state.goalMarks;if(v>0&&k.length>0){const R=k.reduce((S,T)=>T.y>S.y?T:S),P=v*.25;Math.random()<P&&(y=R.color)}let{pool:w,isCorrupted:m}=this.getPiecePoolByZone();if(this.maxPieceSize!==null){const R=w.filter(P=>P.cells.length<=this.maxPieceSize);R.length>0&&(w=R)}const h=Math.floor(Math.random()*w.length),x=this.maybeApplyMirror({...w[h]}),C=!m&&i>=20&&Math.random()<.25;let j;if(C){const R=c.filter(T=>T!==y),P=R[Math.floor(Math.random()*R.length)],S={...x,color:y};j=Gf(S,y,P)}else j={...x,color:y,isCorrupted:m||void 0};if(!m&&i>=40&&Math.random()<.15){const{pool:R}=this.getPiecePoolByZone(!0),P=Math.floor(Math.random()*R.length);j={...this.maybeApplyMirror({...R[P]}),color:Ke.WILD,isWild:!0},console.log("Wild piece queued for next spawn")}this.state.nextGoop=j,this.devOverrideNextGoop&&(this.state.nextGoop={...this.devOverrideNextGoop})}const f=Yy(u,i);this.state.colorizerRemaining>0&&this.state.colorizerColor&&(f.definition={...f.definition,color:this.state.colorizerColor,cellColors:void 0},this.state.colorizerRemaining--,this.state.nextGoop&&this.state.colorizerRemaining>0&&(this.state.nextGoop={...this.state.nextGoop,color:this.state.colorizerColor,cellColors:void 0}),console.log(`GOOP_COLORIZER: Spawned ${this.state.colorizerColor} piece (${this.state.colorizerRemaining} remaining)`),this.state.colorizerRemaining===0&&(this.state.colorizerColor=null));const d=Math.floor((tt-1)/2),p=0;if(f.screenX=d,f.x=oc(d,o),f.y=p,f.startSpawnY=p,f.state=Bn.FALLING,this.lockStartTime=null,this.lockResetCount=0,vs(r,f)){if(this.isTrainingMode){ae.emit(re.GAME_OVER);return}this.finalizeGame();return}this.state.activeGoop=f,this.state.canSwap=!0,this.emitChange()}updateScoreAndStats(t,n){this.state.shiftScore+=t,n&&(this.state.scoreBreakdown.base+=n.base||0,this.state.scoreBreakdown.height+=n.height||0,this.state.scoreBreakdown.offscreen+=n.offscreen||0,this.state.scoreBreakdown.adjacency+=n.adjacency||0,this.state.scoreBreakdown.speed+=n.speed||0)}handleGoals(t,n,s){rc.handleGoals(this.state,t,n,s,()=>this.emitChange())}tickTimer(t){if(this.isTrainingMode)return!this.freezeTimer&&this.trainingPressureRate>0&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*this.trainingPressureRate)),!0;const n=this.powerUps.FOCUS_MODE||0,r=this.state.phase===qe.COMPLICATION_MINIGAME&&n>0?1-n*.1:1;return!this.freezeTimer&&(this.state.shiftTime=Math.max(0,this.state.shiftTime-t*r),this.state.shiftTime<=0)?(this.finalizeGame(),!1):!0}tickGoals(){const{crack:t,newLastSpawnTime:n}=rc.trySpawnCrack(this.state,this.state.grid,this.initialTotalScore,this.state.shiftTime,this.maxTime,this.lastGoalSpawnTime);this.lastGoalSpawnTime=n,t&&(console.log(`[CRACK] SPAWN id=${t.id} at (${t.x}, ${t.y}) color=${t.color} source="ENGINE-tickGoals" time=${new Date().toLocaleTimeString()} totalCracks=${this.state.crackCells.length+1} isTraining=${this.isTrainingMode}`),this.state.crackCells.push(t),this.state.goalMarks.push({id:t.id,x:t.x,y:t.y,color:t.color,spawnTime:t.spawnTime}))}tickHeat(t){const n=gt(this.initialTotalScore).rank,s=Ss[Oe.CONTROLS];if(Xn(Oe.CONTROLS,n)&&this.state.controlsHeat>0){const r=Date.now(),o=this.state.rotationTimestamps.length>0?this.state.rotationTimestamps[this.state.rotationTimestamps.length-1]:0;if(r-o>s.idleThresholdMs){const i=this.powerUps.GEAR_LUBRICATION||0,c=s.dissipationBase*(1+s.dissipationUpgradeEffect*i);this.state.controlsHeat=Math.max(0,this.state.controlsHeat-c*t/1e3)}}}tickLightsBrightness(t){const n=gt(this.initialTotalScore).rank,s=Ss[Oe.LIGHTS];if(!Xn(Oe.LIGHTS,n))return;if(this.state.phase!==qe.TankScreen){this.state.lightsGraceStart!==null&&this.lightsGracePausedAt===null&&(this.lightsGracePausedAt=Date.now());return}if(this.lightsGracePausedAt!==null&&this.state.lightsGraceStart!==null){const c=Date.now()-this.lightsGracePausedAt;this.state.lightsGraceStart+=c,this.lightsGracePausedAt=null}if(this.state.complications.some(c=>c.type===Oe.LIGHTS)){this.state.lightsBrightness=s.failedBrightness;return}const o=Date.now();this.isFastDropping&&!this.wasFastDropping&&(this.state.lightsGraceStart=null,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),!this.isFastDropping&&this.wasFastDropping&&(this.state.lightsGraceStart=o,this.state.lightsFlickered=!1,this.lightsOverflarePhase="none",this.lightsFlickerActive=!1),this.wasFastDropping=this.isFastDropping;const l=this.powerUps.CIRCUIT_STABILIZER||0,i=(s.graceBaseSec+s.gracePerLevel*l)*1e3;if(this.isFastDropping){if(this.state.lightsBrightness<100){const c=s.recoverRate*t/1e3;this.state.lightsBrightness=Math.min(100,this.state.lightsBrightness+c),this.state.lightsBrightness>=100&&(this.lightsOverflarePhase="rising",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="rising"){this.lightsOverflareTime+=t;const c=Math.min(1,this.lightsOverflareTime/s.overflareUpMs);this.state.lightsBrightness=100+(s.overflarePeak-100)*c,c>=1&&(this.lightsOverflarePhase="falling",this.lightsOverflareTime=0)}else if(this.lightsOverflarePhase==="falling"){this.lightsOverflareTime+=t;const c=Math.min(1,this.lightsOverflareTime/s.overflareDownMs);this.state.lightsBrightness=s.overflarePeak-(s.overflarePeak-100)*c,c>=1&&(this.lightsOverflarePhase="none",this.state.lightsBrightness=100)}}else{this.state.lightsGraceStart===null&&(this.state.lightsGraceStart=o);const c=o-this.state.lightsGraceStart;if(c<i){if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1,this.state.lightsBrightness=100}}else if(c>=i&&!this.state.lightsFlickered)this.state.lightsFlickered=!0,this.lightsFlickerActive=!0,this.lightsFlickerTime=0,ae.emit(re.LIGHTS_FLICKER,{});else if(this.lightsFlickerActive){this.lightsFlickerTime+=t;const u=s.flickerDipMs+s.flickerRecoverMs;if(this.lightsFlickerTime<s.flickerDipMs){const f=this.lightsFlickerTime/s.flickerDipMs;this.state.lightsBrightness=100-(100-s.flickerDipBrightness)*f}else if(this.lightsFlickerTime<u){const f=(this.lightsFlickerTime-s.flickerDipMs)/s.flickerRecoverMs;this.state.lightsBrightness=s.flickerDipBrightness+(100-s.flickerDipBrightness)*f}else this.lightsFlickerActive=!1}else{const u=c-i,f=s.dimDurationSec*1e3,d=Math.min(1,u/f);this.state.lightsBrightness=100-(100-s.dimThreshold)*d,this.state.lightsBrightness<=s.dimThreshold&&(this.state.lightsBrightness=s.failedBrightness,Us.spawnComplication(this.state,Oe.LIGHTS))}}}tickLooseGoop(t){if(this.state.looseGoop.length===0)return;const{active:n,landed:s}=Xy(this.state.looseGoop,this.state.grid,t);if(s.length>0){ae.emit(re.PIECE_DROPPED);const r=this.state.grid.map(i=>[...i]);let o=!1;const l=[];s.forEach(i=>{if(i.y>=0&&i.y<De){const c=Math.floor(i.y),u=this.state.goalMarks.find(d=>d.x===i.x&&d.y===c);let f=!1;u&&u.color===i.data.color&&(l.push(u.id),f=!0),r[c][i.x]={...i.data,timestamp:Date.now(),isSealingGoop:f},o=!0}}),o&&(this.state.grid=Hi(r)),l.length>0&&(l.forEach(i=>{const c=this.state.goalMarks.find(f=>f.id===i);c&&(c.plugged=!0);const u=this.state.crackCells.find(f=>f.id===i);u&&(u.plugged=!0)}),ae.emit(re.GOAL_PLUGGED,{count:l.length})),this.state.looseGoop=n}else this.state.looseGoop=n}tickDumpPieces(t){var l;const n=[];for(const i of this.state.dumpQueue)i.spawnDelay-=t,i.spawnDelay<=0?this.state.dumpPieces.push(i):n.push(i);if(this.state.dumpQueue=n,this.state.dumpPieces.length===0)return;const s=[],r=this.state.grid.map(i=>[...i]);let o=!1;for(const i of this.state.dumpPieces){i.y+=Fg*t;const c=Math.floor(i.y),u=i.x;let f=!1;(c>=De-1||c>=0&&((l=r[c+1])!=null&&l[u]))&&(f=!0),f&&c>=0&&c<De?(r[c][u]={id:i.id,goopGroupId:Math.random().toString(36).substr(2,9),timestamp:Date.now(),color:i.color,groupMinY:c,groupMaxY:c,groupSize:1},o=!0):f||s.push(i)}this.state.dumpPieces=s,o&&(this.state.grid=Hi(r))}tickActivePiece(t){if(!this.state.activeGoop||this.usePhysicsForFalling)return;const s=1+(this.powerUps.DENSE_GOOP||0)*.125,r=zf/s,o=this.isFastDropping?r/Yf:r,l=t/o,i=this.state.activeGoop.y+l,c=oc(this.state.activeGoop.screenX,this.state.tankRotation),u={...this.state.activeGoop,y:i,x:c};if(vs(this.state.grid,u,this.state.tankRotation)){this.lockStartTime===null&&(this.lockStartTime=Date.now());const f=Date.now()-this.lockStartTime,d=this.isFastDropping?50:Hf;(f>d||this.lockResetCount>=10)&&this.lockActivePiece()}else this.state.activeGoop=u,this.lockStartTime=null}lockActivePiece(){if(!this.state.activeGoop||this.state.gameOver)return;const t=E0(this.state.grid,this.state.activeGoop,this.state.tankRotation),n={...this.state.activeGoop,y:t};let{grid:s,consumedGoals:r,destroyedGoals:o}=Uy(this.state.grid,n,this.state.goalMarks);(n.definition.isWild||this.hasAdjacentWild(s,n))&&(s=Wy(s,n)),(r.length>0||o.length>0)&&this.handleGoals(r,o,n),this.state.complications.some(u=>u.type===Oe.LASER)||(this.state.laserCharge=Math.min(100,this.state.laserCharge+10)),ae.emit(re.PIECE_DROPPED);const{grid:i,looseGoop:c}=I0(s);c.forEach(u=>{if(u.data.isSealingGoop){const f=this.state.goalMarks.find(d=>d.x===u.x&&d.y===Math.floor(u.y)&&d.plugged);f&&(f.plugged=!1),u.data.isSealingGoop=!1}}),c.length>0&&this.state.looseGoop.push(...c),this.state.grid=i,this.isTrainingMode?(this.state.activeGoop=null,this.state.isPaused=!0,this.freezeFalling=!0,this.emitChange()):this.spawnNewPiece(void 0,i),this.state.popStreak=0,this.isFastDropping=!1}tickActiveCharges(t){Object.keys(this.state.activeCharges).length===0&&this.equippedActives.length>0&&this.equippedActives.forEach(s=>{this.state.activeCharges[s]=this.state.activeCharges[s]??0});const n={COOLDOWN_BOOSTER:100/20,GOOP_DUMP:100/15,GOOP_COLORIZER:100/25,CRACK_DOWN:100/30};Object.keys(this.state.activeCharges).forEach(s=>{const r=this.state.activeCharges[s]||0;if(r<100){const o=n[s]||3,l=t/1e3*o,i=Math.min(100,r+l);this.state.activeCharges[s]=i}})}getFallSpeed(){const n=1+(this.powerUps.DENSE_GOOP||0)*.125,s=30/zf*1e3*n;return this.isFastDropping?s*Yf:s}syncActivePieceFromPhysics(t,n){if(!(!this.state.activeGoop||this.state.gameOver))if(this.state.activeGoop.y=n,t){this.lockStartTime===null&&(this.lockStartTime=Date.now());const s=Date.now()-this.lockStartTime,r=this.isFastDropping?50:Hf;(s>r||this.lockResetCount>=10)&&this.lockActivePiece()}else this.lockStartTime=null}tick(t){!this.isSessionActive||this.state.gameOver||this.state.isPaused||this.tickTimer(t)&&(this.isTrainingMode||(this.tickGoals(),this.crackManager.tickGrowth(this.state,this.initialTotalScore,this.powerUps,this.maxTime),this.checkComplications(t),this.tickHeat(t),this.tickLightsBrightness(t),this.tickDumpPieces(t),this.tickActiveCharges(t)),this.tickLooseGoop(t),this.tickActivePiece(t),this.emitChange())}}const Uf=Sn?25:16,Bg=(e,t,n,s=[],r)=>{const o=g.useRef(null);o.current||(o.current=new Gg(e,t,s));const l=o.current;if(l.equippedActives.length!==s.length||!l.equippedActives.every((p,y)=>p===s[y])){l.equippedActives=s;const p=l.state.activeCharges||{},y={};s.forEach(v=>{y[v]=p[v]??0}),l.state.activeCharges=y}const[,c]=g.useReducer(p=>p+1,0),u=g.useRef(0),f=g.useRef(0),d=g.useRef(0);return g.useEffect(()=>{l.syncTotalScore(e)},[e,l]),g.useEffect(()=>l.subscribe(()=>{if(l.state.gameOver){c();return}const y=performance.now();y-f.current>=Uf&&(f.current=y,c())}),[l]),g.useEffect(()=>{const p=y=>{u.current||(u.current=y);const v=y-u.current;if(Sn&&v<Uf){d.current=requestAnimationFrame(p);return}u.current=y,l.tick(v),r&&r(v/1e3,l),d.current=requestAnimationFrame(p)};return d.current=requestAnimationFrame(p),()=>cancelAnimationFrame(d.current)},[l]),{engine:l,gameState:l.state}},zg=2.4;function Yg(){return{minX:jn.x,maxX:jn.x+tt*Et,minY:jn.y,maxY:jn.y+Dt*Et}}function Hg(e){const{enabled:t,params:n,bounds:s}=e,r=g.useRef([]),o=g.useRef([]),l=g.useRef([]),i=g.useRef(0),c=g.useRef({...Wi,...n}),u=g.useRef(s??Yg());g.useEffect(()=>{n&&(c.current={...Wi,...n})},[n==null?void 0:n.damping,n==null?void 0:n.stiffness,n==null?void 0:n.pressure,n==null?void 0:n.iterations,n==null?void 0:n.homeStiffness,n==null?void 0:n.innerHomeStiffness,n==null?void 0:n.returnSpeed,n==null?void 0:n.viscosity,n==null?void 0:n.gravity,n==null?void 0:n.fallingHomeStiffness,n==null?void 0:n.fallingReturnSpeed,n==null?void 0:n.fallingViscosity,n==null?void 0:n.fallingGravity,n==null?void 0:n.attractionRadius,n==null?void 0:n.attractionRestLength,n==null?void 0:n.attractionStiffness,n==null?void 0:n.goopiness,n==null?void 0:n.tendrilEndRadius,n==null?void 0:n.tendrilSkinniness,n==null?void 0:n.wallThickness,n==null?void 0:n.fallingGoopiness,n==null?void 0:n.fallingTendrilEndRadius,n==null?void 0:n.fallingTendrilSkinniness,n==null?void 0:n.dropletCount,n==null?void 0:n.dropletSpeed,n==null?void 0:n.dropletLifetime,n==null?void 0:n.dropletSize,n==null?void 0:n.dropletGravity]),g.useEffect(()=>{s&&(u.current=s)},[s]);const f=g.useCallback((C,j,R,P,S=0)=>{const T=xm(C,j,R,P,S);return r.current=[...r.current,T],T},[]),d=g.useCallback(C=>{r.current=r.current.filter(j=>j.id!==C)},[]),p=g.useCallback((C,j,R)=>{const P=r.current.find(S=>S.id===C);P&&(P.targetX=j,P.targetY=R)},[]),y=g.useCallback(C=>{const j=r.current.find(R=>R.id===C);j&&(j.isLocked=!0,j.isFalling=!1,j.isLoose=!1,j.fillAmount=0)},[]),v=g.useCallback((C,j)=>{if(!t)return;const R=r.current,P=c.current,S=R.length>0;if(j&&S)for(const M of R)M.isFalling&&!M.isLocked&&jm(M,C,j.fallSpeed,j.grid,Dt,j.tankRotation);if(S){Cm(R,C,P,u.current);for(const M of R)if(M.isLocked&&M.fillAmount<1&&!(j!=null&&j.isPaused)){const ne=1/(M.gridCells.length*So/1e3);M.fillAmount=Math.min(1,M.fillAmount+ne*C);const ie=M.fillAmount>=1;ie&&!M.wasFullLastFrame&&km(M,zg),M.wasFullLastFrame=ie}o.current=wm(R,o.current,P),Pm(R,o.current,P),Rm(R,Et)}const T=P.dropletGravity,E=u.current;for(const M of l.current)M.vel.y+=T*C,M.pos.x+=M.vel.x*C,M.pos.y+=M.vel.y*C,(M.pos.x+M.radius<E.minX||M.pos.x-M.radius>E.maxX)&&(M.lifetime=0),M.pos.y+M.radius<E.minY&&(M.lifetime=0),M.pos.y+M.radius>E.maxY&&(M.pos.y=E.maxY-M.radius,M.vel.y*=-.3),M.lifetime-=C,M.opacity=Math.max(0,M.lifetime/M.maxLifetime),M.radius*=.995;l.current=l.current.filter(M=>M.lifetime>0&&M.opacity>.01)},[t]),k=g.useCallback(()=>{r.current=[],o.current=[],l.current=[]},[]),w=g.useCallback(C=>{const j=c.current,R=C.targetX,P=C.targetY;for(let S=0;S<j.dropletCount;S++){const T=Math.floor(Math.random()*C.vertices.length),E=C.vertices[T],M=E.pos.x-R,Q=E.pos.y-P,ne=Math.atan2(Q,M)+(Math.random()-.5)*.8,ie=j.dropletSpeed*(.5+Math.random()*.8),L={id:`droplet-${i.current++}`,pos:{x:E.pos.x,y:E.pos.y},vel:{x:Math.cos(ne)*ie,y:Math.sin(ne)*ie-50},radius:j.dropletSize*(.5+Math.random()*.7),color:C.color,opacity:1,lifetime:j.dropletLifetime*(.7+Math.random()*.6),maxLifetime:j.dropletLifetime};l.current.push(L)}},[]),m=g.useCallback(C=>r.current.find(j=>j.id===C),[]),h=g.useCallback(C=>{for(const j of r.current){const P=-(C-j.createdAtRotation)*Et;for(const S of j.vertices)S.pos.x+=P,S.oldPos.x+=P;for(const S of j.innerVertices)S.pos.x+=P,S.oldPos.x+=P;j.targetX+=P,j.createdAtRotation=C}},[]),x=g.useCallback(()=>{var P;const C=r.current.find(S=>S.isFalling&&!S.isLocked);if(!C)return null;let j=((P=C.gridCells[0])==null?void 0:P.y)??0;for(const S of C.gridCells)S.y<j&&(j=S.y);return{gridY:j+nt,isColliding:C.isColliding}},[]);return{blobs:r.current,attractionSprings:o.current,params:c.current,createBlob:f,removeBlob:d,updateBlobTarget:p,lockBlob:y,step:v,clearBlobs:k,getBlob:m,shiftBlobsForRotation:h,droplets:l.current,createDropletsForPop:w,getActivePieceState:x}}const qr="";function Wf(e){let t=e;return()=>(t=t*1664525+1013904223&4294967295,(t>>>0)/4294967295)}function Xf(e){return e.replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"")}function Vf(e){const t=e.match(/[^a-zA-Z0-9]+$/);return t?t[0]:""}function qf(e){const t=e.match(/^[^a-zA-Z0-9]+/);return t?t[0]:""}const Ug=({fullText:e,keywords:t,revealed:n=!1,className:s="",visibleChars:r})=>{const o=g.useMemo(()=>{const u=t.map(y=>y.toLowerCase());if(e.includes("[")){const y=[],v=e.split(/\[([^\]]*)\]/);let k=0;for(let w=0;w<v.length;w++){const m=w%2===1,h=v[w];if(!h)continue;const x=h.split(/(\s+)/);for(const C of x){if(!C)continue;if(/^\s+$/.test(C)){y.push({isKeyword:!1,display:C,original:C,garbleLevel:"none"});continue}const j=Xf(C),R=qf(C),P=Vf(C),S=!m&&u.includes(j.toLowerCase()),T=k++;if(n||S||!m){y.push({isKeyword:S,display:C,original:C,garbleLevel:"none"});continue}const E=Wf(T*7919+31),M=j.split("").map(()=>qr[Math.floor(E()*qr.length)]).join("");y.push({isKeyword:!1,display:R+M+P,original:C,garbleLevel:"garbled"})}}return y}const d=e.split(/(\s+)/);let p=0;return d.map(y=>{if(/^\s+$/.test(y))return{isKeyword:!1,display:y,original:y,garbleLevel:"none"};const v=Xf(y),k=qf(y),w=Vf(y),m=u.includes(v.toLowerCase()),h=p++;if(n||m)return{isKeyword:m,display:y,original:y,garbleLevel:"none"};const x=Wf(h*7919+31),C=v.split("").map(()=>qr[Math.floor(x()*qr.length)]).join("");return{isKeyword:!1,display:k+C+w,original:y,garbleLevel:"garbled"}})},[e,t,n]),l=o.map(u=>u.display).join(""),i=r===void 0||r>=l.length;let c=0;return a.jsx("p",{className:`leading-relaxed ${s}`,children:o.map((u,f)=>{if(!i&&c>=r)return null;let d=u.display;if(!i){const y=r-c;d.length>y&&(d=d.slice(0,y))}if(c+=u.display.length,/^\s+$/.test(u.original))return a.jsx("span",{children:d},f);if(u.isKeyword)return a.jsx("span",{className:"text-green-400 font-semibold",children:d},f);const p=u.garbleLevel!=="none"?"text-slate-600":"text-slate-300";return a.jsx("span",{className:p,children:d},f)})})};const Wg=1,Xg=35,Vg=({message:e,onDismiss:t,onComplete:n,position:s="top",className:r="",advanceType:o,canDismiss:l=!0,trainingProgress:i})=>{const[c,u]=g.useState(0),[f,d]=g.useState(!1),p=g.useRef(null),y=e.fullText.length;g.useEffect(()=>(p.current=setInterval(()=>{u(m=>{const h=m+Wg;return h>=y?(p.current&&clearInterval(p.current),y):h})},Xg),()=>{p.current&&clearInterval(p.current)}),[y]),g.useEffect(()=>{c>=y&&d(!0)},[c,y]);const v=g.useCallback(()=>{f||(p.current&&clearInterval(p.current),u(y),d(!0))},[f,y]),k={top:"left-1/2 -translate-x-1/2",center:"top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",bottom:"bottom-12 left-1/2 -translate-x-1/2"},w=s==="top"?{top:"33%"}:{};return a.jsx("div",{className:`absolute ${k[s]} z-[90] ${r}`,style:{width:"min(calc(100vw - 24px), calc(100dvh * 0.5625 - 24px))",...w},onClick:v,onTouchStart:v,children:a.jsxs("div",{className:"bg-slate-900/95 border border-slate-700 rounded-sm shadow-lg shadow-black/50 overflow-hidden intercom-enter",children:[a.jsx("div",{className:"px-3 py-1.5 border-b border-slate-800 bg-slate-950/60",children:i?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"t-caption text-slate-400 leading-tight truncate",children:i.phaseName}),a.jsx("span",{className:"t-caption text-slate-500 leading-tight flex-shrink-0 ml-2",children:i.stepProgress})]}),a.jsx("div",{className:"flex items-center justify-center gap-1.5 mt-1",children:i.phaseDots.map(m=>a.jsx("span",{className:`intercom-phase-dot intercom-phase-dot--${m.status}`,title:`Phase ${m.phase}`},m.phase))})]}):a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"t-body text-slate-500 uppercase tracking-widest font-mono",children:"Intercom"}),a.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-orange-500 intercom-blink"})]})}),a.jsx("div",{className:"px-3 py-2.5 t-display text-slate-300",children:a.jsx(Ug,{fullText:e.fullText,keywords:e.keywords,visibleChars:c})}),f&&l&&a.jsx("div",{className:"px-3 py-3 border-t border-slate-800",children:o!=="tap"?a.jsx("button",{onClick:m=>{m.stopPropagation(),t()},className:"w-full h-12 flex items-center justify-center t-heading font-mono text-green-400 hover:text-green-300 border border-green-900 hover:border-green-700 rounded-sm transition-colors",children:""}):a.jsx("button",{onClick:m=>{m.stopPropagation(),n()},className:"w-full h-12 flex items-center justify-center t-heading font-mono text-green-400 hover:text-green-300 border border-green-900 hover:border-green-700 rounded-sm transition-colors",children:""})})]})})},qg={},Kg=({activeStep:e,onComplete:t,onDismiss:n,highlightElement:s,messagePosition:r="center",advanceType:o,blockInteraction:l=!1,trainingProgress:i,canDismiss:c=!0})=>{const[u,f]=g.useState(null),[d,p]=g.useState(!1),y=g.useRef(null);if(g.useEffect(()=>(y.current&&(clearTimeout(y.current),y.current=null),e&&!u?(f(e),requestAnimationFrame(()=>p(!0))):e&&u?(p(!1),y.current=setTimeout(()=>{f(e),requestAnimationFrame(()=>p(!0))},160)):!e&&u&&(p(!1),y.current=setTimeout(()=>{f(null)},150)),()=>{y.current&&clearTimeout(y.current)}),[e]),!u)return null;const v=s?qg[s]??null:null,k=v?{clipPath:`polygon(
          0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%,
          ${v.left}% ${v.top}%,
          ${v.left}% ${v.bottom}%,
          ${v.right}% ${v.bottom}%,
          ${v.right}% ${v.top}%,
          ${v.left}% ${v.top}%
        )`}:void 0;return a.jsxs("div",{className:`absolute inset-0 z-[90] ${l?"pointer-events-auto":"pointer-events-none"}`,style:{transition:"opacity 150ms ease-out, background-color 150ms ease-out",opacity:d?1:0,backgroundColor:l?"rgba(0, 0, 0, 0.35)":"transparent"},children:[v&&a.jsx("div",{className:"absolute inset-0",style:{backgroundColor:"rgba(0, 0, 0, 0.4)",...k,transition:"clip-path 300ms ease-out"}}),a.jsx("div",{className:"pointer-events-auto",children:a.jsx(Vg,{message:u.message,onDismiss:n,onComplete:t,position:r,advanceType:o,trainingProgress:i,canDismiss:c})})]})},Kr=[{id:"WELCOME",rank:0,trigger:{type:"ON_GAME_START",rank:0},message:{keywords:["Welcome","operator"],fullText:"Welcome aboard, operator."},autoAdvanceMs:4e3},{id:"ROTATE_INTRO",rank:0,trigger:{type:"ON_GAME_START",rank:0},message:{keywords:["Swipe","rotate","tank"],fullText:"Swipe left or right to rotate the tank."},requiresAction:"ROTATE"}],Kf={A1_WELCOME:{keywords:["Operator","training","periscope"],fullText:"[Your] Operator training [begins now]. Drag [the] periscope down [to] start."},B1_GOOP_FALLS:{keywords:["goop","tank"],fullText:"[The] extruder drops goop into [the] tank."},B2_FAST_DROP:{keywords:["slow","Swipe","S","fast-drop"],fullText:"[Yeah.] It's slow. Swipe down or [press] S [to] fast-drop."},B3_ROTATION:{keywords:["Rotate","Q/E","tap","left/right","tank"],fullText:"Rotate [with] Q/E or tap [the] left/right [side of the] tank."},B4_PRACTICE:{keywords:[],fullText:"[Do it] again."},C1_PRESSURE:{keywords:["Pressure"],fullText:"Pressure [builds] over time."},C2_POP:{keywords:["Tap","goop","pressure","pop"],fullText:"Tap goop below [the] pressure [line] to pop [it]."},C3_MERGE_SOLIDIFY:{keywords:["goop","merges","Bigger","vent","set"],fullText:"Same-color goop merges. Bigger [blobs] vent more. [Fresh goop] needs a moment to set."},C4_PRACTICE_POP:{keywords:["Pop"],fullText:"Pop [it]."},D1_CRACK:{keywords:["Cracks","tank","goop","seal"],fullText:"Cracks [form in the] tank [wall]. Drop matching [color] goop [on them] to seal."},D2_TANK_ROTATION:{keywords:["Swipe","left/right","A/D","spin","tank"],fullText:"Swipe left/right [or] A/D [to] spin [the] tank."},D3_OFFSCREEN:{keywords:["tank","Cracks"],fullText:"[You] only see 1/3 [of the] tank. Cracks [can] spawn anywhere."},E1_SEAL_CRACK:{keywords:["Pop","goop","seal","crack"],fullText:"Pop [the] goop [to] seal the crack."},E2_SCAFFOLDING:{keywords:["Cracks","pressure","goop","reach"],fullText:"Cracks [spawn] higher as [the] pressure builds. Stack goop [to] reach [them]."},F1_GRADUATION:{keywords:["basics","goop","high"],fullText:"[That] covers [the] basics. Don't [let the] goop [pile] too high."}},nr={PRESSURE_CAP:{keywords:["Swipe up","leave training"],fullText:"[I've] stopped [the] pressure [so you can] practice. Swipe up [to] leave training."},OVERFLOW:{keywords:["Swipe up","end"],fullText:"[You] overflowed [the] tank! Training [is] over. Swipe up [to] end."}},L0={D2_RETRY:{keywords:["tank","goop","crack","Spin"],fullText:"Try again! Spin [the] tank [to] align [the] goop with [the] crack."}},Zg={A:"Enter the Tank",B:"Goop Basics",C:"Pressure & Popping",D:"Cracks & Sealing",E:"Scaffolding",F:"Graduation"},Sr=[{id:"A1_WELCOME",phase:"A",name:"Welcome",teaches:"premise-and-entry",setup:{view:"console",pressureRate:0,highlightElement:"periscope",messagePosition:"top"},pauseGame:!0,advance:{type:"action",action:"drag-periscope"},markComplete:"WELCOME",handlerType:"standard"},{id:"B1_GOOP_FALLS",phase:"B",name:"Goop Falls",teaches:"what-goop-is",setup:{view:"tank",spawnPiece:{color:Ke.BLUE,shape:Ae.T_I,rotation:1,autoFall:!0},pressureRate:0,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1,pop:!1},advanceAtRow:8},pauseGame:!1,advance:{type:"event",event:"piece-landed"},handlerType:"standard"},{id:"B2_FAST_DROP",phase:"B",name:"Fast-Drop",teaches:"fast-drop-input",setup:{pressureRate:0,allowedControls:{fastDrop:!0,rotate:!1,tankRotate:!1,pop:!1}},pauseGame:!1,advance:{type:"event",event:"piece-landed"},handlerType:"standard"},{id:"B3_ROTATION",phase:"B",name:"Rotation",teaches:"piece-rotation-input",setup:{spawnPiece:{color:Ke.YELLOW,shape:Ae.T_T},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1},pauseDelay:1200},pauseGame:!0,advance:{type:"event",event:"piece-landed"},markComplete:"DROP_INTRO",handlerType:"standard"},{id:"B4_PRACTICE",phase:"B",name:"Practice",teaches:"practice-basics",setup:{spawnPiece:{color:Ke.BLUE,shape:Ae.T_O},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1,pop:!1}},pauseGame:!0,advance:{type:"event",event:"piece-landed"},handlerType:"standard"},{id:"C1_PRESSURE",phase:"C",name:"Pressure Rises",teaches:"pressure-concept",setup:{pressureRate:2.5,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1,pop:!1},advanceWhenPressureAbovePieces:!0,advancePressureAboveColor:Ke.YELLOW,autoSkipMs:1e4},pauseGame:!0,advance:{type:"auto",delayMs:6e4},handlerType:"standard"},{id:"C2_POP",phase:"C",name:"Pop",teaches:"how-to-pop",setup:{pressureRate:0,allowedControls:{fastDrop:!1,rotate:!1,tankRotate:!1},highlightGoopColor:Ke.YELLOW,hintDelay:3e3,popLowersPressure:!0},pauseGame:!1,advance:{type:"action",action:"pop-goop"},handlerType:"standard"},{id:"C3_MERGE_SOLIDIFY",phase:"C",name:"Merge & Solidify",teaches:"merge-and-fill-timing",setup:{pressureRate:.3125,pauseDelay:1500},pauseGame:!0,advance:{type:"tap"},markComplete:"POP_TIMING",handlerType:"standard"},{id:"C4_PRACTICE_POP",phase:"C",name:"Practice Pop",teaches:"second-pop-rep",setup:{pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!1},highlightGoopColor:Ke.BLUE,messageDelay:2e3,hintDelay:3e3,popLowersPressure:!0},pauseGame:!1,advance:{type:"action",action:"pop-goop"},handlerType:"standard"},{id:"D1_CRACK",phase:"D",name:"Crack Appears",teaches:"crack-sealing",setup:{spawnCrack:{color:Ke.GREEN,placement:"near-stack",row:22},pressureRate:0,pauseDelay:2500},pauseGame:!0,advance:{type:"tap"},markComplete:"CRACK_INTRO",handlerType:"standard"},{id:"D2_TANK_ROTATION",phase:"D",name:"Tank Rotation",teaches:"tank-rotation-input",setup:{spawnPiece:{color:Ke.GREEN,shape:Ae.T_O},pressureRate:0,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},showWhenPieceBelow:8,retryOnPieceLand:{retryMessageId:"D2_RETRY",spawnExtraCrack:{color:Ke.GREEN,placement:"near-stack"}},popLowersPressure:!0},pauseGame:!0,advance:{type:"event",event:"crack-sealed"},markComplete:"ROTATE_INTRO",handlerType:"retry"},{id:"E2_SCAFFOLDING",phase:"E",name:"Scaffolding",teaches:"scaffolding-strategy",setup:{pressureRate:.46875,pauseDelay:1500,spawnCracks:[{color:Ke.RED,placement:"at-pressure-line"},{color:Ke.BLUE,placement:"offscreen-pressure-line"}]},pauseGame:!0,advance:{type:"tap"},handlerType:"standard"},{id:"F1_GRADUATION",phase:"F",name:"Graduation",teaches:"free-play",setup:{pressureRate:.5,allowedControls:{fastDrop:!0,rotate:!0,tankRotate:!0},messagePosition:"top",continuousSpawn:!0,pressureCap:.95,periodicCrackIntervalMs:1e4,popLowersPressure:!0,pauseDelay:2e3},pauseGame:!0,advance:{type:"action",action:"swipe-up"},markComplete:"FIRST_SHIFT",handlerType:"freeplay"}];function Qg(e){return Sr.find(t=>!e.includes(t.id))??null}function ic(e){return Sr.every(t=>e.includes(t.id))}function Jg(e){return Sr.filter(t=>t.phase===e)}const ev=({rank:e,isSessionActive:t,saveData:n,setSaveData:s})=>{var y;const[r,o]=g.useState(()=>{var v;return{activeStep:null,completedSteps:((v=n.tutorialProgress)==null?void 0:v.completedSteps)??[],dismissed:!1}}),l=g.useRef(r.completedSteps);l.current=r.completedSteps;const i=r.activeStep?Kr.find(v=>v.id===r.activeStep)??null:null,c=g.useCallback(v=>r.completedSteps.includes(v),[r.completedSteps]),u=g.useCallback(v=>{l.current.includes(v.id)||o(k=>k.activeStep!==null||k.completedSteps.includes(v.id)?k:(ae.emit(re.TUTORIAL_STEP_TRIGGERED,{stepId:v.id,message:v.message}),{...k,activeStep:v.id,dismissed:!1}))},[]),f=g.useCallback(()=>{o(v=>{if(!v.activeStep)return v;const k=v.activeStep,w=[...v.completedSteps,k];return ae.emit(re.TUTORIAL_STEP_COMPLETED,{stepId:k}),s(m=>({...m,tutorialProgress:{completedSteps:w}})),{activeStep:null,completedSteps:w,dismissed:!1}})},[s]),d=g.useCallback(()=>{o(v=>v.activeStep?(ae.emit(re.TUTORIAL_STEP_DISMISSED,{stepId:v.activeStep}),{...v,activeStep:null,dismissed:!0}):v)},[]),p=e===0&&!ic(((y=n.tutorialProgress)==null?void 0:y.completedSteps)??[]);return g.useEffect(()=>{if(p)return;const v=Kr.filter(k=>k.trigger.type==="ON_RANK_REACH"&&k.trigger.rank===e);for(const k of v)u(k)},[e,u,p]),g.useEffect(()=>{if(p||!t)return;const v=Kr.filter(k=>k.trigger.type==="ON_GAME_START"&&k.trigger.rank===e);for(const k of v)u(k)},[t,e,u,p]),g.useEffect(()=>{if(p)return;const k=Kr.filter(w=>w.trigger.type==="ON_EVENT").map(w=>{const m=w.trigger.event;return ae.on(m,()=>{u(w)})});return()=>{k.forEach(w=>w())}},[u,p]),{activeStep:i,completeStep:f,dismissStep:d,isStepCompleted:c,tutorialState:r}};var $n=(e=>(e.ENTERING="ENTERING",e.WAITING_FOR_TRIGGER="WAITING_FOR_TRIGGER",e.MESSAGE_VISIBLE="MESSAGE_VISIBLE",e.ARMED="ARMED",e.ADVANCING="ADVANCING",e))($n||{});const tv={ENTERING:{isPaused:!0,isFrozen:!0,messageShown:!1},WAITING_FOR_TRIGGER:{isPaused:!1,isFrozen:!1,messageShown:!1},MESSAGE_VISIBLE:{isPaused:!0,isFrozen:!0,messageShown:!0},ARMED:{isPaused:!1,isFrozen:!1,messageShown:!1},ADVANCING:{isPaused:!0,isFrozen:!0,messageShown:!1}};function nv(){const[e,t]=g.useState($n.ENTERING),n=g.useRef(e),s=g.useCallback(p=>{t(p),n.current=p},[]),r=g.useCallback(()=>{s($n.ENTERING)},[s]),o=g.useCallback(()=>{s($n.WAITING_FOR_TRIGGER)},[s]),l=g.useCallback(()=>{s($n.MESSAGE_VISIBLE)},[s]),i=g.useCallback(()=>{s($n.ARMED)},[s]),c=g.useCallback(()=>{s($n.ADVANCING)},[s]),u=g.useCallback(()=>{s($n.ENTERING)},[s]),f=g.useCallback(()=>n.current===$n.ARMED,[]),d=tv[e];return{state:e,properties:d,enter:r,waitForTrigger:o,showMessage:l,armAdvance:i,advance:c,reset:u,isArmed:f}}function sv(){const e=g.useRef(new Map),t=g.useCallback(l=>{const i=e.current.get(l);i&&(i.type==="timeout"?clearTimeout(i.id):clearInterval(i.id),e.current.delete(l))},[]),n=g.useCallback((l,i,c)=>{const u=e.current.get(l);u&&(u.type==="timeout"?clearTimeout(u.id):clearInterval(u.id));const f=setTimeout(()=>{e.current.delete(l),i()},c);e.current.set(l,{id:f,type:"timeout"})},[]),s=g.useCallback((l,i,c)=>{const u=e.current.get(l);u&&(u.type==="timeout"?clearTimeout(u.id):clearInterval(u.id));const f=globalThis.setInterval(i,c);e.current.set(l,{id:f,type:"interval"})},[]),r=g.useCallback(()=>{e.current.forEach(l=>{l.type==="timeout"?clearTimeout(l.id):clearInterval(l.id)}),e.current.clear()},[]),o=g.useCallback(l=>e.current.has(l),[]);return{set:n,setInterval:s,clear:t,clearAll:r,has:o}}function ov(){let e=[],t=!1;return{setup(n){const{step:s,engine:r,pool:o,onAdvance:l,onSetRetryMessage:i,onSetMessageVisible:c,onSetCanDismiss:u,onSetPauseStartTime:f,spawnPieceFromConfig:d,addCrackToGrid:p}=n;e=[],t=!1;const y=ae.on(re.GOAL_CAPTURED,()=>{var m;t=!0;const w=((m=s.setup)==null?void 0:m.hintDelay)??3e3;o.set("hint-timer",()=>{c(!0),u(!1),r.trainingHighlightColor=Ke.GREEN,r.trainingPressureRate=0,r.emitChange()},w)});e.push(y);const v=ae.on(re.GOOP_POPPED,()=>{t&&(o.clear("hint-timer"),l())});e.push(v);const k=ae.on(re.PIECE_DROPPED,()=>{if(t){t=!1;return}o.set("retry-phase1",()=>{r.state.activeGoop||(r.state.isPaused=!1,r.freezeFalling=!1,r.trainingPressureRate=0,r.emitChange(),o.set("retry-phase2",()=>{r.freezeFalling=!0;const w=r.state.grid;for(let m=0;m<w.length;m++)for(let h=0;h<w[m].length;h++){const x=w[m][h];x&&(r.state.poppedGoopGroupIds.add(x.goopGroupId),w[m][h]=null)}r.emitChange(),o.set("retry-phase3",()=>{var x;const m=(x=s.setup)==null?void 0:x.retryOnPieceLand;if(m!=null&&m.spawnExtraCrack){const C=m.spawnExtraCrack.color,j=r.state.tankRotation;for(let R=0;R<30;R++){const P=Math.floor(Math.random()*tt),S=Xe(j+P),T=De-1-Math.floor(Math.random()*2);if(!r.state.crackCells.some(M=>M.x===S&&M.y===T)){p(r,S,T,C,"retry-extra-crack");break}}}r.state.isPaused=!0,f(Date.now());const h=L0[(m==null?void 0:m.retryMessageId)??"D2_RETRY"];h&&i(h),c(!0),d(r,s),r.emitChange(),t=!1},2e3)},2e3))},0)});return e.push(k),e},cleanup(){e.forEach(n=>n()),e=[]}}}function rv(){return{setup(e){return[]},cleanup(){}}}function iv(){let e=[],t=!1,n=!1;return{setup(s){const{step:r,engine:o,pool:l,onAdvance:i,onSetMessageVisible:c,onSetCanDismiss:u,onSuppressContinuousSpawn:f,onMarkStepComplete:d}=s;e=[],t=!1,n=!1;const p=ae.on(re.PIECE_DROPPED,()=>{n||l.set("continuous-deferred",()=>{o.state.activeGoop||n||(o.state.isPaused=!1,o.freezeFalling=!1,o.emitChange(),l.set("continuous-spawn",()=>{n||o.isSessionActive&&!o.state.isPaused&&!o.state.activeGoop&&(o.spawnNewPiece(),o.emitChange())},300))},0)});e.push(p),!o.state.activeGoop&&r.pauseGame===!1&&l.set("continuous-init",()=>{n||o.isSessionActive&&!o.state.isPaused&&!o.state.activeGoop&&(o.spawnNewPiece(),o.emitChange())},300);const y=ae.on(re.GOAL_CAPTURED,()=>{var w;t=!0,n=!0,f(!0),o.freezeFalling=!0,o.emitChange(),l.set("e1-unpause",()=>{o.state.isPaused=!1,o.freezeFalling=!0,o.emitChange()},0),l.clear("message-delay");const k=((w=r.setup)==null?void 0:w.hintDelay)??3e3;l.set("e1-hint",()=>{c(!0),u(!1),o.trainingHighlightColor=Ke.GREEN,o.trainingPressureRate=0,o.emitChange(),l.set("e1-auto-advance",()=>{t&&i()},3e3)},k)});e.push(y);const v=ae.on(re.GOOP_POPPED,()=>{t&&(l.clear("e1-hint"),l.clear("e1-auto-advance"),d("E2_SCAFFOLDING"),i())});return e.push(v),e},cleanup(){e.forEach(s=>s()),e=[],t=!1,n=!1}}}function lv(){let e=[];return{setup(t){var x,C;const{step:n,engine:s,pool:r,onAdvance:o,onSetRetryMessage:l,onSetMessageVisible:i,onSetCanDismiss:c,onArmAdvance:u,onSetPauseStartTime:f,onSetF1Ending:d,getF1Ending:p,onSuppressContinuousSpawn:y,spawnRandomCrack:v}=t;e=[];const k=((x=n.setup)==null?void 0:x.pressureCap)??.95,w=ae.on(re.PIECE_DROPPED,()=>{p()==="none"&&r.set("continuous-deferred",()=>{s.state.activeGoop||p()==="none"&&(s.state.isPaused=!1,s.freezeFalling=!1,s.emitChange(),r.set("continuous-spawn",()=>{p()==="none"&&s.isSessionActive&&!s.state.isPaused&&!s.state.activeGoop&&(s.spawnNewPiece(),s.emitChange())},300))},0)});e.push(w),(C=n.setup)!=null&&C.periodicCrackIntervalMs&&r.setInterval("periodic-cracks",()=>{p()==="none"&&s.isSessionActive&&v(s)},n.setup.periodicCrackIntervalMs),r.setInterval("pressure-cap",()=>{const j=s.maxTime??1;(j>0?Math.max(0,1-s.state.shiftTime/j):0)>=k&&p()==="none"&&(r.clear("pressure-cap"),s.trainingPressureRate=0,s.emitChange(),d("pressure-cap"),l(nr.PRESSURE_CAP),i(!0),c(!0),u())},250);const m=ae.on(re.GAME_OVER,()=>{p()==="none"&&(d("overflow"),s.state.isPaused=!0,s.freezeFalling=!0,s.trainingPressureRate=0,s.emitChange(),l(nr.OVERFLOW),i(!0),c(!1),u())});e.push(m);const h=ae.on(re.INPUT_SWIPE_UP,()=>{p()!=="none"&&o()});return e.push(h),e},cleanup(){e.forEach(t=>t()),e=[]}}}function Zf(){let e=[];return{setup(t){return e=[],e},cleanup(){e.forEach(t=>t()),e=[]}}}function av(){return ov()}function cv(){return rv()}function uv(){return iv()}function fv(){return lv()}function dv(e){switch(e){case"standard":return Zf();case"retry":return av();case"discovery":return cv();case"continuous":return uv();case"freeplay":return fv();default:return Zf()}}const pv={"fast-fall":[re.INPUT_FAST_DROP],"rotate-piece":[re.PIECE_ROTATED],"pop-goop":[re.GOOP_POPPED],"rotate-tank":[re.INPUT_DRAG],"swipe-up":[re.INPUT_SWIPE_UP],"piece-landed":[re.PIECE_DROPPED],"goop-merged":[re.PIECE_DROPPED],"crack-sealed":[re.GOAL_CAPTURED],"game-over":[re.GAME_OVER]},hv=4e3,lc=[Ke.BLUE,Ke.YELLOW,Ke.GREEN,Ke.RED];function yi(e,t,n,s,r){const o=Date.now(),l=Math.random().toString(36).substr(2,9);e.state.crackCells.push({id:l,x:t,y:n,color:s,originCrackId:[],branchCrackIds:[],lastGrowthCheck:o,crackBranchInterval:999999,spawnTime:o}),e.state.goalMarks.push({id:l,x:t,y:n,color:s,spawnTime:o})}function Qf(e,t){var r,o,l;const n=e.state.grid,s=e.state.tankRotation;if(t.placement==="near-stack"){const i=tt-3,c=Xe(s+i),u=t.row??De-2;return{x:c,y:u}}if(t.placement==="high"||t.placement==="at-pressure-line"){const i=e.maxTime??1,u=1+Math.max(0,1-e.state.shiftTime/i)*(Dt-1),f=Math.floor(De-u),d=1+Math.floor(Math.random()*3),p=Math.max(nt,Math.min(De-1,f+d));for(let y=0;y<30;y++){const v=2+Math.floor(Math.random()*(tt-4)),k=Xe(s+v);if(((r=n[p])==null?void 0:r[k])===null)return{x:k,y:p}}return null}if(t.placement==="offscreen"||t.placement==="high-offscreen"||t.placement==="offscreen-pressure-line"){const i=[];for(let c=0;c<we;c++)((c-s)%we+we)%we>=tt&&i.push(c);if(i.length>0){let c;if(t.placement==="offscreen-pressure-line"){const u=e.maxTime??1,d=1+Math.max(0,1-e.state.shiftTime/u)*(Dt-1),p=Math.floor(De-d),y=1+Math.floor(Math.random()*3);c=Math.max(nt,Math.min(De-1,p+y))}else{const u=t.placement==="high-offscreen"?{min:nt,max:nt+4}:{min:De-6,max:De-1};c=u.min+Math.floor(Math.random()*(u.max-u.min+1))}for(let u=0;u<30;u++){const f=i[Math.floor(Math.random()*i.length)];if(((o=n[c])==null?void 0:o[f])===null)return{x:f,y:c}}}return null}for(let i=0;i<30;i++){const c=Math.floor(Math.random()*tt),u=Xe(s+c),f=De-5+Math.floor(Math.random()*3);if(f>=nt&&f<De&&((l=n[f])==null?void 0:l[u])===null)return{x:u,y:f}}return null}function Jf(e,t){const s=[...bs,...pl,...hl].find(l=>l.type===t.shape);if(!s)return;let r=s.cells.map(l=>({...l}));if(t.rotation&&t.rotation>0)for(let l=0;l<t.rotation;l++)r=A0(r,!0);const o={type:t.shape,cells:r,color:t.color};e.spawnNewPiece(o)}function xv(e){var u;const t=e.state.tankRotation,n=lc[Math.floor(Math.random()*lc.length)],s=e.maxTime??1,o=1+Math.max(0,1-e.state.shiftTime/s)*(Dt-1),l=Math.floor(De-o),i=1+Math.floor(Math.random()*3),c=Math.max(nt,Math.min(De-1,l+i));for(let f=0;f<20;f++){const d=Math.floor(Math.random()*tt),p=Xe(t+d),y=(u=e.state.grid[c])==null?void 0:u[p],v=e.state.crackCells.some(k=>k.x===p&&k.y===c);if(y===null&&!v){yi(e,p,c,n),e.emitChange();return}}}const yv=({saveData:e,setSaveData:t,gameEngine:n,rank:s})=>{var J,pe,Me;const r=((J=e.tutorialProgress)==null?void 0:J.completedSteps)??[],o=ic(r),l=s===0&&!o,i=l?Qg(r):null,c=nv(),u=sv(),[f,d]=g.useState(!0),[p,y]=g.useState(!0),[v,k]=g.useState(null),[w,m]=g.useState(null),h=g.useRef(!0),x=g.useRef(null),C=g.useRef(0),j=g.useRef(!1),R=g.useRef(!1);g.useRef(!1);const P=g.useRef(!1),S=g.useRef(!1),T=g.useRef("none"),[E,M]=g.useState(!1),Q=g.useRef(r);Q.current=r;const ne=g.useRef(null);g.useEffect(()=>{var q,K,me,ce,ue,Z,Ce,ke,be,je,Te;if(u.clearAll(),ne.current&&(ne.current.cleanup(),ne.current=null),c.reset(),y(!0),k(null),m(null),R.current=!1,S.current=!1,P.current=!1,j.current=!1,T.current="none",M(!1),!i)return;const he=dv(i.handlerType);ne.current=he;const A=i.pauseGame!==!1&&(((q=i.setup)==null?void 0:q.pauseDelay)!=null||((K=i.setup)==null?void 0:K.showWhenPieceBelow)!=null);if(h.current=i.pauseGame===!1&&!A&&!((me=i.setup)!=null&&me.messageDelay),n&&n.isSessionActive&&(A?(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange()):i.pauseGame!==!1?(n.state.isPaused=!0,n.freezeFalling=!0,x.current=Date.now(),n.emitChange()):(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange()),(ce=i.setup)!=null&&ce.spawnPiece&&Jf(n,i.setup.spawnPiece),(ue=i.setup)!=null&&ue.spawnCrack||(Z=i.setup)!=null&&Z.spawnCracks)){if(n.state.crackCells=[],n.state.goalMarks=[],(Ce=i.setup)!=null&&Ce.spawnCrack){const Pe=Qf(n,i.setup.spawnCrack);Pe&&yi(n,Pe.x,Pe.y,i.setup.spawnCrack.color,`step-setup[${i.id}]`)}if((ke=i.setup)!=null&&ke.spawnCracks)for(const Pe of i.setup.spawnCracks){const Be=Qf(n,Pe);Be&&yi(n,Be.x,Be.y,Pe.color,`step-setup[${i.id}]`)}n.emitChange()}const Y=(be=i.setup)==null?void 0:be.showWhenPieceBelow;return Y!=null&&n?(d(!1),c.waitForTrigger(),u.setInterval("position-poll",()=>{var Be;(((Be=n.state.activeGoop)==null?void 0:Be.y)??0)>=Y&&(u.clear("position-poll"),d(!0),c.showMessage(),i.pauseGame!==!1&&(n.state.isPaused=!0,n.freezeFalling=!0,x.current=Date.now(),n.emitChange()))},200)):((je=i.setup)==null?void 0:je.pauseDelay)!=null?(d(!1),c.waitForTrigger(),u.set("pause-delay",()=>{n&&n.isSessionActive&&(n.state.isPaused=!0,n.freezeFalling=!0,x.current=Date.now(),n.emitChange()),d(!0),c.showMessage()},i.setup.pauseDelay)):i.pauseGame===!1?(Te=i.setup)!=null&&Te.messageDelay?(d(!1),c.waitForTrigger(),u.set("message-delay",()=>{var Pe;d(!0),c.showMessage(),(Pe=i.setup)!=null&&Pe.nonDismissible&&y(!1),h.current=!0},i.setup.messageDelay)):(d(!1),u.set("show-message",()=>{var Pe;d(!0),c.showMessage(),(Pe=i.setup)!=null&&Pe.nonDismissible&&y(!1)},200)):(d(!1),u.set("show-message",()=>{d(!0),c.showMessage()},400)),()=>{u.clearAll()}},[i==null?void 0:i.id]),g.useEffect(()=>{n&&(l?n.pendingTrainingPalette=lc:n.pendingTrainingPalette=null)},[n,l]);const ie=g.useCallback(()=>{if(!i)return;const he=i.id;t(A=>{var K;const Y=((K=A.tutorialProgress)==null?void 0:K.completedSteps)??[];if(Y.includes(he))return A;const q=[...Y,he];return i.markComplete&&!Y.includes(i.markComplete)&&q.push(i.markComplete),{...A,tutorialProgress:{completedSteps:q}}})},[i,t]),L=g.useCallback(()=>{if(n&&x.current){const he=Date.now()-x.current,A=n.state.grid;for(let Y=0;Y<A.length;Y++)for(let q=0;q<A[Y].length;q++){const K=A[Y][q];K&&K.timestamp&&(K.timestamp+=he)}x.current=null}},[n]),ee=g.useCallback(()=>{if(!i)return;h.current=!1,c.advance(),C.current++,j.current=!1,d(!1),u.clearAll(),L(),ie(),n&&n.isSessionActive&&(n.state.isPaused=!0,n.freezeFalling=!0,n.emitChange());const he=[...Q.current,i.id];i.markComplete&&he.push(i.markComplete),ic(he)&&(ae.emit(re.TRAINING_SCENARIO_COMPLETE),n&&(n.pendingTrainingPalette=null))},[L,ie,i,n,c,u]),H=g.useRef(ee);H.current=ee;const G=g.useCallback(()=>{var he,A,Y,q,K;if(T.current==="pressure-cap"&&!S.current){if(d(!1),k(null),T.current="none",M(!1),L(),n&&n.isSessionActive){n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),n.state.activeGoop||u.set("f1-respawn",()=>{n.isSessionActive&&T.current==="none"&&(n.spawnNewPiece(),n.emitChange())},300);const me=((he=i==null?void 0:i.setup)==null?void 0:he.pressureCap)??.95,ce=((A=i==null?void 0:i.setup)==null?void 0:A.pressureRate)??.5;let ue=!1;u.setInterval("pressure-recap",()=>{if(T.current!=="none"){u.clear("pressure-recap");return}const Z=n.maxTime??1,Ce=Z>0?Math.max(0,1-n.state.shiftTime/Z):0;ue?Ce>=me&&(u.clear("pressure-recap"),n.trainingPressureRate=0,n.emitChange(),T.current="pressure-cap",M(!0),k(nr.PRESSURE_CAP),d(!0),y(!0),h.current=!0,n.state.isPaused=!0,n.freezeFalling=!0,x.current=Date.now(),n.emitChange()):Ce<me&&(ue=!0,n.trainingPressureRate=ce,n.emitChange())},250)}return}if(d(!1),L(),c.armAdvance(),n&&n.isSessionActive&&(n.state.isPaused=!1,n.freezeFalling=!1,((Y=i==null?void 0:i.setup)==null?void 0:Y.pressureRate)!=null&&(n.trainingPressureRate=i.setup.pressureRate),n.emitChange()),u.set("arm-advance",()=>{h.current=!0},150),(q=i==null?void 0:i.setup)!=null&&q.continuousSpawn&&n&&(u.set("continuous-first-spawn",()=>{n.isSessionActive&&T.current==="none"&&(n.spawnNewPiece(),n.emitChange())},300),i.setup.periodicCrackIntervalMs&&u.setInterval("periodic-cracks",()=>{T.current==="none"&&n.isSessionActive&&xv(n)},i.setup.periodicCrackIntervalMs)),(K=i==null?void 0:i.setup)!=null&&K.hintDelay){const me=i.setup.hintDelay;u.set("hint-reshow",()=>{n&&n.isSessionActive&&(n.trainingPressureRate=0,n.emitChange(),d(!0),y(!1))},me)}},[L,n,i,u,c]);g.useEffect(()=>{var K,me,ce,ue,Z,Ce,ke,be;if(!i||!l)return;const{advance:he}=i,A=[];if(((K=i.setup)==null?void 0:K.advanceAtRow)!=null&&n){const je=i.setup.advanceAtRow;u.setInterval("advance-at-row",()=>{var Pe;(((Pe=n.state.activeGoop)==null?void 0:Pe.y)??0)>=je&&h.current&&(u.clear("advance-at-row"),H.current())},150)}if(((me=i.setup)==null?void 0:me.advanceAtPressure)!=null&&n){const je=i.setup.advanceAtPressure/100;u.setInterval("advance-at-pressure",()=>{if(!h.current)return;const Te=n.maxTime??1;(Te>0?Math.max(0,1-n.state.shiftTime/Te):0)>=je&&(u.clear("advance-at-pressure"),H.current())},250)}if((ce=i.setup)!=null&&ce.advanceWhenPressureAbovePieces&&n&&u.setInterval("pressure-above-pieces",()=>{var _;if(!h.current)return;const je=n.maxTime??1,Te=je>0?Math.max(0,1-n.state.shiftTime/je):0,Pe=De-1-Te*(Dt-1),Be=((_=i.setup)==null?void 0:_.advancePressureAboveColor)??null;let Ie=De;for(let F=0;F<De;F++){for(let ve=0;ve<n.state.grid[F].length;ve++){const xe=n.state.grid[F][ve];if(xe!==null&&(Be===null||xe.color===Be)){Ie=F;break}}if(Ie<De)break}Pe<Ie&&(u.clear("pressure-above-pieces"),H.current())},250),(ue=i.setup)!=null&&ue.retryOnPieceLand&&n){const je=i.setup.retryOnPieceLand,Te=ae.on(re.GOAL_PLUGGED,()=>{R.current=!0});A.push(Te);const Pe=ae.on(re.PIECE_DROPPED,()=>{const Be=C.current;u.set("retry-check",()=>{var Ie,_;if(C.current===Be&&!n.state.activeGoop){if(R.current){R.current=!1,n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),m(((_=(Ie=i.setup)==null?void 0:Ie.spawnCrack)==null?void 0:_.color)??Ke.GREEN),u.set("plugged-hint",()=>{C.current===Be&&n.isSessionActive&&(k(Kf.E1_SEAL_CRACK),d(!0),y(!1))},3e3);return}n.state.isPaused=!1,n.freezeFalling=!1,n.trainingPressureRate=0,n.emitChange(),u.set("retry-phase2",()=>{if(C.current!==Be)return;n.freezeFalling=!0;const F=n.state.grid;for(let ve=0;ve<F.length;ve++)for(let xe=0;xe<F[ve].length;xe++){const _e=F[ve][xe];_e&&(n.state.poppedGoopGroupIds.add(_e.goopGroupId),F[ve][xe]=null)}n.emitChange(),u.set("retry-phase3",()=>{var xe;if(C.current!==Be)return;if(je.spawnExtraCrack){const _e=je.spawnExtraCrack.color,N=n.state.tankRotation;for(let D=0;D<30;D++){const B=Math.floor(Math.random()*tt),U=Xe(N+B),le=De-1-Math.floor(Math.random()*2);if(!n.state.crackCells.some(I=>I.x===U&&I.y===le)){yi(n,U,le,_e);break}}}n.state.isPaused=!0,x.current=Date.now();const ve=L0[je.retryMessageId];ve&&k(ve),d(!0),h.current=!1,(xe=i.setup)!=null&&xe.spawnPiece&&Jf(n,i.setup.spawnPiece),n.emitChange(),R.current=!1},2e3)},2e3)}},50)});A.push(Pe)}if((Z=i.setup)!=null&&Z.autoSkipMs&&u.set("auto-skip",()=>{H.current()},i.setup.autoSkipMs),(Ce=i.setup)!=null&&Ce.continuousSpawn&&n){const je=ae.on(re.PIECE_DROPPED,()=>{if(T.current!=="none"||j.current)return;const Te=C.current;u.set("continuous-deferred",()=>{n.state.activeGoop||C.current===Te&&(j.current||(n.state.isPaused=!1,n.freezeFalling=!1,n.emitChange(),u.set("continuous-spawn",()=>{C.current===Te&&(j.current||n.isSessionActive&&!n.state.isPaused&&!n.state.activeGoop&&(n.spawnNewPiece(),n.emitChange()))},300)))},0)});if(!n.state.activeGoop&&i.pauseGame===!1){const Te=C.current;u.set("continuous-init",()=>{C.current===Te&&(j.current||n.isSessionActive&&!n.state.isPaused&&!n.state.activeGoop&&(n.spawnNewPiece(),n.emitChange()))},300)}A.push(je)}if(((ke=i.setup)==null?void 0:ke.pressureCap)!=null&&n){const je=i.setup.pressureCap;u.setInterval("pressure-cap",()=>{const Te=n.maxTime??1;(Te>0?Math.max(0,1-n.state.shiftTime/Te):0)>=je&&(u.clear("pressure-cap"),n.trainingPressureRate=0,n.emitChange(),i.id==="F1_GRADUATION"&&T.current==="none"&&(T.current="pressure-cap",M(!0),k(nr.PRESSURE_CAP),d(!0),y(!0),h.current=!0))},250)}if(i.id==="F1_GRADUATION"&&n){const je=()=>{T.current==="none"&&(T.current="overflow",M(!0),n.state.isPaused=!0,n.freezeFalling=!0,n.trainingPressureRate=0,n.emitChange(),k(nr.OVERFLOW),d(!0),y(!1),h.current=!0)},Te=ae.on(re.GAME_OVER,je);A.push(Te)}if(he.type==="tap")return A.length>0?()=>A.forEach(je=>je()):void 0;if(he.type==="auto")return u.set("auto-advance",()=>{H.current()},he.delayMs),()=>A.forEach(je=>je());let Y;if(he.type==="action"){if(he.action==="drag-periscope"){const je=ae.on(re.GAME_START,()=>{h.current&&H.current()});return A.push(je),()=>A.forEach(Te=>Te())}if(he.action==="swipe-up"){const je=ae.on(re.INPUT_SWIPE_UP,()=>{h.current&&T.current!=="none"&&H.current()});return A.push(je),()=>A.forEach(Te=>Te())}Y=he.action}else he.type==="event"&&(Y=he.event);const q=Y?pv[Y]:void 0;if(q&&q.length>0){const je=q.map(Te=>ae.on(Te,()=>{h.current&&H.current()}));A.push(()=>je.forEach(Te=>Te()))}else(be=i.setup)!=null&&be.advanceAtRow||u.set("advance-fallback",()=>{H.current()},hv);return()=>A.forEach(je=>je())},[i==null?void 0:i.id,l]),g.useEffect(()=>{var he;n&&(l&&((he=i==null?void 0:i.setup)!=null&&he.allowedControls)?n.trainingAllowedControls=i.setup.allowedControls:n.trainingAllowedControls=null)},[n,i==null?void 0:i.id,l]),g.useEffect(()=>{var he;n&&(l&&((he=i==null?void 0:i.setup)==null?void 0:he.pressureRate)!=null?n.trainingPressureRate=i.setup.pressureRate:n.trainingPressureRate=0)},[n,i==null?void 0:i.id,l]),g.useEffect(()=>{var A;if(!n)return;const he=w??(l&&((A=i==null?void 0:i.setup)==null?void 0:A.highlightGoopColor)||null);n.trainingHighlightColor=he},[n,i==null?void 0:i.id,l,w]),g.useEffect(()=>{var he;n&&(l&&((he=i==null?void 0:i.setup)!=null&&he.popLowersPressure)?n.trainingPopLowersPressure=!0:n.trainingPopLowersPressure=!1)},[n,i==null?void 0:i.id,l]),g.useEffect(()=>ae.on(re.TRAINING_SCENARIO_COMPLETE,()=>{n&&(n.isTrainingMode=!1,n.pendingTrainingPalette=null,n.trainingAllowedControls=null,n.trainingPressureRate=0,n.trainingHighlightColor=null,n.freezeFalling=!1,n.trainingPopLowersPressure=!1,n.state.crackCells=[],n.state.goalMarks=[],n.state.shiftScore=0,n.state.goalsCleared=0,n.state.isPaused=!1,n.isSessionActive=!1,n.state.phase=qe.ConsoleScreen,n.emitChange(),t(A=>({...A,careerRank:1,careerScore:tn(1)})))}),[n,t]);const X=g.useMemo(()=>!i||!f?null:{message:v??Kf[i.id]??{keywords:[],fullText:i.name}},[i==null?void 0:i.id,f,v]),V=((pe=i==null?void 0:i.setup)==null?void 0:pe.messagePosition)??"center",te=w??(l&&((Me=i==null?void 0:i.setup)==null?void 0:Me.highlightGoopColor)||null);return{currentStep:i,isInTraining:l,isTrainingDone:o,completedStepIds:r,advanceStep:ee,dismissMessage:G,trainingDisplayStep:X,messagePosition:V,highlightColor:te,canDismiss:p,isF1Ending:E}},mv=({onExit:e,onRunComplete:t,initialTotalScore:n,powerUps:s={},scraps:r,settings:o,onOpenSettings:l,onOpenHelp:i,onOpenUpgrades:c,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,equippedActives:p=[],onToggleEquip:y,saveData:v,setSaveData:k})=>{var Je,rt,ct,Ft;const[w,m]=g.useState(!1),[h,x]=g.useState(!1),[C,j]=g.useState(Ke.RED),[R,P]=g.useState(!0),[S,T]=g.useState({...Wi}),[E,M]=g.useState(.2),[Q,ne]=g.useState(!1),[ie,L]=g.useState(5),[ee,H]=g.useState(40),[G,X]=g.useState(-11),[V,te]=g.useState(5),[J,pe]=g.useState(40),[Me,he]=g.useState(-11),A=Hg({enabled:!0,params:S}),Y=g.useCallback((oe,de)=>{if(de.state.gameOver||!de.isSessionActive)return;const Ve={grid:de.state.grid,tankRotation:de.state.tankRotation,fallSpeed:de.freezeFalling?0:de.getFallSpeed(),isPaused:de.state.isPaused};A.step(oe,Ve);const Ge=de.state.activeGoop;if(Ge){const Ye=`active-${Ge.spawnTimestamp}`,Pt=A.getBlob(Ye);if(Pt&&Pt.isFalling&&!Pt.isLocked){const ot=A.getActivePieceState();ot&&de.syncActivePieceFromPhysics(ot.isColliding,ot.gridY)}}},[A]),{engine:q,gameState:K}=Bg(n,s,t,p,Y);g.useEffect(()=>{q.usePhysicsForFalling=!Sn},[q]);const me=g.useCallback(oe=>{q.execute(new rg(oe))},[q]),ce=g.useRef(new Set),ue=g.useRef(0),Z=g.useRef(0),Ce=g.useRef(null),ke=g.useRef(!1),be=g.useRef(null),je=g.useRef(null),Te=250,Be=1500-((s==null?void 0:s.GOOP_SWAP)||0)*250,Ie=K.complications.find(oe=>oe.type===Oe.CONTROLS),_=g.useRef(0);g.useEffect(()=>{Ie||(_.current=0)},[Ie==null?void 0:Ie.id]);const F=o.invertRotation?-1:1;g.useEffect(()=>{if(K.gameOver&&K.phase===qe.ConsoleScreen){const oe=K.goalsCleared>=K.goalsTarget;t({score:K.shiftScore,won:oe})}},[K.gameOver]);const ve=g.useCallback(()=>{ke.current=!1,Ce.current&&(cancelAnimationFrame(Ce.current),Ce.current=null)},[]),xe=g.useCallback(()=>{je.current&&(clearInterval(je.current),je.current=null),be.current=null,ae.emit(re.INPUT_SWAP_HOLD,{progress:-1})},[]),_e=g.useCallback(()=>{je.current||(be.current=Date.now(),ae.emit(re.INPUT_SWAP_HOLD,{progress:0}),je.current=window.setInterval(()=>{if(!be.current)return;const oe=Date.now()-be.current;if(oe<Te)return;const de=oe-Te,Ve=Math.min(100,de/Be*100);ae.emit(re.INPUT_SWAP_HOLD,{progress:Ve}),Ve>=100&&(ae.emit(re.INPUT_SWAP),xe())},16))},[xe]),N=g.useCallback(()=>{if(ke.current)return;ke.current=!0;const oe=()=>{if(!ke.current)return;const de=Date.now(),Ve=Ie?200:100;if(de>=Z.current){let Ye=0;(ce.current.has("ArrowLeft")||ce.current.has("KeyA"))&&(Ye=1*F),(ce.current.has("ArrowRight")||ce.current.has("KeyD"))&&(Ye=-1*F),ue.current!==0&&(Ye=ue.current*F),Ye!==0&&(Ie?(_.current++,_.current>=2&&(q.execute(new Ur(Ye)),_.current=0)):q.execute(new Ur(Ye)),Z.current=de+Ve)}(ce.current.has("ArrowLeft")||ce.current.has("ArrowRight")||ce.current.has("KeyA")||ce.current.has("KeyD")||ue.current!==0)&&K.phase===qe.TankScreen&&!q.state.isPaused&&q.isSessionActive?Ce.current=requestAnimationFrame(oe):ve()};Ce.current=requestAnimationFrame(oe)},[q,K.phase,ve,F,Ie]);g.useEffect(()=>{const oe=Ge=>{if(!Ge.repeat){if(ce.current.add(Ge.code),Ge.key==="`"){Ge.preventDefault(),m(Ye=>!Ye);return}if(Ge.key==="~"){Ge.preventDefault(),x(Ye=>!Ye);return}if(Ge.key==="Backspace"&&K.phase===qe.TankScreen&&q.execute(new Ws(qe.ConsoleScreen)),K.gameOver){Ge.key==="Enter"&&q.resetSession();return}if(K.phase===qe.TankScreen&&!q.state.isPaused&&q.isSessionActive)switch(Ge.code){case"ArrowLeft":case"KeyA":q.execute(new Ur(1*F)),Z.current=Date.now()+250,N();break;case"ArrowRight":case"KeyD":q.execute(new Ur(-1*F)),Z.current=Date.now()+250,N();break;case"KeyQ":q.execute(new No(!1));break;case"KeyE":q.execute(new No(!0));break;case"KeyS":q.execute(new Hl(!0));break;case"Space":q.execute(new Ws(qe.ConsoleScreen));break;case"KeyW":q.execute(new Ws(qe.ConsoleScreen));break;case"KeyR":_e();break}}},de=Ge=>{if(ce.current.delete(Ge.code),K.phase===qe.TankScreen)switch(Ge.code){case"KeyS":q.execute(new Hl(!1));break;case"KeyR":xe();break;case"ArrowLeft":case"KeyA":case"ArrowRight":case"KeyD":!(ce.current.has("ArrowLeft")||ce.current.has("ArrowRight")||ce.current.has("KeyA")||ce.current.has("KeyD"))&&ue.current===0&&ve();break}},Ve=Ge=>{K.phase===qe.TankScreen&&!q.state.isPaused&&!K.gameOver&&q.isSessionActive&&(Ge.deltaY>0?q.execute(new No(!0)):q.execute(new No(!1)))};return window.addEventListener("keydown",oe),window.addEventListener("keyup",de),window.addEventListener("wheel",Ve),()=>{window.removeEventListener("keydown",oe),window.removeEventListener("keyup",de),window.removeEventListener("wheel",Ve),ve(),xe()}},[q,K.phase,K.gameOver,N,ve,_e,xe,F]),g.useEffect(()=>{const oe=ae.on(re.INPUT_ROTATE,ot=>{q.execute(new No((ot==null?void 0:ot.clockwise)??!0))}),de=ae.on(re.INPUT_DRAG,ot=>{ue.current=(ot==null?void 0:ot.direction)??0,(ot==null?void 0:ot.direction)!==0?N():ce.current.has("ArrowLeft")||ce.current.has("ArrowRight")||ce.current.has("KeyA")||ce.current.has("KeyD")||ve()}),Ve=ae.on(re.INPUT_SWIPE_UP,()=>{q.execute(new Ws(qe.ConsoleScreen))}),Ge=ae.on(re.INPUT_FAST_DROP,ot=>{q.execute(new Hl((ot==null?void 0:ot.active)??!1))}),Ye=ae.on(re.INPUT_SWAP,()=>{q.execute(new tg)}),Pt=ae.on(re.INPUT_BLOCK_TAP,ot=>{ot&&q.execute(new ng(ot.x,ot.y))});return()=>{oe(),de(),Ve(),Ge(),Ye(),Pt()}},[q,N,ve]);const D=gt(n).rank,{activeStep:B,completeStep:U,dismissStep:le}=ev({rank:D,isSessionActive:q.isSessionActive,saveData:v,setSaveData:k}),{isInTraining:b,currentStep:I,completedStepIds:O,advanceStep:$,dismissMessage:z,trainingDisplayStep:W,messagePosition:ge,highlightColor:Re,canDismiss:se,isF1Ending:ye}=yv({saveData:v,setSaveData:k,gameEngine:q,rank:D}),Ne=["A","B","C","D","E","F"],Fe=b&&I?(()=>{const oe=Sr.findIndex(Ve=>Ve.id===I.id),de=Ne.map(Ve=>{const Ye=Jg(Ve).every(ot=>O.includes(ot.id)),Pt=I.phase===Ve;return{phase:Ve,status:Ye?"complete":Pt?"current":"upcoming"}});return{phaseName:`Phase ${I.id.split("_")[0]}: ${Zg[I.phase]}`,stepProgress:`Step ${oe+1} of ${Sr.length}`,phaseDots:de}})():void 0,ze=(I==null?void 0:I.advance.type)==="tap",We=b?W:B,Qe=()=>{},$e=b?se?ze?$:z:Qe:U,fe=b?se?ze?$:z:Qe:le;return a.jsxs("div",{className:"w-full h-full relative touch-none bg-slate-950 overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 z-0",children:a.jsx(Tm,{state:K,rank:D,maxTime:q.maxTime,lightsBrightness:K.phase===qe.TankScreen?K.lightsBrightness:100,laserCharge:K.laserCharge,controlsHeat:K.controlsHeat,complicationCooldowns:K.complicationCooldowns,equippedActives:p,activeCharges:K.activeCharges,onActivateAbility:me,powerUps:s,storedGoop:q.state.storedGoop,nextGoop:q.state.nextGoop,softBodyPhysics:A,normalGoopOpacity:E,showVertexDebug:Q,gooStdDev:ie,gooAlphaMul:ee,gooAlphaOff:G,fallingGooStdDev:V,fallingGooAlphaMul:J,fallingGooAlphaOff:Me,trainingHighlightColor:Re,disableSwap:b,disablePop:b&&((rt=(Je=I==null?void 0:I.setup)==null?void 0:Je.allowedControls)==null?void 0:rt.pop)===!1})}),a.jsx("div",{className:`absolute inset-0 z-50 transition-opacity duration-500 ${K.phase===qe.ConsoleScreen?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,children:a.jsx(_g,{engine:q,state:K,careerScore:n,scraps:r,powerUps:s,onOpenSettings:l,onOpenHelp:i,onOpenUpgrades:c,onSetRank:u,onPurchaseUpgrade:f,onRefundUpgrade:d,onDismissGameOver:()=>q.resetSession(),equippedActives:p,onToggleEquip:y,pulsePeriscope:((ct=I==null?void 0:I.setup)==null?void 0:ct.highlightElement)==="periscope"})}),a.jsx("div",{className:`absolute inset-0 z-20 pointer-events-none transition-opacity duration-500 ${K.phase===qe.TankScreen?"opacity-100":"opacity-0"}`,children:a.jsx(Xm,{state:K,onRestart:()=>q.execute(new sg),onExit:()=>{ae.emit(re.GAME_EXITED),q.execute(new Ws(qe.ConsoleScreen))},initialTotalScore:q.initialTotalScore,maxTime:q.maxTime})}),w&&!Sn&&a.jsxs("div",{className:"absolute top-2 right-2 z-[100] bg-black/90 text-white p-3 rounded-lg t-meta font-mono pointer-events-auto overflow-y-auto",style:{minWidth:460,maxHeight:"95vh"},children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"font-bold",children:"Physics Debug"}),a.jsx("button",{onClick:()=>m(!1),className:"text-gray-400 hover:text-white",children:""})]}),a.jsxs("div",{className:"space-y-2 mb-2",children:[a.jsx("div",{className:"text-gray-400 t-meta uppercase tracking-wider",children:"Shared"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Damping: ",S.damping.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:S.damping,onChange:oe=>T(de=>({...de,damping:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Stiffness: ",S.stiffness]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:S.stiffness,onChange:oe=>T(de=>({...de,stiffness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Pressure: ",S.pressure]}),a.jsx("input",{type:"range",min:"0",max:"20",step:"1",value:S.pressure,onChange:oe=>T(de=>({...de,pressure:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Inner Home Stiffness: ",S.innerHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:S.innerHomeStiffness,onChange:oe=>T(de=>({...de,innerHomeStiffness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Iterations: ",S.iterations]}),a.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:S.iterations,onChange:oe=>T(de=>({...de,iterations:Number(oe.target.value)})),className:"w-full"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-gray-600",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-yellow-400 t-meta uppercase tracking-wider",children:"Locked"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Home Stiffness: ",S.homeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.homeStiffness,onChange:oe=>T(de=>({...de,homeStiffness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Return Speed: ",S.returnSpeed.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.returnSpeed,onChange:oe=>T(de=>({...de,returnSpeed:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Viscosity: ",S.viscosity.toFixed(1)]}),a.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:S.viscosity,onChange:oe=>T(de=>({...de,viscosity:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Gravity: ",S.gravity]}),a.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.gravity,onChange:oe=>T(de=>({...de,gravity:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[a.jsx("div",{className:"text-gray-500 t-meta",children:"Goo Filter"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Blur: ",ie]}),a.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:ie,onChange:oe=>L(Number(oe.target.value)),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Alpha Mul: ",ee]}),a.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:ee,onChange:oe=>H(Number(oe.target.value)),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Alpha Off: ",G]}),a.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:G,onChange:oe=>X(Number(oe.target.value)),className:"w-full"})]})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-cyan-400 t-meta uppercase tracking-wider",children:"Falling"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Home Stiffness: ",S.fallingHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingHomeStiffness,onChange:oe=>T(de=>({...de,fallingHomeStiffness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Return Speed: ",S.fallingReturnSpeed.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingReturnSpeed,onChange:oe=>T(de=>({...de,fallingReturnSpeed:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Viscosity: ",S.fallingViscosity.toFixed(1)]}),a.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:S.fallingViscosity,onChange:oe=>T(de=>({...de,fallingViscosity:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Gravity: ",S.fallingGravity]}),a.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.fallingGravity,onChange:oe=>T(de=>({...de,fallingGravity:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[a.jsx("div",{className:"text-gray-500 t-meta",children:"Tendrils"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Goopiness: ",S.fallingGoopiness]}),a.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:S.fallingGoopiness,onChange:oe=>T(de=>({...de,fallingGoopiness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["End Radius: ",S.fallingTendrilEndRadius]}),a.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:S.fallingTendrilEndRadius,onChange:oe=>T(de=>({...de,fallingTendrilEndRadius:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Skinniness: ",S.fallingTendrilSkinniness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.fallingTendrilSkinniness,onChange:oe=>T(de=>({...de,fallingTendrilSkinniness:Number(oe.target.value)})),className:"w-full"})]})]}),a.jsxs("div",{className:"pt-1 border-t border-gray-700",children:[a.jsx("div",{className:"text-gray-500 t-meta",children:"Goo Filter"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Blur: ",V]}),a.jsx("input",{type:"range",min:"1",max:"25",step:"1",value:V,onChange:oe=>te(Number(oe.target.value)),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Alpha Mul: ",J]}),a.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:J,onChange:oe=>pe(Number(oe.target.value)),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Alpha Off: ",Me]}),a.jsx("input",{type:"range",min:"-30",max:"0",step:"1",value:Me,onChange:oe=>he(Number(oe.target.value)),className:"w-full"})]})]})]})]}),a.jsxs("div",{className:"space-y-2 pt-2 border-t border-gray-600 mt-2",children:[a.jsxs("div",{className:"pt-0",children:[a.jsx("div",{className:"text-gray-400 mb-1",children:"Attraction"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Radius: ",S.attractionRadius]}),a.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:S.attractionRadius,onChange:oe=>T(de=>({...de,attractionRadius:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Rest Length: ",S.attractionRestLength]}),a.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.attractionRestLength,onChange:oe=>T(de=>({...de,attractionRestLength:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Stiffness: ",S.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0",max:"0.1",step:"0.001",value:S.attractionStiffness,onChange:oe=>T(de=>({...de,attractionStiffness:Number(oe.target.value)})),className:"w-full"})]})]}),a.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[a.jsx("div",{className:"text-gray-400 mb-1",children:"Rendering"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Goopiness: ",S.goopiness]}),a.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:S.goopiness,onChange:oe=>T(de=>({...de,goopiness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Tendril End Radius: ",S.tendrilEndRadius]}),a.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:S.tendrilEndRadius,onChange:oe=>T(de=>({...de,tendrilEndRadius:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Tendril Skinniness: ",S.tendrilSkinniness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S.tendrilSkinniness,onChange:oe=>T(de=>({...de,tendrilSkinniness:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Wall Thickness: ",S.wallThickness]}),a.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:S.wallThickness,onChange:oe=>T(de=>({...de,wallThickness:Number(oe.target.value)})),className:"w-full"})]})]}),a.jsxs("div",{className:"pt-2 border-t border-gray-600",children:[a.jsx("div",{className:"text-gray-400 mb-1",children:"Droplets (Pop Effect)"}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Count: ",S.dropletCount]}),a.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:S.dropletCount,onChange:oe=>T(de=>({...de,dropletCount:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Speed: ",S.dropletSpeed]}),a.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:S.dropletSpeed,onChange:oe=>T(de=>({...de,dropletSpeed:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Lifetime: ",S.dropletLifetime,"s"]}),a.jsx("input",{type:"range",min:"0.5",max:"5",step:"0.5",value:S.dropletLifetime,onChange:oe=>T(de=>({...de,dropletLifetime:Number(oe.target.value)})),className:"w-full"})]}),a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Size: ",S.dropletSize]}),a.jsx("input",{type:"range",min:"2",max:"30",step:"1",value:S.dropletSize,onChange:oe=>T(de=>({...de,dropletSize:Number(oe.target.value)})),className:"w-full"})]})]}),a.jsx("div",{className:"pt-2 border-t border-gray-600",children:a.jsxs("label",{className:"block",children:[a.jsxs("span",{children:["Normal Goop Opacity: ",E.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:E,onChange:oe=>M(Number(oe.target.value)),className:"w-full"})]})}),a.jsxs("div",{className:"pt-2 border-t border-gray-600 text-gray-400",children:[a.jsxs("div",{children:["Blobs: ",A.blobs.length]}),a.jsxs("div",{className:"flex gap-1 mt-1",children:[a.jsx("button",{onClick:()=>{T({...Wi}),M(.25),ne(!1),L(8),H(24),X(-13),te(8),pe(24),he(-13)},className:"px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded t-meta",children:"Reset to Defaults"}),a.jsx("button",{onClick:()=>{const oe={...S,gooStdDev:ie,gooAlphaMul:ee,gooAlphaOff:G,fallingGooStdDev:V,fallingGooAlphaMul:J,fallingGooAlphaOff:Me,normalGoopOpacity:E};console.log("=== DEBUG PARAMS SNAPSHOT ==="),console.log(JSON.stringify(oe,null,2)),console.log("============================")},className:"px-2 py-1 bg-blue-700 hover:bg-blue-600 rounded t-meta",children:"Save"})]})]})]})]}),!1,h&&!Sn&&(()=>{var Fs,Ro;const oe=gt(n).rank,de=Rn(oe),Ve=[{key:"RED",hex:Ke.RED},{key:"BLUE",hex:Ke.BLUE},{key:"GREEN",hex:Ke.GREEN},{key:"YELLOW",hex:Ke.YELLOW},{key:"PURPLE",hex:Ke.PURPLE},{key:"WHITE",hex:Ke.WHITE},{key:"BLACK",hex:Ke.BLACK}],Ge=36,Ye=7,Pt=(it,xn)=>{const Jn=Math.min(...it.cells.map(Ot=>Ot.x)),J0=Math.max(...it.cells.map(Ot=>Ot.x)),au=Math.min(...it.cells.map(Ot=>Ot.y)),eh=Math.max(...it.cells.map(Ot=>Ot.y)),th=J0-Jn+1,nh=eh-au+1,sh=(Ge-th*Ye)/2,oh=(Ge-nh*Ye)/2;return a.jsx("div",{onClick:()=>{const Ot={...it,color:C};q.state.nextGoop=Ot,R||(q.devOverrideNextGoop=Ot),q.emitChange()},style:{cursor:"pointer",borderRadius:4,border:"1px solid #334155",background:"rgba(30, 41, 59, 0.5)"},title:it.type,onMouseEnter:Ot=>Ot.currentTarget.style.background="rgba(51, 65, 85, 0.8)",onMouseLeave:Ot=>Ot.currentTarget.style.background="rgba(30, 41, 59, 0.5)",children:a.jsx("svg",{width:Ge,height:Ge,children:it.cells.map((Ot,rh)=>a.jsx("rect",{x:sh+(Ot.x-Jn)*Ye,y:oh+(Ot.y-au)*Ye,width:Ye-1,height:Ye-1,fill:C,rx:1},rh))})},xn)},ot=[{label:"TETRA",normal:bs,corrupted:tr},{label:"PENTA",normal:pl,corrupted:ou},{label:"HEXA",normal:hl,corrupted:ru}];return a.jsxs("div",{className:"absolute top-2 left-2 z-[100] bg-black/90 text-white p-3 rounded-lg t-meta font-mono pointer-events-auto overflow-y-auto",style:{minWidth:280,maxHeight:"95vh"},children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("span",{className:"font-bold",children:"Piece Picker"}),a.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-white px-1",children:""})]}),a.jsxs("div",{className:"flex gap-3 mb-2 pb-2 border-b border-gray-700",children:[a.jsxs("div",{className:"text-gray-400",children:[a.jsx("span",{className:"t-meta uppercase tracking-wider",children:"Next:"})," ",a.jsx("span",{className:"text-gray-200",children:((Fs=K.nextGoop)==null?void 0:Fs.type)??""})]}),a.jsxs("div",{className:"text-gray-400",children:[a.jsx("span",{className:"t-meta uppercase tracking-wider",children:"Hold:"})," ",a.jsx("span",{className:"text-gray-200",children:((Ro=K.storedGoop)==null?void 0:Ro.type)??""})]})]}),a.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700",children:[a.jsx("div",{className:"t-meta uppercase tracking-wider text-gray-400 mb-1",children:"Color"}),a.jsx("div",{className:"flex gap-1.5",children:Ve.map(it=>{const xn=de.includes(it.hex),Jn=C===it.hex;return a.jsx("div",{onClick:()=>xn&&j(it.hex),style:{width:24,height:24,borderRadius:"50%",background:it.hex,opacity:xn?1:.3,cursor:xn?"pointer":"not-allowed",border:Jn?"3px solid #facc15":xn?"2px solid #475569":"2px dashed #334155",boxSizing:"border-box"},title:`${it.key}${xn?"":" (locked)"}`},it.key)})})]}),a.jsxs("div",{className:"mb-2 pb-2 border-b border-gray-700 space-y-1",children:[a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:R,onChange:it=>{P(it.target.checked),it.target.checked&&(q.devOverrideNextGoop=null)}}),a.jsx("span",{children:"Random Pieces"})]}),a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:Q,onChange:it=>ne(it.target.checked)}),a.jsx("span",{children:"Show Vertices"})]}),a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:q.freezeTimer,onChange:it=>{q.freezeTimer=it.target.checked}}),a.jsx("span",{children:"Freeze Timer"})]}),a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:q.freezeFalling,onChange:it=>{q.freezeFalling=it.target.checked}}),a.jsx("span",{children:"Freeze Falling"})]})]}),ot.map(it=>a.jsxs("div",{className:"mb-2",children:[a.jsxs("div",{className:"t-meta uppercase tracking-wider text-cyan-400 mb-1",children:[it.label,"  Normal"]}),a.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:it.normal.map((xn,Jn)=>Pt(xn,Jn))}),a.jsxs("div",{className:"t-meta uppercase tracking-wider text-orange-400 mb-1",children:[it.label,"  Corrupted"]}),a.jsx("div",{className:"flex flex-wrap gap-1 mb-1.5",children:it.corrupted.map((xn,Jn)=>Pt(xn,Jn))})]},it.label))]})})(),a.jsx(Kg,{activeStep:We,onComplete:$e,onDismiss:fe,highlightElement:(Ft=I==null?void 0:I.setup)==null?void 0:Ft.highlightElement,messagePosition:b?ge:void 0,advanceType:b?ze?"tap":"dismiss":void 0,blockInteraction:b&&(I==null?void 0:I.pauseGame)!==!1&&!!W&&se&&!ye,trainingProgress:Fe,canDismiss:b?se:!0})]})},gv=({onBack:e})=>a.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),a.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:a.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[a.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[a.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-4",children:a.jsx("h2",{className:"t-title font-bold text-yellow-400 tracking-wider",children:"UPGRADES"})}),a.jsx("div",{className:"w-full max-w-md space-y-4 opacity-50 pointer-events-none",children:[1,2,3].map(t=>a.jsxs("div",{className:"bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-lg flex items-center justify-center",children:a.jsx(iu,{className:"w-6 h-6 text-slate-600"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"font-bold text-slate-300 t-body",children:["Locked Upgrade ",t]}),a.jsxs("div",{className:"t-body text-slate-500",children:["Requires Rank ",t*5]})]})]}),a.jsx("div",{className:"px-3 py-1 bg-slate-800 rounded text-slate-500 t-body font-bold",children:"LOCKED"})]},t))}),a.jsx("div",{className:"mt-8 text-center text-slate-500 t-body",children:"Play more to unlock system upgrades."})]}),a.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:a.jsx("button",{onClick:e,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:a.jsx(xl,{className:"w-1/2 h-1/2 stroke-[3]"})})}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]}),vv=({settings:e,onUpdate:t,onBack:n})=>{g.useEffect(()=>{Tt.init(e)},[]);const s=(l,i)=>{t({...e,[l]:i})},r=({label:l,value:i,onChange:c,icon:u,colorClass:f})=>a.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex flex-col gap-3 transition-colors hover:border-slate-700",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(u,{className:`w-5 h-5 ${f}`}),a.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase t-body",children:l})]}),a.jsxs("span",{className:`font-bold t-body ${f}`,children:[i,"%"]})]}),a.jsxs("div",{className:"relative w-full h-6 flex items-center",children:[a.jsx("input",{type:"range",min:"0",max:"100",value:i,onChange:d=>c(Number(d.target.value)),className:"w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-opacity-50 focus:ring-cyan-500 z-10",style:{background:`linear-gradient(to right, currentColor 0%, currentColor ${i}%, rgba(30, 41, 59, 1) ${i}%, rgba(30, 41, 59, 1) 100%)`}}),a.jsx("style",{children:`
              input[type=range]::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  height: 16px;
                  width: 16px;
                  border-radius: 50%;
                  background: #f1f5f9;
                  margin-top: -2px; /* align center */
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
              input[type=range]::-moz-range-thumb {
                  height: 16px;
                  width: 16px;
                  border: none;
                  border-radius: 50%;
                  background: #f1f5f9;
                  box-shadow: 0 0 10px rgba(255,255,255,0.5);
              }
           `})]})]}),o=({label:l,value:i,onChange:c,icon:u,colorClass:f})=>a.jsxs("div",{className:"bg-slate-900 p-5 rounded-xl border border-slate-800 flex items-center justify-between transition-colors hover:border-slate-700 cursor-pointer",onClick:()=>c(!i),children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(u,{className:`w-5 h-5 ${f}`}),a.jsx("span",{className:"font-bold text-slate-300 tracking-wide uppercase t-body",children:l})]}),a.jsx("div",{className:`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${i?"bg-cyan-600":"bg-slate-700"}`,children:a.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-md transform transition-transform duration-300 ${i?"translate-x-6":"translate-x-0"}`})})]});return a.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),a.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:a.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[a.jsxs("div",{className:"w-full h-full flex flex-col items-center overflow-y-auto px-6 pt-6 pb-32 animate-in slide-in-from-right duration-300 scrollbar-hide",children:[a.jsx("div",{className:"w-full max-w-md flex items-center justify-center mb-6",children:a.jsx("h2",{className:"t-title text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Config"})}),a.jsxs("div",{className:"w-full max-w-md space-y-4",children:[a.jsx(r,{label:"Master Output",value:e.masterVolume,onChange:l=>s("masterVolume",l),icon:Hm,colorClass:"text-cyan-400"}),a.jsx(r,{label:"Music Level",value:e.musicVolume,onChange:l=>s("musicVolume",l),icon:$m,colorClass:"text-purple-400"}),a.jsx(r,{label:"SFX Level",value:e.sfxVolume,onChange:l=>{s("sfxVolume",l)},icon:zm,colorClass:"text-green-400"}),a.jsx("div",{className:"h-px bg-slate-800 my-2"}),a.jsx(o,{label:"Invert Rotation",value:e.invertRotation||!1,onChange:l=>s("invertRotation",l),icon:Gm,colorClass:"text-yellow-400"})]}),a.jsx("div",{className:"mt-8 text-center text-slate-700 t-body uppercase tracking-widest font-bold",children:"Audio System v2.1  Initialized"})]}),a.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:a.jsx("button",{onClick:n,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:a.jsx(xl,{className:"w-1/2 h-1/2 stroke-[3]"})})}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},Vl=[{id:"BASICS",title:"THE OBJECTIVE",icon:"Gauge",unlockedBy:"ALWAYS",sections:[{heading:"PRESSURE SYSTEM",body:"The tank pressure climbs as goop accumulates. If pressure hits 100%, the system fails. Pop goop to vent pressure and buy time."},{heading:"POPPING BASICS",body:"Click or tap solid goop below the pressure line to pop it. Bigger groups vent more pressure. Keep the tank clear."},{heading:"YOUR OBJECTIVE",body:"Seal all cracks before the shift timer runs out. Cracks appear in the tank walls. Place matching-color goop on a crack, then pop it to seal."}]},{id:"CONTROLS",title:"CONTROLS",icon:"Keyboard",unlockedBy:"ROTATE_INTRO",sections:[{heading:"TANK ROTATION",body:"Swipe left/right or A/D keys to rotate the tank. The tank is a cylinder  it wraps all the way around."},{heading:"PIECE ROTATION",body:"Q / E keys or tap screen edges to rotate the falling piece."},{heading:"SOFT DROP",body:"S key or swipe down to make the piece fall faster."},{heading:"HOLD & SWAP",body:"R key to swap the falling piece with your held piece. One swap per drop."},{heading:"CONSOLE RETURN",body:"W or Space to return to the console view. Use this to fix complications."},{heading:"CLICK TO POP",body:"Click or tap solid goop below the pressure line. Groups of same-color goop pop together."}]},{id:"POPPING",title:"PURGING",icon:"Target",unlockedBy:"POP_TIMING",sections:[{heading:"WHAT CAN BE POPPED",body:"Only fully solid goop below the pressure line can be popped. Fresh goop needs time to solidify  watch it fill in."},{heading:"TIMING TENSION",body:"Let goop accumulate for bigger group pops and more points. But wait too long and pressure overwhelms you. Find the balance."},{heading:"MERGING",body:"Same-color goop touching each other merges into bigger blobs. Bigger pops vent more pressure and score more points."}]},{id:"SCORING",title:"SCORING",icon:"ArrowUpCircle",unlockedBy:"FIRST_SHIFT",sections:[{heading:"GROUP SIZE BONUS",body:"Larger groups of connected same-color goop score exponentially more. Two cells is good. Ten cells is great."},{heading:"ELEVATION BONUS",body:"Goop popped higher in the tank scores more. Build up, then pop from the top for maximum points."},{heading:"SHIFTS",body:"Each shift lasts 75 seconds. Seal all assigned cracks before time runs out."}]},{id:"CRACKS",title:"STRUCTURAL DAMAGE",icon:"AlertTriangle",unlockedBy:"CRACK_INTRO",sections:[{heading:"CRACKS SPREAD",body:"Cracks appear in the tank walls and grow over time. Left unchecked, they branch and spread across the surface."},{heading:"SEALING CRACKS",body:"Place matching-color goop on a crack and pop it. Sealed cracks give a massive pressure drop. This is the core of your job."}]},{id:"WRAPPING",title:"CYLINDER WRAP",icon:"RefreshCw",unlockedBy:"WRAP_INTRO",sections:[{heading:"THE TANK WRAPS",body:"The tank is a full cylinder. Goop on the left edge connects to goop on the right edge. Rotate all the way around to see everything."},{heading:"CROSS-SEAM CONNECTIONS",body:"Same-color goop touching across the seam forms one group. Plan wrapping pops for massive combos."}]},{id:"COMPLICATIONS_LIGHTS",title:"LIGHTS FAILURE",icon:"Lightbulb",unlockedBy:"COMPLICATION_LIGHTS",sections:[{heading:"LIGHTS SYSTEM",body:"Details on the lights complication system. (Operator notes pending.)"}]},{id:"COMPLICATIONS_LASER",title:"LASER MALFUNCTION",icon:"Zap",unlockedBy:"COMPLICATION_LASER",sections:[{heading:"LASER SYSTEM",body:"Details on the laser complication system. (Operator notes pending.)"}]},{id:"COMPLICATIONS_CONTROLS",title:"CONTROLS LOCKOUT",icon:"Lock",unlockedBy:"COMPLICATION_CONTROLS",sections:[{heading:"CONTROLS SYSTEM",body:"Details on the controls complication system. (Operator notes pending.)"}]},{id:"UPGRADES",title:"UPGRADES",icon:"Wrench",unlockedBy:"UPGRADE_INTRO",sections:[{heading:"UPGRADE SYSTEM",body:"Details on the upgrade system. (Operator notes pending.)"}]},{id:"ABILITIES",title:"ACTIVE ABILITIES",icon:"Sparkles",unlockedBy:"ABILITY_INTRO",sections:[{heading:"ABILITIES",body:"Details on active abilities. (Operator notes pending.)"}]}];const Sv={Gauge:Lm,Keyboard:Nm,Target:Ym,ArrowUpCircle:_m,AlertTriangle:Im,RefreshCw:Fm,Lightbulb:Dm,Zap:Wm,Lock:iu,Wrench:Um,Sparkles:Bm},Cv=({completedSteps:e,onBack:t})=>{const n=g.useMemo(()=>{const i=new Set;for(const c of Vl)(c.unlockedBy==="ALWAYS"||e.includes(c.unlockedBy))&&i.add(c.id);return i},[e]),s=g.useMemo(()=>{const i=Vl.find(c=>n.has(c.id));return(i==null?void 0:i.id)??null},[n]),[r,o]=g.useState(s),l=i=>{n.has(i)&&o(c=>c===i?null:i)};return a.jsxs("div",{className:"fixed inset-0 w-screen h-[100dvh] bg-slate-950 flex items-center justify-center overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 z-0 opacity-20 bg-[radial-gradient(circle_at_50%_50%,#059669_0%,transparent_50%)] pointer-events-none"}),a.jsx("div",{className:"relative z-10 w-full h-full shadow-2xl",style:{width:"min(100vw, 100dvh * 0.5625)",height:"min(100dvh, 100vw * 1.7778)"},children:a.jsxs("div",{className:"w-full h-full flex flex-col items-center relative bg-slate-950 overflow-hidden border-x-4 border-slate-900",children:[a.jsx("div",{className:"w-full flex items-center justify-center pt-5 pb-3 flex-shrink-0",children:a.jsx("h2",{className:"t-title text-slate-200 tracking-wider uppercase",style:{fontFamily:'"From Where You Are", cursive'},children:"Operator Journal"})}),a.jsx("div",{className:"w-full flex-1 overflow-y-auto pb-28 px-3 space-y-1.5",children:Vl.map(i=>{const c=n.has(i.id),u=r===i.id,f=Sv[i.icon];return a.jsxs("div",{children:[a.jsxs("button",{onClick:()=>l(i.id),disabled:!c,className:`
                      w-full flex items-center gap-3 px-4 py-3
                      rounded-lg border text-left transition-all
                      ${u?"bg-slate-800 border-green-600 text-slate-100":c?"bg-slate-900 border-slate-700 text-slate-400 hover:bg-slate-800 hover:text-slate-300":"bg-slate-900/50 border-slate-800 text-slate-600 cursor-not-allowed opacity-50"}
                    `,style:{minHeight:"48px"},children:[a.jsxs("div",{className:"relative flex-shrink-0",children:[f&&a.jsx(f,{className:`w-5 h-5 ${u?"text-green-400":c?"text-slate-500":"text-slate-700"}`}),!c&&a.jsx(iu,{className:"w-3 h-3 text-slate-600 absolute -bottom-1 -right-1"})]}),a.jsx("span",{className:"t-body flex-1 font-bold uppercase tracking-wider",children:c?i.title:"???"}),c&&a.jsx(Om,{className:`w-5 h-5 flex-shrink-0 transition-transform duration-200 ${u?"rotate-180 text-green-400":"text-slate-600"}`})]}),u&&c&&a.jsx("div",{className:"journal-page-enter mt-1.5 mb-2 space-y-3 pl-2 pr-1",children:i.sections.map((d,p)=>a.jsxs("div",{className:"bg-slate-900/80 p-4 rounded-xl border border-slate-800 backdrop-blur-sm",children:[a.jsx("h4",{className:"t-heading font-bold text-slate-200 uppercase tracking-wider mb-2",children:d.heading}),a.jsx("p",{className:"t-body text-slate-400 leading-relaxed",children:d.body})]},p))})]},i.id)})}),a.jsx("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center z-20 pointer-events-none",children:a.jsx("button",{onClick:t,className:"pointer-events-auto flex items-center justify-center bg-green-700 hover:bg-green-600 text-black rounded-full shadow-[0_0_20px_rgba(21,128,61,0.4)] transition-all active:scale-95 border border-green-500/30",style:{width:"min(13.2vw, 7.4vh)",height:"min(13.2vw, 7.4vh)"},children:a.jsx(xl,{className:"w-1/2 h-1/2 stroke-[3]"})})}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-slate-950 to-transparent pointer-events-none z-10"})]})})]})},Xi="gooptris_save_v3",ed="gooptris_save_v2",ac=()=>({careerRank:1,careerScore:0,scraps:0,powerUps:{},equippedActives:[],unlockedUpgrades:[],firstRunComplete:!1,milestonesReached:[],tutorialProgress:{completedSteps:[]},settings:{masterVolume:50,musicVolume:80,sfxVolume:100,invertRotation:!1}}),kv=e=>{const t={...e};return"operatorXP"in t&&(t.careerScore=t.operatorXP,delete t.operatorXP),"operatorRank"in t&&(t.careerRank=t.operatorRank,delete t.operatorRank),t},wv=()=>{try{let e=localStorage.getItem(Xi);const t=ac();if(!e){const s=localStorage.getItem(ed);if(s){const r=JSON.parse(s),o=kv(r);localStorage.setItem(Xi,JSON.stringify(o)),localStorage.removeItem(ed),e=JSON.stringify(o)}}if(!e)return t;const n=JSON.parse(e);return{...t,...n,settings:{...t.settings,...n.settings||{}},powerUps:{...t.powerUps,...n.powerUps||{}},tutorialProgress:{...t.tutorialProgress,...n.tutorialProgress||{}},equippedActives:n.equippedActives||t.equippedActives,unlockedUpgrades:n.unlockedUpgrades||t.unlockedUpgrades,milestonesReached:n.milestonesReached||t.milestonesReached}}catch(e){return console.error("Failed to load save data",e),ac()}},Pv=e=>{try{localStorage.setItem(Xi,JSON.stringify(e))}catch(t){console.error("Failed to save data",t)}},Rv=()=>{const e=ac();try{localStorage.setItem(Xi,JSON.stringify(e))}catch(t){console.error("Failed to wipe save data",t)}return e},jv=()=>{g.useEffect(()=>{const e=ae.on(re.PIECE_MOVED,()=>Tt.playMove()),t=ae.on(re.PIECE_ROTATED,()=>Tt.playRotate()),n=ae.on(re.PIECE_DROPPED,()=>Tt.playDrop()),s=ae.on(re.GOOP_POPPED,f=>{Tt.playPop((f==null?void 0:f.popStreak)||0)}),r=ae.on(re.ACTION_REJECTED,()=>Tt.playReject()),o=ae.on(re.GOAL_CAPTURED,f=>{Tt.playPop(10)}),l=ae.on(re.GAME_OVER,()=>{Tt.playGameOver(),Tt.stopMusic()}),i=ae.on(re.MUSIC_START,()=>Tt.startMusic()),c=ae.on(re.MUSIC_STOP,()=>Tt.stopMusic()),u=ae.on(re.GAME_RESUMED,()=>{Tt.resume(),Tt.startMusic()});return()=>{e(),t(),n(),s(),r(),o(),l(),i(),c(),u()}},[])},td={damping:.975,gravity:30,stiffness:20,pressure:2.5,iterations:3},nd=40;function sd(e,t){const n=[],s=[],r=[],o=nd,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=N0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,centerX:e,centerY:t,radius:nd*1.5}}function N0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function D0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Tv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function Mv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],i=l.pos.x-o.pos.x,c=l.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function bv(e,t){const n=N0(e.vertices);if(n<1)return;const s=e.restArea/n,r=D0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(l*l+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/c*u,o.pos.y+=i/c*u}}function Av(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.5),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.5)}function Ev(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Iv(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Ev(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const l=D0(s),i=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill(),e.fillStyle="#fff",e.font="10px monospace",e.fillText(String(c),u.pos.x-3,u.pos.y+3)}e.strokeStyle="rgba(52, 152, 219, 0.5)",e.lineWidth=1;for(const c of t.ringsprings)e.beginPath(),e.moveTo(s[c.a].pos.x,s[c.a].pos.y),e.lineTo(s[c.b].pos.x,s[c.b].pos.y),e.stroke();e.strokeStyle="rgba(155, 89, 182, 0.3)";for(const c of t.crossSprings)e.beginPath(),e.moveTo(s[c.a].pos.x,s[c.a].pos.y),e.lineTo(s[c.b].pos.x,s[c.b].pos.y),e.stroke();e.beginPath(),e.arc(l.x,l.y,5,0,Math.PI*2),e.fillStyle="#f39c12",e.fill()}}const ql=500,Kl=400;function _v(){const e=g.useRef(null),t=g.useRef(sd(ql/2,Kl/3)),n=g.useRef(0),s=g.useRef(-1),r=g.useRef({active:!1,vertexIndex:-1}),[o,l]=g.useState(td),[i,c]=g.useState(!0),[u,f]=g.useState(0);g.useEffect(()=>{const m=e.current;if(!m)return;const h=m.getContext("2d");if(!h)return;let x=0,C=performance.now();const j=R=>{x++,R-C>1e3&&(f(x),x=0,C=R);const P=t.current;if(s.current>=0){const S=Math.min((R-s.current)/1e3,.033);Tv(P,S,o);for(let T=0;T<o.iterations;T++)Mv(P,o),bv(P,o);Av(P,m.width,m.height)}s.current=R,r.current.active&&r.current.vertexIndex>=0,h.fillStyle="#2c3e50",h.fillRect(0,0,m.width,m.height),h.fillStyle="#34495e",h.fillRect(0,m.height-10,m.width,10),Iv(h,P,i),n.current=requestAnimationFrame(j)};return n.current=requestAnimationFrame(j),()=>{cancelAnimationFrame(n.current)}},[o,i]);const d=g.useCallback((m,h)=>{const x=t.current;if(!x)return-1;let C=1/0,j=-1;for(let R=0;R<x.vertices.length;R++){const P=x.vertices[R],S=P.pos.x-m,T=P.pos.y-h,E=Math.sqrt(S*S+T*T);E<C&&E<50&&(C=E,j=R)}return j},[]),p=g.useCallback(m=>{const h=e.current;if(!h)return;const x=h.getBoundingClientRect(),C=m.clientX-x.left,j=m.clientY-x.top,R=d(C,j);R>=0&&(r.current={active:!0,vertexIndex:R})},[d]),y=g.useCallback(m=>{if(!r.current.active)return;const h=e.current;if(!h)return;const x=t.current,C=h.getBoundingClientRect(),j=m.clientX-C.left,R=m.clientY-C.top,P=x.vertices[r.current.vertexIndex];P.pos.x=j,P.pos.y=R,P.oldPos.x=j,P.oldPos.y=R},[]),v=g.useCallback(()=>{r.current={active:!1,vertexIndex:-1}},[]),k=g.useCallback(()=>{t.current=sd(ql/2,Kl/3),s.current=-1},[]),w=g.useCallback(()=>{const m=t.current;for(const h of m.vertices)h.oldPos.x=h.pos.x+(Math.random()-.5)*30,h.oldPos.y=h.pos.y+(Math.random()-.5)*30},[]);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-1: Soft Body Blob"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Click and drag vertices to poke the blob"}),a.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("canvas",{ref:e,width:ql,height:Kl,onMouseDown:p,onMouseMove:y,onMouseUp:v,onMouseLeave:v,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"pointer"}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsxs("span",{children:["FPS: ",u]}),a.jsx("span",{children:"Vertices: 10"})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Damping (velocity): ",o.damping.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.001",value:o.damping,onChange:m=>l(h=>({...h,damping:parseFloat(m.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Gravity: ",o.gravity]}),a.jsx("input",{type:"range",min:"-25",max:"50",step:"5",value:o.gravity,onChange:m=>l(h=>({...h,gravity:parseFloat(m.target.value)}))}),a.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"-25 = floats up, 0 = zero-g, 50 = gentle fall"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Stiffness (k): ",o.stiffness]}),a.jsx("input",{type:"range",min:"10",max:"300",step:"10",value:o.stiffness,onChange:m=>l(h=>({...h,stiffness:parseFloat(m.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Pressure: ",o.pressure.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"3",step:"0.1",value:o.pressure,onChange:m=>l(h=>({...h,pressure:parseFloat(m.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Constraint Iterations: ",o.iterations]}),a.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:o.iterations,onChange:m=>l(h=>({...h,iterations:parseInt(m.target.value)}))})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:i,onChange:m=>c(m.target.checked)}),a.jsx("span",{children:"Show Debug (vertices, springs)"})]}),a.jsxs("div",{style:{display:"flex",gap:"10px"},children:[a.jsx("button",{onClick:w,style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Poke!"}),a.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset"})]}),a.jsx("button",{onClick:()=>l(td),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Reset Parameters"})]})]}),a.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[a.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-1 Goals:"}),a.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[a.jsx("li",{children:"Verlet integration with position-based constraints"}),a.jsx("li",{children:"T-tetromino shape with 10 perimeter vertices"}),a.jsx("li",{children:"Ring springs (perimeter) + cross springs (structural)"}),a.jsx("li",{children:"Pressure force for volume preservation"}),a.jsx("li",{children:"Catmull-Rom to Bezier for smooth rendering"})]})]})]})}const od={damping:.92,gravity:0,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.03},Ov=40,Zl=500,Ql=400;function rd(e,t){const n=[],s=[],r=[],o=Ov,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=$0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t}}function $0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function F0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Lv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+n.gravity*t}}function Nv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Dv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],i=l.pos.x-o.pos.x,c=l.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function $v(e,t){const n=$0(e.vertices);if(n<1)return;const s=e.restArea/n,r=F0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(l*l+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/c*u,o.pos.y+=i/c*u}}function Fv(e,t,n){for(const o of e.vertices)o.pos.y>n-10&&(o.pos.y=n-10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.y<10&&(o.pos.y=10,o.oldPos.y=o.pos.y+(o.pos.y-o.oldPos.y)*.3),o.pos.x<10&&(o.pos.x=10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3),o.pos.x>t-10&&(o.pos.x=t-10,o.oldPos.x=o.pos.x+(o.pos.x-o.oldPos.x)*.3)}function Gv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Bv(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let c=0;c<r;c++){const u=t.targetX+s[c].homeOffset.x,f=t.targetY+s[c].homeOffset.y;c===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Gv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const l=F0(s),i=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n){for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}e.strokeStyle="#f39c12",e.lineWidth=2,e.beginPath(),e.moveTo(t.targetX-10,t.targetY),e.lineTo(t.targetX+10,t.targetY),e.moveTo(t.targetX,t.targetY-10),e.lineTo(t.targetX,t.targetY+10),e.stroke()}}function zv(){const e=g.useRef(null),t=g.useRef(rd(Zl/2,Ql/2)),n=g.useRef(0),s=g.useRef(-1),[r,o]=g.useState(od),[l,i]=g.useState(!0),[c,u]=g.useState(0),[f,d]=g.useState("cursor");g.useEffect(()=>{const w=e.current;if(!w)return;const m=w.getContext("2d");if(!m)return;let h=0,x=performance.now();const C=j=>{h++,j-x>1e3&&(u(h),h=0,x=j);const R=t.current;if(s.current>=0){const P=Math.min((j-s.current)/1e3,.033);Lv(R,P,r),Nv(R,r);for(let S=0;S<r.iterations;S++)Dv(R,r),$v(R,r);Fv(R,w.width,w.height)}s.current=j,m.fillStyle="#2c3e50",m.fillRect(0,0,w.width,w.height),Bv(m,R,l),m.fillStyle="rgba(255,255,255,0.5)",m.font="12px system-ui",m.fillText(f==="cursor"?"Move mouse to guide blob":"Click to set target",10,20),n.current=requestAnimationFrame(C)};return n.current=requestAnimationFrame(C),()=>cancelAnimationFrame(n.current)},[r,l,f]);const p=g.useCallback(w=>{if(f!=="cursor")return;const m=e.current;if(!m)return;const h=m.getBoundingClientRect(),x=w.clientX-h.left,C=w.clientY-h.top;t.current.targetX=x,t.current.targetY=C},[f]),y=g.useCallback(w=>{if(f!=="click")return;const m=e.current;if(!m)return;const h=m.getBoundingClientRect();t.current.targetX=w.clientX-h.left,t.current.targetY=w.clientY-h.top},[f]),v=g.useCallback(()=>{t.current=rd(Zl/2,Ql/2),s.current=-1},[]),k=g.useCallback(()=>{const w=t.current;for(const m of w.vertices){const h=m.homeOffset.x,x=m.homeOffset.y;m.homeOffset.x=x,m.homeOffset.y=-h}},[]);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-2: Blob Follows Cursor"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Testing two-layer architecture: render follows data"}),a.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("canvas",{ref:e,width:Zl,height:Ql,onMouseMove:p,onClick:y,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"crosshair"}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[a.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:a.jsxs("span",{children:["FPS: ",c]})}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("div",{style:{display:"flex",gap:"10px"},children:[a.jsx("button",{onClick:()=>d("cursor"),style:{flex:1,padding:"8px",backgroundColor:f==="cursor"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Follow Cursor"}),a.jsx("button",{onClick:()=>d("click"),style:{flex:1,padding:"8px",backgroundColor:f==="click"?"#3498db":"#5a6a7a",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Click Target"})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Home Stiffness: ",r.homeStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.01",max:"0.5",step:"0.01",value:r.homeStiffness,onChange:w=>o(m=>({...m,homeStiffness:parseFloat(w.target.value)}))}),a.jsx("span",{style:{fontSize:"11px",opacity:.6},children:"Low = laggy/stretchy, High = snappy"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Damping: ",r.damping.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.9",max:"1",step:"0.005",value:r.damping,onChange:w=>o(m=>({...m,damping:parseFloat(w.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Stiffness: ",r.stiffness]}),a.jsx("input",{type:"range",min:"5",max:"100",step:"5",value:r.stiffness,onChange:w=>o(m=>({...m,stiffness:parseFloat(w.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Iterations: ",r.iterations]}),a.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:r.iterations,onChange:w=>o(m=>({...m,iterations:parseInt(w.target.value)}))})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:l,onChange:w=>i(w.target.checked)}),a.jsx("span",{children:"Show Debug (target, ghost)"})]}),a.jsxs("div",{style:{display:"flex",gap:"10px"},children:[a.jsx("button",{onClick:k,style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"14px"},children:"Rotate 90"}),a.jsx("button",{onClick:v,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]}),a.jsx("button",{onClick:()=>o(od),style:{padding:"10px",backgroundColor:"#95a5a6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Parameters"})]})]}),a.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[a.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-2 Goals:"}),a.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[a.jsx("li",{children:"Test two-layer architecture (data layer drives render layer)"}),a.jsx("li",{children:"Blob follows cursor/click target with springy physics"}),a.jsx("li",{children:"Slow moves = smooth follow"}),a.jsx("li",{children:"Fast/jump moves = overshoot, bounce, settle"}),a.jsx("li",{children:"Tune homeStiffness for responsive but physical feel"})]})]})]})}const Yv={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.18},Hv=40,Jl=500,ea=400;function id(e,t){const n=[],s=[],r=[],o=Hv,l=[{x:-1.5*o,y:-1*o},{x:-.5*o,y:-1*o},{x:.5*o,y:-1*o},{x:1.5*o,y:-1*o},{x:1.5*o,y:0*o},{x:.5*o,y:0*o},{x:.5*o,y:1*o},{x:-.5*o,y:1*o},{x:-.5*o,y:0*o},{x:-1.5*o,y:0*o}];for(const f of l)n.push({pos:{x:e+f.x,y:t+f.y},oldPos:{x:e+f.x,y:t+f.y},homeOffset:{x:f.x,y:f.y},mass:1});const i=n.length;for(let f=0;f<i;f++){const d=(f+1)%i,p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);s.push({a:f,b:d,restLength:v})}const c=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];for(const[f,d]of c){const p=n[d].pos.x-n[f].pos.x,y=n[d].pos.y-n[f].pos.y,v=Math.sqrt(p*p+y*y);r.push({a:f,b:d,restLength:v})}const u=G0(n);return{vertices:n,ringsprings:s,crossSprings:r,restArea:u,targetX:e,targetY:t,rotationCount:0}}function G0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function B0(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function Uv(e){let t=0;for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=n.pos.x-s,l=n.pos.y-r;t+=Math.sqrt(o*o+l*l)}return t/e.vertices.length}function Wv(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function Xv(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function Vv(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],i=l.pos.x-o.pos.x,c=l.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function qv(e,t){const n=G0(e.vertices);if(n<1)return;const s=e.restArea/n,r=B0(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(l*l+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/c*u,o.pos.y+=i/c*u}}function Kv(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Zv(e,t,n){const{vertices:s}=t,r=s.length;if(n){e.globalAlpha=.3,e.beginPath();for(let c=0;c<r;c++){const u=t.targetX+s[c].homeOffset.x,f=t.targetY+s[c].homeOffset.y;c===0?e.moveTo(u,f):e.lineTo(u,f)}e.closePath(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.globalAlpha=1}e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=Kv(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const l=B0(s),i=e.createRadialGradient(l.x-20,l.y-20,0,l.x,l.y,100);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=3,e.stroke(),n)for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function Qv(){const e=g.useRef(null),t=g.useRef(id(Jl/2,ea/2)),n=g.useRef(0),s=g.useRef(-1),r=g.useRef(0),[o,l]=g.useState(Yv),[i,c]=g.useState(!0),[u,f]=g.useState(0),[d,p]=g.useState(0),[y,v]=g.useState(0),[k,w]=g.useState(!1),[m,h]=g.useState(500),[x,C]=g.useState(0);g.useEffect(()=>{const P=e.current;if(!P)return;const S=P.getContext("2d");if(!S)return;let T=0,E=performance.now();const M=Q=>{T++,Q-E>1e3&&(f(T),T=0,E=Q);const ne=t.current;if(k&&Q-r.current>m){for(const te of ne.vertices){const J=te.homeOffset.x,pe=te.homeOffset.y;te.homeOffset.x=pe,te.homeOffset.y=-J}ne.rotationCount++,v(ne.rotationCount),r.current=Q}if(s.current>=0){const te=Math.min((Q-s.current)/1e3,.033);Wv(ne,te,o),Xv(ne,o);for(let J=0;J<o.iterations;J++)Vv(ne,o),qv(ne,o)}s.current=Q;const ie=Uv(ne);p(ie),ie>x&&C(ie),S.fillStyle="#2c3e50",S.fillRect(0,0,P.width,P.height),Zv(S,ne,i);const L=150,ee=20,H=10,G=P.height-30;S.fillStyle="#34495e",S.fillRect(H,G,L,ee);const X=Math.min(ie/50,1),V=X<.3?"#27ae60":X<.7?"#f39c12":"#e74c3c";S.fillStyle=V,S.fillRect(H,G,L*X,ee),S.strokeStyle="#fff",S.strokeRect(H,G,L,ee),S.fillStyle="#fff",S.font="12px system-ui",S.fillText(`Deviation: ${ie.toFixed(1)}px`,H+5,G+14),n.current=requestAnimationFrame(M)};return n.current=requestAnimationFrame(M),()=>cancelAnimationFrame(n.current)},[o,i,k,m,x]);const j=g.useCallback(()=>{const P=t.current;for(const S of P.vertices){const T=S.homeOffset.x,E=S.homeOffset.y;S.homeOffset.x=E,S.homeOffset.y=-T}P.rotationCount++,v(P.rotationCount)},[]),R=g.useCallback(()=>{t.current=id(Jl/2,ea/2),s.current=-1,v(0),C(0)},[]);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-3: Rotation Stress Test"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:"Spam rotate - does lag accumulate?"}),a.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("canvas",{ref:e,width:Jl,height:ea,style:{border:"2px solid #34495e",borderRadius:"8px"}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"250px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsxs("span",{children:["FPS: ",u]}),a.jsxs("span",{children:["Rotations: ",y]})]}),a.jsxs("div",{style:{padding:"10px",backgroundColor:"#2c3e50",borderRadius:"4px",textAlign:"center"},children:[a.jsxs("div",{style:{fontSize:"24px",fontWeight:"bold"},children:[d.toFixed(1),"px"]}),a.jsx("div",{style:{fontSize:"12px",opacity:.7},children:"Current Deviation"}),a.jsxs("div",{style:{fontSize:"12px",opacity:.5,marginTop:"5px"},children:["Peak: ",x.toFixed(1),"px"]})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsx("button",{onClick:j,style:{padding:"15px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"18px",fontWeight:"bold"},children:"ROTATE 90"}),a.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:k,onChange:P=>w(P.target.checked)}),a.jsx("span",{children:"Auto-rotate"})]}),a.jsx("input",{type:"range",min:"100",max:"2000",step:"100",value:m,onChange:P=>h(parseInt(P.target.value)),style:{flex:1},disabled:!k}),a.jsxs("span",{style:{fontSize:"12px",width:"50px"},children:[m,"ms"]})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Home Stiffness: ",o.homeStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.005",value:o.homeStiffness,onChange:P=>l(S=>({...S,homeStiffness:parseFloat(P.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[a.jsxs("span",{children:["Damping: ",o.damping.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:o.damping,onChange:P=>l(S=>({...S,damping:parseFloat(P.target.value)}))})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:i,onChange:P=>c(P.target.checked)}),a.jsx("span",{children:"Show Debug"})]}),a.jsxs("div",{style:{display:"flex",gap:"10px"},children:[a.jsx("button",{onClick:()=>C(0),style:{flex:1,padding:"10px",backgroundColor:"#3498db",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset Peak"}),a.jsx("button",{onClick:R,style:{flex:1,padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset All"})]})]})]}),a.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"760px"},children:[a.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-3 Goals:"}),a.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[a.jsx("li",{children:"Spam rotate button - observe deviation meter"}),a.jsx("li",{children:"Enable auto-rotate at various speeds"}),a.jsx("li",{children:"Watch for lag accumulation (peak deviation climbing)"}),a.jsx("li",{children:"Target: deviation stays bounded, recovers between rotations"}),a.jsx("li",{children:"Success = peak deviation stays under ~40px even with spam"})]})]})]})}const z0=30,Do=600,$o=450,Jv={damping:.94,stiffness:10,pressure:2.5,iterations:3,homeStiffness:.05,attractionRadius:z0,attractionRestLength:0,attractionStiffness:.02,breakDistance:60};function Zr(e,t,n,s){const r=[],o=[],l=[],i=[],c=z0;let u,f,d,p;const y=1.5,v=.3;s==="T"?(u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],p=[y,y,y,y,y,v,y,y,v,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]],d=[{center:{x:-1*c,y:-.5*c},vertices:[0,1,9]},{center:{x:0*c,y:-.5*c},vertices:[1,2,5,8]},{center:{x:1*c,y:-.5*c},vertices:[2,3,4,5]},{center:{x:0*c,y:.5*c},vertices:[5,6,7,8]}]):(u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],p=[y,y,v,v,y,y,y,y,y,y,y,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]],d=[{center:{x:-1*c,y:-.5*c},vertices:[0,1,2,11]},{center:{x:1*c,y:-.5*c},vertices:[3,4,5,6]},{center:{x:-1*c,y:.5*c},vertices:[9,10,11,2]},{center:{x:0*c,y:.5*c},vertices:[2,3,8,9]},{center:{x:1*c,y:.5*c},vertices:[3,6,7,8]}]);for(let m=0;m<u.length;m++){const h=u[m];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:p[m]})}const k=r.length;for(let m=0;m<k;m++){const h=(m+1)%k,x=r[h].pos.x-r[m].pos.x,C=r[h].pos.y-r[m].pos.y,j=Math.sqrt(x*x+C*C);o.push({a:m,b:h,restLength:j})}for(const[m,h]of f)if(m<k&&h<k){const x=r[h].pos.x-r[m].pos.x,C=r[h].pos.y-r[m].pos.y,j=Math.sqrt(x*x+C*C);l.push({a:m,b:h,restLength:j})}const w=Y0(r);for(const m of d)i.push({center:m.center,vertexIndices:m.vertices});return{vertices:r,ringsprings:o,crossSprings:l,restArea:w,targetX:e,targetY:t,color:n,blocks:i}}function Y0(e){let t=0;const n=e.length;for(let s=0;s<n;s++){const r=(s+1)%n;t+=e[s].pos.x*e[r].pos.y,t-=e[r].pos.x*e[s].pos.y}return Math.abs(t)/2}function lu(e){let t=0,n=0;for(const s of e)t+=s.pos.x,n+=s.pos.y;return{x:t/e.length,y:n/e.length}}function e2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*n.damping,o=(s.pos.y-s.oldPos.y)*n.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o}}function t2(e,t){for(const n of e.vertices){const s=e.targetX+n.homeOffset.x,r=e.targetY+n.homeOffset.y,o=s-n.pos.x,l=r-n.pos.y;n.pos.x+=o*t.homeStiffness,n.pos.y+=l*t.homeStiffness}}function n2(e,t){const n=t.stiffness/100,s=[...e.ringsprings,...e.crossSprings];for(const r of s){const o=e.vertices[r.a],l=e.vertices[r.b],i=l.pos.x-o.pos.x,c=l.pos.y-o.pos.y,u=Math.sqrt(i*i+c*c);if(u<1e-4)continue;const d=(u-r.restLength)/u*n*.5,p=i*d,y=c*d;o.pos.x+=p,o.pos.y+=y,l.pos.x-=p,l.pos.y-=y}}function s2(e,t){const n=Y0(e.vertices);if(n<1)return;const s=e.restArea/n,r=lu(e.vertices);if(!(Math.abs(s-1)<.001))for(const o of e.vertices){const l=o.pos.x-r.x,i=o.pos.y-r.y,c=Math.sqrt(l*l+i*i);if(c<1e-4)continue;const u=Math.max(-.5,Math.min(.5,(s-1)*t.pressure*.1));o.pos.x+=l/c*u,o.pos.y+=i/c*u}}function ld(e,t){return{x:e.targetX+t.center.x,y:e.targetY+t.center.y}}function o2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y;Math.sqrt(c*c+u*u)<n.breakDistance&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];for(const u of i.blocks)for(const f of c.blocks){const d=ld(i,u),p=ld(c,f),y=p.x-d.x,v=p.y-d.y;if(Math.sqrt(y*y+v*v)<n.attractionRadius*4)for(const w of u.vertexIndices)for(const m of f.vertexIndices){const h=`${o}-${w}-${l}-${m}`;if(r.has(h))continue;const x=i.vertices[w],C=c.vertices[m],j=C.pos.x-x.pos.x,R=C.pos.y-x.pos.y,P=Math.sqrt(j*j+R*R),S=n.attractionRadius*x.attractionRadius,T=n.attractionRadius*C.attractionRadius,E=S+T;P<E&&(s.push({blobA:o,vertA:w,blobB:l,vertB:m,restLength:n.attractionRestLength}),r.add(h))}}}return s}function r2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),k=(f-o.restLength)*y*.5,w=c/f*k,m=u/f*k;l.pos.x+=w,l.pos.y+=m,i.pos.x-=w,i.pos.y-=m}}function i2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function l2(e,t,n){const{vertices:s}=t,r=s.length;e.beginPath();const o=s[0].pos;e.moveTo(o.x,o.y);for(let c=0;c<r;c++){const u=s[(c-1+r)%r].pos,f=s[c].pos,d=s[(c+1)%r].pos,p=s[(c+2)%r].pos,{cp1:y,cp2:v}=i2(u,f,d,p);e.bezierCurveTo(y.x,y.y,v.x,v.y,d.x,d.y)}e.closePath();const l=lu(s),i=e.createRadialGradient(l.x-15,l.y-15,0,l.x,l.y,60);if(i.addColorStop(0,"#6fcf97"),i.addColorStop(1,"#27ae60"),e.fillStyle=i,e.fill(),e.strokeStyle="#1e8449",e.lineWidth=2,e.stroke(),n)for(let c=0;c<r;c++){const u=s[c];e.beginPath(),e.arc(u.pos.x,u.pos.y,4,0,Math.PI*2),e.fillStyle="#e74c3c",e.fill()}}function a2(e,t,n){e.strokeStyle="#f39c12",e.lineWidth=2,e.setLineDash([4,4]);for(const s of n){const r=t[s.blobA].vertices[s.vertA],o=t[s.blobB].vertices[s.vertB];e.beginPath(),e.moveTo(r.pos.x,r.pos.y),e.lineTo(o.pos.x,o.pos.y),e.stroke()}e.setLineDash([])}function c2(){const e=g.useRef(null),t=g.useRef([Zr(Do/3,$o/2,"#27ae60","T"),Zr(Do*2/3,$o/2,"#27ae60","U")]),n=g.useRef([]),s=g.useRef(0),r=g.useRef(-1),o=g.useRef(null),[l,i]=g.useState(Jv),[c,u]=g.useState(!0),[f,d]=g.useState(0),[p,y]=g.useState(0);g.useEffect(()=>{const x=e.current;if(!x)return;const C=x.getContext("2d");if(!C)return;let j=0,R=performance.now();const P=S=>{j++,S-R>1e3&&(d(j),j=0,R=S);const T=t.current;if(r.current>=0){const E=Math.min((S-r.current)/1e3,.033);n.current=o2(T,n.current,l),y(n.current.length);for(let M=0;M<T.length;M++){const Q=T[M];e2(Q,E,l);const ne=M===0?{...l,homeStiffness:.3}:l;t2(Q,ne);for(let ie=0;ie<l.iterations;ie++)n2(Q,l),s2(Q,l)}r2(T,n.current,l)}if(r.current=S,C.fillStyle="#2c3e50",C.fillRect(0,0,x.width,x.height),c){C.lineWidth=1;for(const E of T)for(const M of E.vertices){const Q=l.attractionRadius*M.attractionRadius,ne=M.attractionRadius>1;C.strokeStyle=ne?"rgba(243, 156, 18, 0.3)":"rgba(52, 152, 219, 0.3)",C.beginPath(),C.arc(M.pos.x,M.pos.y,Q,0,Math.PI*2),C.stroke()}}c&&a2(C,T,n.current);for(const E of T)l2(C,E,c);C.fillStyle="rgba(255,255,255,0.5)",C.font="12px system-ui",C.fillText("Drag blobs to test attraction",10,20),s.current=requestAnimationFrame(P)};return s.current=requestAnimationFrame(P),()=>cancelAnimationFrame(s.current)},[l,c]);const v=g.useCallback(x=>{const C=e.current;if(!C)return;const j=C.getBoundingClientRect(),R=C.width/j.width,P=C.height/j.height,S=(x.clientX-j.left)*R,T=(x.clientY-j.top)*P,E=t.current[1],M=lu(E.vertices),Q=S-M.x,ne=T-M.y;Math.sqrt(Q*Q+ne*ne)<150&&(o.current={blobIndex:1,offsetX:E.targetX-S,offsetY:E.targetY-T})},[]),k=g.useCallback(x=>{if(!o.current)return;const C=e.current;if(!C)return;const j=C.getBoundingClientRect(),R=C.width/j.width,P=C.height/j.height,S=(x.clientX-j.left)*R,T=(x.clientY-j.top)*P,E=t.current[o.current.blobIndex];E.targetX=S+o.current.offsetX,E.targetY=T+o.current.offsetY},[]),w=g.useCallback(()=>{o.current=null},[]),m=g.useCallback(()=>{t.current=[Zr(Do/3,$o/2,"#27ae60","T"),Zr(Do*2/3,$o/2,"#27ae60","U")],n.current=[],r.current=-1},[]),h=g.useCallback(x=>{const C=t.current[x];for(const j of C.vertices){const R=j.homeOffset.x,P=j.homeOffset.y;j.homeOffset.x=P,j.homeOffset.y=-R}for(const j of C.blocks){const R=j.center.x,P=j.center.y;j.center.x=P,j.center.y=-R}},[]);return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",backgroundColor:"#1a252f",minHeight:"100vh",color:"#ecf0f1",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h1",{style:{margin:"0 0 10px 0"},children:"Proto-4: Two Blobs Attraction"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7},children:'Do vertex springs create the "reaching" effect?'}),a.jsxs("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("canvas",{ref:e,width:Do,height:$o,onMouseDown:v,onMouseMove:k,onMouseUp:w,onMouseLeave:w,style:{border:"2px solid #34495e",borderRadius:"8px",cursor:"grab"}}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"20px",backgroundColor:"#34495e",borderRadius:"8px",minWidth:"280px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[a.jsxs("span",{children:["FPS: ",f]}),a.jsxs("span",{children:["Springs: ",p]})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsx("div",{style:{fontWeight:"bold",color:"#f39c12"},children:"Attraction Settings"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[a.jsxs("span",{children:["Attraction Radius: ",l.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"10",max:"60",step:"5",value:l.attractionRadius,onChange:x=>i(C=>({...C,attractionRadius:parseInt(x.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[a.jsxs("span",{children:["Rest Length: ",l.attractionRestLength,"px"]}),a.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:l.attractionRestLength,onChange:x=>i(C=>({...C,attractionRestLength:parseInt(x.target.value)}))}),a.jsx("span",{style:{fontSize:"10px",opacity:.6},children:"0 = vertices touch"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[a.jsxs("span",{children:["Attraction Stiffness: ",l.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.005",max:"0.1",step:"0.005",value:l.attractionStiffness,onChange:x=>i(C=>({...C,attractionStiffness:parseFloat(x.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[a.jsxs("span",{children:["Break Distance: ",l.breakDistance,"px"]}),a.jsx("input",{type:"range",min:"50",max:"200",step:"10",value:l.breakDistance,onChange:x=>i(C=>({...C,breakDistance:parseInt(x.target.value)}))})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsx("div",{style:{fontWeight:"bold",color:"#3498db"},children:"Blob Physics"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[a.jsxs("span",{children:["Home Stiffness: ",l.homeStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.01",max:"0.2",step:"0.01",value:l.homeStiffness,onChange:x=>i(C=>({...C,homeStiffness:parseFloat(x.target.value)}))})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",gap:"3px"},children:[a.jsxs("span",{children:["Damping: ",l.damping.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:l.damping,onChange:x=>i(C=>({...C,damping:parseFloat(x.target.value)}))})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",cursor:"pointer"},children:[a.jsx("input",{type:"checkbox",checked:c,onChange:x=>u(x.target.checked)}),a.jsx("span",{children:"Show Debug (springs, radius)"})]}),a.jsx("hr",{style:{border:"none",borderTop:"1px solid #4a6278",margin:"5px 0"}}),a.jsxs("div",{style:{display:"flex",gap:"10px"},children:[a.jsx("button",{onClick:()=>h(0),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate T"}),a.jsx("button",{onClick:()=>h(1),style:{flex:1,padding:"10px",backgroundColor:"#9b59b6",border:"none",borderRadius:"4px",color:"white",cursor:"pointer",fontSize:"12px"},children:"Rotate U"})]}),a.jsx("button",{onClick:m,style:{padding:"10px",backgroundColor:"#e74c3c",border:"none",borderRadius:"4px",color:"white",cursor:"pointer"},children:"Reset"})]})]}),a.jsxs("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#34495e",borderRadius:"8px",maxWidth:"860px"},children:[a.jsx("h3",{style:{margin:"0 0 10px 0"},children:"Proto-4 Goals:"}),a.jsxs("ul",{style:{margin:0,paddingLeft:"20px",lineHeight:1.6},children:[a.jsx("li",{children:'Drag blobs close together - watch for "reaching" effect'}),a.jsx("li",{children:"Vertices should stretch toward each other before touching"}),a.jsx("li",{children:"Orange dashed lines = attraction springs forming"}),a.jsx("li",{children:"Drag apart - springs should break cleanly"}),a.jsx("li",{children:"Success = gummy/stretchy feel, NOT magnetic snap"})]})]})]})}const H0=30,u2=600,f2=450,d2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08},ta={none:{enabled:!1,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6},subtle:{enabled:!0,stdDeviation:10,alphaMultiplier:20,alphaOffset:-8},medium:{enabled:!0,stdDeviation:15,alphaMultiplier:24,alphaOffset:-7},aggressive:{enabled:!0,stdDeviation:20,alphaMultiplier:27,alphaOffset:-6}};function p2(e,t){const n=[],s=[],r=H0*.45,o=8,l=12,i=[{x:-r,y:-r},{x:r,y:-r},{x:r,y:r},{x:-r,y:r}];for(let u=0;u<4;u++){const f=i[u],d={x:-Math.sign(f.x),y:-Math.sign(f.y)},p=f.x+d.x*o,y=f.y,v=f.x,k=f.y+d.y*o;u===0?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):u===1?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1}):u===2?n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1}):n.push({pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:p,y},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:f.x+d.x*o*.5,y:f.y+d.y*o*.5},mass:1},{pos:{x:0,y:0},oldPos:{x:0,y:0},homeOffset:{x:v,y:k},mass:1})}for(let u=0;u<l;u++){const f=(u+1)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:f,restLength:Math.sqrt(d*d+p*p)})}for(let u=0;u<l/2;u++){const f=(u+l/2)%l,d=n[f].homeOffset.x-n[u].homeOffset.x,p=n[f].homeOffset.y-n[u].homeOffset.y;s.push({a:u,b:Math.floor(f),restLength:Math.sqrt(d*d+p*p)})}let c=0;for(let u=0;u<l;u++){const f=(u+1)%l;c+=n[u].homeOffset.x*n[f].homeOffset.y,c-=n[f].homeOffset.x*n[u].homeOffset.y}return{vertices:n,springs:s,restArea:Math.abs(c)/2,centerOffset:{x:e,y:t}}}function ad(e,t,n,s){const r=[],o=H0;let l;n==="T"?l=[{x:-o,y:-o*.5},{x:0,y:-o*.5},{x:o,y:-o*.5},{x:0,y:o*.5}]:l=[{x:-o,y:-o*.5},{x:o,y:-o*.5},{x:-o,y:o*.5},{x:0,y:o*.5},{x:o,y:o*.5}];for(const c of l){const u=p2(c.x,c.y);r.push(u)}const i={blocks:r,targetX:e,targetY:t,rotation:0,color:s};return h2(i),i}function Vi(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function h2(e){for(const t of e.blocks){const n=Vi(t.centerOffset.x,t.centerOffset.y,e.rotation),s=e.targetX+n.x,r=e.targetY+n.y;for(const o of t.vertices){const l=Vi(o.homeOffset.x,o.homeOffset.y,e.rotation),i=s+l.x,c=r+l.y;o.pos.x===0&&o.pos.y===0&&(o.pos={x:i,y:c},o.oldPos={x:i,y:c})}}}function x2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function y2(e,t,n){const s=Vi(t.centerOffset.x,t.centerOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of t.vertices){const i=Vi(l.homeOffset.x,l.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-l.pos.x,d=u-l.pos.y;l.pos.x+=f*n.homeStiffness,l.pos.y+=d*n.homeStiffness}}function m2(e,t){for(const n of e.springs){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function g2(e,t){const n=e.vertices.length;let s=0;for(let c=0;c<n;c++){const u=(c+1)%n;s+=e.vertices[c].pos.x*e.vertices[u].pos.y,s-=e.vertices[u].pos.x*e.vertices[c].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;let l=0,i=0;for(const c of e.vertices)l+=c.pos.x,i+=c.pos.y;l/=n,i/=n;for(const c of e.vertices){const u=c.pos.x-l,f=c.pos.y-i,d=Math.sqrt(u*u+f*f);d>1e-4&&(c.pos.x+=u/d*o,c.pos.y+=f/d*o)}}function v2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function S2(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],i=n[(r+1)%t],c=n[(r+2)%t],{cp1:u,cp2:f}=v2(o,l,i,c);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${i.x} ${i.y}`}return s+" Z"}function C2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef(null),o=g.useRef({x:0,y:0}),[l]=g.useState(d2),[i,c]=g.useState(ta.aggressive),[u,f]=g.useState("aggressive"),[,d]=g.useState({});g.useEffect(()=>{const h=[ad(180,250,"T","#e74c3c"),ad(380,250,"U","#e74c3c")];s.current=h},[]),g.useEffect(()=>{let h=!0;const x=C=>{if(h){n.current=C,h=!1,t.current=requestAnimationFrame(x);return}const j=Math.min((C-n.current)/1e3,.033);n.current=C;for(const R of s.current)for(const P of R.blocks){x2(P,l,j),y2(R,P,l);for(let S=0;S<l.iterations;S++)m2(P,l);g2(P,l)}d({}),t.current=requestAnimationFrame(x)};return t.current=requestAnimationFrame(x),()=>cancelAnimationFrame(t.current)},[l]);const p=g.useCallback(h=>{const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),j=h.clientX-C.left,R=h.clientY-C.top;for(let P=0;P<s.current.length;P++){const S=s.current[P],T=j-S.targetX,E=R-S.targetY;if(T*T+E*E<80*80){r.current=P,o.current={x:T,y:E},h.target.setPointerCapture(h.pointerId);break}}},[]),y=g.useCallback(h=>{if(r.current===null)return;const x=e.current;if(!x)return;const C=x.getBoundingClientRect(),j=h.clientX-C.left-o.current.x,R=h.clientY-C.top-o.current.y;s.current[r.current].targetX=j,s.current[r.current].targetY=R},[]),v=g.useCallback(()=>{r.current=null},[]),k=h=>{const x=s.current[h];x.rotation=(x.rotation+90)%360},w=h=>{const x=ta[h];x&&(c(x),f(h))},m=()=>{const{alphaMultiplier:h,alphaOffset:x}=i;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${h} ${x}`};return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5: Goo Filter Variations"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Drag pieces to overlap. Use Rotate buttons. Both pieces are same color for merge test."}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ta).map(h=>a.jsx("button",{onClick:()=>w(h),style:{padding:"8px 16px",background:u===h?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:u===h?"bold":"normal"},children:h.charAt(0).toUpperCase()+h.slice(1)},h))}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Blur: ",i.stdDeviation]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:i.stdDeviation,onChange:h=>{c(x=>({...x,stdDeviation:Number(h.target.value)})),f("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Mult: ",i.alphaMultiplier]}),a.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:i.alphaMultiplier,onChange:h=>{c(x=>({...x,alphaMultiplier:Number(h.target.value)})),f("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Offset: ",i.alphaOffset]}),a.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:i.alphaOffset,onChange:h=>{c(x=>({...x,alphaOffset:Number(h.target.value)})),f("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:i.enabled,onChange:h=>{c(x=>({...x,enabled:h.target.checked})),f(h.target.checked?"custom":"none")}}),a.jsx("span",{children:"Filter On"})]}),a.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[a.jsx("button",{onClick:()=>k(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),a.jsx("button",{onClick:()=>k(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"})]})]}),a.jsxs("svg",{ref:e,width:u2,height:f2,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:p,onPointerMove:y,onPointerUp:v,onPointerLeave:v,children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:i.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:m(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),a.jsx("text",{x:180,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T-tetromino"}),a.jsx("text",{x:380,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U-pentomino"}),a.jsx("g",{filter:i.enabled?"url(#goo-filter)":void 0,children:s.current.map((h,x)=>h.blocks.map((C,j)=>a.jsx("path",{d:S2(C.vertices),fill:h.color,stroke:h.color,strokeWidth:2},`${x}-${j}`)))}),s.current.map((h,x)=>a.jsx("circle",{cx:h.targetX,cy:h.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${x}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Goal:"})," Find filter settings where blocks within a piece merge smoothly, AND where two pieces overlap their blocks also merge into one membrane.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Test:"})," Drag the T into the U's alcove. Rotate pieces. Watch how blocks merge visually."]})]})}const k2=30,w2=600,P2=450,R2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25},na={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function sa(e,t,n,s){const r=[],o=[],l=[],i=k2;let c,u;const f=1.5,d=.3,p=1;let y;if(n==="T")c=[{x:-1.5*i,y:-1*i},{x:-.5*i,y:-1*i},{x:.5*i,y:-1*i},{x:1.5*i,y:-1*i},{x:1.5*i,y:0*i},{x:.5*i,y:0*i},{x:.5*i,y:1*i},{x:-.5*i,y:1*i},{x:-.5*i,y:0*i},{x:-1.5*i,y:0*i}],y=[f,p,p,f,p,d,f,f,d,p],u=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")c=[{x:-1.5*i,y:-1*i},{x:-.5*i,y:-1*i},{x:-.5*i,y:0*i},{x:.5*i,y:0*i},{x:.5*i,y:-1*i},{x:1.5*i,y:-1*i},{x:1.5*i,y:0*i},{x:1.5*i,y:1*i},{x:.5*i,y:1*i},{x:-.5*i,y:1*i},{x:-1.5*i,y:1*i},{x:-1.5*i,y:0*i}],y=[f,f,d,d,f,f,p,f,p,p,f,p],u=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else{const m=.08*i;c=[{x:-1.5*i,y:-1.5*i},{x:-.5*i,y:-1.5*i},{x:-.5*i,y:-.5*i},{x:-m,y:-.5*i},{x:-m,y:-.5*i+m},{x:-.5*i,y:-.5*i+m},{x:-.5*i,y:1.5*i},{x:.5*i,y:1.5*i},{x:.5*i,y:-.5*i+m},{x:m,y:-.5*i+m},{x:m,y:-.5*i},{x:.5*i,y:-.5*i},{x:.5*i,y:-1.5*i},{x:1.5*i,y:-1.5*i},{x:1.5*i,y:-.5*i},{x:.5*i+m,y:-.5*i},{x:.5*i+m,y:-.5*i-m},{x:-.5*i-m,y:-.5*i-m},{x:-.5*i-m,y:-.5*i},{x:-1.5*i,y:-.5*i}],y=[f,p,f,d,d,f,f,f,f,d,d,f,p,f,f,d,d,d,d,p],u=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}for(let m=0;m<c.length;m++){const h=c[m];r.push({pos:{x:e+h.x,y:t+h.y},oldPos:{x:e+h.x,y:t+h.y},homeOffset:{x:h.x,y:h.y},mass:1,attractionRadius:y[m]})}const v=r.length;for(let m=0;m<v;m++){const h=(m+1)%v,x=r[h].homeOffset.x-r[m].homeOffset.x,C=r[h].homeOffset.y-r[m].homeOffset.y;o.push({a:m,b:h,restLength:Math.sqrt(x*x+C*C)})}for(const[m,h]of u){const x=r[h].homeOffset.x-r[m].homeOffset.x,C=r[h].homeOffset.y-r[m].homeOffset.y;l.push({a:m,b:h,restLength:Math.sqrt(x*x+C*C)})}let k=0;for(let m=0;m<v;m++){const h=(m+1)%v;k+=r[m].homeOffset.x*r[h].homeOffset.y,k-=r[h].homeOffset.x*r[m].homeOffset.y}const w=Math.abs(k)/2;return{vertices:r,ringsprings:o,crossSprings:l,restArea:w,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function j2(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function T2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function M2(e,t){for(const n of e.vertices){const s=j2(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,i=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=i*t.homeStiffness}}function b2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function A2(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const i=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const i=(l-1+n)%n,c=(l+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function E2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${l}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,R=C+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function I2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;l.pos.x+=k,l.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function _2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function O2(e){const t=e.length;if(t<3)return"";const n=e.map(r=>r.pos);let s=`M ${n[0].x} ${n[0].y}`;for(let r=0;r<t;r++){const o=n[(r-1+t)%t],l=n[r],i=n[(r+1)%t],c=n[(r+2)%t],{cp1:u,cp2:f}=_2(o,l,i,c);s+=` C ${u.x} ${u.y}, ${f.x} ${f.y}, ${i.x} ${i.y}`}return s+" Z"}function L2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),l=g.useRef({x:0,y:0}),[i,c]=g.useState(R2),[u,f]=g.useState(na.medium),[d,p]=g.useState("medium"),[y,v]=g.useState(!1),[,k]=g.useState({});g.useEffect(()=>{const R=[sa(120,250,"T","#e74c3c"),sa(300,250,"U","#e74c3c"),sa(480,250,"Corrupt","#e74c3c")];s.current=R},[]),g.useEffect(()=>{let R=!0;const P=S=>{if(R){n.current=S,R=!1,t.current=requestAnimationFrame(P);return}const T=Math.min((S-n.current)/1e3,.033);n.current=S;for(const E of s.current){T2(E,i,T),M2(E,i);for(let M=0;M<i.iterations;M++)b2(E,i);E.usePressure&&A2(E,i)}r.current=E2(s.current,r.current,i),I2(s.current,r.current,i),k({}),t.current=requestAnimationFrame(P)};return t.current=requestAnimationFrame(P),()=>cancelAnimationFrame(t.current)},[i]);const w=g.useCallback(R=>{const P=e.current;if(!P)return;const S=P.getBoundingClientRect(),T=R.clientX-S.left,E=R.clientY-S.top;for(let M=0;M<s.current.length;M++){const Q=s.current[M],ne=T-Q.targetX,ie=E-Q.targetY;if(ne*ne+ie*ie<80*80){o.current=M,l.current={x:ne,y:ie},R.target.setPointerCapture(R.pointerId);break}}},[]),m=g.useCallback(R=>{if(o.current===null)return;const P=e.current;if(!P)return;const S=P.getBoundingClientRect(),T=R.clientX-S.left-l.current.x,E=R.clientY-S.top-l.current.y;s.current[o.current].targetX=T,s.current[o.current].targetY=E},[]),h=g.useCallback(()=>{o.current=null},[]),x=R=>{s.current[R].rotation=(s.current[R].rotation+90)%360},C=R=>{const P=na[R];P&&(f(P),p(R))},j=()=>{const{alphaMultiplier:R,alphaOffset:P}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${R} ${P}`};return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5b: Single Perimeter Shapes"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Each shape is ONE continuous soft body (not composed of blocks). Same color for merge test."}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(na).map(R=>a.jsx("button",{onClick:()=>C(R),style:{padding:"8px 16px",background:d===R?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===R?"bold":"normal"},children:R.charAt(0).toUpperCase()+R.slice(1)},R))}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Blur: ",u.stdDeviation]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:R=>{f(P=>({...P,stdDeviation:Number(R.target.value)})),p("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),a.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:R=>{f(P=>({...P,alphaMultiplier:Number(R.target.value)})),p("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),a.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:R=>{f(P=>({...P,alphaOffset:Number(R.target.value)})),p("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:u.enabled,onChange:R=>{f(P=>({...P,enabled:R.target.checked})),p(R.target.checked?"custom":"none")}}),a.jsx("span",{children:"Filter On"})]}),a.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[a.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),a.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),a.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),a.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:R=>c(P=>({...P,goopiness:Number(R.target.value)})),style:{width:120}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance (mozzarella)"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:R=>c(P=>({...P,attractionRadius:Number(R.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"How close to connect"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:R=>c(P=>({...P,attractionStiffness:Number(R.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Pull force (10%-100%)"})]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:a.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:y,onChange:R=>v(R.target.checked)}),a.jsx("span",{children:"Show Springs"})]})]}),a.jsxs("svg",{ref:e,width:w2,height:P2,style:{background:"#2c3e50",borderRadius:8,cursor:"grab"},onPointerDown:w,onPointerMove:m,onPointerUp:h,onPointerLeave:h,children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter-5b",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),a.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),a.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),a.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),a.jsxs("g",{filter:u.enabled?"url(#goo-filter-5b)":void 0,children:[r.current.map((R,P)=>{var V,te;const S=(V=s.current[R.blobA])==null?void 0:V.vertices[R.vertA],T=(te=s.current[R.blobB])==null?void 0:te.vertices[R.vertB];if(!S||!T)return null;const E=T.pos.x-S.pos.x,M=T.pos.y-S.pos.y,Q=Math.sqrt(E*E+M*M),ne=Math.min(1,Q/i.goopiness),ie=8,L=4,ee=ie-(ie-L)*ne,H=ee*1.5,G=Math.max(2,Math.ceil(Q/H)),X=[];for(let J=0;J<=G;J++){const pe=J/G,Me=1-.3*Math.sin(pe*Math.PI),he=ee*Me;X.push({cx:S.pos.x+E*pe,cy:S.pos.y+M*pe,r:Math.max(L*.5,he)})}return a.jsx("g",{children:X.map((J,pe)=>a.jsx("circle",{cx:J.cx,cy:J.cy,r:J.r,fill:"#e74c3c"},pe))},`tendril-${P}`)}),s.current.map((R,P)=>a.jsx("path",{d:O2(R.vertices),fill:R.color,stroke:R.color,strokeWidth:2},P))]}),y&&r.current.map((R,P)=>{var ee,H;const S=(ee=s.current[R.blobA])==null?void 0:ee.vertices[R.vertA],T=(H=s.current[R.blobB])==null?void 0:H.vertices[R.vertB];if(!S||!T)return null;const E=T.pos.x-S.pos.x,M=T.pos.y-S.pos.y,ne=Math.sqrt(E*E+M*M)/i.goopiness,ie=Math.min(255,Math.floor(ne*255)),L=Math.max(0,255-Math.floor(ne*255));return a.jsx("line",{x1:S.pos.x,y1:S.pos.y,x2:T.pos.x,y2:T.pos.y,stroke:`rgb(${ie},${L},100)`,strokeWidth:2,opacity:.7},`spring-${P}`)}),s.current.map((R,P)=>a.jsx("circle",{cx:R.targetX,cy:R.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${P}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Proto-5b + Attraction:"}),' Single-perimeter shapes with physics-based attraction springs. When pieces get close, springs form. Pull them apart to see the "mozzarella pull" effect  they stretch until breaking at the Goopiness distance.',a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Goopiness:"}),' Controls how far the "mozzarella strings" stretch before snapping. Higher = longer stretchy connections when pulling apart.',a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Stiffness Ramp:"})," Attraction is weak (10%) at max distance (reaching effect) and strong (100%) when close (solid merge). This creates natural-looking goop behavior.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Test:"})," Drag T into U's notch, let them merge, then slowly pull apart to see the stretching effect."]})]})}const N2=30,D2=600,$2=450,F2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},oa={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}};function ra(e,t,n,s){const r=[],o=[],l=[],i=[],c=N2;let u,f;const d=1.5,p=.3,y=1;let v;if(n==="T")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],v=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],v=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*c;u=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-x,y:-.5*c},{x:-x,y:-.5*c+x},{x:-.5*c,y:-.5*c+x},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+x},{x,y:-.5*c+x},{x,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+x,y:-.5*c},{x:.5*c+x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c},{x:-1.5*c,y:-.5*c}],v=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*c,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:.5*c},{x:-.5*c,y:.5*c}],v=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c}],v=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:v[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const k=r.length;for(let x=0;x<k;x++){const C=(x+1)%k,j=r[C].homeOffset.x-r[x].homeOffset.x,R=r[C].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:C,restLength:Math.sqrt(j*j+R*R)})}for(const[x,C]of f){const j=r[C].homeOffset.x-r[x].homeOffset.x,R=r[C].homeOffset.y-r[x].homeOffset.y;i.push({a:x,b:C,restLength:Math.sqrt(j*j+R*R)})}let w=0;for(let x=0;x<k;x++){const C=(x+1)%k;w+=r[x].homeOffset.x*r[C].homeOffset.y,w-=r[C].homeOffset.x*r[x].homeOffset.y}const m=Math.abs(w)/2;let h;if(n==="Corrupt"){const x=.5*c;h=[{offsetX:-c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-c},{x,y:-c},{x,y:c},{x:-x,y:c}],outerVertexIndices:[5,8,7,6]}].map(j=>{const R=j.points.map(P=>{const S=e+j.offsetX+P.x,T=t+j.offsetY+P.y;return{pos:{x:S,y:T},oldPos:{x:S,y:T},homeOffset:{x:P.x,y:P.y}}});return{...j,vertices:R,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:i,restArea:m,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt"}}function Qr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function G2(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function B2(e,t){for(const n of e.vertices){const s=Qr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,i=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=i*t.homeStiffness}for(const n of e.innerVertices){const s=Qr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,i=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=i*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Qr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const i=Qr(l.homeOffset.x,l.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function z2(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function Y2(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const i=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const i=(l-1+n)%n,c=(l+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function H2(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${l}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,R=C+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function U2(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;l.pos.x+=k,l.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function W2(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function cc(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=W2(r,o,l,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function X2(e){return cc(e.map(t=>t.pos))}function cd(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-l.x,y=d.y-l.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-l.x,f=i.y-l.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,R=m;let P=x+j,S=C+R;const T=Math.sqrt(P*P+S*S);T<.001?(P=x,S=C):(P/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),Q=M>.1?1/M:10,ne=s[o]*.4,ie=Math.min(t,ne);r.push({x:i.x+P*ie*Math.min(Q,3),y:i.y+S*ie*Math.min(Q,3)})}return r}function V2(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),l=g.useRef({x:0,y:0}),[i,c]=g.useState(F2),[u,f]=g.useState(oa.medium),[d,p]=g.useState("medium"),[y,v]=g.useState(!1),[,k]=g.useState({});g.useEffect(()=>{const P=[ra(120,250,"T","#e74c3c"),ra(300,250,"U","#e74c3c"),ra(480,250,"Corrupt","#e74c3c")];s.current=P},[]),g.useEffect(()=>{let P=!0;const S=T=>{if(P){n.current=T,P=!1,t.current=requestAnimationFrame(S);return}const E=Math.min((T-n.current)/1e3,.033);n.current=T;for(const M of s.current){G2(M,i,E),B2(M,i);for(let Q=0;Q<i.iterations;Q++)z2(M,i);M.usePressure&&Y2(M,i)}r.current=H2(s.current,r.current,i),U2(s.current,r.current,i),k({}),t.current=requestAnimationFrame(S)};return t.current=requestAnimationFrame(S),()=>cancelAnimationFrame(t.current)},[i]);const w=g.useCallback(P=>{const S=e.current;if(!S)return;const T=S.getBoundingClientRect(),E=P.clientX-T.left,M=P.clientY-T.top;for(let Q=0;Q<s.current.length;Q++){const ne=s.current[Q],ie=E-ne.targetX,L=M-ne.targetY;if(ie*ie+L*L<80*80){o.current=Q,l.current={x:ie,y:L},P.target.setPointerCapture(P.pointerId);break}}},[]),m=g.useCallback(P=>{if(o.current===null)return;const S=e.current;if(!S)return;const T=S.getBoundingClientRect(),E=P.clientX-T.left-l.current.x,M=P.clientY-T.top-l.current.y;s.current[o.current].targetX=E,s.current[o.current].targetY=M},[]),h=g.useCallback(()=>{o.current=null},[]),x=P=>{s.current[P].rotation=(s.current[P].rotation+90)%360},C=P=>{const S=oa[P];S&&(f(S),p(P))},j=()=>{const{alphaMultiplier:P,alphaOffset:S}=u;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${P} ${S}`},R="#2c3e50";return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-5c: Cell Wall (Outer - Inner)"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Outer gooey silhouette + stable inner core = visible cell wall ring"}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(oa).map(P=>a.jsx("button",{onClick:()=>C(P),style:{padding:"8px 16px",background:d===P?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:d===P?"bold":"normal"},children:P.charAt(0).toUpperCase()+P.slice(1)},P))}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Blur: ",u.stdDeviation]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:u.stdDeviation,onChange:P=>{f(S=>({...S,stdDeviation:Number(P.target.value)})),p("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Mult: ",u.alphaMultiplier]}),a.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:u.alphaMultiplier,onChange:P=>{f(S=>({...S,alphaMultiplier:Number(P.target.value)})),p("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Offset: ",u.alphaOffset]}),a.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:u.alphaOffset,onChange:P=>{f(S=>({...S,alphaOffset:Number(P.target.value)})),p("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:u.enabled,onChange:P=>{f(S=>({...S,enabled:P.target.checked})),p(P.target.checked?"custom":"none")}}),a.jsx("span",{children:"Filter On"})]}),a.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[a.jsx("button",{onClick:()=>x(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),a.jsx("button",{onClick:()=>x(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),a.jsx("button",{onClick:()=>x(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",i.innerHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i.innerHomeStiffness,onChange:P=>c(S=>({...S,innerHomeStiffness:Number(P.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),a.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:P=>c(S=>({...S,goopiness:Number(P.target.value)})),style:{width:120}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:P=>c(S=>({...S,attractionRadius:Number(P.target.value)})),style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:P=>c(S=>({...S,attractionStiffness:Number(P.target.value)})),style:{width:100}})]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:a.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:y,onChange:P=>v(P.target.checked)}),a.jsx("span",{children:"Show Springs"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",i.tendrilEndRadius,"px"]}),a.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:i.tendrilEndRadius,onChange:P=>c(S=>({...S,tendrilEndRadius:Number(P.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",i.tendrilSkinniness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:i.tendrilSkinniness,onChange:P=>c(S=>({...S,tendrilSkinniness:Number(P.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",i.wallThickness,"px"]}),a.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:i.wallThickness,onChange:P=>c(S=>({...S,wallThickness:Number(P.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),a.jsxs("svg",{ref:e,width:D2,height:$2,style:{background:R,borderRadius:8,cursor:"grab"},onPointerDown:w,onPointerMove:m,onPointerUp:h,onPointerLeave:h,children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter-5c",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:u.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:j(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),a.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),a.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),a.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),a.jsxs("g",{filter:u.enabled?"url(#goo-filter-5c)":void 0,children:[r.current.map((P,S)=>{var pe,Me;const T=(pe=s.current[P.blobA])==null?void 0:pe.vertices[P.vertA],E=(Me=s.current[P.blobB])==null?void 0:Me.vertices[P.vertB];if(!T||!E)return null;const M=E.pos.x-T.pos.x,Q=E.pos.y-T.pos.y,ne=Math.sqrt(M*M+Q*Q),ie=Math.min(1,ne/i.goopiness),L=i.tendrilEndRadius,ee=1-i.tendrilSkinniness,H=1-i.tendrilSkinniness*.3,G=H-(H-ee)*ie,X=L*G,V=L*1.4,te=Math.max(2,Math.ceil(ne/V)),J=[];for(let he=0;he<=te;he++){const A=he/te,Y=Math.sin(A*Math.PI),q=L-(L-X)*Y;J.push({cx:T.pos.x+M*A,cy:T.pos.y+Q*A,r:Math.max(2,q)})}return a.jsx("g",{children:J.map((he,A)=>a.jsx("circle",{cx:he.cx,cy:he.cy,r:he.r,fill:"#e74c3c"},A))},`tendril-${S}`)}),s.current.map((P,S)=>a.jsx("path",{d:X2(P.vertices),fill:P.color,stroke:P.color,strokeWidth:2},S))]}),s.current.map((P,S)=>{if(P.innerRegions)return P.innerRegions.map((T,E)=>{let M;T.outerVertexIndices?M=T.outerVertexIndices.map(ne=>P.vertices[ne].pos):M=T.vertices.map(ne=>ne.pos);const Q=cd(M,i.wallThickness);return a.jsx("path",{d:cc(Q),fill:R},`inner-${S}-${E}`)});{const T=P.vertices.map(M=>M.pos),E=cd(T,i.wallThickness);return a.jsx("path",{d:cc(E),fill:R},`inner-${S}`)}}),y&&r.current.map((P,S)=>{var H,G;const T=(H=s.current[P.blobA])==null?void 0:H.vertices[P.vertA],E=(G=s.current[P.blobB])==null?void 0:G.vertices[P.vertB];if(!T||!E)return null;const M=E.pos.x-T.pos.x,Q=E.pos.y-T.pos.y,ie=Math.sqrt(M*M+Q*Q)/i.goopiness,L=Math.min(255,Math.floor(ie*255)),ee=Math.max(0,255-Math.floor(ie*255));return a.jsx("line",{x1:T.pos.x,y1:T.pos.y,x2:E.pos.x,y2:E.pos.y,stroke:`rgb(${L},${ee},100)`,strokeWidth:2,opacity:.7},`spring-${S}`)}),s.current.map((P,S)=>a.jsx("circle",{cx:P.targetX,cy:P.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${S}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Proto-5c: Cell Wall Model"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Two layers:"}),a.jsx("br",{})," ",a.jsx("strong",{children:"Outer"})," (gooey): Stretches, merges with filter effect",a.jsx("br",{})," ",a.jsx("strong",{children:"Inner"})," (stable): Barely moves, cuts out the center",a.jsx("br",{})," ",a.jsx("strong",{children:"Cell Wall"}),": The visible ring between them",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Inner Stiffness:"})," Controls how stable the core is (higher = more rigid)",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Next:"})," Dynamic rebuilding when pieces lock (merge walls) or become loose goop (amputate)"]})]})}const q2=30,K2=600,Z2=450,Q2={damping:.94,stiffness:15,pressure:2.5,iterations:3,homeStiffness:.08,innerHomeStiffness:.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ia={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},J2={autoFill:!0,fillRate:.15},ud=1.15,e3=200;function la(e,t,n,s){const r=[],o=[],l=[],i=[],c=q2;let u,f;const d=1.5,p=.3,y=1;let v;if(n==="T")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-.5*c,y:0*c},{x:-1.5*c,y:0*c}],v=[d,y,y,d,y,p,d,d,p,y],f=[[0,4],[0,5],[3,9],[3,8],[1,8],[2,5],[5,8],[6,9],[7,4],[0,7],[3,6]];else if(n==="U")u=[{x:-1.5*c,y:-1*c},{x:-.5*c,y:-1*c},{x:-.5*c,y:0*c},{x:.5*c,y:0*c},{x:.5*c,y:-1*c},{x:1.5*c,y:-1*c},{x:1.5*c,y:0*c},{x:1.5*c,y:1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c},{x:-1.5*c,y:1*c},{x:-1.5*c,y:0*c}],v=[d,d,p,p,d,d,y,d,y,y,d,y],f=[[0,6],[5,10],[1,11],[4,6],[2,9],[3,8],[0,9],[5,8],[2,10],[3,7],[11,8],[6,9]];else if(n==="Corrupt"){const x=.08*c;u=[{x:-1.5*c,y:-1.5*c},{x:-.5*c,y:-1.5*c},{x:-.5*c,y:-.5*c},{x:-x,y:-.5*c},{x:-x,y:-.5*c+x},{x:-.5*c,y:-.5*c+x},{x:-.5*c,y:1.5*c},{x:.5*c,y:1.5*c},{x:.5*c,y:-.5*c+x},{x,y:-.5*c+x},{x,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:-1.5*c},{x:1.5*c,y:-1.5*c},{x:1.5*c,y:-.5*c},{x:.5*c+x,y:-.5*c},{x:.5*c+x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c-x},{x:-.5*c-x,y:-.5*c},{x:-1.5*c,y:-.5*c}],v=[d,y,d,p,p,d,d,d,d,p,p,d,y,d,d,p,p,p,p,y],f=[[0,2],[1,19],[5,7],[6,8],[11,13],[12,14],[0,6],[13,7],[3,10],[4,9]]}else n==="Square"?(u=[{x:-.5*c,y:-.5*c},{x:.5*c,y:-.5*c},{x:.5*c,y:.5*c},{x:-.5*c,y:.5*c}],v=[d,d,d,d],f=[[0,2],[1,3]]):(u=[{x:-.5*c,y:-1*c},{x:.5*c,y:-1*c},{x:.5*c,y:1*c},{x:-.5*c,y:1*c}],v=[d,d,d,d],f=[[0,2],[1,3]]);for(let x=0;x<u.length;x++){const C=u[x];r.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y},mass:1,attractionRadius:v[x]}),o.push({pos:{x:e+C.x,y:t+C.y},oldPos:{x:e+C.x,y:t+C.y},homeOffset:{x:C.x,y:C.y}})}const k=r.length;for(let x=0;x<k;x++){const C=(x+1)%k,j=r[C].homeOffset.x-r[x].homeOffset.x,R=r[C].homeOffset.y-r[x].homeOffset.y;l.push({a:x,b:C,restLength:Math.sqrt(j*j+R*R)})}for(const[x,C]of f){const j=r[C].homeOffset.x-r[x].homeOffset.x,R=r[C].homeOffset.y-r[x].homeOffset.y;i.push({a:x,b:C,restLength:Math.sqrt(j*j+R*R)})}let w=0;for(let x=0;x<k;x++){const C=(x+1)%k;w+=r[x].homeOffset.x*r[C].homeOffset.y,w-=r[C].homeOffset.x*r[x].homeOffset.y}const m=Math.abs(w)/2;let h;if(n==="Corrupt"){const x=.5*c;h=[{offsetX:-c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[0,1,2,19]},{offsetX:c,offsetY:-c,points:[{x:-x,y:-x},{x,y:-x},{x,y:x},{x:-x,y:x}],outerVertexIndices:[12,13,14,11]},{offsetX:0,offsetY:x,points:[{x:-x,y:-c},{x,y:-c},{x,y:c},{x:-x,y:c}],outerVertexIndices:[5,8,7,6]}].map(j=>{const R=j.points.map(P=>{const S=e+j.offsetX+P.x,T=t+j.offsetY+P.y;return{pos:{x:S,y:T},oldPos:{x:S,y:T},homeOffset:{x:P.x,y:P.y}}});return{...j,vertices:R,outerVertexIndices:j.outerVertexIndices}})}return{vertices:r,innerVertices:o,innerRegions:h,ringsprings:l,crossSprings:i,restArea:m,targetX:e,targetY:t,rotation:0,color:s,usePressure:n!=="Corrupt",fillAmount:0,isShaking:!1,boopScale:1,wasFullLastFrame:!1}}function Jr(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function t3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}if(e.innerRegions)for(const s of e.innerRegions)for(const r of s.vertices){const o=(r.pos.x-r.oldPos.x)*t.damping,l=(r.pos.y-r.oldPos.y)*t.damping;r.oldPos.x=r.pos.x,r.oldPos.y=r.pos.y,r.pos.x+=o,r.pos.y+=l+10*n*n}}function n3(e,t){for(const n of e.vertices){const s=Jr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,i=o-n.pos.y;n.pos.x+=l*t.homeStiffness,n.pos.y+=i*t.homeStiffness}for(const n of e.innerVertices){const s=Jr(n.homeOffset.x,n.homeOffset.y,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y,l=r-n.pos.x,i=o-n.pos.y;n.pos.x+=l*t.innerHomeStiffness,n.pos.y+=i*t.innerHomeStiffness}if(e.innerRegions)for(const n of e.innerRegions){const s=Jr(n.offsetX,n.offsetY,e.rotation),r=e.targetX+s.x,o=e.targetY+s.y;for(const l of n.vertices){const i=Jr(l.homeOffset.x,l.homeOffset.y,e.rotation),c=r+i.x,u=o+i.y,f=c-l.pos.x,d=u-l.pos.y;l.pos.x+=f*t.innerHomeStiffness,l.pos.y+=d*t.innerHomeStiffness}}}function s3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function o3(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const i=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const i=(l-1+n)%n,c=(l+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function r3(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y;Math.sqrt(c*c+u*u)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l],u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${l}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,R=C+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function i3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA].vertices[o.vertA],i=e[o.blobB].vertices[o.vertB],c=i.pos.x-l.pos.x,u=i.pos.y-l.pos.y,f=Math.sqrt(c*c+u*u);if(f<1e-4)continue;const d=n.attractionRadius*(l.attractionRadius+i.attractionRadius),p=1-Math.max(0,Math.min(1,(f-o.restLength)/(d-o.restLength))),y=s+p*(r-s),v=f-o.restLength,k=c/f*v*y,w=u/f*v*y;l.pos.x+=k,l.pos.y+=w,i.pos.x-=k,i.pos.y-=w}}function l3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function U0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=l3(r,o,l,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function a3(e){return U0(e.map(t=>t.pos))}function fd(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-l.x,y=d.y-l.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-l.x,f=i.y-l.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,R=m;let P=x+j,S=C+R;const T=Math.sqrt(P*P+S*S);T<.001?(P=x,S=C):(P/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),Q=M>.1?1/M:10,ne=s[o]*.4,ie=Math.min(t,ne);r.push({x:i.x+P*ie*Math.min(Q,3),y:i.y+S*ie*Math.min(Q,3)})}return r}function c3(){var Q,ne,ie;const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef(null),l=g.useRef({x:0,y:0}),[i,c]=g.useState(Q2),[u,f]=g.useState(J2),[d,p]=g.useState(ia.medium),[y,v]=g.useState("medium"),[k,w]=g.useState(!1),[,m]=g.useState({});g.useEffect(()=>{const L=[la(120,250,"T","#e74c3c"),la(300,250,"U","#e74c3c"),la(480,250,"Corrupt","#e74c3c")];s.current=L},[]),g.useEffect(()=>{let L=!0;const ee=H=>{if(L){n.current=H,L=!1,t.current=requestAnimationFrame(ee);return}const G=Math.min((H-n.current)/1e3,.033);n.current=H;for(const X of s.current){t3(X,i,G),n3(X,i);for(let te=0;te<i.iterations;te++)s3(X,i);X.usePressure&&o3(X,i),u.autoFill&&X.fillAmount<1&&(X.fillAmount=Math.min(1,X.fillAmount+u.fillRate*G));const V=X.fillAmount>=1;if(V&&!X.wasFullLastFrame&&(X.boopScale=ud),X.wasFullLastFrame=V,X.boopScale>1){const te=(ud-1)/(e3/1e3);X.boopScale=Math.max(1,X.boopScale-te*G)}}r.current=r3(s.current,r.current,i),i3(s.current,r.current,i),m({}),t.current=requestAnimationFrame(ee)};return t.current=requestAnimationFrame(ee),()=>cancelAnimationFrame(t.current)},[i,u]);const h=g.useCallback(L=>{const ee=e.current;if(!ee)return;const H=ee.getBoundingClientRect(),G=L.clientX-H.left,X=L.clientY-H.top;for(let V=0;V<s.current.length;V++){const te=s.current[V],J=G-te.targetX,pe=X-te.targetY;if(J*J+pe*pe<80*80){te.fillAmount<1&&(te.isShaking=!0,setTimeout(()=>{te.isShaking=!1,m({})},300)),o.current=V,l.current={x:J,y:pe},L.target.setPointerCapture(L.pointerId);break}}},[]),x=g.useCallback(L=>{if(o.current===null)return;const ee=e.current;if(!ee)return;const H=ee.getBoundingClientRect(),G=L.clientX-H.left-l.current.x,X=L.clientY-H.top-l.current.y;s.current[o.current].targetX=G,s.current[o.current].targetY=X},[]),C=g.useCallback(()=>{o.current=null},[]),j=L=>{s.current[L].rotation=(s.current[L].rotation+90)%360},R=()=>{for(const L of s.current)L.fillAmount=0,L.wasFullLastFrame=!1,L.boopScale=1},P=L=>{const ee=ia[L];ee&&(p(ee),v(L))},S=()=>{const{alphaMultiplier:L,alphaOffset:ee}=d;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${L} ${ee}`},T="#2c3e50",E=L=>{let ee=1/0,H=-1/0,G=1/0,X=-1/0;for(const V of L)V.x<ee&&(ee=V.x),V.x>H&&(H=V.x),V.y<G&&(G=V.y),V.y>X&&(X=V.y);return{minX:ee,maxX:H,minY:G,maxY:X}},M=`
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }
  `;return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("style",{children:M}),a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-6: Fill / Pour"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:'Goop fills the cell wall container over time  visual "time to pop" mechanic'}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ia).map(L=>a.jsx("button",{onClick:()=>P(L),style:{padding:"8px 16px",background:y===L?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:y===L?"bold":"normal"},children:L.charAt(0).toUpperCase()+L.slice(1)},L))}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14,fontWeight:"bold"},children:[a.jsx("input",{type:"checkbox",checked:u.autoFill,onChange:L=>f(ee=>({...ee,autoFill:L.target.checked}))}),a.jsx("span",{children:"Auto-Fill"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Fill Rate: ",u.fillRate.toFixed(2),"/s"]}),a.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:u.fillRate,onChange:L=>f(ee=>({...ee,fillRate:Number(L.target.value)})),style:{width:120}})]}),a.jsx("button",{onClick:R,style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Fill"}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:12},children:[a.jsxs("span",{children:["T: ",Math.round(((Q=s.current[0])==null?void 0:Q.fillAmount)*100||0),"%"]}),a.jsxs("span",{children:["U: ",Math.round(((ne=s.current[1])==null?void 0:ne.fillAmount)*100||0),"%"]}),a.jsxs("span",{children:["C: ",Math.round(((ie=s.current[2])==null?void 0:ie.fillAmount)*100||0),"%"]})]})]}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Blur: ",d.stdDeviation]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:d.stdDeviation,onChange:L=>{p(ee=>({...ee,stdDeviation:Number(L.target.value)})),v("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Mult: ",d.alphaMultiplier]}),a.jsx("input",{type:"range",min:"5",max:"40",step:"1",value:d.alphaMultiplier,onChange:L=>{p(ee=>({...ee,alphaMultiplier:Number(L.target.value)})),v("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Alpha Offset: ",d.alphaOffset]}),a.jsx("input",{type:"range",min:"-20",max:"0",step:"1",value:d.alphaOffset,onChange:L=>{p(ee=>({...ee,alphaOffset:Number(L.target.value)})),v("custom")},style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:d.enabled,onChange:L=>{p(ee=>({...ee,enabled:L.target.checked})),v(L.target.checked?"custom":"none")}}),a.jsx("span",{children:"Filter On"})]}),a.jsxs("div",{style:{display:"flex",gap:10,marginLeft:20},children:[a.jsx("button",{onClick:()=>j(0),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate T"}),a.jsx("button",{onClick:()=>j(1),style:{padding:"8px 12px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate U"}),a.jsx("button",{onClick:()=>j(2),style:{padding:"8px 12px",background:"#9b59b6",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:"Rotate Corrupt"})]})]}),a.jsxs("div",{style:{display:"flex",gap:20,marginBottom:20,background:"#34495e",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#2ecc71",fontWeight:"bold"},children:["Inner Stiffness: ",i.innerHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i.innerHomeStiffness,onChange:L=>c(ee=>({...ee,innerHomeStiffness:Number(L.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"How stable inner core is"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#f39c12",fontWeight:"bold"},children:["Goopiness: ",i.goopiness,"px"]}),a.jsx("input",{type:"range",min:"30",max:"150",step:"5",value:i.goopiness,onChange:L=>c(ee=>({...ee,goopiness:Number(L.target.value)})),style:{width:120}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Break distance"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Attraction Radius: ",i.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"15",max:"60",step:"5",value:i.attractionRadius,onChange:L=>c(ee=>({...ee,attractionRadius:Number(L.target.value)})),style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{children:["Attraction Strength: ",i.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.005",max:"0.08",step:"0.005",value:i.attractionStiffness,onChange:L=>c(ee=>({...ee,attractionStiffness:Number(L.target.value)})),style:{width:100}})]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",fontSize:12,justifyContent:"center"},children:a.jsxs("span",{style:{opacity:.7},children:["Springs: ",r.current.length]})}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12},children:[a.jsx("input",{type:"checkbox",checked:k,onChange:L=>w(L.target.checked)}),a.jsx("span",{children:"Show Springs"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#e67e22",fontWeight:"bold"},children:["Tendril End Size: ",i.tendrilEndRadius,"px"]}),a.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:i.tendrilEndRadius,onChange:L=>c(ee=>({...ee,tendrilEndRadius:Number(L.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Bead size at ends"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#9b59b6",fontWeight:"bold"},children:["Skinniness: ",i.tendrilSkinniness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"0.95",step:"0.05",value:i.tendrilSkinniness,onChange:L=>c(ee=>({...ee,tendrilSkinniness:Number(L.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Middle thinning when stretched"})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column",fontSize:12},children:[a.jsxs("span",{style:{color:"#1abc9c",fontWeight:"bold"},children:["Wall Thickness: ",i.wallThickness,"px"]}),a.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:i.wallThickness,onChange:L=>c(ee=>({...ee,wallThickness:Number(L.target.value)})),style:{width:100}}),a.jsx("span",{style:{fontSize:10,opacity:.7},children:"Cell wall ring width"})]})]}),a.jsxs("svg",{ref:e,width:K2,height:Z2,style:{background:T,borderRadius:8,cursor:"grab"},onPointerDown:h,onPointerMove:x,onPointerUp:C,onPointerLeave:C,children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter-6",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:d.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:S(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),a.jsx("text",{x:120,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"T"}),a.jsx("text",{x:300,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"U"}),a.jsx("text",{x:480,y:30,fill:"#fff",fontSize:14,textAnchor:"middle",opacity:.7,children:"Corrupt"}),a.jsxs("g",{filter:d.enabled?"url(#goo-filter-6)":void 0,children:[r.current.map((L,ee)=>{var ce,ue;const H=(ce=s.current[L.blobA])==null?void 0:ce.vertices[L.vertA],G=(ue=s.current[L.blobB])==null?void 0:ue.vertices[L.vertB];if(!H||!G)return null;const X=G.pos.x-H.pos.x,V=G.pos.y-H.pos.y,te=Math.sqrt(X*X+V*V),J=Math.min(1,te/i.goopiness),pe=i.tendrilEndRadius,Me=1-i.tendrilSkinniness,he=1-i.tendrilSkinniness*.3,A=he-(he-Me)*J,Y=pe*A,q=pe*1.4,K=Math.max(2,Math.ceil(te/q)),me=[];for(let Z=0;Z<=K;Z++){const Ce=Z/K,ke=Math.sin(Ce*Math.PI),be=pe-(pe-Y)*ke;me.push({cx:H.pos.x+X*Ce,cy:H.pos.y+V*Ce,r:Math.max(2,be)})}return a.jsx("g",{children:me.map((Z,Ce)=>a.jsx("circle",{cx:Z.cx,cy:Z.cy,r:Z.r,fill:"#e74c3c"},Ce))},`tendril-${ee}`)}),s.current.map((L,ee)=>{const H=L.boopScale!==1?`translate(${L.targetX}, ${L.targetY}) scale(${L.boopScale}) translate(${-L.targetX}, ${-L.targetY})`:void 0;return a.jsx("g",{transform:H,style:L.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,children:a.jsx("path",{d:a3(L.vertices),fill:L.color,stroke:L.color,strokeWidth:2})},ee)})]}),s.current.map((L,ee)=>{const H=L.boopScale!==1?`translate(${L.targetX}, ${L.targetY}) scale(${L.boopScale}) translate(${-L.targetX}, ${-L.targetY})`:void 0,G=L.isShaking?{animation:"shake 0.3s cubic-bezier(.36,.07,.19,.97) both"}:void 0,X=(V,te)=>{const J=E(V),pe=J.maxY-J.minY,Me=J.maxY-pe*L.fillAmount,he=50;return L.fillAmount>=1?null:a.jsxs("g",{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:te,children:a.jsx("rect",{x:J.minX-he,y:J.minY-he,width:J.maxX-J.minX+he*2,height:Me-J.minY+he})})}),a.jsx("path",{d:U0(V),fill:T,clipPath:`url(#${te})`})]},te)};if(L.innerRegions)return a.jsx("g",{transform:H,style:G,children:L.innerRegions.map((V,te)=>{let J;V.outerVertexIndices?J=V.outerVertexIndices.map(Me=>L.vertices[Me].pos):J=V.vertices.map(Me=>Me.pos);const pe=fd(J,i.wallThickness);return X(pe,`unfilled-clip-${ee}-${te}`)})},`inner-group-${ee}`);{const V=L.vertices.map(J=>J.pos),te=fd(V,i.wallThickness);return a.jsx("g",{transform:H,style:G,children:X(te,`unfilled-clip-${ee}`)},`inner-group-${ee}`)}}),k&&r.current.map((L,ee)=>{var he,A;const H=(he=s.current[L.blobA])==null?void 0:he.vertices[L.vertA],G=(A=s.current[L.blobB])==null?void 0:A.vertices[L.vertB];if(!H||!G)return null;const X=G.pos.x-H.pos.x,V=G.pos.y-H.pos.y,J=Math.sqrt(X*X+V*V)/i.goopiness,pe=Math.min(255,Math.floor(J*255)),Me=Math.max(0,255-Math.floor(J*255));return a.jsx("line",{x1:H.pos.x,y1:H.pos.y,x2:G.pos.x,y2:G.pos.y,stroke:`rgb(${pe},${Me},100)`,strokeWidth:2,opacity:.7},`spring-${ee}`)}),s.current.map((L,ee)=>a.jsx("circle",{cx:L.targetX,cy:L.targetY,r:5,fill:"rgba(255,255,255,0.4)"},`center-${ee}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:600,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Proto-6: Fill / Pour"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"New mechanics:"}),a.jsx("br",{})," ",a.jsx("strong",{children:"Fill Amount"}),": Each blob has 0-100% fill level (same color as outer goop)",a.jsx("br",{})," ",a.jsx("strong",{children:"Auto-Fill"}),": Fill rises over time (adjustable rate)",a.jsx("br",{})," ",a.jsx("strong",{children:"Shake on early click"}),": Click before 100% and the goop shakes",a.jsx("br",{})," ",a.jsx("strong",{children:"Boop at 100%"}),": Scale pulse from center when fill completes",a.jsx("br",{})," ",a.jsx("strong",{children:"Reset"}),": Empty all containers to start over",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Game implication:"})," Player must clear goop before it fills to 100% (pop!)",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Next:"})," Proto-7 (Pop)  what happens when fill reaches 100%?"]})]})}const In=6,ht=8,Rt=50,Hn=50,Un=50,u3=In*Rt+Hn*2,f3=ht*Rt+Un*2,d3={damping:.97,stiffness:1,pressure:5,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},aa={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},p3={autoFill:!0,fillRate:.15},dd=1.15,h3=200,x3=200,ei=["#e74c3c","#3498db","#2ecc71","#f39c12"];function y3(e,t){return{x:Hn+(e+.5)*Rt,y:Un+(t+.5)*Rt}}function mi(e,t){return{x:Hn+e*Rt,y:Un+t*Rt}}function qi(e){let t=0,n=0;for(const s of e){const r=y3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function m3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function g3(e){if(e.length===0)return[];const t=new Map;for(const l of e){const i=`${l.x1},${l.y1}`,c=`${l.x2},${l.y2}`;t.has(i)||t.set(i,[]),t.has(c)||t.set(c,[]),t.get(i).push(l),t.get(c).push(l)}const n=new Set,s=[];let r=e[0],o={x:r.x1,y:r.y1};for(;n.size<e.length;){n.add(r),s.push(mi(o.x,o.y));const l=o.x===r.x1&&o.y===r.y1?{x:r.x2,y:r.y2}:{x:r.x1,y:r.y1},i=`${l.x},${l.y}`,u=(t.get(i)||[]).find(f=>!n.has(f));if(!u)break;r=u,o=l}return s}let W0=0;function ti(e,t,n){const s=`blob-${W0++}`,r=m3(e),o=g3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const w=qi(e),m=Rt*.4;o.push({x:w.x-m,y:w.y-m},{x:w.x+m,y:w.y-m},{x:w.x+m,y:w.y+m},{x:w.x-m,y:w.y+m})}const l=qi(e),i=o.map(w=>({pos:{x:w.x,y:w.y},oldPos:{x:w.x,y:w.y},homeOffset:{x:w.x-l.x,y:w.y-l.y},mass:1,attractionRadius:1})),c=o.map(w=>({pos:{x:w.x,y:w.y},oldPos:{x:w.x,y:w.y},homeOffset:{x:w.x-l.x,y:w.y-l.y}})),u=[],f=i.length;for(let w=0;w<f;w++){const m=(w+1)%f,h=i[m].homeOffset.x-i[w].homeOffset.x,x=i[m].homeOffset.y-i[w].homeOffset.y;u.push({a:w,b:m,restLength:Math.sqrt(h*h+x*x)})}const d=[],p=Rt*1.5,y=new Set;for(let w=0;w<f;w++)for(let m=w+2;m<f;m++){if(m===f-1&&w===0)continue;const h=i[m].homeOffset.x-i[w].homeOffset.x,x=i[m].homeOffset.y-i[w].homeOffset.y,C=Math.sqrt(h*h+x*x);if(C<p){const j=`${Math.min(w,m)}-${Math.max(w,m)}`;y.has(j)||(y.add(j),d.push({a:w,b:m,restLength:C}))}}let v=0;for(let w=0;w<f;w++){const m=(w+1)%f;v+=i[w].homeOffset.x*i[m].homeOffset.y,v-=i[m].homeOffset.x*i[w].homeOffset.y}const k=Math.abs(v)/2;return{id:s,vertices:i,innerVertices:c,ringsprings:u,crossSprings:d,restArea:k,targetX:l.x,targetY:l.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,boopScale:1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function v3(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const i of n){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,l=i.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const i of s){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,l=i.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const S3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function pd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function C3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function k3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const i=pd(l.homeOffset.x,l.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const i=pd(l.homeOffset.x,l.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function w3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function P3(e,t){const n=e.vertices.length;let s=0;for(let l=0;l<n;l++){const i=(l+1)%n;s+=e.vertices[l].pos.x*e.vertices[i].pos.y,s-=e.vertices[i].pos.x*e.vertices[l].pos.y}s=Math.abs(s)/2;const o=(e.restArea-s)/e.restArea*t.pressure*.1;for(let l=0;l<n;l++){const i=(l-1+n)%n,c=(l+1)%n,u=e.vertices[c].pos.x-e.vertices[i].pos.x,d=-(e.vertices[c].pos.y-e.vertices[i].pos.y),p=u,y=Math.sqrt(d*d+p*p);y>1e-4&&(e.vertices[l].pos.x+=d/y*o,e.vertices[l].pos.y+=p/y*o)}}function R3(e){const t=Hn,n=Hn+In*Rt,s=Un,r=Un+ht*Rt,o=2,l=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}}}function j3(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i||l.color!==i.color)continue;const c=l.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${l}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,R=C+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function T3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i)continue;const c=l.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function M3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function X0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=M3(r,o,l,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function b3(e){return X0(e.map(t=>t.pos))}function A3(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-l.x,y=d.y-l.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-l.x,f=i.y-l.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,R=m;let P=x+j,S=C+R;const T=Math.sqrt(P*P+S*S);T<.001?(P=x,S=C):(P/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),Q=M>.1?1/M:10,ne=s[o]*.4,ie=Math.min(t,ne);r.push({x:i.x+P*ie*Math.min(Q,3),y:i.y+S*ie*Math.min(Q,3)})}return r}function E3(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),l=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(x3),[f,d]=g.useState(d3),[p,y]=g.useState(p3),[v,k]=g.useState(aa.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(ei[0]),[R,P]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState(5),[M,Q]=g.useState(1.5),ne=g.useRef(T),ie=g.useRef(M);ne.current=T,ie.current=M,g.useEffect(()=>{const A=[];for(let ue=0;ue<ht;ue++){A[ue]=[];for(let Z=0;Z<In;Z++)A[ue][Z]=null}r.current=A;const Y=[],q=[{x:0,y:ht-1},{x:1,y:ht-1},{x:2,y:ht-1},{x:1,y:ht-2}],K=ti(q,ei[0],!0);Y.push(K);for(const ue of q)A[ue.y][ue.x]={blobId:K.id,color:K.color};const me=[{x:4,y:ht-1},{x:5,y:ht-1},{x:4,y:ht-2},{x:5,y:ht-2}],ce=ti(me,ei[1],!0);Y.push(ce);for(const ue of me)A[ue.y][ue.x]={blobId:ce.id,color:ce.color};s.current=Y},[]),g.useEffect(()=>{let A=!0;const Y=q=>{var me,ce,ue;if(A){n.current=q,A=!1,t.current=requestAnimationFrame(Y);return}const K=Math.min((q-n.current)/1e3,.033);n.current=q;for(const Z of s.current){C3(Z,f,K),k3(Z,f);for(let ke=0;ke<f.iterations;ke++)w3(Z,f);Z.usePressure&&P3(Z,f),R3(Z),Z.isLocked&&p.autoFill&&Z.fillAmount<1&&(Z.fillAmount=Math.min(1,Z.fillAmount+p.fillRate*K));const Ce=Z.fillAmount>=1;if(Ce&&!Z.wasFullLastFrame&&(Z.boopScale=dd),Z.wasFullLastFrame=Ce,Z.boopScale>1){const ke=(dd-1)/(h3/1e3);Z.boopScale=Math.max(1,Z.boopScale-ke*K)}}if(l.current!==null){const Z=s.current[l.current];if(Z&&!Z.isLocked){let Ce=ht-1;for(const Ie of Z.gridCells){let _=Ie.y;for(;_<ht-1;){const xe=_+1,_e=(me=r.current[xe])==null?void 0:me[Ie.x];if(_e&&_e.blobId!==Z.id)break;_=xe}_-Ie.y+Z.gridCells[0].y;const F=_-Ie.y;Ie.y+F-Ie.y<Ce-Z.gridCells[0].y}let ke=ht;for(const Ie of Z.gridCells){let _=0;for(;Ie.y+_+1<ht;){const F=Ie.y+_+1,ve=(ce=r.current[F])==null?void 0:ce[Ie.x];if(ve&&ve.blobId!==Z.id)break;_++}ke=Math.min(ke,_)}const be=ke*Rt,je=c*K,Te=Math.min(Z.visualOffsetY+je,be);for(Z.visualOffsetY=Te;Z.visualOffsetY>=Rt;){for(const Ie of Z.gridCells)Ie.y+=1;Z.visualOffsetY-=Rt}const Pe=qi(Z.gridCells);Z.targetY=Pe.y+Z.visualOffsetY;let Be=!0;for(const Ie of Z.gridCells){const _=Ie.y+1;if(_>=ht){Be=!1;break}const F=(ue=r.current[_])==null?void 0:ue[Ie.x];if(F&&F.blobId!==Z.id){Be=!1;break}}!Be&&Z.visualOffsetY<.1&&(Z.visualOffsetY=0,Z.targetY=Pe.y,i.current=!0)}}o.current=j3(s.current,o.current,f),T3(s.current,o.current,f),i.current&&l.current!==null&&(i.current=!1,G()),S({}),t.current=requestAnimationFrame(Y)};return t.current=requestAnimationFrame(Y),()=>cancelAnimationFrame(t.current)},[f,p,c]);const L=g.useCallback((A,Y)=>{var q;return Y<0||Y>=ht||A<0||A>=In?!0:((q=r.current[Y])==null?void 0:q[A])!==null},[]),ee=g.useCallback((A,Y)=>{const q=new Set,K=r.current;for(const me of A){const ce=[{x:me.x-1,y:me.y},{x:me.x+1,y:me.y},{x:me.x,y:me.y-1},{x:me.x,y:me.y+1}];for(const ue of ce)if(ue.y>=0&&ue.y<ht&&ue.x>=0&&ue.x<In){const Z=K[ue.y][ue.x];Z&&Z.color===Y&&q.add(Z.blobId)}}return q},[]),H=g.useCallback(A=>{var ce,ue,Z;const Y=ne.current,q=ie.current,K=[];for(const Ce of A.gridCells){const ke=Ce.y+1;ke<ht&&((ce=r.current[ke])!=null&&ce[Ce.x])&&K.push(mi(Ce.x+.5,Ce.y+1)),Ce.x>0&&((ue=r.current[Ce.y])!=null&&ue[Ce.x-1])&&K.push(mi(Ce.x,Ce.y+.5)),Ce.x<In-1&&((Z=r.current[Ce.y])!=null&&Z[Ce.x+1])&&K.push(mi(Ce.x+1,Ce.y+.5))}if(K.length===0)return;const me=Rt*q;for(const Ce of s.current)if(Ce.id!==A.id){for(const ke of Ce.vertices){let be=1/0,je=null;for(const Te of K){const Pe=ke.pos.x-Te.x,Be=ke.pos.y-Te.y,Ie=Math.sqrt(Pe*Pe+Be*Be);Ie<be&&(be=Ie,je=Te)}if(be<me&&je){const Te=1-be/me,Pe=Y*Te*Te,Be=(ke.pos.x-je.x)/(be+.1),Ie=(ke.pos.y-je.y)/(be+.1);ke.oldPos.x-=Be*Pe,ke.oldPos.y-=Ie*Pe*.5}}for(const ke of Ce.innerVertices){let be=1/0,je=null;for(const Te of K){const Pe=ke.pos.x-Te.x,Be=ke.pos.y-Te.y,Ie=Math.sqrt(Pe*Pe+Be*Be);Ie<be&&(be=Ie,je=Te)}if(be<me&&je){const Te=1-be/me,Pe=Y*Te*Te*.3,Be=(ke.pos.x-je.x)/(be+.1),Ie=(ke.pos.y-je.y)/(be+.1);ke.oldPos.x-=Be*Pe,ke.oldPos.y-=Ie*Pe*.5}}}},[]),G=g.useCallback(()=>{if(l.current===null)return;const A=s.current[l.current];if(!A)return;H(A),A.visualOffsetY=0;const Y=qi(A.gridCells);A.targetY=Y.y;const q=ee(A.gridCells,A.color);if(q.size>0){const K=[...A.gridCells],me=[A],ce=[A.id];for(const Z of q){const Ce=s.current.find(ke=>ke.id===Z);Ce&&(K.push(...Ce.gridCells),me.push(Ce),ce.push(Z))}const ue=ti(K,A.color,!0);v3(ue,me);for(const Z of K)r.current[Z.y][Z.x]={blobId:ue.id,color:ue.color};s.current=s.current.filter(Z=>!ce.includes(Z.id)),s.current.push(ue),console.log(`Merged ${ce.length} blobs into one with ${K.length} cells`)}else{A.isLocked=!0,A.fillAmount=0,A.wasFullLastFrame=!1;for(const K of A.gridCells)r.current[K.y][K.x]={blobId:A.id,color:A.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[ee,H]),X=g.useCallback(()=>{if(l.current!==null)return;const A=S3[R],Y=Math.floor((In-4)/2),q=0,K=A.map(ce=>({x:ce.x+Y,y:ce.y+q}));for(const ce of K)if(L(ce.x,ce.y)){console.log("Cannot spawn - space occupied");return}const me=ti(K,C,!1);me.visualOffsetY=0,s.current.push(me),l.current=s.current.length-1},[R,C,L]),V=g.useCallback(()=>{var Y;if(l.current===null)return;const A=s.current[l.current];if(A){for(;;){let q=!0;for(const K of A.gridCells){const me=K.y+1;if(me>=ht){q=!1;break}const ce=(Y=r.current[me])==null?void 0:Y[K.x];if(ce&&ce.blobId!==A.id){q=!1;break}}if(!q)break;for(const K of A.gridCells)K.y+=1}A.visualOffsetY=0,G()}},[G]),te=g.useCallback(()=>{l.current=null,i.current=!1;for(let A=0;A<ht;A++)for(let Y=0;Y<In;Y++)r.current[A][Y]=null;s.current=[],W0=0,o.current=[]},[]),J=A=>{const Y=aa[A];Y&&(k(Y),m(A))},pe=()=>{const{alphaMultiplier:A,alphaOffset:Y}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${A} ${Y}`},Me="#2c3e50",he=A=>{let Y=1/0,q=-1/0,K=1/0,me=-1/0;for(const ce of A)ce.x<Y&&(Y=ce.x),ce.x>q&&(q=ce.x),ce.y<K&&(K=ce.y),ce.y>me&&(me=ce.y);return{minX:Y,maxX:q,minY:K,maxY:me}};return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-7: Merge"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Dynamic blob generation when pieces lock  same-color merge with unified fill layer"}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[a.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),ei.map((A,Y)=>a.jsx("button",{onClick:()=>j(A),style:{width:30,height:30,background:A,border:C===A?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},A)),a.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(A=>a.jsx("button",{onClick:()=>P(A),style:{padding:"6px 12px",background:R===A?"#fff":"#2c3e50",color:R===A?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:A},A))]}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("button",{onClick:X,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),a.jsx("button",{onClick:V,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),a.jsx("button",{onClick:te,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[a.jsx("input",{type:"checkbox",checked:h,onChange:A=>x(A.target.checked)}),a.jsx("span",{children:"Show Grid"})]})]}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(aa).map(A=>a.jsx("button",{onClick:()=>J(A),style:{padding:"6px 12px",background:w===A?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===A?"bold":"normal",fontSize:12},children:A.charAt(0).toUpperCase()+A.slice(1)},A))}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),a.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:A=>y(Y=>({...Y,fillRate:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),a.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:A=>u(Number(A.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),a.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:A=>d(Y=>({...Y,wallThickness:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:A=>y(Y=>({...Y,autoFill:A.target.checked}))}),a.jsx("span",{children:"Auto-Fill"})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:A=>d(Y=>({...Y,damping:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Stiffness: ",f.stiffness]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:A=>d(Y=>({...Y,stiffness:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),a.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:f.pressure,onChange:A=>d(Y=>({...Y,pressure:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:A=>d(Y=>({...Y,homeStiffness:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:A=>d(Y=>({...Y,innerHomeStiffness:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:A=>d(Y=>({...Y,returnSpeed:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:A=>d(Y=>({...Y,viscosity:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Iterations: ",f.iterations]}),a.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:A=>d(Y=>({...Y,iterations:Number(A.target.value)})),style:{width:80}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Impact Strength: ",T]}),a.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:A=>E(Number(A.target.value)),style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Impact Radius: ",M.toFixed(1)," cells"]}),a.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:M,onChange:A=>Q(Number(A.target.value)),style:{width:100}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),a.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:A=>d(Y=>({...Y,goopiness:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:A=>d(Y=>({...Y,attractionRadius:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:A=>d(Y=>({...Y,attractionStiffness:Number(A.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),a.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:A=>d(Y=>({...Y,tendrilEndRadius:Number(A.target.value)})),style:{width:80}})]})]}),a.jsxs("svg",{ref:e,width:u3,height:f3,style:{background:Me,borderRadius:8},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:pe(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&a.jsxs("g",{opacity:.2,children:[Array.from({length:In+1}).map((A,Y)=>a.jsx("line",{x1:Hn+Y*Rt,y1:Un,x2:Hn+Y*Rt,y2:Un+ht*Rt,stroke:"#fff",strokeWidth:1},`v${Y}`)),Array.from({length:ht+1}).map((A,Y)=>a.jsx("line",{x1:Hn,y1:Un+Y*Rt,x2:Hn+In*Rt,y2:Un+Y*Rt,stroke:"#fff",strokeWidth:1},`h${Y}`))]}),a.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((A,Y)=>{const q=s.current[A.blobA],K=s.current[A.blobB];if(!q||!K)return null;const me=q.vertices[A.vertA],ce=K.vertices[A.vertB];if(!me||!ce)return null;const ue=ce.pos.x-me.pos.x,Z=ce.pos.y-me.pos.y,Ce=Math.sqrt(ue*ue+Z*Z),ke=Math.min(1,Ce/f.goopiness),be=f.tendrilEndRadius,je=1-f.tendrilSkinniness,Te=1-f.tendrilSkinniness*.3,Pe=Te-(Te-je)*ke,Be=be*Pe,Ie=be*1.4,_=Math.max(2,Math.ceil(Ce/Ie)),F=[];for(let ve=0;ve<=_;ve++){const xe=ve/_,_e=Math.sin(xe*Math.PI),N=be-(be-Be)*_e;F.push({cx:me.pos.x+ue*xe,cy:me.pos.y+Z*xe,r:Math.max(2,N)})}return a.jsx("g",{children:F.map((ve,xe)=>a.jsx("circle",{cx:ve.cx,cy:ve.cy,r:ve.r,fill:q.color},xe))},`tendril-${Y}`)}),s.current.map((A,Y)=>{const q=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0;return a.jsx("g",{transform:q,children:a.jsx("path",{d:b3(A.vertices),fill:A.color,stroke:A.color,strokeWidth:2})},A.id)})]}),s.current.map(A=>{if(!A.isLocked||A.fillAmount>=1)return null;const Y=A.boopScale!==1?`translate(${A.targetX}, ${A.targetY}) scale(${A.boopScale}) translate(${-A.targetX}, ${-A.targetY})`:void 0,q=A.vertices.map(ke=>ke.pos),K=A3(q,f.wallThickness),me=he(K),ce=me.maxY-me.minY,ue=me.maxY-ce*A.fillAmount,Z=50,Ce=`unfilled-clip-${A.id}`;return a.jsxs("g",{transform:Y,children:[a.jsx("defs",{children:a.jsx("clipPath",{id:Ce,children:a.jsx("rect",{x:me.minX-Z,y:me.minY-Z,width:me.maxX-me.minX+Z*2,height:ue-me.minY+Z})})}),a.jsx("path",{d:X0(K),fill:Me,clipPath:`url(#${Ce})`})]},`inner-${A.id}`)}),s.current.map((A,Y)=>a.jsx("text",{x:A.targetX,y:A.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:A.isLocked?`${Math.round(A.fillAmount*100)}%`:"falling"},`info-${A.id}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Proto-7: Merge"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Test scenarios:"}),a.jsx("br",{})," ",a.jsx("strong",{children:"Same color adjacent"}),": Blobs merge into one, unified fill restarts",a.jsx("br",{})," ",a.jsx("strong",{children:"Different color"}),": No merge, just neighbors",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Current pieces:"})," ",s.current.length," blobs",a.jsx("br",{}),a.jsx("strong",{children:"Attraction springs:"})," ",o.current.length]})]})}const _n=6,xt=8,yt=50,Cn=50,kn=50,I3=_n*yt+Cn*2,_3=xt*yt+kn*2,O3={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ca={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},L3={autoFill:!0,fillRate:.15},N3=4,D3=200,ni=["#e74c3c","#3498db","#2ecc71","#f39c12"];function $3(e,t){return{x:Cn+(e+.5)*yt,y:kn+(t+.5)*yt}}function gi(e,t){return{x:Cn+e*yt,y:kn+t*yt}}function Ki(e){let t=0,n=0;for(const s of e){const r=$3(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function F3(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function G3(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],i={x:l.x1,y:l.y1},c=n(l,i)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(gi(i.x,i.y));const u=i.x===l.x1&&i.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};c=Math.atan2(u.y-i.y,u.x-i.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(w=>!r.has(w));if(y.length===0)break;let v=y[0],k=1/0;for(const w of y){const m=n(w,u),h=s(c,m);(h>k||k===1/0)&&(k=h,v=w)}l=v,i=u}return o}let V0=0;function si(e,t,n){const s=`blob-${V0++}`,r=F3(e),o=G3(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=Ki(e),x=yt*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const i=Ki(e),c=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y}})),f=[],d=c.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+j*j)})}const p=[],y=yt*1.5,v=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y,R=Math.sqrt(C*C+j*j);if(R<y){const P=`${Math.min(h,x)}-${Math.max(h,x)}`;v.has(P)||(v.add(P),p.push({a:h,b:x,restLength:R}))}}let k=0;for(let h=0;h<d;h++){const x=(h+1)%d;k+=c[h].homeOffset.x*c[x].homeOffset.y,k-=c[x].homeOffset.x*c[h].homeOffset.y}const w=k>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${k.toFixed(0)}, winding=${w}, cells=${e.length}`);const m=Math.abs(k)/2;return{id:s,vertices:c,innerVertices:u,ringsprings:f,crossSprings:p,restArea:m,targetX:i.x,targetY:i.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,visualOffsetY:0}}function B3(e,t){const n=[];for(const r of t)for(const o of r.vertices)n.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.vertices){let o=1/0,l={x:0,y:0};for(const i of n){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,l=i.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}const s=[];for(const r of t)for(const o of r.innerVertices)s.push({pos:{x:o.pos.x,y:o.pos.y},velocity:{x:o.pos.x-o.oldPos.x,y:o.pos.y-o.oldPos.y}});for(const r of e.innerVertices){let o=1/0,l={x:0,y:0};for(const i of s){const c=r.pos.x-i.pos.x,u=r.pos.y-i.pos.y,f=c*c+u*u;f<o&&(o=f,l=i.velocity)}r.oldPos.x=r.pos.x-l.x,r.oldPos.y=r.pos.y-l.y}}const z3={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function hd(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function Y3(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function H3(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const i=hd(l.homeOffset.x,l.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const i=hd(l.homeOffset.x,l.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function U3(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function W3(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,i=o.pos.y-s,c=Math.sqrt(l*l+i*i),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(c>1e-4&&u>1e-4){const d=(u-c)*r;o.pos.x+=l/c*d,o.pos.y+=i/c*d}}}function X3(e){const t=Cn,n=Cn+_n*yt,s=kn,r=kn+xt*yt,o=2,l=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}}}function V3(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];if(i.color===c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>yt*4))for(const p of i.vertices)for(const y of c.vertices){const v=y.pos.x-p.pos.x,k=y.pos.y-p.pos.y,w=Math.sqrt(v*v+k*k);if(w<20&&w>.01){const m=20-w,h=v/w,x=k/w,C=m*.8;p.pos.x-=h*C*.5,p.pos.y-=x*C*.5,y.pos.x+=h*C*.5,y.pos.y+=x*C*.5,p.oldPos.x-=h*C*.3,p.oldPos.y-=x*C*.3,y.oldPos.x+=h*C*.3,y.oldPos.y+=x*C*.3}}}}function q3(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i||l.color!==i.color)continue;const c=l.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${l}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,R=C+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function K3(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i)continue;const c=l.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function Z3(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,i=n[(r+1)%s].pos,c=l.x-o.x,u=l.y-o.y,f=i.x-l.x,d=i.y-l.y,p=Math.sqrt(c*c+u*u)||1,y=Math.sqrt(f*f+d*d)||1,v=c/p,k=u/p,w=f/y,m=d/y,h=k,x=-v,C=m,j=-w;let R=h+C,P=x+j;const S=Math.sqrt(R*R+P*P)||1;R/=S,P/=S,n[r].oldPos.x-=R*t,n[r].oldPos.y-=P*t}}function Q3(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function q0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=Q3(r,o,l,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function J3(e){return q0(e.map(t=>t.pos))}function e5(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-l.x,y=d.y-l.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-l.x,f=i.y-l.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,R=m;let P=x+j,S=C+R;const T=Math.sqrt(P*P+S*S);T<.001?(P=x,S=C):(P/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),Q=M>.1?1/M:10,ne=s[o]*.4,ie=Math.min(t,ne);r.push({x:i.x+P*ie*Math.min(Q,3),y:i.y+S*ie*Math.min(Q,3)})}return r}function t5(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),l=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(D3),[f,d]=g.useState(O3),[p,y]=g.useState(L3),[v,k]=g.useState(ca.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(ni[0]),[R,P]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState(5),[M,Q]=g.useState(1.5),ne=g.useRef(T),ie=g.useRef(M);ne.current=T,ie.current=M;const L=g.useRef([]),ee=g.useRef(0),[H,G]=g.useState(12),[X,V]=g.useState(150),[te,J]=g.useState(1),[pe,Me]=g.useState(8),[he,A]=g.useState(!1),Y="proto8-dev-settings";g.useEffect(()=>{const _=localStorage.getItem(Y);if(_)try{const F=JSON.parse(_);F.physics&&d(F.physics),F.fillParams&&y(F.fillParams),F.filterParams&&(k(F.filterParams),m("custom")),F.fallSpeed&&u(F.fallSpeed),F.impactStrength&&E(F.impactStrength),F.impactRadius&&Q(F.impactRadius),F.dropletCount&&G(F.dropletCount),F.dropletSpeed&&V(F.dropletSpeed),F.dropletLifetime&&J(F.dropletLifetime),F.dropletSize&&Me(F.dropletSize),console.log("Loaded dev settings from localStorage")}catch(F){console.warn("Failed to load dev settings:",F)}},[]),g.useEffect(()=>{const _=F=>{F.key==="`"&&(F.preventDefault(),A(ve=>!ve))};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[]);const q=g.useCallback(()=>{const _={physics:f,fillParams:p,filterParams:v,fallSpeed:c,impactStrength:T,impactRadius:M,dropletCount:H,dropletSpeed:X,dropletLifetime:te,dropletSize:pe};localStorage.setItem(Y,JSON.stringify(_)),console.log("Saved dev settings to localStorage")},[f,p,v,c,T,M,H,X,te,pe]),K=g.useCallback(()=>{const _=[];for(let D=0;D<xt;D++){_[D]=[];for(let B=0;B<_n;B++)_[D][B]=null}r.current=_,V0=0;const F=[],ve=[{x:0,y:xt-1},{x:1,y:xt-1},{x:2,y:xt-1},{x:1,y:xt-2}],xe=si(ve,ni[0],!0);F.push(xe);for(const D of ve)_[D.y][D.x]={blobId:xe.id,color:xe.color};const _e=[{x:4,y:xt-1},{x:5,y:xt-1},{x:4,y:xt-2},{x:5,y:xt-2}],N=si(_e,ni[1],!0);F.push(N);for(const D of _e)_[D.y][D.x]={blobId:N.id,color:N.color};s.current=F,o.current=[],L.current=[],l.current=null,i.current=!1},[]);g.useEffect(()=>{K()},[K]),g.useEffect(()=>{let _=!0;const F=ve=>{var le,b,I;if(_){n.current=ve,_=!1,t.current=requestAnimationFrame(F);return}const xe=Math.min((ve-n.current)/1e3,.033);n.current=ve;for(const O of s.current){Y3(O,f,xe),H3(O,f);for(let $=0;$<f.iterations;$++)U3(O,f);O.usePressure&&W3(O,f),X3(O)}V3(s.current);for(const O of s.current){O.isLocked&&p.autoFill&&O.fillAmount<1&&(O.fillAmount=Math.min(1,O.fillAmount+p.fillRate*xe));const $=O.fillAmount>=1;$&&!O.wasFullLastFrame&&Z3(O,N3),O.wasFullLastFrame=$}if(l.current!==null){const O=s.current[l.current];if(O&&!O.isLocked){let $=xt-1;for(const Ne of O.gridCells){let Fe=Ne.y;for(;Fe<xt-1;){const Qe=Fe+1,$e=(le=r.current[Qe])==null?void 0:le[Ne.x];if($e&&$e.blobId!==O.id)break;Fe=Qe}Fe-Ne.y+O.gridCells[0].y;const ze=Fe-Ne.y;Ne.y+ze-Ne.y<$-O.gridCells[0].y}let z=xt;for(const Ne of O.gridCells){let Fe=0;for(;Ne.y+Fe+1<xt;){const ze=Ne.y+Fe+1,We=(b=r.current[ze])==null?void 0:b[Ne.x];if(We&&We.blobId!==O.id)break;Fe++}z=Math.min(z,Fe)}const W=z*yt,ge=c*xe,Re=Math.min(O.visualOffsetY+ge,W);for(O.visualOffsetY=Re;O.visualOffsetY>=yt;){for(const Ne of O.gridCells)Ne.y+=1;O.visualOffsetY-=yt}const se=Ki(O.gridCells);O.targetY=se.y+O.visualOffsetY;let ye=!0;for(const Ne of O.gridCells){const Fe=Ne.y+1;if(Fe>=xt){ye=!1;break}const ze=(I=r.current[Fe])==null?void 0:I[Ne.x];if(ze&&ze.blobId!==O.id){ye=!1;break}}!ye&&O.visualOffsetY<.1&&(O.visualOffsetY=0,O.targetY=se.y,i.current=!0)}}o.current=q3(s.current,o.current,f),K3(s.current,o.current,f),i.current&&l.current!==null&&(i.current=!1,Ce());const _e=300,N=Cn,D=Cn+_n*yt,B=kn,U=kn+xt*yt;for(const O of L.current)O.vel.y+=_e*xe,O.pos.x+=O.vel.x*xe,O.pos.y+=O.vel.y*xe,(O.pos.x+O.radius<N||O.pos.x-O.radius>D)&&(O.lifetime=0),O.pos.y+O.radius<B&&(O.lifetime=0),O.pos.y+O.radius>U&&(O.pos.y=U-O.radius,O.vel.y*=-.3),O.lifetime-=xe,O.opacity=Math.max(0,O.lifetime/O.maxLifetime),O.radius*=.995;L.current=L.current.filter(O=>O.lifetime>0&&O.opacity>.01),S({}),t.current=requestAnimationFrame(F)};return t.current=requestAnimationFrame(F),()=>cancelAnimationFrame(t.current)},[f,p,c]);const me=g.useCallback((_,F)=>{var ve;return F<0||F>=xt||_<0||_>=_n?!0:((ve=r.current[F])==null?void 0:ve[_])!==null},[]),ce=g.useCallback((_,F)=>{const ve=new Set,xe=r.current;for(const _e of _){const N=[{x:_e.x-1,y:_e.y},{x:_e.x+1,y:_e.y},{x:_e.x,y:_e.y-1},{x:_e.x,y:_e.y+1}];for(const D of N)if(D.y>=0&&D.y<xt&&D.x>=0&&D.x<_n){const B=xe[D.y][D.x];B&&B.color===F&&ve.add(B.blobId)}}return ve},[]),ue=g.useCallback(_=>{var N,D,B;const F=ne.current,ve=ie.current,xe=[];for(const U of _.gridCells){const le=U.y+1;le<xt&&((N=r.current[le])!=null&&N[U.x])&&xe.push(gi(U.x+.5,U.y+1)),U.x>0&&((D=r.current[U.y])!=null&&D[U.x-1])&&xe.push(gi(U.x,U.y+.5)),U.x<_n-1&&((B=r.current[U.y])!=null&&B[U.x+1])&&xe.push(gi(U.x+1,U.y+.5))}if(xe.length===0)return;const _e=yt*ve;for(const U of s.current)if(U.id!==_.id){for(const le of U.vertices){let b=1/0,I=null;for(const O of xe){const $=le.pos.x-O.x,z=le.pos.y-O.y,W=Math.sqrt($*$+z*z);W<b&&(b=W,I=O)}if(b<_e&&I){const O=1-b/_e,$=F*O*O,z=(le.pos.x-I.x)/(b+.1),W=(le.pos.y-I.y)/(b+.1);le.oldPos.x-=z*$,le.oldPos.y-=W*$*.5}}for(const le of U.innerVertices){let b=1/0,I=null;for(const O of xe){const $=le.pos.x-O.x,z=le.pos.y-O.y,W=Math.sqrt($*$+z*z);W<b&&(b=W,I=O)}if(b<_e&&I){const O=1-b/_e,$=F*O*O*.3,z=(le.pos.x-I.x)/(b+.1),W=(le.pos.y-I.y)/(b+.1);le.oldPos.x-=z*$,le.oldPos.y-=W*$*.5}}}},[]),Z=g.useCallback(_=>{var xe,_e;const F=_.targetX,ve=_.targetY;for(let N=0;N<H;N++){const D=Math.floor(Math.random()*_.vertices.length),B=_.vertices[D],U=B.pos.x-F,le=B.pos.y-ve,b=Math.atan2(le,U)+(Math.random()-.5)*.8,I=X*(.5+Math.random()*.8),O={id:`droplet-${ee.current++}`,pos:{x:B.pos.x,y:B.pos.y},vel:{x:Math.cos(b)*I,y:Math.sin(b)*I-50},radius:pe*(.5+Math.random()*.7),color:_.color,opacity:1,lifetime:te*(.7+Math.random()*.6),maxLifetime:te};L.current.push(O),console.log("Created droplet:",O.pos,O.radius,O.color)}for(const N of _.gridCells)((_e=(xe=r.current[N.y])==null?void 0:xe[N.x])==null?void 0:_e.blobId)===_.id&&(r.current[N.y][N.x]=null);s.current=s.current.filter(N=>N.id!==_.id),console.log(`Popped blob with ${_.gridCells.length} cells, spawned ${L.current.length} droplets total`)},[H,X,te,pe]),Ce=g.useCallback(()=>{if(l.current===null)return;const _=s.current[l.current];if(!_)return;ue(_),_.visualOffsetY=0;const F=Ki(_.gridCells);_.targetY=F.y;const ve=ce(_.gridCells,_.color);if(ve.size>0){const xe=[..._.gridCells],_e=[_],N=[_.id];for(const B of ve){const U=s.current.find(le=>le.id===B);U&&(xe.push(...U.gridCells),_e.push(U),N.push(B))}const D=si(xe,_.color,!0);B3(D,_e);for(const B of xe)r.current[B.y][B.x]={blobId:D.id,color:D.color};s.current=s.current.filter(B=>!N.includes(B.id)),s.current.push(D),console.log(`Merged ${N.length} blobs into one with ${xe.length} cells`)}else{_.isLocked=!0,_.fillAmount=0,_.wasFullLastFrame=!1;for(const xe of _.gridCells)r.current[xe.y][xe.x]={blobId:_.id,color:_.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[ce,ue]),ke=g.useCallback(()=>{if(l.current!==null)return;const _=z3[R],F=Math.floor((_n-4)/2),ve=0,xe=_.map(N=>({x:N.x+F,y:N.y+ve}));for(const N of xe)if(me(N.x,N.y)){console.log("Cannot spawn - space occupied");return}const _e=si(xe,C,!1);_e.visualOffsetY=0,s.current.push(_e),l.current=s.current.length-1},[R,C,me]),be=g.useCallback(()=>{var F;if(l.current===null)return;const _=s.current[l.current];if(_){for(;;){let ve=!0;for(const xe of _.gridCells){const _e=xe.y+1;if(_e>=xt){ve=!1;break}const N=(F=r.current[_e])==null?void 0:F[xe.x];if(N&&N.blobId!==_.id){ve=!1;break}}if(!ve)break;for(const xe of _.gridCells)xe.y+=1}_.visualOffsetY=0,Ce()}},[Ce]),je=g.useCallback(()=>{K()},[K]),Te=_=>{const F=ca[_];F&&(k(F),m(_))},Pe=()=>{const{alphaMultiplier:_,alphaOffset:F}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${_} ${F}`},Be="#2c3e50",Ie=_=>{let F=1/0,ve=-1/0,xe=1/0,_e=-1/0;for(const N of _)N.x<F&&(F=N.x),N.x>ve&&(ve=N.x),N.y<xe&&(xe=N.y),N.y>_e&&(_e=N.y);return{minX:F,maxX:ve,minY:xe,maxY:_e}};return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-8: Pop"}),a.jsx("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:"Pop with residue  click filled blobs to pop them, droplets scatter and fade"}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[a.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),ni.map((_,F)=>a.jsx("button",{onClick:()=>j(_),style:{width:30,height:30,background:_,border:C===_?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},_)),a.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(_=>a.jsx("button",{onClick:()=>P(_),style:{padding:"6px 12px",background:R===_?"#fff":"#2c3e50",color:R===_?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:_},_))]}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("button",{onClick:ke,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),a.jsx("button",{onClick:be,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),a.jsx("button",{onClick:je,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[a.jsx("input",{type:"checkbox",checked:h,onChange:_=>x(_.target.checked)}),a.jsx("span",{children:"Show Grid"})]}),a.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),he&&a.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[a.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),a.jsxs("div",{style:{display:"flex",gap:10},children:[a.jsx("button",{onClick:q,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),a.jsx("button",{onClick:()=>A(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ca).map(_=>a.jsx("button",{onClick:()=>Te(_),style:{padding:"6px 12px",background:w===_?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===_?"bold":"normal",fontSize:12},children:_.charAt(0).toUpperCase()+_.slice(1)},_))}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),a.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:_=>y(F=>({...F,fillRate:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),a.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:_=>u(Number(_.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),a.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:_=>d(F=>({...F,wallThickness:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:_=>y(F=>({...F,autoFill:_.target.checked}))}),a.jsx("span",{children:"Auto-Fill"})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:_=>d(F=>({...F,damping:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Stiffness: ",f.stiffness]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:_=>d(F=>({...F,stiffness:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),a.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:_=>d(F=>({...F,pressure:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:_=>d(F=>({...F,homeStiffness:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:_=>d(F=>({...F,innerHomeStiffness:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:_=>d(F=>({...F,returnSpeed:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:_=>d(F=>({...F,viscosity:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Iterations: ",f.iterations]}),a.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:_=>d(F=>({...F,iterations:Number(_.target.value)})),style:{width:80}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Impact Strength: ",T]}),a.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:T,onChange:_=>E(Number(_.target.value)),style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Impact Radius: ",M.toFixed(1)," cells"]}),a.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:M,onChange:_=>Q(Number(_.target.value)),style:{width:100}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Droplets: ",H]}),a.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:H,onChange:_=>G(Number(_.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Speed: ",X]}),a.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:X,onChange:_=>V(Number(_.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Lifetime: ",te.toFixed(1),"s"]}),a.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:te,onChange:_=>J(Number(_.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Size: ",pe,"px"]}),a.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:pe,onChange:_=>Me(Number(_.target.value)),style:{width:80}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),a.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:_=>d(F=>({...F,goopiness:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:_=>d(F=>({...F,attractionRadius:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:_=>d(F=>({...F,attractionStiffness:Number(_.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),a.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:_=>d(F=>({...F,tendrilEndRadius:Number(_.target.value)})),style:{width:80}})]})]})]}),a.jsxs("svg",{ref:e,width:I3,height:_3,style:{background:Be,borderRadius:8},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:Pe(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&a.jsxs("g",{opacity:.2,children:[Array.from({length:_n+1}).map((_,F)=>a.jsx("line",{x1:Cn+F*yt,y1:kn,x2:Cn+F*yt,y2:kn+xt*yt,stroke:"#fff",strokeWidth:1},`v${F}`)),Array.from({length:xt+1}).map((_,F)=>a.jsx("line",{x1:Cn,y1:kn+F*yt,x2:Cn+_n*yt,y2:kn+F*yt,stroke:"#fff",strokeWidth:1},`h${F}`))]}),a.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((_,F)=>{const ve=s.current[_.blobA],xe=s.current[_.blobB];if(!ve||!xe)return null;const _e=ve.vertices[_.vertA],N=xe.vertices[_.vertB];if(!_e||!N)return null;const D=N.pos.x-_e.pos.x,B=N.pos.y-_e.pos.y,U=Math.sqrt(D*D+B*B),le=Math.min(1,U/f.goopiness),b=f.tendrilEndRadius,I=1-f.tendrilSkinniness,O=1-f.tendrilSkinniness*.3,$=O-(O-I)*le,z=b*$,W=b*1.4,ge=Math.max(2,Math.ceil(U/W)),Re=[];for(let se=0;se<=ge;se++){const ye=se/ge,Ne=Math.sin(ye*Math.PI),Fe=b-(b-z)*Ne;Re.push({cx:_e.pos.x+D*ye,cy:_e.pos.y+B*ye,r:Math.max(2,Fe)})}return a.jsx("g",{children:Re.map((se,ye)=>a.jsx("circle",{cx:se.cx,cy:se.cy,r:se.r,fill:ve.color},ye))},`tendril-${F}`)}),s.current.map((_,F)=>{const ve=_.isLocked&&_.fillAmount>=1;return a.jsx("g",{style:{cursor:ve?"pointer":"default"},onClick:()=>ve&&Z(_),children:a.jsx("path",{d:J3(_.vertices),fill:_.color,stroke:_.color,strokeWidth:2})},_.id)})]}),s.current.map(_=>{if(!_.isLocked||_.fillAmount>=1)return null;const F=_.vertices.map(U=>U.pos),ve=e5(F,f.wallThickness),xe=Ie(ve),_e=xe.maxY-xe.minY,N=xe.maxY-_e*_.fillAmount,D=50,B=`unfilled-clip-${_.id}`;return a.jsxs("g",{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:B,children:a.jsx("rect",{x:xe.minX-D,y:xe.minY-D,width:xe.maxX-xe.minX+D*2,height:N-xe.minY+D})})}),a.jsx("path",{d:q0(ve),fill:Be,clipPath:`url(#${B})`})]},`inner-${_.id}`)}),a.jsx("g",{children:L.current.map(_=>a.jsx("circle",{cx:_.pos.x,cy:_.pos.y,r:_.radius,fill:_.color,opacity:_.opacity},_.id))}),s.current.filter(_=>_.gridCells.length>4).map(_=>a.jsxs("g",{children:[_.vertices.map((F,ve)=>a.jsxs("g",{children:[a.jsx("circle",{cx:F.pos.x,cy:F.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),a.jsx("text",{x:F.pos.x+6,y:F.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:ve})]},`v-${ve}`)),_.vertices.map((F,ve)=>{const xe=_.vertices[(ve+1)%_.vertices.length];return a.jsx("line",{x1:F.pos.x,y1:F.pos.y,x2:xe.pos.x,y2:xe.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${ve}`)})]},`debug-verts-${_.id}`)),s.current.map((_,F)=>a.jsx("text",{x:_.targetX,y:_.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:_.isLocked?`${Math.round(_.fillAmount*100)}%`:"falling"},`info-${_.id}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Proto-8: Pop"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"How to test:"}),a.jsx("br",{})," Wait for a blob to fill to 100%",a.jsx("br",{})," Click the filled blob to pop it",a.jsx("br",{})," Droplets scatter outward and fade",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",a.jsx("strong",{children:"Droplets:"})," ",L.current.length]})]})}const an=6,et=8,at=50,wn=50,Pn=50,n5=an*at+wn*2,s5=et*at+Pn*2,o5={damping:.97,stiffness:1,pressure:3,iterations:3,homeStiffness:.01,innerHomeStiffness:.1,returnSpeed:.5,viscosity:2.5,attractionRadius:20,attractionRestLength:0,attractionStiffness:.005,goopiness:25,tendrilEndRadius:10,tendrilSkinniness:.7,wallThickness:8},ua={none:{enabled:!1,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},subtle:{enabled:!0,stdDeviation:5,alphaMultiplier:15,alphaOffset:-6},medium:{enabled:!0,stdDeviation:8,alphaMultiplier:20,alphaOffset:-12},aggressive:{enabled:!0,stdDeviation:12,alphaMultiplier:25,alphaOffset:-9}},r5={autoFill:!0,fillRate:.15},i5=4,l5=200,Fo=["#e74c3c","#3498db","#2ecc71","#f39c12"],a5={T_I_C:[{x:0,y:2},{x:0,y:3},{x:1,y:0},{x:1,y:1}],T_L_C:[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:2}],T_T_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:2,y:1}],T_S_C:[{x:0,y:2},{x:1,y:0},{x:1,y:1},{x:2,y:1}],T_O_C:[{x:0,y:0},{x:0,y:2},{x:1,y:1},{x:1,y:2}]};function c5(e,t){return{x:wn+(e+.5)*at,y:Pn+(t+.5)*at}}function vi(e,t){return{x:wn+e*at,y:Pn+t*at}}function ro(e){let t=0,n=0;for(const s of e){const r=c5(s.x,s.y);t+=r.x,n+=r.y}return{x:t/e.length,y:n/e.length}}function u5(e){const t=new Set(e.map(s=>`${s.x},${s.y}`)),n=[];for(const s of e){const{x:r,y:o}=s;t.has(`${r},${o-1}`)||n.push({x1:r,y1:o,x2:r+1,y2:o}),t.has(`${r+1},${o}`)||n.push({x1:r+1,y1:o,x2:r+1,y2:o+1}),t.has(`${r},${o+1}`)||n.push({x1:r+1,y1:o+1,x2:r,y2:o+1}),t.has(`${r-1},${o}`)||n.push({x1:r,y1:o+1,x2:r,y2:o})}return n}function f5(e){if(e.length===0)return[];const t=new Map;for(const u of e){const f=`${u.x1},${u.y1}`,d=`${u.x2},${u.y2}`;t.has(f)||t.set(f,[]),t.has(d)||t.set(d,[]),t.get(f).push(u),t.get(d).push(u)}const n=(u,f)=>{const d=f.x===u.x1&&f.y===u.y1?u.x2:u.x1,p=f.x===u.x1&&f.y===u.y1?u.y2:u.y1;return Math.atan2(p-f.y,d-f.x)},s=(u,f)=>{let d=f-u;for(;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;return d},r=new Set,o=[];let l=e[0],i={x:l.x1,y:l.y1},c=n(l,i)+Math.PI;for(;r.size<e.length;){r.add(l),o.push(vi(i.x,i.y));const u=i.x===l.x1&&i.y===l.y1?{x:l.x2,y:l.y2}:{x:l.x1,y:l.y1};c=Math.atan2(u.y-i.y,u.x-i.x)+Math.PI;const d=`${u.x},${u.y}`,y=(t.get(d)||[]).filter(w=>!r.has(w));if(y.length===0)break;let v=y[0],k=1/0;for(const w of y){const m=n(w,u),h=s(c,m);(h>k||k===1/0)&&(k=h,v=w)}l=v,i=u}return o}let K0=0;function ts(e,t,n){const s=`blob-${K0++}`,r=u5(e),o=f5(r);if(o.length<3){console.warn("Failed to create valid perimeter for cells:",e);const h=ro(e),x=at*.4;o.push({x:h.x-x,y:h.y-x},{x:h.x+x,y:h.y-x},{x:h.x+x,y:h.y+x},{x:h.x-x,y:h.y+x})}let l=0;for(let h=0;h<o.length;h++){const x=(h+1)%o.length;l+=o[h].x*o[x].y,l-=o[x].x*o[h].y}l<0&&(o.reverse(),console.log(`Blob ${s}: Reversed CW to CCW`));const i=ro(e),c=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y},mass:1,attractionRadius:1})),u=o.map(h=>({pos:{x:h.x,y:h.y},oldPos:{x:h.x,y:h.y},homeOffset:{x:h.x-i.x,y:h.y-i.y}})),f=[],d=c.length;for(let h=0;h<d;h++){const x=(h+1)%d,C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y;f.push({a:h,b:x,restLength:Math.sqrt(C*C+j*j)})}const p=[],y=at*1.5,v=new Set;for(let h=0;h<d;h++)for(let x=h+2;x<d;x++){if(x===d-1&&h===0)continue;const C=c[x].homeOffset.x-c[h].homeOffset.x,j=c[x].homeOffset.y-c[h].homeOffset.y,R=Math.sqrt(C*C+j*j);if(R<y){const P=`${Math.min(h,x)}-${Math.max(h,x)}`;v.has(P)||(v.add(P),p.push({a:h,b:x,restLength:R}))}}let k=0;for(let h=0;h<d;h++){const x=(h+1)%d;k+=c[h].homeOffset.x*c[x].homeOffset.y,k-=c[x].homeOffset.x*c[h].homeOffset.y}const w=k>=0?"CCW (correct)":"CW (WILL INVERT!)";console.log(`Blob ${s}: signedArea=${k.toFixed(0)}, winding=${w}, cells=${e.length}`);const m=Math.abs(k)/2;return{id:s,vertices:c,innerVertices:u,ringsprings:f,crossSprings:p,restArea:m,targetX:i.x,targetY:i.y,rotation:0,color:t,usePressure:!0,fillAmount:n?0:1,isShaking:!1,wasFullLastFrame:!n,gridCells:[...e],isLocked:n,isLoose:!1,visualOffsetY:0}}function xd(e,t,n=.3){const s=[];for(const o of t)for(const l of o.vertices)s.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.vertices){let l=1/0,i={x:0,y:0};for(const c of s){const u=o.pos.x-c.pos.x,f=o.pos.y-c.pos.y,d=u*u+f*f;d<l&&(l=d,i=c.velocity)}o.oldPos.x=o.pos.x-i.x*n,o.oldPos.y=o.pos.y-i.y*n}const r=[];for(const o of t)for(const l of o.innerVertices)r.push({pos:{x:l.pos.x,y:l.pos.y},velocity:{x:l.pos.x-l.oldPos.x,y:l.pos.y-l.oldPos.y}});for(const o of e.innerVertices){let l=1/0,i={x:0,y:0};for(const c of r){const u=o.pos.x-c.pos.x,f=o.pos.y-c.pos.y,d=u*u+f*f;d<l&&(l=d,i=c.velocity)}o.oldPos.x=o.pos.x-i.x*n,o.oldPos.y=o.pos.y-i.y*n}}const d5=at*.02*1e3;function p5(e){if(e.length===0)return[];if(e.length===1)return[[...e]];const t=new Set(e.map(r=>`${r.x},${r.y}`)),n=new Set,s=[];for(const r of e){const o=`${r.x},${r.y}`;if(n.has(o))continue;const l=[],i=[r];for(;i.length>0;){const c=i.shift(),u=`${c.x},${c.y}`;if(n.has(u))continue;n.add(u),l.push(c);const f=[{x:c.x,y:c.y-1},{x:c.x,y:c.y+1},{x:c.x-1,y:c.y},{x:c.x+1,y:c.y}];for(const d of f){const p=`${d.x},${d.y}`;t.has(p)&&!n.has(p)&&i.push(d)}}l.length>0&&s.push(l)}return s}function h5(e,t,n){var s;for(const r of e.gridCells)if(r.y>=et-1)return!0;for(const r of e.gridCells){const o=r.y+1;if(o<et){const l=(s=t[o])==null?void 0:s[r.x];if(l&&l.blobId!==e.id&&n.has(l.blobId))return!0}}return!1}function yd(e,t){var i,c;const n=new Set;for(const u of e)if(!(!u.isLocked||u.isLoose)){for(const f of u.gridCells)if(f.y>=et-1){n.add(u.id);break}}let s=!0;for(;s;){s=!1;for(const u of e)n.has(u.id)||!u.isLocked||u.isLoose||h5(u,t,n)&&(n.add(u.id),s=!0)}const r=[],o=[],l=[];for(const u of e){if(!u.isLocked||u.isLoose||n.has(u.id))continue;for(const d of u.gridCells)((c=(i=t[d.y])==null?void 0:i[d.x])==null?void 0:c.blobId)===u.id&&(t[d.y][d.x]=null);const f=p5(u.gridCells);if(f.length===1)u.isLocked=!1,u.isLoose=!0,u.visualOffsetY=0,r.push(u),console.log(`Blob ${u.id} became loose (lost support)`);else{console.log(`Blob ${u.id} splitting into ${f.length} disconnected pieces`),o.push(u.id);for(const d of f){const p=ts(d,u.color,!1);p.isLocked=!1,p.isLoose=!0,p.visualOffsetY=0,p.fillAmount=u.fillAmount,l.push(p),r.push(p),console.log(`  - Created loose piece with ${d.length} cell(s)`)}}}if(o.length>0||l.length>0){const u=e.filter(f=>!o.includes(f.id));e.length=0,e.push(...u,...l)}return r}const x5={I:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],O:[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],T:[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:1,y:1}],L:[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:1,y:2}],J:[{x:1,y:0},{x:1,y:1},{x:1,y:2},{x:0,y:2}],S:[{x:1,y:0},{x:2,y:0},{x:0,y:1},{x:1,y:1}],Z:[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}]};function md(e,t,n){const s=n*Math.PI/180,r=Math.cos(s),o=Math.sin(s);return{x:e*r-t*o,y:e*o+t*r}}function y5(e,t,n){for(const s of e.vertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}for(const s of e.innerVertices){const r=(s.pos.x-s.oldPos.x)*t.damping,o=(s.pos.y-s.oldPos.y)*t.damping;s.oldPos.x=s.pos.x,s.oldPos.y=s.pos.y,s.pos.x+=r,s.pos.y+=o+10*n*n}}function m5(e,t){const n=e.isLocked?t.returnSpeed*t.returnSpeed:1,s=e.isLocked?t.viscosity:0,r=Math.max(0,1-s),o=s>0?.03/Math.max(1,s):0;for(const l of e.vertices){const i=md(l.homeOffset.x,l.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-l.pos.x,d=u-l.pos.y,p=f*t.homeStiffness*n,y=d*t.homeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}for(const l of e.innerVertices){const i=md(l.homeOffset.x,l.homeOffset.y,e.rotation),c=e.targetX+i.x,u=e.targetY+i.y,f=c-l.pos.x,d=u-l.pos.y,p=f*t.innerHomeStiffness*n,y=d*t.innerHomeStiffness*n;l.pos.x+=p*r,l.pos.y+=y*r,s>0&&(l.oldPos.x-=p*o,l.oldPos.y-=y*o)}}function g5(e,t){for(const n of e.ringsprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.01;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}for(const n of e.crossSprings){const s=e.vertices[n.a],r=e.vertices[n.b],o=r.pos.x-s.pos.x,l=r.pos.y-s.pos.y,i=Math.sqrt(o*o+l*l);if(i<1e-4)continue;const u=(i-n.restLength)/i*t.stiffness*.005;s.pos.x+=o*u,s.pos.y+=l*u,r.pos.x-=o*u,r.pos.y-=l*u}}function v5(e,t){if(!e.isLocked)return;const n=e.targetX,s=e.targetY,r=t.pressure*.002;for(const o of e.vertices){const l=o.pos.x-n,i=o.pos.y-s,c=Math.sqrt(l*l+i*i),u=Math.sqrt(o.homeOffset.x*o.homeOffset.x+o.homeOffset.y*o.homeOffset.y);if(c>1e-4&&u>1e-4){const d=(u-c)*r;o.pos.x+=l/c*d,o.pos.y+=i/c*d}}}function S5(e){const t=wn,n=wn+an*at,s=Pn,r=Pn+et*at,o=2,l=.3;for(const i of e.vertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}}for(const i of e.innerVertices){if(i.pos.x<t+o){i.pos.x=t+o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.x>n-o){i.pos.x=n-o;const c=i.pos.x-i.oldPos.x;i.oldPos.x=i.pos.x-c*l}if(i.pos.y<s+o){i.pos.y=s+o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}if(i.pos.y>r-o){i.pos.y=r-o;const c=i.pos.y-i.oldPos.y;i.oldPos.y=i.pos.y-c*l}}}function C5(e){for(let r=0;r<3;r++)for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];if(i.color===c.color)continue;const u=i.isFalling||i.isLoose,f=c.isFalling||c.isLoose;if(!u&&!f)continue;const d=i.targetX-c.targetX,p=i.targetY-c.targetY;if(!(Math.sqrt(d*d+p*p)>at*4))for(const v of i.vertices)for(const k of c.vertices){const w=k.pos.x-v.pos.x,m=k.pos.y-v.pos.y,h=Math.sqrt(w*w+m*m);if(h<20&&h>.01){const x=20-h,C=w/h,j=m/h,R=x*.8;v.pos.x-=C*R*.5,v.pos.y-=j*R*.5,k.pos.x+=C*R*.5,k.pos.y+=j*R*.5,v.oldPos.x-=C*R*.3,v.oldPos.y-=j*R*.3,k.oldPos.x+=C*R*.3,k.oldPos.y+=j*R*.3}}}}function k5(e,t,n){const s=[],r=new Set;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i||l.color!==i.color)continue;const c=l.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y;Math.sqrt(f*f+d*d)<n.goopiness&&(s.push(o),r.add(`${o.blobA}-${o.vertA}-${o.blobB}-${o.vertB}`))}for(let o=0;o<e.length;o++)for(let l=o+1;l<e.length;l++){const i=e[o],c=e[l];if(i.color!==c.color)continue;const u=i.targetX-c.targetX,f=i.targetY-c.targetY;if(!(Math.sqrt(u*u+f*f)>n.attractionRadius*6))for(let p=0;p<i.vertices.length;p++)for(let y=0;y<c.vertices.length;y++){const v=i.vertices[p],k=c.vertices[y],w=`${o}-${p}-${l}-${y}`;if(r.has(w))continue;const m=k.pos.x-v.pos.x,h=k.pos.y-v.pos.y,x=Math.sqrt(m*m+h*h),C=n.attractionRadius*v.attractionRadius,j=n.attractionRadius*k.attractionRadius,R=C+j;x<R&&(s.push({blobA:o,vertA:p,blobB:l,vertB:y,restLength:n.attractionRestLength}),r.add(w))}}return s}function w5(e,t,n){const s=n.attractionStiffness*.1,r=n.attractionStiffness;for(const o of t){const l=e[o.blobA],i=e[o.blobB];if(!l||!i)continue;const c=l.vertices[o.vertA],u=i.vertices[o.vertB];if(!c||!u)continue;const f=u.pos.x-c.pos.x,d=u.pos.y-c.pos.y,p=Math.sqrt(f*f+d*d);if(p<1e-4)continue;const y=n.attractionRadius*(c.attractionRadius+u.attractionRadius),v=1-Math.max(0,Math.min(1,(p-o.restLength)/(y-o.restLength))),k=s+v*(r-s),w=p-o.restLength,m=f/p*w*k,h=d/p*w*k;c.pos.x+=m,c.pos.y+=h,u.pos.x-=m,u.pos.y-=h}}function P5(e,t){const n=e.vertices,s=n.length;if(!(s<3))for(let r=0;r<s;r++){const o=n[(r-1+s)%s].pos,l=n[r].pos,i=n[(r+1)%s].pos,c=l.x-o.x,u=l.y-o.y,f=i.x-l.x,d=i.y-l.y,p=Math.sqrt(c*c+u*u)||1,y=Math.sqrt(f*f+d*d)||1,v=c/p,k=u/p,w=f/y,m=d/y,h=k,x=-v,C=m,j=-w;let R=h+C,P=x+j;const S=Math.sqrt(R*R+P*P)||1;R/=S,P/=S,n[r].oldPos.x-=R*t,n[r].oldPos.y-=P*t}}function R5(e,t,n,s){return{cp1:{x:t.x+(n.x-e.x)/6,y:t.y+(n.y-e.y)/6},cp2:{x:n.x-(s.x-t.x)/6,y:n.y-(s.y-t.y)/6}}}function Z0(e){const t=e.length;if(t<3)return"";let n=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<t;s++){const r=e[(s-1+t)%t],o=e[s],l=e[(s+1)%t],i=e[(s+2)%t],{cp1:c,cp2:u}=R5(r,o,l,i);n+=` C ${c.x} ${c.y}, ${u.x} ${u.y}, ${l.x} ${l.y}`}return n+" Z"}function j5(e){return Z0(e.map(t=>t.pos))}function T5(e,t){const n=e.length;if(n<3)return e;const s=[];for(let o=0;o<n;o++){const l=e[o];let i=1/0;for(let c=0;c<n;c++){const u=Math.abs(c-o),f=n-u;if(u<=2||f<=2)continue;const d=e[c],p=d.x-l.x,y=d.y-l.y,v=Math.sqrt(p*p+y*y);v<i&&(i=v)}s[o]=i===1/0?1e3:i}const r=[];for(let o=0;o<n;o++){const l=e[(o-1+n)%n],i=e[o],c=e[(o+1)%n],u=i.x-l.x,f=i.y-l.y,d=c.x-i.x,p=c.y-i.y,y=Math.sqrt(u*u+f*f),v=Math.sqrt(d*d+p*p);if(y<.001||v<.001){r.push(i);continue}const k=u/y,w=f/y,m=d/v,h=p/v,x=-w,C=k,j=-h,R=m;let P=x+j,S=C+R;const T=Math.sqrt(P*P+S*S);T<.001?(P=x,S=C):(P/=T,S/=T);const E=k*m+w*h,M=Math.sqrt((1+E)/2),Q=M>.1?1/M:10,ne=s[o]*.4,ie=Math.min(t,ne);r.push({x:i.x+P*ie*Math.min(Q,3),y:i.y+S*ie*Math.min(Q,3)})}return r}function M5(){const e=g.useRef(null),t=g.useRef(0),n=g.useRef(0),s=g.useRef([]),r=g.useRef([]),o=g.useRef([]),l=g.useRef(null),i=g.useRef(!1),[c,u]=g.useState(l5),[f,d]=g.useState(o5),[p,y]=g.useState(r5),[v,k]=g.useState(ua.medium),[w,m]=g.useState("medium"),[h,x]=g.useState(!0),[C,j]=g.useState(Fo[0]),[R,P]=g.useState("T"),[,S]=g.useState({}),[T,E]=g.useState("A"),[M,Q]=g.useState("T_T_C"),[ne,ie]=g.useState(0),[L,ee]=g.useState(5),[H,G]=g.useState(1.5),X=g.useRef(L),V=g.useRef(H);X.current=L,V.current=H;const te=g.useRef([]),J=g.useRef(0),[pe,Me]=g.useState(12),[he,A]=g.useState(150),[Y,q]=g.useState(1),[K,me]=g.useState(8),[ce,ue]=g.useState(!1),Z="proto9-dev-settings";g.useEffect(()=>{const b=localStorage.getItem(Z);if(b)try{const I=JSON.parse(b);I.physics&&d(I.physics),I.fillParams&&y(I.fillParams),I.filterParams&&(k(I.filterParams),m("custom")),I.fallSpeed&&u(I.fallSpeed),I.impactStrength&&ee(I.impactStrength),I.impactRadius&&G(I.impactRadius),I.dropletCount&&Me(I.dropletCount),I.dropletSpeed&&A(I.dropletSpeed),I.dropletLifetime&&q(I.dropletLifetime),I.dropletSize&&me(I.dropletSize),console.log("Loaded dev settings from localStorage")}catch(I){console.warn("Failed to load dev settings:",I)}},[]),g.useEffect(()=>{const b=I=>{I.key==="`"&&(I.preventDefault(),ue(O=>!O))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[]);const Ce=g.useCallback(()=>{const b={physics:f,fillParams:p,filterParams:v,fallSpeed:c,impactStrength:L,impactRadius:H,dropletCount:pe,dropletSpeed:he,dropletLifetime:Y,dropletSize:K};localStorage.setItem(Z,JSON.stringify(b)),console.log("Saved dev settings to localStorage")},[f,p,v,c,L,H,pe,he,Y,K]),ke=g.useCallback(()=>{const b=[];for(let se=0;se<et;se++){b[se]=[];for(let ye=0;ye<an;ye++)b[se][ye]=null}r.current=b,K0=0;const I=[],O=[{x:1,y:et-1},{x:2,y:et-1},{x:3,y:et-1},{x:4,y:et-1}],$=ts(O,Fo[1],!0);$.fillAmount=1,$.wasFullLastFrame=!0,I.push($);for(const se of O)b[se.y][se.x]={blobId:$.id,color:$.color};const z=[{x:1,y:et-2},{x:2,y:et-2},{x:3,y:et-2},{x:2,y:et-3}],W=ts(z,Fo[0],!0);W.fillAmount=1,W.wasFullLastFrame=!0,I.push(W);for(const se of z)b[se.y][se.x]={blobId:W.id,color:W.color};const ge=[{x:1,y:et-5},{x:1,y:et-4},{x:2,y:et-4},{x:3,y:et-4}],Re=ts(ge,Fo[1],!0);Re.fillAmount=1,Re.wasFullLastFrame=!0,I.push(Re);for(const se of ge)b[se.y][se.x]={blobId:Re.id,color:Re.color};s.current=I,o.current=[],te.current=[],l.current=null,i.current=!1,console.log("Test A initialized: 4x1 blue, T red, J blue")},[]);g.useEffect(()=>{ke()},[ke]);const be=g.useCallback(b=>{E(b),ke()},[ke]);g.useEffect(()=>{let b=!0;const I=O=>{var Fe,ze,We,Qe,$e;if(b){n.current=O,b=!1,t.current=requestAnimationFrame(I);return}const $=Math.min((O-n.current)/1e3,.033);n.current=O;for(const fe of s.current){y5(fe,f,$),m5(fe,f);for(let Je=0;Je<f.iterations;Je++)g5(fe,f);fe.usePressure&&v5(fe,f),S5(fe)}C5(s.current);for(const fe of s.current){fe.isLocked&&p.autoFill&&fe.fillAmount<1&&(fe.fillAmount=Math.min(1,fe.fillAmount+p.fillRate*$));const Je=fe.fillAmount>=1;Je&&!fe.wasFullLastFrame&&P5(fe,i5),fe.wasFullLastFrame=Je}if(l.current!==null){const fe=s.current[l.current];if(fe&&!fe.isLocked){let Je=et-1;for(const Ge of fe.gridCells){let Ye=Ge.y;for(;Ye<et-1;){const Fs=Ye+1,Ro=(Fe=r.current[Fs])==null?void 0:Fe[Ge.x];if(Ro&&Ro.blobId!==fe.id)break;Ye=Fs}Ye-Ge.y+fe.gridCells[0].y;const Pt=Ye-Ge.y;Ge.y+Pt-Ge.y<Je-fe.gridCells[0].y}let rt=et;for(const Ge of fe.gridCells){let Ye=0;for(;Ge.y+Ye+1<et;){const Pt=Ge.y+Ye+1,ot=(ze=r.current[Pt])==null?void 0:ze[Ge.x];if(ot&&ot.blobId!==fe.id)break;Ye++}rt=Math.min(rt,Ye)}const ct=rt*at,Ft=c*$,oe=Math.min(fe.visualOffsetY+Ft,ct);for(fe.visualOffsetY=oe;fe.visualOffsetY>=at;){for(const Ge of fe.gridCells)Ge.y+=1;fe.visualOffsetY-=at}const de=ro(fe.gridCells);fe.targetY=de.y+fe.visualOffsetY;let Ve=!0;for(const Ge of fe.gridCells){const Ye=Ge.y+1;if(Ye>=et){Ve=!1;break}const Pt=(We=r.current[Ye])==null?void 0:We[Ge.x];if(Pt&&Pt.blobId!==fe.id){Ve=!1;break}}!Ve&&fe.visualOffsetY<.1&&(fe.visualOffsetY=0,fe.targetY=de.y,i.current=!0)}}const z=s.current.filter(fe=>fe.isLoose),W=[];for(const fe of z){let Je=et;for(const Ve of fe.gridCells){let Ge=0;for(;Ve.y+Ge+1<et;){const Ye=Ve.y+Ge+1,Pt=(Qe=r.current[Ye])==null?void 0:Qe[Ve.x];if(Pt&&Pt.blobId!==fe.id)break;Ge++}Je=Math.min(Je,Ge)}const rt=Je*at,ct=d5*$,Ft=Math.min(fe.visualOffsetY+ct,rt);for(fe.visualOffsetY=Ft;fe.visualOffsetY>=at;){for(const Ve of fe.gridCells)Ve.y+=1;fe.visualOffsetY-=at}const oe=ro(fe.gridCells);fe.targetY=oe.y+fe.visualOffsetY;let de=!0;for(const Ve of fe.gridCells){const Ge=Ve.y+1;if(Ge>=et){de=!1;break}const Ye=($e=r.current[Ge])==null?void 0:$e[Ve.x];if(Ye&&Ye.blobId!==fe.id){de=!1;break}}!de&&fe.visualOffsetY<.1&&(fe.visualOffsetY=0,fe.targetY=oe.y,W.push(fe))}for(const fe of W)Ie(fe);o.current=k5(s.current,o.current,f),w5(s.current,o.current,f),i.current&&l.current!==null&&(i.current=!1,_());const ge=300,Re=wn,se=wn+an*at,ye=Pn,Ne=Pn+et*at;for(const fe of te.current)fe.vel.y+=ge*$,fe.pos.x+=fe.vel.x*$,fe.pos.y+=fe.vel.y*$,(fe.pos.x+fe.radius<Re||fe.pos.x-fe.radius>se)&&(fe.lifetime=0),fe.pos.y+fe.radius<ye&&(fe.lifetime=0),fe.pos.y+fe.radius>Ne&&(fe.pos.y=Ne-fe.radius,fe.vel.y*=-.3),fe.lifetime-=$,fe.opacity=Math.max(0,fe.lifetime/fe.maxLifetime),fe.radius*=.995;te.current=te.current.filter(fe=>fe.lifetime>0&&fe.opacity>.01),S({}),t.current=requestAnimationFrame(I)};return t.current=requestAnimationFrame(I),()=>cancelAnimationFrame(t.current)},[f,p,c]);const je=g.useCallback((b,I)=>{var O;return I<0||I>=et||b<0||b>=an?!0:((O=r.current[I])==null?void 0:O[b])!==null},[]),Te=g.useCallback((b,I)=>{const O=new Set,$=r.current;for(const z of b){const W=[{x:z.x-1,y:z.y},{x:z.x+1,y:z.y},{x:z.x,y:z.y-1},{x:z.x,y:z.y+1}];for(const ge of W)if(ge.y>=0&&ge.y<et&&ge.x>=0&&ge.x<an){const Re=$[ge.y][ge.x];Re&&Re.color===I&&O.add(Re.blobId)}}return O},[]),Pe=g.useCallback(b=>{var W,ge,Re;const I=X.current,O=V.current,$=[];for(const se of b.gridCells){const ye=se.y+1;ye<et&&((W=r.current[ye])!=null&&W[se.x])&&$.push(vi(se.x+.5,se.y+1)),se.x>0&&((ge=r.current[se.y])!=null&&ge[se.x-1])&&$.push(vi(se.x,se.y+.5)),se.x<an-1&&((Re=r.current[se.y])!=null&&Re[se.x+1])&&$.push(vi(se.x+1,se.y+.5))}if($.length===0)return;const z=at*O;for(const se of s.current)if(se.id!==b.id){for(const ye of se.vertices){let Ne=1/0,Fe=null;for(const ze of $){const We=ye.pos.x-ze.x,Qe=ye.pos.y-ze.y,$e=Math.sqrt(We*We+Qe*Qe);$e<Ne&&(Ne=$e,Fe=ze)}if(Ne<z&&Fe){const ze=1-Ne/z,We=I*ze*ze,Qe=(ye.pos.x-Fe.x)/(Ne+.1),$e=(ye.pos.y-Fe.y)/(Ne+.1);ye.oldPos.x-=Qe*We,ye.oldPos.y-=$e*We*.5}}for(const ye of se.innerVertices){let Ne=1/0,Fe=null;for(const ze of $){const We=ye.pos.x-ze.x,Qe=ye.pos.y-ze.y,$e=Math.sqrt(We*We+Qe*Qe);$e<Ne&&(Ne=$e,Fe=ze)}if(Ne<z&&Fe){const ze=1-Ne/z,We=I*ze*ze*.3,Qe=(ye.pos.x-Fe.x)/(Ne+.1),$e=(ye.pos.y-Fe.y)/(Ne+.1);ye.oldPos.x-=Qe*We,ye.oldPos.y-=$e*We*.5}}}},[]),Be=g.useCallback(b=>{var z,W;const I=b.targetX,O=b.targetY;for(let ge=0;ge<pe;ge++){const Re=Math.floor(Math.random()*b.vertices.length),se=b.vertices[Re],ye=se.pos.x-I,Ne=se.pos.y-O,Fe=Math.atan2(Ne,ye)+(Math.random()-.5)*.8,ze=he*(.5+Math.random()*.8),We={id:`droplet-${J.current++}`,pos:{x:se.pos.x,y:se.pos.y},vel:{x:Math.cos(Fe)*ze,y:Math.sin(Fe)*ze-50},radius:K*(.5+Math.random()*.7),color:b.color,opacity:1,lifetime:Y*(.7+Math.random()*.6),maxLifetime:Y};te.current.push(We),console.log("Created droplet:",We.pos,We.radius,We.color)}for(const ge of b.gridCells)((W=(z=r.current[ge.y])==null?void 0:z[ge.x])==null?void 0:W.blobId)===b.id&&(r.current[ge.y][ge.x]=null);s.current=s.current.filter(ge=>ge.id!==b.id);const $=yd(s.current,r.current);$.length>0&&console.log(`Pop created ${$.length} loose goop blob(s)`),console.log(`Popped blob with ${b.gridCells.length} cells, spawned ${te.current.length} droplets total`)},[pe,he,Y,K]),Ie=g.useCallback(b=>{if(!b.isLoose)return;console.log(`Locking loose blob ${b.id}`),Pe(b),b.visualOffsetY=0;const I=ro(b.gridCells);b.targetY=I.y;const O=Te(b.gridCells,b.color);if(O.size>0){const z=[...b.gridCells],W=[b],ge=[b.id];for(const se of O){const ye=s.current.find(Ne=>Ne.id===se);ye&&(z.push(...ye.gridCells),W.push(ye),ge.push(se))}const Re=ts(z,b.color,!0);xd(Re,W);for(const se of z)r.current[se.y][se.x]={blobId:Re.id,color:Re.color};s.current=s.current.filter(se=>!ge.includes(se.id)),s.current.push(Re),console.log(`Loose blob merged with ${O.size} neighbor(s) into ${z.length} cells`)}else{b.isLocked=!0,b.isLoose=!1,b.fillAmount=0,b.wasFullLastFrame=!1;for(const z of b.gridCells)r.current[z.y][z.x]={blobId:b.id,color:b.color};console.log("Loose blob locked (no same-color neighbors)")}const $=yd(s.current,r.current);$.length>0&&console.log(`Landing created ${$.length} more loose goop blob(s)`)},[Te,Pe]),_=g.useCallback(()=>{if(l.current===null)return;const b=s.current[l.current];if(!b)return;Pe(b),b.visualOffsetY=0;const I=ro(b.gridCells);b.targetY=I.y;const O=Te(b.gridCells,b.color);if(O.size>0){const $=[...b.gridCells],z=[b],W=[b.id];for(const Re of O){const se=s.current.find(ye=>ye.id===Re);se&&($.push(...se.gridCells),z.push(se),W.push(Re))}const ge=ts($,b.color,!0);xd(ge,z);for(const Re of $)r.current[Re.y][Re.x]={blobId:ge.id,color:ge.color};s.current=s.current.filter(Re=>!W.includes(Re.id)),s.current.push(ge),console.log(`Merged ${W.length} blobs into one with ${$.length} cells`)}else{b.isLocked=!0,b.fillAmount=0,b.wasFullLastFrame=!1;for(const $ of b.gridCells)r.current[$.y][$.x]={blobId:b.id,color:b.color};console.log("Locked piece (no same-color neighbors)")}l.current=null},[Te,Pe]),F=g.useCallback(()=>{if(l.current!==null)return;const b=x5[R],I=Math.floor((an-4)/2),O=0,$=b.map(W=>({x:W.x+I,y:W.y+O}));for(const W of $)if(je(W.x,W.y)){console.log("Cannot spawn - space occupied");return}const z=ts($,C,!1);z.visualOffsetY=0,s.current.push(z),l.current=s.current.length-1},[R,C,je]),ve=(b,I)=>{let O=b.map(W=>({...W}));for(let W=0;W<I%4;W++)O=O.map(({x:ge,y:Re})=>({x:-Re,y:ge}));const $=Math.min(...O.map(W=>W.x)),z=Math.min(...O.map(W=>W.y));return O.map(W=>({x:W.x-$,y:W.y-z}))},xe=g.useCallback(()=>{if(l.current!==null)return;const b=a5[M];if(!b)return;const I=ve(b,ne),O=Math.floor((an-3)/2),$=0,z=I.map(ge=>({x:ge.x+O,y:ge.y+$}));for(const ge of z){if(ge.x<0||ge.x>=an||ge.y<0||ge.y>=et){console.log("Cannot spawn - out of bounds");return}if(je(ge.x,ge.y)){console.log("Cannot spawn - space occupied");return}}const W=ts(z,C,!1);W.visualOffsetY=0,s.current.push(W),l.current=s.current.length-1,console.log(`Spawned corrupted piece ${M} with rotation ${ne*90}`)},[M,ne,C,je]),_e=g.useCallback(()=>{var I;if(l.current===null)return;const b=s.current[l.current];if(b){for(;;){let O=!0;for(const $ of b.gridCells){const z=$.y+1;if(z>=et){O=!1;break}const W=(I=r.current[z])==null?void 0:I[$.x];if(W&&W.blobId!==b.id){O=!1;break}}if(!O)break;for(const $ of b.gridCells)$.y+=1}b.visualOffsetY=0,_()}},[_]),N=g.useCallback(()=>{ke()},[ke]),D=b=>{const I=ua[b];I&&(k(I),m(b))},B=()=>{const{alphaMultiplier:b,alphaOffset:I}=v;return`1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 ${b} ${I}`},U="#2c3e50",le=b=>{let I=1/0,O=-1/0,$=1/0,z=-1/0;for(const W of b)W.x<I&&(I=W.x),W.x>O&&(O=W.x),W.y<$&&($=W.y),W.y>z&&(z=W.y);return{minX:I,maxX:O,minY:$,maxY:z}};return a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:20,background:"#1a1a2e",minHeight:"100vh",color:"#fff",fontFamily:"system-ui, sans-serif"},children:[a.jsx("h2",{style:{margin:"0 0 10px 0"},children:"Proto-9: Loose Goop"}),a.jsxs("p",{style:{margin:"0 0 20px 0",opacity:.7,fontSize:14},children:[T==="A"&&"Test A: Click red blob to pop  top blue becomes loose  falls  merges with bottom blue",T==="B"&&"Test B: Spawn corrupted pieces, build stacks, pop middle pieces to test loose goop",T==="default"&&"Default: Original Proto-8 setup with T and square pieces"]}),a.jsxs("div",{style:{display:"flex",gap:10,marginBottom:15,background:"#8e44ad",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[a.jsx("span",{style:{fontWeight:"bold",marginRight:10},children:"Test Mode:"}),a.jsx("button",{onClick:()=>be("A"),style:{padding:"8px 16px",background:T==="A"?"#fff":"#2c3e50",color:T==="A"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test A: Stack Pop"}),a.jsx("button",{onClick:()=>be("B"),style:{padding:"8px 16px",background:T==="B"?"#fff":"#2c3e50",color:T==="B"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Test B: Corrupted"}),a.jsx("button",{onClick:()=>be("default"),style:{padding:"8px 16px",background:T==="default"?"#fff":"#2c3e50",color:T==="default"?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Default"})]}),T==="A"&&a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#e74c3c",padding:15,borderRadius:8,justifyContent:"center",alignItems:"center"},children:[a.jsx("span",{style:{fontSize:14},children:"Blue (floor)  Red (middle)  Blue (top)"}),a.jsx("button",{onClick:()=>ke(),style:{padding:"8px 16px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset Stack"})]}),T==="B"&&a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#16a085",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[a.jsx("span",{style:{fontWeight:"bold"},children:"Corrupted Shape:"}),a.jsxs("select",{value:M,onChange:b=>Q(b.target.value),style:{padding:"6px 12px",borderRadius:4,border:"none",background:"#fff",cursor:"pointer"},children:[a.jsx("option",{value:"T_T_C",children:"T Corrupted (split T)"}),a.jsx("option",{value:"T_I_C",children:"I Corrupted (split I)"}),a.jsx("option",{value:"T_L_C",children:"L Corrupted (diagonal L)"}),a.jsx("option",{value:"T_S_C",children:"S Corrupted (diagonal S)"}),a.jsx("option",{value:"T_O_C",children:"O Corrupted (split O)"})]}),a.jsx("span",{style:{fontWeight:"bold",marginLeft:10},children:"Rotate:"}),a.jsx("button",{onClick:()=>ie(b=>(b+3)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CCW"}),a.jsx("button",{onClick:()=>ie(b=>(b+1)%4),style:{padding:"6px 12px",background:"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer"},children:" CW"}),a.jsxs("span",{style:{opacity:.7},children:[ne*90,""]}),a.jsx("button",{onClick:xe,disabled:l.current!==null,style:{padding:"8px 16px",background:l.current!==null?"#7f8c8d":"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold",marginLeft:10},children:"Spawn Corrupted"})]}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#27ae60",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center",alignItems:"center"},children:[a.jsx("span",{style:{fontWeight:"bold"},children:"Color:"}),Fo.map((b,I)=>a.jsx("button",{onClick:()=>j(b),style:{width:30,height:30,background:b,border:C===b?"3px solid white":"3px solid transparent",borderRadius:4,cursor:"pointer"}},b)),a.jsx("span",{style:{marginLeft:20,fontWeight:"bold"},children:"Shape:"}),["T","O","L","I","S","Z","J"].map(b=>a.jsx("button",{onClick:()=>P(b),style:{padding:"6px 12px",background:R===b?"#fff":"#2c3e50",color:R===b?"#000":"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:b},b))]}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:15,background:"#2c3e50",padding:15,borderRadius:8,flexWrap:"wrap",justifyContent:"center"},children:[a.jsx("button",{onClick:F,disabled:l.current!==null,style:{padding:"10px 20px",background:l.current!==null?"#7f8c8d":"#3498db",color:"#fff",border:"none",borderRadius:4,cursor:l.current!==null?"not-allowed":"pointer",fontWeight:"bold"},children:"Spawn Piece"}),a.jsx("button",{onClick:_e,disabled:l.current===null,style:{padding:"10px 20px",background:l.current===null?"#7f8c8d":"#e67e22",color:"#fff",border:"none",borderRadius:4,cursor:l.current===null?"not-allowed":"pointer",fontWeight:"bold"},children:"Drop (Lock)"}),a.jsx("button",{onClick:N,style:{padding:"10px 20px",background:"#c0392b",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Reset All"}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[a.jsx("input",{type:"checkbox",checked:h,onChange:b=>x(b.target.checked)}),a.jsx("span",{children:"Show Grid"})]}),a.jsx("span",{style:{opacity:.5,fontSize:12},children:"Press ` for dev menu"})]}),ce&&a.jsxs("div",{style:{background:"rgba(0,0,0,0.8)",border:"2px solid #3498db",borderRadius:8,padding:15,marginBottom:15},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:15},children:[a.jsx("h3",{style:{margin:0,color:"#3498db"},children:"Dev Menu"}),a.jsxs("div",{style:{display:"flex",gap:10},children:[a.jsx("button",{onClick:Ce,style:{padding:"8px 16px",background:"#27ae60",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Save Settings"}),a.jsx("button",{onClick:()=>ue(!1),style:{padding:"8px 16px",background:"#e74c3c",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:"bold"},children:"Close"})]})]}),a.jsx("div",{style:{display:"flex",gap:10,marginBottom:15},children:Object.keys(ua).map(b=>a.jsx("button",{onClick:()=>D(b),style:{padding:"6px 12px",background:w===b?"#3498db":"#2c3e50",color:"#fff",border:"none",borderRadius:4,cursor:"pointer",fontWeight:w===b?"bold":"normal",fontSize:12},children:b.charAt(0).toUpperCase()+b.slice(1)},b))}),a.jsxs("div",{style:{display:"flex",gap:15,marginBottom:10,background:"#27ae60",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Fill Rate: ",p.fillRate.toFixed(2),"/s"]}),a.jsx("input",{type:"range",min:"0.05",max:"0.5",step:"0.01",value:p.fillRate,onChange:b=>y(I=>({...I,fillRate:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Fall Speed: ",c,"px/s"]}),a.jsx("input",{type:"range",min:"20",max:"200",step:"10",value:c,onChange:b=>u(Number(b.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Wall Thickness: ",f.wallThickness,"px"]}),a.jsx("input",{type:"range",min:"2",max:"20",step:"1",value:f.wallThickness,onChange:b=>d(I=>({...I,wallThickness:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("input",{type:"checkbox",checked:p.autoFill,onChange:b=>y(I=>({...I,autoFill:b.target.checked}))}),a.jsx("span",{children:"Auto-Fill"})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#8e44ad",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Physics (affects jiggle propagation)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Damping: ",f.damping.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.8",max:"0.99",step:"0.01",value:f.damping,onChange:b=>d(I=>({...I,damping:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Stiffness: ",f.stiffness]}),a.jsx("input",{type:"range",min:"1",max:"30",step:"1",value:f.stiffness,onChange:b=>d(I=>({...I,stiffness:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Pressure: ",f.pressure.toFixed(1)]}),a.jsx("input",{type:"range",min:"0",max:"25",step:"0.5",value:f.pressure,onChange:b=>d(I=>({...I,pressure:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Home Stiff: ",f.homeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.01",max:"0.3",step:"0.01",value:f.homeStiffness,onChange:b=>d(I=>({...I,homeStiffness:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Inner Stiff: ",f.innerHomeStiffness.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:f.innerHomeStiffness,onChange:b=>d(I=>({...I,innerHomeStiffness:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Return Speed: ",f.returnSpeed.toFixed(2)]}),a.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.05",value:f.returnSpeed,onChange:b=>d(I=>({...I,returnSpeed:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Viscosity: ",f.viscosity.toFixed(2)]}),a.jsx("input",{type:"range",min:"0",max:"3.0",step:"0.1",value:f.viscosity,onChange:b=>d(I=>({...I,viscosity:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Iterations: ",f.iterations]}),a.jsx("input",{type:"range",min:"1",max:"10",step:"1",value:f.iterations,onChange:b=>d(I=>({...I,iterations:Number(b.target.value)})),style:{width:80}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#c0392b",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Impact Effect"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Impact Strength: ",L]}),a.jsx("input",{type:"range",min:"0",max:"30",step:"1",value:L,onChange:b=>ee(Number(b.target.value)),style:{width:100}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Impact Radius: ",H.toFixed(1)," cells"]}),a.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.25",value:H,onChange:b=>G(Number(b.target.value)),style:{width:100}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:10,background:"#9b59b6",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Pop Effect (click filled blob to pop)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Droplets: ",pe]}),a.jsx("input",{type:"range",min:"4",max:"30",step:"2",value:pe,onChange:b=>Me(Number(b.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Speed: ",he]}),a.jsx("input",{type:"range",min:"50",max:"300",step:"10",value:he,onChange:b=>A(Number(b.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Lifetime: ",Y.toFixed(1),"s"]}),a.jsx("input",{type:"range",min:"0.3",max:"3.0",step:"0.1",value:Y,onChange:b=>q(Number(b.target.value)),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Size: ",K,"px"]}),a.jsx("input",{type:"range",min:"3",max:"15",step:"1",value:K,onChange:b=>me(Number(b.target.value)),style:{width:80}})]})]}),a.jsxs("div",{style:{display:"flex",gap:12,marginBottom:15,background:"#34495e",padding:10,borderRadius:8,flexWrap:"wrap",justifyContent:"center",fontSize:11},children:[a.jsx("span",{style:{fontWeight:"bold",width:"100%",textAlign:"center",marginBottom:5},children:"Attraction (tendrils)"}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Goopiness: ",f.goopiness,"px"]}),a.jsx("input",{type:"range",min:"10",max:"80",step:"5",value:f.goopiness,onChange:b=>d(I=>({...I,goopiness:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Attract Radius: ",f.attractionRadius,"px"]}),a.jsx("input",{type:"range",min:"10",max:"50",step:"5",value:f.attractionRadius,onChange:b=>d(I=>({...I,attractionRadius:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Attract Stiff: ",f.attractionStiffness.toFixed(3)]}),a.jsx("input",{type:"range",min:"0.001",max:"0.02",step:"0.001",value:f.attractionStiffness,onChange:b=>d(I=>({...I,attractionStiffness:Number(b.target.value)})),style:{width:80}})]}),a.jsxs("label",{style:{display:"flex",flexDirection:"column"},children:[a.jsxs("span",{children:["Tendril Size: ",f.tendrilEndRadius,"px"]}),a.jsx("input",{type:"range",min:"4",max:"20",step:"1",value:f.tendrilEndRadius,onChange:b=>d(I=>({...I,tendrilEndRadius:Number(b.target.value)})),style:{width:80}})]})]})]}),a.jsxs("svg",{ref:e,width:n5,height:s5,style:{background:U,borderRadius:8},children:[a.jsx("defs",{children:a.jsxs("filter",{id:"goo-filter-7",colorInterpolationFilters:"sRGB",children:[a.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:v.stdDeviation,result:"blur"}),a.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:B(),result:"goo"}),a.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})}),h&&a.jsxs("g",{opacity:.2,children:[Array.from({length:an+1}).map((b,I)=>a.jsx("line",{x1:wn+I*at,y1:Pn,x2:wn+I*at,y2:Pn+et*at,stroke:"#fff",strokeWidth:1},`v${I}`)),Array.from({length:et+1}).map((b,I)=>a.jsx("line",{x1:wn,y1:Pn+I*at,x2:wn+an*at,y2:Pn+I*at,stroke:"#fff",strokeWidth:1},`h${I}`))]}),a.jsxs("g",{filter:v.enabled?"url(#goo-filter-7)":void 0,children:[o.current.map((b,I)=>{const O=s.current[b.blobA],$=s.current[b.blobB];if(!O||!$)return null;const z=O.vertices[b.vertA],W=$.vertices[b.vertB];if(!z||!W)return null;const ge=W.pos.x-z.pos.x,Re=W.pos.y-z.pos.y,se=Math.sqrt(ge*ge+Re*Re),ye=Math.min(1,se/f.goopiness),Ne=f.tendrilEndRadius,Fe=1-f.tendrilSkinniness,ze=1-f.tendrilSkinniness*.3,We=ze-(ze-Fe)*ye,Qe=Ne*We,$e=Ne*1.4,fe=Math.max(2,Math.ceil(se/$e)),Je=[];for(let rt=0;rt<=fe;rt++){const ct=rt/fe,Ft=Math.sin(ct*Math.PI),oe=Ne-(Ne-Qe)*Ft;Je.push({cx:z.pos.x+ge*ct,cy:z.pos.y+Re*ct,r:Math.max(2,oe)})}return a.jsx("g",{children:Je.map((rt,ct)=>a.jsx("circle",{cx:rt.cx,cy:rt.cy,r:rt.r,fill:O.color},ct))},`tendril-${I}`)}),s.current.map((b,I)=>{const O=b.isLocked&&b.fillAmount>=1;return a.jsx("g",{style:{cursor:O?"pointer":"default"},onClick:()=>O&&Be(b),children:a.jsx("path",{d:j5(b.vertices),fill:b.color,stroke:b.color,strokeWidth:2})},b.id)})]}),s.current.map(b=>{if(!b.isLocked||b.fillAmount>=1)return null;const I=b.vertices.map(se=>se.pos),O=T5(I,f.wallThickness),$=le(O),z=$.maxY-$.minY,W=$.maxY-z*b.fillAmount,ge=50,Re=`unfilled-clip-${b.id}`;return a.jsxs("g",{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:Re,children:a.jsx("rect",{x:$.minX-ge,y:$.minY-ge,width:$.maxX-$.minX+ge*2,height:W-$.minY+ge})})}),a.jsx("path",{d:Z0(O),fill:U,clipPath:`url(#${Re})`})]},`inner-${b.id}`)}),a.jsx("g",{children:te.current.map(b=>a.jsx("circle",{cx:b.pos.x,cy:b.pos.y,r:b.radius,fill:b.color,opacity:b.opacity},b.id))}),s.current.filter(b=>b.gridCells.length>4).map(b=>a.jsxs("g",{children:[b.vertices.map((I,O)=>a.jsxs("g",{children:[a.jsx("circle",{cx:I.pos.x,cy:I.pos.y,r:4,fill:"yellow",stroke:"black",strokeWidth:1}),a.jsx("text",{x:I.pos.x+6,y:I.pos.y+3,fontSize:8,fill:"yellow",stroke:"black",strokeWidth:.3,children:O})]},`v-${O}`)),b.vertices.map((I,O)=>{const $=b.vertices[(O+1)%b.vertices.length];return a.jsx("line",{x1:I.pos.x,y1:I.pos.y,x2:$.pos.x,y2:$.pos.y,stroke:"lime",strokeWidth:1,opacity:.5},`edge-${O}`)})]},`debug-verts-${b.id}`)),s.current.map((b,I)=>a.jsx("text",{x:b.targetX,y:b.targetY-30,fill:"#fff",fontSize:10,textAnchor:"middle",opacity:.7,children:b.isLocked?`${Math.round(b.fillAmount*100)}%`:"falling"},`info-${b.id}`))]}),a.jsxs("div",{style:{marginTop:20,padding:15,background:"#2c3e50",borderRadius:8,maxWidth:500,fontSize:13,lineHeight:1.6},children:[a.jsx("strong",{children:"Proto-8: Pop"}),a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"How to test:"}),a.jsx("br",{})," Wait for a blob to fill to 100%",a.jsx("br",{})," Click the filled blob to pop it",a.jsx("br",{})," Droplets scatter outward and fade",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Blobs:"})," ",s.current.length," | ",a.jsx("strong",{children:"Droplets:"})," ",te.current.length]})]})}const b5=()=>new URLSearchParams(window.location.search).get("proto"),A5=()=>{var y;const[e,t]=g.useState("GAME"),[n,s]=g.useState(()=>wv()),[r,o]=g.useState(0);jv(),g.useEffect(()=>{Pv(n)},[n]),g.useEffect(()=>{Tt.init(n.settings)},[]);const l=g.useCallback(v=>{s(k=>{const w=gt(k.careerScore),{newCareerScore:m,ranksGained:h}=O0(k.careerScore,v.score,v.won),x=gt(m),C=h>0?h:0,R=Km(w.rank,x.rank).filter(P=>!k.milestonesReached.includes(P));return R.length>0&&ae.emit(re.MILESTONE_REACHED,{milestones:R}),{...k,careerScore:m,careerRank:x.rank,scraps:k.scraps+C,milestonesReached:[...k.milestonesReached,...R],firstRunComplete:!0}})},[]),i=v=>{s(k=>({...k,settings:v})),Tt.updateSettings(v)},c=v=>{if(v===0){const k=Rv();s(k),o(w=>w+1),Tt.init(k.settings)}else{const k=Vm(v);s(w=>({...w,careerScore:k,careerRank:v,scraps:v,powerUps:{}})),o(w=>w+1)}},u=g.useCallback(v=>{s(k=>{const w=k.powerUps[v]||0,m=Dn[v],h=(m==null?void 0:m.maxLevel)||4,x=(m==null?void 0:m.costPerLevel)||1;return k.scraps<x||w>=h?k:{...k,scraps:k.scraps-x,powerUps:{...k.powerUps,[v]:w+1}}})},[]),f=g.useCallback(v=>{s(k=>{const w=k.powerUps[v]||0,m=Dn[v],h=(m==null?void 0:m.costPerLevel)||1;if(w<=0)return k;let x=k.equippedActives;return w===1&&k.equippedActives.includes(v)&&(x=k.equippedActives.filter(C=>C!==v)),{...k,scraps:k.scraps+h,powerUps:{...k.powerUps,[v]:w-1},equippedActives:x}})},[]),d=g.useCallback(v=>{s(k=>{const w=k.equippedActives.includes(v);let m;if(w)m=k.equippedActives.filter(h=>h!==v);else{const x=1+((k.powerUps.ACTIVE_EXPANSION_SLOT||0)+(k.powerUps.ACTIVE_EXPANSION_SLOT_2||0));k.equippedActives.length>=x?m=[...k.equippedActives.slice(0,x-1),v]:m=[...k.equippedActives,v]}return{...k,equippedActives:m}})},[]),p=b5();return p==="1"?a.jsx(_v,{}):p==="2"?a.jsx(zv,{}):p==="3"?a.jsx(Qv,{}):p==="4"?a.jsx(c2,{}):p==="5"?a.jsx(C2,{}):p==="5b"?a.jsx(L2,{}):p==="5c"?a.jsx(V2,{}):p==="6"?a.jsx(c3,{}):p==="7"?a.jsx(E3,{}):p==="8"?a.jsx(t5,{}):p==="9"?a.jsx(M5,{}):a.jsxs("div",{className:"w-full h-screen bg-slate-950 text-slate-200 font-sans overflow-hidden",children:[e==="GAME"&&a.jsx(mv,{onExit:()=>{},onRunComplete:l,initialTotalScore:n.careerScore,powerUps:n.powerUps,scraps:n.scraps,settings:n.settings,onOpenSettings:()=>t("SETTINGS"),onOpenHelp:()=>t("HOW_TO_PLAY"),onOpenUpgrades:()=>t("UPGRADES"),onSetRank:c,onPurchaseUpgrade:u,onRefundUpgrade:f,equippedActives:n.equippedActives,onToggleEquip:d,saveData:n,setSaveData:s},r),e==="UPGRADES"&&a.jsx(gv,{onBack:()=>t("GAME")}),e==="SETTINGS"&&a.jsx(vv,{settings:n.settings,onUpdate:i,onBack:()=>t("GAME")}),e==="HOW_TO_PLAY"&&a.jsx(Cv,{completedSteps:((y=n.tutorialProgress)==null?void 0:y.completedSteps)??[],onBack:()=>t("GAME")})]})},Q0=document.getElementById("root");if(!Q0)throw new Error("Could not find root element to mount to");const E5=fa.createRoot(Q0);E5.render(a.jsx(Ph.StrictMode,{children:a.jsx(A5,{})}));
